/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var WH=Object.create;var dl=Object.defineProperty;var KS=Object.getOwnPropertyDescriptor;var $H=Object.getOwnPropertyNames;var jH=Object.getPrototypeOf,VH=Object.prototype.hasOwnProperty;var ZS=n=>{throw TypeError(n)};var YH=(n,e,t)=>e in n?dl(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var v=(n,e)=>()=>(n&&(e=n(n=0)),e);var hp=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),nt=(n,e)=>{for(var t in e)dl(n,t,{get:e[t],enumerable:!0})},JS=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of $H(e))!VH.call(n,s)&&s!==t&&dl(n,s,{get:()=>e[s],enumerable:!(r=KS(e,s))||r.enumerable});return n};var ke=(n,e,t)=>(t=n!=null?WH(jH(n)):{},JS(e||!n||!n.__esModule?dl(t,"default",{value:n,enumerable:!0}):t,n)),fp=n=>JS(dl({},"__esModule",{value:!0}),n),Me=(n,e,t,r)=>{for(var s=r>1?void 0:r?KS(e,t):e,i=n.length-1,a;i>=0;i--)(a=n[i])&&(s=(r?a(e,t,s):a(s))||s);return r&&s&&dl(e,t,s),s};var I=(n,e,t)=>YH(n,typeof e!="symbol"?e+"":e,t),XS=(n,e,t)=>e.has(n)||ZS("Cannot "+t);var Ya=(n,e,t)=>(XS(n,e,"read from private field"),t?t.call(n):e.get(n)),pp=(n,e,t)=>e.has(n)?ZS("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),mp=(n,e,t,r)=>(XS(n,e,"write to private field"),r?r.call(n,t):e.set(n,t),t);var zH,v4,gp,eD,mv,gv,qH,tD,T4,GH,QH,w4,yv,ul=v(()=>{zH=Math.pow(10,8)*24*60*60*1e3,v4=-zH,gp=6048e5,eD=864e5,mv=6e4,gv=36e5,qH=3600,tD=qH*24,T4=tD*7,GH=tD*365.2425,QH=GH/12,w4=QH*3,yv=Symbol.for("constructDateFrom")});function Et(n,e){return typeof n=="function"?n(e):n&&typeof n=="object"&&yv in n?n[yv](e):n instanceof Date?new n.constructor(e):new Date(e)}var Is=v(()=>{ul()});function De(n,e){return Et(e||n,n)}var _t=v(()=>{Is()});function Or(n,e,t){let r=De(n,t==null?void 0:t.in);return isNaN(e)?Et((t==null?void 0:t.in)||n,NaN):(e&&r.setDate(r.getDate()+e),r)}var rd=v(()=>{Is();_t()});function vv(n,e,t){let r=De(n,t==null?void 0:t.in);if(isNaN(e))return Et((t==null?void 0:t.in)||n,NaN);if(!e)return r;let s=r.getDate(),i=Et((t==null?void 0:t.in)||n,r.getTime());i.setMonth(r.getMonth()+e+1,0);let a=i.getDate();return s>=a?i:(r.setFullYear(i.getFullYear(),i.getMonth(),s),r)}var Tv=v(()=>{Is();_t()});function hl(n,e,t){let{years:r=0,months:s=0,weeks:i=0,days:a=0,hours:o=0,minutes:l=0,seconds:c=0}=e,d=De(n,t==null?void 0:t.in),u=s||r?vv(d,s+r*12):d,h=a||i?Or(u,a+i*7):u,f=l+o*60,m=(c+f*60)*1e3;return Et((t==null?void 0:t.in)||n,+h+m)}var rD=v(()=>{rd();Tv();Is();_t()});var sD=v(()=>{});var nD=v(()=>{});var iD=v(()=>{});var aD=v(()=>{});var oD=v(()=>{});var lD=v(()=>{});function An(){return KH}var KH,fl=v(()=>{KH={}});function kr(n,e){var o,l,c,d,u,h,f,p;let t=An(),r=(p=(f=(d=(c=e==null?void 0:e.weekStartsOn)!=null?c:(l=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:l.weekStartsOn)!=null?d:t.weekStartsOn)!=null?f:(h=(u=t.locale)==null?void 0:u.options)==null?void 0:h.weekStartsOn)!=null?p:0,s=De(n,e==null?void 0:e.in),i=s.getDay(),a=(i<r?7:0)+i-r;return s.setDate(s.getDate()-a),s.setHours(0,0,0,0),s}var pl=v(()=>{fl();_t()});function za(n,e){return kr(n,{...e,weekStartsOn:1})}var sd=v(()=>{pl()});function yp(n,e){let t=De(n,e==null?void 0:e.in),r=t.getFullYear(),s=Et(t,0);s.setFullYear(r+1,0,4),s.setHours(0,0,0,0);let i=za(s),a=Et(t,0);a.setFullYear(r,0,4),a.setHours(0,0,0,0);let o=za(a);return t.getTime()>=i.getTime()?r+1:t.getTime()>=o.getTime()?r:r-1}var vp=v(()=>{Is();sd();_t()});function wv(n){let e=De(n),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+n-+t}var cD=v(()=>{_t()});function Tp(n,...e){let t=Et.bind(null,n||e.find(r=>typeof r=="object"));return e.map(t)}var bv=v(()=>{Is()});function hr(n,e){let t=De(n,e==null?void 0:e.in);return t.setHours(0,0,0,0),t}var wp=v(()=>{_t()});function dD(n,e,t){let[r,s]=Tp(t==null?void 0:t.in,n,e),i=hr(r),a=hr(s),o=+i-wv(i),l=+a-wv(a);return Math.round((o-l)/eD)}var kv=v(()=>{cD();bv();ul();wp()});function uD(n,e){let t=yp(n,e),r=Et((e==null?void 0:e.in)||n,0);return r.setFullYear(t,0,4),r.setHours(0,0,0,0),za(r)}var Ev=v(()=>{Is();vp();sd()});var hD=v(()=>{});var fD=v(()=>{});var pD=v(()=>{});var mD=v(()=>{});var gD=v(()=>{});function yD(n,e,t){return Or(n,e*7,t)}var vD=v(()=>{rd()});var TD=v(()=>{});var wD=v(()=>{});var bD=v(()=>{});var kD=v(()=>{});var ED=v(()=>{});var SD=v(()=>{});var DD=v(()=>{});var CD=v(()=>{});var xD=v(()=>{});var MD=v(()=>{});var _D=v(()=>{});function nd(n,e,t){let[r,s]=Tp(t==null?void 0:t.in,n,e);return+hr(r)==+hr(s)}var AD=v(()=>{bv();wp()});function PD(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}var Sv=v(()=>{});function Lr(n){return!(!PD(n)&&typeof n!="number"||isNaN(+De(n)))}var Dv=v(()=>{Sv();_t()});var ID=v(()=>{});var RD=v(()=>{});var ND=v(()=>{});var OD=v(()=>{});var LD=v(()=>{});var FD=v(()=>{});var BD=v(()=>{});var HD=v(()=>{});var UD=v(()=>{});var WD=v(()=>{});var $D=v(()=>{});var jD=v(()=>{});var VD=v(()=>{});var YD=v(()=>{});function zD(n,e){let t=De(n,e==null?void 0:e.in);return t.setHours(23,59,59,999),t}var qD=v(()=>{_t()});function Cv(n,e){let t=De(n,e==null?void 0:e.in),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}var GD=v(()=>{_t()});var QD=v(()=>{});var KD=v(()=>{});var ZD=v(()=>{});var JD=v(()=>{});var XD=v(()=>{});var eC=v(()=>{});var tC=v(()=>{});var rC=v(()=>{});var sC=v(()=>{});var nC=v(()=>{});var iC=v(()=>{});var aC=v(()=>{});var oC=v(()=>{});var lC=v(()=>{});function xv(n,e){let t=De(n,e==null?void 0:e.in);return t.setDate(1),t.setHours(0,0,0,0),t}var cC=v(()=>{_t()});var dC=v(()=>{});var uC=v(()=>{});function Mv(n,e){let t=De(n,e==null?void 0:e.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}var _v=v(()=>{_t()});var hC=v(()=>{});var fC=v(()=>{});var pC=v(()=>{});var mC=v(()=>{});function qa(n,e){var o,l,c,d,u,h,f,p;let t=An(),r=(p=(f=(d=(c=e==null?void 0:e.weekStartsOn)!=null?c:(l=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:l.weekStartsOn)!=null?d:t.weekStartsOn)!=null?f:(h=(u=t.locale)==null?void 0:u.options)==null?void 0:h.weekStartsOn)!=null?p:0,s=De(n,e==null?void 0:e.in),i=s.getDay(),a=(i<r?-7:0)+6-(i-r);return s.setDate(s.getDate()+a),s.setHours(23,59,59,999),s}var gC=v(()=>{fl();_t()});var yC=v(()=>{});var vC=v(()=>{});var TC=v(()=>{});var wC=v(()=>{});var bC=v(()=>{});var kC=v(()=>{});var EC=v(()=>{});var SC=v(()=>{});var ZH,DC,CC=v(()=>{ZH={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},DC=(n,e,t)=>{let r,s=ZH[n];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+r:r+" ago":r}});function bp(n){return(e={})=>{let t=e.width?String(e.width):n.defaultWidth;return n.formats[t]||n.formats[n.defaultWidth]}}var xC=v(()=>{});var JH,XH,eU,MC,_C=v(()=>{xC();JH={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},XH={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},eU={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},MC={date:bp({formats:JH,defaultWidth:"full"}),time:bp({formats:XH,defaultWidth:"full"}),dateTime:bp({formats:eU,defaultWidth:"full"})}});var tU,AC,PC=v(()=>{tU={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},AC=(n,e,t,r)=>tU[n]});function ml(n){return(e,t)=>{let r=t!=null&&t.context?String(t.context):"standalone",s;if(r==="formatting"&&n.formattingValues){let a=n.defaultFormattingWidth||n.defaultWidth,o=t!=null&&t.width?String(t.width):a;s=n.formattingValues[o]||n.formattingValues[a]}else{let a=n.defaultWidth,o=t!=null&&t.width?String(t.width):n.defaultWidth;s=n.values[o]||n.values[a]}let i=n.argumentCallback?n.argumentCallback(e):e;return s[i]}}var IC=v(()=>{});var rU,sU,nU,iU,aU,oU,lU,RC,NC=v(()=>{IC();rU={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},sU={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},nU={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},iU={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},aU={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},oU={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},lU=(n,e)=>{let t=Number(n),r=t%100;if(r>20||r<10)switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},RC={ordinalNumber:lU,era:ml({values:rU,defaultWidth:"wide"}),quarter:ml({values:sU,defaultWidth:"wide",argumentCallback:n=>n-1}),month:ml({values:nU,defaultWidth:"wide"}),day:ml({values:iU,defaultWidth:"wide"}),dayPeriod:ml({values:aU,defaultWidth:"wide",formattingValues:oU,defaultFormattingWidth:"wide"})}});function gl(n){return(e,t={})=>{let r=t.width,s=r&&n.matchPatterns[r]||n.matchPatterns[n.defaultMatchWidth],i=e.match(s);if(!i)return null;let a=i[0],o=r&&n.parsePatterns[r]||n.parsePatterns[n.defaultParseWidth],l=Array.isArray(o)?dU(o,u=>u.test(a)):cU(o,u=>u.test(a)),c;c=n.valueCallback?n.valueCallback(l):l,c=t.valueCallback?t.valueCallback(c):c;let d=e.slice(a.length);return{value:c,rest:d}}}function cU(n,e){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&e(n[t]))return t}function dU(n,e){for(let t=0;t<n.length;t++)if(e(n[t]))return t}var OC=v(()=>{});function LC(n){return(e,t={})=>{let r=e.match(n.matchPattern);if(!r)return null;let s=r[0],i=e.match(n.parsePattern);if(!i)return null;let a=n.valueCallback?n.valueCallback(i[0]):i[0];a=t.valueCallback?t.valueCallback(a):a;let o=e.slice(s.length);return{value:a,rest:o}}}var FC=v(()=>{});var uU,hU,fU,pU,mU,gU,yU,vU,TU,wU,bU,kU,BC,HC=v(()=>{OC();FC();uU=/^(\d+)(th|st|nd|rd)?/i,hU=/\d+/i,fU={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},pU={any:[/^b/i,/^(a|c)/i]},mU={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},gU={any:[/1/i,/2/i,/3/i,/4/i]},yU={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},vU={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},TU={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},wU={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},bU={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},kU={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},BC={ordinalNumber:LC({matchPattern:uU,parsePattern:hU,valueCallback:n=>parseInt(n,10)}),era:gl({matchPatterns:fU,defaultMatchWidth:"wide",parsePatterns:pU,defaultParseWidth:"any"}),quarter:gl({matchPatterns:mU,defaultMatchWidth:"wide",parsePatterns:gU,defaultParseWidth:"any",valueCallback:n=>n+1}),month:gl({matchPatterns:yU,defaultMatchWidth:"wide",parsePatterns:vU,defaultParseWidth:"any"}),day:gl({matchPatterns:TU,defaultMatchWidth:"wide",parsePatterns:wU,defaultParseWidth:"any"}),dayPeriod:gl({matchPatterns:bU,defaultMatchWidth:"any",parsePatterns:kU,defaultParseWidth:"any"})}});var Av,UC=v(()=>{CC();_C();PC();NC();HC();Av={code:"en-US",formatDistance:DC,formatLong:MC,formatRelative:AC,localize:RC,match:BC,options:{weekStartsOn:0,firstWeekContainsDate:1}}});var WC=v(()=>{UC()});function $C(n,e){let t=De(n,e==null?void 0:e.in);return dD(t,Mv(t))+1}var Pv=v(()=>{kv();_v();_t()});function jC(n,e){let t=De(n,e==null?void 0:e.in),r=+za(t)-+uD(t);return Math.round(r/gp)+1}var Iv=v(()=>{ul();sd();Ev();_t()});function kp(n,e){var d,u,h,f,p,m,g,y;let t=De(n,e==null?void 0:e.in),r=t.getFullYear(),s=An(),i=(y=(g=(f=(h=e==null?void 0:e.firstWeekContainsDate)!=null?h:(u=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)!=null?f:s.firstWeekContainsDate)!=null?g:(m=(p=s.locale)==null?void 0:p.options)==null?void 0:m.firstWeekContainsDate)!=null?y:1,a=Et((e==null?void 0:e.in)||n,0);a.setFullYear(r+1,0,i),a.setHours(0,0,0,0);let o=kr(a,e),l=Et((e==null?void 0:e.in)||n,0);l.setFullYear(r,0,i),l.setHours(0,0,0,0);let c=kr(l,e);return+t>=+o?r+1:+t>=+c?r:r-1}var Ep=v(()=>{fl();Is();pl();_t()});function VC(n,e){var o,l,c,d,u,h,f,p;let t=An(),r=(p=(f=(d=(c=e==null?void 0:e.firstWeekContainsDate)!=null?c:(l=(o=e==null?void 0:e.locale)==null?void 0:o.options)==null?void 0:l.firstWeekContainsDate)!=null?d:t.firstWeekContainsDate)!=null?f:(h=(u=t.locale)==null?void 0:u.options)==null?void 0:h.firstWeekContainsDate)!=null?p:1,s=kp(n,e),i=Et((e==null?void 0:e.in)||n,0);return i.setFullYear(s,0,r),i.setHours(0,0,0,0),kr(i,e)}var Rv=v(()=>{fl();Is();Ep();pl()});function YC(n,e){let t=De(n,e==null?void 0:e.in),r=+kr(t,e)-+VC(t,e);return Math.round(r/gp)+1}var Nv=v(()=>{ul();pl();Rv();_t()});function Xe(n,e){let t=n<0?"-":"",r=Math.abs(n).toString().padStart(e,"0");return t+r}var Ov=v(()=>{});var ci,zC=v(()=>{Ov();ci={y(n,e){let t=n.getFullYear(),r=t>0?t:1-t;return Xe(e==="yy"?r%100:r,e.length)},M(n,e){let t=n.getMonth();return e==="M"?String(t+1):Xe(t+1,2)},d(n,e){return Xe(n.getDate(),e.length)},a(n,e){let t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return Xe(n.getHours()%12||12,e.length)},H(n,e){return Xe(n.getHours(),e.length)},m(n,e){return Xe(n.getMinutes(),e.length)},s(n,e){return Xe(n.getSeconds(),e.length)},S(n,e){let t=e.length,r=n.getMilliseconds(),s=Math.trunc(r*Math.pow(10,t-3));return Xe(s,e.length)}}});function qC(n,e=""){let t=n>0?"-":"+",r=Math.abs(n),s=Math.trunc(r/60),i=r%60;return i===0?t+String(s):t+String(s)+e+Xe(i,2)}function GC(n,e){return n%60===0?(n>0?"-":"+")+Xe(Math.abs(n)/60,2):Ga(n,e)}function Ga(n,e=""){let t=n>0?"-":"+",r=Math.abs(n),s=Xe(Math.trunc(r/60),2),i=Xe(r%60,2);return t+s+e+i}var yl,Lv,QC=v(()=>{Pv();Iv();vp();Nv();Ep();Ov();zC();yl={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Lv={G:function(n,e,t){let r=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(r,{width:"abbreviated"});case"GGGGG":return t.era(r,{width:"narrow"});case"GGGG":default:return t.era(r,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){let r=n.getFullYear(),s=r>0?r:1-r;return t.ordinalNumber(s,{unit:"year"})}return ci.y(n,e)},Y:function(n,e,t,r){let s=kp(n,r),i=s>0?s:1-s;if(e==="YY"){let a=i%100;return Xe(a,2)}return e==="Yo"?t.ordinalNumber(i,{unit:"year"}):Xe(i,e.length)},R:function(n,e){let t=yp(n);return Xe(t,e.length)},u:function(n,e){let t=n.getFullYear();return Xe(t,e.length)},Q:function(n,e,t){let r=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(r);case"QQ":return Xe(r,2);case"Qo":return t.ordinalNumber(r,{unit:"quarter"});case"QQQ":return t.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(r,{width:"wide",context:"formatting"})}},q:function(n,e,t){let r=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(r);case"qq":return Xe(r,2);case"qo":return t.ordinalNumber(r,{unit:"quarter"});case"qqq":return t.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(r,{width:"wide",context:"standalone"})}},M:function(n,e,t){let r=n.getMonth();switch(e){case"M":case"MM":return ci.M(n,e);case"Mo":return t.ordinalNumber(r+1,{unit:"month"});case"MMM":return t.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(r,{width:"wide",context:"formatting"})}},L:function(n,e,t){let r=n.getMonth();switch(e){case"L":return String(r+1);case"LL":return Xe(r+1,2);case"Lo":return t.ordinalNumber(r+1,{unit:"month"});case"LLL":return t.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(r,{width:"wide",context:"standalone"})}},w:function(n,e,t,r){let s=YC(n,r);return e==="wo"?t.ordinalNumber(s,{unit:"week"}):Xe(s,e.length)},I:function(n,e,t){let r=jC(n);return e==="Io"?t.ordinalNumber(r,{unit:"week"}):Xe(r,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):ci.d(n,e)},D:function(n,e,t){let r=$C(n);return e==="Do"?t.ordinalNumber(r,{unit:"dayOfYear"}):Xe(r,e.length)},E:function(n,e,t){let r=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(r,{width:"short",context:"formatting"});case"EEEE":default:return t.day(r,{width:"wide",context:"formatting"})}},e:function(n,e,t,r){let s=n.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return Xe(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(s,{width:"short",context:"formatting"});case"eeee":default:return t.day(s,{width:"wide",context:"formatting"})}},c:function(n,e,t,r){let s=n.getDay(),i=(s-r.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return Xe(i,e.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(s,{width:"narrow",context:"standalone"});case"cccccc":return t.day(s,{width:"short",context:"standalone"});case"cccc":default:return t.day(s,{width:"wide",context:"standalone"})}},i:function(n,e,t){let r=n.getDay(),s=r===0?7:r;switch(e){case"i":return String(s);case"ii":return Xe(s,e.length);case"io":return t.ordinalNumber(s,{unit:"day"});case"iii":return t.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(r,{width:"short",context:"formatting"});case"iiii":default:return t.day(r,{width:"wide",context:"formatting"})}},a:function(n,e,t){let s=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(n,e,t){let r=n.getHours(),s;switch(r===12?s=yl.noon:r===0?s=yl.midnight:s=r/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(n,e,t){let r=n.getHours(),s;switch(r>=17?s=yl.evening:r>=12?s=yl.afternoon:r>=4?s=yl.morning:s=yl.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let r=n.getHours()%12;return r===0&&(r=12),t.ordinalNumber(r,{unit:"hour"})}return ci.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):ci.H(n,e)},K:function(n,e,t){let r=n.getHours()%12;return e==="Ko"?t.ordinalNumber(r,{unit:"hour"}):Xe(r,e.length)},k:function(n,e,t){let r=n.getHours();return r===0&&(r=24),e==="ko"?t.ordinalNumber(r,{unit:"hour"}):Xe(r,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):ci.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):ci.s(n,e)},S:function(n,e){return ci.S(n,e)},X:function(n,e,t){let r=n.getTimezoneOffset();if(r===0)return"Z";switch(e){case"X":return GC(r);case"XXXX":case"XX":return Ga(r);case"XXXXX":case"XXX":default:return Ga(r,":")}},x:function(n,e,t){let r=n.getTimezoneOffset();switch(e){case"x":return GC(r);case"xxxx":case"xx":return Ga(r);case"xxxxx":case"xxx":default:return Ga(r,":")}},O:function(n,e,t){let r=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+qC(r,":");case"OOOO":default:return"GMT"+Ga(r,":")}},z:function(n,e,t){let r=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+qC(r,":");case"zzzz":default:return"GMT"+Ga(r,":")}},t:function(n,e,t){let r=Math.trunc(+n/1e3);return Xe(r,e.length)},T:function(n,e,t){return Xe(+n,e.length)}}});var KC,ZC,EU,JC,XC=v(()=>{KC=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},ZC=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},EU=(n,e)=>{let t=n.match(/(P+)(p+)?/)||[],r=t[1],s=t[2];if(!s)return KC(n,e);let i;switch(r){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",KC(r,e)).replace("{{time}}",ZC(s,e))},JC={p:ZC,P:EU}});function ex(n){return SU.test(n)}function tx(n){return DU.test(n)}function rx(n,e,t){let r=xU(n,e,t);if(console.warn(r),CU.includes(n))throw new RangeError(r)}function xU(n,e,t){let r=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${r} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}var SU,DU,CU,sx=v(()=>{SU=/^D+$/,DU=/^Y+$/,CU=["D","DD","YY","YYYY"]});function x(n,e,t){var d,u,h,f,p,m,g,y,T,w,b,S,k,D,M,_,W,j;let r=An(),s=(u=(d=t==null?void 0:t.locale)!=null?d:r.locale)!=null?u:Av,i=(w=(T=(m=(p=t==null?void 0:t.firstWeekContainsDate)!=null?p:(f=(h=t==null?void 0:t.locale)==null?void 0:h.options)==null?void 0:f.firstWeekContainsDate)!=null?m:r.firstWeekContainsDate)!=null?T:(y=(g=r.locale)==null?void 0:g.options)==null?void 0:y.firstWeekContainsDate)!=null?w:1,a=(j=(W=(D=(k=t==null?void 0:t.weekStartsOn)!=null?k:(S=(b=t==null?void 0:t.locale)==null?void 0:b.options)==null?void 0:S.weekStartsOn)!=null?D:r.weekStartsOn)!=null?W:(_=(M=r.locale)==null?void 0:M.options)==null?void 0:_.weekStartsOn)!=null?j:0,o=De(n,t==null?void 0:t.in);if(!Lr(o))throw new RangeError("Invalid time value");let l=e.match(_U).map(R=>{let O=R[0];if(O==="p"||O==="P"){let C=JC[O];return C(R,s.formatLong)}return R}).join("").match(MU).map(R=>{if(R==="''")return{isToken:!1,value:"'"};let O=R[0];if(O==="'")return{isToken:!1,value:RU(R)};if(Lv[O])return{isToken:!0,value:R};if(O.match(IU))throw new RangeError("Format string contains an unescaped latin alphabet character `"+O+"`");return{isToken:!1,value:R}});s.localize.preprocessor&&(l=s.localize.preprocessor(o,l));let c={firstWeekContainsDate:i,weekStartsOn:a,locale:s};return l.map(R=>{if(!R.isToken)return R.value;let O=R.value;(!(t!=null&&t.useAdditionalWeekYearTokens)&&tx(O)||!(t!=null&&t.useAdditionalDayOfYearTokens)&&ex(O))&&rx(O,e,String(n));let C=Lv[O[0]];return C(o,O,s.localize,c)}).join("")}function RU(n){let e=n.match(AU);return e?e[1].replace(PU,"'"):n}var MU,_U,AU,PU,IU,nx=v(()=>{WC();fl();QC();XC();sx();Dv();_t();MU=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,_U=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,AU=/^'([^]*?)'?$/,PU=/''/g,IU=/[a-zA-Z]/});var ix=v(()=>{});var ax=v(()=>{});var ox=v(()=>{});var lx=v(()=>{});var cx=v(()=>{});var dx=v(()=>{});var ux=v(()=>{});var hx=v(()=>{});var fx=v(()=>{});var px=v(()=>{});var mx=v(()=>{});var gx=v(()=>{});var yx=v(()=>{});var vx=v(()=>{});var Tx=v(()=>{});var wx=v(()=>{});var bx=v(()=>{});var kx=v(()=>{});var Ex=v(()=>{});var Sx=v(()=>{});var Dx=v(()=>{});var Cx=v(()=>{});var xx=v(()=>{});var Mx=v(()=>{});var _x=v(()=>{});var Ax=v(()=>{});var Px=v(()=>{});var Ix=v(()=>{});var Rx=v(()=>{});var Nx=v(()=>{});var Ox=v(()=>{});var Lx=v(()=>{});var Fx=v(()=>{});var Bx=v(()=>{});var Hx=v(()=>{});var Ux=v(()=>{});var Wx=v(()=>{});var $x=v(()=>{});var jx=v(()=>{});var Vx=v(()=>{});var Yx=v(()=>{});function Sp(n,e){return+De(n)<+De(e)}var zx=v(()=>{_t()});var qx=v(()=>{});var Gx=v(()=>{});var Qx=v(()=>{});var Kx=v(()=>{});var Zx=v(()=>{});var Jx=v(()=>{});var Xx=v(()=>{});var e0=v(()=>{});var t0=v(()=>{});var r0=v(()=>{});var s0=v(()=>{});var n0=v(()=>{});var i0=v(()=>{});var a0=v(()=>{});var o0=v(()=>{});var l0=v(()=>{});var c0=v(()=>{});var d0=v(()=>{});var u0=v(()=>{});var h0=v(()=>{});var f0=v(()=>{});var p0=v(()=>{});var m0=v(()=>{});var g0=v(()=>{});var y0=v(()=>{});var v0=v(()=>{});var T0=v(()=>{});var w0=v(()=>{});var b0=v(()=>{});var k0=v(()=>{});var E0=v(()=>{});var S0=v(()=>{});var D0=v(()=>{});var C0=v(()=>{});var x0=v(()=>{});var M0=v(()=>{});var _0=v(()=>{});var A0=v(()=>{});var P0=v(()=>{});var I0=v(()=>{});function vl(n,e,t){return Or(n,-e,t)}var R0=v(()=>{rd()});var N0=v(()=>{});var O0=v(()=>{});var L0=v(()=>{});var F0=v(()=>{});var B0=v(()=>{});var H0=v(()=>{});var U0=v(()=>{});var W0=v(()=>{});var $0=v(()=>{});var j0=v(()=>{});var V0=v(()=>{});var Y0=v(()=>{});var z0=v(()=>{});var q0=v(()=>{});var G0=v(()=>{});var Q0=v(()=>{});var K0=v(()=>{});var Z0=v(()=>{});var J0=v(()=>{});var X0=v(()=>{});var eM=v(()=>{});var tM=v(()=>{});var rM=v(()=>{});var sM=v(()=>{});var nM=v(()=>{});function Qa(n,e){var c;let t=()=>Et(e==null?void 0:e.in,NaN),r=(c=e==null?void 0:e.additionalDigits)!=null?c:2,s=FU(n),i;if(s.date){let d=BU(s.date,r);i=HU(d.restDateString,d.year)}if(!i||isNaN(+i))return t();let a=+i,o=0,l;if(s.time&&(o=UU(s.time),isNaN(o)))return t();if(s.timezone){if(l=WU(s.timezone),isNaN(l))return t()}else{let d=new Date(a+o),u=De(0,e==null?void 0:e.in);return u.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),u.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),u}return De(a+o+l,e==null?void 0:e.in)}function FU(n){let e={},t=n.split(Dp.dateTimeDelimiter),r;if(t.length>2)return e;if(/:/.test(t[0])?r=t[0]:(e.date=t[0],r=t[1],Dp.timeZoneDelimiter.test(e.date)&&(e.date=n.split(Dp.timeZoneDelimiter)[0],r=n.substr(e.date.length,n.length))),r){let s=Dp.timezone.exec(r);s?(e.time=r.replace(s[1],""),e.timezone=s[1]):e.time=r}return e}function BU(n,e){let t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),r=n.match(t);if(!r)return{year:NaN,restDateString:""};let s=r[1]?parseInt(r[1]):null,i=r[2]?parseInt(r[2]):null;return{year:i===null?s:i*100,restDateString:n.slice((r[1]||r[2]).length)}}function HU(n,e){if(e===null)return new Date(NaN);let t=n.match(NU);if(!t)return new Date(NaN);let r=!!t[4],s=id(t[1]),i=id(t[2])-1,a=id(t[3]),o=id(t[4]),l=id(t[5])-1;if(r)return zU(e,o,l)?$U(e,o,l):new Date(NaN);{let c=new Date(0);return!VU(e,i,a)||!YU(e,s)?new Date(NaN):(c.setUTCFullYear(e,i,Math.max(s,a)),c)}}function id(n){return n?parseInt(n):1}function UU(n){let e=n.match(OU);if(!e)return NaN;let t=Fv(e[1]),r=Fv(e[2]),s=Fv(e[3]);return qU(t,r,s)?t*gv+r*mv+s*1e3:NaN}function Fv(n){return n&&parseFloat(n.replace(",","."))||0}function WU(n){if(n==="Z")return 0;let e=n.match(LU);if(!e)return 0;let t=e[1]==="+"?-1:1,r=parseInt(e[2]),s=e[3]&&parseInt(e[3])||0;return GU(r,s)?t*(r*gv+s*mv):NaN}function $U(n,e,t){let r=new Date(0);r.setUTCFullYear(n,0,4);let s=r.getUTCDay()||7,i=(e-1)*7+t+1-s;return r.setUTCDate(r.getUTCDate()+i),r}function iM(n){return n%400===0||n%4===0&&n%100!==0}function VU(n,e,t){return e>=0&&e<=11&&t>=1&&t<=(jU[e]||(iM(n)?29:28))}function YU(n,e){return e>=1&&e<=(iM(n)?366:365)}function zU(n,e,t){return e>=1&&e<=53&&t>=0&&t<=6}function qU(n,e,t){return n===24?e===0&&t===0:t>=0&&t<60&&e>=0&&e<60&&n>=0&&n<25}function GU(n,e){return e>=0&&e<=59}var Dp,NU,OU,LU,jU,aM=v(()=>{ul();Is();_t();Dp={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},NU=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,OU=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,LU=/^([+-])(\d{2})(?::?(\d{2}))?$/;jU=[31,null,31,30,31,30,31,31,30,31,30,31]});var oM=v(()=>{});var lM=v(()=>{});var cM=v(()=>{});var dM=v(()=>{});var uM=v(()=>{});var hM=v(()=>{});var fM=v(()=>{});var pM=v(()=>{});var mM=v(()=>{});var gM=v(()=>{});var yM=v(()=>{});var vM=v(()=>{});var TM=v(()=>{});var wM=v(()=>{});var bM=v(()=>{});var kM=v(()=>{});var EM=v(()=>{});var SM=v(()=>{});var DM=v(()=>{});var CM=v(()=>{});var xM=v(()=>{});var MM=v(()=>{});var _M=v(()=>{});var AM=v(()=>{});var PM=v(()=>{});var IM=v(()=>{});var RM=v(()=>{});var NM=v(()=>{});var OM=v(()=>{});var LM=v(()=>{});var FM=v(()=>{});var BM=v(()=>{});var HM=v(()=>{});var UM=v(()=>{});var WM=v(()=>{});var $M=v(()=>{});var jM=v(()=>{});var VM=v(()=>{});var YM=v(()=>{});var zM=v(()=>{});var qM=v(()=>{});var GM=v(()=>{});var QM=v(()=>{});var KM=v(()=>{});var ZM=v(()=>{});var JM=v(()=>{});var At=v(()=>{rD();aD();rd();lD();fD();oD();pD();Tv();mD();gD();vD();TD();wD();ED();SD();DD();CD();xD();Is();MD();_D();ID();kv();RD();ND();OD();FD();BD();HD();UD();WD();jD();VD();YD();KD();ZD();JD();XD();eC();tC();rC();sC();nC();aC();oC();lC();dC();hC();fC();qD();pC();mC();yC();vC();TC();GD();wC();bC();kC();EC();gC();uC();SC();nx();ix();ax();ox();lx();cx();dx();ux();hx();fx();px();mx();gx();yx();vx();Pv();Tx();bx();kx();Ex();Sx();Dx();Iv();vp();Cx();xx();Mx();_x();Ax();LD();Px();Ix();Rx();Nv();Nx();Ep();Lx();Fx();Bx();Hx();Ux();Wx();$x();jx();Vx();Yx();zx();Sv();qx();Gx();Qx();Kx();Zx();QD();wx();n0();i0();a0();AD();l0();d0();u0();f0();p0();m0();y0();c0();v0();sD();nD();T0();w0();b0();k0();E0();S0();D0();C0();x0();M0();_0();A0();Dv();P0();iD();I0();N0();O0();F0();B0();Ox();H0();L0();U0();W0();bD();$0();j0();V0();Y0();kD();z0();q0();G0();Q0();K0();Z0();J0();X0();eM();tM();rM();sM();nM();s0();aM();oM();lM();cM();dM();uM();hM();fM();pM();mM();gM();yM();vM();TM();wM();bM();kM();SM();DM();t0();CM();xM();MM();r0();e0();hD();_M();AM();EM();PM();IM();Xx();RM();NM();wp();OM();o0();sd();Ev();h0();cC();iC();g0();LM();FM();pl();Rv();_v();BM();UM();WM();R0();$M();$D();jM();VM();HM();YM();zM();qM();GM();_t();Jx();QM();KM();ZM();JM()});var dn=hp(_e=>{"use strict";Object.defineProperty(_e,"__esModule",{value:!0});var St=require("obsidian"),Bv="YYYY-MM-DD",Hv="gggg-[W]ww",XM="YYYY-MM",e_="YYYY-[Q]Q",t_="YYYY";function ad(n){var t,r;let e=window.app.plugins.getPlugin("periodic-notes");return e&&((r=(t=e.settings)==null?void 0:t[n])==null?void 0:r.enabled)}function od(){var n,e,t,r;try{let{internalPlugins:s,plugins:i}=window.app;if(ad("daily")){let{format:c,folder:d,template:u}=((e=(n=i.getPlugin("periodic-notes"))==null?void 0:n.settings)==null?void 0:e.daily)||{};return{format:c||Bv,folder:(d==null?void 0:d.trim())||"",template:(u==null?void 0:u.trim())||""}}let{folder:a,format:o,template:l}=((r=(t=s.getPluginById("daily-notes"))==null?void 0:t.instance)==null?void 0:r.options)||{};return{format:o||Bv,folder:(a==null?void 0:a.trim())||"",template:(l==null?void 0:l.trim())||""}}catch(s){console.info("No custom daily note settings found!",s)}}function ld(){var n,e,t,r,s,i,a;try{let o=window.app.plugins,l=(n=o.getPlugin("calendar"))==null?void 0:n.options,c=(t=(e=o.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.weekly;if(ad("weekly"))return{format:c.format||Hv,folder:((r=c.folder)==null?void 0:r.trim())||"",template:((s=c.template)==null?void 0:s.trim())||""};let d=l||{};return{format:d.weeklyNoteFormat||Hv,folder:((i=d.weeklyNoteFolder)==null?void 0:i.trim())||"",template:((a=d.weeklyNoteTemplate)==null?void 0:a.trim())||""}}catch(o){console.info("No custom weekly note settings found!",o)}}function cd(){var e,t,r,s;let n=window.app.plugins;try{let i=ad("monthly")&&((t=(e=n.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.monthly)||{};return{format:i.format||XM,folder:((r=i.folder)==null?void 0:r.trim())||"",template:((s=i.template)==null?void 0:s.trim())||""}}catch(i){console.info("No custom monthly note settings found!",i)}}function dd(){var e,t,r,s;let n=window.app.plugins;try{let i=ad("quarterly")&&((t=(e=n.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.quarterly)||{};return{format:i.format||e_,folder:((r=i.folder)==null?void 0:r.trim())||"",template:((s=i.template)==null?void 0:s.trim())||""}}catch(i){console.info("No custom quarterly note settings found!",i)}}function ud(){var e,t,r,s;let n=window.app.plugins;try{let i=ad("yearly")&&((t=(e=n.getPlugin("periodic-notes"))==null?void 0:e.settings)==null?void 0:t.yearly)||{};return{format:i.format||t_,folder:((r=i.folder)==null?void 0:r.trim())||"",template:((s=i.template)==null?void 0:s.trim())||""}}catch(i){console.info("No custom yearly note settings found!",i)}}function r_(...n){let e=[];for(let r=0,s=n.length;r<s;r++)e=e.concat(n[r].split("/"));let t=[];for(let r=0,s=e.length;r<s;r++){let i=e[r];!i||i==="."||t.push(i)}return e[0]===""&&t.unshift(""),t.join("/")}function QU(n){let e=n.substring(n.lastIndexOf("/")+1);return e.lastIndexOf(".")!=-1&&(e=e.substring(0,e.lastIndexOf("."))),e}async function KU(n){let e=n.replace(/\\/g,"/").split("/");if(e.pop(),e.length){let t=r_(...e);window.app.vault.getAbstractFileByPath(t)||await window.app.vault.createFolder(t)}}async function hd(n,e){e.endsWith(".md")||(e+=".md");let t=St.normalizePath(r_(n,e));return await KU(t),t}async function Tl(n){let{metadataCache:e,vault:t}=window.app,r=St.normalizePath(n);if(r==="/")return Promise.resolve(["",null]);try{let s=e.getFirstLinkpathDest(r,""),i=await t.cachedRead(s),a=window.app.foldManager.load(s);return[i,a]}catch(s){return console.error(`Failed to read the daily note template '${r}'`,s),new St.Notice("Failed to read the daily note template"),["",null]}}function cn(n,e="day"){let t=n.clone().startOf(e).format();return`${e}-${t}`}function s_(n){return n.replace(/\[[^\]]*\]/g,"")}function ZU(n,e){if(e==="week"){let t=s_(n);return/w{1,2}/i.test(t)&&(/M{1,4}/.test(t)||/D{1,4}/.test(t))}return!1}function wl(n,e){return n_(n.basename,e)}function JU(n,e){return n_(QU(n),e)}function n_(n,e){let r={day:od,week:ld,month:cd,quarter:dd,year:ud}[e]().format.split("/").pop(),s=window.moment(n,r,!0);if(!s.isValid())return null;if(ZU(r,e)&&e==="week"){let i=s_(r);if(/w{1,2}/i.test(i))return window.moment(n,r.replace(/M{1,4}/g,"").replace(/D{1,4}/g,""),!1)}return s}var Uv=class extends Error{};async function i_(n){let e=window.app,{vault:t}=e,r=window.moment,{template:s,format:i,folder:a}=od(),[o,l]=await Tl(s),c=n.format(i),d=await hd(a,c);try{let u=await t.create(d,o.replace(/{{\s*date\s*}}/gi,c).replace(/{{\s*time\s*}}/gi,r().format("HH:mm")).replace(/{{\s*title\s*}}/gi,c).replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(h,f,p,m,g,y)=>{let T=r(),w=n.clone().set({hour:T.get("hour"),minute:T.get("minute"),second:T.get("second")});return p&&w.add(parseInt(m,10),g),y?w.format(y.substring(1).trim()):w.format(i)}).replace(/{{\s*yesterday\s*}}/gi,n.clone().subtract(1,"day").format(i)).replace(/{{\s*tomorrow\s*}}/gi,n.clone().add(1,"d").format(i)));return e.foldManager.save(u,l),u}catch(u){console.error(`Failed to create file: '${d}'`,u),new St.Notice("Unable to create new file.")}}function XU(n,e){var t;return(t=e[cn(n,"day")])!=null?t:null}function eW(){let{vault:n}=window.app,{folder:e}=od(),t=n.getAbstractFileByPath(St.normalizePath(e));if(!t)throw new Uv("Failed to find daily notes folder");let r={};return St.Vault.recurseChildren(t,s=>{if(s instanceof St.TFile){let i=wl(s,"day");if(i){let a=cn(i,"day");r[a]=s}}}),r}var Wv=class extends Error{};function tW(){let{moment:n}=window,e=n.localeData()._week.dow,t=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];for(;e;)t.push(t.shift()),e--;return t}function rW(n){return tW().indexOf(n.toLowerCase())}async function a_(n){let{vault:e}=window.app,{template:t,format:r,folder:s}=ld(),[i,a]=await Tl(t),o=n.format(r),l=await hd(s,o);try{let c=await e.create(l,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,f,p,m)=>{let g=window.moment(),y=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&y.add(parseInt(f,10),p),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*title\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*(sunday|monday|tuesday|wednesday|thursday|friday|saturday)\s*:(.*?)}}/gi,(d,u,h)=>{let f=rW(u);return n.weekday(f).format(h.trim())}));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new St.Notice("Unable to create new file.")}}function sW(n,e){var t;return(t=e[cn(n,"week")])!=null?t:null}function nW(){let n={};if(!l_())return n;let{vault:e}=window.app,{folder:t}=ld(),r=e.getAbstractFileByPath(St.normalizePath(t));if(!r)throw new Wv("Failed to find weekly notes folder");return St.Vault.recurseChildren(r,s=>{if(s instanceof St.TFile){let i=wl(s,"week");if(i){let a=cn(i,"week");n[a]=s}}}),n}var $v=class extends Error{};async function o_(n){let{vault:e}=window.app,{template:t,format:r,folder:s}=cd(),[i,a]=await Tl(t),o=n.format(r),l=await hd(s,o);try{let c=await e.create(l,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,f,p,m)=>{let g=window.moment(),y=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&y.add(parseInt(f,10),p),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new St.Notice("Unable to create new file.")}}function iW(n,e){var t;return(t=e[cn(n,"month")])!=null?t:null}function aW(){let n={};if(!c_())return n;let{vault:e}=window.app,{folder:t}=cd(),r=e.getAbstractFileByPath(St.normalizePath(t));if(!r)throw new $v("Failed to find monthly notes folder");return St.Vault.recurseChildren(r,s=>{if(s instanceof St.TFile){let i=wl(s,"month");if(i){let a=cn(i,"month");n[a]=s}}}),n}var jv=class extends Error{};async function oW(n){let{vault:e}=window.app,{template:t,format:r,folder:s}=dd(),[i,a]=await Tl(t),o=n.format(r),l=await hd(s,o);try{let c=await e.create(l,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,f,p,m)=>{let g=window.moment(),y=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&y.add(parseInt(f,10),p),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new St.Notice("Unable to create new file.")}}function lW(n,e){var t;return(t=e[cn(n,"quarter")])!=null?t:null}function cW(){let n={};if(!d_())return n;let{vault:e}=window.app,{folder:t}=dd(),r=e.getAbstractFileByPath(St.normalizePath(t));if(!r)throw new jv("Failed to find quarterly notes folder");return St.Vault.recurseChildren(r,s=>{if(s instanceof St.TFile){let i=wl(s,"quarter");if(i){let a=cn(i,"quarter");n[a]=s}}}),n}var Vv=class extends Error{};async function dW(n){let{vault:e}=window.app,{template:t,format:r,folder:s}=ud(),[i,a]=await Tl(t),o=n.format(r),l=await hd(s,o);try{let c=await e.create(l,i.replace(/{{\s*(date|time)\s*(([+-]\d+)([yqmwdhs]))?\s*(:.+?)?}}/gi,(d,u,h,f,p,m)=>{let g=window.moment(),y=n.clone().set({hour:g.get("hour"),minute:g.get("minute"),second:g.get("second")});return h&&y.add(parseInt(f,10),p),m?y.format(m.substring(1).trim()):y.format(r)}).replace(/{{\s*date\s*}}/gi,o).replace(/{{\s*time\s*}}/gi,window.moment().format("HH:mm")).replace(/{{\s*title\s*}}/gi,o));return window.app.foldManager.save(c,a),c}catch(c){console.error(`Failed to create file: '${l}'`,c),new St.Notice("Unable to create new file.")}}function uW(n,e){var t;return(t=e[cn(n,"year")])!=null?t:null}function hW(){let n={};if(!u_())return n;let{vault:e}=window.app,{folder:t}=ud(),r=e.getAbstractFileByPath(St.normalizePath(t));if(!r)throw new Vv("Failed to find yearly notes folder");return St.Vault.recurseChildren(r,s=>{if(s instanceof St.TFile){let i=wl(s,"year");if(i){let a=cn(i,"year");n[a]=s}}}),n}function fW(){var r,s;let{app:n}=window,e=n.internalPlugins.plugins["daily-notes"];if(e&&e.enabled)return!0;let t=n.plugins.getPlugin("periodic-notes");return t&&((s=(r=t.settings)==null?void 0:r.daily)==null?void 0:s.enabled)}function l_(){var t,r;let{app:n}=window;if(n.plugins.getPlugin("calendar"))return!0;let e=n.plugins.getPlugin("periodic-notes");return e&&((r=(t=e.settings)==null?void 0:t.weekly)==null?void 0:r.enabled)}function c_(){var t,r;let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&((r=(t=e.settings)==null?void 0:t.monthly)==null?void 0:r.enabled)}function d_(){var t,r;let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&((r=(t=e.settings)==null?void 0:t.quarterly)==null?void 0:r.enabled)}function u_(){var t,r;let{app:n}=window,e=n.plugins.getPlugin("periodic-notes");return e&&((r=(t=e.settings)==null?void 0:t.yearly)==null?void 0:r.enabled)}function pW(n){let e={day:od,week:ld,month:cd,quarter:dd,year:ud}[n];return e()}function mW(n,e){return{day:i_,month:o_,week:a_}[n](e)}_e.DEFAULT_DAILY_NOTE_FORMAT=Bv;_e.DEFAULT_MONTHLY_NOTE_FORMAT=XM;_e.DEFAULT_QUARTERLY_NOTE_FORMAT=e_;_e.DEFAULT_WEEKLY_NOTE_FORMAT=Hv;_e.DEFAULT_YEARLY_NOTE_FORMAT=t_;_e.appHasDailyNotesPluginLoaded=fW;_e.appHasMonthlyNotesPluginLoaded=c_;_e.appHasQuarterlyNotesPluginLoaded=d_;_e.appHasWeeklyNotesPluginLoaded=l_;_e.appHasYearlyNotesPluginLoaded=u_;_e.createDailyNote=i_;_e.createMonthlyNote=o_;_e.createPeriodicNote=mW;_e.createQuarterlyNote=oW;_e.createWeeklyNote=a_;_e.createYearlyNote=dW;_e.getAllDailyNotes=eW;_e.getAllMonthlyNotes=aW;_e.getAllQuarterlyNotes=cW;_e.getAllWeeklyNotes=nW;_e.getAllYearlyNotes=hW;_e.getDailyNote=XU;_e.getDailyNoteSettings=od;_e.getDateFromFile=wl;_e.getDateFromPath=JU;_e.getDateUID=cn;_e.getMonthlyNote=iW;_e.getMonthlyNoteSettings=cd;_e.getPeriodicNoteSettings=pW;_e.getQuarterlyNote=lW;_e.getQuarterlyNoteSettings=dd;_e.getTemplateInfo=Tl;_e.getWeeklyNote=sW;_e.getWeeklyNoteSettings=ld;_e.getYearlyNote=uW;_e.getYearlyNoteSettings=ud});var v_={};nt(v_,{DEFAULT_CALENDAR_VIEW_SETTINGS:()=>m_,DEFAULT_FIELD_MAPPING:()=>Cp,DEFAULT_ICS_INTEGRATION_SETTINGS:()=>g_,DEFAULT_PRIORITIES:()=>f_,DEFAULT_PROJECT_AUTOSUGGEST:()=>y_,DEFAULT_SETTINGS:()=>Yr,DEFAULT_STATUSES:()=>h_,DEFAULT_TASK_CREATION_DEFAULTS:()=>p_});var Cp,h_,f_,p_,m_,g_,y_,Yr,xp=v(()=>{Cp={title:"title",status:"status",priority:"priority",due:"due",scheduled:"scheduled",contexts:"contexts",projects:"projects",timeEstimate:"timeEstimate",completedDate:"completedDate",dateCreated:"dateCreated",dateModified:"dateModified",recurrence:"recurrence",archiveTag:"archived",timeEntries:"timeEntries",completeInstances:"complete_instances",pomodoros:"pomodoros",icsEventId:"icsEventId",icsEventTag:"ics_event",reminders:"reminders"},h_=[{id:"none",value:"none",label:"None",color:"#cccccc",isCompleted:!1,order:0,autoArchive:!1,autoArchiveDelay:5},{id:"open",value:"open",label:"Open",color:"#808080",isCompleted:!1,order:1,autoArchive:!1,autoArchiveDelay:5},{id:"in-progress",value:"in-progress",label:"In progress",color:"#0066cc",isCompleted:!1,order:2,autoArchive:!1,autoArchiveDelay:5},{id:"done",value:"done",label:"Done",color:"#00aa00",isCompleted:!0,order:3,autoArchive:!1,autoArchiveDelay:5}],f_=[{id:"none",value:"none",label:"None",color:"#cccccc",weight:0},{id:"low",value:"low",label:"Low",color:"#00aa00",weight:1},{id:"normal",value:"normal",label:"Normal",color:"#ffaa00",weight:2},{id:"high",value:"high",label:"High",color:"#ff0000",weight:3}],p_={defaultContexts:"",defaultTags:"",defaultProjects:"",useParentNoteAsProject:!1,defaultTimeEstimate:0,defaultRecurrence:"none",defaultDueDate:"none",defaultScheduledDate:"today",bodyTemplate:"",useBodyTemplate:!1,defaultReminders:[]},m_={defaultView:"dayGridMonth",customDayCount:3,slotDuration:"00:30:00",slotMinTime:"00:00:00",slotMaxTime:"24:00:00",scrollTime:"08:00:00",firstDay:1,timeFormat:"24",showWeekends:!0,locale:"",defaultShowScheduled:!0,defaultShowDue:!0,defaultShowDueWhenScheduled:!0,defaultShowTimeEntries:!1,defaultShowRecurring:!0,defaultShowICSEvents:!0,enableTimeblocking:!1,defaultShowTimeblocks:!0,nowIndicator:!0,selectMirror:!0,weekNumbers:!1,showTodayHighlight:!0},g_={defaultNoteTemplate:"",defaultNoteFolder:"",icsNoteFilenameFormat:"title",customICSNoteFilenameTemplate:"{title}",enableAutoExport:!1,autoExportPath:"tasknotes-calendar.ics",autoExportInterval:60},y_={enableFuzzy:!1,rows:["{title|n(Title)}","{aliases|n(Aliases)}","{file.path|n(Path)}"],showAdvanced:!1,requiredTags:[],includeFolders:[]},Yr={tasksFolder:"TaskNotes/Tasks",moveArchivedTasks:!1,archiveFolder:"TaskNotes/Archive",taskTag:"task",taskIdentificationMethod:"tag",taskPropertyName:"",taskPropertyValue:"",excludedFolders:"",defaultTaskPriority:"normal",defaultTaskStatus:"open",taskOrgFiltersCollapsed:!1,taskFilenameFormat:"zettel",storeTitleInFilename:!0,customFilenameTemplate:"{title}",taskCreationDefaults:p_,calendarViewSettings:m_,pomodoroWorkDuration:25,pomodoroShortBreakDuration:5,pomodoroLongBreakDuration:15,pomodoroLongBreakInterval:4,pomodoroAutoStartBreaks:!0,pomodoroAutoStartWork:!1,pomodoroNotifications:!0,pomodoroSoundEnabled:!0,pomodoroSoundVolume:50,pomodoroStorageLocation:"plugin",enableTaskLinkOverlay:!0,enableInstantTaskConvert:!0,useDefaultsOnInstantConvert:!0,enableNaturalLanguageInput:!0,nlpDefaultToScheduled:!0,nlpLanguage:"en",statusSuggestionTrigger:"*",singleClickAction:"edit",doubleClickAction:"openNote",projectAutosuggest:y_,inlineTaskConvertFolder:"{{currentNotePath}}",disableNoteIndexing:!1,suggestionDebounceMs:0,fieldMapping:Cp,customStatuses:h_,customPriorities:f_,recurrenceMigrated:!1,showTrackedTasksInStatusBar:!1,autoStopTimeTrackingOnComplete:!0,autoStopTimeTrackingNotification:!1,showProjectSubtasks:!0,showExpandableSubtasks:!0,projectSubtasksPosition:"bottom",subtaskChevronPosition:"right",viewsButtonAlignment:"right",hideCompletedFromOverdue:!0,icsIntegration:g_,savedViews:[],enableNotifications:!0,notificationType:"system",enableAPI:!1,apiPort:8080,apiAuthToken:"",webhooks:[],userFields:[],defaultVisibleProperties:["status","priority","due","scheduled","projects","contexts","tags"],enableBases:!0,maintainDueDateOffsetInRecurring:!1}});function yW(n){let e=[],t="",r=0;for(;r<n.length;){let s=n[r];if(s==="\\"&&r+1<n.length){t+=n[r+1],r+=2;continue}if(s==="|"){e.push(t.trim()),t="",r++;continue}t+=s,r++}return e.push(t.trim()),e.filter(s=>s.length>0)}function vW(n){return n.replace(/\\\|/g,"|").replace(/\\\)/g,")")}function Xi(n){let e=[];if(!n)return e;let t=/\{([^}]*)\}/g,r,s=0;for(;(r=t.exec(n))!==null;){let a=n.slice(s,r.index);a.length>0&&e.push({property:`literal:${a}`,showName:!1}),s=t.lastIndex;let o=r[1].trim();if(!o)continue;let l=yW(o);if(l.length===0)continue;let c=l[0];if(!c)throw new Error("Missing property name in token");let d={property:c,showName:!1};for(let u=1;u<l.length;u++){let h=l[u];h==="n"?d.showName=!0:h.startsWith("n(")&&h.endsWith(")")?(d.showName=!0,d.displayName=vW(h.slice(2,-1))):h==="s"&&(d.searchable=!0)}e.push(d)}let i=n.slice(s);return i.length>0&&e.push({property:`literal:${i}`,showName:!1}),e}var Pp=v(()=>{});function un(n){if(n==null)return[];let e=[],t="",r=0,s=null;for(let a=0;a<n.length;a++){let o=n[a],l=n[a+1];if(!s&&o==="["&&l==="["){r++,t+="[[",a++;continue}if(!s&&o==="]"&&l==="]"&&r>0){r--,t+="]]",a++;continue}if(!r&&(o==='"'||o==="'")){s===null?s=o:s===o&&(s=null),t+=o;continue}if(o===","&&r===0&&s===null){let c=t.trim();c&&e.push(c),t="";continue}t+=o}let i=t.trim();return i&&e.push(i),e}var Sl=v(()=>{});var C_,x_=v(()=>{C_={code:"en",name:"English",chronoLocale:"en",dateTriggers:{due:["due","deadline","must be done by","by"],scheduled:["scheduled for","start on","begin on","work on","on"]},recurrence:{frequencies:{daily:["daily","every day"],weekly:["weekly","every week"],monthly:["monthly","every month"],yearly:["yearly","annually","every year"]},every:["every"],other:["other"],weekdays:{monday:["monday"],tuesday:["tuesday"],wednesday:["wednesday"],thursday:["thursday"],friday:["friday"],saturday:["saturday"],sunday:["sunday"]},pluralWeekdays:{monday:["mondays"],tuesday:["tuesdays"],wednesday:["wednesdays"],thursday:["thursdays"],friday:["fridays"],saturday:["saturdays"],sunday:["sundays"]},ordinals:{first:["first"],second:["second"],third:["third"],fourth:["fourth"],last:["last"]},periods:{day:["day","days"],week:["week","weeks"],month:["month","months"],year:["year","years"]}},timeEstimate:{hours:["h","hr","hrs","hour","hours"],minutes:["m","min","mins","minute","minutes"]},fallbackStatus:{open:["todo","to do","open"],inProgress:["in progress","in-progress","doing"],done:["done","completed","finished"],cancelled:["cancelled","canceled"],waiting:["waiting","blocked","on hold"]},fallbackPriority:{urgent:["urgent","critical","highest"],high:["high","important"],normal:["medium","normal"],low:["low","minor"]}}});var M_,__=v(()=>{M_={code:"es",name:"Espa\xF1ol",chronoLocale:"es",dateTriggers:{due:["vence","fecha l\xEDmite","debe terminarse","para el","antes del"],scheduled:["programado para","programado el","comenzar el","empezar el","trabajar en","el"]},recurrence:{frequencies:{daily:["diario","diaria","diariamente","cada d\xEDa","todos los d\xEDas","a diario"],weekly:["semanal","semanalmente","cada semana","todas las semanas","por semana"],monthly:["mensual","mensualmente","cada mes","todos los meses","por mes"],yearly:["anual","anualmente","cada a\xF1o","todos los a\xF1os","por a\xF1o"]},every:["cada","todos los","todas las"],other:["otro","otra"],weekdays:{monday:["lunes"],tuesday:["martes"],wednesday:["mi\xE9rcoles"],thursday:["jueves"],friday:["viernes"],saturday:["s\xE1bado"],sunday:["domingo"]},pluralWeekdays:{monday:["lunes"],tuesday:["martes"],wednesday:["mi\xE9rcoles"],thursday:["jueves"],friday:["viernes"],saturday:["s\xE1bado"],sunday:["domingo"]},ordinals:{first:["primer","primera","primero"],second:["segundo","segunda"],third:["tercer","tercera","tercero"],fourth:["cuarto","cuarta"],last:["\xFAltimo","\xFAltima"]},periods:{day:["d\xEDa","d\xEDas"],week:["semana","semanas"],month:["mes","meses"],year:["a\xF1o","a\xF1os"]}},timeEstimate:{hours:["h","hr","hrs","hora","horas"],minutes:["m","min","mins","minuto","minutos"]},fallbackStatus:{open:["pendiente","por hacer","abierto","todo"],inProgress:["en progreso","en curso","haciendo","trabajando"],done:["hecho","terminado","completado","finalizado"],cancelled:["cancelado","anulado"],waiting:["esperando","bloqueado","en espera"]},fallbackPriority:{urgent:["urgente","cr\xEDtico","cr\xEDtica","m\xE1ximo","m\xE1xima","prioritario","prioritaria"],high:["alto","alta","importante","elevado","elevada"],normal:["medio","media","normal","regular","est\xE1ndar"],low:["bajo","baja","menor","m\xEDnimo","m\xEDnima"]}}});var A_,P_=v(()=>{A_={code:"fr",name:"Fran\xE7ais",chronoLocale:"fr",dateTriggers:{due:["\xE9ch\xE9ance","date limite","doit \xEAtre termin\xE9","pour le","avant le"],scheduled:["programm\xE9 pour","programm\xE9 le","commencer le","d\xE9buter le","travailler sur","le"]},recurrence:{frequencies:{daily:["quotidien","quotidienne","quotidiennement","chaque jour","tous les jours","journalier","journali\xE8re"],weekly:["hebdomadaire","chaque semaine","toutes les semaines","par semaine"],monthly:["mensuel","mensuelle","mensuellement","chaque mois","tous les mois","par mois"],yearly:["annuel","annuelle","annuellement","chaque ann\xE9e","tous les ans","par an","par ann\xE9e"]},every:["chaque","tous les","toutes les"],other:["autre"],weekdays:{monday:["lundi"],tuesday:["mardi"],wednesday:["mercredi"],thursday:["jeudi"],friday:["vendredi"],saturday:["samedi"],sunday:["dimanche"]},pluralWeekdays:{monday:["lundi"],tuesday:["mardi"],wednesday:["mercredi"],thursday:["jeudi"],friday:["vendredi"],saturday:["samedi"],sunday:["dimanche"]},ordinals:{first:["premier","premi\xE8re"],second:["deuxi\xE8me","second","seconde"],third:["troisi\xE8me"],fourth:["quatri\xE8me"],last:["dernier","derni\xE8re"]},periods:{day:["jour","jours"],week:["semaine","semaines"],month:["mois"],year:["an","ans","ann\xE9e","ann\xE9es"]}},timeEstimate:{hours:["h","hr","hrs","heure","heures"],minutes:["m","min","mins","minute","minutes"]},fallbackStatus:{open:["\xE0 faire","ouvert","en attente","todo"],inProgress:["en cours","en progression","en train de faire"],done:["termin\xE9","fini","accompli","fait"],cancelled:["annul\xE9","abandonn\xE9"],waiting:["en attente","bloqu\xE9","suspendu"]},fallbackPriority:{urgent:["urgent","urgente","critique","maximum","prioritaire"],high:["\xE9lev\xE9","\xE9lev\xE9e","haut","haute","important","importante","sup\xE9rieur","sup\xE9rieure"],normal:["moyen","moyenne","normal","normale","standard","r\xE9gulier","r\xE9guli\xE8re"],low:["faible","bas","basse","mineur","mineure","minimum"]}}});var I_,R_=v(()=>{I_={code:"de",name:"Deutsch",chronoLocale:"de",dateTriggers:{due:["f\xE4llig","termin","abgabe","deadline","bis zum","bis"],scheduled:["geplant f\xFCr","geplant am","beginnen am","anfangen am","arbeiten an","am"]},recurrence:{frequencies:{daily:["t\xE4glich","jeden Tag","alle Tage","tagaus tagein"],weekly:["w\xF6chentlich","jede Woche","alle Wochen"],monthly:["monatlich","jeden Monat","alle Monate"],yearly:["j\xE4hrlich","jedes Jahr","alle Jahre"]},every:["jede","jeden","jedes","alle"],other:["andere","anderen","anderes"],weekdays:{monday:["montag"],tuesday:["dienstag"],wednesday:["mittwoch"],thursday:["donnerstag"],friday:["freitag"],saturday:["samstag"],sunday:["sonntag"]},pluralWeekdays:{monday:["montags"],tuesday:["dienstags"],wednesday:["mittwochs"],thursday:["donnerstags"],friday:["freitags"],saturday:["samstags"],sunday:["sonntags"]},ordinals:{first:["erste","ersten","erster"],second:["zweite","zweiten","zweiter"],third:["dritte","dritten","dritter"],fourth:["vierte","vierten","vierter"],last:["letzte","letzten","letzter"]},periods:{day:["tag","tage"],week:["woche","wochen"],month:["monat","monate"],year:["jahr","jahre"]}},timeEstimate:{hours:["h","std","stunde","stunden"],minutes:["m","min","minute","minuten"]},fallbackStatus:{open:["offen","zu erledigen","ausstehend","todo"],inProgress:["in bearbeitung","wird bearbeitet","l\xE4uft","in arbeit"],done:["erledigt","fertig","abgeschlossen","gemacht"],cancelled:["abgebrochen","storniert","abgesagt"],waiting:["wartend","warten","blockiert","pausiert"]},fallbackPriority:{urgent:["dringend","eilig","kritisch","sofort","h\xF6chste"],high:["hoch","hohe","wichtig","priorit\xE4r"],normal:["normal","mittel","mittlere","standard"],low:["niedrig","niedrige","gering","geringe"]}}});var N_,O_=v(()=>{N_={code:"ru",name:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",chronoLocale:"ru",dateTriggers:{due:["\u0441\u0440\u043E\u043A","\u0434\u0435\u0434\u043B\u0430\u0439\u043D","\u0434\u043E","\u043A","\u0441\u0434\u0430\u0442\u044C \u0434\u043E"],scheduled:["\u0437\u0430\u043F\u043B\u0430\u043D\u0438\u0440\u043E\u0432\u0430\u043D\u043E \u043D\u0430","\u043D\u0430\u0447\u0430\u0442\u044C","\u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C \u043D\u0430\u0434","\u043D\u0430"]},recurrence:{frequencies:{daily:["\u0435\u0436\u0435\u0434\u043D\u0435\u0432\u043D\u043E","\u043A\u0430\u0436\u0434\u044B\u0439 \u0434\u0435\u043D\u044C","\u0435\u0436\u0435\u0434\u043D\u0435\u0432\u043D\u044B\u0439","\u043A\u0430\u0436\u0434\u043E\u0434\u043D\u0435\u0432\u043D\u044B\u0439"],weekly:["\u0435\u0436\u0435\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u043E","\u043A\u0430\u0436\u0434\u0443\u044E \u043D\u0435\u0434\u0435\u043B\u044E","\u0435\u0436\u0435\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u044B\u0439"],monthly:["\u0435\u0436\u0435\u043C\u0435\u0441\u044F\u0447\u043D\u043E","\u043A\u0430\u0436\u0434\u044B\u0439 \u043C\u0435\u0441\u044F\u0446","\u0435\u0436\u0435\u043C\u0435\u0441\u044F\u0447\u043D\u044B\u0439"],yearly:["\u0435\u0436\u0435\u0433\u043E\u0434\u043D\u043E","\u043A\u0430\u0436\u0434\u044B\u0439 \u0433\u043E\u0434","\u0435\u0436\u0435\u0433\u043E\u0434\u043D\u044B\u0439"]},every:["\u043A\u0430\u0436\u0434\u044B\u0439","\u043A\u0430\u0436\u0434\u0443\u044E","\u043A\u0430\u0436\u0434\u043E\u0435","\u0432\u0441\u0435"],other:["\u0434\u0440\u0443\u0433\u043E\u0439","\u0434\u0440\u0443\u0433\u0443\u044E","\u0434\u0440\u0443\u0433\u043E\u0435"],weekdays:{monday:["\u043F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A"],tuesday:["\u0432\u0442\u043E\u0440\u043D\u0438\u043A"],wednesday:["\u0441\u0440\u0435\u0434\u0430"],thursday:["\u0447\u0435\u0442\u0432\u0435\u0440\u0433"],friday:["\u043F\u044F\u0442\u043D\u0438\u0446\u0430"],saturday:["\u0441\u0443\u0431\u0431\u043E\u0442\u0430"],sunday:["\u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435"]},pluralWeekdays:{monday:["\u043F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A","\u0432 \u043F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A","\u043F\u043E \u043F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A\u0430\u043C"],tuesday:["\u0432\u0442\u043E\u0440\u043D\u0438\u043A","\u0432\u043E \u0432\u0442\u043E\u0440\u043D\u0438\u043A","\u043F\u043E \u0432\u0442\u043E\u0440\u043D\u0438\u043A\u0430\u043C"],wednesday:["\u0441\u0440\u0435\u0434\u0430","\u0432 \u0441\u0440\u0435\u0434\u0443","\u043F\u043E \u0441\u0440\u0435\u0434\u0430\u043C"],thursday:["\u0447\u0435\u0442\u0432\u0435\u0440\u0433","\u0432 \u0447\u0435\u0442\u0432\u0435\u0440\u0433","\u043F\u043E \u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0430\u043C"],friday:["\u043F\u044F\u0442\u043D\u0438\u0446\u0430","\u0432 \u043F\u044F\u0442\u043D\u0438\u0446\u0443","\u043F\u043E \u043F\u044F\u0442\u043D\u0438\u0446\u0430\u043C"],saturday:["\u0441\u0443\u0431\u0431\u043E\u0442\u0430","\u0432 \u0441\u0443\u0431\u0431\u043E\u0442\u0443","\u043F\u043E \u0441\u0443\u0431\u0431\u043E\u0442\u0430\u043C"],sunday:["\u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435","\u0432 \u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435","\u043F\u043E \u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u044F\u043C"]},ordinals:{first:["\u043F\u0435\u0440\u0432\u044B\u0439","\u043F\u0435\u0440\u0432\u0430\u044F","\u043F\u0435\u0440\u0432\u043E\u0435"],second:["\u0432\u0442\u043E\u0440\u043E\u0439","\u0432\u0442\u043E\u0440\u0430\u044F","\u0432\u0442\u043E\u0440\u043E\u0435"],third:["\u0442\u0440\u0435\u0442\u0438\u0439","\u0442\u0440\u0435\u0442\u044C\u044F","\u0442\u0440\u0435\u0442\u044C\u0435"],fourth:["\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u044B\u0439","\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0430\u044F","\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0435"],last:["\u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0439","\u043F\u043E\u0441\u043B\u0435\u0434\u043D\u044F\u044F","\u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0435\u0435"]},periods:{day:["\u0434\u0435\u043D\u044C","\u0434\u043D\u0438"],week:["\u043D\u0435\u0434\u0435\u043B\u044F","\u043D\u0435\u0434\u0435\u043B\u0438"],month:["\u043C\u0435\u0441\u044F\u0446","\u043C\u0435\u0441\u044F\u0446\u044B"],year:["\u0433\u043E\u0434","\u0433\u043E\u0434\u044B"]}},timeEstimate:{hours:["\u0447","\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043E\u0432"],minutes:["\u043C","\u043C\u0438\u043D","\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442\u044B","\u043C\u0438\u043D\u0443\u0442"]},fallbackStatus:{open:["\u043E\u0442\u043A\u0440\u044B\u0442\u043E","\u043A \u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u0438\u044E","\u043D\u043E\u0432\u043E\u0435","todo"],inProgress:["\u0432 \u0440\u0430\u0431\u043E\u0442\u0435","\u0432\u044B\u043F\u043E\u043B\u043D\u044F\u0435\u0442\u0441\u044F","\u0432 \u043F\u0440\u043E\u0446\u0435\u0441\u0441\u0435"],done:["\u0432\u044B\u043F\u043E\u043B\u043D\u0435\u043D\u043E","\u0433\u043E\u0442\u043E\u0432\u043E","\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043E","\u0441\u0434\u0435\u043B\u0430\u043D\u043E"],cancelled:["\u043E\u0442\u043C\u0435\u043D\u0435\u043D\u043E","\u043E\u0442\u043C\u0435\u043D\u0451\u043D","\u043E\u0442\u043C\u0435\u043D\u0435\u043D\u0430"],waiting:["\u043E\u0436\u0438\u0434\u0430\u043D\u0438\u0435","\u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u043E","\u043D\u0430 \u043F\u0430\u0443\u0437\u0435"]},fallbackPriority:{urgent:["\u0441\u0440\u043E\u0447\u043D\u043E","\u043A\u0440\u0438\u0442\u0438\u0447\u043D\u043E","\u044D\u043A\u0441\u0442\u0440\u0435\u043D\u043D\u043E","\u043D\u0435\u043C\u0435\u0434\u043B\u0435\u043D\u043D\u043E"],high:["\u0432\u044B\u0441\u043E\u043A\u0438\u0439","\u0432\u044B\u0441\u043E\u043A\u0430\u044F","\u0432\u0430\u0436\u043D\u043E","\u043F\u0440\u0438\u043E\u0440\u0438\u0442\u0435\u0442\u043D\u043E"],normal:["\u043D\u043E\u0440\u043C\u0430\u043B\u044C\u043D\u044B\u0439","\u043D\u043E\u0440\u043C\u0430\u043B\u044C\u043D\u0430\u044F","\u0441\u0440\u0435\u0434\u043D\u0438\u0439","\u0441\u0440\u0435\u0434\u043D\u044F\u044F"],low:["\u043D\u0438\u0437\u043A\u0438\u0439","\u043D\u0438\u0437\u043A\u0430\u044F","\u043D\u0435\u0432\u0430\u0436\u043D\u043E","\u043C\u043E\u0436\u043D\u043E \u043F\u043E\u0437\u0436\u0435"]}}});var L_,F_=v(()=>{L_={code:"zh",name:"\u4E2D\u6587",chronoLocale:"zh",dateTriggers:{due:["\u622A\u6B62","\u5230\u671F","\u671F\u9650","\u5728","\u4E4B\u524D"],scheduled:["\u5B89\u6392\u5728","\u8BA1\u5212\u5728","\u5F00\u59CB\u5728","\u5728"]},recurrence:{frequencies:{daily:["\u6BCF\u5929","\u6BCF\u65E5","\u5929\u5929","\u65E5\u5E38"],weekly:["\u6BCF\u5468","\u6BCF\u661F\u671F","\u5468\u5468"],monthly:["\u6BCF\u6708","\u6BCF\u4E2A\u6708","\u6708\u6708"],yearly:["\u6BCF\u5E74","\u5E74\u5E74","\u6BCF\u4E00\u5E74"]},every:["\u6BCF","\u6BCF\u4E2A","\u6BCF\u4E00\u4E2A"],other:["\u5176\u4ED6","\u53E6\u4E00\u4E2A"],weekdays:{monday:["\u5468\u4E00","\u661F\u671F\u4E00","\u793C\u62DC\u4E00"],tuesday:["\u5468\u4E8C","\u661F\u671F\u4E8C","\u793C\u62DC\u4E8C"],wednesday:["\u5468\u4E09","\u661F\u671F\u4E09","\u793C\u62DC\u4E09"],thursday:["\u5468\u56DB","\u661F\u671F\u56DB","\u793C\u62DC\u56DB"],friday:["\u5468\u4E94","\u661F\u671F\u4E94","\u793C\u62DC\u4E94"],saturday:["\u5468\u516D","\u661F\u671F\u516D","\u793C\u62DC\u516D"],sunday:["\u5468\u65E5","\u661F\u671F\u65E5","\u793C\u62DC\u65E5"]},pluralWeekdays:{monday:["\u5468\u4E00","\u661F\u671F\u4E00","\u793C\u62DC\u4E00"],tuesday:["\u5468\u4E8C","\u661F\u671F\u4E8C","\u793C\u62DC\u4E8C"],wednesday:["\u5468\u4E09","\u661F\u671F\u4E09","\u793C\u62DC\u4E09"],thursday:["\u5468\u56DB","\u661F\u671F\u56DB","\u793C\u62DC\u56DB"],friday:["\u5468\u4E94","\u661F\u671F\u4E94","\u793C\u62DC\u4E94"],saturday:["\u5468\u516D","\u661F\u671F\u516D","\u793C\u62DC\u516D"],sunday:["\u5468\u65E5","\u661F\u671F\u65E5","\u793C\u62DC\u65E5"]},ordinals:{first:["\u7B2C\u4E00\u4E2A","\u7B2C\u4E00","\u9996\u4E2A"],second:["\u7B2C\u4E8C\u4E2A","\u7B2C\u4E8C"],third:["\u7B2C\u4E09\u4E2A","\u7B2C\u4E09"],fourth:["\u7B2C\u56DB\u4E2A","\u7B2C\u56DB"],last:["\u6700\u540E\u4E00\u4E2A","\u6700\u540E","\u672B\u5C3E"]},periods:{day:["\u5929","\u65E5"],week:["\u5468","\u661F\u671F","\u793C\u62DC"],month:["\u6708","\u4E2A\u6708"],year:["\u5E74"]}},timeEstimate:{hours:["\u5C0F\u65F6","\u65F6","\u4E2A\u5C0F\u65F6"],minutes:["\u5206\u949F","\u5206","\u4E2A\u5206\u949F"]},fallbackStatus:{open:["\u5F85\u529E","\u672A\u5B8C\u6210","\u5F00\u653E","\u65B0\u5EFA"],inProgress:["\u8FDB\u884C\u4E2D","\u6B63\u5728\u5904\u7406","\u5904\u7406\u4E2D","\u5DE5\u4F5C\u4E2D"],done:["\u5B8C\u6210","\u5DF2\u5B8C\u6210","\u7ED3\u675F","\u641E\u5B9A"],cancelled:["\u53D6\u6D88","\u5DF2\u53D6\u6D88","\u5E9F\u5F03"],waiting:["\u7B49\u5F85","\u6682\u505C","\u963B\u585E","\u5F85\u5B9A"]},fallbackPriority:{urgent:["\u7D27\u6025","\u6025\u8FEB","\u7ACB\u5373","\u9A6C\u4E0A"],high:["\u9AD8","\u91CD\u8981","\u4F18\u5148","\u9AD8\u4F18\u5148\u7EA7"],normal:["\u6B63\u5E38","\u666E\u901A","\u4E2D\u7B49","\u6807\u51C6"],low:["\u4F4E","\u4E0D\u91CD\u8981","\u4F4E\u4F18\u5148\u7EA7","\u6B21\u8981"]}}});var B_,H_=v(()=>{B_={code:"ja",name:"\u65E5\u672C\u8A9E",chronoLocale:"ja",dateTriggers:{due:["\u671F\u9650","\u7DE0\u5207","\u3006\u5207","\u307E\u3067","\u307E\u3067\u306B","\u306B"],scheduled:["\u4E88\u5B9A","\u8A08\u753B","\u958B\u59CB","\u304B\u3089","\u306B\u958B\u59CB","\u3092\u958B\u59CB"]},recurrence:{frequencies:{daily:["\u6BCE\u65E5","\u65E5\u3005","\u6BCE\u65E5\u6BCE\u65E5","\u9023\u65E5"],weekly:["\u6BCE\u9031","\u9031\u6BCE","\u9031\u4E00","\u6BCE\u9031\u6BCE\u9031"],monthly:["\u6BCE\u6708","\u6708\u6BCE","\u6708\u4E00","\u6BCE\u6708\u6BCE\u6708"],yearly:["\u6BCE\u5E74","\u5E74\u6BCE","\u5E74\u4E00","\u6BCE\u5E74\u6BCE\u5E74","\u5E74\u6B21"]},every:["\u6BCE","\u5404","\u5168\u3066"],other:["\u4ED6\u306E","\u5225\u306E","\u7570\u306A\u308B"],weekdays:{monday:["\u6708\u66DC\u65E5","\u6708\u66DC","\u6708","\u3052\u3064\u3088\u3046\u3073"],tuesday:["\u706B\u66DC\u65E5","\u706B\u66DC","\u706B","\u304B\u3088\u3046\u3073"],wednesday:["\u6C34\u66DC\u65E5","\u6C34\u66DC","\u6C34","\u3059\u3044\u3088\u3046\u3073"],thursday:["\u6728\u66DC\u65E5","\u6728\u66DC","\u6728","\u3082\u304F\u3088\u3046\u3073"],friday:["\u91D1\u66DC\u65E5","\u91D1\u66DC","\u91D1","\u304D\u3093\u3088\u3046\u3073"],saturday:["\u571F\u66DC\u65E5","\u571F\u66DC","\u571F","\u3069\u3088\u3046\u3073"],sunday:["\u65E5\u66DC\u65E5","\u65E5\u66DC","\u65E5","\u306B\u3061\u3088\u3046\u3073"]},pluralWeekdays:{monday:["\u6708\u66DC\u65E5","\u6708\u66DC","\u6708","\u3052\u3064\u3088\u3046\u3073"],tuesday:["\u706B\u66DC\u65E5","\u706B\u66DC","\u706B","\u304B\u3088\u3046\u3073"],wednesday:["\u6C34\u66DC\u65E5","\u6C34\u66DC","\u6C34","\u3059\u3044\u3088\u3046\u3073"],thursday:["\u6728\u66DC\u65E5","\u6728\u66DC","\u6728","\u3082\u304F\u3088\u3046\u3073"],friday:["\u91D1\u66DC\u65E5","\u91D1\u66DC","\u91D1","\u304D\u3093\u3088\u3046\u3073"],saturday:["\u571F\u66DC\u65E5","\u571F\u66DC","\u571F","\u3069\u3088\u3046\u3073"],sunday:["\u65E5\u66DC\u65E5","\u65E5\u66DC","\u65E5","\u306B\u3061\u3088\u3046\u3073"]},ordinals:{first:["\u6700\u521D\u306E","\u7B2C\u4E00\u306E","\u4E00\u756A\u76EE\u306E","\u521D\u56DE"],second:["\u4E8C\u756A\u76EE\u306E","\u7B2C\u4E8C\u306E","\u6B21\u306E"],third:["\u4E09\u756A\u76EE\u306E","\u7B2C\u4E09\u306E"],fourth:["\u56DB\u756A\u76EE\u306E","\u7B2C\u56DB\u306E"],last:["\u6700\u5F8C\u306E","\u6700\u7D42\u306E","\u7D42\u308F\u308A\u306E"]},periods:{day:["\u65E5","\u65E5\u9593"],week:["\u9031","\u9031\u9593"],month:["\u6708","\u6708\u9593","\u30F6\u6708"],year:["\u5E74","\u5E74\u9593"]}},timeEstimate:{hours:["\u6642\u9593","\u6642","\u3058\u304B\u3093"],minutes:["\u5206","\u5206\u9593","\u3075\u3093","\u3077\u3093"]},fallbackStatus:{open:["\u672A\u7740\u624B","\u65B0\u898F","\u30AA\u30FC\u30D7\u30F3","\u958B\u59CB\u524D","\u5F85\u6A5F"],inProgress:["\u9032\u884C\u4E2D","\u4F5C\u696D\u4E2D","\u5B9F\u884C\u4E2D","\u51E6\u7406\u4E2D","\u9032\u884C"],done:["\u5B8C\u4E86","\u7D42\u4E86","\u6E08\u307F","\u7D42\u308F\u308A","\u9054\u6210"],cancelled:["\u30AD\u30E3\u30F3\u30BB\u30EB","\u4E2D\u6B62","\u53D6\u6D88","\u5EC3\u6B62","\u505C\u6B62"],waiting:["\u5F85\u6A5F","\u4FDD\u7559","\u30D6\u30ED\u30C3\u30AF","\u4E00\u6642\u505C\u6B62","\u5F85\u3061"]},fallbackPriority:{urgent:["\u7DCA\u6025","\u81F3\u6025","\u6025\u52D9","\u6700\u512A\u5148","\u3059\u3050\u306B"],high:["\u9AD8","\u91CD\u8981","\u512A\u5148","\u9AD8\u512A\u5148\u5EA6","\u91CD\u70B9"],normal:["\u666E\u901A","\u901A\u5E38","\u6A19\u6E96","\u4E00\u822C","\u30CE\u30FC\u30DE\u30EB"],low:["\u4F4E","\u8EFD\u5FAE","\u5F8C\u56DE\u3057","\u4F4E\u512A\u5148\u5EA6","\u4F59\u88D5"]}}});var U_,W_=v(()=>{U_={code:"it",name:"Italiano",chronoLocale:"it",dateTriggers:{due:["scadenza","entro","entro il","deve essere fatto entro","per il","termine"],scheduled:["programmato per","programmato il","iniziare il","lavorare su","il","per"]},recurrence:{frequencies:{daily:["giornaliero","giornaliera","quotidiano","quotidiana","ogni giorno","tutti i giorni","giornalmente"],weekly:["settimanale","ogni settimana","tutte le settimane","settimanalmente","alla settimana"],monthly:["mensile","ogni mese","tutti i mesi","mensilmente","al mese"],yearly:["annuale","ogni anno","tutti gli anni","annualmente","all'anno"]},every:["ogni","tutti i","tutte le"],other:["altro","altra","altri","altre"],weekdays:{monday:["luned\xEC"],tuesday:["marted\xEC"],wednesday:["mercoled\xEC"],thursday:["gioved\xEC"],friday:["venerd\xEC"],saturday:["sabato"],sunday:["domenica"]},pluralWeekdays:{monday:["luned\xEC"],tuesday:["marted\xEC"],wednesday:["mercoled\xEC"],thursday:["gioved\xEC"],friday:["venerd\xEC"],saturday:["sabati"],sunday:["domeniche"]},ordinals:{first:["primo","prima"],second:["secondo","seconda"],third:["terzo","terza"],fourth:["quarto","quarta"],last:["ultimo","ultima"]},periods:{day:["giorno","giorni"],week:["settimana","settimane"],month:["mese","mesi"],year:["anno","anni"]}},timeEstimate:{hours:["h","hr","ore","ora","o"],minutes:["m","min","minuto","minuti"]},fallbackStatus:{open:["da fare","aperto","pendente","todo","in sospeso"],inProgress:["in corso","in progresso","facendo","lavorando"],done:["fatto","completato","finito","terminato","chiuso"],cancelled:["cancellato","annullato","rimosso"],waiting:["in attesa","aspettando","bloccato","fermo"]},fallbackPriority:{urgent:["urgente","critico","critica","massimo","massima","prioritario","prioritaria"],high:["alto","alta","importante","elevato","elevata"],normal:["medio","media","normale","regolare","standard"],low:["basso","bassa","minore","minimo","minima"]}}});var $_,j_=v(()=>{$_={code:"nl",name:"Nederlands",chronoLocale:"nl",dateTriggers:{due:["vervalt op","deadline","moet klaar zijn op","tegen","uiterlijk","voor"],scheduled:["gepland voor","gepland op","beginnen op","werken aan","op","voor"]},recurrence:{frequencies:{daily:["dagelijks","elke dag","alle dagen","per dag"],weekly:["wekelijks","elke week","alle weken","per week"],monthly:["maandelijks","elke maand","alle maanden","per maand"],yearly:["jaarlijks","elk jaar","alle jaren","per jaar"]},every:["elke","alle","iedere"],other:["andere","ander"],weekdays:{monday:["maandag"],tuesday:["dinsdag"],wednesday:["woensdag"],thursday:["donderdag"],friday:["vrijdag"],saturday:["zaterdag"],sunday:["zondag"]},pluralWeekdays:{monday:["maandagen"],tuesday:["dinsdagen"],wednesday:["woensdagen"],thursday:["donderdagen"],friday:["vrijdagen"],saturday:["zaterdagen"],sunday:["zondagen"]},ordinals:{first:["eerste"],second:["tweede"],third:["derde"],fourth:["vierde"],last:["laatste"]},periods:{day:["dag","dagen"],week:["week","weken"],month:["maand","maanden"],year:["jaar","jaren"]}},timeEstimate:{hours:["u","uur","uren","h"],minutes:["m","min","minuut","minuten"]},fallbackStatus:{open:["te doen","open","nog te doen","todo","openstaand"],inProgress:["bezig","in behandeling","aan het werk","lopend","in uitvoering"],done:["klaar","voltooid","gedaan","afgerond","gesloten"],cancelled:["geannuleerd","afgezegd","ingetrokken"],waiting:["wachtend","in de wacht","geblokkeerd","uitgesteld"]},fallbackPriority:{urgent:["urgent","kritiek","hoogste","spoed","direct"],high:["hoog","hoge","belangrijk","belangrijke"],normal:["normaal","normale","gemiddeld","standaard"],low:["laag","lage","klein","kleine","onbelangrijk"]}}});var V_,Y_=v(()=>{V_={code:"pt",name:"Portugu\xEAs",chronoLocale:"pt",dateTriggers:{due:["vencimento","prazo","deve estar pronto at\xE9","at\xE9","para","limite"],scheduled:["programado para","agendado para","come\xE7ar em","trabalhar em","em","no"]},recurrence:{frequencies:{daily:["di\xE1rio","di\xE1ria","diariamente","todos os dias","cada dia","por dia"],weekly:["semanal","semanalmente","toda semana","todas as semanas","por semana"],monthly:["mensal","mensalmente","todo m\xEAs","todos os meses","por m\xEAs"],yearly:["anual","anualmente","todo ano","todos os anos","por ano"]},every:["todo","toda","todos","todas","cada"],other:["outro","outra","outros","outras"],weekdays:{monday:["segunda","segunda-feira"],tuesday:["ter\xE7a","ter\xE7a-feira"],wednesday:["quarta","quarta-feira"],thursday:["quinta","quinta-feira"],friday:["sexta","sexta-feira"],saturday:["s\xE1bado"],sunday:["domingo"]},pluralWeekdays:{monday:["segundas","segundas-feiras"],tuesday:["ter\xE7as","ter\xE7as-feiras"],wednesday:["quartas","quartas-feiras"],thursday:["quintas","quintas-feiras"],friday:["sextas","sextas-feiras"],saturday:["s\xE1bados"],sunday:["domingos"]},ordinals:{first:["primeiro","primeira"],second:["segundo","segunda"],third:["terceiro","terceira"],fourth:["quarto","quarta"],last:["\xFAltimo","\xFAltima"]},periods:{day:["dia","dias"],week:["semana","semanas"],month:["m\xEAs","meses"],year:["ano","anos"]}},timeEstimate:{hours:["h","hr","hora","horas"],minutes:["m","min","minuto","minutos"]},fallbackStatus:{open:["a fazer","pendente","aberto","todo","por fazer"],inProgress:["em andamento","em progresso","fazendo","trabalhando","executando"],done:["feito","conclu\xEDdo","terminado","finalizado","completo"],cancelled:["cancelado","anulado","suspenso"],waiting:["aguardando","esperando","bloqueado","em espera"]},fallbackPriority:{urgent:["urgente","cr\xEDtico","cr\xEDtica","m\xE1ximo","m\xE1xima","priorit\xE1rio","priorit\xE1ria"],high:["alto","alta","importante","elevado","elevada"],normal:["m\xE9dio","m\xE9dia","normal","regular","padr\xE3o"],low:["baixo","baixa","menor","m\xEDnimo","m\xEDnima"]}}});var z_,q_=v(()=>{z_={code:"sv",name:"Svenska",chronoLocale:"sv",dateTriggers:{due:["f\xF6rfaller","deadline","m\xE5ste vara klar","senast","till","innan"],scheduled:["schemalagd","planerad f\xF6r","b\xF6rja","arbeta med","den","p\xE5"]},recurrence:{frequencies:{daily:["dagligen","varje dag","alla dagar","per dag"],weekly:["veckovis","varje vecka","alla veckor","per vecka"],monthly:["m\xE5nadsvis","varje m\xE5nad","alla m\xE5nader","per m\xE5nad"],yearly:["\xE5rligen","varje \xE5r","alla \xE5r","per \xE5r"]},every:["varje","alla","var"],other:["annan","annat","andra"],weekdays:{monday:["m\xE5ndag"],tuesday:["tisdag"],wednesday:["onsdag"],thursday:["torsdag"],friday:["fredag"],saturday:["l\xF6rdag"],sunday:["s\xF6ndag"]},pluralWeekdays:{monday:["m\xE5ndagar"],tuesday:["tisdagar"],wednesday:["onsdagar"],thursday:["torsdagar"],friday:["fredagar"],saturday:["l\xF6rdagar"],sunday:["s\xF6ndagar"]},ordinals:{first:["f\xF6rsta"],second:["andra"],third:["tredje"],fourth:["fj\xE4rde"],last:["sista"]},periods:{day:["dag","dagar"],week:["vecka","veckor"],month:["m\xE5nad","m\xE5nader"],year:["\xE5r"]}},timeEstimate:{hours:["t","tim","timme","timmar","h"],minutes:["m","min","minut","minuter"]},fallbackStatus:{open:["att g\xF6ra","\xF6ppen","kvar","todo","v\xE4ntande"],inProgress:["p\xE5g\xE5ende","arbetar","g\xF6r","i process","under arbete"],done:["klar","f\xE4rdig","slutf\xF6rd","avslutad","gjord"],cancelled:["avbruten","inst\xE4lld","avbokad"],waiting:["v\xE4ntar","blockerad","pausad","vilande"]},fallbackPriority:{urgent:["br\xE5dskande","kritisk","h\xF6gsta","akut","omedelbar"],high:["h\xF6g","viktig","f\xF6rh\xF6jd","prioriterad"],normal:["normal","medel","standard","vanlig"],low:["l\xE5g","mindre","minimal","obetydlig"]}}});var G_,Q_=v(()=>{G_={code:"uk",name:"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430",chronoLocale:"uk",dateTriggers:{due:["\u0442\u0435\u0440\u043C\u0456\u043D","\u0434\u0435\u0434\u043B\u0430\u0439\u043D","\u043C\u0430\u0454 \u0431\u0443\u0442\u0438 \u0433\u043E\u0442\u043E\u0432\u043E \u0434\u043E","\u0434\u043E","\u043D\u0435 \u043F\u0456\u0437\u043D\u0456\u0448\u0435","\u043A\u0440\u0430\u0439\u043D\u0456\u0439 \u0442\u0435\u0440\u043C\u0456\u043D"],scheduled:["\u0437\u0430\u043F\u043B\u0430\u043D\u043E\u0432\u0430\u043D\u043E \u043D\u0430","\u0437\u0430\u043F\u043B\u0430\u043D\u043E\u0432\u0430\u043D\u0438\u0439","\u043F\u043E\u0447\u0430\u0442\u0438","\u043F\u0440\u0430\u0446\u044E\u0432\u0430\u0442\u0438 \u043D\u0430\u0434","\u043D\u0430","\u0432"]},recurrence:{frequencies:{daily:["\u0449\u043E\u0434\u043D\u044F","\u0449\u043E\u0434\u0435\u043D\u043D\u043E","\u043A\u043E\u0436\u0435\u043D \u0434\u0435\u043D\u044C","\u0432\u0441\u0456 \u0434\u043D\u0456","\u043D\u0430 \u0434\u0435\u043D\u044C"],weekly:["\u0449\u043E\u0442\u0438\u0436\u043D\u044F","\u0449\u043E\u0442\u0438\u0436\u043D\u0435\u0432\u043E","\u043A\u043E\u0436\u0435\u043D \u0442\u0438\u0436\u0434\u0435\u043D\u044C","\u0432\u0441\u0456 \u0442\u0438\u0436\u043D\u0456","\u043D\u0430 \u0442\u0438\u0436\u0434\u0435\u043D\u044C"],monthly:["\u0449\u043E\u043C\u0456\u0441\u044F\u0446\u044F","\u0449\u043E\u043C\u0456\u0441\u044F\u0447\u043D\u043E","\u043A\u043E\u0436\u0435\u043D \u043C\u0456\u0441\u044F\u0446\u044C","\u0432\u0441\u0456 \u043C\u0456\u0441\u044F\u0446\u0456","\u043D\u0430 \u043C\u0456\u0441\u044F\u0446\u044C"],yearly:["\u0449\u043E\u0440\u043E\u043A\u0443","\u0449\u043E\u0440\u0456\u0447\u043D\u043E","\u043A\u043E\u0436\u0435\u043D \u0440\u0456\u043A","\u0432\u0441\u0456 \u0440\u043E\u043A\u0438","\u043D\u0430 \u0440\u0456\u043A"]},every:["\u043A\u043E\u0436\u0435\u043D","\u043A\u043E\u0436\u043D\u0430","\u043A\u043E\u0436\u043D\u0435","\u0432\u0441\u0456"],other:["\u0456\u043D\u0448\u0438\u0439","\u0456\u043D\u0448\u0430","\u0456\u043D\u0448\u0435","\u0456\u043D\u0448\u0456"],weekdays:{monday:["\u043F\u043E\u043D\u0435\u0434\u0456\u043B\u043E\u043A"],tuesday:["\u0432\u0456\u0432\u0442\u043E\u0440\u043E\u043A"],wednesday:["\u0441\u0435\u0440\u0435\u0434\u0430"],thursday:["\u0447\u0435\u0442\u0432\u0435\u0440"],friday:["\u043F'\u044F\u0442\u043D\u0438\u0446\u044F"],saturday:["\u0441\u0443\u0431\u043E\u0442\u0430"],sunday:["\u043D\u0435\u0434\u0456\u043B\u044F"]},pluralWeekdays:{monday:["\u043F\u043E\u043D\u0435\u0434\u0456\u043B\u043A\u0438"],tuesday:["\u0432\u0456\u0432\u0442\u043E\u0440\u043A\u0438"],wednesday:["\u0441\u0435\u0440\u0435\u0434\u0438"],thursday:["\u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0438"],friday:["\u043F'\u044F\u0442\u043D\u0438\u0446\u0456"],saturday:["\u0441\u0443\u0431\u043E\u0442\u0438"],sunday:["\u043D\u0435\u0434\u0456\u043B\u0456"]},ordinals:{first:["\u043F\u0435\u0440\u0448\u0438\u0439","\u043F\u0435\u0440\u0448\u0430","\u043F\u0435\u0440\u0448\u0435"],second:["\u0434\u0440\u0443\u0433\u0438\u0439","\u0434\u0440\u0443\u0433\u0430","\u0434\u0440\u0443\u0433\u0435"],third:["\u0442\u0440\u0435\u0442\u0456\u0439","\u0442\u0440\u0435\u0442\u044F","\u0442\u0440\u0435\u0442\u0454"],fourth:["\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0438\u0439","\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0430","\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0435"],last:["\u043E\u0441\u0442\u0430\u043D\u043D\u0456\u0439","\u043E\u0441\u0442\u0430\u043D\u043D\u044F","\u043E\u0441\u0442\u0430\u043D\u043D\u0454"]},periods:{day:["\u0434\u0435\u043D\u044C","\u0434\u043D\u0456","\u0434\u043D\u0456\u0432"],week:["\u0442\u0438\u0436\u0434\u0435\u043D\u044C","\u0442\u0438\u0436\u043D\u0456","\u0442\u0438\u0436\u043D\u0456\u0432"],month:["\u043C\u0456\u0441\u044F\u0446\u044C","\u043C\u0456\u0441\u044F\u0446\u0456","\u043C\u0456\u0441\u044F\u0446\u0456\u0432"],year:["\u0440\u0456\u043A","\u0440\u043E\u043A\u0438","\u0440\u043E\u043A\u0456\u0432"]}},timeEstimate:{hours:["\u0433","\u0433\u043E\u0434","\u0433\u043E\u0434\u0438\u043D\u0430","\u0433\u043E\u0434\u0438\u043D\u0438","\u0433\u043E\u0434\u0438\u043D"],minutes:["\u0445\u0432","\u043C\u0456\u043D","\u0445\u0432\u0438\u043B\u0438\u043D\u0430","\u0445\u0432\u0438\u043B\u0438\u043D\u0438","\u0445\u0432\u0438\u043B\u0438\u043D"]},fallbackStatus:{open:["\u0437\u0440\u043E\u0431\u0438\u0442\u0438","\u0432\u0456\u0434\u043A\u0440\u0438\u0442\u0438\u0439","\u043E\u0447\u0456\u043A\u0443\u0454","todo","\u0432 \u043E\u0447\u0456\u043A\u0443\u0432\u0430\u043D\u043D\u0456"],inProgress:["\u0432 \u0440\u043E\u0431\u043E\u0442\u0456","\u0432\u0438\u043A\u043E\u043D\u0443\u0454\u0442\u044C\u0441\u044F","\u0440\u043E\u0431\u043B\u044E","\u043F\u0440\u0430\u0446\u044E\u044E","\u0432 \u043F\u0440\u043E\u0446\u0435\u0441\u0456"],done:["\u0433\u043E\u0442\u043E\u0432\u043E","\u0432\u0438\u043A\u043E\u043D\u0430\u043D\u043E","\u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043E","\u0437\u0430\u043A\u0456\u043D\u0447\u0435\u043D\u043E","\u0437\u0440\u043E\u0431\u043B\u0435\u043D\u043E"],cancelled:["\u0441\u043A\u0430\u0441\u043E\u0432\u0430\u043D\u043E","\u0432\u0456\u0434\u043C\u0456\u043D\u0435\u043D\u043E","\u043F\u0440\u0438\u043F\u0438\u043D\u0435\u043D\u043E"],waiting:["\u0447\u0435\u043A\u0430\u044E","\u043E\u0447\u0456\u043A\u0443\u044E","\u0437\u0430\u0431\u043B\u043E\u043A\u043E\u0432\u0430\u043D\u043E","\u043F\u0440\u0438\u0437\u0443\u043F\u0438\u043D\u0435\u043D\u043E"]},fallbackPriority:{urgent:["\u0442\u0435\u0440\u043C\u0456\u043D\u043E\u0432\u043E","\u043A\u0440\u0438\u0442\u0438\u0447\u043D\u043E","\u043D\u0430\u0439\u0432\u0438\u0449\u0438\u0439","\u043D\u0435\u0432\u0456\u0434\u043A\u043B\u0430\u0434\u043D\u043E","\u043F\u0440\u0456\u043E\u0440\u0438\u0442\u0435\u0442\u043D\u043E"],high:["\u0432\u0438\u0441\u043E\u043A\u0438\u0439","\u0432\u0438\u0441\u043E\u043A\u0430","\u0432\u0430\u0436\u043B\u0438\u0432\u043E","\u043F\u0456\u0434\u0432\u0438\u0449\u0435\u043D\u0438\u0439"],normal:["\u0441\u0435\u0440\u0435\u0434\u043D\u0456\u0439","\u0441\u0435\u0440\u0435\u0434\u043D\u044F","\u043D\u043E\u0440\u043C\u0430\u043B\u044C\u043D\u043E","\u0437\u0432\u0438\u0447\u0430\u0439\u043D\u043E","\u0441\u0442\u0430\u043D\u0434\u0430\u0440\u0442\u043D\u043E"],low:["\u043D\u0438\u0437\u044C\u043A\u0438\u0439","\u043D\u0438\u0437\u044C\u043A\u0430","\u043C\u0435\u043D\u0448\u0438\u0439","\u043C\u0456\u043D\u0456\u043C\u0430\u043B\u044C\u043D\u0438\u0439","\u043D\u0435\u0437\u043D\u0430\u0447\u043D\u0438\u0439"]}}});var K_=v(()=>{});function Z_(){return Object.values(Jv).map(n=>({value:n.code,label:n.name}))}function J_(n){return Jv[n]||Jv.en}var Jv,Xv=v(()=>{x_();__();P_();R_();O_();F_();H_();W_();j_();Y_();q_();Q_();K_();Jv={en:C_,es:M_,fr:A_,de:I_,ru:N_,zh:L_,ja:B_,it:U_,nl:$_,pt:V_,sv:z_,uk:G_}});async function ta(n,e){return new eT(n,e).show()}var Np,eT,Op=v(()=>{Np=require("obsidian"),eT=class extends Np.Modal{constructor(e,t){super(e),this.options={confirmText:"Confirm",cancelText:"Cancel",isDestructive:!1,...t}}show(){return new Promise(e=>{this.resolve=e,this.open()})}onOpen(){let{contentEl:e}=this;e.empty(),new Np.Setting(e).setName(this.options.title).setHeading(),e.createEl("p",{text:this.options.message});let t=e.createEl("div",{cls:"modal-button-container"});t.style.display="flex",t.style.gap="10px",t.style.justifyContent="flex-end",t.style.marginTop="20px";let r=t.createEl("button",{text:this.options.cancelText});r.addEventListener("click",()=>{this.resolve(!1),this.close()});let s=t.createEl("button",{text:this.options.confirmText,cls:this.options.isDestructive?"mod-warning":"mod-cta"});this.options.isDestructive&&(s.style.backgroundColor="var(--color-red)",s.style.color="white"),s.addEventListener("click",()=>{this.resolve(!0),this.close()}),r.focus()}onClose(){let{contentEl:e}=this;e.empty(),this.resolve&&this.resolve(!1)}}});function Ns(n){if(!n){let t=new Error("Date string cannot be empty");throw console.error("Date parsing error:",{dateString:n,error:t.message}),t}let e=n.trim();try{let t=e.match(/^(\d{4}-\d{2}-\d{2})\s+(Mon|Tue|Wed|Thu|Fri|Sat|Sun|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)$/i);if(t){let r=t[1];return Ns(r)}if(e.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(e)){let r=new Error(`Invalid date format - time without date: ${n}`);throw console.warn("Date parsing error - incomplete time format:",{original:n,trimmed:e,error:r.message}),r}if(/^\d{4}-W\d{2}$/.test(e)){let[r,s]=e.split("-W"),i=parseInt(r,10),a=parseInt(s,10);if(isNaN(i)||isNaN(a)){let u=new Error(`Invalid numeric values in ISO week format: ${n}`);throw console.warn("Date parsing error - invalid ISO week numbers:",{original:n,year:r,week:s,yearNum:i,weekNum:a}),u}if(a<1||a>53){let u=new Error(`Invalid week number in ISO week format: ${n} (week must be 1-53)`);throw console.warn("Date parsing error - week number out of range:",{original:n,weekNum:a,error:u.message}),u}let o=new Date(i,0,4),l=o.getDay(),c=new Date(o);c.setDate(o.getDate()-(l===0?6:l-1));let d=new Date(c);if(d.setDate(c.getDate()+(a-1)*7),!Lr(d)){let u=new Error(`Failed to calculate date from ISO week format: ${n}`);throw console.error("Date parsing error - ISO week calculation failed:",{original:n,yearNum:i,weekNum:a,jan4:o.toISOString(),targetWeekMonday:d.toString()}),u}return d}if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}(:\d{2})?/.test(e)){let r=e.replace(" ","T"),s=Qa(r);if(!Lr(s)){let i=new Error(`Invalid space-separated datetime: ${n}`);throw console.warn("Date parsing error - space-separated datetime invalid:",{original:n,converted:r,error:i.message}),i}return s}if(e.includes("T")||e.includes("Z")||e.match(/[+-]\d{2}:\d{2}$/)){let r=Qa(e);if(!Lr(r)){let s=new Error(`Invalid timezone-aware date: ${n}`);throw console.warn("Date parsing error - timezone-aware format invalid:",{original:n,trimmed:e,error:s.message}),s}return r}else{let r=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!r){let l=new Error(`Invalid date-only string: ${n} (expected format: yyyy-MM-dd)`);throw console.warn("Date parsing error - date-only format invalid:",{original:n,trimmed:e,expectedFormat:"yyyy-MM-dd",error:l.message}),l}let[,s,i,a]=r,o=new Date(parseInt(s,10),parseInt(i,10)-1,parseInt(a,10));if(!Lr(o)||o.getFullYear()!==parseInt(s,10)||o.getMonth()!==parseInt(i,10)-1||o.getDate()!==parseInt(a,10)){let l=new Error(`Invalid date values: ${n}`);throw console.warn("Date parsing error - invalid date values:",{original:n,year:s,month:i,day:a,error:l.message}),l}return o}}catch(t){if(t instanceof Error&&t.message.includes("Invalid date"))throw t;let r=new Error(`Unexpected error parsing date "${n}": ${t instanceof Error?t.message:String(t)}`);throw console.error("Unexpected date parsing error:",{original:n,trimmed:e,error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0}),r}}function qe(n){if(!n){let t=new Error("Date string cannot be empty");throw console.error("Date parsing error:",{dateString:n,error:t.message}),t}let e=n.trim();try{let t=e.match(/^(\d{4}-\d{2}-\d{2})\s+(Mon|Tue|Wed|Thu|Fri|Sat|Sun|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)$/i);if(t){let s=t[1];return qe(s)}let r=e.match(/^(\d{4})-(\d{2})-(\d{2})$/);if(r){let[,s,i,a]=r,o=parseInt(s,10),l=parseInt(i,10),c=parseInt(a,10);if(l<1||l>12)throw new Error(`Invalid month in date: ${n}`);if(c<1||c>31)throw new Error(`Invalid day in date: ${n}`);let d=new Date(Date.UTC(o,l-1,c));if(d.getUTCFullYear()!==o||d.getUTCMonth()!==l-1||d.getUTCDate()!==c)throw new Error(`Invalid date values: ${n}`);return d}return $t(e)}catch(t){let r=new Error(`Failed to parse date to UTC: ${e}`);throw console.error("Date parsing error:",{dateString:n,trimmed:e,error:t instanceof Error?t.message:String(t),stack:t instanceof Error?t.stack:void 0}),r}}function rr(n,e){try{let t=ve(n),r=ve(e),s=qe(t),i=qe(r);return s.getTime()===i.getTime()}catch(t){return console.error("Error comparing dates:",{date1:n,date2:e,error:t}),!1}}function On(n,e){try{let t=ve(n),r=ve(e),s=qe(t),i=qe(r);return s.getTime()<i.getTime()}catch(t){return console.error("Error comparing dates for before:",{date1:n,date2:e,error:t}),!1}}function Kt(){return x(new Date,"yyyy-MM-dd")}function Ge(){let n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate())}function Ml(n){if(!n)throw new Error("Date string cannot be empty");let t=n.trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(t){let[,r,s,i]=t,a=new Date(parseInt(r,10),parseInt(s,10)-1,parseInt(i,10));if(!Lr(a)||a.getFullYear()!==parseInt(r,10)||a.getMonth()!==parseInt(s,10)-1||a.getDate()!==parseInt(i,10))throw new Error(`Invalid date values: ${n}`);return a}return Ns(n)}function iT(n,e,t){return new Date(n,e,t)}function wd(n,e,t){return new Date(Date.UTC(n,e,t))}function ro(n){let e=n.getUTCFullYear(),t=n.getUTCMonth(),r=n.getUTCDate();return new Date(e,t,r)}function nA(n){if(!n||n.trim()==="")return!0;try{return Ns(n),!0}catch(e){return!1}}function xl(n,e){try{let t=Ns(n),r=Or(t,e);return x(r,"yyyy-MM-dd")}catch(t){throw console.error("Error adding days to date string:",{dateString:n,days:e,error:t}),t}}function iA(n,e){try{let t=Ns(n),r=yD(t,e);return x(r,"yyyy-MM-dd")}catch(t){throw console.error("Error adding weeks to date string:",{dateString:n,weeks:e,error:t}),t}}function jp(n){try{return qe(n)}catch(e){throw console.error("Error getting start of day for date string:",{dateString:n,error:e}),e}}function sa(n){if(!n)return!1;try{let e=Ml(n),t=Ge();return nd(e,t)}catch(e){return console.error("Error checking if date is today:",{dateString:n,error:e}),!1}}function _l(n){return On(n,Kt())}function hs(n,e="MMM d, yyyy"){try{let t=Ns(n);return x(t,e)}catch(t){return console.error("Error formatting date for display:",{dateString:n,error:t}),n}}function Le(){let n=new Date,e=-n.getTimezoneOffset(),t=e>=0?"+":"-",r=f=>String(Math.abs(f)).padStart(2,"0"),s=r(Math.floor(Math.abs(e)/60)),i=r(Math.abs(e)%60),a=n.getFullYear(),o=r(n.getMonth()+1),l=r(n.getDate()),c=r(n.getHours()),d=r(n.getMinutes()),u=r(n.getSeconds()),h=String(n.getMilliseconds()).padStart(3,"0");return`${a}-${o}-${l}T${c}:${d}:${u}.${h}${t}${s}:${i}`}function Vp(){let n=new Date,e=n.getFullYear(),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");return`${e}-${t}-${r}`}function aT(n){try{if(!n)throw new Error("Timestamp string cannot be empty");let e=Qa(n);if(!Lr(e))throw new Error(`Invalid timestamp: ${n}`);return e}catch(e){throw console.error("Error parsing timestamp:",{timestampString:n,error:e}),e}}function oT(n,e="MMM d, yyyy h:mm a"){if(!n)return n;try{let t=aT(n);return Lr(t)?x(t,e):n}catch(t){return console.error("Error formatting timestamp for display:",{timestampString:n,error:t}),n}}function Wt(n){return n?/T\d{2}:\d{2}/.test(n):!1}function ve(n){if(!n)return"";try{if(/^\d{4}-\d{2}-\d{2}$/.test(n))return n;let e=n.indexOf("T");if(e>-1)return n.substring(0,e);let t=qe(n);return me(t)}catch(e){return console.error("Error extracting date part:",{dateString:n,error:e}),n}}function Er(n){if(!n||!Wt(n))return null;try{let e=Ns(n);return x(e,"HH:mm")}catch(e){return console.error("Error extracting time part:",{dateString:n,error:e}),null}}function Fr(n,e){if(!n)return"";if(!e)return n;try{let t=n.match(/^(\d{4}-\d{2}-\d{2})$/);if(t)return/^\d{2}:\d{2}$/.test(e)?`${t[1]}T${e}`:(console.warn("Invalid time format, expected HH:mm:",e),n);let r=ve(n);return!r||!/^\d{4}-\d{2}-\d{2}$/.test(r)?(console.warn("Invalid date part from dateString:",{dateString:n,datePart:r}),n):/^\d{2}:\d{2}$/.test(e)?`${r}T${e}`:(console.warn("Invalid time format, expected HH:mm:",e),n)}catch(t){return console.error("Error combining date and time:",{dateString:n,timeString:e,error:t}),n}}function pr(n,e={}){if(!n)return"";let{dateFormat:t="MMM d, yyyy",timeFormat:r="h:mm a",showTime:s=!0}=e;try{let i=Ns(n);return Wt(n)&&s?!t||t.trim()===""?x(i,r):x(i,`${t} ${r}`):!t||t.trim()===""?"":x(i,t)}catch(i){return console.error("Error formatting datetime for display:",{dateString:n,error:i}),n}}function na(n,e){try{let t=qe(n),r=qe(e),s=t,i=r;if(Wt(n)){let a=Er(n);if(a){let[o,l]=a.split(":").map(Number);s=new Date(t),s.setUTCHours(o,l,0,0)}}if(Wt(e)){let a=Er(e);if(a){let[o,l]=a.split(":").map(Number);i=new Date(r),i.setUTCHours(o,l,0,0)}}return Wt(n)&&!Wt(e)?(i=new Date(r),i.setUTCHours(23,59,59,999)):!Wt(n)&&Wt(e)&&(s=new Date(t),s.setUTCHours(23,59,59,999)),s.getTime()<i.getTime()}catch(t){return console.error("Error comparing dates time-aware:",{date1:n,date2:e,error:t}),!1}}function Ln(n,e,t){if(!n||t&&e)return!1;try{let r=new Date,s=qe(n);if(Wt(n))return Sp(s,r);{let i=hr(new Date);return Sp(s,i)}}catch(r){return console.error("Error checking overdue status:",{dateString:n,error:r}),!1}}function lT(n){if(!n)return!1;try{let e=Wt(n)?Ns(n):Ml(n);return nd(e,new Date)}catch(e){return console.error("Error checking if today:",{dateString:n,error:e}),!1}}function Yp(n,e){if(!n||n.trim()==="")return!0;try{if(!nA(n))return!1;if(e&&e.trim()!==""){if(!/^\d{2}:\d{2}$/.test(e))return!1;let t=Fr(n,e);return nA(t)}return!0}catch(t){return!1}}function aA(n){return Array.isArray(n)?n.filter(e=>{if(typeof e!="string"||!e.trim())return!1;let t=e.trim();if(t.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(t)||!/^\d{4}-\d{2}-\d{2}$/.test(t))return!1;try{return Ns(t),!0}catch(r){return console.warn("Invalid complete_instances entry (date parsing failed):",e,r),!1}}).map(e=>e.trim()):[]}function us(n){try{let e=n.match(/^(\d{4})-(\d{2})-(\d{2})/);if(!e)throw new Error(`Invalid date format for RRULE: ${n}`);let[,t,r,s]=e,i=parseInt(t,10),a=parseInt(r,10),o=parseInt(s,10);if(a<1||a>12)throw new Error(`Invalid month in date: ${n}`);if(o<1||o>31)throw new Error(`Invalid day in date: ${n}`);let l=new Date(Date.UTC(i,a-1,o));if(l.getUTCFullYear()!==i||l.getUTCMonth()!==a-1||l.getUTCDate()!==o)throw new Error(`Invalid date values: ${n}`);return l}catch(e){throw console.error("Error creating UTC date for RRULE:",{dateString:n,error:e}),e}}function wt(n){let e=n.getFullYear(),t=n.getMonth(),r=n.getDate();return new Date(Date.UTC(e,t,r,0,0,0,0))}function bd(n){try{let e=Ge(),t=wt(e);return n.getUTCFullYear()===t.getUTCFullYear()&&n.getUTCMonth()===t.getUTCMonth()&&n.getUTCDate()===t.getUTCDate()}catch(e){return console.error("Error in isTodayUTC:",e),!1}}function oA(n,e){try{let t=x(n,"yyyy-MM-dd"),r=x(e,"yyyy-MM-dd"),s=us(t),i=us(r);return{utcStart:s,utcEnd:i}}catch(t){throw console.error("Error normalizing calendar boundaries to UTC:",{startDate:n,endDate:e,error:t}),t}}function lA(n){try{let e=n.getUTCFullYear(),t=String(n.getUTCMonth()+1).padStart(2,"0"),r=String(n.getUTCDate()).padStart(2,"0");return`${e}-${t}-${r}`}catch(e){return console.error("Error formatting date as UTC string:",{date:n,error:e}),n.toISOString().split("T")[0]}}function me(n){try{if(!n||!(n instanceof Date)||isNaN(n.getTime()))return console.warn("formatDateForStorage received invalid date:",n),"";let e=n.getUTCFullYear(),t=String(n.getUTCMonth()+1).padStart(2,"0"),r=String(n.getUTCDate()).padStart(2,"0");return`${e}-${t}-${r}`}catch(e){return console.error("Error formatting date for storage:",{date:n,error:e}),""}}function cA(n,e){let t=[],r=me(n),s=me(e),i=us(r),a=us(s);for(;i<=a;)t.push(new Date(i)),i.setUTCDate(i.getUTCDate()+1);return t}function cT(n,e=1){let t=us(me(n)),s=(t.getUTCDay()-e+7)%7,i=new Date(t);return i.setUTCDate(i.getUTCDate()-s),i}function dA(n,e=1){let t=cT(n,e),r=new Date(t);return r.setUTCDate(r.getUTCDate()+6),r}function dT(n){let e=us(me(n));return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),1))}function uT(n){let e=us(me(n));return new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth()+1,0))}function hT(n){if(!n||typeof n!="string")return!1;let e=n.toLowerCase().trim().replace(/\s+/g," ");return e in nT?!0:[/^in\s+(\d+)\s+(days?)$/,/^(\d+)\s+(days?)\s+ago$/,/^in\s+(\d+)\s+(weeks?)$/,/^(\d+)\s+(weeks?)\s+ago$/].some(r=>r.test(e))}function fT(n){if(typeof n!="string")return!1;let e=n.trim();if(e===""||hT(e))return!0;try{let t=Ns(e);return Lr(t)}catch(t){return!1}}function Al(n){if(!n||typeof n!="string")return n;let e=n.toLowerCase().trim().replace(/\s+/g," ");if(e in nT)try{return nT[e]()}catch(t){return console.error("Error resolving natural language date:",{value:n,error:t}),n}try{let t=e.match(/^in\s+(\d+)\s+(days?)$/);if(t){let r=parseInt(t[1],10);return xl(Kt(),r)}if(t=e.match(/^(\d+)\s+(days?)\s+ago$/),t){let r=parseInt(t[1],10);return xl(Kt(),-r)}if(t=e.match(/^in\s+(\d+)\s+(weeks?)$/),t){let r=parseInt(t[1],10);return iA(Kt(),r)}if(t=e.match(/^(\d+)\s+(weeks?)\s+ago$/),t){let r=parseInt(t[1],10);return iA(Kt(),-r)}}catch(t){console.error("Error parsing relative natural language date:",{value:n,error:t})}return n}var $t,nT,Fe=v(()=>{At();$t=Ns;nT={today:()=>Kt(),tomorrow:()=>xl(Kt(),1),yesterday:()=>xl(Kt(),-1),"next week":()=>xl(Kt(),7),"last week":()=>xl(Kt(),-7)}});var kd,jt,so=v(()=>{kd=["MO","TU","WE","TH","FR","SA","SU"],jt=(function(){function n(e,t){if(t===0)throw new Error("Can't create weekday with n == 0");this.weekday=e,this.n=t}return n.fromStr=function(e){return new n(kd.indexOf(e))},n.prototype.nth=function(e){return this.n===e?this:new n(this.weekday,e)},n.prototype.equals=function(e){return this.weekday===e.weekday&&this.n===e.n},n.prototype.toString=function(){var e=kd[this.weekday];return this.n&&(e=(this.n>0?"+":"")+String(this.n)+e),e},n.prototype.getJsWeekday=function(){return this.weekday===6?0:this.weekday+1},n})()});function no(n,e,t){t===void 0&&(t=" ");var r=String(n);return e=e>>0,r.length>e?String(r):(e=e-r.length,e>t.length&&(t+=Be(t,e/t.length)),t.slice(0,e)+String(r))}var ut,fs,pT,mr,Os,Be,uA,hA,Sr,zp,ps,Ot,We,Br=v(()=>{so();ut=function(n){return n!=null},fs=function(n){return typeof n=="number"},pT=function(n){return typeof n=="string"&&kd.includes(n)},mr=Array.isArray,Os=function(n,e){e===void 0&&(e=n),arguments.length===1&&(e=n,n=0);for(var t=[],r=n;r<e;r++)t.push(r);return t},Be=function(n,e){var t=0,r=[];if(mr(n))for(;t<e;t++)r[t]=[].concat(n);else for(;t<e;t++)r[t]=n;return r},uA=function(n){return mr(n)?n:[n]};hA=function(n,e,t){var r=n.split(e);return t?r.slice(0,t).concat([r.slice(t).join(e)]):r},Sr=function(n,e){var t=n%e;return t*e<0?t+e:t},zp=function(n,e){return{div:Math.floor(n/e),mod:Sr(n,e)}},ps=function(n){return!ut(n)||n.length===0},Ot=function(n){return!ps(n)},We=function(n,e){return Ot(n)&&n.indexOf(e)!==-1}});var Fn,wW,pA,qp,mA,bW,Pl,mT,io,kW,Ed,Gp,EW,hi,gT,Qp,Kp,yT,fi,Il,Sd,fA,gA,Dr=v(()=>{Br();Fn=function(n,e,t,r,s,i){return r===void 0&&(r=0),s===void 0&&(s=0),i===void 0&&(i=0),new Date(Date.UTC(n,e-1,t,r,s,i))},wW=[31,28,31,30,31,30,31,31,30,31,30,31],pA=1e3*60*60*24,qp=9999,mA=Fn(1970,1,1),bW=[6,0,1,2,3,4,5],Pl=function(n){return n%4===0&&n%100!==0||n%400===0},mT=function(n){return n instanceof Date},io=function(n){return mT(n)&&!isNaN(n.getTime())},kW=function(n,e){var t=n.getTime(),r=e.getTime(),s=t-r;return Math.round(s/pA)},Ed=function(n){return kW(n,mA)},Gp=function(n){return new Date(mA.getTime()+n*pA)},EW=function(n){var e=n.getUTCMonth();return e===1&&Pl(n.getUTCFullYear())?29:wW[e]},hi=function(n){return bW[n.getUTCDay()]},gT=function(n,e){var t=Fn(n,e+1,1);return[hi(t),EW(t)]},Qp=function(n,e){return e=e||n,new Date(Date.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()))},Kp=function(n){var e=new Date(n.getTime());return e},yT=function(n){for(var e=[],t=0;t<n.length;t++)e.push(Kp(n[t]));return e},fi=function(n){n.sort(function(e,t){return e.getTime()-t.getTime()})},Il=function(n,e){e===void 0&&(e=!0);var t=new Date(n);return[no(t.getUTCFullYear().toString(),4,"0"),no(t.getUTCMonth()+1,2,"0"),no(t.getUTCDate(),2,"0"),"T",no(t.getUTCHours(),2,"0"),no(t.getUTCMinutes(),2,"0"),no(t.getUTCSeconds(),2,"0"),e?"Z":""].join("")},Sd=function(n){var e=/^(\d{4})(\d{2})(\d{2})(T(\d{2})(\d{2})(\d{2})Z?)?$/,t=e.exec(n);if(!t)throw new Error("Invalid UNTIL value: ".concat(n));return new Date(Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[5],10)||0,parseInt(t[6],10)||0,parseInt(t[7],10)||0))},fA=function(n,e){var t=n.toLocaleString("sv-SE",{timeZone:e});return t.replace(" ","T")+"Z"},gA=function(n,e){var t=Intl.DateTimeFormat().resolvedOptions().timeZone,r=new Date(fA(n,t)),s=new Date(fA(n,e!=null?e:"UTC")),i=s.getTime()-r.getTime();return new Date(n.getTime()-i)}});var SW,pi,Zp=v(()=>{SW=(function(){function n(e,t){this.minDate=null,this.maxDate=null,this._result=[],this.total=0,this.method=e,this.args=t,e==="between"?(this.maxDate=t.inc?t.before:new Date(t.before.getTime()-1),this.minDate=t.inc?t.after:new Date(t.after.getTime()+1)):e==="before"?this.maxDate=t.inc?t.dt:new Date(t.dt.getTime()-1):e==="after"&&(this.minDate=t.inc?t.dt:new Date(t.dt.getTime()+1))}return n.prototype.accept=function(e){++this.total;var t=this.minDate&&e<this.minDate,r=this.maxDate&&e>this.maxDate;if(this.method==="between"){if(t)return!0;if(r)return!1}else if(this.method==="before"){if(r)return!1}else if(this.method==="after")return t?!0:(this.add(e),!1);return this.add(e)},n.prototype.add=function(e){return this._result.push(e),!0},n.prototype.getValue=function(){var e=this._result;switch(this.method){case"all":case"between":return e;case"before":case"after":default:return e.length?e[e.length-1]:null}},n.prototype.clone=function(){return new n(this.method,this.args)},n})(),pi=SW});function Rl(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");vT(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function K(n,e,t){if(t||arguments.length===2)for(var r=0,s=e.length,i;r<s;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var vT,gr,mi=v(()=>{vT=function(n,e){return vT=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(t[s]=r[s])},vT(n,e)};gr=function(){return gr=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++){t=arguments[r];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},gr.apply(this,arguments)}});var DW,TT,yA=v(()=>{mi();Zp();DW=(function(n){Rl(e,n);function e(t,r,s){var i=n.call(this,t,r)||this;return i.iterator=s,i}return e.prototype.add=function(t){return this.iterator(t,this._result.length)?(this._result.push(t),!0):!1},e})(pi),TT=DW});var CW,ao,Jp=v(()=>{CW={dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],tokens:{SKIP:/^[ \r\n\t]+|^\.$/,number:/^[1-9][0-9]*/,numberAsText:/^(one|two|three)/i,every:/^every/i,"day(s)":/^days?/i,"weekday(s)":/^weekdays?/i,"week(s)":/^weeks?/i,"hour(s)":/^hours?/i,"minute(s)":/^minutes?/i,"month(s)":/^months?/i,"year(s)":/^years?/i,on:/^(on|in)/i,at:/^(at)/i,the:/^the/i,first:/^first/i,second:/^second/i,third:/^third/i,nth:/^([1-9][0-9]*)(\.|th|nd|rd|st)/i,last:/^last/i,for:/^for/i,"time(s)":/^times?/i,until:/^(un)?til/i,monday:/^mo(n(day)?)?/i,tuesday:/^tu(e(s(day)?)?)?/i,wednesday:/^we(d(n(esday)?)?)?/i,thursday:/^th(u(r(sday)?)?)?/i,friday:/^fr(i(day)?)?/i,saturday:/^sa(t(urday)?)?/i,sunday:/^su(n(day)?)?/i,january:/^jan(uary)?/i,february:/^feb(ruary)?/i,march:/^mar(ch)?/i,april:/^apr(il)?/i,may:/^may/i,june:/^june?/i,july:/^july?/i,august:/^aug(ust)?/i,september:/^sep(t(ember)?)?/i,october:/^oct(ober)?/i,november:/^nov(ember)?/i,december:/^dec(ember)?/i,comma:/^(,\s*|(and|or)\s*)+/i}},ao=CW});var vA,xW,MW,_W,Bn,TA=v(()=>{Jp();Ls();Br();vA=function(n,e){return n.indexOf(e)!==-1},xW=function(n){return n.toString()},MW=function(n,e,t){return"".concat(e," ").concat(t,", ").concat(n)},_W=(function(){function n(e,t,r,s){if(t===void 0&&(t=xW),r===void 0&&(r=ao),s===void 0&&(s=MW),this.text=[],this.language=r||ao,this.gettext=t,this.dateFormatter=s,this.rrule=e,this.options=e.options,this.origOptions=e.origOptions,this.origOptions.bymonthday){var i=[].concat(this.options.bymonthday),a=[].concat(this.options.bynmonthday);i.sort(function(d,u){return d-u}),a.sort(function(d,u){return u-d}),this.bymonthday=i.concat(a),this.bymonthday.length||(this.bymonthday=null)}if(ut(this.origOptions.byweekday)){var o=mr(this.origOptions.byweekday)?this.origOptions.byweekday:[this.origOptions.byweekday],l=String(o);this.byweekday={allWeeks:o.filter(function(d){return!d.n}),someWeeks:o.filter(function(d){return!!d.n}),isWeekdays:l.indexOf("MO")!==-1&&l.indexOf("TU")!==-1&&l.indexOf("WE")!==-1&&l.indexOf("TH")!==-1&&l.indexOf("FR")!==-1&&l.indexOf("SA")===-1&&l.indexOf("SU")===-1,isEveryDay:l.indexOf("MO")!==-1&&l.indexOf("TU")!==-1&&l.indexOf("WE")!==-1&&l.indexOf("TH")!==-1&&l.indexOf("FR")!==-1&&l.indexOf("SA")!==-1&&l.indexOf("SU")!==-1};var c=function(d,u){return d.weekday-u.weekday};this.byweekday.allWeeks.sort(c),this.byweekday.someWeeks.sort(c),this.byweekday.allWeeks.length||(this.byweekday.allWeeks=null),this.byweekday.someWeeks.length||(this.byweekday.someWeeks=null)}else this.byweekday=null}return n.isFullyConvertible=function(e){var t=!0;if(!(e.options.freq in n.IMPLEMENTED)||e.origOptions.until&&e.origOptions.count)return!1;for(var r in e.origOptions){if(vA(["dtstart","tzid","wkst","freq"],r))return!0;if(!vA(n.IMPLEMENTED[e.options.freq],r))return!1}return t},n.prototype.isFullyConvertible=function(){return n.isFullyConvertible(this.rrule)},n.prototype.toString=function(){var e=this.gettext;if(!(this.options.freq in n.IMPLEMENTED))return e("RRule error: Unable to fully convert this rrule to text");if(this.text=[e("every")],this[Z.FREQUENCIES[this.options.freq]](),this.options.until){this.add(e("until"));var t=this.options.until;this.add(this.dateFormatter(t.getUTCFullYear(),this.language.monthNames[t.getUTCMonth()],t.getUTCDate()))}else this.options.count&&this.add(e("for")).add(this.options.count.toString()).add(this.plural(this.options.count)?e("times"):e("time"));return this.isFullyConvertible()||this.add(e("(~ approximate)")),this.text.join("")},n.prototype.HOURLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("hours"):e("hour"))},n.prototype.MINUTELY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("minutes"):e("minute"))},n.prototype.DAILY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()),this.byweekday&&this.byweekday.isWeekdays?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(this.plural(this.options.interval)?e("days"):e("day")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday?this._byweekday():this.origOptions.byhour&&this._byhour()},n.prototype.WEEKLY=function(){var e=this.gettext;this.options.interval!==1&&this.add(this.options.interval.toString()).add(this.plural(this.options.interval)?e("weeks"):e("week")),this.byweekday&&this.byweekday.isWeekdays?this.options.interval===1?this.add(this.plural(this.options.interval)?e("weekdays"):e("weekday")):this.add(e("on")).add(e("weekdays")):this.byweekday&&this.byweekday.isEveryDay?this.add(this.plural(this.options.interval)?e("days"):e("day")):(this.options.interval===1&&this.add(e("week")),this.origOptions.bymonth&&(this.add(e("in")),this._bymonth()),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.origOptions.byhour&&this._byhour())},n.prototype.MONTHLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()).add(e("months")),this.plural(this.options.interval)&&this.add(e("in"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("months"):e("month"))),this.bymonthday?this._bymonthday():this.byweekday&&this.byweekday.isWeekdays?this.add(e("on")).add(e("weekdays")):this.byweekday&&this._byweekday()},n.prototype.YEARLY=function(){var e=this.gettext;this.origOptions.bymonth?(this.options.interval!==1&&(this.add(this.options.interval.toString()),this.add(e("years"))),this._bymonth()):(this.options.interval!==1&&this.add(this.options.interval.toString()),this.add(this.plural(this.options.interval)?e("years"):e("year"))),this.bymonthday?this._bymonthday():this.byweekday&&this._byweekday(),this.options.byyearday&&this.add(e("on the")).add(this.list(this.options.byyearday,this.nth,e("and"))).add(e("day")),this.options.byweekno&&this.add(e("in")).add(this.plural(this.options.byweekno.length)?e("weeks"):e("week")).add(this.list(this.options.byweekno,void 0,e("and")))},n.prototype._bymonthday=function(){var e=this.gettext;this.byweekday&&this.byweekday.allWeeks?this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext,e("or"))).add(e("the")).add(this.list(this.bymonthday,this.nth,e("or"))):this.add(e("on the")).add(this.list(this.bymonthday,this.nth,e("and")))},n.prototype._byweekday=function(){var e=this.gettext;this.byweekday.allWeeks&&!this.byweekday.isWeekdays&&this.add(e("on")).add(this.list(this.byweekday.allWeeks,this.weekdaytext)),this.byweekday.someWeeks&&(this.byweekday.allWeeks&&this.add(e("and")),this.add(e("on the")).add(this.list(this.byweekday.someWeeks,this.weekdaytext,e("and"))))},n.prototype._byhour=function(){var e=this.gettext;this.add(e("at")).add(this.list(this.origOptions.byhour,void 0,e("and")))},n.prototype._bymonth=function(){this.add(this.list(this.options.bymonth,this.monthtext,this.gettext("and")))},n.prototype.nth=function(e){e=parseInt(e.toString(),10);var t,r=this.gettext;if(e===-1)return r("last");var s=Math.abs(e);switch(s){case 1:case 21:case 31:t=s+r("st");break;case 2:case 22:t=s+r("nd");break;case 3:case 23:t=s+r("rd");break;default:t=s+r("th")}return e<0?t+" "+r("last"):t},n.prototype.monthtext=function(e){return this.language.monthNames[e-1]},n.prototype.weekdaytext=function(e){var t=fs(e)?(e+1)%7:e.getJsWeekday();return(e.n?this.nth(e.n)+" ":"")+this.language.dayNames[t]},n.prototype.plural=function(e){return e%100!==1},n.prototype.add=function(e){return this.text.push(" "),this.text.push(e),this},n.prototype.list=function(e,t,r,s){var i=this;s===void 0&&(s=","),mr(e)||(e=[e]);var a=function(l,c,d){for(var u="",h=0;h<l.length;h++)h!==0&&(h===l.length-1?u+=" "+d+" ":u+=c+" "),u+=l[h];return u};t=t||function(l){return l.toString()};var o=function(l){return t&&t.call(i,l)};return r?a(e.map(o),s,r):e.map(o).join(s+" ")},n})(),Bn=_W});function Dd(n,e){e===void 0&&(e=ao);var t={},r=new AW(e.tokens);if(!r.start(n))return null;return s(),t;function s(){r.expect("every");var h=r.acceptNumber();if(h&&(t.interval=parseInt(h[0],10)),r.isDone())throw new Error("Unexpected end");switch(r.symbol){case"day(s)":t.freq=Z.DAILY,r.nextSymbol()&&(a(),u());break;case"weekday(s)":t.freq=Z.WEEKLY,t.byweekday=[Z.MO,Z.TU,Z.WE,Z.TH,Z.FR],r.nextSymbol(),a(),u();break;case"week(s)":t.freq=Z.WEEKLY,r.nextSymbol()&&(i(),a(),u());break;case"hour(s)":t.freq=Z.HOURLY,r.nextSymbol()&&(i(),u());break;case"minute(s)":t.freq=Z.MINUTELY,r.nextSymbol()&&(i(),u());break;case"month(s)":t.freq=Z.MONTHLY,r.nextSymbol()&&(i(),u());break;case"year(s)":t.freq=Z.YEARLY,r.nextSymbol()&&(i(),u());break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":t.freq=Z.WEEKLY;var f=r.symbol.substr(0,2).toUpperCase();if(t.byweekday=[Z[f]],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var p=l();if(!p)throw new Error("Unexpected symbol "+r.symbol+", expected weekday");t.byweekday.push(Z[p]),r.nextSymbol()}a(),d(),u();break;case"january":case"february":case"march":case"april":case"may":case"june":case"july":case"august":case"september":case"october":case"november":case"december":if(t.freq=Z.YEARLY,t.bymonth=[o()],!r.nextSymbol())return;for(;r.accept("comma");){if(r.isDone())throw new Error("Unexpected end");var m=o();if(!m)throw new Error("Unexpected symbol "+r.symbol+", expected month");t.bymonth.push(m),r.nextSymbol()}i(),u();break;default:throw new Error("Unknown symbol")}}function i(){var h=r.accept("on"),f=r.accept("the");if(h||f)do{var p=c(),m=l(),g=o();if(p)m?(r.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(Z[m].nth(p))):(t.bymonthday||(t.bymonthday=[]),t.bymonthday.push(p),r.accept("day(s)"));else if(m)r.nextSymbol(),t.byweekday||(t.byweekday=[]),t.byweekday.push(Z[m]);else if(r.symbol==="weekday(s)")r.nextSymbol(),t.byweekday||(t.byweekday=[Z.MO,Z.TU,Z.WE,Z.TH,Z.FR]);else if(r.symbol==="week(s)"){r.nextSymbol();var y=r.acceptNumber();if(!y)throw new Error("Unexpected symbol "+r.symbol+", expected week number");for(t.byweekno=[parseInt(y[0],10)];r.accept("comma");){if(y=r.acceptNumber(),!y)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");t.byweekno.push(parseInt(y[0],10))}}else if(g)r.nextSymbol(),t.bymonth||(t.bymonth=[]),t.bymonth.push(g);else return}while(r.accept("comma")||r.accept("the")||r.accept("on"))}function a(){var h=r.accept("at");if(h)do{var f=r.acceptNumber();if(!f)throw new Error("Unexpected symbol "+r.symbol+", expected hour");for(t.byhour=[parseInt(f[0],10)];r.accept("comma");){if(f=r.acceptNumber(),!f)throw new Error("Unexpected symbol "+r.symbol+"; expected hour");t.byhour.push(parseInt(f[0],10))}}while(r.accept("comma")||r.accept("at"))}function o(){switch(r.symbol){case"january":return 1;case"february":return 2;case"march":return 3;case"april":return 4;case"may":return 5;case"june":return 6;case"july":return 7;case"august":return 8;case"september":return 9;case"october":return 10;case"november":return 11;case"december":return 12;default:return!1}}function l(){switch(r.symbol){case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":return r.symbol.substr(0,2).toUpperCase();default:return!1}}function c(){switch(r.symbol){case"last":return r.nextSymbol(),-1;case"first":return r.nextSymbol(),1;case"second":return r.nextSymbol(),r.accept("last")?-2:2;case"third":return r.nextSymbol(),r.accept("last")?-3:3;case"nth":var h=parseInt(r.value[1],10);if(h<-366||h>366)throw new Error("Nth out of range: "+h);return r.nextSymbol(),r.accept("last")?-h:h;default:return!1}}function d(){r.accept("on"),r.accept("the");var h=c();if(h)for(t.bymonthday=[h],r.nextSymbol();r.accept("comma");){if(h=c(),!h)throw new Error("Unexpected symbol "+r.symbol+"; expected monthday");t.bymonthday.push(h),r.nextSymbol()}}function u(){if(r.symbol==="until"){var h=Date.parse(r.text);if(!h)throw new Error("Cannot parse until date:"+r.text);t.until=new Date(h)}else r.accept("for")&&(t.count=parseInt(r.value[0],10),r.expect("number"))}}var AW,wA=v(()=>{Jp();Ls();AW=(function(){function n(e){this.done=!0,this.rules=e}return n.prototype.start=function(e){return this.text=e,this.done=!1,this.nextSymbol()},n.prototype.isDone=function(){return this.done&&this.symbol===null},n.prototype.nextSymbol=function(){var e,t;this.symbol=null,this.value=null;do{if(this.done)return!1;var r=void 0;e=null;for(var s in this.rules){r=this.rules[s];var i=r.exec(this.text);i&&(e===null||i[0].length>e[0].length)&&(e=i,t=s)}if(e!=null&&(this.text=this.text.substr(e[0].length),this.text===""&&(this.done=!0)),e==null){this.done=!0,this.symbol=null,this.value=null;return}}while(t==="SKIP");return this.symbol=t,this.value=e,!0},n.prototype.accept=function(e){if(this.symbol===e){if(this.value){var t=this.value;return this.nextSymbol(),t}return this.nextSymbol(),!0}return!1},n.prototype.acceptNumber=function(){return this.accept("number")},n.prototype.expect=function(e){if(this.accept(e))return!0;throw new Error("expected "+e+" but found "+this.symbol)},n})()});function Cd(n){return n<Ae.HOURLY}var Ae,gi=v(()=>{(function(n){n[n.YEARLY=0]="YEARLY",n[n.MONTHLY=1]="MONTHLY",n[n.WEEKLY=2]="WEEKLY",n[n.DAILY=3]="DAILY",n[n.HOURLY=4]="HOURLY",n[n.MINUTELY=5]="MINUTELY",n[n.SECONDLY=6]="SECONDLY"})(Ae||(Ae={}))});var bA,Nl,kA,EA,SA=v(()=>{TA();wA();Ls();gi();Jp();bA=function(n,e){return e===void 0&&(e=ao),new Z(Dd(n,e)||void 0)},Nl=["count","until","interval","byweekday","bymonthday","bymonth"];Bn.IMPLEMENTED=[];Bn.IMPLEMENTED[Ae.HOURLY]=Nl;Bn.IMPLEMENTED[Ae.MINUTELY]=Nl;Bn.IMPLEMENTED[Ae.DAILY]=["byhour"].concat(Nl);Bn.IMPLEMENTED[Ae.WEEKLY]=Nl;Bn.IMPLEMENTED[Ae.MONTHLY]=Nl;Bn.IMPLEMENTED[Ae.YEARLY]=["byweekno","byyearday"].concat(Nl);kA=function(n,e,t,r){return new Bn(n,e,t,r).toString()},EA=Bn.isFullyConvertible});var Ol,DA,Xp=v(()=>{mi();gi();Br();Dr();Ol=(function(){function n(e,t,r,s){this.hour=e,this.minute=t,this.second=r,this.millisecond=s||0}return n.prototype.getHours=function(){return this.hour},n.prototype.getMinutes=function(){return this.minute},n.prototype.getSeconds=function(){return this.second},n.prototype.getMilliseconds=function(){return this.millisecond},n.prototype.getTime=function(){return(this.hour*60*60+this.minute*60+this.second)*1e3+this.millisecond},n})(),DA=(function(n){Rl(e,n);function e(t,r,s,i,a,o,l){var c=n.call(this,i,a,o,l)||this;return c.year=t,c.month=r,c.day=s,c}return e.fromDate=function(t){return new this(t.getUTCFullYear(),t.getUTCMonth()+1,t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.valueOf()%1e3)},e.prototype.getWeekday=function(){return hi(new Date(this.getTime()))},e.prototype.getTime=function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond)).getTime()},e.prototype.getDay=function(){return this.day},e.prototype.getMonth=function(){return this.month},e.prototype.getYear=function(){return this.year},e.prototype.addYears=function(t){this.year+=t},e.prototype.addMonths=function(t){if(this.month+=t,this.month>12){var r=Math.floor(this.month/12),s=Sr(this.month,12);this.month=s,this.year+=r,this.month===0&&(this.month=12,--this.year)}},e.prototype.addWeekly=function(t,r){r>this.getWeekday()?this.day+=-(this.getWeekday()+1+(6-r))+t*7:this.day+=-(this.getWeekday()-r)+t*7,this.fixDay()},e.prototype.addDaily=function(t){this.day+=t,this.fixDay()},e.prototype.addHours=function(t,r,s){for(r&&(this.hour+=Math.floor((23-this.hour)/t)*t);;){this.hour+=t;var i=zp(this.hour,24),a=i.div,o=i.mod;if(a&&(this.hour=o,this.addDaily(a)),ps(s)||We(s,this.hour))break}},e.prototype.addMinutes=function(t,r,s,i){for(r&&(this.minute+=Math.floor((1439-(this.hour*60+this.minute))/t)*t);;){this.minute+=t;var a=zp(this.minute,60),o=a.div,l=a.mod;if(o&&(this.minute=l,this.addHours(o,!1,s)),(ps(s)||We(s,this.hour))&&(ps(i)||We(i,this.minute)))break}},e.prototype.addSeconds=function(t,r,s,i,a){for(r&&(this.second+=Math.floor((86399-(this.hour*3600+this.minute*60+this.second))/t)*t);;){this.second+=t;var o=zp(this.second,60),l=o.div,c=o.mod;if(l&&(this.second=c,this.addMinutes(l,!1,s,i)),(ps(s)||We(s,this.hour))&&(ps(i)||We(i,this.minute))&&(ps(a)||We(a,this.second)))break}},e.prototype.fixDay=function(){if(!(this.day<=28)){var t=gT(this.year,this.month-1)[1];if(!(this.day<=t))for(;this.day>t;){if(this.day-=t,++this.month,this.month===13&&(this.month=1,++this.year,this.year>qp))return;t=gT(this.year,this.month-1)[1]}}},e.prototype.add=function(t,r){var s=t.freq,i=t.interval,a=t.wkst,o=t.byhour,l=t.byminute,c=t.bysecond;switch(s){case Ae.YEARLY:return this.addYears(i);case Ae.MONTHLY:return this.addMonths(i);case Ae.WEEKLY:return this.addWeekly(i,a);case Ae.DAILY:return this.addDaily(i);case Ae.HOURLY:return this.addHours(i,r,o);case Ae.MINUTELY:return this.addMinutes(i,r,o,l);case Ae.SECONDLY:return this.addSeconds(i,r,o,l,c)}},e})(Ol)});function wT(n){for(var e=[],t=Object.keys(n),r=0,s=t;r<s.length;r++){var i=s[r];We(MA,i)||e.push(i),mT(n[i])&&!io(n[i])&&e.push(i)}if(e.length)throw new Error("Invalid options: "+e.join(", "));return gr({},n)}function CA(n){var e=gr(gr({},xd),wT(n));if(ut(e.byeaster)&&(e.freq=Z.YEARLY),!(ut(e.freq)&&Z.FREQUENCIES[e.freq]))throw new Error("Invalid frequency: ".concat(e.freq," ").concat(n.freq));if(e.dtstart||(e.dtstart=new Date(new Date().setMilliseconds(0))),ut(e.wkst)?fs(e.wkst)||(e.wkst=e.wkst.weekday):e.wkst=Z.MO.weekday,ut(e.bysetpos)){fs(e.bysetpos)&&(e.bysetpos=[e.bysetpos]);for(var t=0;t<e.bysetpos.length;t++){var r=e.bysetpos[t];if(r===0||!(r>=-366&&r<=366))throw new Error("bysetpos must be between 1 and 366, or between -366 and -1")}}if(!(e.byweekno||Ot(e.byweekno)||Ot(e.byyearday)||e.bymonthday||Ot(e.bymonthday)||ut(e.byweekday)||ut(e.byeaster)))switch(e.freq){case Z.YEARLY:e.bymonth||(e.bymonth=e.dtstart.getUTCMonth()+1),e.bymonthday=e.dtstart.getUTCDate();break;case Z.MONTHLY:e.bymonthday=e.dtstart.getUTCDate();break;case Z.WEEKLY:e.byweekday=[hi(e.dtstart)];break}if(ut(e.bymonth)&&!mr(e.bymonth)&&(e.bymonth=[e.bymonth]),ut(e.byyearday)&&!mr(e.byyearday)&&fs(e.byyearday)&&(e.byyearday=[e.byyearday]),!ut(e.bymonthday))e.bymonthday=[],e.bynmonthday=[];else if(mr(e.bymonthday)){for(var s=[],i=[],t=0;t<e.bymonthday.length;t++){var r=e.bymonthday[t];r>0?s.push(r):r<0&&i.push(r)}e.bymonthday=s,e.bynmonthday=i}else e.bymonthday<0?(e.bynmonthday=[e.bymonthday],e.bymonthday=[]):(e.bynmonthday=[],e.bymonthday=[e.bymonthday]);if(ut(e.byweekno)&&!mr(e.byweekno)&&(e.byweekno=[e.byweekno]),!ut(e.byweekday))e.bynweekday=null;else if(fs(e.byweekday))e.byweekday=[e.byweekday],e.bynweekday=null;else if(pT(e.byweekday))e.byweekday=[jt.fromStr(e.byweekday).weekday],e.bynweekday=null;else if(e.byweekday instanceof jt)!e.byweekday.n||e.freq>Z.MONTHLY?(e.byweekday=[e.byweekday.weekday],e.bynweekday=null):(e.bynweekday=[[e.byweekday.weekday,e.byweekday.n]],e.byweekday=null);else{for(var a=[],o=[],t=0;t<e.byweekday.length;t++){var l=e.byweekday[t];if(fs(l)){a.push(l);continue}else if(pT(l)){a.push(jt.fromStr(l).weekday);continue}!l.n||e.freq>Z.MONTHLY?a.push(l.weekday):o.push([l.weekday,l.n])}e.byweekday=Ot(a)?a:null,e.bynweekday=Ot(o)?o:null}return ut(e.byhour)?fs(e.byhour)&&(e.byhour=[e.byhour]):e.byhour=e.freq<Z.HOURLY?[e.dtstart.getUTCHours()]:null,ut(e.byminute)?fs(e.byminute)&&(e.byminute=[e.byminute]):e.byminute=e.freq<Z.MINUTELY?[e.dtstart.getUTCMinutes()]:null,ut(e.bysecond)?fs(e.bysecond)&&(e.bysecond=[e.bysecond]):e.bysecond=e.freq<Z.SECONDLY?[e.dtstart.getUTCSeconds()]:null,{parsedOptions:e}}function xA(n){var e=n.dtstart.getTime()%1e3;if(!Cd(n.freq))return[];var t=[];return n.byhour.forEach(function(r){n.byminute.forEach(function(s){n.bysecond.forEach(function(i){t.push(new Ol(r,s,i,e))})})}),t}var bT=v(()=>{mi();gi();Br();Ls();Dr();so();Xp()});function _d(n){var e=n.split(`
`).map(PW).filter(function(t){return t!==null});return gr(gr({},e[0]),e[1])}function Md(n){var e={},t=/DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\s]+)/i.exec(n);if(!t)return e;var r=t[1],s=t[2];return r&&(e.tzid=r),e.dtstart=Sd(s),e}function PW(n){if(n=n.replace(/^\s+|\s+$/,""),!n.length)return null;var e=/^([A-Z]+?)[:;]/.exec(n.toUpperCase());if(!e)return _A(n);var t=e[1];switch(t.toUpperCase()){case"RRULE":case"EXRULE":return _A(n);case"DTSTART":return Md(n);default:throw new Error("Unsupported RFC prop ".concat(t," in ").concat(n))}}function _A(n){var e=n.replace(/^RRULE:/i,""),t=Md(e),r=n.replace(/^(?:RRULE|EXRULE):/i,"").split(";");return r.forEach(function(s){var i=s.split("="),a=i[0],o=i[1];switch(a.toUpperCase()){case"FREQ":t.freq=Ae[o.toUpperCase()];break;case"WKST":t.wkst=Fs[o.toUpperCase()];break;case"COUNT":case"INTERVAL":case"BYSETPOS":case"BYMONTH":case"BYMONTHDAY":case"BYYEARDAY":case"BYWEEKNO":case"BYHOUR":case"BYMINUTE":case"BYSECOND":var l=IW(o),c=a.toLowerCase();t[c]=l;break;case"BYWEEKDAY":case"BYDAY":t.byweekday=RW(o);break;case"DTSTART":case"TZID":var d=Md(n);t.tzid=d.tzid,t.dtstart=d.dtstart;break;case"UNTIL":t.until=Sd(o);break;case"BYEASTER":t.byeaster=Number(o);break;default:throw new Error("Unknown RRULE property '"+a+"'")}}),t}function IW(n){if(n.indexOf(",")!==-1){var e=n.split(",");return e.map(AA)}return AA(n)}function AA(n){return/^[+-]?\d+$/.test(n)?Number(n):n}function RW(n){var e=n.split(",");return e.map(function(t){if(t.length===2)return Fs[t];var r=t.match(/^([+-]?\d{1,2})([A-Z]{2})$/);if(!r||r.length<3)throw new SyntaxError("Invalid weekday string: ".concat(t));var s=Number(r[1]),i=r[2],a=Fs[i].weekday;return new jt(a,s)})}var kT=v(()=>{mi();gi();so();Dr();Ls()});var oo,em=v(()=>{Dr();oo=(function(){function n(e,t){if(isNaN(e.getTime()))throw new RangeError("Invalid date passed to DateWithZone");this.date=e,this.tzid=t}return Object.defineProperty(n.prototype,"isUTC",{get:function(){return!this.tzid||this.tzid.toUpperCase()==="UTC"},enumerable:!1,configurable:!0}),n.prototype.toString=function(){var e=Il(this.date.getTime(),this.isUTC);return this.isUTC?":".concat(e):";TZID=".concat(this.tzid,":").concat(e)},n.prototype.getTime=function(){return this.date.getTime()},n.prototype.rezonedDate=function(){return this.isUTC?this.date:gA(this.date,this.tzid)},n})()});function Ad(n){for(var e=[],t="",r=Object.keys(n),s=Object.keys(xd),i=0;i<r.length;i++)if(r[i]!=="tzid"&&We(s,r[i])){var a=r[i].toUpperCase(),o=n[r[i]],l="";if(!(!ut(o)||mr(o)&&!o.length)){switch(a){case"FREQ":l=Z.FREQUENCIES[n.freq];break;case"WKST":fs(o)?l=new jt(o).toString():l=o.toString();break;case"BYWEEKDAY":a="BYDAY",l=uA(o).map(function(f){return f instanceof jt?f:mr(f)?new jt(f[0],f[1]):new jt(f)}).toString();break;case"DTSTART":t=NW(o,n.tzid);break;case"UNTIL":l=Il(o,!n.tzid);break;default:if(mr(o)){for(var c=[],d=0;d<o.length;d++)c[d]=String(o[d]);l=c.toString()}else l=String(o)}l&&e.push([a,l])}}var u=e.map(function(f){var p=f[0],m=f[1];return"".concat(p,"=").concat(m.toString())}).join(";"),h="";return u!==""&&(h="RRULE:".concat(u)),[t,h].filter(function(f){return!!f}).join(`
`)}function NW(n,e){return n?"DTSTART"+new oo(new Date(n),e).toString():""}var ET=v(()=>{Ls();Br();so();Dr();em()});function OW(n,e){return Array.isArray(n)?!Array.isArray(e)||n.length!==e.length?!1:n.every(function(t,r){return t.getTime()===e[r].getTime()}):n instanceof Date?e instanceof Date&&n.getTime()===e.getTime():n===e}var PA,IA=v(()=>{Zp();Dr();Br();PA=(function(){function n(){this.all=!1,this.before=[],this.after=[],this.between=[]}return n.prototype._cacheAdd=function(e,t,r){t&&(t=t instanceof Date?Kp(t):yT(t)),e==="all"?this.all=t:(r._value=t,this[e].push(r))},n.prototype._cacheGet=function(e,t){var r=!1,s=t?Object.keys(t):[],i=function(d){for(var u=0;u<s.length;u++){var h=s[u];if(!OW(t[h],d[h]))return!0}return!1},a=this[e];if(e==="all")r=this.all;else if(mr(a))for(var o=0;o<a.length;o++){var l=a[o];if(!(s.length&&i(l))){r=l._value;break}}if(!r&&this.all){for(var c=new pi(e,t),o=0;o<this.all.length&&c.accept(this.all[o]);o++);r=c.getValue(),this._cacheAdd(e,r,t)}return mr(r)?yT(r):r instanceof Date?Kp(r):r},n})()});var RA,NA,LW,FW,ia,Cr,OA,LA,BW,HW,aa,xr,FA,BA,HA,UA,ST,WA=v(()=>{mi();Br();RA=K(K(K(K(K(K(K(K(K(K(K(K(K([],Be(1,31),!0),Be(2,28),!0),Be(3,31),!0),Be(4,30),!0),Be(5,31),!0),Be(6,30),!0),Be(7,31),!0),Be(8,31),!0),Be(9,30),!0),Be(10,31),!0),Be(11,30),!0),Be(12,31),!0),Be(1,7),!0),NA=K(K(K(K(K(K(K(K(K(K(K(K(K([],Be(1,31),!0),Be(2,29),!0),Be(3,31),!0),Be(4,30),!0),Be(5,31),!0),Be(6,30),!0),Be(7,31),!0),Be(8,31),!0),Be(9,30),!0),Be(10,31),!0),Be(11,30),!0),Be(12,31),!0),Be(1,7),!0),LW=Os(1,29),FW=Os(1,30),ia=Os(1,31),Cr=Os(1,32),OA=K(K(K(K(K(K(K(K(K(K(K(K(K([],Cr,!0),FW,!0),Cr,!0),ia,!0),Cr,!0),ia,!0),Cr,!0),Cr,!0),ia,!0),Cr,!0),ia,!0),Cr,!0),Cr.slice(0,7),!0),LA=K(K(K(K(K(K(K(K(K(K(K(K(K([],Cr,!0),LW,!0),Cr,!0),ia,!0),Cr,!0),ia,!0),Cr,!0),Cr,!0),ia,!0),Cr,!0),ia,!0),Cr,!0),Cr.slice(0,7),!0),BW=Os(-28,0),HW=Os(-29,0),aa=Os(-30,0),xr=Os(-31,0),FA=K(K(K(K(K(K(K(K(K(K(K(K(K([],xr,!0),HW,!0),xr,!0),aa,!0),xr,!0),aa,!0),xr,!0),xr,!0),aa,!0),xr,!0),aa,!0),xr,!0),xr.slice(0,7),!0),BA=K(K(K(K(K(K(K(K(K(K(K(K(K([],xr,!0),BW,!0),xr,!0),aa,!0),xr,!0),aa,!0),xr,!0),xr,!0),aa,!0),xr,!0),aa,!0),xr,!0),xr.slice(0,7),!0),HA=[0,31,60,91,121,152,182,213,244,274,305,335,366],UA=[0,31,59,90,120,151,181,212,243,273,304,334,365],ST=(function(){for(var n=[],e=0;e<55;e++)n=n.concat(Os(7));return n})()});function $A(n,e){var t=Fn(n,1,1),r=Pl(n)?366:365,s=Pl(n+1)?366:365,i=Ed(t),a=hi(t),o=gr(gr({yearlen:r,nextyearlen:s,yearordinal:i,yearweekday:a},UW(n)),{wnomask:null});if(ps(e.byweekno))return o;o.wnomask=Be(0,r+7);var l,c,d=l=Sr(7-a+e.wkst,7);d>=4?(d=0,c=o.yearlen+Sr(a-e.wkst,7)):c=r-d;for(var u=Math.floor(c/7),h=Sr(c,7),f=Math.floor(u+h/4),p=0;p<e.byweekno.length;p++){var m=e.byweekno[p];if(m<0&&(m+=f+1),m>0&&m<=f){var g=void 0;m>1?(g=d+(m-1)*7,d!==l&&(g-=7-l)):g=d;for(var y=0;y<7&&(o.wnomask[g]=1,g++,o.wdaymask[g]!==e.wkst);y++);}}if(We(e.byweekno,1)){var g=d+f*7;if(d!==l&&(g-=7-l),g<r)for(var p=0;p<7&&(o.wnomask[g]=1,g+=1,o.wdaymask[g]!==e.wkst);p++);}if(d){var T=void 0;if(We(e.byweekno,-1))T=-1;else{var w=hi(Fn(n-1,1,1)),b=Sr(7-w.valueOf()+e.wkst,7),S=Pl(n-1)?366:365,k=void 0;b>=4?(b=0,k=S+Sr(w-e.wkst,7)):k=r-d,T=Math.floor(52+Sr(k,7)/4)}if(We(e.byweekno,T))for(var g=0;g<d;g++)o.wnomask[g]=1}return o}function UW(n){var e=Pl(n)?366:365,t=Fn(n,1,1),r=hi(t);return e===365?{mmask:RA,mdaymask:LA,nmdaymask:BA,wdaymask:ST.slice(r),mrange:UA}:{mmask:NA,mdaymask:OA,nmdaymask:FA,wdaymask:ST.slice(r),mrange:HA}}var jA=v(()=>{mi();Dr();Br();WA()});function VA(n,e,t,r,s,i){var a={lastyear:n,lastmonth:e,nwdaymask:[]},o=[];if(i.freq===Z.YEARLY)if(ps(i.bymonth))o=[[0,t]];else for(var l=0;l<i.bymonth.length;l++)e=i.bymonth[l],o.push(r.slice(e-1,e+1));else i.freq===Z.MONTHLY&&(o=[r.slice(e-1,e+1)]);if(ps(o))return a;a.nwdaymask=Be(0,t);for(var l=0;l<o.length;l++)for(var c=o[l],d=c[0],u=c[1]-1,h=0;h<i.bynweekday.length;h++){var f=void 0,p=i.bynweekday[h],m=p[0],g=p[1];g<0?(f=u+(g+1)*7,f-=Sr(s[f]-m,7)):(f=d+(g-1)*7,f+=Sr(7-s[f]+m,7)),d<=f&&f<=u&&(a.nwdaymask[f]=1)}return a}var YA=v(()=>{Ls();Br()});function zA(n,e){e===void 0&&(e=0);var t=n%19,r=Math.floor(n/100),s=n%100,i=Math.floor(r/4),a=r%4,o=Math.floor((r+8)/25),l=Math.floor((r-o+1)/3),c=Math.floor(19*t+r-i-l+15)%30,d=Math.floor(s/4),u=s%4,h=Math.floor(32+2*a+2*d-c-u)%7,f=Math.floor((t+11*c+22*h)/451),p=Math.floor((c+h-7*f+114)/31),m=(c+h-7*f+114)%31+1,g=Date.UTC(n,p-1,m+e),y=Date.UTC(n,0,1);return[Math.ceil((g-y)/(1e3*60*60*24))]}var qA=v(()=>{});var WW,GA,QA=v(()=>{Br();gi();jA();YA();qA();Xp();Dr();WW=(function(){function n(e){this.options=e}return n.prototype.rebuild=function(e,t){var r=this.options;if(e!==this.lastyear&&(this.yearinfo=$A(e,r)),Ot(r.bynweekday)&&(t!==this.lastmonth||e!==this.lastyear)){var s=this.yearinfo,i=s.yearlen,a=s.mrange,o=s.wdaymask;this.monthinfo=VA(e,t,i,a,o,r)}ut(r.byeaster)&&(this.eastermask=zA(e,r.byeaster))},Object.defineProperty(n.prototype,"lastyear",{get:function(){return this.monthinfo?this.monthinfo.lastyear:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"lastmonth",{get:function(){return this.monthinfo?this.monthinfo.lastmonth:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearlen",{get:function(){return this.yearinfo.yearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"yearordinal",{get:function(){return this.yearinfo.yearordinal},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mrange",{get:function(){return this.yearinfo.mrange},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wdaymask",{get:function(){return this.yearinfo.wdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mmask",{get:function(){return this.yearinfo.mmask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"wnomask",{get:function(){return this.yearinfo.wnomask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nwdaymask",{get:function(){return this.monthinfo?this.monthinfo.nwdaymask:[]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nextyearlen",{get:function(){return this.yearinfo.nextyearlen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"mdaymask",{get:function(){return this.yearinfo.mdaymask},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"nmdaymask",{get:function(){return this.yearinfo.nmdaymask},enumerable:!1,configurable:!0}),n.prototype.ydayset=function(){return[Os(this.yearlen),0,this.yearlen]},n.prototype.mdayset=function(e,t){for(var r=this.mrange[t-1],s=this.mrange[t],i=Be(null,this.yearlen),a=r;a<s;a++)i[a]=a;return[i,r,s]},n.prototype.wdayset=function(e,t,r){for(var s=Be(null,this.yearlen+7),i=Ed(Fn(e,t,r))-this.yearordinal,a=i,o=0;o<7&&(s[i]=i,++i,this.wdaymask[i]!==this.options.wkst);o++);return[s,a,i]},n.prototype.ddayset=function(e,t,r){var s=Be(null,this.yearlen),i=Ed(Fn(e,t,r))-this.yearordinal;return s[i]=i,[s,i,i+1]},n.prototype.htimeset=function(e,t,r,s){var i=this,a=[];return this.options.byminute.forEach(function(o){a=a.concat(i.mtimeset(e,o,r,s))}),fi(a),a},n.prototype.mtimeset=function(e,t,r,s){var i=this.options.bysecond.map(function(a){return new Ol(e,t,a,s)});return fi(i),i},n.prototype.stimeset=function(e,t,r,s){return[new Ol(e,t,r,s)]},n.prototype.getdayset=function(e){switch(e){case Ae.YEARLY:return this.ydayset.bind(this);case Ae.MONTHLY:return this.mdayset.bind(this);case Ae.WEEKLY:return this.wdayset.bind(this);case Ae.DAILY:return this.ddayset.bind(this);default:return this.ddayset.bind(this)}},n.prototype.gettimeset=function(e){switch(e){case Ae.HOURLY:return this.htimeset.bind(this);case Ae.MINUTELY:return this.mtimeset.bind(this);case Ae.SECONDLY:return this.stimeset.bind(this)}},n})(),GA=WW});function KA(n,e,t,r,s,i){for(var a=[],o=0;o<n.length;o++){var l=void 0,c=void 0,d=n[o];d<0?(l=Math.floor(d/e.length),c=Sr(d,e.length)):(l=Math.floor((d-1)/e.length),c=Sr(d-1,e.length));for(var u=[],h=t;h<r;h++){var f=i[h];ut(f)&&u.push(f)}var p=void 0;l<0?p=u.slice(l)[0]:p=u[l];var m=e[c],g=Gp(s.yearordinal+p),y=Qp(g,m);We(a,y)||a.push(y)}return fi(a),a}var ZA=v(()=>{Dr();Br()});function tm(n,e){var t=e.dtstart,r=e.freq,s=e.interval,i=e.until,a=e.bysetpos,o=e.count;if(o===0||s===0)return yi(n);var l=DA.fromDate(t),c=new GA(e);c.rebuild(l.year,l.month);for(var d=VW(c,l,e);;){var u=c.getdayset(r)(l.year,l.month,l.day),h=u[0],f=u[1],p=u[2],m=jW(h,f,p,c,e);if(Ot(a))for(var g=KA(a,d,f,p,c,h),y=0;y<g.length;y++){var T=g[y];if(i&&T>i)return yi(n);if(T>=t){var w=JA(T,e);if(!n.accept(w)||o&&(--o,!o))return yi(n)}}else for(var y=f;y<p;y++){var b=h[y];if(ut(b))for(var S=Gp(c.yearordinal+b),k=0;k<d.length;k++){var D=d[k],T=Qp(S,D);if(i&&T>i)return yi(n);if(T>=t){var w=JA(T,e);if(!n.accept(w)||o&&(--o,!o))return yi(n)}}}if(e.interval===0||(l.add(e,m),l.year>qp))return yi(n);Cd(r)||(d=c.gettimeset(r)(l.hour,l.minute,l.second,0)),c.rebuild(l.year,l.month)}}function $W(n,e,t){var r=t.bymonth,s=t.byweekno,i=t.byweekday,a=t.byeaster,o=t.bymonthday,l=t.bynmonthday,c=t.byyearday;return Ot(r)&&!We(r,n.mmask[e])||Ot(s)&&!n.wnomask[e]||Ot(i)&&!We(i,n.wdaymask[e])||Ot(n.nwdaymask)&&!n.nwdaymask[e]||a!==null&&!We(n.eastermask,e)||(Ot(o)||Ot(l))&&!We(o,n.mdaymask[e])&&!We(l,n.nmdaymask[e])||Ot(c)&&(e<n.yearlen&&!We(c,e+1)&&!We(c,-n.yearlen+e)||e>=n.yearlen&&!We(c,e+1-n.yearlen)&&!We(c,-n.nextyearlen+e-n.yearlen))}function JA(n,e){return new oo(n,e.tzid).rezonedDate()}function yi(n){return n.getValue()}function jW(n,e,t,r,s){for(var i=!1,a=e;a<t;a++){var o=n[a];i=$W(r,o,s),i&&(n[o]=null)}return i}function VW(n,e,t){var r=t.freq,s=t.byhour,i=t.byminute,a=t.bysecond;return Cd(r)?xA(t):r>=Z.HOURLY&&Ot(s)&&!We(s,e.hour)||r>=Z.MINUTELY&&Ot(i)&&!We(i,e.minute)||r>=Z.SECONDLY&&Ot(a)&&!We(a,e.second)?[]:n.gettimeset(r)(e.hour,e.minute,e.second,e.millisecond)}var DT=v(()=>{gi();Dr();QA();Ls();bT();Br();em();ZA();Xp()});var Fs,xd,MA,Z,Ls=v(()=>{Dr();Zp();yA();SA();gi();bT();kT();ET();IA();so();DT();Fs={MO:new jt(0),TU:new jt(1),WE:new jt(2),TH:new jt(3),FR:new jt(4),SA:new jt(5),SU:new jt(6)},xd={freq:Ae.YEARLY,dtstart:null,interval:1,wkst:Fs.MO,count:null,until:null,tzid:null,bysetpos:null,bymonth:null,bymonthday:null,bynmonthday:null,byyearday:null,byweekno:null,byweekday:null,bynweekday:null,byhour:null,byminute:null,bysecond:null,byeaster:null},MA=Object.keys(xd),Z=(function(){function n(e,t){e===void 0&&(e={}),t===void 0&&(t=!1),this._cache=t?null:new PA,this.origOptions=wT(e);var r=CA(e).parsedOptions;this.options=r}return n.parseText=function(e,t){return Dd(e,t)},n.fromText=function(e,t){return bA(e,t)},n.fromString=function(e){return new n(n.parseString(e)||void 0)},n.prototype._iter=function(e){return tm(e,this.options)},n.prototype._cacheGet=function(e,t){return this._cache?this._cache._cacheGet(e,t):!1},n.prototype._cacheAdd=function(e,t,r){if(this._cache)return this._cache._cacheAdd(e,t,r)},n.prototype.all=function(e){if(e)return this._iter(new TT("all",{},e));var t=this._cacheGet("all");return t===!1&&(t=this._iter(new pi("all",{})),this._cacheAdd("all",t)),t},n.prototype.between=function(e,t,r,s){if(r===void 0&&(r=!1),!io(e)||!io(t))throw new Error("Invalid date passed in to RRule.between");var i={before:t,after:e,inc:r};if(s)return this._iter(new TT("between",i,s));var a=this._cacheGet("between",i);return a===!1&&(a=this._iter(new pi("between",i)),this._cacheAdd("between",a,i)),a},n.prototype.before=function(e,t){if(t===void 0&&(t=!1),!io(e))throw new Error("Invalid date passed in to RRule.before");var r={dt:e,inc:t},s=this._cacheGet("before",r);return s===!1&&(s=this._iter(new pi("before",r)),this._cacheAdd("before",s,r)),s},n.prototype.after=function(e,t){if(t===void 0&&(t=!1),!io(e))throw new Error("Invalid date passed in to RRule.after");var r={dt:e,inc:t},s=this._cacheGet("after",r);return s===!1&&(s=this._iter(new pi("after",r)),this._cacheAdd("after",s,r)),s},n.prototype.count=function(){return this.all().length},n.prototype.toString=function(){return Ad(this.origOptions)},n.prototype.toText=function(e,t,r){return kA(this,e,t,r)},n.prototype.isFullyConvertibleToText=function(){return EA(this)},n.prototype.clone=function(){return new n(this.origOptions)},n.FREQUENCIES=["YEARLY","MONTHLY","WEEKLY","DAILY","HOURLY","MINUTELY","SECONDLY"],n.YEARLY=Ae.YEARLY,n.MONTHLY=Ae.MONTHLY,n.WEEKLY=Ae.WEEKLY,n.DAILY=Ae.DAILY,n.HOURLY=Ae.HOURLY,n.MINUTELY=Ae.MINUTELY,n.SECONDLY=Ae.SECONDLY,n.MO=Fs.MO,n.TU=Fs.TU,n.WE=Fs.WE,n.TH=Fs.TH,n.FR=Fs.FR,n.SA=Fs.SA,n.SU=Fs.SU,n.parseString=_d,n.optionsToString=Ad,n})()});function XA(n,e,t,r,s,i){var a={},o=n.accept;function l(h,f){t.forEach(function(p){p.between(h,f,!0).forEach(function(m){a[Number(m)]=!0})})}s.forEach(function(h){var f=new oo(h,i).rezonedDate();a[Number(f)]=!0}),n.accept=function(h){var f=Number(h);return isNaN(f)?o.call(this,h):!a[f]&&(l(new Date(f-1),new Date(f+1)),!a[f])?(a[f]=!0,o.call(this,h)):!0},n.method==="between"&&(l(n.args.after,n.args.before),n.accept=function(h){var f=Number(h);return a[f]?!0:(a[f]=!0,o.call(this,h))});for(var c=0;c<r.length;c++){var d=new oo(r[c],i).rezonedDate();if(!n.accept(new Date(d.getTime())))break}e.forEach(function(h){tm(n,h.options)});var u=n._result;switch(fi(u),n.method){case"all":case"between":return u;case"before":return u.length&&u[u.length-1]||null;case"after":default:return u.length&&u[0]||null}}var eP=v(()=>{em();DT();Dr()});function YW(n,e){var t=[],r=[],s=[],i=[],a=Md(n),o=a.dtstart,l=a.tzid,c=KW(n,e.unfold);return c.forEach(function(d){var u;if(d){var h=QW(d),f=h.name,p=h.parms,m=h.value;switch(f.toUpperCase()){case"RRULE":if(p.length)throw new Error("unsupported RRULE parm: ".concat(p.join(",")));t.push(_d(d));break;case"RDATE":var g=(u=/RDATE(?:;TZID=([^:=]+))?/i.exec(d))!==null&&u!==void 0?u:[],y=g[1];y&&!l&&(l=y),r=r.concat(rP(m,p));break;case"EXRULE":if(p.length)throw new Error("unsupported EXRULE parm: ".concat(p.join(",")));s.push(_d(m));break;case"EXDATE":i=i.concat(rP(m,p));break;case"DTSTART":break;default:throw new Error("unsupported property: "+f)}}}),{dtstart:o,tzid:l,rrulevals:t,rdatevals:r,exrulevals:s,exdatevals:i}}function zW(n,e){var t=YW(n,e),r=t.rrulevals,s=t.rdatevals,i=t.exrulevals,a=t.exdatevals,o=t.dtstart,l=t.tzid,c=e.cache===!1;if(e.compatible&&(e.forceset=!0,e.unfold=!0),e.forceset||r.length>1||s.length||i.length||a.length){var d=new MT(c);return d.dtstart(o),d.tzid(l||void 0),r.forEach(function(h){d.rrule(new Z(CT(h,o,l),c))}),s.forEach(function(h){d.rdate(h)}),i.forEach(function(h){d.exrule(new Z(CT(h,o,l),c))}),a.forEach(function(h){d.exdate(h)}),e.compatible&&e.dtstart&&d.rdate(o),d}var u=r[0]||{};return new Z(CT(u,u.dtstart||e.dtstart||o,u.tzid||e.tzid||l),c)}function rm(n,e){return e===void 0&&(e={}),zW(n,qW(e))}function CT(n,e,t){return gr(gr({},n),{dtstart:e,tzid:t})}function qW(n){var e=[],t=Object.keys(n),r=Object.keys(tP);if(t.forEach(function(s){We(r,s)||e.push(s)}),e.length)throw new Error("Invalid options: "+e.join(", "));return gr(gr({},tP),n)}function GW(n){if(n.indexOf(":")===-1)return{name:"RRULE",value:n};var e=hA(n,":",1),t=e[0],r=e[1];return{name:t,value:r}}function QW(n){var e=GW(n),t=e.name,r=e.value,s=t.split(";");if(!s)throw new Error("empty property name");return{name:s[0].toUpperCase(),parms:s.slice(1),value:r}}function KW(n,e){if(e===void 0&&(e=!1),n=n&&n.trim(),!n)throw new Error("Invalid empty string");if(!e)return n.split(/\s/);for(var t=n.split(`
`),r=0;r<t.length;){var s=t[r]=t[r].replace(/\s+$/g,"");s?r>0&&s[0]===" "?(t[r-1]+=s.slice(1),t.splice(r,1)):r+=1:t.splice(r,1)}return t}function ZW(n){n.forEach(function(e){if(!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(e))throw new Error("unsupported RDATE/EXDATE parm: "+e)})}function rP(n,e){return ZW(e),n.split(",").map(function(t){return Sd(t)})}var tP,xT=v(()=>{mi();Ls();_T();Dr();Br();kT();tP={dtstart:null,cache:!1,unfold:!1,forceset:!1,compatible:!1,tzid:null}});function sP(n){var e=this;return function(t){if(t!==void 0&&(e["_".concat(n)]=t),e["_".concat(n)]!==void 0)return e["_".concat(n)];for(var r=0;r<e._rrule.length;r++){var s=e._rrule[r].origOptions[n];if(s)return s}}}function nP(n,e){if(!(n instanceof Z))throw new TypeError(String(n)+" is not RRule instance");We(e.map(String),String(n))||e.push(n)}function iP(n,e){if(!(n instanceof Date))throw new TypeError(String(n)+" is not Date instance");We(e.map(Number),Number(n))||(e.push(n),fi(e))}function aP(n,e,t){var r=!t||t.toUpperCase()==="UTC",s=r?"".concat(n,":"):"".concat(n,";TZID=").concat(t,":"),i=e.map(function(a){return Il(a.valueOf(),r)}).join(",");return"".concat(s).concat(i)}var MT,_T=v(()=>{mi();Ls();Dr();Br();eP();xT();ET();MT=(function(n){Rl(e,n);function e(t){t===void 0&&(t=!1);var r=n.call(this,{},t)||this;return r.dtstart=sP.apply(r,["dtstart"]),r.tzid=sP.apply(r,["tzid"]),r._rrule=[],r._rdate=[],r._exrule=[],r._exdate=[],r}return e.prototype._iter=function(t){return XA(t,this._rrule,this._exrule,this._rdate,this._exdate,this.tzid())},e.prototype.rrule=function(t){nP(t,this._rrule)},e.prototype.exrule=function(t){nP(t,this._exrule)},e.prototype.rdate=function(t){iP(t,this._rdate)},e.prototype.exdate=function(t){iP(t,this._exdate)},e.prototype.rrules=function(){return this._rrule.map(function(t){return rm(t.toString())})},e.prototype.exrules=function(){return this._exrule.map(function(t){return rm(t.toString())})},e.prototype.rdates=function(){return this._rdate.map(function(t){return new Date(t.getTime())})},e.prototype.exdates=function(){return this._exdate.map(function(t){return new Date(t.getTime())})},e.prototype.valueOf=function(){var t=[];return!this._rrule.length&&this._dtstart&&(t=t.concat(Ad({dtstart:this._dtstart}))),this._rrule.forEach(function(r){t=t.concat(r.toString().split(`
`))}),this._exrule.forEach(function(r){t=t.concat(r.toString().split(`
`).map(function(s){return s.replace(/^RRULE:/,"EXRULE:")}).filter(function(s){return!/^DTSTART/.test(s)}))}),this._rdate.length&&t.push(aP("RDATE",this._rdate,this.tzid())),this._exdate.length&&t.push(aP("EXDATE",this._exdate,this.tzid())),t},e.prototype.toString=function(){return this.valueOf().join(`
`)},e.prototype.clone=function(){var t=new e(!!this._cache);return this._rrule.forEach(function(r){return t.rrule(r.clone())}),this._exrule.forEach(function(r){return t.exrule(r.clone())}),this._rdate.forEach(function(r){return t.rdate(new Date(r.getTime()))}),this._exdate.forEach(function(r){return t.exdate(new Date(r.getTime()))}),t},e})(Z)});var AT=v(()=>{Ls();_T();xT();gi();so();Dr()});var Ll,PT=v(()=>{Fe();Ll=class{constructor(e){this.mapping=e}toUserField(e){return this.mapping[e]}normalizeTitle(e){if(typeof e=="string")return e;if(Array.isArray(e))return e.map(t=>String(t)).join(", ");if(e!=null)return typeof e=="object"?"":String(e)}mapFromFrontmatter(e,t,r){var i;if(!e)return{};let s={path:t};if(e[this.mapping.title]!==void 0){let a=e[this.mapping.title],o=this.normalizeTitle(a);o!==void 0&&(s.title=o)}else if(r){let a=(i=t.split("/").pop())==null?void 0:i.replace(".md","");a&&(s.title=a)}if(e[this.mapping.status]!==void 0){let a=e[this.mapping.status];typeof a=="boolean"?s.status=a?"true":"false":s.status=a}if(e[this.mapping.priority]!==void 0&&(s.priority=e[this.mapping.priority]),e[this.mapping.due]!==void 0&&(s.due=e[this.mapping.due]),e[this.mapping.scheduled]!==void 0&&(s.scheduled=e[this.mapping.scheduled]),e[this.mapping.contexts]!==void 0){let a=e[this.mapping.contexts];s.contexts=Array.isArray(a)?a:[a]}if(e[this.mapping.projects]!==void 0){let a=e[this.mapping.projects];s.projects=Array.isArray(a)?a:[a]}if(e[this.mapping.timeEstimate]!==void 0&&(s.timeEstimate=e[this.mapping.timeEstimate]),e[this.mapping.completedDate]!==void 0&&(s.completedDate=e[this.mapping.completedDate]),e[this.mapping.recurrence]!==void 0&&(s.recurrence=e[this.mapping.recurrence]),e[this.mapping.dateCreated]!==void 0&&(s.dateCreated=e[this.mapping.dateCreated]),e[this.mapping.dateModified]!==void 0&&(s.dateModified=e[this.mapping.dateModified]),e[this.mapping.timeEntries]!==void 0){let a=e[this.mapping.timeEntries];s.timeEntries=Array.isArray(a)?a:[]}if(e[this.mapping.completeInstances]!==void 0&&(s.complete_instances=aA(e[this.mapping.completeInstances])),e[this.mapping.icsEventId]!==void 0){let a=e[this.mapping.icsEventId];s.icsEventId=Array.isArray(a)?a:[a]}if(e[this.mapping.reminders]!==void 0){let a=e[this.mapping.reminders];if(Array.isArray(a)){let o=a.filter(l=>l!=null);o.length>0&&(s.reminders=o)}else a!=null&&(s.reminders=[a])}return e.tags&&Array.isArray(e.tags)&&(s.tags=e.tags,s.archived=e.tags.includes(this.mapping.archiveTag)),e.timeEntries!==void 0&&(s.timeEntries=Array.isArray(e.timeEntries)?e.timeEntries:[]),s}mapToFrontmatter(e,t,r){let s={};if(e.title!==void 0&&(s[this.mapping.title]=e.title),r&&delete s[this.mapping.title],e.status!==void 0){let a=e.status.toLowerCase(),o=a==="true"||a==="false"?a==="true":e.status;s[this.mapping.status]=o}e.priority!==void 0&&(s[this.mapping.priority]=e.priority),e.due!==void 0&&(s[this.mapping.due]=e.due),e.scheduled!==void 0&&(s[this.mapping.scheduled]=e.scheduled),e.contexts!==void 0&&(s[this.mapping.contexts]=e.contexts),e.projects!==void 0&&(s[this.mapping.projects]=e.projects),e.timeEstimate!==void 0&&(s[this.mapping.timeEstimate]=e.timeEstimate),e.completedDate!==void 0&&(s[this.mapping.completedDate]=e.completedDate),e.recurrence!==void 0&&(s[this.mapping.recurrence]=e.recurrence),e.dateCreated!==void 0&&(s[this.mapping.dateCreated]=e.dateCreated),e.dateModified!==void 0&&(s[this.mapping.dateModified]=e.dateModified),e.timeEntries!==void 0&&(s[this.mapping.timeEntries]=e.timeEntries),e.complete_instances!==void 0&&(s[this.mapping.completeInstances]=e.complete_instances),e.icsEventId!==void 0&&e.icsEventId.length>0&&(s[this.mapping.icsEventId]=e.icsEventId),e.reminders!==void 0&&e.reminders.length>0&&(s[this.mapping.reminders]=e.reminders);let i=e.tags?[...e.tags]:[];return t&&!i.includes(t)&&i.push(t),e.archived===!0&&!i.includes(this.mapping.archiveTag)?i.push(this.mapping.archiveTag):e.archived===!1&&(i=i.filter(a=>a!==this.mapping.archiveTag)),i.length>0&&(s.tags=i),e.timeEntries!==void 0&&(s.timeEntries=e.timeEntries),s}updateMapping(e){this.mapping=e}getMapping(){return{...this.mapping}}fromUserField(e){for(let[t,r]of Object.entries(this.mapping))if(r===e)return t;return null}static validateMapping(e){let t=[],r=Object.keys(e);for(let a of r)(!e[a]||e[a].trim()==="")&&t.push(`Field "${a}" cannot be empty`);let s=Object.values(e),i=new Set(s);return s.length!==i.size&&t.push("Field mappings must have unique property names"),{valid:t.length===0,errors:t}}}});function sm(n){if(!n.startsWith("---"))return{};let e=n.indexOf("---",3);if(e===-1)return{};let t=n.substring(3,e);try{return(0,lo.parseYaml)(t)||{}}catch(r){return console.error("Error parsing frontmatter:",r),{}}}async function Fl(n,e){try{let r=(0,lo.normalizePath)(e).split("/").filter(i=>i.length>0),s="";for(let i of r)s=s?`${s}/${i}`:i,n.getAbstractFileByPath(s)||await n.createFolder(s)}catch(t){let r=t instanceof Error?t.message:String(t),s=t instanceof Error?t.stack:void 0;console.error("Error creating folder structure:",{error:r,stack:s,folderPath:e,normalizedPath:(0,lo.normalizePath)(e)});let i=new Error(`Failed to create folder "${e}": ${r}`);throw s&&(i.stack=s),i}}function JW(n,e){try{let t=new Date(n),r=new Date(e);if(isNaN(t.getTime())||isNaN(r.getTime()))return console.error("Invalid timestamps for duration calculation:",{startTime:n,endTime:e}),0;if(r<=t)return console.error("End time is not after start time:",{startTime:n,endTime:e}),0;let s=r.getTime()-t.getTime(),i=Math.round(s/(1e3*60));return Math.max(0,i)}catch(t){return console.error("Error calculating duration:",t,{startTime:n,endTime:e}),0}}function mn(n){return!n||!Array.isArray(n)?0:n.reduce((e,t)=>{if(!t.startTime||!t.endTime)return e;let r=JW(t.startTime,t.endTime);return e+r},0)}function oP(n){return!n||!Array.isArray(n)?null:n.find(e=>e.startTime&&!e.endTime)||null}function nm(n){if(!n||n===0||isNaN(n))return"0m";let e=Math.floor(n/60),t=n%60;return e===0?`${t}m`:t===0?`${e}h`:`${e}h ${t}m`}function Bs(n){if(n==="none")return"";let e=new Date,t;switch(n){case"today":t=e;break;case"tomorrow":t=new Date(e),t.setDate(e.getDate()+1);break;case"next-week":t=new Date(e),t.setDate(e.getDate()+7);break;default:return""}return x(t,"yyyy-MM-dd")}function Pd(n,e){return n.getUTCFullYear()===e.getUTCFullYear()&&n.getUTCMonth()===e.getUTCMonth()&&n.getUTCDate()===e.getUTCDate()}function lP(n,e,t,r,s,i){var c;let a=n.metadataCache.getFileCache(r),o=a==null?void 0:a.frontmatter;if(o)if(s){let d=s.mapFromFrontmatter(o,t,i);return{title:d.title||"Untitled task",status:d.status||"open",priority:d.priority||"normal",due:d.due,scheduled:d.scheduled,path:t,archived:d.archived||!1,tags:d.tags||[],contexts:d.contexts||[],projects:d.projects||[],recurrence:d.recurrence,complete_instances:d.complete_instances,completedDate:d.completedDate,timeEstimate:d.timeEstimate,timeEntries:d.timeEntries,dateCreated:d.dateCreated,dateModified:d.dateModified,reminders:d.reminders}}else{let u=new Ll(Cp).mapFromFrontmatter(o,t,i);return{title:u.title||"Untitled task",status:u.status||"open",priority:u.priority||"normal",due:u.due,scheduled:u.scheduled,path:t,archived:u.archived||!1,tags:u.tags||[],contexts:u.contexts||[],projects:u.projects||[],recurrence:u.recurrence,complete_instances:u.complete_instances,completedDate:u.completedDate,timeEstimate:u.timeEstimate,timeEntries:u.timeEntries,dateCreated:u.dateCreated,dateModified:u.dateModified,reminders:u.reminders}}return{title:((c=t.split("/").pop())==null?void 0:c.replace(".md",""))||"Untitled",status:"open",priority:"normal",path:t,archived:!1,reminders:[]}}function Id(n,e){if(!n.recurrence)return!0;if(typeof n.recurrence=="string")try{let l,c=n.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(c){let m=c[1];if(m.length===8){let g=parseInt(m.slice(0,4)),y=parseInt(m.slice(4,6))-1,T=parseInt(m.slice(6,8));l=new Date(Date.UTC(g,y,T,0,0,0,0))}else{let g=parseInt(m.slice(0,4)),y=parseInt(m.slice(4,6))-1,T=parseInt(m.slice(6,8)),w=parseInt(m.slice(9,11))||0,b=parseInt(m.slice(11,13))||0,S=parseInt(m.slice(13,15))||0;l=new Date(Date.UTC(g,y,T,w,b,S,0))}}else if(n.scheduled)l=us(n.scheduled);else if(n.dateCreated)l=us(n.dateCreated);else return!1;let d=n.recurrence.replace(/DTSTART:[^;]+;?/,""),u=Z.parseString(d);u.dtstart=l;let h=new Z(u),f=us(lA(e));return h.between(f,new Date(f.getTime()+1440*60*1e3-1),!0).length>0}catch(l){return console.error("Error evaluating rrule:",l,{task:n.title,recurrence:n.recurrence}),!0}let t=n.recurrence.frequency,r=qe(me(e)),s=r.getUTCDay(),i=r.getUTCDate(),a=r.getUTCMonth()+1,o=["sun","mon","tue","wed","thu","fri","sat"];switch(t){case"daily":return!0;case"weekly":return(n.recurrence.days_of_week||[]).includes(o[s]);case"monthly":return i===n.recurrence.day_of_month;case"yearly":{if(n.recurrence.month_of_year&&n.recurrence.day_of_month)return i===n.recurrence.day_of_month&&a===n.recurrence.month_of_year;if(n.due)try{let l=qe(n.due);return l.getUTCDate()===i&&l.getUTCMonth()===r.getUTCMonth()}catch(l){return console.error(`Error parsing due date ${n.due}:`,l),!1}return!1}default:return!1}}function Hn(n,e){if(!n.recurrence)return n.status||"open";let t=me(e);return(Array.isArray(n.complete_instances)?n.complete_instances:[]).includes(t)?"done":"open"}function Rd(n,e,t){if(!n.recurrence)return[];if(typeof n.recurrence=="string")try{let i,a=n.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(a){let h=a[1];if(h.length===8){let f=parseInt(h.slice(0,4)),p=parseInt(h.slice(4,6))-1,m=parseInt(h.slice(6,8));i=new Date(Date.UTC(f,p,m,0,0,0,0))}else{let f=parseInt(h.slice(0,4)),p=parseInt(h.slice(4,6))-1,m=parseInt(h.slice(6,8)),g=parseInt(h.slice(9,11))||0,y=parseInt(h.slice(11,13))||0,T=parseInt(h.slice(13,15))||0;i=new Date(Date.UTC(f,p,m,g,y,T,0))}}else if(n.scheduled)i=us(n.scheduled);else if(n.dateCreated)i=us(n.dateCreated);else return[];let o=n.recurrence.replace(/DTSTART:[^;]+;?/,""),l=Z.parseString(o);l.dtstart=i;let c=new Z(l),d=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0)),u=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,999));return c.between(d,u,!0)}catch(i){console.error("Error generating recurring instances:",i,{task:n.title,recurrence:n.recurrence})}let r=[],s=new Date(e);for(;s<=t;)Id(n,s)&&r.push(new Date(s)),s.setUTCDate(s.getUTCDate()+1);return r}function XW(n){if(!n.recurrence)return null;try{let e=Kt(),t=qe(e),r=new Date(t.getTime()+365*24*60*60*1e3),s=Rd(n,t,r),i=new Set(n.complete_instances||[]);for(let a of s){let o=me(a);if(!i.has(o))return a}return null}catch(e){return console.error("Error calculating next uncompleted occurrence:",e,{task:n.title}),null}}function Nd(n,e=!0){let t=XW(n),r=null,s=null,i=null;if(t){if(e)try{let a=n.scheduled?qe(n.scheduled):null,o=n.due?qe(n.due):null;if(a&&o){let l=o.getTime()-a.getTime();t&&(i=new Date(t.getTime()+l))}}catch(a){console.error("Error calculating next due date with offset:",a)}if(n.scheduled&&n.scheduled.includes("T")){let a=n.scheduled.split("T")[1];r=`${me(t)}T${a}`}else r=me(t);if(i&&n.due&&n.due.includes("T")){let a=n.due.split("T")[1];s=`${me(i)}T${a}`}else i&&(s=me(i))}return{scheduled:r,due:s}}function IT(n){if(!n||!n.frequency)throw new Error("Invalid recurrence object");try{let e={};switch(n.frequency){case"daily":e.freq=Z.DAILY;break;case"weekly":if(e.freq=Z.WEEKLY,n.days_of_week&&Array.isArray(n.days_of_week)){let r={sun:Z.SU,mon:Z.MO,tue:Z.TU,wed:Z.WE,thu:Z.TH,fri:Z.FR,sat:Z.SA};e.byweekday=n.days_of_week.map(s=>r[s.toLowerCase()]).filter(Boolean)}break;case"monthly":e.freq=Z.MONTHLY,n.day_of_month&&(e.bymonthday=[n.day_of_month]);break;case"yearly":e.freq=Z.YEARLY,n.month_of_year&&(e.bymonth=[n.month_of_year]),n.day_of_month&&(e.bymonthday=[n.day_of_month]);break;default:throw new Error(`Unsupported frequency: ${n.frequency}`)}return new Z(e).toString()}catch(e){throw console.error("Error converting legacy recurrence to rrule:",e,{recurrence:n}),e}}function Bl(n){if(!n)return"";try{if(typeof n=="string"&&n.includes("FREQ=")){let e=n.replace(/DTSTART:[^;]+;?/,"");return Z.fromString(e).toText()}if(typeof n=="object"&&n.frequency){let e=IT(n);return Z.fromString(e).toText()}return"rrule"}catch(e){return console.error("Error converting recurrence to display text:",e,{recurrence:n}),"rrule"}}function e$(n){if(!n||typeof n!="object"||!n.id||typeof n.id!="string"||!n.title||typeof n.title!="string"||!n.startTime||typeof n.startTime!="string"||!n.endTime||typeof n.endTime!="string")return!1;let e=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;if(!e.test(n.startTime)||!e.test(n.endTime))return!1;let[t,r]=n.startTime.split(":").map(Number),[s,i]=n.endTime.split(":").map(Number),a=t*60+r;if(s*60+i<=a||n.attachments&&!Array.isArray(n.attachments))return!1;if(n.attachments){for(let l of n.attachments)if(typeof l!="string"||!l.trim())return!1}return!(n.color&&typeof n.color!="string"||n.description&&typeof n.description!="string")}function RT(n,e){try{let t=sm(n);if(!t||!t.timeblocks||!Array.isArray(t.timeblocks))return[];let r=[];for(let s of t.timeblocks)e$(s)?r.push(s):console.warn(`Invalid timeblock in ${e}:`,s);return r}catch(t){return console.error(`Error extracting timeblocks from ${e}:`,t),[]}}function cP(n,e){let t=`${e}T${n.startTime}:00`,r=`${e}T${n.endTime}:00`;return{id:`timeblock-${n.id}`,title:n.title,start:t,end:r,allDay:!1,backgroundColor:n.color||"#6366f1",borderColor:n.color||"#4f46e5",editable:!0,eventType:"timeblock",extendedProps:{type:"timeblock",eventType:"timeblock",timeblock:n,originalDate:e,description:n.description,attachments:n.attachments||[]}}}function dP(){return`tb-${Date.now()}-${Math.random().toString(36).substring(2,11)}`}async function NT(n,e,t,r,s,i){let{getDailyNote:a,getAllDailyNotes:o,appHasDailyNotesPluginLoaded:l}=await Promise.resolve().then(()=>ke(dn()));if(!l())throw new Error("Daily Notes plugin is not enabled");let c=o(),d=window.moment(t),u=a(d,c);if(!u)throw new Error(`Daily note for ${t} not found`);let h=await n.vault.read(u),f=RT(h,u.path),p=f.findIndex(y=>y.id===e);if(p===-1)throw new Error(`Timeblock ${e} not found`);let m=f[p];if(t===r){await t$(n,u,e,s,i);return}await r$(n,u,e);let g={...m,startTime:s,endTime:i};await s$(n,r,g)}async function t$(n,e,t,r,s){let i=await n.vault.read(e),a=sm(i)||{};if(!a.timeblocks||!Array.isArray(a.timeblocks))throw new Error("No timeblocks found in frontmatter");let o=a.timeblocks.findIndex(l=>l.id===t);if(o===-1)throw new Error(`Timeblock ${t} not found`);a.timeblocks[o].startTime=r,a.timeblocks[o].endTime=s,await OT(n,e,a,i)}async function r$(n,e,t){let r=await n.vault.read(e),s=sm(r)||{};!s.timeblocks||!Array.isArray(s.timeblocks)||(s.timeblocks=s.timeblocks.filter(i=>i.id!==t),await OT(n,e,s,r))}async function s$(n,e,t){let{createDailyNote:r,getDailyNote:s,getAllDailyNotes:i}=await Promise.resolve().then(()=>ke(dn())),a=window.moment(e),o=i(),l=s(a,o);if(!l&&(l=await r(a),!l))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let c=await n.vault.read(l),d=sm(c)||{};d.timeblocks||(d.timeblocks=[]),d.timeblocks.push(t),await OT(n,l,d,c)}async function OT(n,e,t,r){let s=r;if(r.startsWith("---")){let o=r.indexOf("---",3);o!==-1&&(s=r.substring(o+3))}let a=`---
${(0,lo.stringifyYaml)(t)}---${s}`;await n.vault.modify(e,a)}function qr(n){return!n||!Array.isArray(n)?[]:n.filter(e=>{if(typeof e!="string")return!1;let t=e.trim();return!(t.length===0||t==='""'||t==="''")})}function Od(n){if(!n.recurrence||typeof n.recurrence!="string")return null;if(n.recurrence.includes("DTSTART:"))return n.recurrence;let e;if(n.scheduled)e=n.scheduled;else if(n.dateCreated)e=n.dateCreated;else return null;try{let t;if(Wt(e)){let r=$t(e),s=r.getFullYear(),i=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0"),o=String(r.getHours()).padStart(2,"0"),l=String(r.getMinutes()).padStart(2,"0"),c=String(r.getSeconds()).padStart(2,"0");t=`${s}${i}${a}T${o}${l}${c}Z`}else{let r=qe(e),s=r.getUTCFullYear(),i=String(r.getUTCMonth()+1).padStart(2,"0"),a=String(r.getUTCDate()).padStart(2,"0");t=`${s}${i}${a}`}return`DTSTART:${t};${n.recurrence}`}catch(t){return console.error("Error parsing date for DTSTART:",t,{sourceDateString:e}),null}}function uP(n,e,t){if(!n.recurrence||typeof n.recurrence!="string")return null;if(n.recurrence.includes("DTSTART:"))return n.recurrence;let r;if(n.scheduled)r=n.scheduled;else if(n.dateCreated)r=n.dateCreated;else return null;try{let s;if(t){let i=qe(r),a=i.getUTCFullYear(),o=String(i.getUTCMonth()+1).padStart(2,"0"),l=String(i.getUTCDate()).padStart(2,"0");s=`${a}${o}${l}`}else{let i=qe(r),a=i.getUTCFullYear(),o=String(i.getUTCMonth()+1).padStart(2,"0"),l=String(i.getUTCDate()).padStart(2,"0"),c=String(e.getHours()).padStart(2,"0"),d=String(e.getMinutes()).padStart(2,"0");s=`${a}${o}${l}T${c}${d}00Z`}return`DTSTART:${s};${n.recurrence}`}catch(s){return console.error("Error parsing date for DTSTART with dragged time:",s,{sourceDateString:r,draggedStart:e,allDay:t}),null}}function oa(n){return!n||typeof n!="string"?"":n.split(",").map(e=>{let t=e.trim();return t.startsWith("#")?t.slice(1):t}).filter(e=>e.length>0).join(", ")}var lo,Lt=v(()=>{lo=require("obsidian");At();AT();PT();xp();Fe()});var om,Qr,lm=v(()=>{om=require("obsidian"),Qr=class{static async execute(e,t={}){let{fallback:r,errorMessage:s="An error occurred",showNotice:i=!0,logError:a=!0}=t;try{return await e()}catch(o){if(a&&console.error(s,o),i){let l=o instanceof Error?o.message:String(o);new om.Notice(`${s}: ${l}`)}return r}}static async executeWithRetry(e,t={}){let{maxRetries:r=3,retryDelay:s=1e3,errorMessage:i="Operation failed",showNotice:a=!0}=t,o;for(let l=0;l<=r;l++)try{return await e()}catch(c){if(o=c instanceof Error?c:new Error(String(c)),l<r){await new Promise(d=>setTimeout(d,s));continue}console.error(`${i} after ${r+1} attempts:`,o),a&&new om.Notice(`${i}: ${o.message}`);return}}static async executeWithValidation(e,t,r={}){let{showNotice:s=!0}=r;for(let i of t)if(!i.condition){s&&new om.Notice(i.message);return}return this.execute(e,r)}}});var Ti,Wl,FT=v(()=>{Ti=require("obsidian");At();lm();Wl=class extends Ti.Modal{constructor(t,r,s){super(t);this.title="";this.folder="";this.template="";this.useTemplate=!1;this.plugin=r,this.options=s,this.title=this.generateDefaultTitle(),this.folder=this.getDefaultFolder(),this.template=this.getDefaultTemplate()}onOpen(){this.containerEl.addClass("tasknotes-plugin","ics-note-creation-modal"),this.createModalContent()}onClose(){this.contentEl.empty()}createModalContent(){let{contentEl:t}=this;t.empty(),t.createDiv("modal-header").createEl("h2",{text:"Create from ICS Event"});let s=t.createDiv("ics-event-preview");this.createEventPreview(s),new Ti.Setting(t).setName("Title").setDesc("Title for the new content").addText(l=>{this.titleInput=l.inputEl,l.setValue(this.title).onChange(c=>{this.title=c,this.updatePreview()})}),new Ti.Setting(t).setName("Folder").setDesc("Destination folder (leave empty for vault root)").addText(l=>{this.folderInput=l.inputEl,l.setValue(this.folder).setPlaceholder("folder/subfolder").onChange(c=>{this.folder=c,this.updatePreview()})}),this.templateContainer=t.createDiv("template-settings"),this.createTemplateSettings(),this.previewContainer=t.createDiv("content-preview"),this.updatePreview();let i=t.createDiv("modal-button-container"),a=i.createEl("button",{text:"Create",cls:"mod-cta"});a.onclick=l=>{l.preventDefault(),l.stopPropagation(),console.log("Create button clicked"),this.handleCreate()};let o=i.createEl("button",{text:"Cancel"});o.onclick=l=>{l.preventDefault(),l.stopPropagation(),console.log("Cancel button clicked"),this.close()},setTimeout(()=>{var l;return(l=this.titleInput)==null?void 0:l.focus()},100)}createEventPreview(t){let{icsEvent:r,subscriptionName:s}=this.options;t.createEl("h3",{text:r.title});let i=t.createDiv("event-details");if(r.start){let o=new Date(r.start),l=i.createDiv();l.createEl("strong",{text:"Start: "}),l.appendText(x(o,"PPPp"))}if(r.end&&!r.allDay){let o=new Date(r.end),l=i.createDiv();l.createEl("strong",{text:"End: "}),l.appendText(x(o,"PPPp"))}if(r.location){let o=i.createDiv();o.createEl("strong",{text:"Location: "}),o.appendText(r.location)}let a=i.createDiv();a.createEl("strong",{text:"Calendar: "}),a.appendText(s)}createTemplateSettings(){this.templateContainer.empty(),new Ti.Setting(this.templateContainer).setName("Use Template").setDesc("Apply a template when creating the content").addToggle(t=>{t.setValue(this.useTemplate).onChange(r=>{this.useTemplate=r,this.updateTemplateInput(),this.updatePreview()})}),this.useTemplate&&new Ti.Setting(this.templateContainer).setName("Template Path").setDesc("Path to the template file").addText(t=>{this.templateInput=t.inputEl,t.setValue(this.template).setPlaceholder("templates/ics-note-template.md").onChange(r=>{this.template=r,this.updatePreview()})})}updateDefaultsForContentType(){var t,r;this.folder=((t=this.plugin.settings.icsIntegration)==null?void 0:t.defaultNoteFolder)||"",this.template=((r=this.plugin.settings.icsIntegration)==null?void 0:r.defaultNoteTemplate)||"",this.folderInput&&(this.folderInput.value=this.folder),this.templateInput&&(this.templateInput.value=this.template)}updateTemplateInput(){this.createTemplateSettings()}updatePreview(){if(!this.previewContainer)return;this.previewContainer.empty(),this.previewContainer.createEl("h4",{text:"Summary"});let t=this.previewContainer.createDiv("preview-details"),r=t.createDiv();r.createEl("strong",{text:"Type: "}),r.appendText("Note");let s=t.createDiv();s.createEl("strong",{text:"Title: "}),s.appendText(this.title||"Untitled");let i=t.createDiv();if(i.createEl("strong",{text:"Folder: "}),i.appendText(this.folder||"Vault root"),this.useTemplate&&this.template){let c=t.createDiv();c.createEl("strong",{text:"Template: "}),c.appendText(this.template)}else{let c=t.createDiv();c.createEl("strong",{text:"Template: "}),c.appendText("Default format")}let a=this.previewContainer.createDiv("template-variables");a.createEl("h5",{text:"Available Template Variables"});let o=["{{title}}","{{icsEventTitle}}","{{icsEventStart}}","{{icsEventEnd}}","{{icsEventLocation}}","{{icsEventDescription}}","{{icsEventUrl}}","{{icsEventSubscription}}","{{icsEventId}}","{{date}}","{{time}}"],l=a.createDiv("variables-list");o.forEach(c=>{l.createSpan({text:c,cls:"template-variable"})})}generateDefaultTitle(){let{icsEvent:t}=this.options,r=new Date(t.start);return`${t.title} - ${x(r,"PPP")}`}getDefaultFolder(){var t;return((t=this.plugin.settings.icsIntegration)==null?void 0:t.defaultNoteFolder)||""}getDefaultTemplate(){var t;return((t=this.plugin.settings.icsIntegration)==null?void 0:t.defaultNoteTemplate)||""}async handleCreate(){await Qr.executeWithValidation(async()=>{var s,i;let{icsEvent:t}=this.options,r=await this.plugin.icsNoteService.createNoteFromICS(t,{title:this.title,folder:this.folder||void 0,template:this.useTemplate&&this.template?this.template:void 0});new Ti.Notice(`Note created: ${this.title}`),(i=(s=this.options).onContentCreated)==null||i.call(s,r.file,r.noteInfo),this.close()},[{condition:!!this.title.trim(),message:"Title is required"}],{errorMessage:"Failed to create note from ICS event"})}}});var wi,$l,BT=v(()=>{wi=require("obsidian"),$l=class extends wi.FuzzySuggestModal{constructor(e,t,r){super(e),this.plugin=t,this.onChoose=r,this.setPlaceholder("Type to search for notes to link..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){return this.app.vault.getAllLoadedFiles().filter(e=>e instanceof wi.TFile&&e.extension==="md"&&!e.path.includes(".trash"))}getItemText(e){let t=`${e.name} ${e.path}`;if(e instanceof wi.TFile){let r=this.app.metadataCache.getFileCache(e);if(r!=null&&r.frontmatter){let s=(0,wi.parseFrontMatterAliases)(r.frontmatter);s&&s.length>0&&(t+=` ${s.join(" ")}`)}}return t}renderSuggestion(e,t){let r=e.item;t.empty();let s=t.createDiv({cls:"ics-note-link-suggestion"}),i=s.createSpan({cls:"note-link-name"});if(i.textContent=r.name,r instanceof wi.TFile){let a=this.app.metadataCache.getFileCache(r);if(a!=null&&a.frontmatter){let o=this.plugin.fieldMapper.toUserField("title"),l=a.frontmatter[o];if(l){let c=s.createDiv({cls:"note-link-title"});c.textContent=l}else{let c=(0,wi.parseFrontMatterAliases)(a.frontmatter);if(c&&c.length>0){let d=s.createDiv({cls:"note-link-aliases"});d.textContent=c.join(", ")}}}}if(r.path!==r.name){let a=s.createDiv({cls:"note-link-path"});a.textContent=r.path}}onChooseItem(e,t){this.onChoose(e)}}});var hP={};nt(hP,{ICSEventInfoModal:()=>co});var ht,co,cm=v(()=>{ht=require("obsidian");FT();BT();lm();co=class extends ht.Modal{constructor(t,r,s,i){super(t);this.relatedNotes=[];this.plugin=r,this.icsEvent=s,this.subscriptionName=i}async onOpen(){await this.renderContent()}async renderContent(){let{contentEl:t}=this;t.empty(),await this.loadRelatedNotes(),new ht.Setting(t).setName("Calendar Event").setHeading(),new ht.Setting(t).setName("Title").setDesc(this.icsEvent.title||"Untitled Event"),this.subscriptionName&&new ht.Setting(t).setName("Calendar").setDesc(this.subscriptionName);let r=new Date(this.icsEvent.start),s=r.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});if(!this.icsEvent.allDay&&(s+=` at ${r.toLocaleTimeString()}`,this.icsEvent.end)){let i=new Date(this.icsEvent.end);s+=` - ${i.toLocaleTimeString()}`}new ht.Setting(t).setName("Date & Time").setDesc(s),this.icsEvent.location&&new ht.Setting(t).setName("Location").setDesc(this.icsEvent.location),this.icsEvent.description&&new ht.Setting(t).setName("Description").setDesc(this.icsEvent.description),this.icsEvent.url&&new ht.Setting(t).setName("URL").setDesc(this.icsEvent.url),new ht.Setting(t).setName("Related Notes & Tasks").setHeading(),this.relatedNotes.length===0?new ht.Setting(t).setDesc("No related notes or tasks found for this event."):this.relatedNotes.forEach(i=>{let a=this.isTaskNote(i);new ht.Setting(t).setName(i.title).setDesc(`Type: ${a?"Task":"Note"}`).addButton(o=>{o.setButtonText("Open").onClick(async()=>{await this.safeOpenFile(i.path),this.close()})})}),new ht.Setting(t).setName("Actions").setHeading(),new ht.Setting(t).setName("Create from Event").setDesc("Create a new note or task from this calendar event").addButton(i=>{i.setButtonText("Create Note").onClick(()=>{console.log("Create Note clicked"),this.openCreationModal()})}).addButton(i=>{i.setButtonText("Create Task").onClick(async()=>{console.log("Create Task clicked"),await this.createTaskDirectly()})}),new ht.Setting(t).setName("Link Existing").setDesc("Link an existing note to this calendar event").addButton(i=>{i.setButtonText("Link Note").onClick(()=>{console.log("Link Note clicked"),this.linkExistingNote()})}).addButton(i=>{i.setButtonText("Refresh").onClick(()=>{console.log("Refresh clicked"),this.refreshRelatedNotes()})})}async loadRelatedNotes(){let t=await Qr.execute(()=>this.plugin.icsNoteService.findRelatedNotes(this.icsEvent),{fallback:[],errorMessage:"Failed to load related notes",showNotice:!1});this.relatedNotes=t||[]}openCreationModal(){console.log("Opening note creation modal");try{new Wl(this.app,this.plugin,{icsEvent:this.icsEvent,subscriptionName:this.subscriptionName||"Unknown Calendar",onContentCreated:async(r,s)=>{new ht.Notice("Note created successfully"),this.refreshRelatedNotes(),await this.safeOpenFile(r.path)}}).open()}catch(t){console.error("Error opening creation modal:",t),new ht.Notice("Failed to open creation modal")}}async linkExistingNote(){console.log("Link existing note button clicked"),await Qr.execute(async()=>{new $l(this.app,this.plugin,async r=>{await Qr.execute(async()=>{await this.plugin.icsNoteService.linkNoteToICS(r.path,this.icsEvent),new ht.Notice(`Linked note "${r.name}" to ICS event`),this.refreshRelatedNotes()},{errorMessage:"Failed to link note"})}).open()},{errorMessage:"Failed to open note selection"})}async createTaskDirectly(){await Qr.execute(async()=>{let t=await this.plugin.icsNoteService.createTaskFromICS(this.icsEvent);new ht.Notice(`Task created: ${t.taskInfo.title}`),await this.safeOpenFile(t.file.path),this.refreshRelatedNotes()},{errorMessage:"Failed to create task from ICS event"})}async refreshRelatedNotes(){await Qr.execute(async()=>{await this.loadRelatedNotes(),await this.renderContent(),new ht.Notice("Related notes refreshed")},{errorMessage:"Failed to refresh related notes"})}isTaskNote(t){var s;let r=this.plugin.settings.taskTag;return((s=t.tags)==null?void 0:s.includes(r))||!1}async safeOpenFile(t){try{let r=this.app.vault.getAbstractFileByPath(t);r instanceof ht.TFile?await this.app.workspace.getLeaf().openFile(r):(new ht.Notice("File not found or invalid"),console.error("Invalid file path or file not found:",t))}catch(r){console.error("Error opening file:",r),new ht.Notice("Failed to open file")}}onClose(){let{contentEl:t}=this;t.empty()}}});var bt,bi,dm=v(()=>{bt=require("obsidian");Fe();bi=class extends bt.Modal{constructor(t,r,s,i){super(t);this.selectedType="relative";this.relativeAnchor="due";this.relativeOffset=15;this.relativeUnit="minutes";this.relativeDirection="before";this.absoluteDate="";this.absoluteTime="";this.description="";this.plugin=r,this.task=s,this.reminders=s.reminders?[...s.reminders]:[],this.originalReminders=s.reminders?[...s.reminders]:[],this.onSave=i}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("tasknotes-plugin"),t.addClass("tasknotes-reminder-modal"),t.createDiv({cls:"reminder-modal__loading"}).createEl("div",{text:"Loading reminders..."}),this.initializeWithFreshData().catch(s=>{console.error("Failed to initialize reminder modal:",s),t.empty(),t.addClass("tasknotes-plugin"),t.addClass("tasknotes-reminder-modal"),t.createDiv({cls:"reminder-modal__error",text:"Failed to load task data. Please try again."})})}async initializeWithFreshData(){let{contentEl:t}=this;if(this.task.path&&this.task.path.trim()!==""){let a=await this.plugin.cacheManager.getTaskInfo(this.task.path);a?(this.task=a,this.reminders=a.reminders?[...a.reminders]:[],this.originalReminders=a.reminders?[...a.reminders]:[]):(this.reminders=this.task.reminders?[...this.task.reminders]:[],this.originalReminders=this.task.reminders?[...this.task.reminders]:[])}else this.reminders=this.task.reminders?[...this.task.reminders]:[],this.originalReminders=this.task.reminders?[...this.task.reminders]:[];t.empty(),t.addClass("tasknotes-plugin"),t.addClass("tasknotes-reminder-modal");let r=t.createDiv({cls:"reminder-modal__header"});r.createEl("h2",{text:"Task Reminders"}),r.createDiv({cls:"reminder-modal__task-title",text:this.task.title});let s=this.getTaskContextInfo();if(s){let a=r.createDiv({cls:"reminder-modal__task-dates"});a.textContent=s}let i=t.createDiv({cls:"reminder-modal__content"});this.renderExistingReminders(i),this.renderAddReminderForm(i),this.renderActionButtons(t),this.setupKeyboardHandlers(),this.updateSaveButtonState()}renderActionButtons(t){let r=t.createDiv({cls:"reminder-modal__actions"});this.saveBtn=r.createEl("button",{text:"Save Changes",cls:"mod-cta reminder-modal__save-btn"}),this.saveBtn.disabled=!0,this.saveBtn.onclick=async()=>{await this.save()};let s=r.createEl("button",{text:"Cancel",cls:"reminder-modal__cancel-btn"});s.onclick=()=>{this.cancel()}}getTaskContextInfo(){let t=[];return this.task.due&&t.push(`Due: ${hs(this.task.due)}`),this.task.scheduled&&t.push(`Scheduled: ${hs(this.task.scheduled)}`),t.length>0?t.join(" \u2022 "):null}setupKeyboardHandlers(){let t=async r=>{r.key==="Enter"&&(r.ctrlKey||r.metaKey)&&!this.saveBtn.disabled?(r.preventDefault(),await this.save()):r.key==="Escape"&&(r.preventDefault(),this.cancel())};this.contentEl.addEventListener("keydown",t),this.onClose=()=>{this.contentEl.removeEventListener("keydown",t);let{contentEl:r}=this;r.empty()}}updateSaveButtonState(){if(!this.saveBtn)return;let t=this.remindersHaveChanged();this.saveBtn.disabled=!t,this.saveBtn.textContent=t?"Save Changes":"No Changes"}renderExistingReminders(t){let r=t.createDiv({cls:"reminder-modal__section"}),s=r.createDiv({cls:"reminder-modal__section-header"});if(s.createEl("h3",{text:"Current Reminders"}),this.reminders.length>0&&s.createSpan({cls:"reminder-modal__reminder-count",text:`(${this.reminders.length})`}),this.reminders.length===0){let a=r.createDiv({cls:"reminder-modal__empty-state"});(0,bt.setIcon)(a.createDiv({cls:"reminder-modal__empty-icon"}),"bell-off"),a.createEl("div",{cls:"reminder-modal__empty-text",text:"No reminders set"});return}let i=r.createDiv({cls:"reminder-modal__reminder-list"});this.reminders.forEach((a,o)=>{let l=i.createDiv({cls:"reminder-modal__reminder-card"}),c=l.createDiv({cls:"reminder-modal__reminder-icon"}),d=a.type==="absolute"?"calendar-clock":"timer";(0,bt.setIcon)(c,d);let u=l.createDiv({cls:"reminder-modal__reminder-content"}),h=u.createDiv({cls:"reminder-modal__reminder-primary"});if(h.textContent=this.formatReminderDisplayText(a),a.description){let m=u.createDiv({cls:"reminder-modal__reminder-description"});m.textContent=`"${a.description}"`}let p=l.createDiv({cls:"reminder-modal__reminder-actions"}).createEl("button",{cls:"reminder-modal__action-btn reminder-modal__remove-btn"});(0,bt.setIcon)(p,"trash-2"),(0,bt.setTooltip)(p,"Delete this reminder"),p.onclick=async m=>{m.stopPropagation(),await this.removeReminder(o)}})}formatReminderDisplayText(t){if(t.type==="absolute"){if(t.absoluteTime)try{let r=new Date(t.absoluteTime);return`${r.toLocaleDateString()} at ${r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`}catch(r){return`At ${t.absoluteTime}`}return"Absolute reminder"}else{let r=t.relatedTo==="due"?"due date":"scheduled date";return`${this.formatOffset(t.offset||"")} ${r}`}}renderQuickActions(t){if(!(this.task.due||this.task.scheduled))return;let i=t.createDiv({cls:"reminder-modal__quick-actions"}).createDiv({cls:"reminder-modal__quick-buttons"});[{label:"5m",fullLabel:"5 minutes before",offset:"-PT5M",icon:"clock"},{label:"15m",fullLabel:"15 minutes before",offset:"-PT15M",icon:"clock"},{label:"1h",fullLabel:"1 hour before",offset:"-PT1H",icon:"clock"},{label:"1d",fullLabel:"1 day before",offset:"-P1D",icon:"calendar"}].forEach(({label:o,fullLabel:l,offset:c,icon:d})=>{let u=this.task.due?"due":"scheduled",h=i.createEl("button",{cls:"reminder-modal__quick-btn"}),f=h.createSpan({cls:"reminder-modal__quick-btn-icon"});(0,bt.setIcon)(f,d),h.createSpan({cls:"reminder-modal__quick-btn-label",text:o}),(0,bt.setTooltip)(h,`Add reminder ${l} ${u} date`),h.onclick=async()=>{await this.addQuickReminder(u,c,l)}})}async addQuickReminder(t,r,s){let i={id:`rem_${Date.now()}`,type:"relative",relatedTo:t,offset:r,description:s};await this.addReminder(i),new bt.Notice(`Added reminder: ${s}`)}renderAddReminderForm(t){let r=t.createDiv({cls:"reminder-modal__section"});r.createDiv({cls:"reminder-modal__section-header"}).createEl("h3",{text:"Add New Reminder"}),this.renderQuickActions(r);let i=r.createDiv({cls:"reminder-modal__form"}),a=i.createDiv({cls:"reminder-modal__type-selector"}),o=a.createEl("button",{cls:"reminder-modal__type-tab reminder-modal__type-tab--active",text:"Relative",attr:{"data-type":"relative"}}),l=a.createEl("button",{cls:"reminder-modal__type-tab",text:"Absolute",attr:{"data-type":"absolute"}});o.classList.toggle("reminder-modal__type-tab--active",this.selectedType==="relative"),l.classList.toggle("reminder-modal__type-tab--active",this.selectedType==="absolute");let c=p=>{this.selectedType=p,o.classList.toggle("reminder-modal__type-tab--active",p==="relative"),l.classList.toggle("reminder-modal__type-tab--active",p==="absolute"),this.updateFormVisibility(i,this.selectedType)};o.onclick=()=>c("relative"),l.onclick=()=>c("absolute");let d=i.createDiv({cls:"relative-fields"});new bt.Setting(d).setName("Time").addText(p=>{p.setPlaceholder("15").setValue(String(this.relativeOffset)).onChange(m=>{this.relativeOffset=parseInt(m)||0})}).addDropdown(p=>{p.addOption("minutes","minutes").addOption("hours","hours").addOption("days","days").setValue(this.relativeUnit).onChange(m=>{this.relativeUnit=m})}),new bt.Setting(d).setName("Direction").addDropdown(p=>{p.addOption("before","Before").addOption("after","After").setValue(this.relativeDirection).onChange(m=>{this.relativeDirection=m})}),new bt.Setting(d).setName("Relative to").addDropdown(p=>{let m={};this.task.due&&(m.due=`Due date (${hs(this.task.due)})`),this.task.scheduled&&(m.scheduled=`Scheduled date (${hs(this.task.scheduled)})`),Object.keys(m).length===0?(m.none="No dates available",p.setDisabled(!0)):(Object.entries(m).forEach(([g,y])=>{p.addOption(g,y)}),p.setValue(this.relativeAnchor)),p.onChange(g=>{this.relativeAnchor=g})});let u=i.createDiv({cls:"absolute-fields"});new bt.Setting(u).setName("Date").addText(p=>{p.setPlaceholder("YYYY-MM-DD").setValue(this.absoluteDate).onChange(m=>{this.absoluteDate=m}),p.inputEl.type="date"}),new bt.Setting(u).setName("Time").addText(p=>{p.setPlaceholder("HH:MM").setValue(this.absoluteTime).onChange(m=>{this.absoluteTime=m}),p.inputEl.type="time"}),new bt.Setting(i).setName("Description (optional)").addText(p=>{p.setPlaceholder("Custom reminder message").setValue(this.description).onChange(m=>{this.description=m})});let h=i.createEl("button",{cls:"reminder-add-btn"}),f=h.createSpan({cls:"reminder-add-btn-icon"});(0,bt.setIcon)(f,"plus"),h.createSpan({cls:"reminder-add-btn-text",text:"Add Reminder"}),h.onclick=async()=>{h.disabled=!0,h.classList.add("reminder-add-btn--loading");try{let p=this.createReminder(this.selectedType,this.relativeAnchor,this.relativeOffset,this.relativeUnit,this.relativeDirection,this.absoluteDate,this.absoluteTime,this.description);p&&(await this.addReminder(p),this.selectedType==="relative"?(this.relativeOffset=15,this.relativeUnit="minutes",this.description=""):(this.absoluteDate="",this.absoluteTime="",this.description=""),this.resetFormInputs(i))}catch(p){console.error("Error adding reminder:",p),new bt.Notice("Failed to add reminder. Please check your inputs.")}finally{h.disabled=!1,h.classList.remove("reminder-add-btn--loading")}},this.updateFormVisibility(i,this.selectedType)}updateFormVisibility(t,r){let s=t.querySelector(".relative-fields"),i=t.querySelector(".absolute-fields");r==="relative"?(s.style.display="block",i.style.display="none"):(s.style.display="none",i.style.display="block")}createReminder(t,r,s,i,a,o,l,c){let d=`rem_${Date.now()}`;if(t==="relative"){if(!(r==="due"?this.task.due:this.task.scheduled))return new bt.Notice(`Cannot create reminder: Task has no ${r} date`),null;let h="PT";return i==="days"?h=`P${s}D`:i==="hours"?h=`PT${s}H`:h=`PT${s}M`,a==="before"&&(h="-"+h),{id:d,type:"relative",relatedTo:r,offset:h,description:c||void 0}}else{if(!o||!l)return new bt.Notice("Please specify both date and time for absolute reminder"),null;let u=`${o}T${l}:00`;return{id:d,type:"absolute",absoluteTime:u,description:c||void 0}}}formatReminderTiming(t){if(t.type==="absolute")return"Absolute reminder";{let r=t.relatedTo==="due"?"due date":"scheduled date";return`${this.formatOffset(t.offset||"")} ${r}`}}formatReminderDetails(t){if(t.type==="absolute")return`At ${hs(t.absoluteTime||"")}`;{let r=t.relatedTo==="due"?this.task.due:this.task.scheduled;return r?`When ${t.relatedTo} date is ${hs(r)}`:`Relative to ${t.relatedTo} date (not set)`}}formatReminderDescription(t){if(t.description)return t.description;if(t.type==="absolute")return`At ${hs(t.absoluteTime||"")}`;{let r=t.relatedTo==="due"?"due date":"scheduled date";return`${this.formatOffset(t.offset||"")} ${r}`}}formatOffset(t){let r=t.startsWith("-"),i=(r?t.substring(1):t).match(/P(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?)?/);if(!i)return t;let[,a,o,l]=i,c=[];if(a&&c.push(`${a} day${a!=="1"?"s":""}`),o&&c.push(`${o} hour${o!=="1"?"s":""}`),l&&c.push(`${l} minute${l!=="1"?"s":""}`),c.length===0)return"At time of";let d=c.join(" ");return r?`${d} before`:`${d} after`}async addReminder(t){this.reminders.push(t),this.refreshRemindersListOnly(),this.task.path&&this.plugin.emitter.trigger("reminder-preview-changed",{taskPath:this.task.path,currentReminders:[...this.reminders],action:"added",reminder:t})}async removeReminder(t){let r=this.reminders[t];this.reminders.splice(t,1),this.refreshRemindersListOnly(),this.task.path&&r&&this.plugin.emitter.trigger("reminder-preview-changed",{taskPath:this.task.path,currentReminders:[...this.reminders],action:"removed",reminder:r})}async refresh(){await this.initializeWithFreshData()}refreshRemindersListOnly(){let t=this.contentEl.querySelector(".reminder-modal__content");if(t){let r=t.querySelector(".reminder-modal__section");r&&r.remove();let s=document.createElement("div");this.renderExistingReminders(s);let i=s.firstChild;i&&t.insertBefore(i,t.firstChild)}this.updateSaveButtonState()}resetFormInputs(t){let r=t.querySelector('input[placeholder="15"]');r&&(r.value=String(this.relativeOffset));let s=t.querySelector('input[placeholder="Custom reminder message"]');s&&(s.value=this.description);let i=t.querySelector('input[type="date"]');i&&(i.value=this.absoluteDate);let a=t.querySelector('input[type="time"]');a&&(a.value=this.absoluteTime);let o=t.querySelector('.setting-item:has(input[placeholder="15"]) select');o&&(o.value=this.relativeUnit);let l=t.querySelector(".setting-item:nth-child(2) select");l&&(l.value=this.relativeDirection);let c=t.querySelector(".setting-item:nth-child(3) select");c&&(c.value=this.relativeAnchor)}async save(){var t;this.saveBtn.disabled=!0,this.saveBtn.textContent="Saving...";try{this.task.path&&this.task.path.trim()!==""&&((t=this.plugin.notificationService)==null||t.clearProcessedRemindersForTask(this.task.path));let r=this.remindersHaveChanged();this.onSave(this.reminders),r&&this.task.path&&this.plugin.emitter.trigger("reminder-changed",{taskPath:this.task.path,oldReminders:this.originalReminders,newReminders:[...this.reminders]}),this.close()}catch(r){console.error("Failed to save reminders:",r),new bt.Notice("Failed to save reminders. Please try again."),this.saveBtn.disabled=!1,this.saveBtn.textContent="Save Changes"}}cancel(){this.remindersHaveChanged()&&this.task.path&&this.plugin.emitter.trigger("reminder-preview-changed",{taskPath:this.task.path,currentReminders:[...this.originalReminders],action:"cancelled"}),this.close()}remindersHaveChanged(){return this.reminders.length!==this.originalReminders.length?!0:!this.reminders.every((t,r)=>{let s=this.originalReminders[r];return s?t.id===s.id&&t.type===s.type&&t.relatedTo===s.relatedTo&&t.offset===s.offset&&t.absoluteTime===s.absoluteTime&&t.description===s.description:!1})}onClose(){let{contentEl:t}=this;t.empty()}}});var fP={};nt(fP,{CalendarExportService:()=>Un});var uo,Un,um=v(()=>{At();uo=require("obsidian"),Un=class{static generateCalendarURL(e){let{type:t,task:r,useScheduledAsDue:s=!0}=e;switch(t){case"google":return this.generateGoogleCalendarURL(r,s);case"outlook":return this.generateOutlookCalendarURL(r,s);case"yahoo":return this.generateYahooCalendarURL(r,s);case"ics":return this.generateICSDownloadURL(r);default:throw new Error(`Unsupported calendar type: ${t}`)}}static openCalendarURL(e){try{let t=this.generateCalendarURL(e);window.open(t,"_blank")}catch(t){console.error("Failed to generate calendar URL:",t),new uo.Notice("Failed to generate calendar link")}}static generateGoogleCalendarURL(e,t){let r="https://calendar.google.com/calendar/render",s=new URLSearchParams;s.append("action","TEMPLATE"),s.append("text",e.title);let i=this.formatGoogleDates(e,t);i&&s.append("dates",i);let a=this.buildDescription(e);return a&&s.append("details",a),e.contexts&&e.contexts.length>0&&s.append("location",e.contexts.join(", ")),`${r}?${s.toString()}`}static generateOutlookCalendarURL(e,t){let r="https://outlook.live.com/calendar/0/deeplink/compose",s=new URLSearchParams;s.append("subject",e.title);let{startISO:i,endISO:a}=this.getTaskDateRange(e,t);i&&s.append("startdt",i),a&&s.append("enddt",a);let o=this.buildDescription(e);return o&&s.append("body",o),e.contexts&&e.contexts.length>0&&s.append("location",e.contexts.join(", ")),s.append("path","/calendar/action/compose"),s.append("rru","addevent"),`${r}?${s.toString()}`}static generateYahooCalendarURL(e,t){let r="https://calendar.yahoo.com/",s=new URLSearchParams;s.append("v","60"),s.append("title",e.title);let{startYahoo:i,endYahoo:a}=this.getYahooDateFormat(e,t);i&&s.append("st",i),a&&s.append("et",a);let o=this.buildDescription(e);return o&&s.append("desc",o),e.contexts&&e.contexts.length>0&&s.append("in_loc",e.contexts.join(", ")),`${r}?${s.toString()}`}static generateICSDownloadURL(e){let t=this.generateICSContent(e);return`data:text/calendar;charset=utf8,${encodeURIComponent(t)}`}static generateICSContent(e){let t=`${e.path.replace(/[^a-zA-Z0-9]/g,"-")}-${Date.now()}@tasknotes`,r=new Date().toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),s=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//TaskNotes//Task Export//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","BEGIN:VEVENT",`UID:${t}`,`DTSTAMP:${r}`];s.push(`SUMMARY:${this.escapeICSText(e.title)}`);let{startICS:i,endICS:a}=this.getICSDateFormat(e);i&&s.push(`DTSTART:${i}`),a&&s.push(`DTEND:${a}`);let o=this.buildDescription(e);if(o&&s.push(`DESCRIPTION:${this.escapeICSText(o)}`),e.contexts&&e.contexts.length>0&&s.push(`LOCATION:${this.escapeICSText(e.contexts.join(", "))}`),e.tags&&e.tags.length>0&&s.push(`CATEGORIES:${e.tags.map(l=>this.escapeICSText(l)).join(",")}`),e.priority){let c={highest:"1",high:"3",medium:"5",low:"7",lowest:"9"}[e.priority]||"5";s.push(`PRIORITY:${c}`)}if(e.status){let c={done:"COMPLETED","in-progress":"IN-PROCESS",todo:"NEEDS-ACTION",cancelled:"CANCELLED"}[e.status]||"NEEDS-ACTION";s.push(`STATUS:${c}`)}return s.push("END:VEVENT"),s.push("END:VCALENDAR"),s.join(`\r
`)}static buildDescription(e){let t=[],r=[];return e.priority&&r.push(`Priority: ${e.priority}`),e.status&&r.push(`Status: ${e.status}`),e.projects&&e.projects.length>0&&r.push(`Projects: ${e.projects.join(", ")}`),e.tags&&e.tags.length>0&&r.push(`Tags: ${e.tags.join(", ")}`),e.contexts&&e.contexts.length>0&&r.push(`Contexts: ${e.contexts.join(", ")}`),e.timeEstimate&&r.push(`Estimated time: ${e.timeEstimate} minutes`),r.length>0&&t.push(...r),t.length>0&&t.push(""),t.push(`Exported from TaskNotes: ${e.path}`),t.join(`
`)}static formatGoogleDates(e,t){let{startICS:r,endICS:s}=this.getICSDateFormat(e,t);if(!r)return null;if(s)return`${r}/${s}`;let i=this.parseICSDate(r),a=new Date(i.getTime()+3600*1e3),o=this.formatDateToICS(a);return`${r}/${o}`}static getTaskDateRange(e,t){let r=null,s=null;if(e.scheduled)try{r=this.parseTaskDate(e.scheduled).toISOString()}catch(i){console.warn("Invalid scheduled date:",e.scheduled)}if(e.due)try{s=this.parseTaskDate(e.due).toISOString()}catch(i){console.warn("Invalid due date:",e.due)}else if(t&&r){let i=new Date(r);s=new Date(i.getTime()+3600*1e3).toISOString()}return{startISO:r,endISO:s}}static getYahooDateFormat(e,t){let{startISO:r,endISO:s}=this.getTaskDateRange(e,t),i=a=>{let o=new Date(a);return x(o,"yyyyMMdd'T'HHmmss")};return{startYahoo:r?i(r):null,endYahoo:s?i(s):null}}static getICSDateFormat(e,t=!0){let{startISO:r,endISO:s}=this.getTaskDateRange(e,t),i=a=>{let o=new Date(a);return this.formatDateToICS(o)};return{startICS:r?i(r):null,endICS:s?i(s):null}}static formatDateToICS(e){return e.toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,"")}static parseICSDate(e){let t=e.substr(0,4),r=e.substr(4,2),s=e.substr(6,2),i=e.substr(9,2),a=e.substr(11,2),o=e.substr(13,2);return new Date(`${t}-${r}-${s}T${i}:${a}:${o}Z`)}static parseTaskDate(e){return e.includes("T")?Qa(e):Qa(`${e}T00:00:00`)}static escapeICSText(e){return e.replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n").replace(/\r/g,"")}static foldICSLines(e){let t=e.split(`\r
`),r=[];return t.forEach(s=>{if(s.length<=75)r.push(s);else{let i=s;for(;i.length>75;)r.push(i.substring(0,75)),i=" "+i.substring(75);i.length>0&&r.push(i)}}),r.join(`\r
`)}static generateMultipleTasksICSContent(e){let t=new Date().toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),r=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//TaskNotes//EN","CALSCALE:GREGORIAN"];return e.forEach((s,i)=>{let a=`${s.path.replace(/[^a-zA-Z0-9]/g,"-")}-${i}-${Date.now()}@tasknotes`;r.push("BEGIN:VEVENT"),r.push(`UID:${a}`),r.push(`DTSTAMP:${t}`),r.push(`SUMMARY:${this.escapeICSText(s.title)}`);let{startICS:o,endICS:l}=this.getICSDateFormat(s);if(o){if(!l){let d=this.parseICSDate(o),u=new Date(d.getTime()+3600*1e3);l=this.formatDateToICS(u)}}else{let d;if(s.dateCreated?d=new Date(s.dateCreated):d=new Date,o=this.formatDateToICS(d),!l){let u=new Date(d.getTime()+36e5);l=this.formatDateToICS(u)}}r.push(`DTSTART:${o}`),r.push(`DTEND:${l}`);let c=this.buildDescription(s);if(c&&r.push(`DESCRIPTION:${this.escapeICSText(c)}`),s.contexts&&s.contexts.length>0&&r.push(`LOCATION:${this.escapeICSText(s.contexts.join(", "))}`),s.tags&&s.tags.length>0&&r.push(`CATEGORIES:${s.tags.map(d=>this.escapeICSText(d)).join(",")}`),s.priority){let u={highest:"1",high:"3",medium:"5",low:"7",lowest:"9"}[s.priority]||"5";r.push(`PRIORITY:${u}`)}if(s.status){let u={done:"COMPLETED","in-progress":"IN-PROCESS",todo:"NEEDS-ACTION",cancelled:"CANCELLED"}[s.status]||"NEEDS-ACTION";r.push(`STATUS:${u}`)}r.push("END:VEVENT")}),r.push("END:VCALENDAR"),this.foldICSLines(r.join(`\r
`))}static downloadAllTasksICSFile(e){try{if(!e||e.length===0){new uo.Notice("No tasks found to export");return}let t=this.generateMultipleTasksICSContent(e),r=new Blob([t],{type:"text/calendar"}),s=URL.createObjectURL(r),a=`tasknotes-all-tasks-${new Date().toISOString().split("T")[0]}.ics`,o=document.createElement("a");o.href=s,o.download=a,o.click(),URL.revokeObjectURL(s),new uo.Notice(`Downloaded ${a} with ${e.length} task${e.length===1?"":"s"}`)}catch(t){console.error("Failed to download all tasks ICS file:",t),new uo.Notice("Failed to download calendar file")}}static downloadICSFile(e){try{let t=this.generateICSContent(e),r=new Blob([t],{type:"text/calendar"}),s=URL.createObjectURL(r),i=`${e.title.replace(/[^a-zA-Z0-9]/g,"-")}.ics`,a=document.createElement("a");a.href=s,a.download=i,a.click(),URL.revokeObjectURL(s),new uo.Notice(`Downloaded ${i}`)}catch(t){console.error("Failed to download ICS file:",t),new uo.Notice("Failed to download calendar file")}}}});async function pP(n,e){return new HT(n,e).show()}var Ld,HT,mP=v(()=>{Ld=require("obsidian"),HT=class extends Ld.Modal{constructor(e,t){super(e),this.options={confirmText:"Confirm",cancelText:"Cancel",...t}}show(){return new Promise(e=>{this.resolve=e,this.open()})}onOpen(){let{contentEl:e}=this;e.empty(),new Ld.Setting(e).setName(this.options.title).setHeading(),new Ld.Setting(e).addText(i=>{this.inputEl=i.inputEl,i.setPlaceholder(this.options.placeholder||"").setValue(this.options.initialValue||"").onChange(()=>{}),setTimeout(()=>{this.inputEl.focus(),this.inputEl.select()},100)});let t=e.createEl("div",{cls:"modal-button-container"});t.style.display="flex",t.style.gap="10px",t.style.justifyContent="flex-end",t.style.marginTop="20px";let r=t.createEl("button",{text:this.options.cancelText});r.addEventListener("click",()=>{this.resolve(null),this.close()});let s=t.createEl("button",{text:this.options.confirmText,cls:"mod-cta"});s.addEventListener("click",()=>{let i=this.inputEl.value.trim();this.resolve(i||null),this.close()}),this.inputEl.addEventListener("keydown",i=>{i.key==="Enter"?(i.preventDefault(),s.click()):i.key==="Escape"&&(i.preventDefault(),r.click())})}onClose(){let{contentEl:e}=this;e.empty(),this.resolve&&this.resolve(null)}}});var Fd,Kr,Vl=v(()=>{Fd=require("obsidian"),Kr=class{constructor(e){this.menu=new Fd.Menu,this.options=e,this.buildMenu()}buildMenu(){this.options.title&&(this.menu.addItem(i=>{i.setTitle(this.options.title),i.setIcon("calendar"),i.setDisabled(!0)}),this.menu.addSeparator());let e=this.getDateOptions(),t=e.filter(i=>i.label.startsWith("+")||i.label.startsWith("-"));t.length>0&&(t.forEach(i=>{this.menu.addItem(a=>{let o=i.label;i.icon&&a.setIcon(i.icon),a.setTitle(o),a.onClick(async()=>{this.options.onSelect(i.value,null)})})}),this.menu.addSeparator()),e.filter(i=>!i.label.startsWith("+")&&!i.label.startsWith("-")&&!["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(i.label)).forEach(i=>{this.menu.addItem(a=>{let o=i.label;i.icon&&a.setIcon(i.icon),i.value&&i.value===this.options.currentValue&&(o=`\u2713 ${i.label}`),a.setTitle(o),a.onClick(async()=>{this.options.onSelect(i.value,null)})})});let s=e.filter(i=>["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(i.label));s.length>0&&(this.menu.addSeparator(),this.menu.addItem(i=>{i.setTitle("Weekdays"),i.setIcon("calendar");let a=i.setSubmenu();s.forEach(o=>{a.addItem(l=>{let c=o.label;o.value&&o.value===this.options.currentValue&&(c=`\u2713 ${o.label}`),l.setTitle(c),l.setIcon("calendar"),l.onClick(async()=>{this.options.onSelect(o.value,null)})})})})),this.menu.addSeparator(),this.menu.addItem(i=>{i.setTitle("Pick date & time..."),i.setIcon("calendar"),i.onClick(async()=>{this.showDateTimePicker()})}),this.options.currentValue&&this.menu.addItem(i=>{i.setTitle("Clear date"),i.setIcon("x"),i.onClick(async()=>{this.options.onSelect(null,null)})})}getDateOptions(){let e=window.moment(),t=[];if(this.options.currentValue){let o=window.moment(this.options.currentValue);t.push({label:"+1 day",value:o.clone().add(1,"day").format("YYYY-MM-DD"),icon:"plus"}),t.push({label:"-1 day",value:o.clone().subtract(1,"day").format("YYYY-MM-DD"),icon:"minus"}),t.push({label:"+1 week",value:o.clone().add(1,"week").format("YYYY-MM-DD"),icon:"plus-circle"}),t.push({label:"-1 week",value:o.clone().subtract(1,"week").format("YYYY-MM-DD"),icon:"minus-circle"})}t.push({label:"Today",value:e.format("YYYY-MM-DD"),icon:"calendar-check",isToday:!0}),t.push({label:"Tomorrow",value:e.clone().add(1,"day").format("YYYY-MM-DD"),icon:"calendar-plus"}),[{name:"Monday",day:1},{name:"Tuesday",day:2},{name:"Wednesday",day:3},{name:"Thursday",day:4},{name:"Friday",day:5},{name:"Saturday",day:6},{name:"Sunday",day:0}].forEach(o=>{let l=e.clone().day(o.day);l.isSameOrBefore(e,"day")&&(l=l.add(1,"week")),t.push({label:o.name,value:l.format("YYYY-MM-DD"),icon:"calendar"})});let s=e.clone().day(6);(s.isBefore(e)||s.isSame(e,"day"))&&s.add(1,"week"),t.push({label:"This weekend",value:s.format("YYYY-MM-DD"),icon:"calendar-days"});let i=e.clone().day(1).add(1,"week");t.push({label:"Next week",value:i.format("YYYY-MM-DD"),icon:"calendar-plus"});let a=e.clone().add(1,"month").startOf("month");return t.push({label:"Next month",value:a.format("YYYY-MM-DD"),icon:"calendar-range"}),t}show(e){this.menu.showAtMouseEvent(e)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4})}showDateTimePicker(){let e=this.createModal(),t=this.createHeader(),r=this.createDateSection(),s=this.createTimeSection(),i=this.createButtonSection();e.appendChild(t),e.appendChild(r.container),e.appendChild(s.container),e.appendChild(i.container),document.body.appendChild(e),this.setupModalEventHandlers(e,r.input,s.input,i.selectButton),setTimeout(()=>{r.input.focus()},100)}createModal(){let e=document.createElement("div");return e.className="date-picker-modal",e}createHeader(){let e=document.createElement("div");e.className="date-picker-modal__header";let t=document.createElement("div");t.className="date-picker-modal__header-icon",(0,Fd.setIcon)(t,"calendar");let r=document.createElement("h3");return r.className="date-picker-modal__header-title",r.textContent="Set date & time",e.appendChild(t),e.appendChild(r),e}createDateSection(){var i;let e=document.createElement("div");e.className="date-picker-modal__section";let t=this.createInputLabel("calendar","Date"),r=this.createInputContainer(),s=this.createDateInput();return(i=this.options.currentValue)!=null&&i.trim()&&(s.value=this.options.currentValue),r.appendChild(s),e.appendChild(t),e.appendChild(r),{container:e,input:s}}createTimeSection(){var i;let e=document.createElement("div");e.className="date-picker-modal__section date-picker-modal__section--buttons";let t=this.createInputLabel("clock","Time (optional)"),r=this.createInputContainer(),s=this.createTimeInput();return(i=this.options.currentTime)!=null&&i.trim()&&(s.value=this.options.currentTime),r.appendChild(s),e.appendChild(t),e.appendChild(r),{container:e,input:s}}createInputLabel(e,t){let r=document.createElement("label");r.className="date-picker-modal__label";let s=document.createElement("div");s.className="date-picker-modal__label-icon",(0,Fd.setIcon)(s,e==="calendar"?"calendar":"clock");let i=document.createElement("span");return i.textContent=t,r.appendChild(s),r.appendChild(i),r}createInputContainer(){let e=document.createElement("div");return e.className="date-picker-modal__input-container",e}createDateInput(){let e=document.createElement("input");return e.type="date",e.className="date-picker-modal__input",this.addPickerClickHandler(e),e}createTimeInput(){let e=document.createElement("input");return e.type="time",e.className="date-picker-modal__input",this.addPickerClickHandler(e),e}addPickerClickHandler(e){e.addEventListener("click",()=>{if("showPicker"in e&&typeof e.showPicker=="function")try{e.showPicker()}catch(t){e.focus()}else e.focus()})}createButtonSection(){let e=document.createElement("div");e.className="date-picker-modal__buttons";let t=this.createButton("Cancel",!1),r=this.createButton("Select",!0);return e.appendChild(t),e.appendChild(r),{container:e,selectButton:r}}createButton(e,t){let r=document.createElement("button");return r.textContent=e,r.className=t?"date-picker-modal__button date-picker-modal__button--primary":"date-picker-modal__button date-picker-modal__button--secondary",r}setupModalEventHandlers(e,t,r,s){s.addEventListener("click",()=>{t.value&&this.options.onSelect(t.value,r.value||null),document.body.removeChild(e)}),e.querySelector(".date-picker-modal__button--secondary").addEventListener("click",()=>{document.body.removeChild(e)});let a=c=>{c.key==="Escape"&&(document.body.removeChild(e),document.removeEventListener("keydown",a))};document.addEventListener("keydown",a);let o=c=>{c.key==="Enter"&&(c.preventDefault(),s.click())};t.addEventListener("keydown",o),r.addEventListener("keydown",o);let l=c=>{e.contains(c.target)||(document.body.removeChild(e),document.removeEventListener("click",l),document.removeEventListener("keydown",a))};setTimeout(()=>{document.addEventListener("click",l)},100)}}});var ms,Wn,UT,Bd=v(()=>{ms=require("obsidian"),Wn=class{constructor(e){this.menu=new ms.Menu,this.options=e,this.buildMenu()}buildMenu(){this.getRecurrenceOptions().forEach(t=>{this.menu.addItem(r=>{let s=t.label;t.icon&&r.setIcon(t.icon),t.value===this.options.currentValue&&(s=`\u2713 ${t.label}`),r.setTitle(s),r.onClick(async()=>{this.options.onSelect(t.value)})})}),this.menu.addSeparator(),this.menu.addItem(t=>{t.setTitle("Custom recurrence..."),t.setIcon("settings"),t.onClick(async()=>{this.showCustomRecurrenceModal()})}),this.options.currentValue&&this.menu.addItem(t=>{t.setTitle("Clear recurrence"),t.setIcon("x"),t.onClick(async()=>{this.options.onSelect(null)})})}getRecurrenceOptions(){let e=[],t=new Date,r=["SU","MO","TU","WE","TH","FR","SA"],s=["January","February","March","April","May","June","July","August","September","October","November","December"],i=r[t.getDay()],a=t.getDate(),o=t.getMonth()+1,l=s[t.getMonth()],c=t.toLocaleDateString("en-US",{weekday:"long"}),d=this.formatDateForDTSTART(t);if(this.options.currentValue){let u=this.options.currentValue.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(u&&u[1].includes("T")){let h=u[1].split("T")[1];d=`${d}T${h}`}}return e.push({label:"Daily",value:`DTSTART:${d};FREQ=DAILY;INTERVAL=1`,icon:"calendar-days"}),e.push({label:`Weekly on ${c}`,value:`DTSTART:${d};FREQ=WEEKLY;INTERVAL=1;BYDAY=${i}`,icon:"calendar"}),e.push({label:`Every 2 weeks on ${c}`,value:`DTSTART:${d};FREQ=WEEKLY;INTERVAL=2;BYDAY=${i}`,icon:"calendar"}),e.push({label:`Monthly on the ${this.getOrdinal(a)}`,value:`DTSTART:${d};FREQ=MONTHLY;INTERVAL=1;BYMONTHDAY=${a}`,icon:"calendar-range"}),e.push({label:`Every 3 months on the ${this.getOrdinal(a)}`,value:`DTSTART:${d};FREQ=MONTHLY;INTERVAL=3;BYMONTHDAY=${a}`,icon:"calendar-range"}),e.push({label:`Yearly on ${l} ${this.getOrdinal(a)}`,value:`DTSTART:${d};FREQ=YEARLY;INTERVAL=1;BYMONTH=${o};BYMONTHDAY=${a}`,icon:"calendar-clock"}),e.push({label:"Weekdays only",value:`DTSTART:${d};FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR`,icon:"briefcase"}),e}formatDateForDTSTART(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${t}${r}${s}`}getOrdinal(e){let t=["th","st","nd","rd"],r=e%100;return e+(t[(r-20)%10]||t[r]||t[0])}showCustomRecurrenceModal(){new UT(this.options.app,this.options.currentValue||"",e=>{e&&this.options.onSelect(e)}).open()}show(e){this.menu.showAtMouseEvent(e)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4})}},UT=class extends ms.Modal{constructor(t,r,s){super(t);this.frequency="DAILY";this.interval=1;this.byDay=[];this.byMonthDay=[];this.byMonth=[];this.until="";this.endType="never";this.dtstart="";this.dtstartTime="";this.currentValue=r,this.onSubmit=s,this.parseCurrentValue()}parseCurrentValue(){if(!this.currentValue){this.dtstart=this.formatTodayForInput();return}let t=this.currentValue.split(";");for(let r of t){let[s,i]=r.split("=");switch(s){case"DTSTART":if(i.length>=8){if(this.dtstart=`${i.slice(0,4)}-${i.slice(4,6)}-${i.slice(6,8)}`,i.length>8&&i.includes("T")){let a=i.slice(9);a.length>=4&&(this.dtstartTime=`${a.slice(0,2)}:${a.slice(2,4)}`)}}else{let a=new Date(i);isNaN(a.getTime())?this.dtstart=this.formatTodayForInput():this.dtstart=i}break;case"FREQ":this.frequency=i;break;case"INTERVAL":this.interval=parseInt(i)||1;break;case"BYDAY":{let a=i.split(","),o=[];for(let l of a){let c=l.match(/^(-?\d+)([A-Z]{2})$/);c?(this.bySetPos=parseInt(c[1]),o.push(c[2])):o.push(l)}this.byDay=o;break}case"BYMONTHDAY":this.byMonthDay=i.split(",").map(a=>parseInt(a));break;case"BYMONTH":this.byMonth=i.split(",").map(a=>parseInt(a));break;case"BYSETPOS":this.bySetPos=parseInt(i);break;case"COUNT":this.count=parseInt(i),this.endType="count";break;case"UNTIL":i.length===8?this.until=`${i.slice(0,4)}-${i.slice(4,6)}-${i.slice(6,8)}`:this.until=i,this.endType="until";break}}}formatTodayForInput(){let t=new Date,r=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${r}-${s}-${i}`}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Custom Recurrence"}),new ms.Setting(t).setName("Start date").setDesc("The date when the recurrence pattern begins").addText(X=>{X.inputEl.type="date",X.setValue(this.dtstart).onChange(ae=>{this.dtstart=ae})}),new ms.Setting(t).setName("Start time").setDesc("The time when recurring instances should appear (optional)").addText(X=>{X.inputEl.type="time",X.setValue(this.dtstartTime).onChange(ae=>{this.dtstartTime=ae})}),new ms.Setting(t).setName("Frequency").addDropdown(X=>{X.addOption("DAILY","Daily").addOption("WEEKLY","Weekly").addOption("MONTHLY","Monthly").addOption("YEARLY","Yearly").setValue(this.frequency).onChange(ae=>{this.frequency=ae,this.updateFrequencySpecificVisibility()})}),new ms.Setting(t).setName("Interval").setDesc("Every X days/weeks/months/years").addText(X=>{X.setValue(this.interval.toString()).onChange(ae=>{this.interval=parseInt(ae)||1})});let r=new ms.Setting(t).setName("Days of week").setDesc("Select specific days (for weekly recurrence)"),s=r.controlEl.createDiv("days-container");[{key:"MO",label:"Mon"},{key:"TU",label:"Tue"},{key:"WE",label:"Wed"},{key:"TH",label:"Thu"},{key:"FR",label:"Fri"},{key:"SA",label:"Sat"},{key:"SU",label:"Sun"}].forEach(X=>{let ae=s.createEl("label",{cls:"day-checkbox"});ae.style.display="inline-block",ae.style.marginRight="8px";let pt=ae.createEl("input",{type:"checkbox"});pt.checked=this.byDay.includes(X.key),pt.addEventListener("change",()=>{pt.checked?this.byDay.includes(X.key)||this.byDay.push(X.key):this.byDay=this.byDay.filter(Ut=>Ut!==X.key)}),ae.createSpan({text:` ${X.label}`})});let a=new ms.Setting(t).setName("Monthly recurrence").setDesc("Choose how to repeat monthly"),o=a.controlEl.createDiv("monthly-options"),l=o.createEl("label",{cls:"radio-option"});l.style.display="block",l.style.marginBottom="8px";let c=l.createEl("input",{type:"radio",value:"bydate"});c.name="monthly-type",c.checked=this.byMonthDay.length>0||this.byDay.length===0&&this.bySetPos===void 0,l.createSpan({text:" On day "});let d=l.createEl("select");d.style.marginLeft="4px",d.style.marginRight="4px";for(let X=1;X<=31;X++){let ae=d.createEl("option",{value:X.toString(),text:X.toString()});(this.byMonthDay.length>0&&this.byMonthDay[0]===X||this.byMonthDay.length===0&&X===new Date().getDate())&&(ae.selected=!0)}l.createSpan({text:" of each month"});let u=o.createEl("label",{cls:"radio-option"});u.style.display="block",u.style.marginBottom="8px";let h=u.createEl("input",{type:"radio",value:"byday"});h.name="monthly-type",h.checked=this.byDay.length>0&&this.bySetPos!==void 0,u.createSpan({text:" On the "});let f=u.createEl("select");f.style.marginLeft="4px",f.style.marginRight="4px";let p=[{value:"1",text:"first"},{value:"2",text:"second"},{value:"3",text:"third"},{value:"4",text:"fourth"},{value:"-1",text:"last"}];p.forEach(X=>{let ae=f.createEl("option",{value:X.value,text:X.text});(this.bySetPos===parseInt(X.value)||!this.bySetPos&&X.value==="1")&&(ae.selected=!0)});let m=u.createEl("select");m.style.marginLeft="4px",m.style.marginRight="4px";let g=[{value:"MO",text:"Monday"},{value:"TU",text:"Tuesday"},{value:"WE",text:"Wednesday"},{value:"TH",text:"Thursday"},{value:"FR",text:"Friday"},{value:"SA",text:"Saturday"},{value:"SU",text:"Sunday"}],T=["SU","MO","TU","WE","TH","FR","SA"][new Date().getDay()];g.forEach(X=>{let ae=m.createEl("option",{value:X.value,text:X.text});(this.byDay.length>0&&this.byDay[0]===X.value||this.byDay.length===0&&X.value===T)&&(ae.selected=!0)}),u.createSpan({text:" of each month"});let w=new ms.Setting(t).setName("Yearly recurrence").setDesc("Choose how to repeat yearly"),b=w.controlEl.createDiv("yearly-options"),S=b.createEl("label",{cls:"radio-option"});S.style.display="block",S.style.marginBottom="8px";let k=S.createEl("input",{type:"radio",value:"bydate"});k.name="yearly-type",k.checked=this.byMonthDay.length>0||this.byDay.length===0&&this.bySetPos===void 0,S.createSpan({text:" On "});let D=S.createEl("select");D.style.marginLeft="4px",D.style.marginRight="4px";let M=["January","February","March","April","May","June","July","August","September","October","November","December"];M.forEach((X,ae)=>{let pt=D.createEl("option",{value:(ae+1).toString(),text:X});(this.byMonth.length>0&&this.byMonth[0]===ae+1||this.byMonth.length===0&&ae+1===new Date().getMonth()+1)&&(pt.selected=!0)});let _=S.createEl("select");_.style.marginLeft="4px",_.style.marginRight="4px";for(let X=1;X<=31;X++){let ae=_.createEl("option",{value:X.toString(),text:X.toString()});(this.byMonthDay.length>0&&this.byMonthDay[0]===X||this.byMonthDay.length===0&&X===new Date().getDate())&&(ae.selected=!0)}S.createSpan({text:" each year"});let W=b.createEl("label",{cls:"radio-option"});W.style.display="block",W.style.marginBottom="8px";let j=W.createEl("input",{type:"radio",value:"byday"});j.name="yearly-type",j.checked=this.byDay.length>0&&this.bySetPos!==void 0,W.createSpan({text:" On the "});let R=W.createEl("select");R.style.marginLeft="4px",R.style.marginRight="4px",p.forEach(X=>{let ae=R.createEl("option",{value:X.value,text:X.text});(this.bySetPos===parseInt(X.value)||!this.bySetPos&&X.value==="1")&&(ae.selected=!0)});let O=W.createEl("select");O.style.marginLeft="4px",O.style.marginRight="4px",g.forEach(X=>{let ae=O.createEl("option",{value:X.value,text:X.text});(this.byDay.length>0&&this.byDay[0]===X.value||this.byDay.length===0&&X.value===T)&&(ae.selected=!0)});let C=W.createEl("select");C.style.marginLeft="4px",C.style.marginRight="4px",M.forEach((X,ae)=>{let pt=C.createEl("option",{value:(ae+1).toString(),text:X});(this.byMonth.length>0&&this.byMonth[0]===ae+1||this.byMonth.length===0&&ae+1===new Date().getMonth()+1)&&(pt.selected=!0)}),W.createSpan({text:" each year"}),new ms.Setting(t).setName("End condition").setDesc("Choose when the recurrence should end");let P=t.createDiv("end-condition-container"),U=P.createEl("label",{cls:"radio-option"});U.style.display="block",U.style.marginBottom="8px";let H=U.createEl("input",{type:"radio",value:"never"});H.name="end-type",H.checked=this.endType==="never",U.createSpan({text:" Never ends"});let Y=P.createEl("label",{cls:"radio-option"});Y.style.display="block",Y.style.marginBottom="8px";let z=Y.createEl("input",{type:"radio",value:"count"});z.name="end-type",z.checked=this.endType==="count",Y.createSpan({text:" End after "});let ne=Y.createEl("input",{type:"number",placeholder:"10"});ne.style.width="60px",ne.style.marginLeft="4px",ne.style.marginRight="4px",ne.value=this.count?this.count.toString():"",Y.createSpan({text:" occurrences"});let le=P.createEl("label",{cls:"radio-option"});le.style.display="block",le.style.marginBottom="8px";let q=le.createEl("input",{type:"radio",value:"until"});q.name="end-type",q.checked=this.endType==="until",le.createSpan({text:" End on "});let we=le.createEl("input",{type:"date"});we.style.marginLeft="4px",we.value=this.until?this.until.replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3"):"",H.addEventListener("change",()=>{H.checked&&(this.endType="never")}),z.addEventListener("change",()=>{z.checked&&(this.endType="count")}),q.addEventListener("change",()=>{q.checked&&(this.endType="until")}),ne.addEventListener("input",()=>{this.count=parseInt(ne.value)||void 0,ne.value&&(z.checked=!0,this.endType="count")}),we.addEventListener("input",()=>{this.until=we.value?we.value.replace(/-/g,""):"",we.value&&(q.checked=!0,this.endType="until")}),this.updateFrequencySpecificVisibility=()=>{r.settingEl.style.display=this.frequency==="WEEKLY"?"flex":"none",a.settingEl.style.display=this.frequency==="MONTHLY"?"flex":"none",w.settingEl.style.display=this.frequency==="YEARLY"?"flex":"none"},this.updateFrequencySpecificVisibility();let ct=t.createDiv("button-container");ct.style.display="flex",ct.style.justifyContent="flex-end",ct.style.gap="8px",ct.style.marginTop="16px",ct.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()}),ct.createEl("button",{text:"Save",cls:"mod-cta"}).addEventListener("click",()=>{let X=c.checked?"bydate":"byday",ae=k.checked?"bydate":"byday";this.frequency==="MONTHLY"?X==="bydate"?(this.byMonthDay=[parseInt(d.value)],this.byDay=[],this.bySetPos=void 0):(this.byMonthDay=[],this.byDay=[m.value],this.bySetPos=parseInt(f.value)):this.frequency==="YEARLY"&&(ae==="bydate"?(this.byMonth=[parseInt(D.value)],this.byMonthDay=[parseInt(_.value)],this.byDay=[],this.bySetPos=void 0):(this.byMonth=[parseInt(C.value)],this.byMonthDay=[],this.byDay=[O.value],this.bySetPos=parseInt(R.value)));let pt=this.buildRRule(X,ae);this.onSubmit(pt),this.close()})}updateFrequencySpecificVisibility(){}buildRRule(t,r){let s=[];if(this.dtstart){let i=this.dtstart.replace(/-/g,"");if(this.dtstartTime){let a=this.dtstartTime.replace(":","")+"00Z";i=`${i}T${a}`}s.push(`DTSTART:${i}`)}switch(s.push(`FREQ=${this.frequency}`),this.interval>1&&s.push(`INTERVAL=${this.interval}`),this.frequency){case"WEEKLY":this.byDay.length>0&&s.push(`BYDAY=${this.byDay.join(",")}`);break;case"MONTHLY":if(t==="bydate"){let i=this.byMonthDay.length>0?this.byMonthDay[0]:new Date().getDate();s.push(`BYMONTHDAY=${i}`)}else if(t==="byday"&&this.byDay.length>0){let i=this.bySetPos||1;s.push(`BYDAY=${i}${this.byDay[0]}`)}break;case"YEARLY":if(r==="bydate"){let i=this.byMonth.length>0?this.byMonth[0]:new Date().getMonth()+1,a=this.byMonthDay.length>0?this.byMonthDay[0]:new Date().getDate();s.push(`BYMONTH=${i}`),s.push(`BYMONTHDAY=${a}`)}else if(r==="byday"){let i=this.byMonth.length>0?this.byMonth[0]:new Date().getMonth()+1;if(s.push(`BYMONTH=${i}`),this.byDay.length>0){let a=this.bySetPos||1;s.push(`BYDAY=${a}${this.byDay[0]}`)}}break}switch(this.endType){case"count":this.count&&this.count>0&&s.push(`COUNT=${this.count}`);break;case"until":if(this.until){let i=this.until.replace(/-/g,"");s.push(`UNTIL=${i}`)}break}return s.join(";")}onClose(){let{contentEl:t}=this;t.empty()}}});var yt,Yl,WT=v(()=>{yt=require("obsidian");Fe();dm();um();Op();mP();Vl();Bd();Yl=class{constructor(e){this.menu=new yt.Menu,this.options=e,this.buildMenu()}buildMenu(){var r;let{task:e,plugin:t}=this.options;if(this.menu.addItem(s=>{s.setTitle("Status"),s.setIcon("circle");let i=s.setSubmenu();this.addStatusOptions(i,e,t)}),e.recurrence){this.menu.addSeparator();let s=me(this.options.targetDate),i=((r=e.complete_instances)==null?void 0:r.includes(s))||!1;this.menu.addItem(a=>{a.setTitle(i?"Mark incomplete for this date":"Mark complete for this date"),a.setIcon(i?"x":"check"),a.onClick(async()=>{var o,l;try{await t.toggleRecurringTaskComplete(e,this.options.targetDate),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){let d=c instanceof Error?c.message:String(c);console.error("Error toggling recurring task completion:",{error:d,taskPath:e.path}),new yt.Notice(`Failed to toggle recurring task completion: ${d}`)}})})}this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Priority"),s.setIcon("star");let i=s.setSubmenu();this.addPriorityOptions(i,e,t)}),this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Due date"),s.setIcon("calendar");let i=s.setSubmenu();this.addDateOptions(i,e.due,async a=>{var o,l;try{await t.updateTaskProperty(e,"due",a||void 0),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){let d=c instanceof Error?c.message:String(c);console.error("Error updating task due date:",{error:d,taskPath:e.path}),new yt.Notice(`Failed to update task due date: ${d}`)}},()=>{t.openDueDateModal(e)})}),this.menu.addItem(s=>{s.setTitle("Scheduled date"),s.setIcon("calendar-clock");let i=s.setSubmenu();this.addDateOptions(i,e.scheduled,async a=>{var o,l;try{await t.updateTaskProperty(e,"scheduled",a||void 0),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){let d=c instanceof Error?c.message:String(c);console.error("Error updating task scheduled date:",{error:d,taskPath:e.path}),new yt.Notice(`Failed to update task scheduled date: ${d}`)}},()=>{t.openScheduledDateModal(e)})}),this.menu.addItem(s=>{s.setTitle("Reminders"),s.setIcon("bell");let i=s.setSubmenu();this.addQuickRemindersSection(i,e,t,"due","Remind before due..."),this.addQuickRemindersSection(i,e,t,"scheduled","Remind before scheduled..."),i.addSeparator(),i.addItem(a=>{a.setTitle("Manage All Reminders..."),a.setIcon("settings"),a.onClick(()=>{new bi(t.app,t,e,async l=>{var c,d;try{await t.updateTaskProperty(e,"reminders",l.length>0?l:void 0),(d=(c=this.options).onUpdate)==null||d.call(c)}catch(u){console.error("Error updating reminders:",u),new yt.Notice("Failed to update reminders")}}).open()})}),e.reminders&&e.reminders.length>0&&i.addItem(a=>{a.setTitle("Clear All Reminders"),a.setIcon("trash"),a.onClick(async()=>{var o,l;try{await t.updateTaskProperty(e,"reminders",void 0),(l=(o=this.options).onUpdate)==null||l.call(o)}catch(c){console.error("Error clearing reminders:",c),new yt.Notice("Failed to clear reminders")}})})}),this.menu.addSeparator(),this.menu.addItem(s=>{let i=t.getActiveTimeSession(e);s.setTitle(i?"Stop time tracking":"Start time tracking"),s.setIcon(i?"pause":"play"),s.onClick(async()=>{var o,l;t.getActiveTimeSession(e)?await t.stopTimeTracking(e):await t.startTimeTracking(e),(l=(o=this.options).onUpdate)==null||l.call(o)})}),this.menu.addItem(s=>{s.setTitle(e.archived?"Unarchive":"Archive"),s.setIcon(e.archived?"archive-restore":"archive"),s.onClick(async()=>{var i,a;try{await t.toggleTaskArchive(e),(a=(i=this.options).onUpdate)==null||a.call(i)}catch(o){let l=o instanceof Error?o.message:String(o);console.error("Error toggling task archive:",{error:l,taskPath:e.path}),new yt.Notice(`Failed to toggle task archive: ${l}`)}})}),this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Open note"),s.setIcon("file-text"),s.onClick(()=>{let i=t.app.vault.getAbstractFileByPath(e.path);i instanceof yt.TFile&&t.app.workspace.getLeaf(!1).openFile(i)})}),this.menu.addItem(s=>{s.setTitle("Copy task title"),s.setIcon("copy"),s.onClick(async()=>{try{await navigator.clipboard.writeText(e.title),new yt.Notice("Task title copied to clipboard")}catch(i){new yt.Notice("Failed to copy to clipboard")}})}),this.menu.addItem(s=>{s.setTitle("Note actions"),s.setIcon("file-text");let i=s.setSubmenu(),a=t.app.vault.getAbstractFileByPath(e.path);if(a instanceof yt.TFile){try{t.app.workspace.trigger("file-menu",i,a,"file-explorer")}catch(o){console.debug("Native file menu not available, using fallback")}i.addItem(o=>{o.setTitle("Rename"),o.setIcon("pencil"),o.onClick(async()=>{try{let l=a.basename,c=await pP(t.app,{title:"Rename File",placeholder:"Enter new name",initialValue:l});if(c&&c.trim()!==""&&c!==l){let d=a.extension,u=c.endsWith(`.${d}`)?c:`${c}.${d}`,h=a.parent?`${a.parent.path}/${u}`:u;await t.app.vault.rename(a,h),new yt.Notice(`Renamed to "${u}"`),this.options.onUpdate&&this.options.onUpdate()}}catch(l){console.error("Error renaming file:",l),new yt.Notice("Failed to rename file")}})}),i.addItem(o=>{o.setTitle("Delete"),o.setIcon("trash"),o.onClick(async()=>{await ta(t.app,{title:"Delete File",message:`Are you sure you want to delete "${a.name}"?`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0})&&t.app.vault.trash(a,!0)})}),i.addSeparator(),i.addItem(o=>{o.setTitle("Copy path"),o.setIcon("copy"),o.onClick(async()=>{try{await navigator.clipboard.writeText(a.path),new yt.Notice("File path copied to clipboard")}catch(l){new yt.Notice("Failed to copy file path")}})}),i.addItem(o=>{o.setTitle("Copy Obsidian URL"),o.setIcon("link"),o.onClick(async()=>{try{let l=`obsidian://open?vault=${encodeURIComponent(t.app.vault.getName())}&file=${encodeURIComponent(a.path)}`;await navigator.clipboard.writeText(l),new yt.Notice("Obsidian URL copied to clipboard")}catch(l){new yt.Notice("Failed to copy Obsidian URL")}})}),i.addSeparator(),i.addItem(o=>{o.setTitle("Show in file explorer"),o.setIcon("folder-open"),o.onClick(()=>{t.app.workspace.getLeaf().setViewState({type:"file-explorer",state:{}}).then(()=>{let l=t.app.workspace.getLeavesOfType("file-explorer")[0];l!=null&&l.view&&"revealInFolder"in l.view&&l.view.revealInFolder(a)})})})}}),this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Add to calendar"),s.setIcon("calendar-plus");let i=s.setSubmenu();i.addItem(a=>{a.setTitle("Google Calendar"),a.setIcon("external-link"),a.onClick(()=>{Un.openCalendarURL({type:"google",task:e,useScheduledAsDue:!0})})}),i.addItem(a=>{a.setTitle("Outlook Calendar"),a.setIcon("external-link"),a.onClick(()=>{Un.openCalendarURL({type:"outlook",task:e,useScheduledAsDue:!0})})}),i.addItem(a=>{a.setTitle("Yahoo Calendar"),a.setIcon("external-link"),a.onClick(()=>{Un.openCalendarURL({type:"yahoo",task:e,useScheduledAsDue:!0})})}),i.addSeparator(),i.addItem(a=>{a.setTitle("Download .ics file"),a.setIcon("download"),a.onClick(()=>{Un.downloadICSFile(e)})})}),this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Recurrence"),s.setIcon("refresh-ccw");let i=s.setSubmenu(),a=typeof e.recurrence=="string"?e.recurrence:void 0;this.addRecurrenceOptions(i,a,async o=>{var l,c;try{await t.updateTaskProperty(e,"recurrence",o||void 0),(c=(l=this.options).onUpdate)==null||c.call(l)}catch(d){let u=d instanceof Error?d.message:String(d);console.error("Error updating task recurrence:",{error:u,taskPath:e.path}),new yt.Notice(`Failed to update task recurrence: ${u}`)}},t)}),this.menu.addSeparator(),this.menu.addItem(s=>{s.setTitle("Create subtask"),s.setIcon("plus"),s.onClick(()=>{let i=t.app.vault.getAbstractFileByPath(e.path);if(i instanceof yt.TFile){let a=`[[${i.basename}]]`;t.openTaskCreationModal({projects:[a]})}})}),setTimeout(()=>{this.updateMainMenuIconColors(e,t)},10)}updateMainMenuIconColors(e,t){let r=document.querySelector(".menu");if(!r)return;r.querySelectorAll(".menu-item").forEach(i=>{let a=i.querySelector(".menu-item-title"),o=i.querySelector(".menu-item-icon");if(a&&o){let l=a.textContent;if(l==="Status"){let c=t.settings.customStatuses.find(d=>d.value===e.status);c&&c.color&&(o.style.color=c.color)}else if(l==="Priority"){let c=t.settings.customPriorities.find(d=>d.value===e.priority);c&&c.color&&(o.style.color=c.color)}}})}addStatusOptions(e,t,r){this.getStatusOptions(t,r).forEach((i,a)=>{e.addItem(o=>{let l=i.label;o.setIcon("circle"),i.value===t.status&&(l=`\u2713 ${i.label}`),o.setTitle(l),o.onClick(async()=>{var c,d;try{await r.updateTaskProperty(t,"status",i.value),(d=(c=this.options).onUpdate)==null||d.call(c)}catch(u){let h=u instanceof Error?u.message:String(u);console.error("Error updating task status:",{error:h,taskPath:t.path}),new yt.Notice(`Failed to update task status: ${h}`)}}),i.color&&setTimeout(()=>{let c=o.dom||o.domEl;if(c){let d=c.querySelector(".menu-item-icon");d&&(d.style.color=i.color)}},10)})})}addPriorityOptions(e,t,r){r.priorityManager.getPrioritiesByWeight().forEach(i=>{e.addItem(a=>{let o=i.label;a.setIcon("star"),i.value===t.priority&&(o=`\u2713 ${i.label}`),a.setTitle(o),a.onClick(async()=>{var l,c;try{await r.updateTaskProperty(t,"priority",i.value),(c=(l=this.options).onUpdate)==null||c.call(l)}catch(d){let u=d instanceof Error?d.message:String(d);console.error("Error updating task priority:",{error:u,taskPath:t.path}),new yt.Notice(`Failed to update task priority: ${u}`)}}),i.color&&setTimeout(()=>{let l=a.dom||a.domEl;if(l){let c=l.querySelector(".menu-item-icon");c&&(c.style.color=i.color)}},10)})})}addDateOptions(e,t,r,s){let a=new Kr({currentValue:t,onSelect:d=>{r(d)},onCustomDate:s}).getDateOptions(),o=a.filter(d=>d.label.startsWith("+")||d.label.startsWith("-"));o.length>0&&(o.forEach(d=>{e.addItem(u=>{u.setTitle(d.label),d.icon&&u.setIcon(d.icon),u.onClick(()=>{r(d.value)})})}),e.addSeparator()),a.filter(d=>!d.label.startsWith("+")&&!d.label.startsWith("-")&&!["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(d.label)).forEach(d=>{e.addItem(u=>{let h=d.value===t;u.setTitle(h?`\u2713 ${d.label}`:d.label),d.icon&&u.setIcon(d.icon),u.onClick(()=>{r(d.value)})})});let c=a.filter(d=>["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].includes(d.label));c.length>0&&(e.addSeparator(),e.addItem(d=>{d.setTitle("Weekdays"),d.setIcon("calendar");let u=d.setSubmenu();c.forEach(h=>{u.addItem(f=>{let p=h.value===t;f.setTitle(p?`\u2713 ${h.label}`:h.label),f.setIcon("calendar"),f.onClick(()=>{r(h.value)})})})})),e.addSeparator(),e.addItem(d=>{d.setTitle("Pick date & time..."),d.setIcon("calendar"),d.onClick(()=>{s()})}),t&&e.addItem(d=>{d.setTitle("Clear date"),d.setIcon("x"),d.onClick(()=>{r(null)})})}addRecurrenceOptions(e,t,r,s){let i=new Date,a=["SU","MO","TU","WE","TH","FR","SA"],o=["January","February","March","April","May","June","July","August","September","October","November","December"],l=a[i.getDay()],c=i.getDate(),d=i.getMonth()+1,u=o[i.getMonth()],h=i.toLocaleDateString("en-US",{weekday:"long"}),f=y=>{let T=y.getFullYear(),w=String(y.getMonth()+1).padStart(2,"0"),b=String(y.getDate()).padStart(2,"0");return`${T}${w}${b}`},p=y=>{let T=["th","st","nd","rd"],w=y%100;return y+(T[(w-20)%10]||T[w]||T[0])},m=f(i);[{label:"Daily",value:`DTSTART:${m};FREQ=DAILY;INTERVAL=1`,icon:"calendar-days"},{label:`Weekly on ${h}`,value:`DTSTART:${m};FREQ=WEEKLY;INTERVAL=1;BYDAY=${l}`,icon:"calendar"},{label:`Every 2 weeks on ${h}`,value:`DTSTART:${m};FREQ=WEEKLY;INTERVAL=2;BYDAY=${l}`,icon:"calendar"},{label:`Monthly on the ${p(c)}`,value:`DTSTART:${m};FREQ=MONTHLY;INTERVAL=1;BYMONTHDAY=${c}`,icon:"calendar-range"},{label:`Every 3 months on the ${p(c)}`,value:`DTSTART:${m};FREQ=MONTHLY;INTERVAL=3;BYMONTHDAY=${c}`,icon:"calendar-range"},{label:`Yearly on ${u} ${p(c)}`,value:`DTSTART:${m};FREQ=YEARLY;INTERVAL=1;BYMONTH=${d};BYMONTHDAY=${c}`,icon:"calendar-clock"},{label:"Weekdays only",value:`DTSTART:${m};FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR`,icon:"briefcase"}].forEach(y=>{e.addItem(T=>{let w=y.value===t;T.setTitle(w?`\u2713 ${y.label}`:y.label),T.setIcon(y.icon),T.onClick(()=>{r(y.value)})})}),e.addSeparator(),e.addItem(y=>{y.setTitle("Custom recurrence..."),y.setIcon("settings"),y.onClick(()=>{new Wn({currentValue:typeof t=="string"?t:void 0,onSelect:r,app:s.app}).showCustomRecurrenceModal()})}),t&&e.addItem(y=>{y.setTitle("Clear recurrence"),y.setIcon("x"),y.onClick(()=>{r(null)})})}getStatusOptions(e,t){let r=t.settings.customStatuses,s=[];if(r&&r.length>0){let i=[...r].sort((o,l)=>o.order-l.order);(e.recurrence?i.filter(o=>o.value!=="completed"):i).forEach(o=>{s.push({label:o.label,value:o.value,color:o.color})})}return s}addQuickRemindersSection(e,t,r,s,i){if(!(s==="due"?t.due:t.scheduled)){e.addItem(o=>{o.setTitle(i),o.setIcon("bell"),o.setDisabled(!0)});return}e.addItem(o=>{o.setTitle(i),o.setIcon("bell");let l=o.setSubmenu();[{label:"At time of event",offset:"PT0M"},{label:"5 minutes before",offset:"-PT5M"},{label:"15 minutes before",offset:"-PT15M"},{label:"1 hour before",offset:"-PT1H"},{label:"1 day before",offset:"-P1D"}].forEach(d=>{l.addItem(u=>{u.setTitle(d.label),u.onClick(async()=>{await this.addQuickReminder(t,r,s,d.offset,d.label)})})})})}async addQuickReminder(e,t,r,s,i){var l,c;let a={id:`rem_${Date.now()}`,type:"relative",relatedTo:r,offset:s,description:i},o=[...e.reminders||[],a];try{await t.updateTaskProperty(e,"reminders",o),(c=(l=this.options).onUpdate)==null||c.call(l)}catch(d){console.error("Error adding reminder:",d),new yt.Notice("Failed to add reminder")}}show(e){this.menu.showAtMouseEvent(e)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4})}}});var WR,Pi,Tg=v(()=>{WR=require("obsidian"),Pi=class{constructor(e){this.menu=new WR.Menu,this.options=e,this.buildMenu()}buildMenu(){let e=this.options.plugin.settings.customPriorities;this.sortedPriorities=[...e].sort((t,r)=>r.weight-t.weight),this.sortedPriorities.forEach(t=>{this.menu.addItem(r=>{let s=t.label;r.setIcon("star"),t.value===this.options.currentValue&&(s=`\u2713 ${t.label}`),r.setTitle(s),r.onClick(async()=>{this.options.onSelect(t.value)})})})}show(e){this.menu.showAtMouseEvent(e),setTimeout(()=>{this.applyColorStyling()},10)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4}),setTimeout(()=>{this.applyColorStyling()},10)}applyColorStyling(){let e=document.querySelector(".menu");if(!e)return;let t=e.querySelectorAll(".menu-item");this.sortedPriorities.forEach((r,s)=>{let i=t[s];if(i&&r.color){let a=i.querySelector(".menu-item-icon");a&&(a.style.color=r.color)}})}}});function xu(n,e){if(!n||!e)return 0;let t=n.toLowerCase().split(" ").filter(Boolean),r=e.toLowerCase(),s=0,i=0;for(let a=0;a<t.length;a++){let o=t[a],l=r.indexOf(o,s);if(l===-1)return 0;i+=Math.max(0,100-l),r.startsWith(o,l)&&(i+=10),a>0&&l===s&&(i+=5),s=l+o.length}return i}var jR=v(()=>{});var Zb={};nt(Zb,{FileSuggestHelper:()=>$Y});var VR,$Y,Jb=v(()=>{VR=require("obsidian");jR();Pp();$Y={async suggest(n,e,t=20){var i,a;let r=async()=>{var g,y,T,w,b,S,k,D,M,_,W,j,R,O;let o=(y=(g=n==null?void 0:n.app)==null?void 0:g.vault)!=null&&y.getMarkdownFiles?n.app.vault.getMarkdownFiles():[],l=[],c=((b=(w=(T=n.settings)==null?void 0:T.projectAutosuggest)==null?void 0:w.rows)!=null?b:[]).slice(0,3),d=new Set;for(let C of c)try{let P=Xi(C);for(let U of P)U.searchable&&!U.property.startsWith("literal:")&&d.add(U.property)}catch(P){}let u=(e||"").toLowerCase(),h=(D=(k=(S=n.settings)==null?void 0:S.projectAutosuggest)==null?void 0:k.requiredTags)!=null?D:[],f=(W=(_=(M=n.settings)==null?void 0:M.projectAutosuggest)==null?void 0:_.includeFolders)!=null?W:[];for(let C of o){let P=n.app.metadataCache.getFileCache(C);if(h.length>0){let ne=((j=P==null?void 0:P.tags)==null?void 0:j.map(ct=>ct.tag.replace("#","")))||[],le=((R=P==null?void 0:P.frontmatter)==null?void 0:R.tags)||[],q=[...ne,...Array.isArray(le)?le:[le].filter(Boolean)];if(!h.some(ct=>q.includes(ct)))continue}if(f.length>0&&!f.some(le=>C.path.startsWith(le)||C.path.startsWith(le+"/")))continue;let U=C.basename,H="";if(P!=null&&P.frontmatter){let ne=n.fieldMapper.mapFromFrontmatter(P.frontmatter,C.path,n.settings.storeTitleInFilename);H=typeof ne.title=="string"?ne.title:""}let Y=P!=null&&P.frontmatter?(0,VR.parseFrontMatterAliases)(P.frontmatter)||[]:[],z=0;if(z=Math.max(z,xu(e,U)+15),H&&(z=Math.max(z,xu(e,H)+5)),Array.isArray(Y))for(let ne of Y)typeof ne=="string"&&(z=Math.max(z,xu(e,ne)));if(d.size>0){let ne=(P==null?void 0:P.frontmatter)||{};for(let le of d){let q="";if(le==="file.path")q=C.path;else if(le==="file.parent")q=((O=C.parent)==null?void 0:O.path)||"";else if(le==="file.basename")q=U;else if(le==="title")q=H;else if(le==="aliases")q=(Array.isArray(Y)?Y.filter(ct=>typeof ct=="string"):[]).join(" ");else{let we=ne[le];we!=null&&(Array.isArray(we)?q=we.filter(ct=>typeof ct=="string").join(" "):typeof we=="object"?q=JSON.stringify(we):(typeof we=="string"||typeof we=="number"||typeof we=="boolean")&&(q=String(we)))}if(q){let we=xu(e,q),ct=we>0?we:q.toLowerCase().includes(u)?30:0;ct>0&&(z=Math.max(z,ct))}}}if(z>0){let ne=[];H&&H!==U&&ne.push(`title: ${H}`);let le=Array.isArray(Y)?Y.filter(we=>typeof we=="string"):[];le.length&&ne.push(`aliases: ${le.join(", ")}`);let q=ne.length?`${U} [${ne.join(" | ")}]`:U;l.push({insertText:U,displayText:q,score:z})}}l.sort((C,P)=>P.score-C.score);let p=[],m=new Set;for(let C of l)if(!m.has(C.insertText)&&(p.push(C),m.add(C.insertText),p.length>=t))break;return p},s=(a=(i=n.settings)==null?void 0:i.suggestionDebounceMs)!=null?a:0;return s?new Promise(o=>{let l=n;l.__fileSuggestTimer&&clearTimeout(l.__fileSuggestTimer),l.__fileSuggestTimer=setTimeout(async()=>{let c=await r();o(c)},s)}):r()}}});var GR=hp((rk,sk)=>{(function(n,e){typeof rk=="object"&&typeof sk!="undefined"?sk.exports=e():typeof define=="function"&&define.amd?define(e):(n=typeof globalThis!="undefined"?globalThis:n||self).dayjs_plugin_quarterOfYear=e()})(rk,(function(){"use strict";var n="month",e="quarter";return function(t,r){var s=r.prototype;s.quarter=function(o){return this.$utils().u(o)?Math.ceil((this.month()+1)/3):this.month(this.month()%3+3*(o-1))};var i=s.add;s.add=function(o,l){return o=Number(o),this.$utils().p(l)===e?this.add(3*o,n):i.bind(this)(o,l)};var a=s.startOf;s.startOf=function(o,l){var c=this.$utils(),d=!!c.u(l)||l;if(c.p(o)===e){var u=this.quarter()-1;return d?this.month(3*u).startOf(n).startOf("day"):this.month(3*u+2).endOf(n).endOf("day")}return a.bind(this)(o,l)}}}))});var Ye=hp((nk,ik)=>{(function(n,e){typeof nk=="object"&&typeof ik!="undefined"?ik.exports=e():typeof define=="function"&&define.amd?define(e):(n=typeof globalThis!="undefined"?globalThis:n||self).dayjs=e()})(nk,(function(){"use strict";var n=1e3,e=6e4,t=36e5,r="millisecond",s="second",i="minute",a="hour",o="day",l="week",c="month",d="quarter",u="year",h="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(R){var O=["th","st","nd","rd"],C=R%100;return"["+R+(O[(C-20)%10]||O[C]||O[0])+"]"}},y=function(R,O,C){var P=String(R);return!P||P.length>=O?R:""+Array(O+1-P.length).join(C)+R},T={s:y,z:function(R){var O=-R.utcOffset(),C=Math.abs(O),P=Math.floor(C/60),U=C%60;return(O<=0?"+":"-")+y(P,2,"0")+":"+y(U,2,"0")},m:function R(O,C){if(O.date()<C.date())return-R(C,O);var P=12*(C.year()-O.year())+(C.month()-O.month()),U=O.clone().add(P,c),H=C-U<0,Y=O.clone().add(P+(H?-1:1),c);return+(-(P+(C-U)/(H?U-Y:Y-U))||0)},a:function(R){return R<0?Math.ceil(R)||0:Math.floor(R)},p:function(R){return{M:c,y:u,w:l,d:o,D:h,h:a,m:i,s,ms:r,Q:d}[R]||String(R||"").toLowerCase().replace(/s$/,"")},u:function(R){return R===void 0}},w="en",b={};b[w]=g;var S="$isDayjsObject",k=function(R){return R instanceof W||!(!R||!R[S])},D=function R(O,C,P){var U;if(!O)return w;if(typeof O=="string"){var H=O.toLowerCase();b[H]&&(U=H),C&&(b[H]=C,U=H);var Y=O.split("-");if(!U&&Y.length>1)return R(Y[0])}else{var z=O.name;b[z]=O,U=z}return!P&&U&&(w=U),U||!P&&w},M=function(R,O){if(k(R))return R.clone();var C=typeof O=="object"?O:{};return C.date=R,C.args=arguments,new W(C)},_=T;_.l=D,_.i=k,_.w=function(R,O){return M(R,{locale:O.$L,utc:O.$u,x:O.$x,$offset:O.$offset})};var W=(function(){function R(C){this.$L=D(C.locale,null,!0),this.parse(C),this.$x=this.$x||C.x||{},this[S]=!0}var O=R.prototype;return O.parse=function(C){this.$d=(function(P){var U=P.date,H=P.utc;if(U===null)return new Date(NaN);if(_.u(U))return new Date;if(U instanceof Date)return new Date(U);if(typeof U=="string"&&!/Z$/i.test(U)){var Y=U.match(p);if(Y){var z=Y[2]-1||0,ne=(Y[7]||"0").substring(0,3);return H?new Date(Date.UTC(Y[1],z,Y[3]||1,Y[4]||0,Y[5]||0,Y[6]||0,ne)):new Date(Y[1],z,Y[3]||1,Y[4]||0,Y[5]||0,Y[6]||0,ne)}}return new Date(U)})(C),this.init()},O.init=function(){var C=this.$d;this.$y=C.getFullYear(),this.$M=C.getMonth(),this.$D=C.getDate(),this.$W=C.getDay(),this.$H=C.getHours(),this.$m=C.getMinutes(),this.$s=C.getSeconds(),this.$ms=C.getMilliseconds()},O.$utils=function(){return _},O.isValid=function(){return this.$d.toString()!==f},O.isSame=function(C,P){var U=M(C);return this.startOf(P)<=U&&U<=this.endOf(P)},O.isAfter=function(C,P){return M(C)<this.startOf(P)},O.isBefore=function(C,P){return this.endOf(P)<M(C)},O.$g=function(C,P,U){return _.u(C)?this[P]:this.set(U,C)},O.unix=function(){return Math.floor(this.valueOf()/1e3)},O.valueOf=function(){return this.$d.getTime()},O.startOf=function(C,P){var U=this,H=!!_.u(P)||P,Y=_.p(C),z=function(X,ae){var pt=_.w(U.$u?Date.UTC(U.$y,ae,X):new Date(U.$y,ae,X),U);return H?pt:pt.endOf(o)},ne=function(X,ae){return _.w(U.toDate()[X].apply(U.toDate("s"),(H?[0,0,0,0]:[23,59,59,999]).slice(ae)),U)},le=this.$W,q=this.$M,we=this.$D,ct="set"+(this.$u?"UTC":"");switch(Y){case u:return H?z(1,0):z(31,11);case c:return H?z(1,q):z(0,q+1);case l:var Ne=this.$locale().weekStart||0,Mn=(le<Ne?le+7:le)-Ne;return z(H?we-Mn:we+(6-Mn),q);case o:case h:return ne(ct+"Hours",0);case a:return ne(ct+"Minutes",1);case i:return ne(ct+"Seconds",2);case s:return ne(ct+"Milliseconds",3);default:return this.clone()}},O.endOf=function(C){return this.startOf(C,!1)},O.$set=function(C,P){var U,H=_.p(C),Y="set"+(this.$u?"UTC":""),z=(U={},U[o]=Y+"Date",U[h]=Y+"Date",U[c]=Y+"Month",U[u]=Y+"FullYear",U[a]=Y+"Hours",U[i]=Y+"Minutes",U[s]=Y+"Seconds",U[r]=Y+"Milliseconds",U)[H],ne=H===o?this.$D+(P-this.$W):P;if(H===c||H===u){var le=this.clone().set(h,1);le.$d[z](ne),le.init(),this.$d=le.set(h,Math.min(this.$D,le.daysInMonth())).$d}else z&&this.$d[z](ne);return this.init(),this},O.set=function(C,P){return this.clone().$set(C,P)},O.get=function(C){return this[_.p(C)]()},O.add=function(C,P){var U,H=this;C=Number(C);var Y=_.p(P),z=function(q){var we=M(H);return _.w(we.date(we.date()+Math.round(q*C)),H)};if(Y===c)return this.set(c,this.$M+C);if(Y===u)return this.set(u,this.$y+C);if(Y===o)return z(1);if(Y===l)return z(7);var ne=(U={},U[i]=e,U[a]=t,U[s]=n,U)[Y]||1,le=this.$d.getTime()+C*ne;return _.w(le,this)},O.subtract=function(C,P){return this.add(-1*C,P)},O.format=function(C){var P=this,U=this.$locale();if(!this.isValid())return U.invalidDate||f;var H=C||"YYYY-MM-DDTHH:mm:ssZ",Y=_.z(this),z=this.$H,ne=this.$m,le=this.$M,q=U.weekdays,we=U.months,ct=U.meridiem,Ne=function(ae,pt,Ut,_n){return ae&&(ae[pt]||ae(P,H))||Ut[pt].slice(0,_n)},Mn=function(ae){return _.s(z%12||12,ae,"0")},X=ct||function(ae,pt,Ut){var _n=ae<12?"AM":"PM";return Ut?_n.toLowerCase():_n};return H.replace(m,(function(ae,pt){return pt||(function(Ut){switch(Ut){case"YY":return String(P.$y).slice(-2);case"YYYY":return _.s(P.$y,4,"0");case"M":return le+1;case"MM":return _.s(le+1,2,"0");case"MMM":return Ne(U.monthsShort,le,we,3);case"MMMM":return Ne(we,le);case"D":return P.$D;case"DD":return _.s(P.$D,2,"0");case"d":return String(P.$W);case"dd":return Ne(U.weekdaysMin,P.$W,q,2);case"ddd":return Ne(U.weekdaysShort,P.$W,q,3);case"dddd":return q[P.$W];case"H":return String(z);case"HH":return _.s(z,2,"0");case"h":return Mn(1);case"hh":return Mn(2);case"a":return X(z,ne,!0);case"A":return X(z,ne,!1);case"m":return String(ne);case"mm":return _.s(ne,2,"0");case"s":return String(P.$s);case"ss":return _.s(P.$s,2,"0");case"SSS":return _.s(P.$ms,3,"0");case"Z":return Y}return null})(ae)||Y.replace(":","")}))},O.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},O.diff=function(C,P,U){var H,Y=this,z=_.p(P),ne=M(C),le=(ne.utcOffset()-this.utcOffset())*e,q=this-ne,we=function(){return _.m(Y,ne)};switch(z){case u:H=we()/12;break;case c:H=we();break;case d:H=we()/3;break;case l:H=(q-le)/6048e5;break;case o:H=(q-le)/864e5;break;case a:H=q/t;break;case i:H=q/e;break;case s:H=q/n;break;default:H=q}return U?H:_.a(H)},O.daysInMonth=function(){return this.endOf(c).$D},O.$locale=function(){return b[this.$L]},O.locale=function(C,P){if(!C)return this.$L;var U=this.clone(),H=D(C,P,!0);return H&&(U.$L=H),U},O.clone=function(){return _.w(this.$d,this)},O.toDate=function(){return new Date(this.valueOf())},O.toJSON=function(){return this.isValid()?this.toISOString():null},O.toISOString=function(){return this.$d.toISOString()},O.toString=function(){return this.$d.toUTCString()},R})(),j=W.prototype;return M.prototype=j,[["$ms",r],["$s",s],["$m",i],["$H",a],["$W",o],["$M",c],["$y",u],["$D",h]].forEach((function(R){j[R[1]]=function(O){return this.$g(O,R[0],R[1])}})),M.extend=function(R,O){return R.$i||(R(O,W,M),R.$i=!0),M},M.locale=D,M.isDayjs=k,M.unix=function(R){return M(1e3*R)},M.en=b[w],M.Ls=b,M.p={},M}))});var N,ye,Ts,Ue=v(()=>{(function(n){n[n.AM=0]="AM",n[n.PM=1]="PM"})(N||(N={}));(function(n){n[n.SUNDAY=0]="SUNDAY",n[n.MONDAY=1]="MONDAY",n[n.TUESDAY=2]="TUESDAY",n[n.WEDNESDAY=3]="WEDNESDAY",n[n.THURSDAY=4]="THURSDAY",n[n.FRIDAY=5]="FRIDAY",n[n.SATURDAY=6]="SATURDAY"})(ye||(ye={}));(function(n){n[n.JANUARY=1]="JANUARY",n[n.FEBRUARY=2]="FEBRUARY",n[n.MARCH=3]="MARCH",n[n.APRIL=4]="APRIL",n[n.MAY=5]="MAY",n[n.JUNE=6]="JUNE",n[n.JULY=7]="JULY",n[n.AUGUST=8]="AUGUST",n[n.SEPTEMBER=9]="SEPTEMBER",n[n.OCTOBER=10]="OCTOBER",n[n.NOVEMBER=11]="NOVEMBER",n[n.DECEMBER=12]="DECEMBER"})(Ts||(Ts={}))});function QR(n,e){n.assign("day",e.getDate()),n.assign("month",e.getMonth()+1),n.assign("year",e.getFullYear())}function KR(n,e){n.assign("hour",e.getHours()),n.assign("minute",e.getMinutes()),n.assign("second",e.getSeconds()),n.assign("millisecond",e.getMilliseconds()),n.assign("meridiem",e.getHours()<12?N.AM:N.PM)}function Eg(n,e){n.imply("day",e.getDate()),n.imply("month",e.getMonth()+1),n.imply("year",e.getFullYear())}function ZR(n,e){n.imply("hour",e.getHours()),n.imply("minute",e.getMinutes()),n.imply("second",e.getSeconds()),n.imply("millisecond",e.getMilliseconds()),n.imply("meridiem",e.getHours()<12?N.AM:N.PM)}var ak=v(()=>{Ue()});function ka(n,e,t,r,s=0){let i=0,a=0;for(;a<r;)i++,new Date(n,e-1,i).getDay()===t&&a++;return new Date(n,e-1,i,s)}function JR(n,e,t,r=0){let s=t===0?7:t,i=new Date(n,e-1+1,1,12),a=i.getDay()===0?7:i.getDay(),o;return a===s?o=7:a<s?o=7+a-s:o=a-s,i.setDate(i.getDate()-o),new Date(n,e-1,i.getDate(),r)}function Sg(n,e,t={}){var s;if(n==null)return null;if(typeof n=="number")return n;let r=(s=t[n])!=null?s:VY[n];return r==null?null:typeof r=="number"?r:e==null?null:(0,ok.default)(e).isAfter(r.dstStart(e.getFullYear()))&&!(0,ok.default)(e).isAfter(r.dstEnd(e.getFullYear()))?r.timezoneOffsetDuringDst:r.timezoneOffsetNonDst}var ok,VY,lk=v(()=>{ok=ke(Ye(),1);Ue();VY={ACDT:630,ACST:570,ADT:-180,AEDT:660,AEST:600,AFT:270,AKDT:-480,AKST:-540,ALMT:360,AMST:-180,AMT:-240,ANAST:720,ANAT:720,AQTT:300,ART:-180,AST:-240,AWDT:540,AWST:480,AZOST:0,AZOT:-60,AZST:300,AZT:240,BNT:480,BOT:-240,BRST:-120,BRT:-180,BST:60,BTT:360,CAST:480,CAT:120,CCT:390,CDT:-300,CEST:120,CET:{timezoneOffsetDuringDst:120,timezoneOffsetNonDst:60,dstStart:n=>JR(n,Ts.MARCH,ye.SUNDAY,2),dstEnd:n=>JR(n,Ts.OCTOBER,ye.SUNDAY,3)},CHADT:825,CHAST:765,CKT:-600,CLST:-180,CLT:-240,COT:-300,CST:-360,CT:{timezoneOffsetDuringDst:-300,timezoneOffsetNonDst:-360,dstStart:n=>ka(n,Ts.MARCH,ye.SUNDAY,2,2),dstEnd:n=>ka(n,Ts.NOVEMBER,ye.SUNDAY,1,2)},CVT:-60,CXT:420,ChST:600,DAVT:420,EASST:-300,EAST:-360,EAT:180,ECT:-300,EDT:-240,EEST:180,EET:120,EGST:0,EGT:-60,EST:-300,ET:{timezoneOffsetDuringDst:-240,timezoneOffsetNonDst:-300,dstStart:n=>ka(n,Ts.MARCH,ye.SUNDAY,2,2),dstEnd:n=>ka(n,Ts.NOVEMBER,ye.SUNDAY,1,2)},FJST:780,FJT:720,FKST:-180,FKT:-240,FNT:-120,GALT:-360,GAMT:-540,GET:240,GFT:-180,GILT:720,GMT:0,GST:240,GYT:-240,HAA:-180,HAC:-300,HADT:-540,HAE:-240,HAP:-420,HAR:-360,HAST:-600,HAT:-90,HAY:-480,HKT:480,HLV:-210,HNA:-240,HNC:-360,HNE:-300,HNP:-480,HNR:-420,HNT:-150,HNY:-540,HOVT:420,ICT:420,IDT:180,IOT:360,IRDT:270,IRKST:540,IRKT:540,IRST:210,IST:330,JST:540,KGT:360,KRAST:480,KRAT:480,KST:540,KUYT:240,LHDT:660,LHST:630,LINT:840,MAGST:720,MAGT:720,MART:-510,MAWT:300,MDT:-360,MESZ:120,MEZ:60,MHT:720,MMT:390,MSD:240,MSK:180,MST:-420,MT:{timezoneOffsetDuringDst:-360,timezoneOffsetNonDst:-420,dstStart:n=>ka(n,Ts.MARCH,ye.SUNDAY,2,2),dstEnd:n=>ka(n,Ts.NOVEMBER,ye.SUNDAY,1,2)},MUT:240,MVT:300,MYT:480,NCT:660,NDT:-90,NFT:690,NOVST:420,NOVT:360,NPT:345,NST:-150,NUT:-660,NZDT:780,NZST:720,OMSST:420,OMST:420,PDT:-420,PET:-300,PETST:720,PETT:720,PGT:600,PHOT:780,PHT:480,PKT:300,PMDT:-120,PMST:-180,PONT:660,PST:-480,PT:{timezoneOffsetDuringDst:-420,timezoneOffsetNonDst:-480,dstStart:n=>ka(n,Ts.MARCH,ye.SUNDAY,2,2),dstEnd:n=>ka(n,Ts.NOVEMBER,ye.SUNDAY,1,2)},PWT:540,PYST:-180,PYT:-240,RET:240,SAMT:240,SAST:120,SBT:660,SCT:240,SGT:480,SRT:-180,SST:-660,TAHT:-600,TFT:300,TJT:300,TKT:780,TLT:540,TMT:300,TVT:720,ULAT:480,UTC:0,UYST:-120,UYT:-180,UZT:300,VET:-210,VLAST:660,VLAT:660,VUT:660,WAST:120,WAT:60,WEST:60,WESZ:60,WET:0,WEZ:0,WFT:720,WGST:-120,WGT:-180,WIB:420,WIT:540,WITA:480,WST:780,WT:0,YAKST:600,YAKT:600,YAPT:600,YEKST:360,YEKT:360}});function XR(n,e){var r,s,i,a,o,l,c;let t=new Date(n);if(e.y&&(e.year=e.y,delete e.y),e.mo&&(e.month=e.mo,delete e.mo),e.M&&(e.month=e.M,delete e.M),e.w&&(e.week=e.w,delete e.w),e.d&&(e.day=e.d,delete e.d),e.h&&(e.hour=e.h,delete e.h),e.m&&(e.minute=e.m,delete e.m),e.s&&(e.second=e.s,delete e.s),e.ms&&(e.millisecond=e.ms,delete e.ms),"year"in e){let d=Math.floor(e.year);t.setFullYear(t.getFullYear()+d);let u=e.year-d;u>0&&(e.month=(r=e==null?void 0:e.month)!=null?r:0,e.month+=u*12)}if("quarter"in e){let d=Math.floor(e.quarter);t.setMonth(t.getMonth()+d*3)}if("month"in e){let d=Math.floor(e.month);t.setMonth(t.getMonth()+d);let u=e.month-d;u>0&&(e.week=(s=e==null?void 0:e.week)!=null?s:0,e.week+=u*4)}if("week"in e){let d=Math.floor(e.week);t.setDate(t.getDate()+d*7);let u=e.week-d;u>0&&(e.day=(i=e==null?void 0:e.day)!=null?i:0,e.day+=Math.round(u*7))}if("day"in e){let d=Math.floor(e.day);t.setDate(t.getDate()+d);let u=e.day-d;u>0&&(e.hour=(a=e==null?void 0:e.hour)!=null?a:0,e.hour+=Math.round(u*24))}if("hour"in e){let d=Math.floor(e.hour);t.setHours(t.getHours()+d);let u=e.hour-d;u>0&&(e.minute=(o=e==null?void 0:e.minute)!=null?o:0,e.minute+=Math.round(u*60))}if("minute"in e){let d=Math.floor(e.minute);t.setMinutes(t.getMinutes()+d);let u=e.minute-d;u>0&&(e.second=(l=e==null?void 0:e.second)!=null?l:0,e.second+=Math.round(u*60))}if("second"in e){let d=Math.floor(e.second);t.setSeconds(t.getSeconds()+d);let u=e.second-d;u>0&&(e.millisecond=(c=e==null?void 0:e.millisecond)!=null?c:0,e.millisecond+=Math.round(u*1e3))}if("millisecond"in e){let d=Math.floor(e.millisecond);t.setMilliseconds(t.getMilliseconds()+d)}return t}function hc(n){let e={};for(let t in n)e[t]=-n[t];return e}var _u=v(()=>{});var eN,ck,ze,V,$e,Se=v(()=>{eN=ke(GR(),1),ck=ke(Ye(),1);ak();lk();_u();ck.default.extend(eN.default);ze=class n{constructor(e,t){I(this,"instant");I(this,"timezoneOffset");this.instant=e!=null?e:new Date,this.timezoneOffset=t!=null?t:null}static fromDate(e){return new n(e)}static fromInput(e,t){var i;if(e instanceof Date)return n.fromDate(e);let r=(i=e==null?void 0:e.instant)!=null?i:new Date,s=Sg(e==null?void 0:e.timezone,r,t);return new n(r,s)}getDateWithAdjustedTimezone(){let e=new Date(this.instant);return this.timezoneOffset!==null&&e.setMinutes(e.getMinutes()-this.getSystemTimezoneAdjustmentMinute(this.instant)),e}getSystemTimezoneAdjustmentMinute(e,t){var i;(!e||e.getTime()<0)&&(e=new Date);let r=-e.getTimezoneOffset(),s=(i=t!=null?t:this.timezoneOffset)!=null?i:r;return r-s}getTimezoneOffset(){var e;return(e=this.timezoneOffset)!=null?e:-this.instant.getTimezoneOffset()}},V=class n{constructor(e,t){I(this,"knownValues");I(this,"impliedValues");I(this,"reference");I(this,"_tags",new Set);if(this.reference=e,this.knownValues={},this.impliedValues={},t)for(let s in t)this.knownValues[s]=t[s];let r=e.getDateWithAdjustedTimezone();this.imply("day",r.getDate()),this.imply("month",r.getMonth()+1),this.imply("year",r.getFullYear()),this.imply("hour",12),this.imply("minute",0),this.imply("second",0),this.imply("millisecond",0)}get(e){return e in this.knownValues?this.knownValues[e]:e in this.impliedValues?this.impliedValues[e]:null}isCertain(e){return e in this.knownValues}getCertainComponents(){return Object.keys(this.knownValues)}imply(e,t){return e in this.knownValues?this:(this.impliedValues[e]=t,this)}assign(e,t){return this.knownValues[e]=t,delete this.impliedValues[e],this}delete(e){delete this.knownValues[e],delete this.impliedValues[e]}clone(){let e=new n(this.reference);e.knownValues={},e.impliedValues={};for(let t in this.knownValues)e.knownValues[t]=this.knownValues[t];for(let t in this.impliedValues)e.impliedValues[t]=this.impliedValues[t];return e}isOnlyDate(){return!this.isCertain("hour")&&!this.isCertain("minute")&&!this.isCertain("second")}isOnlyTime(){return!this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")&&!this.isCertain("year")}isOnlyWeekdayComponent(){return this.isCertain("weekday")&&!this.isCertain("day")&&!this.isCertain("month")}isDateWithUnknownYear(){return this.isCertain("month")&&!this.isCertain("year")}isValidDate(){let e=this.dateWithoutTimezoneAdjustment();return!(e.getFullYear()!==this.get("year")||e.getMonth()!==this.get("month")-1||e.getDate()!==this.get("day")||this.get("hour")!=null&&e.getHours()!=this.get("hour")||this.get("minute")!=null&&e.getMinutes()!=this.get("minute"))}toString(){return`[ParsingComponents {
            tags: ${JSON.stringify(Array.from(this._tags).sort())}, 
            knownValues: ${JSON.stringify(this.knownValues)}, 
            impliedValues: ${JSON.stringify(this.impliedValues)}}, 
            reference: ${JSON.stringify(this.reference)}]`}dayjs(){return(0,ck.default)(this.dateWithoutTimezoneAdjustment())}date(){let e=this.dateWithoutTimezoneAdjustment(),t=this.reference.getSystemTimezoneAdjustmentMinute(e,this.get("timezoneOffset"));return new Date(e.getTime()+t*6e4)}addTag(e){return this._tags.add(e),this}addTags(e){for(let t of e)this._tags.add(t);return this}tags(){return new Set(this._tags)}dateWithoutTimezoneAdjustment(){let e=new Date(this.get("year"),this.get("month")-1,this.get("day"),this.get("hour"),this.get("minute"),this.get("second"),this.get("millisecond"));return e.setFullYear(this.get("year")),e}static createRelativeFromReference(e,t){let r=XR(e.getDateWithAdjustedTimezone(),t),s=new n(e);return s.addTag("result/relativeDate"),t.hour||t.minute||t.second?(s.addTag("result/relativeDateAndTime"),KR(s,r),QR(s,r),s.assign("timezoneOffset",e.getTimezoneOffset())):(ZR(s,r),s.imply("timezoneOffset",e.getTimezoneOffset()),t.day?(s.assign("day",r.getDate()),s.assign("month",r.getMonth()+1),s.assign("year",r.getFullYear()),s.assign("weekday",r.getDay())):t.week?(s.assign("day",r.getDate()),s.assign("month",r.getMonth()+1),s.assign("year",r.getFullYear()),s.imply("weekday",r.getDay())):(s.imply("day",r.getDate()),t.month?(s.assign("month",r.getMonth()+1),s.assign("year",r.getFullYear())):(s.imply("month",r.getMonth()+1),t.year?s.assign("year",r.getFullYear()):s.imply("year",r.getFullYear())))),s}},$e=class n{constructor(e,t,r,s,i){I(this,"refDate");I(this,"index");I(this,"text");I(this,"reference");I(this,"start");I(this,"end");this.reference=e,this.refDate=e.instant,this.index=t,this.text=r,this.start=s||new V(e),this.end=i}clone(){let e=new n(this.reference,this.index,this.text);return e.start=this.start?this.start.clone():null,e.end=this.end?this.end.clone():null,e}date(){return this.start.date()}addTag(e){return this.start.addTag(e),this.end&&this.end.addTag(e),this}addTags(e){return this.start.addTags(e),this.end&&this.end.addTags(e),this}tags(){let e=new Set(this.start.tags());if(this.end)for(let t of this.end.tags())e.add(t);return e}toString(){let e=Array.from(this.tags()).sort();return`[ParsingResult {index: ${this.index}, text: '${this.text}', tags: ${JSON.stringify(e)} ...}]`}}});function Hr(n,e,t="\\s{0,5},?\\s{0,5}"){let r=e.replace(/\((?!\?)/g,"(?:");return`${n}${r}(?:${t}${r}){0,10}`}function YY(n){let e;return n instanceof Array?e=[...n]:n instanceof Map?e=Array.from(n.keys()):e=Object.keys(n),e}function G(n){return`(?:${YY(n).sort((t,r)=>r.length-t.length).join("|").replace(/\./g,"\\.")})`}var Re=v(()=>{});function es(n){return n<100&&(n>50?n=n+1900:n=n+2e3),n}function Je(n,e,t){let r=(0,tN.default)(n),s=r;s=s.month(t-1),s=s.date(e),s=s.year(r.year());let i=s.add(1,"y"),a=s.add(-1,"y");return Math.abs(i.diff(r))<Math.abs(s.diff(r))?s=i:Math.abs(a.diff(r))<Math.abs(s.diff(r))&&(s=a),s.year()}var tN,Pt=v(()=>{tN=ke(Ye(),1)});function zY(n){let e=n.toLowerCase();return dk[e]!==void 0?dk[e]:e==="a"||e==="an"||e=="the"?1:e.match(/few/)?3:e.match(/half/)?.5:e.match(/couple/)?2:e.match(/several/)?7:parseFloat(e)}function pc(n){let e=n.toLowerCase();return uk[e]!==void 0?uk[e]:(e=e.replace(/(?:st|nd|rd|th)$/i,""),parseInt(e))}function Sa(n){if(/BE/i.test(n))return n=n.replace(/BE/i,""),parseInt(n)-543;if(/BCE?/i.test(n))return n=n.replace(/BCE?/i,""),-parseInt(n);if(/(AD|CE)/i.test(n))return n=n.replace(/(AD|CE)/i,""),parseInt(n);let e=parseInt(n);return es(e)}function Vs(n){let e={},t=n,r=rN.exec(t);for(;r;)GY(e,r),t=t.substring(r[0].length).trim(),r=rN.exec(t);return Object.keys(e).length==0?null:e}function GY(n,e){if(e[0].match(/^[a-zA-Z]+$/))return;let t=zY(e[1]),r=Au[e[2].toLowerCase()];n[r]=t}var Dg,hk,js,dk,uk,sN,Au,nN,fc,Ea,iN,rN,qY,aN,Ii,Da,Xt=v(()=>{Re();Pt();Dg={sunday:0,sun:0,"sun.":0,monday:1,mon:1,"mon.":1,tuesday:2,tue:2,"tue.":2,wednesday:3,wed:3,"wed.":3,thursday:4,thurs:4,"thurs.":4,thur:4,"thur.":4,thu:4,"thu.":4,friday:5,fri:5,"fri.":5,saturday:6,sat:6,"sat.":6},hk={january:1,february:2,march:3,april:4,may:5,june:6,july:7,august:8,september:9,october:10,november:11,december:12},js={...hk,jan:1,"jan.":1,feb:2,"feb.":2,mar:3,"mar.":3,apr:4,"apr.":4,jun:6,"jun.":6,jul:7,"jul.":7,aug:8,"aug.":8,sep:9,"sep.":9,sept:9,"sept.":9,oct:10,"oct.":10,nov:11,"nov.":11,dec:12,"dec.":12},dk={one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12},uk={first:1,second:2,third:3,fourth:4,fifth:5,sixth:6,seventh:7,eighth:8,ninth:9,tenth:10,eleventh:11,twelfth:12,thirteenth:13,fourteenth:14,fifteenth:15,sixteenth:16,seventeenth:17,eighteenth:18,nineteenth:19,twentieth:20,"twenty first":21,"twenty-first":21,"twenty second":22,"twenty-second":22,"twenty third":23,"twenty-third":23,"twenty fourth":24,"twenty-fourth":24,"twenty fifth":25,"twenty-fifth":25,"twenty sixth":26,"twenty-sixth":26,"twenty seventh":27,"twenty-seventh":27,"twenty eighth":28,"twenty-eighth":28,"twenty ninth":29,"twenty-ninth":29,thirtieth:30,"thirty first":31,"thirty-first":31},sN={second:"second",seconds:"second",minute:"minute",minutes:"minute",hour:"hour",hours:"hour",day:"d",days:"d",week:"week",weeks:"week",month:"month",months:"month",quarter:"quarter",quarters:"quarter",year:"year",years:"year"},Au={s:"second",sec:"second",second:"second",seconds:"second",m:"minute",min:"minute",mins:"minute",minute:"minute",minutes:"minute",h:"hour",hr:"hour",hrs:"hour",hour:"hour",hours:"hour",d:"d",day:"d",days:"d",w:"w",week:"week",weeks:"week",mo:"month",mon:"month",mos:"month",month:"month",months:"month",qtr:"quarter",quarter:"quarter",quarters:"quarter",y:"year",yr:"year",year:"year",years:"year",...sN},nN=`(?:${G(dk)}|[0-9]+|[0-9]+\\.[0-9]+|half(?:\\s{0,2}an?)?|an?\\b(?:\\s{0,2}few)?|few|several|the|a?\\s{0,2}couple\\s{0,2}(?:of)?)`;fc=`(?:${G(uk)}|[0-9]{1,2}(?:st|nd|rd|th)?)`;Ea="(?:[1-9][0-9]{0,3}\\s{0,2}(?:BE|AD|BC|BCE|CE)|[1-2][0-9]{3}|[5-9][0-9]|2[0-5])";iN=`(${nN})\\s{0,3}(${G(Au)})`,rN=new RegExp(iN,"i"),qY=`(${nN})\\s{0,3}(${G(sN)})`,aN="\\s{0,5},?(?:\\s*and)?\\s{0,5}",Ii=Hr("(?:(?:about|around)\\s{0,3})?",iN,aN),Da=Hr("(?:(?:about|around)\\s{0,3})?",qY,aN)});var B,te=v(()=>{B=class{constructor(){I(this,"cachedInnerPattern",null);I(this,"cachedPattern",null)}innerPatternHasChange(e,t){return this.innerPattern(e)!==t}patternLeftBoundary(){return"(\\W|^)"}pattern(e){return this.cachedInnerPattern&&!this.innerPatternHasChange(e,this.cachedInnerPattern)?this.cachedPattern:(this.cachedInnerPattern=this.innerPattern(e),this.cachedPattern=new RegExp(`${this.patternLeftBoundary()}${this.cachedInnerPattern.source}`,this.cachedInnerPattern.flags),this.cachedPattern)}extract(e,t){var s;let r=(s=t[1])!=null?s:"";t.index=t.index+r.length,t[0]=t[0].substring(r.length);for(let i=2;i<t.length;i++)t[i-1]=t[i];return this.innerExtract(e,t)}}});var QY,KY,ZY,Pu,oN=v(()=>{Xt();Se();te();QY=new RegExp(`(?:(?:within|in|for)\\s*)?(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${Ii})(?=\\W|$)`,"i"),KY=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${Ii})(?=\\W|$)`,"i"),ZY=new RegExp(`(?:within|in|for)\\s*(?:(?:about|around|roughly|approximately|just)\\s*(?:~\\s*)?)?(${Da})(?=\\W|$)`,"i"),Pu=class extends B{constructor(t){super();I(this,"strictMode");this.strictMode=t}innerPattern(t){return this.strictMode?ZY:t.option.forwardDate?QY:KY}innerExtract(t,r){if(r[0].match(/^for\s*the\s*\w+/))return null;let s=Vs(r[1]);return s?(t.debug(()=>{console.log(s),console.log(V.createRelativeFromReference(t.reference,s))}),V.createRelativeFromReference(t.reference,s)):null}}});var JY,lN,cN,XY,dN,Iu,uN=v(()=>{Pt();Xt();Xt();Xt();Re();te();JY=new RegExp(`(?:on\\s{0,3})?(${fc})(?:\\s{0,3}(?:to|\\-|\\\u2013|until|through|till)?\\s{0,3}(${fc}))?(?:-|/|\\s{0,3}(?:of)?\\s{0,3})(${G(js)})(?:(?:-|/|,?\\s{0,3})(${Ea}(?!\\w)))?(?=\\W|$)`,"i"),lN=1,cN=2,XY=3,dN=4,Iu=class extends B{innerPattern(){return JY}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=js[t[XY].toLowerCase()],i=pc(t[lN]);if(i>31)return t.index=t.index+t[lN].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[dN]){let a=Sa(t[dN]);r.start.assign("year",a)}else{let a=Je(e.refDate,i,s);r.start.imply("year",a)}if(t[cN]){let a=pc(t[cN]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var ez,tz,hN,fk,pk,Ru,fN=v(()=>{Pt();Xt();Xt();Xt();Re();te();ez=new RegExp(`(${G(js)})(?:-|/|\\s*,?\\s*)(${fc})(?!\\s*(?:am|pm))\\s*(?:(?:to|\\-)\\s*(${fc})\\s*)?(?:(?:-|/|\\s*,\\s*|\\s+)(${Ea}))?(?=\\W|$)(?!\\:\\d)`,"i"),tz=1,hN=2,fk=3,pk=4,Ru=class extends B{constructor(t){super();I(this,"shouldSkipYearLikeDate");this.shouldSkipYearLikeDate=t}innerPattern(){return ez}innerExtract(t,r){let s=js[r[tz].toLowerCase()],i=pc(r[hN]);if(i>31||this.shouldSkipYearLikeDate&&!r[fk]&&!r[pk]&&r[hN].match(/^2[0-5]$/))return null;let a=t.createParsingComponents({day:i,month:s}).addTag("parser/ENMonthNameMiddleEndianParser");if(r[pk]){let c=Sa(r[pk]);a.assign("year",c)}else{let c=Je(t.refDate,i,s);a.imply("year",c)}if(!r[fk])return a;let o=pc(r[fk]),l=t.createParsingResult(r.index,r[0]);return l.start=a,l.end=a.clone(),l.end.assign("day",o),l}}});var rz,sz,nz,pN,Nu,mN=v(()=>{Xt();Pt();Re();Xt();te();rz=new RegExp(`((?:in)\\s*)?(${G(js)})\\s*(?:(?:,|-|of)?\\s*(${Ea})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`,"i"),sz=1,nz=2,pN=3,Nu=class extends B{innerPattern(){return rz}innerExtract(e,t){let r=t[nz].toLowerCase();if(t[0].length<=3&&!hk[r])return null;let s=e.createParsingResult(t.index+(t[sz]||"").length,t.index+t[0].length);s.start.imply("day",1),s.start.addTag("parser/ENMonthNameParser");let i=js[r];if(s.start.assign("month",i),t[pN]){let a=Sa(t[pN]);s.start.assign("year",a)}else{let a=Je(e.refDate,1,i);s.start.imply("year",a)}return s}}});var iz,az,oz,gN,lz,Ou,yN=v(()=>{Xt();Re();te();iz=new RegExp(`([0-9]{4})[-\\.\\/\\s](?:(${G(js)})|([0-9]{1,2}))[-\\.\\/\\s]([0-9]{1,2})(?=\\W|$)`,"i"),az=1,oz=2,gN=3,lz=4,Ou=class extends B{constructor(t){super();I(this,"strictMonthDateOrder");this.strictMonthDateOrder=t}innerPattern(){return iz}innerExtract(t,r){let s=parseInt(r[az]),i=parseInt(r[lz]),a=r[gN]?parseInt(r[gN]):js[r[oz].toLowerCase()];if(a<1||a>12){if(this.strictMonthDateOrder)return null;i>=1&&i<=12&&([a,i]=[i,a])}return i<1||i>31?null:{day:i,month:a,year:s}}}});var cz,dz,uz,Lu,vN=v(()=>{te();cz=new RegExp("([0-9]|0[1-9]|1[012])/([0-9]{4})","i"),dz=1,uz=2,Lu=class extends B{innerPattern(){return cz}innerExtract(e,t){let r=parseInt(t[uz]),s=parseInt(t[dz]);return e.createParsingComponents().imply("day",1).assign("month",s).assign("year",r)}}});function hz(n,e,t,r){return new RegExp(`${n}${e}(\\d{1,4})(?:(?:\\.|:|\uFF1A)(\\d{1,2})(?:(?::|\uFF1A)(\\d{2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${t}`,r)}function fz(n,e){return new RegExp(`^(${n})(\\d{1,4})(?:(?:\\.|\\:|\\\uFF1A)(\\d{1,2})(?:(?:\\.|\\:|\\\uFF1A)(\\d{1,2})(?:\\.(\\d{1,6}))?)?)?(?:\\s*(a\\.m\\.|p\\.m\\.|am?|pm?))?${e}`,"i")}var TN,mc,Cg,xg,Fu,ir,Ri=v(()=>{Ue();TN=2,mc=3,Cg=4,xg=5,Fu=6,ir=class{constructor(e=!1){I(this,"strictMode");I(this,"cachedPrimaryPrefix",null);I(this,"cachedPrimarySuffix",null);I(this,"cachedPrimaryTimePattern",null);I(this,"cachedFollowingPhase",null);I(this,"cachedFollowingSuffix",null);I(this,"cachedFollowingTimePatten",null);this.strictMode=e}patternFlags(){return"i"}primaryPatternLeftBoundary(){return"(^|\\s|T|\\b)"}primarySuffix(){return"(?!/)(?=\\W|$)"}followingSuffix(){return"(?!/)(?=\\W|$)"}pattern(e){return this.getPrimaryTimePatternThroughCache()}extract(e,t){let r=this.extractPrimaryTimeComponents(e,t);if(!r)return t[0].match(/^\d{4}/)?(t.index+=4,null):(t.index+=t[0].length,null);let s=t.index+t[1].length,i=t[0].substring(t[1].length),a=e.createParsingResult(s,i,r);t.index+=t[0].length;let o=e.text.substring(t.index),c=this.getFollowingTimePatternThroughCache().exec(o);return i.match(/^\d{3,4}/)&&c&&(c[0].match(/^\s*([+-])\s*\d{2,4}$/)||c[0].match(/^\s*([+-])\s*\d{2}\W\d{2}/))?null:!c||c[0].match(/^\s*([+-])\s*\d{3,4}$/)?this.checkAndReturnWithoutFollowingPattern(a):(a.end=this.extractFollowingTimeComponents(e,c,a),a.end&&(a.text+=c[0]),this.checkAndReturnWithFollowingPattern(a))}extractPrimaryTimeComponents(e,t,r=!1){let s=e.createParsingComponents(),i=0,a=null,o=parseInt(t[TN]);if(o>100){if(this.strictMode||t[mc]!=null)return null;i=o%100,o=Math.floor(o/100)}if(o>24)return null;if(t[mc]!=null){if(t[mc].length==1&&!t[Fu])return null;i=parseInt(t[mc])}if(i>=60)return null;if(o>12&&(a=N.PM),t[Fu]!=null){if(o>12)return null;let l=t[Fu][0].toLowerCase();l=="a"&&(a=N.AM,o==12&&(o=0)),l=="p"&&(a=N.PM,o!=12&&(o+=12))}if(s.assign("hour",o),s.assign("minute",i),a!==null?s.assign("meridiem",a):o<12?s.imply("meridiem",N.AM):s.imply("meridiem",N.PM),t[xg]!=null){let l=parseInt(t[xg].substring(0,3));if(l>=1e3)return null;s.assign("millisecond",l)}if(t[Cg]!=null){let l=parseInt(t[Cg]);if(l>=60)return null;s.assign("second",l)}return s}extractFollowingTimeComponents(e,t,r){let s=e.createParsingComponents();if(t[xg]!=null){let l=parseInt(t[xg].substring(0,3));if(l>=1e3)return null;s.assign("millisecond",l)}if(t[Cg]!=null){let l=parseInt(t[Cg]);if(l>=60)return null;s.assign("second",l)}let i=parseInt(t[TN]),a=0,o=-1;if(t[mc]!=null?a=parseInt(t[mc]):i>100&&(a=i%100,i=Math.floor(i/100)),a>=60||i>24)return null;if(i>=12&&(o=N.PM),t[Fu]!=null){if(i>12)return null;let l=t[Fu][0].toLowerCase();l=="a"&&(o=N.AM,i==12&&(i=0,s.isCertain("day")||s.imply("day",s.get("day")+1))),l=="p"&&(o=N.PM,i!=12&&(i+=12)),r.start.isCertain("meridiem")||(o==N.AM?(r.start.imply("meridiem",N.AM),r.start.get("hour")==12&&r.start.assign("hour",0)):(r.start.imply("meridiem",N.PM),r.start.get("hour")!=12&&r.start.assign("hour",r.start.get("hour")+12)))}return s.assign("hour",i),s.assign("minute",a),o>=0?s.assign("meridiem",o):r.start.isCertain("meridiem")&&r.start.get("hour")>12?r.start.get("hour")-12>i?s.imply("meridiem",N.AM):i<=12&&(s.assign("hour",i+12),s.assign("meridiem",N.PM)):i>12?s.imply("meridiem",N.PM):i<=12&&s.imply("meridiem",N.AM),s.date().getTime()<r.start.date().getTime()&&s.imply("day",s.get("day")+1),s}checkAndReturnWithoutFollowingPattern(e){if(e.text.match(/^\d$/)||e.text.match(/^\d\d\d+$/)||e.text.match(/\d[apAP]$/))return null;let t=e.text.match(/[^\d:.](\d[\d.]+)$/);if(t){let r=t[1];if(this.strictMode||r.includes(".")&&!r.match(/\d(\.\d{2})+$/)||parseInt(r)>24)return null}return e}checkAndReturnWithFollowingPattern(e){if(e.text.match(/^\d+-\d+$/))return null;let t=e.text.match(/[^\d:.](\d[\d.]+)\s*-\s*(\d[\d.]+)$/);if(t){if(this.strictMode)return null;let r=t[1],s=t[2];if(s.includes(".")&&!s.match(/\d(\.\d{2})+$/))return null;let i=parseInt(s),a=parseInt(r);if(i>24||a>24)return null}return e}getPrimaryTimePatternThroughCache(){let e=this.primaryPrefix(),t=this.primarySuffix();return this.cachedPrimaryPrefix===e&&this.cachedPrimarySuffix===t?this.cachedPrimaryTimePattern:(this.cachedPrimaryTimePattern=hz(this.primaryPatternLeftBoundary(),e,t,this.patternFlags()),this.cachedPrimaryPrefix=e,this.cachedPrimarySuffix=t,this.cachedPrimaryTimePattern)}getFollowingTimePatternThroughCache(){let e=this.followingPhase(),t=this.followingSuffix();return this.cachedFollowingPhase===e&&this.cachedFollowingSuffix===t?this.cachedFollowingTimePatten:(this.cachedFollowingTimePatten=fz(e,t),this.cachedFollowingPhase=e,this.cachedFollowingSuffix=t,this.cachedFollowingTimePatten)}}});var Bu,wN=v(()=>{Ue();Ri();Bu=class extends ir{constructor(e){super(e)}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|to|until|through|till|\\?)\\s*"}primaryPrefix(){return"(?:(?:at|from)\\s*)??"}primarySuffix(){return"(?:\\s*(?:o\\W*clock|at\\s*night|in\\s*the\\s*(?:morning|afternoon)))?(?!/)(?=\\W|$)"}extractPrimaryTimeComponents(e,t){let r=super.extractPrimaryTimeComponents(e,t);if(!r)return r;if(t[0].endsWith("night")){let s=r.get("hour");s>=6&&s<12?(r.assign("hour",r.get("hour")+12),r.assign("meridiem",N.PM)):s<6&&r.assign("meridiem",N.AM)}if(t[0].endsWith("afternoon")){r.assign("meridiem",N.PM);let s=r.get("hour");s>=0&&s<=6&&r.assign("hour",r.get("hour")+12)}return t[0].endsWith("morning")&&(r.assign("meridiem",N.AM),r.get("hour")<12&&r.assign("hour",r.get("hour"))),r.addTag("parser/ENTimeExpressionParser")}extractFollowingTimeComponents(e,t,r){let s=super.extractFollowingTimeComponents(e,t,r);return s&&s.addTag("parser/ENTimeExpressionParser"),s}}});var pz,mz,Hu,bN=v(()=>{Xt();Se();te();_u();pz=new RegExp(`(${Ii})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i"),mz=new RegExp(`(${Da})\\s{0,5}(?:ago|before|earlier)(?=\\W|$)`,"i"),Hu=class extends B{constructor(t){super();I(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?mz:pz}innerExtract(t,r){let s=Vs(r[1]);return s?V.createRelativeFromReference(t.reference,hc(s)):null}}});var gz,yz,vz,Uu,kN=v(()=>{Xt();Se();te();gz=new RegExp(`(${Ii})\\s{0,5}(?:later|after|from now|henceforth|forward|out)(?=(?:\\W|$))`,"i"),yz=new RegExp(`(${Da})\\s{0,5}(later|after|from now)(?=\\W|$)`,"i"),vz=1,Uu=class extends B{constructor(t){super();I(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?yz:gz}innerExtract(t,r){let s=Vs(r[vz]);return s?V.createRelativeFromReference(t.reference,s):null}}});var gc,ts,Ni=v(()=>{gc=class{refine(e,t){return t.filter(r=>this.isValid(e,r))}},ts=class{refine(e,t){if(t.length<2)return t;let r=[],s=t[0],i=null;for(let a=1;a<t.length;a++){i=t[a];let o=e.text.substring(s.index+s.text.length,i.index);if(!this.shouldMergeResults(o,s,i,e))r.push(s),s=i;else{let l=s,c=i,d=this.mergeResults(o,l,c,e);e.debug(()=>{console.log(`${this.constructor.name} merged ${l} and ${c} into ${d}`)}),s=d}}return s!=null&&r.push(s),r}}});var vt,Ys=v(()=>{Ni();vt=class extends ts{shouldMergeResults(e,t,r){return!t.end&&!r.end&&e.match(this.patternBetween())!=null}mergeResults(e,t,r){if(!t.start.isOnlyWeekdayComponent()&&!r.start.isOnlyWeekdayComponent()&&(r.start.getCertainComponents().forEach(i=>{t.start.isCertain(i)||t.start.imply(i,r.start.get(i))}),t.start.getCertainComponents().forEach(i=>{r.start.isCertain(i)||r.start.imply(i,t.start.get(i))})),t.start.date().getTime()>r.start.date().getTime()){let i=t.start.dayjs(),a=r.start.dayjs();r.start.isOnlyWeekdayComponent()&&a.add(7,"days").isAfter(i)?(a=a.add(7,"days"),r.start.imply("day",a.date()),r.start.imply("month",a.month()+1),r.start.imply("year",a.year())):t.start.isOnlyWeekdayComponent()&&i.add(-7,"days").isBefore(a)?(i=i.add(-7,"days"),t.start.imply("day",i.date()),t.start.imply("month",i.month()+1),t.start.imply("year",i.year())):r.start.isDateWithUnknownYear()&&a.add(1,"years").isAfter(i)?(a=a.add(1,"years"),r.start.imply("year",a.year())):t.start.isDateWithUnknownYear()&&i.add(-1,"years").isBefore(a)?(i=i.add(-1,"years"),t.start.imply("year",i.year())):[r,t]=[t,r]}let s=t.clone();return s.start=t.start,s.end=r.start,s.index=Math.min(t.index,r.index),t.index<r.index?s.text=t.text+e+r.text:s.text=r.text+e+t.text,s}}});var Wu,EN=v(()=>{Ys();Wu=class extends vt{patternBetween(){return/^\s*(to|-|–|until|through|till)\s*$/i}}});function wn(n,e){e=e.add(1,"day"),ft(n,e),Kn(n,e)}function SN(n,e){e=e.add(1,"day"),mk(n,e),Kn(n,e)}function ft(n,e){n.assign("day",e.date()),n.assign("month",e.month()+1),n.assign("year",e.year())}function DN(n,e){n.assign("hour",e.hour()),n.assign("minute",e.minute()),n.assign("second",e.second()),n.assign("millisecond",e.millisecond()),n.get("hour")<12?n.assign("meridiem",N.AM):n.assign("meridiem",N.PM)}function mk(n,e){n.imply("day",e.date()),n.imply("month",e.month()+1),n.imply("year",e.year())}function Kn(n,e){n.imply("hour",e.hour()),n.imply("minute",e.minute()),n.imply("second",e.second()),n.imply("millisecond",e.millisecond())}var ws=v(()=>{Ue()});function gk(n,e){let t=n.clone(),r=n.start,s=e.start;if(t.start=CN(r,s),n.end!=null||e.end!=null){let i=n.end==null?n.start:n.end,a=e.end==null?e.start:e.end,o=CN(i,a);if(n.end==null&&o.date().getTime()<t.start.date().getTime()){let l=o.dayjs().add(1,"day");o.isCertain("day")?ft(o,l):mk(o,l)}t.end=o}return t}function CN(n,e){let t=n.clone();return e.isCertain("hour")?(t.assign("hour",e.get("hour")),t.assign("minute",e.get("minute")),e.isCertain("second")?(t.assign("second",e.get("second")),e.isCertain("millisecond")?t.assign("millisecond",e.get("millisecond")):t.imply("millisecond",e.get("millisecond"))):(t.imply("second",e.get("second")),t.imply("millisecond",e.get("millisecond")))):(t.imply("hour",e.get("hour")),t.imply("minute",e.get("minute")),t.imply("second",e.get("second")),t.imply("millisecond",e.get("millisecond"))),e.isCertain("timezoneOffset")&&t.assign("timezoneOffset",e.get("timezoneOffset")),e.isCertain("meridiem")?t.assign("meridiem",e.get("meridiem")):e.get("meridiem")!=null&&t.get("meridiem")==null&&t.imply("meridiem",e.get("meridiem")),t.get("meridiem")==N.PM&&t.get("hour")<12&&(e.isCertain("hour")?t.assign("hour",t.get("hour")+12):t.imply("hour",t.get("hour")+12)),t.addTags(n.tags()),t.addTags(e.tags()),t}var xN=v(()=>{Ue();ws()});var Tt,zs=v(()=>{Ni();xN();Tt=class extends ts{shouldMergeResults(e,t,r){return(t.start.isOnlyDate()&&r.start.isOnlyTime()||r.start.isOnlyDate()&&t.start.isOnlyTime())&&e.match(this.patternBetween())!=null}mergeResults(e,t,r){let s=t.start.isOnlyDate()?gk(t,r):gk(r,t);return s.index=t.index,s.text=t.text+e+r.text,s}}});var yc,MN=v(()=>{zs();yc=class extends Tt{patternBetween(){return new RegExp("^\\s*(T|at|after|before|on|of|,|-|\\.|\u2219|:)?\\s*$")}}});var Tz,$u,_N=v(()=>{lk();Tz=new RegExp("^\\s*,?\\s*\\(?([A-Z]{2,4})\\)?(?=\\W|$)","i"),$u=class{constructor(e){I(this,"timezoneOverrides");this.timezoneOverrides=e}refine(e,t){var s;let r=(s=e.option.timezones)!=null?s:{};return t.forEach(i=>{var f,p;let a=e.text.substring(i.index+i.text.length),o=Tz.exec(a);if(!o)return;let l=o[1].toUpperCase(),c=(p=(f=i.start.date())!=null?f:i.refDate)!=null?p:new Date,d={...this.timezoneOverrides,...r},u=Sg(l,c,d);if(u==null)return;e.debug(()=>{console.log(`Extracting timezone: '${l}' into: ${u} for: ${i.start}`)});let h=i.start.get("timezoneOffset");h!==null&&u!=h&&(i.start.isCertain("timezoneOffset")||l!=o[1])||i.start.isOnlyDate()&&l!=o[1]||(i.text+=o[0],i.start.isCertain("timezoneOffset")||i.start.assign("timezoneOffset",u),i.end!=null&&!i.end.isCertain("timezoneOffset")&&i.end.assign("timezoneOffset",u))}),t}}});var wz,bz,kz,Ez,bn,ju=v(()=>{wz=new RegExp("^\\s*(?:\\(?(?:GMT|UTC)\\s?)?([+-])(\\d{1,2})(?::?(\\d{2}))?\\)?","i"),bz=1,kz=2,Ez=3,bn=class{refine(e,t){return t.forEach(function(r){if(r.start.isCertain("timezoneOffset"))return;let s=e.text.substring(r.index+r.text.length),i=wz.exec(s);if(!i)return;e.debug(()=>{console.log(`Extracting timezone: '${i[0]}' into : ${r}`)});let a=parseInt(i[kz]),o=parseInt(i[Ez]||"0"),l=a*60+o;l>840||(i[bz]==="-"&&(l=-l),r.end!=null&&r.end.assign("timezoneOffset",l),r.start.assign("timezoneOffset",l),r.text+=i[0])}),t}}});var Ca,yk=v(()=>{Ca=class{refine(e,t){if(t.length<2)return t;let r=[],s=t[0];for(let i=1;i<t.length;i++){let a=t[i];if(a.index>=s.index+s.text.length){r.push(s),s=a;continue}let o=null,l=null;a.text.length>s.text.length?(o=a,l=s):(o=s,l=a),e.debug(()=>{console.log(`${this.constructor.name} remove ${l} by ${o}`)}),s=o}return s!=null&&r.push(s),r}}});var AN,Vu,PN=v(()=>{AN=ke(Ye(),1);ak();Vu=class{refine(e,t){return e.option.forwardDate&&t.forEach(r=>{let s=(0,AN.default)(e.reference.getDateWithAdjustedTimezone());if(r.start.isOnlyTime()&&e.reference.instant>r.start.date()){let i=e.reference.getDateWithAdjustedTimezone(),a=new Date(i);a.setDate(a.getDate()+1),Eg(r.start,a),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} time from the ref date (${i}) to the following day (${a})`)}),r.end&&r.end.isOnlyTime()&&(Eg(r.end,a),r.start.date()>r.end.date()&&(a.setDate(a.getDate()+1),Eg(r.end,a)))}if(r.start.isOnlyWeekdayComponent()&&s.isAfter(r.start.dayjs())&&(s.day()>=r.start.get("weekday")?s=s.day(r.start.get("weekday")+7):s=s.day(r.start.get("weekday")),r.start.imply("day",s.date()),r.start.imply("month",s.month()+1),r.start.imply("year",s.year()),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} weekday (${r.start})`)}),r.end&&r.end.isOnlyWeekdayComponent()&&(s.day()>r.end.get("weekday")?s=s.day(r.end.get("weekday")+7):s=s.day(r.end.get("weekday")),r.end.imply("day",s.date()),r.end.imply("month",s.month()+1),r.end.imply("year",s.year()),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} weekday (${r.end})`)}))),r.start.isDateWithUnknownYear()&&s.isAfter(r.start.dayjs()))for(let i=0;i<3&&s.isAfter(r.start.dayjs());i++)r.start.imply("year",r.start.get("year")+1),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} year (${r.start})`)}),r.end&&!r.end.isCertain("year")&&(r.end.imply("year",r.end.get("year")+1),e.debug(()=>{console.log(`${this.constructor.name} adjusted ${r} month (${r.start})`)}))}),t}}});var Yu,IN=v(()=>{Ni();Yu=class extends gc{constructor(t){super();I(this,"strictMode");this.strictMode=t}isValid(t,r){return r.text.replace(" ","").match(/^\d*(\.\d*)?$/)?(t.debug(()=>{console.log(`Removing unlikely result '${r.text}'`)}),!1):r.start.isValidDate()?r.end&&!r.end.isValidDate()?(t.debug(()=>{console.log(`Removing invalid result: ${r} (${r.end})`)}),!1):this.strictMode?this.isStrictModeValid(t,r):!0:(t.debug(()=>{console.log(`Removing invalid result: ${r} (${r.start})`)}),!1)}isStrictModeValid(t,r){return r.start.isOnlyWeekdayComponent()?(t.debug(()=>{console.log(`(Strict) Removing weekday only component: ${r} (${r.end})`)}),!1):!0}}});var Sz,Dz,Cz,xz,RN,Mz,NN,ON,_z,LN,FN,Oi,Mg=v(()=>{te();Sz=new RegExp("([0-9]{4})\\-([0-9]{1,2})\\-([0-9]{1,2})(?:T([0-9]{1,2}):([0-9]{1,2})(?::([0-9]{1,2})(?:\\.(\\d{1,4}))?)?(Z|([+-]\\d{2}):?(\\d{2})?)?)?(?=\\W|$)","i"),Dz=1,Cz=2,xz=3,RN=4,Mz=5,NN=6,ON=7,_z=8,LN=9,FN=10,Oi=class extends B{innerPattern(){return Sz}innerExtract(e,t){let r=e.createParsingComponents({year:parseInt(t[Dz]),month:parseInt(t[Cz]),day:parseInt(t[xz])});if(t[RN]!=null&&(r.assign("hour",parseInt(t[RN])),r.assign("minute",parseInt(t[Mz])),t[NN]!=null&&r.assign("second",parseInt(t[NN])),t[ON]!=null&&r.assign("millisecond",parseInt(t[ON])),t[_z]!=null)){let s=0;if(t[LN]){let i=parseInt(t[LN]),a=0;t[FN]!=null&&(a=parseInt(t[FN])),s=i*60,s<0?s-=a:s+=a}r.assign("timezoneOffset",s)}return r.addTag("parser/ISOFormatParser")}}});var Ro,vk=v(()=>{Ni();Ro=class extends ts{mergeResults(e,t,r){let s=r.clone();return s.index=t.index,s.text=t.text+e+s.text,s.start.assign("weekday",t.start.get("weekday")),s.end&&s.end.assign("weekday",t.start.get("weekday")),s}shouldMergeResults(e,t,r){return t.start.isOnlyWeekdayComponent()&&!t.start.isCertain("hour")&&r.start.isCertain("day")&&e.match(/^,?\s*$/)!=null}}});function kt(n,e=!1){return n.parsers.unshift(new Oi),n.refiners.unshift(new Ro),n.refiners.unshift(new bn),n.refiners.unshift(new Ca),n.refiners.push(new $u),n.refiners.push(new Ca),n.refiners.push(new Vu),n.refiners.push(new Yu(e)),n}var bs=v(()=>{_N();ju();yk();PN();IN();Mg();vk()});function Ar(n){let e=(0,xa.default)(n.getDateWithAdjustedTimezone()),t=new V(n,{});return ft(t,e),DN(t,e),t.assign("timezoneOffset",n.getTimezoneOffset()),t.addTag("casualReference/now"),t}function ar(n){let e=(0,xa.default)(n.getDateWithAdjustedTimezone()),t=new V(n,{});return ft(t,e),Kn(t,e),t.addTag("casualReference/today"),t}function Pr(n){return No(n,1).addTag("casualReference/yesterday")}function No(n,e){return Zn(n,-e)}function Ir(n){return Zn(n,1).addTag("casualReference/tomorrow")}function Zn(n,e){let t=(0,xa.default)(n.getDateWithAdjustedTimezone()),r=new V(n,{});return t=t.add(e,"day"),ft(r,t),Kn(r,t),r}function BN(n,e=22){let t=(0,xa.default)(n.getDateWithAdjustedTimezone()),r=new V(n,{});return ft(r,t),r.imply("hour",e),r.imply("meridiem",N.PM),r.addTag("casualReference/tonight"),r}function _g(n,e=0){let t=(0,xa.default)(n.getDateWithAdjustedTimezone()),r=new V(n,{});return t.hour()<6&&(t=t.add(-1,"day")),ft(r,t),r.imply("hour",e),r}function vc(n,e=20){let t=new V(n,{});return t.imply("meridiem",N.PM),t.imply("hour",e),t.addTag("casualReference/evening"),t}function Ag(n,e=20){let t=(0,xa.default)(n.getDateWithAdjustedTimezone()),r=new V(n,{});return t=t.add(-1,"day"),ft(r,t),r.imply("hour",e),r.imply("meridiem",N.PM),r.addTag("casualReference/yesterday"),r.addTag("casualReference/evening"),r}function Oo(n){let e=new V(n,{}),t=(0,xa.default)(n.getDateWithAdjustedTimezone());return t.hour()>2&&SN(e,t),e.assign("hour",0),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/midnight"),e}function Tc(n,e=6){let t=new V(n,{});return t.imply("meridiem",N.AM),t.imply("hour",e),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/morning"),t}function HN(n,e=15){let t=new V(n,{});return t.imply("meridiem",N.PM),t.imply("hour",e),t.imply("minute",0),t.imply("second",0),t.imply("millisecond",0),t.addTag("casualReference/afternoon"),t}function wc(n){let e=new V(n,{});return e.imply("meridiem",N.AM),e.assign("hour",12),e.imply("minute",0),e.imply("second",0),e.imply("millisecond",0),e.addTag("casualReference/noon"),e}var xa,ks=v(()=>{Se();xa=ke(Ye(),1);ws();Ue()});var UN,Az,zu,WN=v(()=>{UN=ke(Ye(),1);te();ws();ks();Az=/(now|today|tonight|tomorrow|overmorrow|tmr|tmrw|yesterday|last\s*night)(?=\W|$)/i,zu=class extends B{innerPattern(e){return Az}innerExtract(e,t){let r=(0,UN.default)(e.refDate),s=t[0].toLowerCase(),i=e.createParsingComponents();switch(s){case"now":i=Ar(e.reference);break;case"today":i=ar(e.reference);break;case"yesterday":i=Pr(e.reference);break;case"tomorrow":case"tmr":case"tmrw":i=Ir(e.reference);break;case"tonight":i=BN(e.reference);break;case"overmorrow":i=Zn(e.reference,2);break;default:s.match(/last\s*night/)&&(r.hour()>6&&(r=r.add(-1,"day")),ft(i,r),i.imply("hour",0));break}return i.addTag("parser/ENCasualDateParser"),i}}});var Pz,qu,$N=v(()=>{te();ks();Pz=/(?:this)?\s{0,3}(morning|afternoon|evening|night|midnight|midday|noon)(?=\W|$)/i,qu=class extends B{innerPattern(){return Pz}innerExtract(e,t){let r=null;switch(t[1].toLowerCase()){case"afternoon":r=HN(e.reference);break;case"evening":case"night":r=vc(e.reference);break;case"midnight":r=Oo(e.reference);break;case"morning":r=Tc(e.reference);break;case"noon":case"midday":r=wc(e.reference);break}return r&&r.addTag("parser/ENCasualTimeParser"),r}}});function Vt(n){let e={};for(let t in n)e[t]=-n[t];return e}function Pg(n,e){let t=n.clone(),r=n.dayjs();for(let s in e)r=r.add(e[s],s);return("day"in e||"d"in e||"week"in e||"month"in e||"year"in e)&&(t.imply("day",r.date()),t.imply("month",r.month()+1),t.imply("year",r.year())),("second"in e||"minute"in e||"hour"in e)&&(t.imply("second",r.second()),t.imply("minute",r.minute()),t.imply("hour",r.hour())),t}var Es=v(()=>{});function Yt(n,e,t){let r=n.getDateWithAdjustedTimezone(),s=Iz(r,e,t),i=new V(n);return i=Pg(i,{day:s}),i.assign("weekday",e),i}function Iz(n,e,t){let r=n.getDay();switch(t){case"this":return Ig(n,e);case"last":return jN(n,e);case"next":return r==ye.SUNDAY?e==ye.SUNDAY?7:e:r==ye.SATURDAY?e==ye.SATURDAY?7:e==ye.SUNDAY?8:1+e:e<r&&e!=ye.SUNDAY?Ig(n,e):Ig(n,e)+7}return Rz(n,e)}function Rz(n,e){let t=jN(n,e),r=Ig(n,e);return r<-t?r:t}function Ig(n,e){let t=n.getDay(),r=e-t;return r<0&&(r+=7),r}function jN(n,e){let t=n.getDay(),r=e-t;return r>=0&&(r-=7),r}var kn=v(()=>{Ue();Se();Es()});var Nz,Oz,Lz,Fz,Gu,VN=v(()=>{Xt();Re();te();kn();Ue();Nz=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:on\\s*?)?(?:(this|last|past|next)\\s*)?(${G(Dg)}|weekend|weekday)(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(this|last|past|next)\\s*week)?(?=\\W|$)`,"i"),Oz=1,Lz=2,Fz=3,Gu=class extends B{innerPattern(){return Nz}innerExtract(e,t){let r=t[Oz],s=t[Fz],i=r||s;i=i||"",i=i.toLowerCase();let a=null;i=="last"||i=="past"?a="last":i=="next"?a="next":i=="this"&&(a="this");let o=t[Lz].toLowerCase(),l;if(Dg[o]!==void 0)l=Dg[o];else if(o=="weekend")l=a=="last"?ye.SUNDAY:ye.SATURDAY;else if(o=="weekday"){let c=e.reference.getDateWithAdjustedTimezone().getDay();c==ye.SUNDAY||c==ye.SATURDAY?l=a=="last"?ye.FRIDAY:ye.MONDAY:(l=c-1,l=a=="last"?l-1:l+1,l=l%5+1)}else return null;return Yt(e.reference,l,a)}}});var YN,Bz,Hz,Uz,Qu,zN=v(()=>{Xt();Se();YN=ke(Ye(),1);te();Re();Bz=new RegExp(`(this|last|past|next|after\\s*this)\\s*(${G(Au)})(?=\\s*)(?=\\W|$)`,"i"),Hz=1,Uz=2,Qu=class extends B{innerPattern(){return Bz}innerExtract(e,t){let r=t[Hz].toLowerCase(),s=t[Uz].toLowerCase(),i=Au[s];if(r=="next"||r.startsWith("after")){let l={};return l[i]=1,V.createRelativeFromReference(e.reference,l)}if(r=="last"||r=="past"){let l={};return l[i]=-1,V.createRelativeFromReference(e.reference,l)}let a=e.createParsingComponents(),o=(0,YN.default)(e.reference.instant);return s.match(/week/i)?(o=o.add(-o.get("d"),"d"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.imply("year",o.year())):s.match(/month/i)?(o=o.add(-o.date()+1,"d"),a.imply("day",o.date()),a.assign("year",o.year()),a.assign("month",o.month()+1)):s.match(/year/i)&&(o=o.add(-o.date()+1,"d"),o=o.add(-o.month(),"month"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.assign("year",o.year())),a}}});var Wz,$z,jz,qN,GN,Tk,er,Li=v(()=>{Pt();Wz=new RegExp("([^\\d]|^)([0-3]{0,1}[0-9]{1})[\\/\\.\\-]([0-3]{0,1}[0-9]{1})(?:[\\/\\.\\-]([0-9]{4}|[0-9]{2}))?(\\W|$)","i"),$z=1,jz=5,qN=2,GN=3,Tk=4,er=class{constructor(e){I(this,"groupNumberMonth");I(this,"groupNumberDay");this.groupNumberMonth=e?GN:qN,this.groupNumberDay=e?qN:GN}pattern(){return Wz}extract(e,t){let r=t.index+t[$z].length,s=t.index+t[0].length-t[jz].length;if(r>0&&e.text.substring(0,r).match("\\d/?$")||s<e.text.length&&e.text.substring(s).match("^/?\\d"))return;let i=e.text.substring(r,s);if(i.match(/^\d\.\d$/)||i.match(/^\d\.\d{1,2}\.\d{1,2}\s*$/)||!t[Tk]&&i.indexOf("/")<0)return;let a=e.createParsingResult(r,i),o=parseInt(t[this.groupNumberMonth]),l=parseInt(t[this.groupNumberDay]);if((o<1||o>12)&&o>12)if(l>=1&&l<=12&&o<=31)[l,o]=[o,l];else return null;if(l<1||l>31)return null;if(a.start.assign("day",l),a.start.assign("month",o),t[Tk]){let c=parseInt(t[Tk]),d=es(c);a.start.assign("year",d)}else{let c=Je(e.refDate,l,o);a.start.imply("year",c)}return a.addTag("parser/SlashDateFormatParser")}}});var Vz,Yz,Ku,QN=v(()=>{Xt();Se();te();_u();Vz=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${Ii})(?=\\W|$)`,"i"),Yz=new RegExp(`(this|last|past|next|after|\\+|-)\\s*(${Da})(?=\\W|$)`,"i"),Ku=class extends B{constructor(t=!0){super();I(this,"allowAbbreviations");this.allowAbbreviations=t}innerPattern(){return this.allowAbbreviations?Vz:Yz}innerExtract(t,r){let s=r[1].toLowerCase(),i=Vs(r[2]);if(!i)return null;switch(s){case"last":case"past":case"-":i=hc(i);break}return V.createRelativeFromReference(t.reference,i)}}});function zz(n){return n.text.match(/^[+-]/i)!=null}function KN(n){return n.text.match(/^-/i)!=null}var Zu,ZN=v(()=>{Ni();Se();Xt();Es();Zu=class extends ts{shouldMergeResults(e,t,r){return e.match(/^\s*$/i)?zz(r)||KN(r):!1}mergeResults(e,t,r,s){let i=Vs(r.text);KN(r)&&(i=Vt(i));let a=V.createRelativeFromReference(ze.fromDate(t.start.date()),i);return new $e(t.reference,t.index,`${t.text}${e}${r.text}`,a)}}});function JN(n){return n.text.match(/\s+(before|from)$/i)!=null}function qz(n){return n.text.match(/\s+(after|since)$/i)!=null}var Ju,XN=v(()=>{Ni();Se();Xt();_u();Ju=class extends ts{patternBetween(){return/^\s*$/i}shouldMergeResults(e,t,r){return!e.match(this.patternBetween())||!JN(t)&&!qz(t)?!1:!!r.start.get("day")&&!!r.start.get("month")&&!!r.start.get("year")}mergeResults(e,t,r){let s=Vs(t.text);JN(t)&&(s=hc(s));let i=V.createRelativeFromReference(ze.fromDate(r.start.date()),s);return new $e(r.reference,t.index,`${t.text}${e}${r.text}`,i)}}});var Gz,Qz,Xu,eO=v(()=>{Xt();Gz=new RegExp(`^\\s*(${Ea})`,"i"),Qz=1,Xu=class{refine(e,t){return t.forEach(function(r){if(!r.start.isDateWithUnknownYear())return;let s=e.text.substring(r.index+r.text.length),i=Gz.exec(s);if(!i||i[0].trim().length<=3)return;e.debug(()=>{console.log(`Extracting year: '${i[0]}' into : ${r}`)});let a=Sa(i[Qz]);r.end!=null&&r.end.assign("year",a),r.start.assign("year",a),r.text+=i[0]}),t}}});var eh,tO=v(()=>{Ni();eh=class extends gc{constructor(){super()}isValid(e,t){let r=t.text.trim();return r===e.text.trim()?!0:r.toLowerCase()==="may"&&!e.text.substring(0,t.index).trim().match(/\b(in)$/i)?(e.debug(()=>{console.log(`Removing unlikely result: ${t}`)}),!1):r.toLowerCase().endsWith("the second")?(e.text.substring(t.index+t.text.length).trim().length>0&&e.debug(()=>{console.log(`Removing unlikely result: ${t}`)}),!1):!0}}});var Lo,wk=v(()=>{oN();uN();fN();mN();yN();vN();wN();bN();kN();EN();MN();bs();WN();$N();VN();zN();Li();QN();ZN();XN();yk();eO();tO();Lo=class{createCasualConfiguration(e=!1){let t=this.createConfiguration(!1,e);return t.parsers.push(new zu),t.parsers.push(new qu),t.parsers.push(new Nu),t.parsers.push(new Qu),t.parsers.push(new Ku),t.refiners.push(new eh),t}createConfiguration(e=!0,t=!1){let r=kt({parsers:[new er(t),new Pu(e),new Iu,new Ru(t),new Gu,new Lu,new Bu(e),new Hu(e),new Uu(e)],refiners:[new yc]},e);return r.parsers.unshift(new Ou(e)),r.refiners.unshift(new Ju),r.refiners.unshift(new Zu),r.refiners.unshift(new Ca),r.refiners.push(new yc),r.refiners.push(new Xu),r.refiners.push(new Wu),r}}});var fe,th,rs=v(()=>{Se();wk();fe=class n{constructor(e){I(this,"parsers");I(this,"refiners");I(this,"defaultConfig",new Lo);e=e||this.defaultConfig.createCasualConfiguration(),this.parsers=[...e.parsers],this.refiners=[...e.refiners]}clone(){return new n({parsers:[...this.parsers],refiners:[...this.refiners]})}parseDate(e,t,r){let s=this.parse(e,t,r);return s.length>0?s[0].start.date():null}parse(e,t,r){let s=new th(e,t,r),i=[];return this.parsers.forEach(a=>{let o=n.executeParser(s,a);i=i.concat(o)}),i.sort((a,o)=>a.index-o.index),this.refiners.forEach(function(a){i=a.refine(s,i)}),i}static executeParser(e,t){let r=[],s=t.pattern(e),i=e.text,a=e.text,o=s.exec(a);for(;o;){let l=o.index+i.length-a.length;o.index=l;let c=t.extract(e,o);if(!c){a=i.substring(o.index+1),o=s.exec(a);continue}let d=null;c instanceof $e?d=c:c instanceof V?(d=e.createParsingResult(o.index,o[0]),d.start=c):d=e.createParsingResult(o.index,o[0],c);let u=d.index,h=d.text;e.debug(()=>console.log(`${t.constructor.name} extracted (at index=${u}) '${h}'`)),r.push(d),a=i.substring(u+h.length),o=s.exec(a)}return r}},th=class{constructor(e,t,r){I(this,"text");I(this,"option");I(this,"reference");I(this,"refDate");this.text=e,this.option=r!=null?r:{},this.reference=ze.fromInput(t,this.option.timezones),this.refDate=this.reference.instant}createParsingComponents(e){return e instanceof V?e:new V(this.reference,e)}createParsingResult(e,t,r,s){let i=typeof t=="string"?t:this.text.substring(e,t),a=r?this.createParsingComponents(r):null,o=s?this.createParsingComponents(s):null;return new $e(this.reference,e,i,a,o)}debug(e){this.option.debug&&(this.option.debug instanceof Function?this.option.debug(e):this.option.debug.debug(e))}}});var kk={};nt(kk,{Chrono:()=>fe,GB:()=>Kz,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>rh,configuration:()=>Rg,parse:()=>Zz,parseDate:()=>Jz,strict:()=>bk});function Zz(n,e,t){return rh.parse(n,e,t)}function Jz(n,e,t){return rh.parseDate(n,e,t)}var Rg,rh,bk,Kz,rO=v(()=>{rs();Se();Ue();wk();Rg=new Lo,rh=new fe(Rg.createCasualConfiguration(!1)),bk=new fe(Rg.createConfiguration(!0,!1)),Kz=new fe(Rg.createCasualConfiguration(!0))});var sh,sO=v(()=>{Ri();sh=class extends ir{primaryPrefix(){return"(?:(?:um|von)\\s*)?"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|bis)\\s*"}extractPrimaryTimeComponents(e,t){return t[0].match(/^\s*\d{4}\s*$/)?null:super.extractPrimaryTimeComponents(e,t)}}});function xk(n){let e=n.toLowerCase();return Ek[e]!==void 0?Ek[e]:e==="ein"||e==="einer"||e==="einem"||e==="einen"||e==="eine"?1:e.match(/wenigen/)?2:e.match(/halb/)||e.match(/halben/)?.5:e.match(/einigen/)?3:e.match(/mehreren/)?7:parseFloat(e)}function aO(n){if(/v/i.test(n))return-parseInt(n.replace(/[^0-9]+/gi,""));if(/n/i.test(n))return parseInt(n.replace(/[^0-9]+/gi,""));if(/z/i.test(n))return parseInt(n.replace(/[^0-9]+/gi,""));let e=parseInt(n);return es(e)}function cO(n){let e={},t=n,r=nO.exec(t);for(;r;)Xz(e,r),t=t.substring(r[0].length),r=nO.exec(t);return e}function Xz(n,e){let t=xk(e[1]),r=nh[e[2].toLowerCase()];n[r]=t}var Sk,Dk,Ek,nh,Ck,iO,oO,nO,lO,bc=v(()=>{Re();Pt();Sk={sonntag:0,so:0,montag:1,mo:1,dienstag:2,di:2,mittwoch:3,mi:3,donnerstag:4,do:4,freitag:5,fr:5,samstag:6,sa:6},Dk={januar:1,j\u00E4nner:1,janner:1,jan:1,"jan.":1,februar:2,feber:2,feb:2,"feb.":2,m\u00E4rz:3,maerz:3,m\u00E4r:3,"m\xE4r.":3,mrz:3,"mrz.":3,april:4,apr:4,"apr.":4,mai:5,juni:6,jun:6,"jun.":6,juli:7,jul:7,"jul.":7,august:8,aug:8,"aug.":8,september:9,sep:9,"sep.":9,sept:9,"sept.":9,oktober:10,okt:10,"okt.":10,november:11,nov:11,"nov.":11,dezember:12,dez:12,"dez.":12},Ek={eins:1,eine:1,einem:1,einen:1,einer:1,zwei:2,drei:3,vier:4,f\u00FCnf:5,fuenf:5,sechs:6,sieben:7,acht:8,neun:9,zehn:10,elf:11,zw\u00F6lf:12,zwoelf:12},nh={sek:"second",sekunde:"second",sekunden:"second",min:"minute",minute:"minute",minuten:"minute",h:"hour",std:"hour",stunde:"hour",stunden:"hour",tag:"d",tage:"d",tagen:"d",woche:"week",wochen:"week",monat:"month",monate:"month",monaten:"month",monats:"month",quartal:"quarter",quartals:"quarter",quartale:"quarter",quartalen:"quarter",a:"year",j:"year",jr:"year",jahr:"year",jahre:"year",jahren:"year",jahres:"year"},Ck=`(?:${G(Ek)}|[0-9]+|[0-9]+\\.[0-9]+|halb?|halbe?|einigen?|wenigen?|mehreren?)`;iO="(?:[0-9]{1,4}(?:\\s*[vn]\\.?\\s*(?:C(?:hr)?|(?:u\\.?|d\\.?(?:\\s*g\\.?)?)?\\s*Z)\\.?|\\s*(?:u\\.?|d\\.?(?:\\s*g\\.)?)\\s*Z\\.?)?)";oO=`(${Ck})\\s{0,5}(${G(nh)})\\s{0,5}`,nO=new RegExp(oO,"i"),lO=Hr("",oO)});var e3,t3,r3,s3,ih,dO=v(()=>{bc();Re();te();kn();e3=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:a[mn]\\s*?)?(?:(diese[mn]|letzte[mn]|n(?:\xE4|ae)chste[mn])\\s*)?(${G(Sk)})(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(diese|letzte|n(?:\xE4|ae)chste)\\s*woche)?(?=\\W|$)`,"i"),t3=1,r3=3,s3=2,ih=class extends B{innerPattern(){return e3}innerExtract(e,t){let r=t[s3].toLowerCase(),s=Sk[r],i=t[t3],a=t[r3],o=i||a;o=o||"",o=o.toLowerCase();let l=null;return o.match(/letzte/)?l="last":o.match(/chste/)?l="next":o.match(/diese/)&&(l="this"),Yt(e.reference,s,l)}}});var n3,i3,a3,uO,hO,fO,ah,pO=v(()=>{Ue();n3=new RegExp("(^|\\s|T)(?:(?:um|von)\\s*)?(\\d{1,2})(?:h|:)?(?:(\\d{1,2})(?:m|:)?)?(?:(\\d{1,2})(?:s)?)?(?:\\s*Uhr)?(?:\\s*(morgens|vormittags|nachmittags|abends|nachts|am\\s+(?:Morgen|Vormittag|Nachmittag|Abend)|in\\s+der\\s+Nacht))?(?=\\W|$)","i"),i3=new RegExp("^\\s*(\\-|\\\u2013|\\~|\\\u301C|bis(?:\\s+um)?|\\?)\\s*(\\d{1,2})(?:h|:)?(?:(\\d{1,2})(?:m|:)?)?(?:(\\d{1,2})(?:s)?)?(?:\\s*Uhr)?(?:\\s*(morgens|vormittags|nachmittags|abends|nachts|am\\s+(?:Morgen|Vormittag|Nachmittag|Abend)|in\\s+der\\s+Nacht))?(?=\\W|$)","i"),a3=2,uO=3,hO=4,fO=5,ah=class n{pattern(e){return n3}extract(e,t){let r=e.createParsingResult(t.index+t[1].length,t[0].substring(t[1].length));if(r.text.match(/^\d{4}$/)||(r.start=n.extractTimeComponent(r.start.clone(),t),!r.start))return t.index+=t[0].length,null;let s=e.text.substring(t.index+t[0].length),i=i3.exec(s);return i&&(r.end=n.extractTimeComponent(r.start.clone(),i),r.end&&(r.text+=i[0])),r}static extractTimeComponent(e,t){let r=0,s=0,i=null;if(r=parseInt(t[a3]),t[uO]!=null&&(s=parseInt(t[uO])),s>=60||r>24)return null;if(r>=12&&(i=N.PM),t[fO]!=null){if(r>12)return null;let a=t[fO].toLowerCase();a.match(/morgen|vormittag/)&&(i=N.AM,r==12&&(r=0)),a.match(/nachmittag|abend/)&&(i=N.PM,r!=12&&(r+=12)),a.match(/nacht/)&&(r==12?(i=N.AM,r=0):r<6?i=N.AM:(i=N.PM,r+=12))}if(e.assign("hour",r),e.assign("minute",s),i!==null?e.assign("meridiem",i):r<12?e.imply("meridiem",N.AM):e.imply("meridiem",N.PM),t[hO]!=null){let a=parseInt(t[hO]);if(a>=60)return null;e.assign("second",a)}return e}}});var oh,mO=v(()=>{Ys();oh=class extends vt{patternBetween(){return/^\s*(bis(?:\s*(?:am|zum))?|-)\s*$/i}}});var lh,gO=v(()=>{zs();lh=class extends Tt{patternBetween(){return new RegExp("^\\s*(T|um|am|,|-)?\\s*$")}}});var yO,Fo,Mk=v(()=>{yO=ke(Ye(),1);Ue();te();ws();Es();Fo=class n extends B{innerPattern(e){return/(diesen)?\s*(morgen|vormittag|mittags?|nachmittag|abend|nacht|mitternacht)(?=\W|$)/i}innerExtract(e,t){let r=(0,yO.default)(e.refDate),s=t[2].toLowerCase(),i=e.createParsingComponents();return Kn(i,r),n.extractTimeComponents(i,s)}static extractTimeComponents(e,t){switch(t){case"morgen":e.imply("hour",6),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",N.AM);break;case"vormittag":e.imply("hour",9),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",N.AM);break;case"mittag":case"mittags":e.imply("hour",12),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",N.AM);break;case"nachmittag":e.imply("hour",15),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",N.PM);break;case"abend":e.imply("hour",18),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",N.PM);break;case"nacht":e.imply("hour",22),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",N.PM);break;case"mitternacht":e.get("hour")>1&&(e=Pg(e,{day:1})),e.imply("hour",0),e.imply("minute",0),e.imply("second",0),e.imply("meridiem",N.AM);break}return e}}});var vO,o3,l3,c3,ch,TO=v(()=>{vO=ke(Ye(),1);te();ws();Mk();ks();o3=new RegExp("(jetzt|heute|morgen|\xFCbermorgen|uebermorgen|gestern|vorgestern|letzte\\s*nacht)(?:\\s*(morgen|vormittag|mittags?|nachmittag|abend|nacht|mitternacht))?(?=\\W|$)","i"),l3=1,c3=2,ch=class extends B{innerPattern(e){return o3}innerExtract(e,t){let r=(0,vO.default)(e.refDate),s=(t[l3]||"").toLowerCase(),i=(t[c3]||"").toLowerCase(),a=e.createParsingComponents();switch(s){case"jetzt":a=Ar(e.reference);break;case"heute":a=ar(e.reference);break;case"morgen":wn(a,r);break;case"\xFCbermorgen":case"uebermorgen":r=r.add(1,"day"),wn(a,r);break;case"gestern":r=r.add(-1,"day"),ft(a,r),Kn(a,r);break;case"vorgestern":r=r.add(-2,"day"),ft(a,r),Kn(a,r);break;default:s.match(/letzte\s*nacht/)&&(r.hour()>6&&(r=r.add(-1,"day")),ft(a,r),a.imply("hour",0));break}return i&&(a=Fo.extractTimeComponents(a,i)),a}}});var d3,wO,bO,u3,kO,dh,EO=v(()=>{Pt();bc();bc();Re();te();d3=new RegExp(`(?:am\\s*?)?(?:den\\s*?)?([0-9]{1,2})\\.(?:\\s*(?:bis(?:\\s*(?:am|zum))?|\\-|\\\u2013|\\s)\\s*([0-9]{1,2})\\.?)?\\s*(${G(Dk)})(?:(?:-|/|,?\\s*)(${iO}(?![^\\s]\\d)))?(?=\\W|$)`,"i"),wO=1,bO=2,u3=3,kO=4,dh=class extends B{innerPattern(){return d3}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=Dk[t[u3].toLowerCase()],i=parseInt(t[wO]);if(i>31)return t.index=t.index+t[wO].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[kO]){let a=aO(t[kO]);r.start.assign("year",a)}else{let a=Je(e.refDate,i,s);r.start.imply("year",a)}if(t[bO]){let a=parseInt(t[bO]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var uh,SO=v(()=>{bc();Se();te();Es();Re();uh=class extends B{constructor(){super()}innerPattern(){return new RegExp(`(?:\\s*((?:n\xE4chste|kommende|folgende|letzte|vergangene|vorige|vor(?:her|an)gegangene)(?:s|n|m|r)?|vor|in)\\s*)?(${Ck})?(?:\\s*(n\xE4chste|kommende|folgende|letzte|vergangene|vorige|vor(?:her|an)gegangene)(?:s|n|m|r)?)?\\s*(${G(nh)})`,"i")}innerExtract(e,t){let r=t[2]?xk(t[2]):1,s=nh[t[4].toLowerCase()],i={};i[s]=r;let a=t[1]||t[3]||"";if(a=a.toLowerCase(),!!a)return(/vor/.test(a)||/letzte/.test(a)||/vergangen/.test(a))&&(i=Vt(i)),V.createRelativeFromReference(e.reference,i)}}});var hh,DO=v(()=>{bc();Se();te();hh=class extends B{innerPattern(){return new RegExp(`(?:in|f\xFCr|w\xE4hrend)\\s*(${lO})(?=\\W|$)`,"i")}innerExtract(e,t){let r=cO(t[1]);return V.createRelativeFromReference(e.reference,r)}}});var Pk={};nt(Pk,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>_k,createCasualConfiguration:()=>CO,createConfiguration:()=>Ak,parse:()=>f3,parseDate:()=>p3,strict:()=>h3});function f3(n,e,t){return _k.parse(n,e,t)}function p3(n,e,t){return _k.parseDate(n,e,t)}function CO(n=!0){let e=Ak(!1,n);return e.parsers.unshift(new Fo),e.parsers.unshift(new ch),e.parsers.unshift(new uh),e}function Ak(n=!0,e=!0){return kt({parsers:[new Oi,new er(e),new sh,new ah,new dh,new ih,new hh],refiners:[new oh,new lh]},n)}var _k,h3,xO=v(()=>{bs();rs();Se();Ue();Li();Mg();sO();dO();pO();mO();gO();TO();Mk();EO();SO();DO();_k=new fe(CO()),h3=new fe(Ak(!0))});var MO,fh,_O=v(()=>{MO=ke(Ye(),1);Ue();te();ws();ks();fh=class extends B{innerPattern(e){return/(maintenant|aujourd'hui|demain|hier|cette\s*nuit|la\s*veille)(?=\W|$)/i}innerExtract(e,t){let r=(0,MO.default)(e.refDate),s=t[0].toLowerCase(),i=e.createParsingComponents();switch(s){case"maintenant":return Ar(e.reference);case"aujourd'hui":return ar(e.reference);case"hier":return Pr(e.reference);case"demain":return Ir(e.reference);default:s.match(/cette\s*nuit/)?(ft(i,r),i.imply("hour",22),i.imply("meridiem",N.PM)):s.match(/la\s*veille/)&&(r=r.add(-1,"day"),ft(i,r),i.imply("hour",0))}return i}}});var ph,AO=v(()=>{Ue();te();ph=class extends B{innerPattern(e){return/(cet?)?\s*(matin|soir|après-midi|aprem|a midi|à minuit)(?=\W|$)/i}innerExtract(e,t){let r=t[2].toLowerCase(),s=e.createParsingComponents();switch(r){case"apr\xE8s-midi":case"aprem":s.imply("hour",14),s.imply("minute",0),s.imply("meridiem",N.PM);break;case"soir":s.imply("hour",18),s.imply("minute",0),s.imply("meridiem",N.PM);break;case"matin":s.imply("hour",8),s.imply("minute",0),s.imply("meridiem",N.AM);break;case"a midi":s.imply("hour",12),s.imply("minute",0),s.imply("meridiem",N.AM);break;case"\xE0 minuit":s.imply("hour",0),s.imply("meridiem",N.AM);break}return s}}});var mh,PO=v(()=>{Ri();mh=class extends ir{primaryPrefix(){return"(?:(?:[\xE0a])\\s*)?"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|[\xE0a]|\\?)\\s*"}extractPrimaryTimeComponents(e,t){return t[0].match(/^\s*\d{4}\s*$/)?null:super.extractPrimaryTimeComponents(e,t)}}});var gh,IO=v(()=>{zs();gh=class extends Tt{patternBetween(){return new RegExp("^\\s*(T|\xE0|a|au|vers|de|,|-)?\\s*$")}}});var yh,RO=v(()=>{Ys();yh=class extends vt{patternBetween(){return/^\s*(à|a|au|-)\s*$/i}}});function Lk(n){let e=n.toLowerCase();return Ik[e]!==void 0?Ik[e]:e==="une"||e==="un"?1:e.match(/quelques?/)?3:e.match(/demi-?/)?.5:parseFloat(e)}function Bk(n){let e=n.toLowerCase();return e=e.replace(/(?:er)$/i,""),parseInt(e)}function LO(n){if(/AC/i.test(n))return n=n.replace(/BC/i,""),-parseInt(n);if(/AD/i.test(n)||/C/i.test(n))return n=n.replace(/[^\d]+/i,""),parseInt(n);let e=parseInt(n);return e<100&&(e>50?e=e+1900:e=e+2e3),e}function Og(n){let e={},t=n,r=NO.exec(t);for(;r;)m3(e,r),t=t.substring(r[0].length),r=NO.exec(t);return e}function m3(n,e){let t=Lk(e[1]),r=vh[e[2].toLowerCase()];n[r]=t}var Rk,Nk,Ik,vh,Ok,Fk,OO,FO,NO,Ng,Ma=v(()=>{Re();Rk={dimanche:0,dim:0,lundi:1,lun:1,mardi:2,mar:2,mercredi:3,mer:3,jeudi:4,jeu:4,vendredi:5,ven:5,samedi:6,sam:6},Nk={janvier:1,jan:1,"jan.":1,f\u00E9vrier:2,f\u00E9v:2,"f\xE9v.":2,fevrier:2,fev:2,"fev.":2,mars:3,mar:3,"mar.":3,avril:4,avr:4,"avr.":4,mai:5,juin:6,jun:6,juillet:7,juil:7,jul:7,"jul.":7,ao\u00FBt:8,aout:8,septembre:9,sep:9,"sep.":9,sept:9,"sept.":9,octobre:10,oct:10,"oct.":10,novembre:11,nov:11,"nov.":11,d\u00E9cembre:12,decembre:12,dec:12,"dec.":12},Ik={un:1,deux:2,trois:3,quatre:4,cinq:5,six:6,sept:7,huit:8,neuf:9,dix:10,onze:11,douze:12,treize:13},vh={sec:"second",seconde:"second",secondes:"second",min:"minute",mins:"minute",minute:"minute",minutes:"minute",h:"hour",hr:"hour",hrs:"hour",heure:"hour",heures:"hour",jour:"d",jours:"d",semaine:"week",semaines:"week",mois:"month",trimestre:"quarter",trimestres:"quarter",ans:"year",ann\u00E9e:"year",ann\u00E9es:"year"},Ok=`(?:${G(Ik)}|[0-9]+|[0-9]+\\.[0-9]+|une?\\b|quelques?|demi-?)`;Fk="(?:[0-9]{1,2}(?:er)?)";OO="(?:[1-9][0-9]{0,3}\\s*(?:AC|AD|p\\.\\s*C(?:hr?)?\\.\\s*n\\.)|[1-2][0-9]{3}|[5-9][0-9])";FO=`(${Ok})\\s{0,5}(${G(vh)})\\s{0,5}`,NO=new RegExp(FO,"i"),Ng=Hr("",FO)});var g3,y3,v3,Th,BO=v(()=>{Ma();Re();te();kn();g3=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:(?:ce)\\s*)?(${G(Rk)})(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(dernier|prochain)\\s*)?(?=\\W|\\d|$)`,"i"),y3=1,v3=2,Th=class extends B{innerPattern(){return g3}innerExtract(e,t){let r=t[y3].toLowerCase(),s=Rk[r];if(s===void 0)return null;let i=t[v3];i=i||"",i=i.toLowerCase();let a=null;return i=="dernier"?a="last":i=="prochain"&&(a="next"),Yt(e.reference,s,a)}}});var T3,w3,b3,HO,UO,WO,wh,$O=v(()=>{Ue();T3=new RegExp("(^|\\s|T)(?:(?:[\xE0a])\\s*)?(\\d{1,2})(?:h|:)?(?:(\\d{1,2})(?:m|:)?)?(?:(\\d{1,2})(?:s|:)?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?(?=\\W|$)","i"),w3=new RegExp("^\\s*(\\-|\\\u2013|\\~|\\\u301C|[\xE0a]|\\?)\\s*(\\d{1,2})(?:h|:)?(?:(\\d{1,2})(?:m|:)?)?(?:(\\d{1,2})(?:s|:)?)?(?:\\s*(A\\.M\\.|P\\.M\\.|AM?|PM?))?(?=\\W|$)","i"),b3=2,HO=3,UO=4,WO=5,wh=class n{pattern(e){return T3}extract(e,t){let r=e.createParsingResult(t.index+t[1].length,t[0].substring(t[1].length));if(r.text.match(/^\d{4}$/)||(r.start=n.extractTimeComponent(r.start.clone(),t),!r.start))return t.index+=t[0].length,null;let s=e.text.substring(t.index+t[0].length),i=w3.exec(s);return i&&(r.end=n.extractTimeComponent(r.start.clone(),i),r.end&&(r.text+=i[0])),r}static extractTimeComponent(e,t){let r=0,s=0,i=null;if(r=parseInt(t[b3]),t[HO]!=null&&(s=parseInt(t[HO])),s>=60||r>24)return null;if(r>=12&&(i=N.PM),t[WO]!=null){if(r>12)return null;let a=t[WO][0].toLowerCase();a=="a"&&(i=N.AM,r==12&&(r=0)),a=="p"&&(i=N.PM,r!=12&&(r+=12))}if(e.assign("hour",r),e.assign("minute",s),i!==null?e.assign("meridiem",i):r<12?e.imply("meridiem",N.AM):e.imply("meridiem",N.PM),t[UO]!=null){let a=parseInt(t[UO]);if(a>=60)return null;e.assign("second",a)}return e}}});var k3,jO,VO,E3,YO,bh,zO=v(()=>{Pt();Ma();Ma();Ma();Re();te();k3=new RegExp(`(?:on\\s*?)?(${Fk})(?:\\s*(?:au|\\-|\\\u2013|jusqu'au?|\\s)\\s*(${Fk}))?(?:-|/|\\s*(?:de)?\\s*)(${G(Nk)})(?:(?:-|/|,?\\s*)(${OO}(?![^\\s]\\d)))?(?=\\W|$)`,"i"),jO=1,VO=2,E3=3,YO=4,bh=class extends B{innerPattern(){return k3}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=Nk[t[E3].toLowerCase()],i=Bk(t[jO]);if(i>31)return t.index=t.index+t[jO].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[YO]){let a=LO(t[YO]);r.start.assign("year",a)}else{let a=Je(e.refDate,i,s);r.start.imply("year",a)}if(t[VO]){let a=Bk(t[VO]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var kh,qO=v(()=>{Ma();Se();te();Es();kh=class extends B{constructor(){super()}innerPattern(){return new RegExp(`il y a\\s*(${Ng})(?=(?:\\W|$))`,"i")}innerExtract(e,t){let r=Og(t[1]),s=Vt(r);return V.createRelativeFromReference(e.reference,s)}}});var Eh,GO=v(()=>{Ma();Se();te();Eh=class extends B{innerPattern(){return new RegExp(`(?:dans|en|pour|pendant|de)\\s*(${Ng})(?=\\W|$)`,"i")}innerExtract(e,t){let r=Og(t[1]);return V.createRelativeFromReference(e.reference,r)}}});var Sh,QO=v(()=>{Ma();Se();te();Es();Re();Sh=class extends B{constructor(){super()}innerPattern(){return new RegExp(`(?:les?|la|l'|du|des?)\\s*(${Ok})?(?:\\s*(prochaine?s?|derni[e\xE8]re?s?|pass[\xE9e]e?s?|pr[\xE9e]c[\xE9e]dents?|suivante?s?))?\\s*(${G(vh)})(?:\\s*(prochaine?s?|derni[e\xE8]re?s?|pass[\xE9e]e?s?|pr[\xE9e]c[\xE9e]dents?|suivante?s?))?`,"i")}innerExtract(e,t){let r=t[1]?Lk(t[1]):1,s=vh[t[3].toLowerCase()],i={};i[s]=r;let a=t[2]||t[4]||"";if(a=a.toLowerCase(),!!a)return(/derni[eè]re?s?/.test(a)||/pass[ée]e?s?/.test(a)||/pr[ée]c[ée]dents?/.test(a))&&(i=Vt(i)),V.createRelativeFromReference(e.reference,i)}}});var Wk={};nt(Wk,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>Hk,createCasualConfiguration:()=>KO,createConfiguration:()=>Uk,parse:()=>D3,parseDate:()=>C3,strict:()=>S3});function D3(n,e,t){return Hk.parse(n,e,t)}function C3(n,e,t){return Hk.parseDate(n,e,t)}function KO(n=!0){let e=Uk(!1,n);return e.parsers.unshift(new fh),e.parsers.unshift(new ph),e.parsers.unshift(new Sh),e}function Uk(n=!0,e=!0){return kt({parsers:[new er(e),new bh,new mh,new wh,new kh,new Eh,new Th],refiners:[new gh,new yh]},n)}var Hk,S3,ZO=v(()=>{bs();rs();Se();Ue();_O();AO();Li();PO();IO();RO();BO();$O();zO();qO();GO();QO();Hk=new fe(KO()),S3=new fe(Uk(!0))});function Ur(n){return String(n).replace(/\u2019/g,"'").replace(/\u201D/g,'"').replace(/\u3000/g," ").replace(/\uFFE5/g,"\xA5").replace(/[\uFF01\uFF03-\uFF06\uFF08\uFF09\uFF0C-\uFF19\uFF1C-\uFF1F\uFF21-\uFF3B\uFF3D\uFF3F\uFF41-\uFF5B\uFF5D\uFF5E]/g,x3)}function x3(n){return String.fromCharCode(n.charCodeAt(0)-65248)}function Bo(n){let e=0;for(let t=0;t<n.length;t++){let r=n[t];r==="\u5341"?e=e===0?Jn[r]:e*Jn[r]:e+=Jn[r]}return e}var Jn,kc,Ec=v(()=>{Jn={\u96F6:0,"\u3007":0,\u4E00:1,\u4E8C:2,\u4E09:3,\u56DB:4,\u4E94:5,\u516D:6,\u4E03:7,\u516B:8,\u4E5D:9,\u5341:10},kc={\u65E5:0,\u6708:1,\u706B:2,\u6C34:3,\u6728:4,\u91D1:5,\u571F:6}});var XO,M3,JO,_3,$k,A3,P3,I3,Dh,e1=v(()=>{Ec();Pt();XO=ke(Ye(),1),M3=/(?:(?:([同今本])|((昭和|平成|令和)?([0-9０-９]{1,4}|元)))年\s*)?([0-9０-９]{1,2})月\s*([0-9０-９]{1,2})日/i,JO=1,_3=2,$k=3,A3=4,P3=5,I3=6,Dh=class{pattern(){return M3}extract(e,t){let r=parseInt(Ur(t[P3])),s=parseInt(Ur(t[I3])),i=e.createParsingComponents({day:s,month:r});if(t[JO]&&t[JO].match("\u540C|\u4ECA|\u672C")){let a=(0,XO.default)(e.refDate);i.assign("year",a.year())}if(t[_3]){let a=t[A3],o=a=="\u5143"?1:parseInt(Ur(a));t[$k]=="\u4EE4\u548C"?o+=2018:t[$k]=="\u5E73\u6210"?o+=1988:t[$k]=="\u662D\u548C"&&(o+=1925),i.assign("year",o)}else{let a=Je(e.refDate,s,r);i.imply("year",a)}return i}}});var Ch,t1=v(()=>{Ys();Ch=class extends vt{patternBetween(){return/^\s*(から|－|ー|-|～|~)\s*$/i}}});function N3(n){switch(n){case"\u304D\u3087\u3046":return"\u4ECA\u65E5";case"\u307B\u3093\u3058\u3064":return"\u672C\u65E5";case"\u304D\u306E\u3046":return"\u6628\u65E5";case"\u3042\u3057\u305F":return"\u660E\u65E5";case"\u3053\u3093\u3084":return"\u4ECA\u591C";case"\u3053\u3093\u3086\u3046":return"\u4ECA\u5915";case"\u3053\u3093\u3070\u3093":return"\u4ECA\u6669";case"\u3051\u3055":return"\u4ECA\u671D";default:return n}}var r1,R3,xh,s1=v(()=>{r1=ke(Ye(),1);Ue();ks();R3=/今日|きょう|本日|ほんじつ|昨日|きのう|明日|あした|今夜|こんや|今夕|こんゆう|今晩|こんばん|今朝|けさ/i;xh=class{pattern(){return R3}extract(e,t){let r=N3(t[0]),s=(0,r1.default)(e.refDate),i=e.createParsingComponents();switch(r){case"\u6628\u65E5":return Pr(e.reference);case"\u660E\u65E5":return Ir(e.reference);case"\u672C\u65E5":case"\u4ECA\u65E5":return ar(e.reference)}return r=="\u4ECA\u591C"||r=="\u4ECA\u5915"||r=="\u4ECA\u6669"?(i.imply("hour",22),i.assign("meridiem",N.PM)):r.match("\u4ECA\u671D")&&(i.imply("hour",6),i.assign("meridiem",N.AM)),i.assign("day",s.date()),i.assign("month",s.month()+1),i.assign("year",s.year()),i}}});var O3,Mh,n1=v(()=>{Ec();kn();O3=new RegExp("((?<prefix>\u524D\u306E|\u6B21\u306E|\u4ECA\u9031))?(?<weekday>"+Object.keys(kc).join("|")+")(?:\u66DC\u65E5|\u66DC)","i"),Mh=class{pattern(){return O3}extract(e,t){let r=t.groups.weekday,s=kc[r];if(s===void 0)return null;let i=t.groups.prefix||"",a=null;return i.match(/前の/)?a="last":i.match(/次の/)?a="next":i.match(/今週/)&&(a="this"),Yt(e.reference,s,a)}}});var L3,i1,F3,B3,_h,a1=v(()=>{Pt();Ec();L3=new RegExp("([0-9\uFF10-\uFF19]{4}[\\/|\\\uFF0F])?([0-1\uFF10-\uFF11]{0,1}[0-9\uFF10-\uFF19]{1})(?:[\\/|\\\uFF0F]([0-3\uFF10-\uFF13]{0,1}[0-9\uFF10-\uFF19]{1}))","i"),i1=1,F3=2,B3=3,_h=class{pattern(){return L3}extract(e,t){let r=e.createParsingComponents(),s=parseInt(Ur(t[F3])),i=parseInt(Ur(t[B3]));if(s<1||s>12||i<1||i>31)return null;if(r.assign("day",i),r.assign("month",s),t[i1]){let a=parseInt(Ur(t[i1])),o=es(a);r.assign("year",o)}else{let a=Je(e.reference.instant,i,s);r.imply("year",a)}return r}}});var H3,U3,Lg,Fg,_a,Sc,Bg,Ah,o1=v(()=>{te();Ue();Ec();H3=new RegExp("(?:(\u5348\u524D|\u5348\u5F8C|A.M.|P.M.|AM|PM))?(?:[\\s,\uFF0C\u3001]*)(?:([0-9\uFF10-\uFF19]+|["+Object.keys(Jn).join("")+"]+)(?:\\s*)(?:\u6642|:|\uFF1A)(?:\\s*)([0-9\uFF10-\uFF19]+|\u534A|["+Object.keys(Jn).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)([0-9\uFF10-\uFF19]+|["+Object.keys(Jn).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),U3=new RegExp("(?:^\\s*(?:\u304B\u3089|\\-|\\\u2013|\\\uFF0D|\\~|\\\u301C)\\s*)(?:(\u5348\u524D|\u5348\u5F8C|A.M.|P.M.|AM|PM))?(?:[\\s,\uFF0C\u3001]*)(?:([0-9\uFF10-\uFF19]+|["+Object.keys(Jn).join("")+"]+)(?:\\s*)(?:\u6642|:|\uFF1A)(?:\\s*)([0-9\uFF10-\uFF19]+|\u534A|["+Object.keys(Jn).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)([0-9\uFF10-\uFF19]+|["+Object.keys(Jn).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),Lg=1,Fg=2,_a=3,Sc=4,Bg=5,Ah=class extends B{innerPattern(){return H3}innerExtract(e,t){if(t.index>0&&e.text[t.index-1].match(/\w/))return null;let r=e.createParsingResult(t.index,t[0]),s=0,i=0,a=-1;if(t[Sc]){let o=parseInt(Ur(t[Sc]));if(isNaN(o)&&(o=Bo(t[Sc])),o>=60)return null;r.start.assign("second",o)}if(s=parseInt(Ur(t[Fg])),isNaN(s)&&(s=Bo(t[Fg])),t[_a]?t[_a]==="\u534A"?i=30:(i=parseInt(Ur(t[_a])),isNaN(i)&&(i=Bo(t[_a]))):s>100&&(i=s%100,s=Math.floor(s/100)),i>=60||s>24)return null;if(s>=12&&(a=N.PM),t[Lg]){if(s>12)return null;let o=t[Lg],l=o[0].toLowerCase();o==="\u5348\u524D"||l==="a"?(a=N.AM,s===12&&(s=0)):(o==="\u5348\u5F8C"||l==="p")&&(a=N.PM,s!=12&&(s+=12))}else if(t[Bg]){if(s>12)return null;let o=t[Bg][0].toLowerCase();o==="a"&&(a=N.AM,s===12&&(s=0)),o==="p"&&(a=N.PM,s!=12&&(s+=12))}if(r.start.assign("hour",s),r.start.assign("minute",i),a>=0?r.start.assign("meridiem",a):s<12?r.start.imply("meridiem",0):r.start.imply("meridiem",1),t=U3.exec(e.text.substring(r.index+r.text.length)),!t)return r.text.match(/^\d+$/)?null:r;if(r.end=e.createParsingComponents(),s=0,i=0,a=-1,t[Sc]){let o=parseInt(Ur(t[Sc]));if(isNaN(o)&&(o=Bo(t[Sc])),o>=60)return null;r.end.assign("second",o)}if(s=parseInt(Ur(t[Fg])),isNaN(s)&&(s=Bo(t[Fg])),t[_a]?t[_a]==="\u534A"?i=30:(i=parseInt(Ur(t[_a])),isNaN(i)&&(i=Bo(t[_a]))):s>100&&(i=s%100,s=Math.floor(s/100)),i>=60||s>24)return null;if(s>=12&&(a=N.PM),t[Lg]){if(s>12)return null;let o=t[Lg],l=o[0].toLowerCase();o==="\u5348\u524D"||l==="a"?(a=N.AM,s===12&&(s=0)):(o==="\u5348\u5F8C"||l==="p")&&(a=N.PM,s!=12&&(s+=12)),r.start.isCertain("meridiem")||(a===N.AM?(r.start.imply("meridiem",N.AM),r.start.get("hour")===12&&r.start.assign("hour",0)):(r.start.imply("meridiem",1),r.start.get("hour")!=12&&r.start.assign("hour",r.start.get("hour")+12)))}else if(t[Bg]){if(s>12)return null;let o=t[Bg][0].toLowerCase();o==="a"&&(a=N.AM,s===12&&(s=0)),o==="p"&&(a=N.PM,s!=12&&(s+=12))}return r.text=r.text+t[0],r.end.assign("hour",s),r.end.assign("minute",i),a>=0?r.end.assign("meridiem",a):r.start.isCertain("meridiem")&&r.start.get("hour")>12?r.start.get("hour")-12>s?r.end.imply("meridiem",N.AM):s<=12&&(r.end.assign("hour",s+12),r.end.assign("meridiem",N.PM)):s>12?r.end.imply("meridiem",N.PM):s<=12&&r.end.imply("meridiem",N.AM),r.end.date().getTime()<r.start.date().getTime()&&r.end.imply("day",r.end.get("day")+1),r}}});var Ph,l1=v(()=>{zs();Ph=class extends Tt{patternBetween(){return/^\s*(の)?\s*$/i}}});var Ih,c1=v(()=>{Ni();Ih=class extends ts{mergeResults(e,t,r){let s=t.clone();return s.text=t.text+e+r.text,s.start.assign("weekday",r.start.get("weekday")),s.end&&s.end.assign("weekday",r.start.get("weekday")),s}shouldMergeResults(e,t,r){return t.start.isCertain("day")&&r.start.isOnlyWeekdayComponent()&&!r.start.isCertain("hour")&&e.match(/^[,、の]?\s*$/)!==null}}});var W3,Rh,d1=v(()=>{Ec();kn();W3=new RegExp("(?:\\(|\\\uFF08)(?<weekday>"+Object.keys(kc).join("|")+")(?:\\)|\\\uFF09)","i"),Rh=class{pattern(){return W3}extract(e,t){let r=t.groups.weekday,s=kc[r];return s===void 0?null:Yt(e.reference,s)}}});var Yk={};nt(Yk,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>jk,createCasualConfiguration:()=>u1,createConfiguration:()=>Vk,parse:()=>j3,parseDate:()=>V3,strict:()=>$3});function j3(n,e,t){return jk.parse(n,e,t)}function V3(n,e,t){return jk.parseDate(n,e,t)}function u1(){let n=Vk(!1);return n.parsers.unshift(new xh),n}function Vk(n=!0){let e=kt({parsers:[new Dh,new Mh,new Rh,new _h,new Ah],refiners:[new Ih,new Ph,new Ch]},n);return e.refiners=e.refiners.filter(t=>!(t instanceof Ro)),e}var jk,$3,h1=v(()=>{e1();t1();s1();n1();a1();o1();l1();rs();Se();Ue();c1();d1();bs();vk();jk=new fe(u1()),$3=new fe(Vk(!0))});function p1(n){if(n.match(/^[0-9]{1,4}$/)){let e=parseInt(n);return e<100&&(e>50?e=e+1900:e=e+2e3),e}return n.match(/a\.?\s*c\.?/i)?(n=n.replace(/a\.?\s*c\.?/i,""),-parseInt(n)):parseInt(n)}var zk,qk,f1,Hg=v(()=>{zk={domingo:0,dom:0,segunda:1,"segunda-feira":1,seg:1,ter\u00E7a:2,"ter\xE7a-feira":2,ter:2,quarta:3,"quarta-feira":3,qua:3,quinta:4,"quinta-feira":4,qui:4,sexta:5,"sexta-feira":5,sex:5,s\u00E1bado:6,sabado:6,sab:6},qk={janeiro:1,jan:1,"jan.":1,fevereiro:2,fev:2,"fev.":2,mar\u00E7o:3,mar:3,"mar.":3,abril:4,abr:4,"abr.":4,maio:5,mai:5,"mai.":5,junho:6,jun:6,"jun.":6,julho:7,jul:7,"jul.":7,agosto:8,ago:8,"ago.":8,setembro:9,set:9,"set.":9,outubro:10,out:10,"out.":10,novembro:11,nov:11,"nov.":11,dezembro:12,dez:12,"dez.":12},f1="[0-9]{1,4}(?![^\\s]\\d)(?:\\s*[a|d]\\.?\\s*c\\.?|\\s*a\\.?\\s*d\\.?)?"});var Y3,z3,q3,G3,Nh,m1=v(()=>{Hg();Re();te();kn();Y3=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:(este|esta|passado|pr[o\xF3]ximo)\\s*)?(${G(zk)})(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(este|esta|passado|pr[\xF3o]ximo)\\s*semana)?(?=\\W|\\d|$)`,"i"),z3=1,q3=2,G3=3,Nh=class extends B{innerPattern(){return Y3}innerExtract(e,t){let r=t[q3].toLowerCase(),s=zk[r];if(s===void 0)return null;let i=t[z3],a=t[G3],o=i||a||"";o=o.toLowerCase();let l=null;return o=="passado"?l="this":o=="pr\xF3ximo"||o=="proximo"?l="next":o=="este"&&(l="this"),Yt(e.reference,s,l)}}});var Oh,g1=v(()=>{Ri();Oh=class extends ir{primaryPrefix(){return"(?:(?:ao?|\xE0s?|das|da|de|do)\\s*)?"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|a(?:o)?|\\?)\\s*"}}});var Lh,y1=v(()=>{zs();Lh=class extends Tt{patternBetween(){return new RegExp("^\\s*(?:,|\xE0)?\\s*$")}}});var Fh,v1=v(()=>{Ys();Fh=class extends vt{patternBetween(){return/^\s*(?:-)\s*$/i}}});var Q3,T1,w1,K3,b1,Bh,k1=v(()=>{Pt();Hg();Hg();Re();te();Q3=new RegExp(`([0-9]{1,2})(?:\xBA|\xAA|\xB0)?(?:\\s*(?:desde|de|\\-|\\\u2013|ao?|\\s)\\s*([0-9]{1,2})(?:\xBA|\xAA|\xB0)?)?\\s*(?:de)?\\s*(?:-|/|\\s*(?:de|,)?\\s*)(${G(qk)})(?:\\s*(?:de|,)?\\s*(${f1}))?(?=\\W|$)`,"i"),T1=1,w1=2,K3=3,b1=4,Bh=class extends B{innerPattern(){return Q3}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=qk[t[K3].toLowerCase()],i=parseInt(t[T1]);if(i>31)return t.index=t.index+t[T1].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[b1]){let a=p1(t[b1]);r.start.assign("year",a)}else{let a=Je(e.refDate,i,s);r.start.imply("year",a)}if(t[w1]){let a=parseInt(t[w1]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var Hh,E1=v(()=>{te();ks();Hh=class extends B{innerPattern(e){return/(agora|hoje|amanha|amanhã|ontem)(?=\W|$)/i}innerExtract(e,t){let r=t[0].toLowerCase(),s=e.createParsingComponents();switch(r){case"agora":return Ar(e.reference);case"hoje":return ar(e.reference);case"amanha":case"amanh\xE3":return Ir(e.reference);case"ontem":return Pr(e.reference)}return s}}});var S1,Uh,D1=v(()=>{Ue();te();ws();S1=ke(Ye(),1),Uh=class extends B{innerPattern(){return/(?:esta\s*)?(manha|manhã|tarde|meia-noite|meio-dia|noite)(?=\W|$)/i}innerExtract(e,t){let r=(0,S1.default)(e.refDate),s=e.createParsingComponents();switch(t[1].toLowerCase()){case"tarde":s.imply("meridiem",N.PM),s.imply("hour",15);break;case"noite":s.imply("meridiem",N.PM),s.imply("hour",22);break;case"manha":case"manh\xE3":s.imply("meridiem",N.AM),s.imply("hour",6);break;case"meia-noite":wn(s,r),s.imply("hour",0),s.imply("minute",0),s.imply("second",0);break;case"meio-dia":s.imply("meridiem",N.AM),s.imply("hour",12);break}return s}}});var Kk={};nt(Kk,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>Gk,createCasualConfiguration:()=>C1,createConfiguration:()=>Qk,parse:()=>J3,parseDate:()=>X3,strict:()=>Z3});function J3(n,e,t){return Gk.parse(n,e,t)}function X3(n,e,t){return Gk.parseDate(n,e,t)}function C1(n=!0){let e=Qk(!1,n);return e.parsers.push(new Hh),e.parsers.push(new Uh),e}function Qk(n=!0,e=!0){return kt({parsers:[new er(e),new Nh,new Oh,new Bh],refiners:[new Lh,new Fh]},n)}var Gk,Z3,x1=v(()=>{bs();rs();Se();Ue();Li();m1();g1();y1();v1();k1();E1();D1();Gk=new fe(C1()),Z3=new fe(Qk(!0))});var Wh,M1=v(()=>{Ys();Wh=class extends vt{patternBetween(){return/^\s*(tot|-)\s*$/i}}});var $h,_1=v(()=>{zs();$h=class extends Tt{patternBetween(){return new RegExp("^\\s*(om|na|voor|in de|,|-)?\\s*$")}}});var jh,A1=v(()=>{te();ks();jh=class extends B{innerPattern(e){return/(nu|vandaag|morgen|morgend|gisteren)(?=\W|$)/i}innerExtract(e,t){let r=t[0].toLowerCase(),s=e.createParsingComponents();switch(r){case"nu":return Ar(e.reference);case"vandaag":return ar(e.reference);case"morgen":case"morgend":return Ir(e.reference);case"gisteren":return Pr(e.reference)}return s}}});var P1,eq,tq,Vh,I1=v(()=>{Ue();te();P1=ke(Ye(),1);ws();eq=1,tq=2,Vh=class extends B{innerPattern(){return/(deze)?\s*(namiddag|avond|middernacht|ochtend|middag|'s middags|'s avonds|'s ochtends)(?=\W|$)/i}innerExtract(e,t){let r=(0,P1.default)(e.refDate),s=e.createParsingComponents();switch(t[eq]==="deze"&&(s.assign("day",e.refDate.getDate()),s.assign("month",e.refDate.getMonth()+1),s.assign("year",e.refDate.getFullYear())),t[tq].toLowerCase()){case"namiddag":case"'s namiddags":s.imply("meridiem",N.PM),s.imply("hour",15);break;case"avond":case"'s avonds'":s.imply("meridiem",N.PM),s.imply("hour",20);break;case"middernacht":wn(s,r),s.imply("hour",0),s.imply("minute",0),s.imply("second",0);break;case"ochtend":case"'s ochtends":s.imply("meridiem",N.AM),s.imply("hour",6);break;case"middag":case"'s middags":s.imply("meridiem",N.AM),s.imply("hour",12);break}return s}}});function sq(n){let e=n.toLowerCase();return Zk[e]!==void 0?Zk[e]:e==="paar"?2:e==="half"||e.match(/halve?/)?.5:parseFloat(e.replace(",","."))}function tE(n){let e=n.toLowerCase();return Jk[e]!==void 0?Jk[e]:(e=e.replace(/(?:ste|de)$/i,""),parseInt(e))}function Wg(n){if(/voor Christus/i.test(n))return n=n.replace(/voor Christus/i,""),-parseInt(n);if(/na Christus/i.test(n))return n=n.replace(/na Christus/i,""),parseInt(n);let e=parseInt(n);return es(e)}function Aa(n){let e={},t=n,r=R1.exec(t);for(;r;)nq(e,r),t=t.substring(r[0].length),r=R1.exec(t);return e}function nq(n,e){let t=sq(e[1]),r=Yh[e[2].toLowerCase()];n[r]=t}var Xk,Fi,Zk,Jk,Yh,rq,eE,Ug,N1,R1,Xn,Ss=v(()=>{Re();Pt();Xk={zondag:0,zon:0,"zon.":0,zo:0,"zo.":0,maandag:1,ma:1,"ma.":1,dinsdag:2,din:2,"din.":2,di:2,"di.":2,woensdag:3,woe:3,"woe.":3,wo:3,"wo.":3,donderdag:4,dond:4,"dond.":4,do:4,"do.":4,vrijdag:5,vrij:5,"vrij.":5,vr:5,"vr.":5,zaterdag:6,zat:6,"zat.":6,za:6,"za.":6},Fi={januari:1,jan:1,"jan.":1,februari:2,feb:2,"feb.":2,maart:3,mar:3,"mar.":3,mrt:3,"mrt.":3,april:4,apr:4,"apr.":4,mei:5,juni:6,jun:6,"jun.":6,juli:7,jul:7,"jul.":7,augustus:8,aug:8,"aug.":8,september:9,sep:9,"sep.":9,sept:9,"sept.":9,oktober:10,okt:10,"okt.":10,november:11,nov:11,"nov.":11,december:12,dec:12,"dec.":12},Zk={een:1,twee:2,drie:3,vier:4,vijf:5,zes:6,zeven:7,acht:8,negen:9,tien:10,elf:11,twaalf:12},Jk={eerste:1,tweede:2,derde:3,vierde:4,vijfde:5,zesde:6,zevende:7,achtste:8,negende:9,tiende:10,elfde:11,twaalfde:12,dertiende:13,veertiende:14,vijftiende:15,zestiende:16,zeventiende:17,achttiende:18,negentiende:19,twintigste:20,eenentwintigste:21,twee\u00EBntwintigste:22,drieentwintigste:23,vierentwintigste:24,vijfentwintigste:25,zesentwintigste:26,zevenentwintigste:27,achtentwintig:28,negenentwintig:29,dertigste:30,eenendertigste:31},Yh={sec:"second",second:"second",seconden:"second",min:"minute",mins:"minute",minute:"minute",minuut:"minute",minuten:"minute",minuutje:"minute",h:"hour",hr:"hour",hrs:"hour",uur:"hour",u:"hour",uren:"hour",dag:"d",dagen:"d",week:"week",weken:"week",maand:"month",maanden:"month",jaar:"year",jr:"year",jaren:"year"},rq=`(?:${G(Zk)}|[0-9]+|[0-9]+[\\.,][0-9]+|halve?|half|paar)`;eE=`(?:${G(Jk)}|[0-9]{1,2}(?:ste|de)?)`;Ug="(?:[1-9][0-9]{0,3}\\s*(?:voor Christus|na Christus)|[1-2][0-9]{3}|[5-9][0-9])";N1=`(${rq})\\s{0,5}(${G(Yh)})\\s{0,5}`,R1=new RegExp(N1,"i"),Xn=Hr("(?:(?:binnen|in)\\s*)?",N1)});var zh,O1=v(()=>{Ss();Se();te();zh=class extends B{innerPattern(){return new RegExp("(?:binnen|in|binnen de|voor)\\s*("+Xn+")(?=\\W|$)","i")}innerExtract(e,t){let r=Aa(t[1]);return V.createRelativeFromReference(e.reference,r)}}});var iq,aq,oq,lq,qh,L1=v(()=>{Ss();Re();te();kn();iq=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:op\\s*?)?(?:(deze|vorige|volgende)\\s*(?:week\\s*)?)?(${G(Xk)})(?=\\W|$)`,"i"),aq=1,oq=2,lq=3,qh=class extends B{innerPattern(){return iq}innerExtract(e,t){let r=t[oq].toLowerCase(),s=Xk[r],i=t[aq],a=t[lq],o=i||a;o=o||"",o=o.toLowerCase();let l=null;return o=="vorige"?l="last":o=="volgende"?l="next":o=="deze"&&(l="this"),Yt(e.reference,s,l)}}});var cq,dq,F1,B1,H1,Gh,U1=v(()=>{Pt();Ss();Ss();Ss();Re();te();cq=new RegExp(`(?:on\\s*?)?(${eE})(?:\\s*(?:tot|\\-|\\\u2013|until|through|till|\\s)\\s*(${eE}))?(?:-|/|\\s*(?:of)?\\s*)(`+G(Fi)+`)(?:(?:-|/|,?\\s*)(${Ug}(?![^\\s]\\d)))?(?=\\W|$)`,"i"),dq=3,F1=1,B1=2,H1=4,Gh=class extends B{innerPattern(){return cq}innerExtract(e,t){let r=Fi[t[dq].toLowerCase()],s=tE(t[F1]);if(s>31)return t.index=t.index+t[F1].length,null;let i=e.createParsingComponents({day:s,month:r});if(t[H1]){let l=Wg(t[H1]);i.assign("year",l)}else{let l=Je(e.refDate,s,r);i.imply("year",l)}if(!t[B1])return i;let a=tE(t[B1]),o=e.createParsingResult(t.index,t[0]);return o.start=i,o.end=i.clone(),o.end.assign("day",a),o}}});var uq,hq,W1,Dc,$1=v(()=>{Ss();Pt();Re();Ss();te();uq=new RegExp(`(${G(Fi)})\\s*(?:[,-]?\\s*(${Ug})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`,"i"),hq=1,W1=2,Dc=class extends B{innerPattern(){return uq}innerExtract(e,t){let r=e.createParsingComponents();r.imply("day",1);let s=t[hq],i=Fi[s.toLowerCase()];if(r.assign("month",i),t[W1]){let a=Wg(t[W1]);r.assign("year",a)}else{let a=Je(e.refDate,1,i);r.imply("year",a)}return r}}});var fq,pq,mq,Qh,j1=v(()=>{te();fq=new RegExp("([0-9]|0[1-9]|1[012])/([0-9]{4})","i"),pq=1,mq=2,Qh=class extends B{innerPattern(){return fq}innerExtract(e,t){let r=parseInt(t[mq]),s=parseInt(t[pq]);return e.createParsingComponents().imply("day",1).assign("month",s).assign("year",r)}}});var Kh,V1=v(()=>{Ri();Kh=class extends ir{primaryPrefix(){return"(?:(?:om)\\s*)?"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|om|\\?)\\s*"}primarySuffix(){return"(?:\\s*(?:uur))?(?!/)(?=\\W|$)"}extractPrimaryTimeComponents(e,t){return t[0].match(/^\s*\d{4}\s*$/)?null:super.extractPrimaryTimeComponents(e,t)}}});var gq,yq,vq,Y1,Tq,Zh,z1=v(()=>{Ss();Re();te();gq=new RegExp(`([0-9]{4})[\\.\\/\\s](?:(${G(Fi)})|([0-9]{1,2}))[\\.\\/\\s]([0-9]{1,2})(?=\\W|$)`,"i"),yq=1,vq=2,Y1=3,Tq=4,Zh=class extends B{innerPattern(){return gq}innerExtract(e,t){let r=t[Y1]?parseInt(t[Y1]):Fi[t[vq].toLowerCase()];if(r<1||r>12)return null;let s=parseInt(t[yq]);return{day:parseInt(t[Tq]),month:r,year:s}}}});var q1,wq,bq,Jh,G1=v(()=>{te();Ue();ws();q1=ke(Ye(),1),wq=1,bq=2,Jh=class extends B{innerPattern(e){return/(gisteren|morgen|van)(ochtend|middag|namiddag|avond|nacht)(?=\W|$)/i}innerExtract(e,t){let r=t[wq].toLowerCase(),s=t[bq].toLowerCase(),i=e.createParsingComponents(),a=(0,q1.default)(e.refDate);switch(r){case"gisteren":ft(i,a.add(-1,"day"));break;case"van":ft(i,a);break;case"morgen":wn(i,a);break}switch(s){case"ochtend":i.imply("meridiem",N.AM),i.imply("hour",6);break;case"middag":i.imply("meridiem",N.AM),i.imply("hour",12);break;case"namiddag":i.imply("meridiem",N.PM),i.imply("hour",15);break;case"avond":i.imply("meridiem",N.PM),i.imply("hour",20);break}return i}}});var kq,Eq,Sq,Xh,Q1=v(()=>{Ss();Se();te();Es();kq=new RegExp(`(dit|deze|vorig|afgelopen|(?:aan)?komend|over|\\+|-)e?\\s*(${Xn})(?=\\W|$)`,"i"),Eq=1,Sq=2,Xh=class extends B{innerPattern(){return kq}innerExtract(e,t){let r=t[Eq].toLowerCase(),s=Aa(t[Sq]);switch(r){case"vorig":case"afgelopen":case"-":s=Vt(s);break}return V.createRelativeFromReference(e.reference,s)}}});var K1,Dq,Cq,xq,ef,Z1=v(()=>{Ss();Se();K1=ke(Ye(),1);te();Re();Dq=new RegExp(`(dit|deze|(?:aan)?komend|volgend|afgelopen|vorig)e?\\s*(${G(Yh)})(?=\\s*)(?=\\W|$)`,"i"),Cq=1,xq=2,ef=class extends B{innerPattern(){return Dq}innerExtract(e,t){let r=t[Cq].toLowerCase(),s=t[xq].toLowerCase(),i=Yh[s];if(r=="volgend"||r=="komend"||r=="aankomend"){let l={};return l[i]=1,V.createRelativeFromReference(e.reference,l)}if(r=="afgelopen"||r=="vorig"){let l={};return l[i]=-1,V.createRelativeFromReference(e.reference,l)}let a=e.createParsingComponents(),o=(0,K1.default)(e.reference.instant);return s.match(/week/i)?(o=o.add(-o.get("d"),"d"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.imply("year",o.year())):s.match(/maand/i)?(o=o.add(-o.date()+1,"d"),a.imply("day",o.date()),a.assign("year",o.year()),a.assign("month",o.month()+1)):s.match(/jaar/i)&&(o=o.add(-o.date()+1,"d"),o=o.add(-o.month(),"month"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.assign("year",o.year())),a}}});var Mq,_q,tf,J1=v(()=>{Ss();Se();te();Es();Mq=new RegExp("("+Xn+")(?:geleden|voor|eerder)(?=(?:\\W|$))","i"),_q=new RegExp("("+Xn+")geleden(?=(?:\\W|$))","i"),tf=class extends B{constructor(t){super();I(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?_q:Mq}innerExtract(t,r){let s=Aa(r[1]),i=Vt(s);return V.createRelativeFromReference(t.reference,i)}}});var Aq,Pq,Iq,rf,X1=v(()=>{Ss();Se();te();Aq=new RegExp("("+Xn+")(later|na|vanaf nu|voortaan|vooruit|uit)(?=(?:\\W|$))","i"),Pq=new RegExp("("+Xn+")(later|vanaf nu)(?=(?:\\W|$))","i"),Iq=1,rf=class extends B{constructor(t){super();I(this,"strictMode");this.strictMode=t}innerPattern(){return this.strictMode?Pq:Aq}innerExtract(t,r){let s=Aa(r[Iq]);return V.createRelativeFromReference(t.reference,s)}}});var nE={};nt(nE,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>rE,createCasualConfiguration:()=>eL,createConfiguration:()=>sE,parse:()=>Nq,parseDate:()=>Oq,strict:()=>Rq});function Nq(n,e,t){return rE.parse(n,e,t)}function Oq(n,e,t){return rE.parseDate(n,e,t)}function eL(n=!0){let e=sE(!1,n);return e.parsers.unshift(new jh),e.parsers.unshift(new Vh),e.parsers.unshift(new Jh),e.parsers.unshift(new Dc),e.parsers.unshift(new ef),e.parsers.unshift(new Xh),e}function sE(n=!0,e=!0){return kt({parsers:[new er(e),new zh,new Gh,new Dc,new qh,new Zh,new Qh,new Kh(n),new tf(n),new rf(n)],refiners:[new $h,new Wh]},n)}var rE,Rq,tL=v(()=>{bs();rs();Se();Ue();M1();_1();A1();I1();Li();O1();L1();U1();$1();j1();V1();z1();G1();Q1();Z1();J1();X1();rE=new fe(eL()),Rq=new fe(sE(!0))});function Gs(n){let e=0;for(let t=0;t<n.length;t++){let r=n[t];r==="\u5341"?e=e===0?or[r]:e*or[r]:e+=or[r]}return e}function rL(n){let e="";for(let t=0;t<n.length;t++){let r=n[t];e=e+or[r]}return parseInt(e)}var or,Cc,xc=v(()=>{or={\u96F6:0,"\u3007":0,\u4E00:1,\u4E8C:2,\u4E24:2,\u4E09:3,\u56DB:4,\u4E94:5,\u516D:6,\u4E03:7,\u516B:8,\u4E5D:9,\u5341:10},Cc={\u5929:0,\u65E5:0,\u4E00:1,\u4E8C:2,\u4E09:3,\u56DB:4,\u4E94:5,\u516D:6}});var nL,iE,sL,aE,Ho,oE=v(()=>{nL=ke(Ye(),1);te();xc();iE=1,sL=2,aE=3,Ho=class extends B{innerPattern(){return new RegExp("(\\d{2,4}|["+Object.keys(or).join("")+"]{4}|["+Object.keys(or).join("")+"]{2})?(?:\\s*)(?:\u5E74)?(?:[\\s|,|\uFF0C]*)(\\d{1,2}|["+Object.keys(or).join("")+"]{1,3})(?:\\s*)(?:\u6708)(?:\\s*)(\\d{1,2}|["+Object.keys(or).join("")+"]{1,3})?(?:\\s*)(?:\u65E5|\u53F7)?")}innerExtract(e,t){let r=(0,nL.default)(e.refDate),s=e.createParsingResult(t.index,t[0]),i=parseInt(t[sL]);if(isNaN(i)&&(i=Gs(t[sL])),s.start.assign("month",i),t[aE]){let a=parseInt(t[aE]);isNaN(a)&&(a=Gs(t[aE])),s.start.assign("day",a)}else s.start.imply("day",r.date());if(t[iE]){let a=parseInt(t[iE]);isNaN(a)&&(a=rL(t[iE])),s.start.assign("year",a)}else s.start.imply("year",r.year());return s}}});var iL,Lq,lE,Fq,Uo,cE=v(()=>{iL=ke(Ye(),1);te();xc();Lq=new RegExp("(\\d+|["+Object.keys(or).join("")+"]+|\u534A|\u51E0)(?:\\s*)(?:\u4E2A)?(\u79D2(?:\u949F)?|\u5206\u949F|\u5C0F\u65F6|\u949F|\u65E5|\u5929|\u661F\u671F|\u793C\u62DC|\u6708|\u5E74)(?:(?:\u4E4B|\u8FC7)?\u540E|(?:\u4E4B)?\u5185)","i"),lE=1,Fq=2,Uo=class extends B{innerPattern(){return Lq}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=parseInt(t[lE]);if(isNaN(s)&&(s=Gs(t[lE])),isNaN(s)){let l=t[lE];if(l==="\u51E0")s=3;else if(l==="\u534A")s=.5;else return null}let i=(0,iL.default)(e.refDate),o=t[Fq][0];return o.match(/[日天星礼月年]/)?(o=="\u65E5"||o=="\u5929"?i=i.add(s,"d"):o=="\u661F"||o=="\u793C"?i=i.add(s*7,"d"):o=="\u6708"?i=i.add(s,"month"):o=="\u5E74"&&(i=i.add(s,"year")),r.start.assign("year",i.year()),r.start.assign("month",i.month()+1),r.start.assign("day",i.date()),r):(o=="\u79D2"?i=i.add(s,"second"):o=="\u5206"?i=i.add(s,"minute"):(o=="\u5C0F"||o=="\u949F")&&(i=i.add(s,"hour")),r.start.imply("year",i.year()),r.start.imply("month",i.month()+1),r.start.imply("day",i.date()),r.start.assign("hour",i.hour()),r.start.assign("minute",i.minute()),r.start.assign("second",i.second()),r)}}});var aL,Bq,Wo,dE=v(()=>{aL=ke(Ye(),1);te();xc();Bq=new RegExp("(?<prefix>\u4E0A|\u4E0B|\u8FD9)(?:\u4E2A)?(?:\u661F\u671F|\u793C\u62DC|\u5468)(?<weekday>"+Object.keys(Cc).join("|")+")"),Wo=class extends B{innerPattern(){return Bq}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=t.groups.weekday,i=Cc[s];if(i===void 0)return null;let a=null,o=t.groups.prefix;o=="\u4E0A"?a="last":o=="\u4E0B"?a="next":o=="\u8FD9"&&(a="this");let l=(0,aL.default)(e.refDate),c=!1,d=l.day();return a=="last"||a=="past"?(l=l.day(i-7),c=!0):a=="next"?(l=l.day(i+7),c=!0):a=="this"?l=l.day(i):Math.abs(i-7-d)<Math.abs(i-d)?l=l.day(i-7):Math.abs(i+7-d)<Math.abs(i-d)?l=l.day(i+7):l=l.day(i),r.start.assign("weekday",i),c?(r.start.assign("day",l.date()),r.start.assign("month",l.month()+1),r.start.assign("year",l.year())):(r.start.imply("day",l.date()),r.start.imply("month",l.month()+1),r.start.imply("year",l.year())),r}}});var oL,Hq,Uq,$g,jg,Vg,Yg,zg,qg,Qs,Mc,Gg,$o,uE=v(()=>{oL=ke(Ye(),1);te();xc();Hq=new RegExp("(?:\u4ECE|\u81EA)?(?:(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(\u65E9|\u671D|\u665A)|(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(?:\u65E5|\u5929)(?:[\\s,\uFF0C]*)(?:(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?)?(?:[\\s,\uFF0C]*)(?:(\\d+|["+Object.keys(or).join("")+"]+)(?:\\s*)(?:\u70B9|\u65F6|:|\uFF1A)(?:\\s*)(\\d+|\u534A|\u6B63|\u6574|["+Object.keys(or).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)(\\d+|["+Object.keys(or).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),Uq=new RegExp("(?:^\\s*(?:\u5230|\u81F3|\\-|\\\u2013|\\~|\\\u301C)\\s*)(?:(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(\u65E9|\u671D|\u665A)|(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(?:\u65E5|\u5929)(?:[\\s,\uFF0C]*)(?:(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?)?(?:[\\s,\uFF0C]*)(?:(\\d+|["+Object.keys(or).join("")+"]+)(?:\\s*)(?:\u70B9|\u65F6|:|\uFF1A)(?:\\s*)(\\d+|\u534A|\u6B63|\u6574|["+Object.keys(or).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)(\\d+|["+Object.keys(or).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),$g=1,jg=2,Vg=3,Yg=4,zg=5,qg=6,Qs=7,Mc=8,Gg=9,$o=class extends B{innerPattern(){return Hq}innerExtract(e,t){if(t.index>0&&e.text[t.index-1].match(/\w/))return null;let r=(0,oL.default)(e.refDate),s=e.createParsingResult(t.index,t[0]),i=r.clone();if(t[$g]){let d=t[$g];d=="\u660E"?r.hour()>1&&(i=i.add(1,"day")):d=="\u6628"?i=i.add(-1,"day"):d=="\u524D"?i=i.add(-2,"day"):d=="\u5927\u524D"?i=i.add(-3,"day"):d=="\u540E"?i=i.add(2,"day"):d=="\u5927\u540E"&&(i=i.add(3,"day")),s.start.assign("day",i.date()),s.start.assign("month",i.month()+1),s.start.assign("year",i.year())}else if(t[Yg]){let d=t[Yg];d=="\u660E"?i=i.add(1,"day"):d=="\u6628"?i=i.add(-1,"day"):d=="\u524D"?i=i.add(-2,"day"):d=="\u5927\u524D"?i=i.add(-3,"day"):d=="\u540E"?i=i.add(2,"day"):d=="\u5927\u540E"&&(i=i.add(3,"day")),s.start.assign("day",i.date()),s.start.assign("month",i.month()+1),s.start.assign("year",i.year())}else s.start.imply("day",i.date()),s.start.imply("month",i.month()+1),s.start.imply("year",i.year());let a=0,o=0,l=-1;if(t[Mc]){let d=parseInt(t[Mc]);if(isNaN(d)&&(d=Gs(t[Mc])),d>=60)return null;s.start.assign("second",d)}if(a=parseInt(t[qg]),isNaN(a)&&(a=Gs(t[qg])),t[Qs]?t[Qs]=="\u534A"?o=30:t[Qs]=="\u6B63"||t[Qs]=="\u6574"?o=0:(o=parseInt(t[Qs]),isNaN(o)&&(o=Gs(t[Qs]))):a>100&&(o=a%100,a=Math.floor(a/100)),o>=60||a>24)return null;if(a>=12&&(l=1),t[Gg]){if(a>12)return null;let d=t[Gg][0].toLowerCase();d=="a"&&(l=0,a==12&&(a=0)),d=="p"&&(l=1,a!=12&&(a+=12))}else if(t[jg]){let u=t[jg][0];u=="\u65E9"?(l=0,a==12&&(a=0)):u=="\u665A"&&(l=1,a!=12&&(a+=12))}else if(t[Vg]){let u=t[Vg][0];u=="\u4E0A"||u=="\u65E9"||u=="\u51CC"?(l=0,a==12&&(a=0)):(u=="\u4E0B"||u=="\u665A")&&(l=1,a!=12&&(a+=12))}else if(t[zg]){let u=t[zg][0];u=="\u4E0A"||u=="\u65E9"||u=="\u51CC"?(l=0,a==12&&(a=0)):(u=="\u4E0B"||u=="\u665A")&&(l=1,a!=12&&(a+=12))}if(s.start.assign("hour",a),s.start.assign("minute",o),l>=0?s.start.assign("meridiem",l):a<12?s.start.imply("meridiem",0):s.start.imply("meridiem",1),t=Uq.exec(e.text.substring(s.index+s.text.length)),!t)return s.text.match(/^\d+$/)?null:s;let c=i.clone();if(s.end=e.createParsingComponents(),t[$g]){let d=t[$g];d=="\u660E"?r.hour()>1&&(c=c.add(1,"day")):d=="\u6628"?c=c.add(-1,"day"):d=="\u524D"?c=c.add(-2,"day"):d=="\u5927\u524D"?c=c.add(-3,"day"):d=="\u540E"?c=c.add(2,"day"):d=="\u5927\u540E"&&(c=c.add(3,"day")),s.end.assign("day",c.date()),s.end.assign("month",c.month()+1),s.end.assign("year",c.year())}else if(t[Yg]){let d=t[Yg];d=="\u660E"?c=c.add(1,"day"):d=="\u6628"?c=c.add(-1,"day"):d=="\u524D"?c=c.add(-2,"day"):d=="\u5927\u524D"?c=c.add(-3,"day"):d=="\u540E"?c=c.add(2,"day"):d=="\u5927\u540E"&&(c=c.add(3,"day")),s.end.assign("day",c.date()),s.end.assign("month",c.month()+1),s.end.assign("year",c.year())}else s.end.imply("day",c.date()),s.end.imply("month",c.month()+1),s.end.imply("year",c.year());if(a=0,o=0,l=-1,t[Mc]){let d=parseInt(t[Mc]);if(isNaN(d)&&(d=Gs(t[Mc])),d>=60)return null;s.end.assign("second",d)}if(a=parseInt(t[qg]),isNaN(a)&&(a=Gs(t[qg])),t[Qs]?t[Qs]=="\u534A"?o=30:t[Qs]=="\u6B63"||t[Qs]=="\u6574"?o=0:(o=parseInt(t[Qs]),isNaN(o)&&(o=Gs(t[Qs]))):a>100&&(o=a%100,a=Math.floor(a/100)),o>=60||a>24)return null;if(a>=12&&(l=1),t[Gg]){if(a>12)return null;let d=t[Gg][0].toLowerCase();d=="a"&&(l=0,a==12&&(a=0)),d=="p"&&(l=1,a!=12&&(a+=12)),s.start.isCertain("meridiem")||(l==0?(s.start.imply("meridiem",0),s.start.get("hour")==12&&s.start.assign("hour",0)):(s.start.imply("meridiem",1),s.start.get("hour")!=12&&s.start.assign("hour",s.start.get("hour")+12)))}else if(t[jg]){let u=t[jg][0];u=="\u65E9"?(l=0,a==12&&(a=0)):u=="\u665A"&&(l=1,a!=12&&(a+=12))}else if(t[Vg]){let u=t[Vg][0];u=="\u4E0A"||u=="\u65E9"||u=="\u51CC"?(l=0,a==12&&(a=0)):(u=="\u4E0B"||u=="\u665A")&&(l=1,a!=12&&(a+=12))}else if(t[zg]){let u=t[zg][0];u=="\u4E0A"||u=="\u65E9"||u=="\u51CC"?(l=0,a==12&&(a=0)):(u=="\u4E0B"||u=="\u665A")&&(l=1,a!=12&&(a+=12))}return s.text=s.text+t[0],s.end.assign("hour",a),s.end.assign("minute",o),l>=0?s.end.assign("meridiem",l):s.start.isCertain("meridiem")&&s.start.get("meridiem")==1&&s.start.get("hour")>a?s.end.imply("meridiem",0):a>12&&s.end.imply("meridiem",1),s.end.date().getTime()<s.start.date().getTime()&&s.end.imply("day",s.end.get("day")+1),s}}});var lL,Wq,jo,hE=v(()=>{lL=ke(Ye(),1);te();xc();Wq=new RegExp("(?:\u661F\u671F|\u793C\u62DC|\u5468)(?<weekday>"+Object.keys(Cc).join("|")+")"),jo=class extends B{innerPattern(){return Wq}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=t.groups.weekday,i=Cc[s];if(i===void 0)return null;let a=(0,lL.default)(e.refDate),o=!1,l=a.day();return Math.abs(i-7-l)<Math.abs(i-l)?a=a.day(i-7):Math.abs(i+7-l)<Math.abs(i-l)?a=a.day(i+7):a=a.day(i),r.start.assign("weekday",i),o?(r.start.assign("day",a.date()),r.start.assign("month",a.month()+1),r.start.assign("year",a.year())):(r.start.imply("day",a.date()),r.start.imply("month",a.month()+1),r.start.imply("year",a.year())),r}}});var hL,$q,cL,jq,dL,uL,Vq,Vo,fE=v(()=>{hL=ke(Ye(),1);te();$q=1,cL=2,jq=3,dL=4,uL=5,Vq=6,Vo=class extends B{innerPattern(e){return new RegExp("(\u800C\u5BB6|\u7ACB(?:\u523B|\u5373)|\u5373\u523B)|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(\u65E9|\u671D|\u665A)|(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(?:\u65E5|\u5929)(?:[\\s|,|\uFF0C]*)(?:(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?","i")}innerExtract(e,t){let r=t.index,s=e.createParsingResult(r,t[0]),i=(0,hL.default)(e.refDate),a=i;if(t[$q])s.start.imply("hour",i.hour()),s.start.imply("minute",i.minute()),s.start.imply("second",i.second()),s.start.imply("millisecond",i.millisecond());else if(t[cL]){let o=t[cL],l=t[jq];o=="\u660E"||o=="\u807D"?i.hour()>1&&(a=a.add(1,"day")):o=="\u6628"||o=="\u5C0B"||o=="\u7434"?a=a.add(-1,"day"):o=="\u524D"?a=a.add(-2,"day"):o=="\u5927\u524D"?a=a.add(-3,"day"):o=="\u5F8C"?a=a.add(2,"day"):o=="\u5927\u5F8C"&&(a=a.add(3,"day")),l=="\u65E9"||l=="\u671D"?s.start.imply("hour",6):l=="\u665A"&&(s.start.imply("hour",22),s.start.imply("meridiem",1))}else if(t[dL]){let l=t[dL][0];l=="\u65E9"||l=="\u671D"||l=="\u4E0A"?s.start.imply("hour",6):l=="\u4E0B"||l=="\u664F"?(s.start.imply("hour",15),s.start.imply("meridiem",1)):l=="\u4E2D"?(s.start.imply("hour",12),s.start.imply("meridiem",1)):l=="\u591C"||l=="\u665A"?(s.start.imply("hour",22),s.start.imply("meridiem",1)):l=="\u51CC"&&s.start.imply("hour",0)}else if(t[uL]){let o=t[uL];o=="\u660E"||o=="\u807D"?i.hour()>1&&(a=a.add(1,"day")):o=="\u6628"||o=="\u5C0B"||o=="\u7434"?a=a.add(-1,"day"):o=="\u524D"?a=a.add(-2,"day"):o=="\u5927\u524D"?a=a.add(-3,"day"):o=="\u5F8C"?a=a.add(2,"day"):o=="\u5927\u5F8C"&&(a=a.add(3,"day"));let l=t[Vq];if(l){let c=l[0];c=="\u65E9"||c=="\u671D"||c=="\u4E0A"?s.start.imply("hour",6):c=="\u4E0B"||c=="\u664F"?(s.start.imply("hour",15),s.start.imply("meridiem",1)):c=="\u4E2D"?(s.start.imply("hour",12),s.start.imply("meridiem",1)):c=="\u591C"||c=="\u665A"?(s.start.imply("hour",22),s.start.imply("meridiem",1)):c=="\u51CC"&&s.start.imply("hour",0)}}return s.start.assign("day",a.date()),s.start.assign("month",a.month()+1),s.start.assign("year",a.year()),s}}});function Ks(n){let e=0;for(let t=0;t<n.length;t++){let r=n[t];r==="\u5341"?e=e===0?lr[r]:e*lr[r]:e+=lr[r]}return e}function fL(n){let e="";for(let t=0;t<n.length;t++){let r=n[t];e=e+lr[r]}return parseInt(e)}var lr,_c,Ac=v(()=>{lr={\u96F6:0,\u4E00:1,\u4E8C:2,\u5169:2,\u4E09:3,\u56DB:4,\u4E94:5,\u516D:6,\u4E03:7,\u516B:8,\u4E5D:9,\u5341:10,\u5EFF:20,\u5345:30},_c={\u5929:0,\u65E5:0,\u4E00:1,\u4E8C:2,\u4E09:3,\u56DB:4,\u4E94:5,\u516D:6}});var mL,pE,pL,mE,Yo,gE=v(()=>{mL=ke(Ye(),1);te();Ac();pE=1,pL=2,mE=3,Yo=class extends B{innerPattern(){return new RegExp("(\\d{2,4}|["+Object.keys(lr).join("")+"]{4}|["+Object.keys(lr).join("")+"]{2})?(?:\\s*)(?:\u5E74)?(?:[\\s|,|\uFF0C]*)(\\d{1,2}|["+Object.keys(lr).join("")+"]{1,2})(?:\\s*)(?:\u6708)(?:\\s*)(\\d{1,2}|["+Object.keys(lr).join("")+"]{1,2})?(?:\\s*)(?:\u65E5|\u865F)?")}innerExtract(e,t){let r=(0,mL.default)(e.refDate),s=e.createParsingResult(t.index,t[0]),i=parseInt(t[pL]);if(isNaN(i)&&(i=Ks(t[pL])),s.start.assign("month",i),t[mE]){let a=parseInt(t[mE]);isNaN(a)&&(a=Ks(t[mE])),s.start.assign("day",a)}else s.start.imply("day",r.date());if(t[pE]){let a=parseInt(t[pE]);isNaN(a)&&(a=fL(t[pE])),s.start.assign("year",a)}else s.start.imply("year",r.year());return s}}});var gL,Yq,yE,zq,zo,vE=v(()=>{gL=ke(Ye(),1);te();Ac();Yq=new RegExp("(\\d+|["+Object.keys(lr).join("")+"]+|\u534A|\u5E7E)(?:\\s*)(?:\u500B)?(\u79D2(?:\u9418)?|\u5206\u9418|\u5C0F\u6642|\u9418|\u65E5|\u5929|\u661F\u671F|\u79AE\u62DC|\u6708|\u5E74)(?:(?:\u4E4B|\u904E)?\u5F8C|(?:\u4E4B)?\u5167)","i"),yE=1,zq=2,zo=class extends B{innerPattern(){return Yq}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=parseInt(t[yE]);if(isNaN(s)&&(s=Ks(t[yE])),isNaN(s)){let l=t[yE];if(l==="\u5E7E")s=3;else if(l==="\u534A")s=.5;else return null}let i=(0,gL.default)(e.refDate),o=t[zq][0];return o.match(/[日天星禮月年]/)?(o=="\u65E5"||o=="\u5929"?i=i.add(s,"d"):o=="\u661F"||o=="\u79AE"?i=i.add(s*7,"d"):o=="\u6708"?i=i.add(s,"month"):o=="\u5E74"&&(i=i.add(s,"year")),r.start.assign("year",i.year()),r.start.assign("month",i.month()+1),r.start.assign("day",i.date()),r):(o=="\u79D2"?i=i.add(s,"second"):o=="\u5206"?i=i.add(s,"minute"):(o=="\u5C0F"||o=="\u9418")&&(i=i.add(s,"hour")),r.start.imply("year",i.year()),r.start.imply("month",i.month()+1),r.start.imply("day",i.date()),r.start.assign("hour",i.hour()),r.start.assign("minute",i.minute()),r.start.assign("second",i.second()),r)}}});var yL,qq,qo,TE=v(()=>{yL=ke(Ye(),1);te();Ac();qq=new RegExp("(?<prefix>\u4E0A|\u4ECA|\u4E0B|\u9019|\u5462)(?:\u500B)?(?:\u661F\u671F|\u79AE\u62DC|\u9031)(?<weekday>"+Object.keys(_c).join("|")+")"),qo=class extends B{innerPattern(){return qq}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=t.groups.weekday,i=_c[s];if(i===void 0)return null;let a=null,o=t.groups.prefix;o=="\u4E0A"?a="last":o=="\u4E0B"?a="next":(o=="\u4ECA"||o=="\u9019"||o=="\u5462")&&(a="this");let l=(0,yL.default)(e.refDate),c=!1,d=l.day();return a=="last"||a=="past"?(l=l.day(i-7),c=!0):a=="next"?(l=l.day(i+7),c=!0):a=="this"?l=l.day(i):Math.abs(i-7-d)<Math.abs(i-d)?l=l.day(i-7):Math.abs(i+7-d)<Math.abs(i-d)?l=l.day(i+7):l=l.day(i),r.start.assign("weekday",i),c?(r.start.assign("day",l.date()),r.start.assign("month",l.month()+1),r.start.assign("year",l.year())):(r.start.imply("day",l.date()),r.start.imply("month",l.month()+1),r.start.imply("year",l.year())),r}}});var vL,Gq,Qq,Qg,Kg,Zg,Jg,Xg,ey,Zs,Pc,ty,Go,wE=v(()=>{vL=ke(Ye(),1);te();Ac();Gq=new RegExp("(?:\u7531|\u5F9E|\u81EA)?(?:(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(\u65E9|\u671D|\u665A)|(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(?:\u65E5|\u5929)(?:[\\s,\uFF0C]*)(?:(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?)?(?:[\\s,\uFF0C]*)(?:(\\d+|["+Object.keys(lr).join("")+"]+)(?:\\s*)(?:\u9EDE|\u6642|:|\uFF1A)(?:\\s*)(\\d+|\u534A|\u6B63|\u6574|["+Object.keys(lr).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)(\\d+|["+Object.keys(lr).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),Qq=new RegExp("(?:^\\s*(?:\u5230|\u81F3|\\-|\\\u2013|\\~|\\\u301C)\\s*)(?:(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(\u65E9|\u671D|\u665A)|(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u5F8C|\u5927\u5F8C|\u807D|\u6628|\u5C0B|\u7434)(?:\u65E5|\u5929)(?:[\\s,\uFF0C]*)(?:(\u4E0A(?:\u5348|\u665D)|\u671D(?:\u65E9)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348|\u665D)|\u664F(?:\u665D)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?)?(?:[\\s,\uFF0C]*)(?:(\\d+|["+Object.keys(lr).join("")+"]+)(?:\\s*)(?:\u9EDE|\u6642|:|\uFF1A)(?:\\s*)(\\d+|\u534A|\u6B63|\u6574|["+Object.keys(lr).join("")+"]+)?(?:\\s*)(?:\u5206|:|\uFF1A)?(?:\\s*)(\\d+|["+Object.keys(lr).join("")+"]+)?(?:\\s*)(?:\u79D2)?)(?:\\s*(A.M.|P.M.|AM?|PM?))?","i"),Qg=1,Kg=2,Zg=3,Jg=4,Xg=5,ey=6,Zs=7,Pc=8,ty=9,Go=class extends B{innerPattern(){return Gq}innerExtract(e,t){if(t.index>0&&e.text[t.index-1].match(/\w/))return null;let r=(0,vL.default)(e.refDate),s=e.createParsingResult(t.index,t[0]),i=r.clone();if(t[Qg]){var a=t[Qg];a=="\u660E"||a=="\u807D"?r.hour()>1&&(i=i.add(1,"day")):a=="\u6628"||a=="\u5C0B"||a=="\u7434"?i=i.add(-1,"day"):a=="\u524D"?i=i.add(-2,"day"):a=="\u5927\u524D"?i=i.add(-3,"day"):a=="\u5F8C"?i=i.add(2,"day"):a=="\u5927\u5F8C"&&(i=i.add(3,"day")),s.start.assign("day",i.date()),s.start.assign("month",i.month()+1),s.start.assign("year",i.year())}else if(t[Jg]){var o=t[Jg];o=="\u660E"||o=="\u807D"?i=i.add(1,"day"):o=="\u6628"||o=="\u5C0B"||o=="\u7434"?i=i.add(-1,"day"):o=="\u524D"?i=i.add(-2,"day"):o=="\u5927\u524D"?i=i.add(-3,"day"):o=="\u5F8C"?i=i.add(2,"day"):o=="\u5927\u5F8C"&&(i=i.add(3,"day")),s.start.assign("day",i.date()),s.start.assign("month",i.month()+1),s.start.assign("year",i.year())}else s.start.imply("day",i.date()),s.start.imply("month",i.month()+1),s.start.imply("year",i.year());let l=0,c=0,d=-1;if(t[Pc]){var u=parseInt(t[Pc]);if(isNaN(u)&&(u=Ks(t[Pc])),u>=60)return null;s.start.assign("second",u)}if(l=parseInt(t[ey]),isNaN(l)&&(l=Ks(t[ey])),t[Zs]?t[Zs]=="\u534A"?c=30:t[Zs]=="\u6B63"||t[Zs]=="\u6574"?c=0:(c=parseInt(t[Zs]),isNaN(c)&&(c=Ks(t[Zs]))):l>100&&(c=l%100,l=Math.floor(l/100)),c>=60||l>24)return null;if(l>=12&&(d=1),t[ty]){if(l>12)return null;var h=t[ty][0].toLowerCase();h=="a"&&(d=0,l==12&&(l=0)),h=="p"&&(d=1,l!=12&&(l+=12))}else if(t[Kg]){var f=t[Kg],p=f[0];p=="\u671D"||p=="\u65E9"?(d=0,l==12&&(l=0)):p=="\u665A"&&(d=1,l!=12&&(l+=12))}else if(t[Zg]){var m=t[Zg],g=m[0];g=="\u4E0A"||g=="\u671D"||g=="\u65E9"||g=="\u51CC"?(d=0,l==12&&(l=0)):(g=="\u4E0B"||g=="\u664F"||g=="\u665A")&&(d=1,l!=12&&(l+=12))}else if(t[Xg]){var y=t[Xg],T=y[0];T=="\u4E0A"||T=="\u671D"||T=="\u65E9"||T=="\u51CC"?(d=0,l==12&&(l=0)):(T=="\u4E0B"||T=="\u664F"||T=="\u665A")&&(d=1,l!=12&&(l+=12))}if(s.start.assign("hour",l),s.start.assign("minute",c),d>=0?s.start.assign("meridiem",d):l<12?s.start.imply("meridiem",0):s.start.imply("meridiem",1),t=Qq.exec(e.text.substring(s.index+s.text.length)),!t)return s.text.match(/^\d+$/)?null:s;let w=i.clone();if(s.end=e.createParsingComponents(),t[Qg]){var a=t[Qg];a=="\u660E"||a=="\u807D"?r.hour()>1&&(w=w.add(1,"day")):a=="\u6628"||a=="\u5C0B"||a=="\u7434"?w=w.add(-1,"day"):a=="\u524D"?w=w.add(-2,"day"):a=="\u5927\u524D"?w=w.add(-3,"day"):a=="\u5F8C"?w=w.add(2,"day"):a=="\u5927\u5F8C"&&(w=w.add(3,"day")),s.end.assign("day",w.date()),s.end.assign("month",w.month()+1),s.end.assign("year",w.year())}else if(t[Jg]){var o=t[Jg];o=="\u660E"||o=="\u807D"?w=w.add(1,"day"):o=="\u6628"||o=="\u5C0B"||o=="\u7434"?w=w.add(-1,"day"):o=="\u524D"?w=w.add(-2,"day"):o=="\u5927\u524D"?w=w.add(-3,"day"):o=="\u5F8C"?w=w.add(2,"day"):o=="\u5927\u5F8C"&&(w=w.add(3,"day")),s.end.assign("day",w.date()),s.end.assign("month",w.month()+1),s.end.assign("year",w.year())}else s.end.imply("day",w.date()),s.end.imply("month",w.month()+1),s.end.imply("year",w.year());if(l=0,c=0,d=-1,t[Pc]){var u=parseInt(t[Pc]);if(isNaN(u)&&(u=Ks(t[Pc])),u>=60)return null;s.end.assign("second",u)}if(l=parseInt(t[ey]),isNaN(l)&&(l=Ks(t[ey])),t[Zs]?t[Zs]=="\u534A"?c=30:t[Zs]=="\u6B63"||t[Zs]=="\u6574"?c=0:(c=parseInt(t[Zs]),isNaN(c)&&(c=Ks(t[Zs]))):l>100&&(c=l%100,l=Math.floor(l/100)),c>=60||l>24)return null;if(l>=12&&(d=1),t[ty]){if(l>12)return null;var h=t[ty][0].toLowerCase();h=="a"&&(d=0,l==12&&(l=0)),h=="p"&&(d=1,l!=12&&(l+=12)),s.start.isCertain("meridiem")||(d==0?(s.start.imply("meridiem",0),s.start.get("hour")==12&&s.start.assign("hour",0)):(s.start.imply("meridiem",1),s.start.get("hour")!=12&&s.start.assign("hour",s.start.get("hour")+12)))}else if(t[Kg]){var f=t[Kg],p=f[0];p=="\u671D"||p=="\u65E9"?(d=0,l==12&&(l=0)):p=="\u665A"&&(d=1,l!=12&&(l+=12))}else if(t[Zg]){var m=t[Zg],g=m[0];g=="\u4E0A"||g=="\u671D"||g=="\u65E9"||g=="\u51CC"?(d=0,l==12&&(l=0)):(g=="\u4E0B"||g=="\u664F"||g=="\u665A")&&(d=1,l!=12&&(l+=12))}else if(t[Xg]){var y=t[Xg],T=y[0];T=="\u4E0A"||T=="\u671D"||T=="\u65E9"||T=="\u51CC"?(d=0,l==12&&(l=0)):(T=="\u4E0B"||T=="\u664F"||T=="\u665A")&&(d=1,l!=12&&(l+=12))}return s.text=s.text+t[0],s.end.assign("hour",l),s.end.assign("minute",c),d>=0?s.end.assign("meridiem",d):s.start.isCertain("meridiem")&&s.start.get("meridiem")==1&&s.start.get("hour")>l?s.end.imply("meridiem",0):l>12&&s.end.imply("meridiem",1),s.end.date().getTime()<s.start.date().getTime()&&s.end.imply("day",s.end.get("day")+1),s}}});var TL,Kq,Qo,bE=v(()=>{TL=ke(Ye(),1);te();Ac();Kq=new RegExp("(?:\u661F\u671F|\u79AE\u62DC|\u9031)(?<weekday>"+Object.keys(_c).join("|")+")"),Qo=class extends B{innerPattern(){return Kq}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=t.groups.weekday,i=_c[s];if(i===void 0)return null;let a=(0,TL.default)(e.refDate),o=!1,l=a.day();return Math.abs(i-7-l)<Math.abs(i-l)?a=a.day(i-7):Math.abs(i+7-l)<Math.abs(i-l)?a=a.day(i+7):a=a.day(i),r.start.assign("weekday",i),o?(r.start.assign("day",a.date()),r.start.assign("month",a.month()+1),r.start.assign("year",a.year())):(r.start.imply("day",a.date()),r.start.imply("month",a.month()+1),r.start.imply("year",a.year())),r}}});var Ko,kE=v(()=>{Ys();Ko=class extends vt{patternBetween(){return/^\s*(至|到|\-|\~|～|－|ー)\s*$/i}}});var Zo,EE=v(()=>{zs();Zo=class extends Tt{patternBetween(){return/^\s*$/i}}});var ry={};nt(ry,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>SE,createCasualConfiguration:()=>DE,createConfiguration:()=>CE,hant:()=>Zq,parse:()=>Xq,parseDate:()=>eG,strict:()=>Jq});function Xq(n,e,t){return SE.parse(n,e,t)}function eG(n,e,t){return SE.parseDate(n,e,t)}function DE(){let n=CE();return n.parsers.unshift(new Vo),n}function CE(){let n=kt({parsers:[new Yo,new qo,new Qo,new Go,new zo],refiners:[new Ko,new Zo]});return n.refiners=n.refiners.filter(e=>!(e instanceof bn)),n}var Zq,SE,Jq,wL=v(()=>{ju();bs();rs();Se();Ue();fE();gE();vE();TE();wE();bE();kE();EE();Zq=new fe(DE()),SE=new fe(DE()),Jq=new fe(CE())});var SL,tG,bL,rG,kL,EL,sG,sf,DL=v(()=>{SL=ke(Ye(),1);te();tG=1,bL=2,rG=3,kL=4,EL=5,sG=6,sf=class extends B{innerPattern(e){return new RegExp("(\u73B0\u5728|\u7ACB(?:\u523B|\u5373)|\u5373\u523B)|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(\u65E9|\u665A)|(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668))|(\u4ECA|\u660E|\u524D|\u5927\u524D|\u540E|\u5927\u540E|\u6628)(?:\u65E5|\u5929)(?:[\\s|,|\uFF0C]*)(?:(\u4E0A(?:\u5348)|\u65E9(?:\u4E0A)|\u4E0B(?:\u5348)|\u665A(?:\u4E0A)|\u591C(?:\u665A)?|\u4E2D(?:\u5348)|\u51CC(?:\u6668)))?","i")}innerExtract(e,t){let r=t.index,s=e.createParsingResult(r,t[0]),i=(0,SL.default)(e.refDate),a=i;if(t[tG])s.start.imply("hour",i.hour()),s.start.imply("minute",i.minute()),s.start.imply("second",i.second()),s.start.imply("millisecond",i.millisecond());else if(t[bL]){let o=t[bL],l=t[rG];o=="\u660E"?i.hour()>1&&(a=a.add(1,"day")):o=="\u6628"?a=a.add(-1,"day"):o=="\u524D"?a=a.add(-2,"day"):o=="\u5927\u524D"?a=a.add(-3,"day"):o=="\u540E"?a=a.add(2,"day"):o=="\u5927\u540E"&&(a=a.add(3,"day")),l=="\u65E9"?s.start.imply("hour",6):l=="\u665A"&&(s.start.imply("hour",22),s.start.imply("meridiem",1))}else if(t[kL]){let l=t[kL][0];l=="\u65E9"||l=="\u4E0A"?s.start.imply("hour",6):l=="\u4E0B"?(s.start.imply("hour",15),s.start.imply("meridiem",1)):l=="\u4E2D"?(s.start.imply("hour",12),s.start.imply("meridiem",1)):l=="\u591C"||l=="\u665A"?(s.start.imply("hour",22),s.start.imply("meridiem",1)):l=="\u51CC"&&s.start.imply("hour",0)}else if(t[EL]){let o=t[EL];o=="\u660E"?i.hour()>1&&(a=a.add(1,"day")):o=="\u6628"?a=a.add(-1,"day"):o=="\u524D"?a=a.add(-2,"day"):o=="\u5927\u524D"?a=a.add(-3,"day"):o=="\u540E"?a=a.add(2,"day"):o=="\u5927\u540E"&&(a=a.add(3,"day"));let l=t[sG];if(l){let c=l[0];c=="\u65E9"||c=="\u4E0A"?s.start.imply("hour",6):c=="\u4E0B"?(s.start.imply("hour",15),s.start.imply("meridiem",1)):c=="\u4E2D"?(s.start.imply("hour",12),s.start.imply("meridiem",1)):c=="\u591C"||c=="\u665A"?(s.start.imply("hour",22),s.start.imply("meridiem",1)):c=="\u51CC"&&s.start.imply("hour",0)}}return s.start.assign("day",a.date()),s.start.assign("month",a.month()+1),s.start.assign("year",a.year()),s}}});var nf,CL=v(()=>{Ys();nf=class extends vt{patternBetween(){return/^\s*(至|到|-|~|～|－|ー)\s*$/i}}});var af,xL=v(()=>{zs();af=class extends Tt{patternBetween(){return/^\s*$/i}}});var sy={};nt(sy,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>xE,createCasualConfiguration:()=>ME,createConfiguration:()=>_E,hans:()=>nG,parse:()=>aG,parseDate:()=>oG,strict:()=>iG});function aG(n,e,t){return xE.parse(n,e,t)}function oG(n,e,t){return xE.parseDate(n,e,t)}function ME(){let n=_E();return n.parsers.unshift(new sf),n}function _E(){let n=kt({parsers:[new Ho,new Wo,new jo,new $o,new Uo],refiners:[new nf,new af]});return n.refiners=n.refiners.filter(e=>!(e instanceof bn)),n}var nG,xE,iG,ML=v(()=>{ju();bs();rs();Se();Ue();DL();oE();cE();dE();uE();hE();CL();xL();nG=new fe(ME()),xE=new fe(ME()),iG=new fe(_E())});var IE={};nt(IE,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>AE,createCasualConfiguration:()=>_L,createConfiguration:()=>PE,hans:()=>sy,hant:()=>ry,parse:()=>cG,parseDate:()=>dG,strict:()=>lG});function cG(n,e,t){return AE.parse(n,e,t)}function dG(n,e,t){return AE.parseDate(n,e,t)}function _L(){let n=PE();return n.parsers.unshift(new Vo),n}function PE(){let n=kt({parsers:[new Yo,new Ho,new qo,new Wo,new Qo,new jo,new Go,new $o,new zo,new Uo],refiners:[new Ko,new Zo]});return n.refiners=n.refiners.filter(e=>!(e instanceof bn)),n}var AE,lG,AL=v(()=>{bs();rs();Se();Ue();ju();oE();cE();dE();uE();hE();fE();gE();vE();TE();wE();bE();kE();EE();wL();ML();AE=new fe(_L()),lG=new fe(PE())});function hG(n){let e=n.toLowerCase();return NE[e]!==void 0?NE[e]:e.match(/несколько/)?3:e.match(/пол/)?.5:e.match(/пар/)?2:e===""?1:parseFloat(e)}function HE(n){let e=n.toLowerCase();return OE[e]!==void 0?OE[e]:parseInt(e)}function iy(n){if(/(год|года|г|г.)/i.test(n)&&(n=n.replace(/(год|года|г|г.)/i,"")),/(до н.э.|до н. э.)/i.test(n))return n=n.replace(/(до н.э.|до н. э.)/i,""),-parseInt(n);if(/(н. э.|н.э.)/i.test(n))return n=n.replace(/(н. э.|н.э.)/i,""),parseInt(n);let e=parseInt(n);return es(e)}function Nc(n){let e={},t=n,r=PL.exec(t);for(;r;)fG(e,r),t=t.substring(r[0].length).trim(),r=PL.exec(t);return e}function fG(n,e){let t=hG(e[1]),r=of[e[2].toLowerCase()];n[r]=t}var Ds,LE,FE,Ic,NE,OE,of,uG,BE,RE,ny,IL,PL,Rc,Cs=v(()=>{Re();Pt();Ds={leftBoundary:"([^\\p{L}\\p{N}_]|^)",rightBoundary:"(?=[^\\p{L}\\p{N}_]|$)",flags:"iu"},LE={\u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u0435:0,\u0432\u043E\u0441\u043A\u0440\u0435\u0441\u0435\u043D\u044C\u044F:0,\u0432\u0441\u043A:0,"\u0432\u0441\u043A.":0,\u043F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A:1,\u043F\u043E\u043D\u0435\u0434\u0435\u043B\u044C\u043D\u0438\u043A\u0430:1,\u043F\u043D:1,"\u043F\u043D.":1,\u0432\u0442\u043E\u0440\u043D\u0438\u043A:2,\u0432\u0442\u043E\u0440\u043D\u0438\u043A\u0430:2,\u0432\u0442:2,"\u0432\u0442.":2,\u0441\u0440\u0435\u0434\u0430:3,\u0441\u0440\u0435\u0434\u044B:3,\u0441\u0440\u0435\u0434\u0443:3,\u0441\u0440:3,"\u0441\u0440.":3,\u0447\u0435\u0442\u0432\u0435\u0440\u0433:4,\u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0430:4,\u0447\u0442:4,"\u0447\u0442.":4,\u043F\u044F\u0442\u043D\u0438\u0446\u0430:5,\u043F\u044F\u0442\u043D\u0438\u0446\u0443:5,\u043F\u044F\u0442\u043D\u0438\u0446\u044B:5,\u043F\u0442:5,"\u043F\u0442.":5,\u0441\u0443\u0431\u0431\u043E\u0442\u0430:6,\u0441\u0443\u0431\u0431\u043E\u0442\u0443:6,\u0441\u0443\u0431\u0431\u043E\u0442\u044B:6,\u0441\u0431:6,"\u0441\u0431.":6},FE={\u044F\u043D\u0432\u0430\u0440\u044C:1,\u044F\u043D\u0432\u0430\u0440\u044F:1,\u044F\u043D\u0432\u0430\u0440\u0435:1,\u0444\u0435\u0432\u0440\u0430\u043B\u044C:2,\u0444\u0435\u0432\u0440\u0430\u043B\u044F:2,\u0444\u0435\u0432\u0440\u0430\u043B\u0435:2,\u043C\u0430\u0440\u0442:3,\u043C\u0430\u0440\u0442\u0430:3,\u043C\u0430\u0440\u0442\u0435:3,\u0430\u043F\u0440\u0435\u043B\u044C:4,\u0430\u043F\u0440\u0435\u043B\u044F:4,\u0430\u043F\u0440\u0435\u043B\u0435:4,\u043C\u0430\u0439:5,\u043C\u0430\u044F:5,\u043C\u0430\u0435:5,\u0438\u044E\u043D\u044C:6,\u0438\u044E\u043D\u044F:6,\u0438\u044E\u043D\u0435:6,\u0438\u044E\u043B\u044C:7,\u0438\u044E\u043B\u044F:7,\u0438\u044E\u043B\u0435:7,\u0430\u0432\u0433\u0443\u0441\u0442:8,\u0430\u0432\u0433\u0443\u0441\u0442\u0430:8,\u0430\u0432\u0433\u0443\u0441\u0442\u0435:8,\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044C:9,\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u044F:9,\u0441\u0435\u043D\u0442\u044F\u0431\u0440\u0435:9,\u043E\u043A\u0442\u044F\u0431\u0440\u044C:10,\u043E\u043A\u0442\u044F\u0431\u0440\u044F:10,\u043E\u043A\u0442\u044F\u0431\u0440\u0435:10,\u043D\u043E\u044F\u0431\u0440\u044C:11,\u043D\u043E\u044F\u0431\u0440\u044F:11,\u043D\u043E\u044F\u0431\u0440\u0435:11,\u0434\u0435\u043A\u0430\u0431\u0440\u044C:12,\u0434\u0435\u043A\u0430\u0431\u0440\u044F:12,\u0434\u0435\u043A\u0430\u0431\u0440\u0435:12},Ic={...FE,\u044F\u043D\u0432:1,"\u044F\u043D\u0432.":1,\u0444\u0435\u0432:2,"\u0444\u0435\u0432.":2,\u043C\u0430\u0440:3,"\u043C\u0430\u0440.":3,\u0430\u043F\u0440:4,"\u0430\u043F\u0440.":4,\u0430\u0432\u0433:8,"\u0430\u0432\u0433.":8,\u0441\u0435\u043D:9,"\u0441\u0435\u043D.":9,\u043E\u043A\u0442:10,"\u043E\u043A\u0442.":10,\u043D\u043E\u044F:11,"\u043D\u043E\u044F.":11,\u0434\u0435\u043A:12,"\u0434\u0435\u043A.":12},NE={\u043E\u0434\u0438\u043D:1,\u043E\u0434\u043D\u0430:1,\u043E\u0434\u043D\u043E\u0439:1,\u043E\u0434\u043D\u0443:1,\u0434\u0432\u0435:2,\u0434\u0432\u0430:2,\u0434\u0432\u0443\u0445:2,\u0442\u0440\u0438:3,\u0442\u0440\u0435\u0445:3,\u0442\u0440\u0451\u0445:3,\u0447\u0435\u0442\u044B\u0440\u0435:4,\u0447\u0435\u0442\u044B\u0440\u0435\u0445:4,\u0447\u0435\u0442\u044B\u0440\u0451\u0445:4,\u043F\u044F\u0442\u044C:5,\u043F\u044F\u0442\u0438:5,\u0448\u0435\u0441\u0442\u044C:6,\u0448\u0435\u0441\u0442\u0438:6,\u0441\u0435\u043C\u044C:7,\u0441\u0435\u043C\u0438:7,\u0432\u043E\u0441\u0435\u043C\u044C:8,\u0432\u043E\u0441\u044C\u043C\u0438:8,\u0434\u0435\u0432\u044F\u0442\u044C:9,\u0434\u0435\u0432\u044F\u0442\u0438:9,\u0434\u0435\u0441\u044F\u0442\u044C:10,\u0434\u0435\u0441\u044F\u0442\u0438:10,\u043E\u0434\u0438\u043D\u043D\u0430\u0434\u0446\u0430\u0442\u044C:11,\u043E\u0434\u0438\u043D\u043D\u0430\u0434\u0446\u0430\u0442\u0438:11,\u0434\u0432\u0435\u043D\u0430\u0434\u0446\u0430\u0442\u044C:12,\u0434\u0432\u0435\u043D\u0430\u0434\u0446\u0430\u0442\u0438:12},OE={\u043F\u0435\u0440\u0432\u043E\u0435:1,\u043F\u0435\u0440\u0432\u043E\u0433\u043E:1,\u0432\u0442\u043E\u0440\u043E\u0435:2,\u0432\u0442\u043E\u0440\u043E\u0433\u043E:2,\u0442\u0440\u0435\u0442\u044C\u0435:3,\u0442\u0440\u0435\u0442\u044C\u0435\u0433\u043E:3,\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0435:4,\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0433\u043E:4,\u043F\u044F\u0442\u043E\u0435:5,\u043F\u044F\u0442\u043E\u0433\u043E:5,\u0448\u0435\u0441\u0442\u043E\u0435:6,\u0448\u0435\u0441\u0442\u043E\u0433\u043E:6,\u0441\u0435\u0434\u044C\u043C\u043E\u0435:7,\u0441\u0435\u0434\u044C\u043C\u043E\u0433\u043E:7,\u0432\u043E\u0441\u044C\u043C\u043E\u0435:8,\u0432\u043E\u0441\u044C\u043C\u043E\u0433\u043E:8,\u0434\u0435\u0432\u044F\u0442\u043E\u0435:9,\u0434\u0435\u0432\u044F\u0442\u043E\u0433\u043E:9,\u0434\u0435\u0441\u044F\u0442\u043E\u0435:10,\u0434\u0435\u0441\u044F\u0442\u043E\u0433\u043E:10,\u043E\u0434\u0438\u043D\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:11,\u043E\u0434\u0438\u043D\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:11,\u0434\u0432\u0435\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:12,\u0434\u0432\u0435\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:12,\u0442\u0440\u0438\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:13,\u0442\u0440\u0438\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:13,\u0447\u0435\u0442\u044B\u0440\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:14,\u0447\u0435\u0442\u044B\u0440\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:14,\u043F\u044F\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:15,\u043F\u044F\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:15,\u0448\u0435\u0441\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:16,\u0448\u0435\u0441\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:16,\u0441\u0435\u043C\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:17,\u0441\u0435\u043C\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:17,\u0432\u043E\u0441\u0435\u043C\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:18,\u0432\u043E\u0441\u0435\u043C\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:18,\u0434\u0435\u0432\u044F\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0435:19,\u0434\u0435\u0432\u044F\u0442\u043D\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:19,\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u043E\u0435:20,\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u043E\u0433\u043E:20,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u043F\u0435\u0440\u0432\u043E\u0435":21,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u043F\u0435\u0440\u0432\u043E\u0433\u043E":21,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0432\u0442\u043E\u0440\u043E\u0435":22,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0432\u0442\u043E\u0440\u043E\u0433\u043E":22,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0442\u0440\u0435\u0442\u044C\u0435":23,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0442\u0440\u0435\u0442\u044C\u0435\u0433\u043E":23,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0435":24,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0433\u043E":24,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u043F\u044F\u0442\u043E\u0435":25,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u043F\u044F\u0442\u043E\u0433\u043E":25,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0448\u0435\u0441\u0442\u043E\u0435":26,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0448\u0435\u0441\u0442\u043E\u0433\u043E":26,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0441\u0435\u0434\u044C\u043C\u043E\u0435":27,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0441\u0435\u0434\u044C\u043C\u043E\u0433\u043E":27,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0432\u043E\u0441\u044C\u043C\u043E\u0435":28,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0432\u043E\u0441\u044C\u043C\u043E\u0433\u043E":28,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0434\u0435\u0432\u044F\u0442\u043E\u0435":29,"\u0434\u0432\u0430\u0434\u0446\u0430\u0442\u044C \u0434\u0435\u0432\u044F\u0442\u043E\u0433\u043E":29,\u0442\u0440\u0438\u0434\u0446\u0430\u0442\u043E\u0435:30,\u0442\u0440\u0438\u0434\u0446\u0430\u0442\u043E\u0433\u043E:30,"\u0442\u0440\u0438\u0434\u0446\u0430\u0442\u044C \u043F\u0435\u0440\u0432\u043E\u0435":31,"\u0442\u0440\u0438\u0434\u0446\u0430\u0442\u044C \u043F\u0435\u0440\u0432\u043E\u0433\u043E":31},of={\u0441\u0435\u043A:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u0430:"second",\u0441\u0435\u043A\u0443\u043D\u0434:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u044B:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u0443:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043A\u0430:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043A\u0438:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u0435\u043A:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043A\u0443:"second",\u043C\u0438\u043D:"minute",\u043C\u0438\u043D\u0443\u0442\u0430:"minute",\u043C\u0438\u043D\u0443\u0442:"minute",\u043C\u0438\u043D\u0443\u0442\u044B:"minute",\u043C\u0438\u043D\u0443\u0442\u0443:"minute",\u043C\u0438\u043D\u0443\u0442\u043E\u043A:"minute",\u043C\u0438\u043D\u0443\u0442\u043A\u0438:"minute",\u043C\u0438\u043D\u0443\u0442\u043A\u0443:"minute",\u043C\u0438\u043D\u0443\u0442\u043E\u0447\u0435\u043A:"minute",\u043C\u0438\u043D\u0443\u0442\u043E\u0447\u043A\u0438:"minute",\u043C\u0438\u043D\u0443\u0442\u043E\u0447\u043A\u0443:"minute",\u0447\u0430\u0441:"hour",\u0447\u0430\u0441\u043E\u0432:"hour",\u0447\u0430\u0441\u0430:"hour",\u0447\u0430\u0441\u0443:"hour",\u0447\u0430\u0441\u0438\u043A\u043E\u0432:"hour",\u0447\u0430\u0441\u0438\u043A\u0430:"hour",\u0447\u0430\u0441\u0438\u043A\u0435:"hour",\u0447\u0430\u0441\u0438\u043A:"hour",\u0434\u0435\u043D\u044C:"d",\u0434\u043D\u044F:"d",\u0434\u043D\u0435\u0439:"d",\u0441\u0443\u0442\u043E\u043A:"d",\u0441\u0443\u0442\u043A\u0438:"d",\u043D\u0435\u0434\u0435\u043B\u044F:"week",\u043D\u0435\u0434\u0435\u043B\u0435:"week",\u043D\u0435\u0434\u0435\u043B\u0438:"week",\u043D\u0435\u0434\u0435\u043B\u044E:"week",\u043D\u0435\u0434\u0435\u043B\u044C:"week",\u043D\u0435\u0434\u0435\u043B\u044C\u043A\u0435:"week",\u043D\u0435\u0434\u0435\u043B\u044C\u043A\u0438:"week",\u043D\u0435\u0434\u0435\u043B\u0435\u043A:"week",\u043C\u0435\u0441\u044F\u0446:"month",\u043C\u0435\u0441\u044F\u0446\u0435:"month",\u043C\u0435\u0441\u044F\u0446\u0435\u0432:"month",\u043C\u0435\u0441\u044F\u0446\u0430:"month",\u043A\u0432\u0430\u0440\u0442\u0430\u043B:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u0435:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u043E\u0432:"quarter",\u0433\u043E\u0434:"year",\u0433\u043E\u0434\u0430:"year",\u0433\u043E\u0434\u0443:"year",\u0433\u043E\u0434\u043E\u0432:"year",\u043B\u0435\u0442:"year",\u0433\u043E\u0434\u0438\u043A:"year",\u0433\u043E\u0434\u0438\u043A\u0430:"year",\u0433\u043E\u0434\u0438\u043A\u043E\u0432:"year"},uG=`(?:${G(NE)}|[0-9]+|[0-9]+\\.[0-9]+|\u043F\u043E\u043B|\u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E|\u043F\u0430\u0440(?:\u044B|\u0443)|\\s{0,3})`;BE=`(?:${G(OE)}|[0-9]{1,2}(?:\u0433\u043E|\u043E\u0433\u043E|\u0435|\u043E\u0435)?)`;RE="(?:\\s+(?:\u0433\u043E\u0434\u0443|\u0433\u043E\u0434\u0430|\u0433\u043E\u0434|\u0433|\u0433.))?",ny=`(?:[1-9][0-9]{0,3}${RE}\\s*(?:\u043D.\u044D.|\u0434\u043E \u043D.\u044D.|\u043D. \u044D.|\u0434\u043E \u043D. \u044D.)|[1-2][0-9]{3}${RE}|[5-9][0-9]${RE})`;IL=`(${uG})\\s{0,3}(${G(of)})`,PL=new RegExp(IL,"i"),Rc=Hr("(?:(?:\u043E\u043A\u043E\u043B\u043E|\u043F\u0440\u0438\u043C\u0435\u0440\u043D\u043E)\\s{0,3})?",IL)});var RL,lf,NL=v(()=>{Cs();Se();te();RL=`(?:(?:\u043E\u043A\u043E\u043B\u043E|\u043F\u0440\u0438\u043C\u0435\u0440\u043D\u043E)\\s*(?:~\\s*)?)?(${Rc})${Ds.rightBoundary}`,lf=class extends B{patternLeftBoundary(){return Ds.leftBoundary}innerPattern(e){return e.option.forwardDate?new RegExp(RL,Ds.flags):new RegExp(`(?:\u0432 \u0442\u0435\u0447\u0435\u043D\u0438\u0435|\u0432 \u0442\u0435\u0447\u0435\u043D\u0438\u0438)\\s*${RL}`,Ds.flags)}innerExtract(e,t){let r=Nc(t[1]);return V.createRelativeFromReference(e.reference,r)}}});var Jo,ss,Bi=v(()=>{te();Cs();Jo=class extends B{patternLeftBoundary(){return Ds.leftBoundary}innerPattern(e){return new RegExp(this.innerPatternString(e),Ds.flags)}innerPatternHasChange(e,t){return!1}},ss=class extends Jo{innerPattern(e){return new RegExp(`${this.innerPatternString(e)}${Ds.rightBoundary}`,Ds.flags)}}});var OL,LL,pG,FL,cf,BL=v(()=>{Pt();Cs();Cs();Cs();Re();Bi();OL=1,LL=2,pG=3,FL=4,cf=class extends ss{innerPatternString(e){return`(?:\u0441)?\\s*(${BE})(?:\\s{0,3}(?:\u043F\u043E|-|\u2013|\u0434\u043E)?\\s{0,3}(${BE}))?(?:-|\\/|\\s{0,3}(?:of)?\\s{0,3})(${G(Ic)})(?:(?:-|\\/|,?\\s{0,3})(${ny}(?![^\\s]\\d)))?`}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=Ic[t[pG].toLowerCase()],i=HE(t[OL]);if(i>31)return t.index=t.index+t[OL].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[FL]){let a=iy(t[FL]);r.start.assign("year",a)}else{let a=Je(e.refDate,i,s);r.start.imply("year",a)}if(t[LL]){let a=HE(t[LL]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var mG,HL,df,UL=v(()=>{Cs();Pt();Re();Cs();Bi();mG=2,HL=3,df=class extends Jo{innerPatternString(e){return`((?:\u0432)\\s*)?(${G(Ic)})\\s*(?:[,-]?\\s*(${ny})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`}innerExtract(e,t){let r=t[mG].toLowerCase();if(t[0].length<=3&&!FE[r])return null;let s=e.createParsingResult(t.index,t.index+t[0].length);s.start.imply("day",1);let i=Ic[r];if(s.start.assign("month",i),t[HL]){let a=iy(t[HL]);s.start.assign("year",a)}else{let a=Je(e.refDate,1,i);s.start.imply("year",a)}return s}}});var uf,WL=v(()=>{Ue();Ri();Cs();uf=class extends ir{constructor(e){super(e)}patternFlags(){return Ds.flags}primaryPatternLeftBoundary(){return"(^|\\s|T|(?:[^\\p{L}\\p{N}_]))"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|\u0434\u043E|\u0438|\u043F\u043E|\\?)\\s*"}primaryPrefix(){return"(?:(?:\u0432|\u0441)\\s*)??"}primarySuffix(){return`(?:\\s*(?:\u0443\u0442\u0440\u0430|\u0432\u0435\u0447\u0435\u0440\u0430|\u043F\u043E\u0441\u043B\u0435 \u043F\u043E\u043B\u0443\u0434\u043D\u044F))?(?!\\/)${Ds.rightBoundary}`}extractPrimaryTimeComponents(e,t){let r=super.extractPrimaryTimeComponents(e,t);if(r){if(t[0].endsWith("\u0432\u0435\u0447\u0435\u0440\u0430")){let s=r.get("hour");s>=6&&s<12?(r.assign("hour",r.get("hour")+12),r.assign("meridiem",N.PM)):s<6&&r.assign("meridiem",N.AM)}if(t[0].endsWith("\u043F\u043E\u0441\u043B\u0435 \u043F\u043E\u043B\u0443\u0434\u043D\u044F")){r.assign("meridiem",N.PM);let s=r.get("hour");s>=0&&s<=6&&r.assign("hour",r.get("hour")+12)}t[0].endsWith("\u0443\u0442\u0440\u0430")&&(r.assign("meridiem",N.AM),r.get("hour")<12&&r.assign("hour",r.get("hour")))}return r}}});var hf,$L=v(()=>{Cs();Se();Es();Bi();hf=class extends Jo{innerPatternString(e){return`(${Rc})\\s{0,5}\u043D\u0430\u0437\u0430\u0434(?=(?:\\W|$))`}innerExtract(e,t){let r=Nc(t[1]),s=Vt(r);return V.createRelativeFromReference(e.reference,s)}}});var ff,jL=v(()=>{Ys();ff=class extends vt{patternBetween(){return/^\s*(и до|и по|до|по|-)\s*$/i}}});var pf,VL=v(()=>{zs();pf=class extends Tt{patternBetween(){return new RegExp("^\\s*(T|\u0432|,|-)?\\s*$")}}});var mf,YL=v(()=>{ks();Bi();mf=class extends ss{innerPatternString(e){return"(?:\u0441|\u0441\u043E)?\\s*(\u0441\u0435\u0433\u043E\u0434\u043D\u044F|\u0432\u0447\u0435\u0440\u0430|\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u043E\u0441\u043B\u0435\u043F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u043E\u0437\u0430\u043F\u043E\u0437\u0430\u0432\u0447\u0435\u0440\u0430|\u043F\u043E\u0437\u0430\u0432\u0447\u0435\u0440\u0430)"}innerExtract(e,t){let r=t[1].toLowerCase(),s=e.createParsingComponents();switch(r){case"\u0441\u0435\u0433\u043E\u0434\u043D\u044F":return ar(e.reference);case"\u0432\u0447\u0435\u0440\u0430":return Pr(e.reference);case"\u0437\u0430\u0432\u0442\u0440\u0430":return Ir(e.reference);case"\u043F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430":return Zn(e.reference,2);case"\u043F\u043E\u0441\u043B\u0435\u043F\u043E\u0441\u043B\u0435\u0437\u0430\u0432\u0442\u0440\u0430":return Zn(e.reference,3);case"\u043F\u043E\u0437\u0430\u0432\u0447\u0435\u0440\u0430":return No(e.reference,2);case"\u043F\u043E\u0437\u0430\u043F\u043E\u0437\u0430\u0432\u0447\u0435\u0440\u0430":return No(e.reference,3)}return s}}});var zL,gf,qL=v(()=>{ks();ws();zL=ke(Ye(),1);Bi();gf=class extends ss{innerPatternString(e){return"(\u0441\u0435\u0439\u0447\u0430\u0441|\u043F\u0440\u043E\u0448\u043B\u044B\u043C\\s*\u0432\u0435\u0447\u0435\u0440\u043E\u043C|\u043F\u0440\u043E\u0448\u043B\u043E\u0439\\s*\u043D\u043E\u0447\u044C\u044E|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0439\\s*\u043D\u043E\u0447\u044C\u044E|\u0441\u0435\u0433\u043E\u0434\u043D\u044F\\s*\u043D\u043E\u0447\u044C\u044E|\u044D\u0442\u043E\u0439\\s*\u043D\u043E\u0447\u044C\u044E|\u043D\u043E\u0447\u044C\u044E|\u044D\u0442\u0438\u043C \u0443\u0442\u0440\u043E\u043C|\u0443\u0442\u0440\u043E\u043C|\u0443\u0442\u0440\u0430|\u0432\\s*\u043F\u043E\u043B\u0434\u0435\u043D\u044C|\u0432\u0435\u0447\u0435\u0440\u043E\u043C|\u0432\u0435\u0447\u0435\u0440\u0430|\u0432\\s*\u043F\u043E\u043B\u043D\u043E\u0447\u044C)"}innerExtract(e,t){let r=(0,zL.default)(e.refDate),s=t[0].toLowerCase(),i=e.createParsingComponents();if(s==="\u0441\u0435\u0439\u0447\u0430\u0441")return Ar(e.reference);if(s==="\u0432\u0435\u0447\u0435\u0440\u043E\u043C"||s==="\u0432\u0435\u0447\u0435\u0440\u0430")return vc(e.reference);if(s.endsWith("\u0443\u0442\u0440\u043E\u043C")||s.endsWith("\u0443\u0442\u0440\u0430"))return Tc(e.reference);if(s.match(/в\s*полдень/))return wc(e.reference);if(s.match(/прошлой\s*ночью/))return _g(e.reference);if(s.match(/прошлым\s*вечером/))return Ag(e.reference);if(s.match(/следующей\s*ночью/)){let a=r.hour()<22?1:2;r=r.add(a,"day"),ft(i,r),i.imply("hour",0)}return s.match(/в\s*полночь/)||s.endsWith("\u043D\u043E\u0447\u044C\u044E")?Oo(e.reference):i}}});var gG,yG,vG,yf,GL=v(()=>{Cs();Re();kn();Bi();gG=1,yG=2,vG=3,yf=class extends ss{innerPatternString(e){return`(?:(?:,|\\(|\uFF08)\\s*)?(?:\u0432\\s*?)?(?:(\u044D\u0442\u0443|\u044D\u0442\u043E\u0442|\u043F\u0440\u043E\u0448\u043B\u044B\u0439|\u043F\u0440\u043E\u0448\u043B\u0443\u044E|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0443\u044E|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0433\u043E)\\s*)?(${G(LE)})(?:\\s*(?:,|\\)|\uFF09))?(?:\\s*\u043D\u0430\\s*(\u044D\u0442\u043E\u0439|\u043F\u0440\u043E\u0448\u043B\u043E\u0439|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0439)\\s*\u043D\u0435\u0434\u0435\u043B\u0435)?`}innerExtract(e,t){let r=t[yG].toLowerCase(),s=LE[r],i=t[gG],a=t[vG],o=i||a;o=o||"",o=o.toLowerCase();let l=null;return o=="\u043F\u0440\u043E\u0448\u043B\u044B\u0439"||o=="\u043F\u0440\u043E\u0448\u043B\u0443\u044E"||o=="\u043F\u0440\u043E\u0448\u043B\u043E\u0439"?l="last":o=="\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439"||o=="\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0443\u044E"||o=="\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0439"||o=="\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0433\u043E"?l="next":(o=="\u044D\u0442\u043E\u0442"||o=="\u044D\u0442\u0443"||o=="\u044D\u0442\u043E\u0439")&&(l="this"),Yt(e.reference,s,l)}}});var QL,TG,wG,vf,KL=v(()=>{Cs();Se();QL=ke(Ye(),1);Re();Bi();TG=1,wG=2,vf=class extends ss{innerPatternString(e){return`(\u0432 \u043F\u0440\u043E\u0448\u043B\u043E\u043C|\u043D\u0430 \u043F\u0440\u043E\u0448\u043B\u043E\u0439|\u043D\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0439|\u0432 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u043C|\u043D\u0430 \u044D\u0442\u043E\u0439|\u0432 \u044D\u0442\u043E\u043C)\\s*(${G(of)})`}innerExtract(e,t){let r=t[TG].toLowerCase(),s=t[wG].toLowerCase(),i=of[s];if(r=="\u043D\u0430 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u0439"||r=="\u0432 \u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0435\u043C"){let l={};return l[i]=1,V.createRelativeFromReference(e.reference,l)}if(r=="\u0432 \u043F\u0440\u043E\u0448\u043B\u043E\u043C"||r=="\u043D\u0430 \u043F\u0440\u043E\u0448\u043B\u043E\u0439"){let l={};return l[i]=-1,V.createRelativeFromReference(e.reference,l)}let a=e.createParsingComponents(),o=(0,QL.default)(e.reference.instant);return i.match(/week/i)?(o=o.add(-o.get("d"),"d"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.imply("year",o.year())):i.match(/month/i)?(o=o.add(-o.date()+1,"d"),a.imply("day",o.date()),a.assign("year",o.year()),a.assign("month",o.month()+1)):i.match(/year/i)&&(o=o.add(-o.date()+1,"d"),o=o.add(-o.month(),"month"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.assign("year",o.year())),a}}});var Tf,ZL=v(()=>{Cs();Se();Es();Bi();Tf=class extends ss{innerPatternString(e){return`(\u044D\u0442\u0438|\u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0435|\u043F\u0440\u043E\u0448\u043B\u044B\u0435|\u0441\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0435|\u043F\u043E\u0441\u043B\u0435|\u0441\u043F\u0443\u0441\u0442\u044F|\u0447\u0435\u0440\u0435\u0437|\\+|-)\\s*(${Rc})`}innerExtract(e,t){let r=t[1].toLowerCase(),s=Nc(t[2]);switch(r){case"\u043F\u043E\u0441\u043B\u0435\u0434\u043D\u0438\u0435":case"\u043F\u0440\u043E\u0448\u043B\u044B\u0435":case"-":s=Vt(s);break}return V.createRelativeFromReference(e.reference,s)}}});var $E={};nt($E,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>UE,createCasualConfiguration:()=>JL,createConfiguration:()=>WE,parse:()=>kG,parseDate:()=>EG,strict:()=>bG});function kG(n,e,t){return UE.parse(n,e,t)}function EG(n,e,t){return UE.parseDate(n,e,t)}function JL(){let n=WE(!1);return n.parsers.unshift(new mf),n.parsers.unshift(new gf),n.parsers.unshift(new df),n.parsers.unshift(new vf),n.parsers.unshift(new Tf),n}function WE(n=!0){return kt({parsers:[new er(!0),new lf,new cf,new yf,new uf(n),new hf],refiners:[new pf,new ff]},n)}var UE,bG,XL=v(()=>{NL();BL();UL();WL();$L();jL();VL();bs();YL();qL();GL();KL();rs();Se();Ue();Li();ZL();UE=new fe(JL()),bG=new fe(WE(!0))});function DG(n){let e=n.toLowerCase();return jE[e]!==void 0?jE[e]:e==="un"||e==="una"||e==="uno"?1:e.match(/algunos?/)||e.match(/unos?/)?3:e.match(/media?/)?.5:parseFloat(e)}function sF(n){if(n.match(/^[0-9]{1,4}$/)){let e=parseInt(n);return e<100&&(e>50?e=e+1900:e=e+2e3),e}return n.match(/a\.?\s*c\.?/i)?(n=n.replace(/a\.?\s*c\.?/i,""),-parseInt(n)):parseInt(n)}function aF(n){let e={},t=n,r=eF.exec(t);for(;r;)CG(e,r),t=t.substring(r[0].length),r=eF.exec(t);return e}function CG(n,e){let t=DG(e[1]),r=tF[e[2].toLowerCase()];n[r]=t}var VE,YE,jE,tF,SG,rF,nF,eF,iF,wf=v(()=>{Re();VE={domingo:0,dom:0,lunes:1,lun:1,martes:2,mar:2,mi\u00E9rcoles:3,miercoles:3,mi\u00E9:3,mie:3,jueves:4,jue:4,viernes:5,vie:5,s\u00E1bado:6,sabado:6,s\u00E1b:6,sab:6},YE={enero:1,ene:1,"ene.":1,febrero:2,feb:2,"feb.":2,marzo:3,mar:3,"mar.":3,abril:4,abr:4,"abr.":4,mayo:5,may:5,"may.":5,junio:6,jun:6,"jun.":6,julio:7,jul:7,"jul.":7,agosto:8,ago:8,"ago.":8,septiembre:9,setiembre:9,sep:9,"sep.":9,octubre:10,oct:10,"oct.":10,noviembre:11,nov:11,"nov.":11,diciembre:12,dic:12,"dic.":12},jE={uno:1,dos:2,tres:3,cuatro:4,cinco:5,seis:6,siete:7,ocho:8,nueve:9,diez:10,once:11,doce:12,trece:13},tF={sec:"second",segundo:"second",segundos:"second",min:"minute",mins:"minute",minuto:"minute",minutos:"minute",h:"hour",hr:"hour",hrs:"hour",hora:"hour",horas:"hour",d\u00EDa:"d",d\u00EDas:"d",semana:"week",semanas:"week",mes:"month",meses:"month",cuarto:"quarter",cuartos:"quarter",a\u00F1o:"year",a\u00F1os:"year"},SG=`(?:${G(jE)}|[0-9]+|[0-9]+\\.[0-9]+|un?|uno?|una?|algunos?|unos?|demi-?)`;rF="[0-9]{1,4}(?![^\\s]\\d)(?:\\s*[a|d]\\.?\\s*c\\.?|\\s*a\\.?\\s*d\\.?)?";nF=`(${SG})\\s{0,5}(${G(tF)})\\s{0,5}`,eF=new RegExp(nF,"i"),iF=Hr("",nF)});var xG,MG,_G,AG,bf,oF=v(()=>{wf();Re();te();kn();xG=new RegExp(`(?:(?:\\,|\\(|\\\uFF08)\\s*)?(?:(este|esta|pasado|pr[o\xF3]ximo)\\s*)?(${G(VE)})(?:\\s*(?:\\,|\\)|\\\uFF09))?(?:\\s*(este|esta|pasado|pr[\xF3o]ximo)\\s*semana)?(?=\\W|\\d|$)`,"i"),MG=1,_G=2,AG=3,bf=class extends B{innerPattern(){return xG}innerExtract(e,t){let r=t[_G].toLowerCase(),s=VE[r];if(s===void 0)return null;let i=t[MG],a=t[AG],o=i||a||"";o=o.toLowerCase();let l=null;return o=="pasado"?l="this":o=="pr\xF3ximo"||o=="proximo"?l="next":o=="este"&&(l="this"),Yt(e.reference,s,l)}}});var kf,lF=v(()=>{Ri();kf=class extends ir{primaryPrefix(){return"(?:(?:aslas|deslas|las?|al?|de|del)\\s*)?"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|a(?:l)?|\\?)\\s*"}}});var Ef,cF=v(()=>{zs();Ef=class extends Tt{patternBetween(){return new RegExp("^\\s*(?:,|de|aslas|a)?\\s*$")}}});var Sf,dF=v(()=>{Ys();Sf=class extends vt{patternBetween(){return/^\s*(?:-)\s*$/i}}});var PG,uF,hF,IG,fF,Df,pF=v(()=>{Pt();wf();wf();Re();te();PG=new RegExp(`([0-9]{1,2})(?:\xBA|\xAA|\xB0)?(?:\\s*(?:desde|de|\\-|\\\u2013|ao?|\\s)\\s*([0-9]{1,2})(?:\xBA|\xAA|\xB0)?)?\\s*(?:de)?\\s*(?:-|/|\\s*(?:de|,)?\\s*)(${G(YE)})(?:\\s*(?:de|,)?\\s*(${rF}))?(?=\\W|$)`,"i"),uF=1,hF=2,IG=3,fF=4,Df=class extends B{innerPattern(){return PG}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=YE[t[IG].toLowerCase()],i=parseInt(t[uF]);if(i>31)return t.index=t.index+t[uF].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[fF]){let a=sF(t[fF]);r.start.assign("year",a)}else{let a=Je(e.refDate,i,s);r.start.imply("year",a)}if(t[hF]){let a=parseInt(t[hF]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var Cf,mF=v(()=>{te();ks();Cf=class extends B{innerPattern(e){return/(ahora|hoy|mañana|ayer)(?=\W|$)/i}innerExtract(e,t){let r=t[0].toLowerCase(),s=e.createParsingComponents();switch(r){case"ahora":return Ar(e.reference);case"hoy":return ar(e.reference);case"ma\xF1ana":return Ir(e.reference);case"ayer":return Pr(e.reference)}return s}}});var gF,xf,yF=v(()=>{Ue();te();ws();gF=ke(Ye(),1),xf=class extends B{innerPattern(){return/(?:esta\s*)?(mañana|tarde|medianoche|mediodia|mediodía|noche)(?=\W|$)/i}innerExtract(e,t){let r=(0,gF.default)(e.refDate),s=e.createParsingComponents();switch(t[1].toLowerCase()){case"tarde":s.imply("meridiem",N.PM),s.imply("hour",15);break;case"noche":s.imply("meridiem",N.PM),s.imply("hour",22);break;case"ma\xF1ana":s.imply("meridiem",N.AM),s.imply("hour",6);break;case"medianoche":wn(s,r),s.imply("hour",0),s.imply("minute",0),s.imply("second",0);break;case"mediodia":case"mediod\xEDa":s.imply("meridiem",N.AM),s.imply("hour",12);break}return s}}});var Mf,vF=v(()=>{wf();Se();te();Mf=class extends B{innerPattern(){return new RegExp(`(?:en|por|durante|de|dentro de)\\s*(${iF})(?=\\W|$)`,"i")}innerExtract(e,t){let r=aF(t[1]);return V.createRelativeFromReference(e.reference,r)}}});var GE={};nt(GE,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>zE,createCasualConfiguration:()=>TF,createConfiguration:()=>qE,parse:()=>NG,parseDate:()=>OG,strict:()=>RG});function NG(n,e,t){return zE.parse(n,e,t)}function OG(n,e,t){return zE.parseDate(n,e,t)}function TF(n=!0){let e=qE(!1,n);return e.parsers.push(new Cf),e.parsers.push(new xf),e}function qE(n=!0,e=!0){return kt({parsers:[new er(e),new bf,new kf,new Df,new Mf],refiners:[new Ef,new Sf]},n)}var zE,RG,wF=v(()=>{bs();rs();Se();Ue();Li();oF();lF();cF();dF();pF();mF();yF();vF();zE=new fe(TF()),RG=new fe(qE(!0))});function FG(n){let e=n.toLowerCase();return KE[e]!==void 0?KE[e]:e.match(/декілька/)?2:e.match(/пів/)?.5:e.match(/пар/)?2:e===""?1:parseFloat(e)}function tS(n){let e=n.toLowerCase();return ZE[e]!==void 0?ZE[e]:parseInt(e)}function oy(n){if(/(рік|року|р|р.)/i.test(n)&&(n=n.replace(/(рік|року|р|р.)/i,"")),/(до н.е.|до н. е.)/i.test(n))return n=n.replace(/(до н.е.|до н. е.)/i,""),-parseInt(n);if(/(н. е.|н.е.)/i.test(n))return n=n.replace(/(н. е.|н.е.)/i,""),parseInt(n);let e=parseInt(n);return es(e)}function Fc(n){let e={},t=n,r=bF.exec(t);for(;r;)BG(e,r),t=t.substring(r[0].length).trim(),r=bF.exec(t);return e}function BG(n,e){let t=FG(e[1]),r=_f[e[2].toLowerCase()];n[r]=t}var Js,JE,XE,Oc,KE,ZE,_f,LG,eS,QE,ay,kF,bF,Lc,xs=v(()=>{Re();Pt();Js={leftBoundary:"([^\\p{L}\\p{N}_]|^)",rightBoundary:"(?=[^\\p{L}\\p{N}_]|$)",flags:"iu"},JE={\u043D\u0435\u0434\u0456\u043B\u044F:0,\u043D\u0435\u0434\u0456\u043B\u0456:0,\u043D\u0435\u0434\u0456\u043B\u044E:0,\u043D\u0434:0,"\u043D\u0434.":0,\u043F\u043E\u043D\u0435\u0434\u0456\u043B\u043E\u043A:1,\u043F\u043E\u043D\u0435\u0434\u0456\u043B\u043A\u0430:1,\u043F\u043D:1,"\u043F\u043D.":1,\u0432\u0456\u0432\u0442\u043E\u0440\u043E\u043A:2,\u0432\u0456\u0432\u0442\u043E\u0440\u043A\u0430:2,\u0432\u0442:2,"\u0432\u0442.":2,\u0441\u0435\u0440\u0435\u0434\u0430:3,\u0441\u0435\u0440\u0435\u0434\u0438:3,\u0441\u0435\u0440\u0435\u0434\u0443:3,\u0441\u0440:3,"\u0441\u0440.":3,\u0447\u0435\u0442\u0432\u0435\u0440:4,\u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0430:4,\u0447\u0435\u0442\u0432\u0435\u0440\u0433\u0443:4,\u0447\u0442:4,"\u0447\u0442.":4,"\u043F'\u044F\u0442\u043D\u0438\u0446\u044F":5,"\u043F'\u044F\u0442\u043D\u0438\u0446\u0456":5,"\u043F'\u044F\u0442\u043D\u0438\u0446\u044E":5,\u043F\u0442:5,"\u043F\u0442.":5,\u0441\u0443\u0431\u043E\u0442\u0430:6,\u0441\u0443\u0431\u043E\u0442\u0438:6,\u0441\u0443\u0431\u043E\u0442\u0443:6,\u0441\u0431:6,"\u0441\u0431.":6},XE={\u0441\u0456\u0447\u0435\u043D\u044C:1,\u0441\u0456\u0447\u043D\u044F:1,\u0441\u0456\u0447\u043D\u0456:1,\u043B\u044E\u0442\u0438\u0439:2,\u043B\u044E\u0442\u043E\u0433\u043E:2,\u043B\u044E\u0442\u043E\u043C\u0443:2,\u0431\u0435\u0440\u0435\u0437\u0435\u043D\u044C:3,\u0431\u0435\u0440\u0435\u0437\u043D\u044F:3,\u0431\u0435\u0440\u0435\u0437\u043D\u0456:3,\u043A\u0432\u0456\u0442\u0435\u043D\u044C:4,\u043A\u0432\u0456\u0442\u043D\u044F:4,\u043A\u0432\u0456\u0442\u043D\u0456:4,\u0442\u0440\u0430\u0432\u0435\u043D\u044C:5,\u0442\u0440\u0430\u0432\u043D\u044F:5,\u0442\u0440\u0430\u0432\u043D\u0456:5,\u0447\u0435\u0440\u0432\u0435\u043D\u044C:6,\u0447\u0435\u0440\u0432\u043D\u044F:6,\u0447\u0435\u0440\u0432\u043D\u0456:6,\u043B\u0438\u043F\u0435\u043D\u044C:7,\u043B\u0438\u043F\u043D\u044F:7,\u043B\u0438\u043F\u043D\u0456:7,\u0441\u0435\u0440\u043F\u0435\u043D\u044C:8,\u0441\u0435\u0440\u043F\u043D\u044F:8,\u0441\u0435\u0440\u043F\u043D\u0456:8,\u0432\u0435\u0440\u0435\u0441\u0435\u043D\u044C:9,\u0432\u0435\u0440\u0435\u0441\u043D\u044F:9,\u0432\u0435\u0440\u0435\u0441\u043D\u0456:9,\u0436\u043E\u0432\u0442\u0435\u043D\u044C:10,\u0436\u043E\u0432\u0442\u043D\u044F:10,\u0436\u043E\u0432\u0442\u043D\u0456:10,\u043B\u0438\u0441\u0442\u043E\u043F\u0430\u0434:11,\u043B\u0438\u0441\u0442\u043E\u043F\u0430\u0434\u0430:11,\u043B\u0438\u0441\u0442\u043E\u043F\u0430\u0434\u0443:11,\u0433\u0440\u0443\u0434\u0435\u043D\u044C:12,\u0433\u0440\u0443\u0434\u043D\u044F:12,\u0433\u0440\u0443\u0434\u043D\u0456:12},Oc={...XE,\u0441\u0456\u0447:1,"\u0441\u0456\u0447.":1,\u043B\u044E\u0442:2,"\u043B\u044E\u0442.":2,\u0431\u0435\u0440:3,"\u0431\u0435\u0440.":3,\u043A\u0432\u0456\u0442:4,"\u043A\u0432\u0456\u0442.":4,\u0442\u0440\u0430\u0432:5,"\u0442\u0440\u0430\u0432.":5,\u0447\u0435\u0440\u0432:6,"\u0447\u0435\u0440\u0432.":6,\u043B\u0438\u043F:7,"\u043B\u0438\u043F.":7,\u0441\u0435\u0440\u043F:8,"\u0441\u0435\u0440\u043F.":8,\u0441\u0435\u0440:8,"c\u0435\u0440.":8,\u0432\u0435\u0440:9,"\u0432\u0435\u0440.":9,\u0432\u0435\u0440\u0435\u0441:9,"\u0432\u0435\u0440\u0435\u0441.":9,\u0436\u043E\u0432\u0442:10,"\u0436\u043E\u0432\u0442.":10,\u043B\u0438\u0441\u0442\u043E\u043F:11,"\u043B\u0438\u0441\u0442\u043E\u043F.":11,\u0433\u0440\u0443\u0434:12,"\u0433\u0440\u0443\u0434.":12},KE={\u043E\u0434\u0438\u043D:1,\u043E\u0434\u043D\u0430:1,\u043E\u0434\u043D\u043E\u0457:1,\u043E\u0434\u043D\u0443:1,\u0434\u0432\u0456:2,\u0434\u0432\u0430:2,\u0434\u0432\u043E\u0445:2,\u0442\u0440\u0438:3,\u0442\u0440\u044C\u043E\u0445:3,\u0447\u043E\u0442\u0438\u0440\u0438:4,\u0447\u043E\u0442\u0438\u0440\u044C\u043E\u0445:4,"\u043F'\u044F\u0442\u044C":5,"\u043F'\u044F\u0442\u0438":5,\u0448\u0456\u0441\u0442\u044C:6,\u0448\u0435\u0441\u0442\u0438:6,\u0441\u0456\u043C:7,\u0441\u0435\u043C\u0438:7,\u0432\u0456\u0441\u0456\u043C:8,\u0432\u043E\u0441\u044C\u043C\u0438:8,"\u0434\u0435\u0432'\u044F\u0442\u044C":9,"\u0434\u0435\u0432'\u044F\u0442\u0438":9,\u0434\u0435\u0441\u044F\u0442\u044C:10,\u0434\u0435\u0441\u044F\u0442\u0438:10,\u043E\u0434\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u044C:11,\u043E\u0434\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u0438:11,\u0434\u0432\u0430\u043D\u0430\u0434\u0446\u044F\u0442\u044C:12,\u0434\u0432\u0430\u043D\u0430\u0434\u0446\u044F\u0442\u0438:12},ZE={\u043F\u0435\u0440\u0448\u0435:1,\u043F\u0435\u0440\u0448\u043E\u0433\u043E:1,\u0434\u0440\u0443\u0433\u0435:2,\u0434\u0440\u0443\u0433\u043E\u0433\u043E:2,\u0442\u0440\u0435\u0442\u0454:3,\u0442\u0440\u0435\u0442\u044C\u043E\u0433\u043E:3,\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0435:4,\u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0433\u043E:4,"\u043F'\u044F\u0442\u0435":5,"\u043F'\u044F\u0442\u043E\u0433\u043E":5,\u0448\u043E\u0441\u0442\u0435:6,\u0448\u043E\u0441\u0442\u043E\u0433\u043E:6,\u0441\u044C\u043E\u043C\u0435:7,\u0441\u044C\u043E\u043C\u043E\u0433\u043E:7,\u0432\u043E\u0441\u044C\u043C\u0435:8,\u0432\u043E\u0441\u044C\u043C\u043E\u0433\u043E:8,"\u0434\u0435\u0432'\u044F\u0442\u0435":9,"\u0434\u0435\u0432'\u044F\u0442\u043E\u0433\u043E":9,\u0434\u0435\u0441\u044F\u0442\u0435:10,\u0434\u0435\u0441\u044F\u0442\u043E\u0433\u043E:10,\u043E\u0434\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u0435:11,\u043E\u0434\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:11,\u0434\u0432\u0430\u043D\u0430\u0434\u0446\u044F\u0442\u0435:12,\u0434\u0432\u0430\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:12,\u0442\u0440\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u0435:13,\u0442\u0440\u0438\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:13,\u0447\u043E\u0442\u0438\u0440\u043D\u0430\u0434\u0446\u044F\u0442\u0435:14,\u0447\u043E\u0442\u0438\u043D\u0440\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:14,"\u043F'\u044F\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u0435":15,"\u043F'\u044F\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E":15,\u0448\u0456\u0441\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u0435:16,\u0448\u0456\u0441\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:16,\u0441\u0456\u043C\u043D\u0430\u0434\u0446\u044F\u0442\u0435:17,\u0441\u0456\u043C\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:17,\u0432\u0456\u0441\u0456\u043C\u043D\u0430\u0434\u0446\u044F\u0442\u0435:18,\u0432\u0456\u0441\u0456\u043C\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:18,"\u0434\u0435\u0432'\u044F\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u0435":19,"\u0434\u0435\u0432'\u044F\u0442\u043D\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E":19,\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u0435:20,\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u043E\u0433\u043E:20,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u043F\u0435\u0440\u0448\u0435":21,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u043F\u0435\u0440\u0448\u043E\u0433\u043E":21,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0434\u0440\u0443\u0433\u0435":22,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0434\u0440\u0443\u0433\u043E\u0433\u043E":22,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0442\u0440\u0435\u0442\u0454":23,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0442\u0440\u0435\u0442\u044C\u043E\u0433\u043E":23,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u0435":24,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0447\u0435\u0442\u0432\u0435\u0440\u0442\u043E\u0433\u043E":24,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u043F'\u044F\u0442\u0435":25,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u043F'\u044F\u0442\u043E\u0433\u043E":25,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0448\u043E\u0441\u0442\u0435":26,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0448\u043E\u0441\u0442\u043E\u0433\u043E":26,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0441\u044C\u043E\u043C\u0435":27,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0441\u044C\u043E\u043C\u043E\u0433\u043E":27,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0432\u043E\u0441\u044C\u043C\u0435":28,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0432\u043E\u0441\u044C\u043C\u043E\u0433\u043E":28,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0434\u0435\u0432'\u044F\u0442\u0435":29,"\u0434\u0432\u0430\u0434\u0446\u044F\u0442\u044C \u0434\u0435\u0432'\u044F\u0442\u043E\u0433\u043E":29,\u0442\u0440\u0438\u0434\u0446\u044F\u0442\u0435:30,\u0442\u0440\u0438\u0434\u0446\u044F\u0442\u043E\u0433\u043E:30,"\u0442\u0440\u0438\u0434\u0446\u044F\u0442\u044C \u043F\u0435\u0440\u0448\u0435":31,"\u0442\u0440\u0438\u0434\u0446\u044F\u0442\u044C \u043F\u0435\u0440\u0448\u043E\u0433\u043E":31},_f={\u0441\u0435\u043A:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u0430:"second",\u0441\u0435\u043A\u0443\u043D\u0434:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u0438:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u0443:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043E\u043A:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043A\u0438:"second",\u0441\u0435\u043A\u0443\u043D\u0434\u043E\u0447\u043A\u0443:"second",\u0445\u0432:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u0430:"minute",\u0445\u0432\u0438\u043B\u0438\u043D:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u0438:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u0443:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043E\u043A:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043A\u0438:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043A\u0443:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043E\u0447\u043E\u043A:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043E\u0447\u043A\u0438:"minute",\u0445\u0432\u0438\u043B\u0438\u043D\u043E\u0447\u043A\u0443:"minute",\u0433\u043E\u0434:"hour",\u0433\u043E\u0434\u0438\u043D\u0430:"hour",\u0433\u043E\u0434\u0438\u043D:"hour",\u0433\u043E\u0434\u0438\u043D\u0438:"hour",\u0433\u043E\u0434\u0438\u043D\u0443:"hour",\u0433\u043E\u0434\u0438\u043D\u043A\u0430:"hour",\u0433\u043E\u0434\u0438\u043D\u043E\u043A:"hour",\u0433\u043E\u0434\u0438\u043D\u043A\u0438:"hour",\u0433\u043E\u0434\u0438\u043D\u043A\u0443:"hour",\u0434\u0435\u043D\u044C:"d",\u0434\u043D\u044F:"d",\u0434\u043D\u0456\u0432:"d",\u0434\u043D\u0456:"d",\u0434\u043E\u0431\u0430:"d",\u0434\u043E\u0431\u0443:"d",\u0442\u0438\u0436\u0434\u0435\u043D\u044C:"week",\u0442\u0438\u0436\u043D\u044E:"week",\u0442\u0438\u0436\u043D\u044F:"week",\u0442\u0438\u0436\u043D\u0456:"week",\u0442\u0438\u0436\u043D\u0456\u0432:"week",\u043C\u0456\u0441\u044F\u0446\u044C:"month",\u043C\u0456\u0441\u044F\u0446\u0456\u0432:"month",\u043C\u0456\u0441\u044F\u0446\u0456:"month",\u043C\u0456\u0441\u044F\u0446\u044F:"month",\u043A\u0432\u0430\u0440\u0442\u0430\u043B:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u0443:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u0430:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u0456\u0432:"quarter",\u043A\u0432\u0430\u0440\u0442\u0430\u043B\u0456:"quarter",\u0440\u0456\u043A:"year",\u0440\u043E\u043A\u0443:"year",\u0440\u043E\u0446\u0456:"year",\u0440\u043E\u043A\u0456\u0432:"year",\u0440\u043E\u043A\u0438:"year"},LG=`(?:${G(KE)}|[0-9]+|[0-9]+\\.[0-9]+|\u043F\u0456\u0432|\u0434\u0435\u043A\u0456\u043B\u044C\u043A\u0430|\u043F\u0430\u0440(?:\u0443)|\\s{0,3})`;eS=`(?:${G(ZE)}|[0-9]{1,2}(?:\u0433\u043E|\u043E\u0433\u043E|\u0435)?)`;QE="(?:\\s+(?:\u0440\u043E\u043A\u0443|\u0440\u0456\u043A|\u0440|\u0440.))?",ay=`(?:[1-9][0-9]{0,3}${QE}\\s*(?:\u043D.\u0435.|\u0434\u043E \u043D.\u0435.|\u043D. \u0435.|\u0434\u043E \u043D. \u0435.)|[1-2][0-9]{3}${QE}|[5-9][0-9]${QE})`;kF=`(${LG})\\s{0,3}(${G(_f)})`,bF=new RegExp(kF,"i"),Lc=Hr("(?:(?:\u0431\u043B\u0438\u0437\u044C\u043A\u043E|\u043F\u0440\u0438\u0431\u043B\u0438\u0437\u043D\u043E)\\s{0,3})?",kF)});var EF,Af,SF=v(()=>{xs();Se();te();EF=`(?:(?:\u043F\u0440\u0438\u0431\u043B\u0438\u0437\u043D\u043E|\u043E\u0440\u0456\u0454\u043D\u0442\u043E\u0432\u043D\u043E)\\s*(?:~\\s*)?)?(${Lc})${Js.rightBoundary}`,Af=class extends B{patternLeftBoundary(){return Js.leftBoundary}innerPattern(e){return e.option.forwardDate?new RegExp(EF,"i"):new RegExp(`(?:\u043F\u0440\u043E\u0442\u044F\u0433\u043E\u043C|\u043D\u0430 \u043F\u0440\u043E\u0442\u044F\u0437\u0456|\u043F\u0440\u043E\u0442\u044F\u0433\u043E\u043C|\u0443\u043F\u0440\u043E\u0434\u043E\u0432\u0436|\u0432\u043F\u0440\u043E\u0434\u043E\u0432\u0436)\\s*${EF}`,Js.flags)}innerExtract(e,t){let r=Fc(t[1]);return V.createRelativeFromReference(e.reference,r)}}});var Xo,ns,Hi=v(()=>{te();xs();Xo=class extends B{patternLeftBoundary(){return Js.leftBoundary}innerPattern(e){return new RegExp(this.innerPatternString(e),Js.flags)}innerPatternHasChange(e,t){return!1}},ns=class extends Xo{innerPattern(e){return new RegExp(`${this.innerPatternString(e)}${Js.rightBoundary}`,Js.flags)}}});var DF,CF,HG,xF,Pf,MF=v(()=>{Pt();xs();xs();xs();Re();Hi();DF=1,CF=2,HG=3,xF=4,Pf=class extends ns{innerPatternString(e){return`(?:\u0437|\u0456\u0437)?\\s*(${eS})(?:\\s{0,3}(?:\u043F\u043E|-|\u2013|\u0434\u043E)?\\s{0,3}(${eS}))?(?:-|\\/|\\s{0,3}(?:of)?\\s{0,3})(${G(Oc)})(?:(?:-|\\/|,?\\s{0,3})(${ay}(?![^\\s]\\d)))?`}innerExtract(e,t){let r=e.createParsingResult(t.index,t[0]),s=Oc[t[HG].toLowerCase()],i=tS(t[DF]);if(i>31)return t.index=t.index+t[DF].length,null;if(r.start.assign("month",s),r.start.assign("day",i),t[xF]){let a=oy(t[xF]);r.start.assign("year",a)}else{let a=Je(e.reference.instant,i,s);r.start.imply("year",a)}if(t[CF]){let a=tS(t[CF]);r.end=r.start.clone(),r.end.assign("day",a)}return r}}});var UG,_F,If,AF=v(()=>{xs();Pt();Re();xs();Hi();UG=2,_F=3,If=class extends Xo{innerPatternString(e){return`((?:\u0432|\u0443)\\s*)?(${G(Oc)})\\s*(?:[,-]?\\s*(${ay})?)?(?=[^\\s\\w]|\\s+[^0-9]|\\s+$|$)`}innerExtract(e,t){let r=t[UG].toLowerCase();if(t[0].length<=3&&!XE[r])return null;let s=e.createParsingResult(t.index,t.index+t[0].length);s.start.imply("day",1);let i=Oc[r];if(s.start.assign("month",i),t[_F]){let a=oy(t[_F]);s.start.assign("year",a)}else{let a=Je(e.reference.instant,1,i);s.start.imply("year",a)}return s}}});var Rf,PF=v(()=>{Ue();Ri();xs();Rf=class extends ir{constructor(e){super(e)}patternFlags(){return Js.flags}primaryPatternLeftBoundary(){return"(^|\\s|T|(?:[^\\p{L}\\p{N}_]))"}followingPhase(){return"\\s*(?:\\-|\\\u2013|\\~|\\\u301C|\u0434\u043E|\u0456|\u043F\u043E|\\?)\\s*"}primaryPrefix(){return"(?:(?:\u0432|\u0443|\u043E|\u043E\u0431|\u0437|\u0456\u0437|\u0432\u0456\u0434)\\s*)??"}primarySuffix(){return`(?:\\s*(?:\u0440\u0430\u043D\u043A\u0443|\u0432\u0435\u0447\u043E\u0440\u0430|\u043F\u043E \u043E\u0431\u0456\u0434\u0456|\u043F\u0456\u0441\u043B\u044F \u043E\u0431\u0456\u0434\u0443))?(?!\\/)${Js.rightBoundary}`}extractPrimaryTimeComponents(e,t){let r=super.extractPrimaryTimeComponents(e,t);if(r){if(t[0].endsWith("\u0432\u0435\u0447\u043E\u0440\u0430")){let s=r.get("hour");s>=6&&s<12?(r.assign("hour",r.get("hour")+12),r.assign("meridiem",N.PM)):s<6&&r.assign("meridiem",N.AM)}if(t[0].endsWith("\u043F\u043E \u043E\u0431\u0456\u0434\u0456")||t[0].endsWith("\u043F\u0456\u0441\u043B\u044F \u043E\u0431\u0456\u0434\u0443")){r.assign("meridiem",N.PM);let s=r.get("hour");s>=0&&s<=6&&r.assign("hour",r.get("hour")+12)}t[0].endsWith("\u0440\u0430\u043D\u043A\u0443")&&(r.assign("meridiem",N.AM),r.get("hour")<12&&r.assign("hour",r.get("hour")))}return r}}});var Nf,IF=v(()=>{xs();Se();Es();Hi();Nf=class extends Xo{innerPatternString(e){return`(${Lc})\\s{0,5}\u0442\u043E\u043C\u0443(?=(?:\\W|$))`}innerExtract(e,t){let r=Fc(t[1]),s=Vt(r);return V.createRelativeFromReference(e.reference,s)}}});var Of,RF=v(()=>{Ys();Of=class extends vt{patternBetween(){return/^\s*(і до|і по|до|по|-)\s*$/i}}});var Lf,NF=v(()=>{zs();Lf=class extends Tt{patternBetween(){return new RegExp("^\\s*(T|\u0432|\u0443|\u043E|,|-)?\\s*$")}}});var Ff,OF=v(()=>{ks();Hi();Ff=class extends ns{innerPatternString(e){return"(?:\u0437|\u0456\u0437|\u0432\u0456\u0434)?\\s*(\u0441\u044C\u043E\u0433\u043E\u0434\u043D\u0456|\u0432\u0447\u043E\u0440\u0430|\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u0456\u0441\u043B\u044F\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u0456\u0441\u043B\u044F\u043F\u0456\u0441\u043B\u044F\u0437\u0430\u0432\u0442\u0440\u0430|\u043F\u043E\u0437\u0430\u043F\u043E\u0437\u0430\u0432\u0447\u043E\u0440\u0430|\u043F\u043E\u0437\u0430\u0432\u0447\u043E\u0440\u0430)"}innerExtract(e,t){let r=t[1].toLowerCase(),s=e.createParsingComponents();switch(r){case"\u0441\u044C\u043E\u0433\u043E\u0434\u043D\u0456":return ar(e.reference);case"\u0432\u0447\u043E\u0440\u0430":return Pr(e.reference);case"\u0437\u0430\u0432\u0442\u0440\u0430":return Ir(e.reference);case"\u043F\u0456\u0441\u043B\u044F\u0437\u0430\u0432\u0442\u0440\u0430":return Zn(e.reference,2);case"\u043F\u0456\u0441\u043B\u044F\u043F\u0456\u0441\u043B\u044F\u0437\u0430\u0432\u0442\u0440\u0430":return Zn(e.reference,3);case"\u043F\u043E\u0437\u0430\u0432\u0447\u043E\u0440\u0430":return No(e.reference,2);case"\u043F\u043E\u0437\u0430\u043F\u043E\u0437\u0430\u0432\u0447\u043E\u0440\u0430":return No(e.reference,3)}return s}}});var LF,Bf,FF=v(()=>{ks();ws();LF=ke(Ye(),1);Hi();Bf=class extends ns{innerPatternString(e){return"(\u0437\u0430\u0440\u0430\u0437|\u043C\u0438\u043D\u0443\u043B\u043E\u0433\u043E\\s*\u0432\u0435\u0447\u043E\u0440\u0430|\u043C\u0438\u043D\u0443\u043B\u043E\u0457\\s*\u043D\u043E\u0447\u0456|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u0457\\s*\u043D\u043E\u0447\u0456|\u0441\u044C\u043E\u0433\u043E\u0434\u043D\u0456\\s*\u0432\u043D\u043E\u0447\u0456|\u0446\u0456\u0454\u0457\\s*\u043D\u043E\u0447\u0456|\u0446\u044C\u043E\u0433\u043E \u0440\u0430\u043D\u043A\u0443|\u0432\u0440\u0430\u043D\u0446\u0456|\u0440\u0430\u043D\u043A\u0443|\u0437\u0440\u0430\u043D\u043A\u0443|\u043E\u043F\u0456\u0432\u0434\u043D\u0456|\u0432\u0432\u0435\u0447\u0435\u0440\u0456|\u0432\u0435\u0447\u043E\u0440\u0430|\u043E\u043F\u0456\u0432\u043D\u043E\u0447\u0456|\u0432\u043D\u043E\u0447\u0456)"}innerExtract(e,t){let r=(0,LF.default)(e.reference.instant),s=t[0].toLowerCase(),i=e.createParsingComponents();if(s==="\u0437\u0430\u0440\u0430\u0437")return Ar(e.reference);if(s==="\u0432\u0432\u0435\u0447\u0435\u0440\u0456"||s==="\u0432\u0435\u0447\u043E\u0440\u0430")return vc(e.reference);if(s.endsWith("\u0432\u0440\u0430\u043D\u0446\u0456")||s.endsWith("\u0440\u0430\u043D\u043A\u0443")||s.endsWith("\u0437\u0440\u0430\u043D\u043A\u0443"))return Tc(e.reference);if(s.endsWith("\u043E\u043F\u0456\u0432\u0434\u043D\u0456"))return wc(e.reference);if(s.match(/минулої\s*ночі/))return _g(e.reference);if(s.match(/минулого\s*вечора/))return Ag(e.reference);if(s.match(/наступної\s*ночі/)){let a=r.hour()<22?1:2;r=r.add(a,"day"),ft(i,r),i.imply("hour",1)}return s.match(/цієї\s*ночі/)?Oo(e.reference):s.endsWith("\u043E\u043F\u0456\u0432\u043D\u043E\u0447\u0456")||s.endsWith("\u0432\u043D\u043E\u0447\u0456")?Oo(e.reference):i}}});var WG,$G,jG,Hf,BF=v(()=>{xs();Re();kn();Hi();WG=1,$G=2,jG=3,Hf=class extends ns{innerPatternString(e){return`(?:(?:,|\\(|\uFF08)\\s*)?(?:\u0432\\s*?)?(?:\u0443\\s*?)?(?:(\u0446\u0435\u0439|\u043C\u0438\u043D\u0443\u043B\u043E\u0433\u043E|\u043C\u0438\u043D\u0443\u043B\u0438\u0439|\u043F\u043E\u043F\u0435\u0440\u0435\u0434\u043D\u0456\u0439|\u043F\u043E\u043F\u0435\u0440\u0435\u0434\u043D\u044C\u043E\u0433\u043E|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u0433\u043E|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u0438\u0439|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443)\\s*)?(${G(JE)})(?:\\s*(?:,|\\)|\uFF09))?(?:\\s*(\u043D\u0430|\u0443|\u0432)\\s*(\u0446\u044C\u043E\u043C\u0443|\u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443)\\s*\u0442\u0438\u0436\u043D\u0456)?`}innerExtract(e,t){let r=t[$G].toLocaleLowerCase(),s=JE[r],i=t[WG],a=t[jG],o=i||a;o=o||"",o=o.toLocaleLowerCase();let l=null;return o=="\u043C\u0438\u043D\u0443\u043B\u043E\u0433\u043E"||o=="\u043C\u0438\u043D\u0443\u043B\u0438\u0439"||o=="\u043F\u043E\u043F\u0435\u0440\u0435\u0434\u043D\u0456\u0439"||o=="\u043F\u043E\u043F\u0435\u0440\u0435\u0434\u043D\u044C\u043E\u0433\u043E"?l="last":o=="\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u0433\u043E"||o=="\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u0438\u0439"?l="next":(o=="\u0446\u0435\u0439"||o=="\u0446\u044C\u043E\u0433\u043E"||o=="\u0446\u044C\u043E\u043C\u0443")&&(l="this"),Yt(e.reference,s,l)}}});var HF,VG,YG,Uf,UF=v(()=>{xs();Se();HF=ke(Ye(),1);Re();Hi();VG=1,YG=2,Uf=class extends ns{innerPatternString(e){return`(\u0432 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443|\u0443 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443|\u043D\u0430 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443|\u043C\u0438\u043D\u0443\u043B\u043E\u0433\u043E|\u043D\u0430 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443|\u0432 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443|\u0443 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u0433\u043E|\u043D\u0430 \u0446\u044C\u043E\u043C\u0443|\u0432 \u0446\u044C\u043E\u043C\u0443|\u0443 \u0446\u044C\u043E\u043C\u0443|\u0446\u044C\u043E\u0433\u043E)\\s*(${G(_f)})(?=\\s*)`}innerExtract(e,t){let r=t[VG].toLowerCase(),s=t[YG].toLowerCase(),i=_f[s];if(r=="\u043D\u0430 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443"||r=="\u0432 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443"||r=="\u0443 \u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u043C\u0443"||r=="\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u043E\u0433\u043E"){let l={};return l[i]=1,V.createRelativeFromReference(e.reference,l)}if(r=="\u043D\u0430 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443"||r=="\u0432 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443"||r=="\u0443 \u043C\u0438\u043D\u0443\u043B\u043E\u043C\u0443"||r=="\u043C\u0438\u043D\u0443\u043B\u043E\u0433\u043E"){let l={};return l[i]=-1,V.createRelativeFromReference(e.reference,l)}let a=e.createParsingComponents(),o=(0,HF.default)(e.reference.instant);return i.match(/week/i)?(o=o.add(-o.get("d"),"d"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.imply("year",o.year())):i.match(/month/i)?(o=o.add(-o.date()+1,"d"),a.imply("day",o.date()),a.assign("year",o.year()),a.assign("month",o.month()+1)):i.match(/year/i)&&(o=o.add(-o.date()+1,"d"),o=o.add(-o.month(),"month"),a.imply("day",o.date()),a.imply("month",o.month()+1),a.assign("year",o.year())),a}}});var Wf,WF=v(()=>{xs();Se();Es();Hi();Wf=class extends ns{innerPatternString(e){return`(\u0446\u0456|\u043E\u0441\u0442\u0430\u043D\u043D\u0456|\u043C\u0438\u043D\u0443\u043B\u0456|\u043C\u0430\u0439\u0431\u0443\u0442\u043D\u0456|\u043D\u0430\u0441\u0442\u0443\u043F\u043D\u0456|\u043F\u0456\u0441\u043B\u044F|\u0447\u0435\u0440\u0435\u0437|\\+|-)\\s*(${Lc})`}innerExtract(e,t){let r=t[1].toLowerCase(),s=Fc(t[3]);switch(r){case"\u043E\u0441\u0442\u0430\u043D\u043D\u0456":case"\u043C\u0438\u043D\u0443\u043B\u0456":case"-":s=Vt(s);break}return V.createRelativeFromReference(e.reference,s)}}});var nS={};nt(nS,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>rS,createCasualConfiguration:()=>$F,createConfiguration:()=>sS,parse:()=>qG,parseDate:()=>GG,strict:()=>zG});function $F(){let n=sS(!1);return n.parsers.unshift(new Ff),n.parsers.unshift(new Bf),n.parsers.unshift(new If),n.parsers.unshift(new Uf),n.parsers.unshift(new Wf),n}function sS(n){return kt({parsers:[new Oi,new er(!0),new Af,new Pf,new Hf,new Rf(n),new Nf],refiners:[new Lf,new Of]},n)}function qG(n,e,t){return rS.parse(n,e,t)}function GG(n,e,t){return rS.parseDate(n,e,t)}var rS,zG,jF=v(()=>{SF();MF();AF();PF();IF();RF();NF();bs();OF();FF();BF();UF();rs();Se();Ue();Li();WF();Mg();rS=new fe($F()),zG=new fe(sS(!0))});var ly={};nt(ly,{Chrono:()=>fe,Meridiem:()=>N,ParsingComponents:()=>V,ParsingContext:()=>th,ParsingResult:()=>$e,ReferenceWithTimezone:()=>ze,Weekday:()=>ye,casual:()=>iS,de:()=>Pk,en:()=>kk,es:()=>GE,fr:()=>Wk,ja:()=>Yk,nl:()=>nE,parse:()=>KG,parseDate:()=>ZG,pt:()=>Kk,ru:()=>$E,strict:()=>QG,uk:()=>nS,zh:()=>IE});function KG(n,e,t){return iS.parse(n,e,t)}function ZG(n,e,t){return iS.parseDate(n,e,t)}var QG,iS,VF=v(()=>{rO();rs();Se();Ue();xO();ZO();h1();x1();tL();AL();XL();wF();jF();QG=bk,iS=rh});var ei,$f=v(()=>{At();VF();AT();Xv();ei=class{constructor(e=[],t=[],r=!0,s="en"){this.isValidDateString=e=>/^\d{4}-\d{2}-\d{2}$/.test(e);this.isValidTimeString=e=>/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(e);this.escapeRegex=e=>e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.cleanupWhitespace=e=>e.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"").trim();this.defaultToScheduled=r,this.languageConfig=J_(s),this.statusConfigs=e,this.boundaries=this.createBoundaryConfig(),this.priorityPatterns=this.buildPriorityPatterns(t),this.statusPatterns=this.buildFallbackStatusPatterns(),this.recurrencePatterns=this.buildRecurrencePatterns(),this.processingPipeline=this.buildProcessingPipeline()}createBoundaryConfig(){let e=["ru","zh","ja","uk","fr"].includes(this.languageConfig.code);return{boundary:e?"(?:^|\\s)":"\\b",endBoundary:e?"(?=\\s|$)":"\\b",isNonAscii:e}}getChronoParser(){let e=this.languageConfig.chronoLocale;return ly[e]||ly}buildProcessingPipeline(){return[{name:"extractTags",process:(e,t)=>this.extractTags(e,t)},{name:"extractContexts",process:(e,t)=>this.extractContexts(e,t)},{name:"extractProjects",process:(e,t)=>this.extractProjects(e,t)},{name:"extractPriority",process:(e,t)=>this.extractPriority(e,t)},{name:"extractStatus",process:(e,t)=>this.extractStatus(e,t)},{name:"extractRecurrence",process:(e,t)=>this.extractRecurrence(e,t)},{name:"extractTimeEstimate",process:(e,t)=>this.extractTimeEstimate(e,t)},{name:"parseUnifiedDatesAndTimes",process:(e,t)=>this.parseUnifiedDatesAndTimes(e,t)}]}parseInput(e){let t={title:"",tags:[],contexts:[],projects:[]},[r,s]=this.extractTitleAndDetails(e);s&&(t.details=s);let i=r;for(let a of this.processingPipeline)try{i=a.process(i,t)}catch(o){console.debug(`Error in processor ${a.name}:`,o)}return t.title=i.trim(),this.validateAndCleanupResult(t)}extractTitleAndDetails(e){let t=e.trim(),r=t.indexOf(`
`);if(r!==-1){let s=t.substring(0,r).trim(),i=t.substring(r+1).trim();return[s,i]}return[t,void 0]}extractTags(e,t){let r=e.match(/#[\w/]+/g);return r?(t.tags.push(...r.map(s=>s.substring(1))),this.cleanupWhitespace(e.replace(/#[\w/]+/g,""))):e}extractContexts(e,t){let r=e.match(/@\w+/g);return r?(t.contexts.push(...r.map(s=>s.substring(1))),this.cleanupWhitespace(e.replace(/@\w+/g,""))):e}extractProjects(e,t){let r=e,s=r.match(/\+\[\[.*?\]\]/g);s&&(t.projects.push(...s.map(a=>a.slice(1))),r=this.cleanupWhitespace(r.replace(/\+\[\[.*?\]\]/g,"")));let i=r.match(/\+[\w/-]+/g);return i&&(t.projects.push(...i.map(a=>a.substring(1))),r=this.cleanupWhitespace(r.replace(/\+[\w/-]+/g,""))),r}buildPriorityPatterns(e){if(e.length>0)return e.flatMap(a=>[{regex:new RegExp(`\\b${this.escapeRegex(a.value)}\\b`,"i"),value:a.value},{regex:new RegExp(`\\b${this.escapeRegex(a.label)}\\b`,"i"),value:a.value}]);let t=[],r=this.languageConfig.fallbackPriority,{boundary:s,endBoundary:i}=this.boundaries;return t.push({regex:new RegExp(`${s}(${r.urgent.map(a=>this.escapeRegex(a)).join("|")})${i}`,"i"),value:"urgent"}),t.push({regex:new RegExp(`${s}(${r.high.map(a=>this.escapeRegex(a)).join("|")})${i}`,"i"),value:"high"}),t.push({regex:new RegExp(`${s}(${r.normal.map(a=>this.escapeRegex(a)).join("|")})${i}`,"i"),value:"normal"}),t.push({regex:new RegExp(`${s}(${r.low.map(a=>this.escapeRegex(a)).join("|")})${i}`,"i"),value:"low"}),t}extractPriority(e,t){let r=null;for(let s of this.priorityPatterns){let i=e.match(s.regex);i&&i.index!==void 0&&(!r||i.index<r.index)&&(r={pattern:s,index:i.index})}return r?(t.priority=r.pattern.value,this.cleanupWhitespace(e.replace(r.pattern.regex,""))):e}buildFallbackStatusPatterns(){let e=this.languageConfig.fallbackStatus,{boundary:t,endBoundary:r}=this.boundaries;return[{regex:new RegExp(`${t}(${e.open.map(s=>this.escapeRegex(s)).join("|")})${r}`,"i"),value:"open"},{regex:new RegExp(`${t}(${e.inProgress.map(s=>this.escapeRegex(s)).join("|")})${r}`,"i"),value:"in-progress"},{regex:new RegExp(`${t}(${e.done.map(s=>this.escapeRegex(s)).join("|")})${r}`,"i"),value:"done"},{regex:new RegExp(`${t}(${e.cancelled.map(s=>this.escapeRegex(s)).join("|")})${r}`,"i"),value:"cancelled"},{regex:new RegExp(`${t}(${e.waiting.map(s=>this.escapeRegex(s)).join("|")})${r}`,"i"),value:"waiting"}]}extractStatus(e,t){if(this.statusConfigs.length>0){let r=[...this.statusConfigs].sort((s,i)=>i.label.length-s.label.length);for(let s of r){let i=[s.label,s.value];for(let a of i){if(!a||a.trim()==="")continue;let o=this.findStatusMatch(e,a);if(o)return t.status=s.value,this.cleanupWhitespace(e.replace(o.fullMatch,""))}}}for(let r of this.statusPatterns)if(r.regex.test(e))return t.status=r.value,this.cleanupWhitespace(e.replace(r.regex,""));return e}findStatusMatch(e,t){if(!t||t.trim()==="")return null;let r=e.toLowerCase(),s=t.toLowerCase(),i=0;for(;;){let a=r.indexOf(s,i);if(a===-1)break;let o=a>0?e[a-1]:" ",l=a+t.length,c=l<e.length?e[l]:" ",d=/\s/.test(o)||a===0,u=/\s/.test(c)||l===e.length;if(d&&u)return{fullMatch:e.substring(a,l),startIndex:a};i=a+1}return null}parseUnifiedDatesAndTimes(e,t){var s,i;let r=e;try{let a=this.getChronoParser(),o=this.languageConfig.dateTriggers,l=[{type:"due",regex:new RegExp(`\\b(${o.due.map(T=>this.escapeRegex(T)).join("|")})`,"i")},{type:"scheduled",regex:new RegExp(`\\b(${o.scheduled.map(T=>this.escapeRegex(T)).join("|")})`,"i")}];for(let T of l){let w=r.match(T.regex);if(w){let b=w.index+w[0].length,S=r.substring(b),k=this.parseChronoFromPosition(S);if(k.success)return T.type==="due"?(t.dueDate=k.date,k.time&&(t.dueTime=k.time)):(t.scheduledDate=k.date,k.time&&(t.scheduledTime=k.time)),r=r.replace(T.regex,""),k.matchedText&&(r=r.replace(k.matchedText,"")),r=this.cleanupWhitespace(r),r}}let c=a.parse(e,new Date,{forwardDate:!0});if(c.length===0)return e;let d=c[0],u=d.text,h=d.start.date(),f=(s=d.end)==null?void 0:s.date(),p=new RegExp(`\\b(${o.due.map(T=>this.escapeRegex(T)).join("|")})\\b`,"i"),m=new RegExp(`\\b(${o.scheduled.map(T=>this.escapeRegex(T)).join("|")})\\b`,"i"),g=p.test(d.text),y=m.test(d.text);if(f&&Lr(f)&&f.getTime()!==h.getTime())t.scheduledDate=x(h,"yyyy-MM-dd"),d.start.isCertain("hour")&&(t.scheduledTime=x(h,"HH:mm")),t.dueDate=x(f,"yyyy-MM-dd"),(i=d.end)!=null&&i.isCertain("hour")&&(t.dueTime=x(f,"HH:mm"));else if(Lr(h)){let T=x(h,"yyyy-MM-dd"),w=d.start.isCertain("hour")?x(h,"HH:mm"):void 0;g&&!y?(t.dueDate=T,t.dueTime=w):y&&!g||this.defaultToScheduled?(t.scheduledDate=T,t.scheduledTime=w):(t.dueDate=T,t.dueTime=w)}r=r.replace(u,"").trim(),r=this.cleanupWhitespace(r)}catch(a){console.debug("Error in unified date parsing:",a)}return r}parseChronoFromPosition(e){try{let r=this.getChronoParser().parse(e,new Date,{forwardDate:!0});if(r.length>0){let s=r[0];if(s.index<=3){let i=s.start.date();if(Lr(i)){let a={success:!0,date:x(i,"yyyy-MM-dd"),matchedText:s.text};return s.start.isCertain("hour")&&(a.time=x(i,"HH:mm")),a}}}}catch(t){console.debug("Error parsing date with chrono:",t)}return{success:!1}}buildRecurrencePatterns(){let e=this.languageConfig.recurrence,t=[],{boundary:r,endBoundary:s}=this.boundaries,i=a=>a.map(o=>this.escapeRegex(o)).join("|");return t.push(...this.buildOrdinalWeekdayPatterns(e,r,s,i)),t.push(...this.buildIntervalPatterns(e,r,s,i)),t.push(...this.buildEveryOtherPatterns(e,r,s,i)),t.push(...this.buildWeekdayPatterns(e,r,s,i)),t.push(...this.buildFrequencyPatterns(e,r,s,i)),t}buildOrdinalWeekdayPatterns(e,t,r,s){let i=s(e.every),a=s([...e.ordinals.first,...e.ordinals.second,...e.ordinals.third,...e.ordinals.fourth,...e.ordinals.last]),o=s([...e.weekdays.monday,...e.weekdays.tuesday,...e.weekdays.wednesday,...e.weekdays.thursday,...e.weekdays.friday,...e.weekdays.saturday,...e.weekdays.sunday]);return[{regex:new RegExp(`${t}(${i})\\s+(${a})\\s+(${o})${r}`,"i"),handler:l=>{let c=l[2].toLowerCase(),d=l[3].toLowerCase(),u=1;return e.ordinals.second.some(f=>f.toLowerCase()===c)?u=2:e.ordinals.third.some(f=>f.toLowerCase()===c)?u=3:e.ordinals.fourth.some(f=>f.toLowerCase()===c)?u=4:e.ordinals.last.some(f=>f.toLowerCase()===c)&&(u=-1),`FREQ=MONTHLY;BYDAY=${this.getWeekdayRRuleCode(d,e)};BYSETPOS=${u}`}}]}buildIntervalPatterns(e,t,r,s){let i=s(e.every),a=s([...e.periods.day,...e.periods.week,...e.periods.month,...e.periods.year]);return[{regex:new RegExp(`${t}(${i})\\s+(\\d+)\\s+(${a})${r}`,"i"),handler:o=>{let l=parseInt(o[2]),c=o[3].toLowerCase();return`FREQ=${this.getPeriodFrequency(c,e)};INTERVAL=${l}`}}]}buildEveryOtherPatterns(e,t,r,s){let i=s(e.every),a=s(e.other),o=s([...e.periods.day,...e.periods.week,...e.periods.month,...e.periods.year]);return[{regex:new RegExp(`${t}(${i})\\s+(${a})\\s+(${o})${r}`,"i"),handler:l=>{let c=l[3].toLowerCase();return`FREQ=${this.getPeriodFrequency(c,e)};INTERVAL=2`}}]}buildWeekdayPatterns(e,t,r,s){let i=s(e.every),a=s([...e.weekdays.monday,...e.weekdays.tuesday,...e.weekdays.wednesday,...e.weekdays.thursday,...e.weekdays.friday,...e.weekdays.saturday,...e.weekdays.sunday]),o=s([...e.pluralWeekdays.monday,...e.pluralWeekdays.tuesday,...e.pluralWeekdays.wednesday,...e.pluralWeekdays.thursday,...e.pluralWeekdays.friday,...e.pluralWeekdays.saturday,...e.pluralWeekdays.sunday]);return[{regex:new RegExp(`${t}(${i})\\s+(${a})${r}`,"i"),handler:l=>{let c=l[2].toLowerCase();return`FREQ=WEEKLY;BYDAY=${this.getWeekdayRRuleCode(c,e)}`}},{regex:new RegExp(`${t}(${o})${r}`,"i"),handler:l=>{let c=l[1].toLowerCase();return`FREQ=WEEKLY;BYDAY=${this.getPluralWeekdayRRuleCode(c,e)}`}}]}buildFrequencyPatterns(e,t,r,s){return[{regex:new RegExp(`${t}(${s(e.frequencies.daily)})${r}`,"i"),handler:()=>"FREQ=DAILY"},{regex:new RegExp(`${t}(${s(e.frequencies.weekly)})${r}`,"i"),handler:()=>"FREQ=WEEKLY"},{regex:new RegExp(`${t}(${s(e.frequencies.monthly)})${r}`,"i"),handler:()=>"FREQ=MONTHLY"},{regex:new RegExp(`${t}(${s(e.frequencies.yearly)})${r}`,"i"),handler:()=>"FREQ=YEARLY"}]}getPeriodFrequency(e,t){return t.periods.week.some(r=>r.toLowerCase()===e)?"WEEKLY":t.periods.month.some(r=>r.toLowerCase()===e)?"MONTHLY":t.periods.year.some(r=>r.toLowerCase()===e)?"YEARLY":"DAILY"}getWeekdayRRuleCode(e,t){return t.weekdays.tuesday.some(r=>r.toLowerCase()===e)?"TU":t.weekdays.wednesday.some(r=>r.toLowerCase()===e)?"WE":t.weekdays.thursday.some(r=>r.toLowerCase()===e)?"TH":t.weekdays.friday.some(r=>r.toLowerCase()===e)?"FR":t.weekdays.saturday.some(r=>r.toLowerCase()===e)?"SA":t.weekdays.sunday.some(r=>r.toLowerCase()===e)?"SU":"MO"}getPluralWeekdayRRuleCode(e,t){return t.pluralWeekdays.tuesday.some(r=>r.toLowerCase()===e)?"TU":t.pluralWeekdays.wednesday.some(r=>r.toLowerCase()===e)?"WE":t.pluralWeekdays.thursday.some(r=>r.toLowerCase()===e)?"TH":t.pluralWeekdays.friday.some(r=>r.toLowerCase()===e)?"FR":t.pluralWeekdays.saturday.some(r=>r.toLowerCase()===e)?"SA":t.pluralWeekdays.sunday.some(r=>r.toLowerCase()===e)?"SU":"MO"}extractRecurrence(e,t){for(let r of this.recurrencePatterns){let s=e.match(r.regex);if(s){let i=r.handler(s);if(this.isValidRRuleString(i))return t.recurrence=i,this.cleanupWhitespace(e.replace(r.regex,""))}}return e}isValidRRuleString(e){if(e.includes("BYDAY=undefined")||e.includes("BYDAY=;")||e.includes("BYDAY=")){let t=e.match(/BYDAY=([^;]*)/);if(t&&(!t[1]||t[1]==="undefined"||t[1].trim()===""))return!1}return!!e.includes("FREQ=")}extractTimeEstimate(e,t){let r=this.languageConfig.timeEstimate,{boundary:s,endBoundary:i}=this.boundaries,a=[{regex:new RegExp(`${s}(\\d+)(${r.hours.map(c=>this.escapeRegex(c)).join("|")})\\s*(\\d+)(${r.minutes.map(c=>this.escapeRegex(c)).join("|")})${i}`,"i"),handler:c=>parseInt(c[1])*60+parseInt(c[3])},{regex:new RegExp(`${s}(\\d+)\\s*(${r.hours.map(c=>this.escapeRegex(c)).join("|")})${i}`,"i"),handler:c=>parseInt(c[1])*60},{regex:new RegExp(`${s}(\\d+)\\s*(${r.minutes.map(c=>this.escapeRegex(c)).join("|")})${i}`,"i"),handler:c=>parseInt(c[1])}],o=e,l=0;for(let c of a){let d=o.match(c.regex);d&&(l+=c.handler(d),o=this.cleanupWhitespace(o.replace(c.regex,"")))}return l>0&&(t.estimate=l),o}validateAndCleanupResult(e){return e.title.trim()||(e.title="Untitled Task"),e.tags=[...new Set(e.tags.filter(Boolean))],e.contexts=[...new Set(e.contexts.filter(Boolean))],e.projects=[...new Set(e.projects.filter(Boolean))],e.dueDate&&!this.isValidDateString(e.dueDate)&&delete e.dueDate,e.scheduledDate&&!this.isValidDateString(e.scheduledDate)&&delete e.scheduledDate,e.dueTime&&!this.isValidTimeString(e.dueTime)&&delete e.dueTime,e.scheduledTime&&!this.isValidTimeString(e.scheduledTime)&&delete e.scheduledTime,e}getPreviewData(e){let t=[];if(e.title&&t.push({icon:"edit-3",text:`"${e.title}"`}),e.details&&t.push({icon:"file-text",text:`Details: "${e.details.substring(0,50)}${e.details.length>50?"...":""}"`}),e.dueDate){let r=e.dueTime?`${e.dueDate} at ${e.dueTime}`:e.dueDate;t.push({icon:"calendar",text:`Due: ${r}`})}if(e.scheduledDate){let r=e.scheduledTime?`${e.scheduledDate} at ${e.scheduledTime}`:e.scheduledDate;t.push({icon:"calendar-clock",text:`Scheduled: ${r}`})}if(e.priority&&t.push({icon:"alert-triangle",text:`Priority: ${e.priority}`}),e.status&&t.push({icon:"activity",text:`Status: ${e.status}`}),e.contexts&&e.contexts.length>0&&t.push({icon:"map-pin",text:`Contexts: ${e.contexts.map(r=>"@"+r).join(", ")}`}),e.projects&&e.projects.length>0){let r=e.projects.map(s=>s.includes(" ")||s.includes("-")||s.match(/[A-Z]/)?`+[[${s}]]`:`+${s}`).join(", ");t.push({icon:"folder",text:`Projects: ${r}`})}if(e.tags&&e.tags.length>0&&t.push({icon:"tag",text:`Tags: ${e.tags.map(r=>"#"+r).join(", ")}`}),e.recurrence){let r="Invalid recurrence";try{e.recurrence.includes("FREQ=")&&this.isValidRRuleString(e.recurrence)&&(r=Z.fromString(e.recurrence).toText())}catch(s){console.debug("Error parsing rrule for preview:",s)}t.push({icon:"repeat",text:`Recurrence: ${r}`})}return e.estimate&&t.push({icon:"clock",text:`Estimate: ${e.estimate} min`}),t}getPreviewText(e){return this.getPreviewData(e).map(t=>t.text).join(" \u2022 ")}}});var Vf={};nt(Vf,{convertDefaultRemindersToReminders:()=>JG,hasAnyUserFieldsEnabled:()=>YF,isUserFieldConfigComplete:()=>zF,isUserFieldEnabled:()=>XG});function JG(n,e){return n.map(t=>{let r={id:`rem_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:t.type,description:t.description};if(t.type==="relative"){if(t.relatedTo&&t.offset&&t.unit&&t.direction){let s="PT";t.unit==="days"?s=`P${t.offset}D`:t.unit==="hours"?s=`PT${t.offset}H`:s=`PT${t.offset}M`,t.direction==="before"&&(s="-"+s),r.relatedTo=t.relatedTo,r.offset=s}}else t.type==="absolute"&&t.absoluteDate&&t.absoluteTime&&(r.absoluteTime=`${t.absoluteDate}T${t.absoluteTime}:00`);return r}).filter(t=>t.type==="relative"?t.relatedTo&&t.offset:!!t.absoluteTime)}function YF(n){let e=n.userFields;return!e||e.length===0?!1:e.some(t=>!!(t&&t.displayName&&t.key&&t.type))}function zF(n){return!n||!n.enabled?!1:!!(n.displayName&&n.key&&n.type)}function XG(n){return n.userFields&&n.userFields.length>0?YF(n):zF(n.userField)}var Yf=v(()=>{});function oS(n,e,t,r,s={}){let{cssClass:i="internal-link",hoverSource:a="tasknotes-property-link",showErrorNotices:o=!1}=s,l=n.createEl("a",{cls:i,text:t,attr:{"data-href":e,role:"link",tabindex:"0"}});l.addEventListener("click",async c=>{c.preventDefault(),c.stopPropagation();try{let d=r.metadataCache.getFirstLinkpathDest(e,"");d instanceof Bc.TFile?await r.workspace.getLeaf(!1).openFile(d):o&&new Bc.Notice(`Note "${t}" not found`)}catch(d){console.error("[TaskNotes] Error opening internal link:",{filePath:e,error:d}),o&&new Bc.Notice(`Failed to open note "${t}"`)}}),l.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),l.click())}),l.addEventListener("mouseover",c=>{let d=r.metadataCache.getFirstLinkpathDest(e,"");if(d instanceof Bc.TFile){let u={event:c,source:a,hoverParent:n,targetEl:l,linktext:e,sourcePath:d.path};r.workspace.trigger("hover-link",u)}})}function cy(n,e,t,r){let s=0,i;for(;(i=e6.exec(e))!==null;){let[o,l,c,d]=i,u=i.index;if(u>s&&n.appendChild(document.createTextNode(e.slice(s,u))),l){let h=l,f=h,p=h;if(h.includes("|")){let[m,g]=h.split("|");f=m,p=g}oS(n,f,p,t)}else if(c&&d){let h=String(d).trim(),f=String(c).trim();/^[a-z]+:\/\//i.test(h)?n.createEl("a",{text:f,attr:{href:h,target:"_blank",rel:"noopener"}}).classList.add("external-link"):oS(n,h,f,t)}s=u+o.length}let a=e.slice(s);if(a&&(r!=null&&r.onTagClick)){let o=/(^|\s)(#\w+)/g,l=0,c;for(;(c=o.exec(a))!==null;){let[,d,u]=c,h=c.index;h>l&&n.appendChild(document.createTextNode(a.slice(l,h))),d&&n.appendChild(document.createTextNode(d));let f=n.createEl("a",{cls:"tag",text:u,attr:{href:u,role:"button",tabindex:"0"}});f.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),r.onTagClick(u,p)}),f.addEventListener("keydown",p=>{(p.key==="Enter"||p.key===" ")&&(p.preventDefault(),r.onTagClick(u,p))}),l=h+d.length+u.length}l<a.length&&n.appendChild(document.createTextNode(a.slice(l)))}else a&&n.appendChild(document.createTextNode(a))}function t6(n){return!n||typeof n!="string"||!n.startsWith("[[")||!n.endsWith("]]")||n.startsWith("\\[[")||n.endsWith("\\]]")?!1:n.slice(2,-2).trim().length>0}function dy(n,e,t){n.innerHTML="",e.flat(2).filter(s=>s!=null&&typeof s=="string").forEach((s,i)=>{if(i>0&&n.appendChild(document.createTextNode(", ")),n.appendChild(document.createTextNode("+")),t6(s)){let a=s.slice(2,-2),o=a,l=a;if(a.includes("|")){let c=a.split("|");o=c[0],l=c[1]}oS(n,o,l,t,{cssClass:"task-card__project-link internal-link",hoverSource:"tasknotes-project-link",showErrorNotices:!0})}else n.appendChild(document.createTextNode(s))})}var Bc,e6,lS=v(()=>{Bc=require("obsidian"),e6=/\[\[([^\[\]]+)\]\]|\[([^\]]+)\]\(([^)]+)\)|<(https?:\/\/[^\s>]+)>|\[([^\]]+)\]\s*\[([^\]]*)\]/g});function yy(n){let{task:e,plugin:t,excludeSelector:r,onSingleClick:s,onDoubleClick:i,contextMenuHandler:a}=n,o=null,l=()=>{let m=t.app.vault.getAbstractFileByPath(e.path);m instanceof QF.TFile&&t.app.workspace.getLeaf(!1).openFile(m)},c=async()=>{await t.openTaskEditModal(e)},d=async m=>{if(s){await s(m);return}if(m.ctrlKey||m.metaKey){l();return}let g=t.settings.singleClickAction;g==="edit"?await c():g==="openNote"&&l()},u=async m=>{if(i){await i(m);return}let g=t.settings.doubleClickAction;g==="edit"?await c():g==="openNote"&&l()};return{clickHandler:async m=>{if(!(r&&m.target.closest(r))){if(t.settings.doubleClickAction==="none"){await d(m);return}o?(clearTimeout(o),o=null,await u(m)):o=setTimeout(()=>{o=null,d(m)},250)}},dblclickHandler:async m=>{},contextmenuHandler:async m=>{m.preventDefault(),a&&await a(m)},cleanup:()=>{o&&(clearTimeout(o),o=null)}}}function vy(n,e){return t=>{e.app.vault.getAbstractFileByPath(n.path)&&e.app.workspace.trigger("hover-link",{event:t,source:"tasknotes-task-card",hoverParent:t.currentTarget,targetEl:t.currentTarget,linktext:n.path,sourcePath:n.path})}}var QF,dS=v(()=>{QF=require("obsidian")});function KF(n,e,t){if(!e||typeof e!="string")return;let r=n6(e);if(!r)return;let s=n.createEl("a",{cls:"tag",text:r,attr:{href:r,role:"button",tabindex:"0"}});t!=null&&t.onTagClick&&(s.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),t.onTagClick(r,i)}),s.addEventListener("keydown",i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),t.onTagClick(r,i))}))}function JF(n,e,t){if(typeof e=="string"){KF(n,e,t);return}if(Array.isArray(e)){e.flat(2).filter(s=>s!=null&&typeof s=="string").forEach((s,i)=>{i>0&&n.appendChild(document.createTextNode(" ")),KF(n,String(s),t)});return}e!=null&&n.appendChild(document.createTextNode(String(e)))}function XF(n,e,t){if(typeof e=="string"){let r=ZF(e);if(r){let s=n.createEl("span",{cls:"context-tag",text:r,attr:{role:"button",tabindex:"0"}});t!=null&&t.onTagClick&&(s.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),t.onTagClick(r,i)}),s.addEventListener("keydown",i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),t.onTagClick(r,i))}))}return}if(Array.isArray(e)){e.flat(2).filter(s=>s!=null&&typeof s=="string").forEach((s,i)=>{i>0&&n.appendChild(document.createTextNode(", "));let a=ZF(s);if(a){let o=n.createEl("span",{cls:"context-tag",text:a,attr:{role:"button",tabindex:"0"}});t!=null&&t.onTagClick&&(o.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),t.onTagClick(a,l)}),o.addEventListener("keydown",l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),t.onTagClick(a,l))}))}else n.appendChild(document.createTextNode(String(s)))});return}e!=null&&n.appendChild(document.createTextNode(String(e)))}function n6(n){if(!n||typeof n!="string")return null;let e=n.trim();if(!e)return null;if(e.startsWith("#")){let r=e.replace(/[^\w#-]/g,"");return r.length>1?r:null}let t=e.replace(/[^\w-]/g,"");return t?`#${t}`:null}function ZF(n){if(!n||typeof n!="string")return null;let e=n.trim();if(!e)return null;if(e.startsWith("@")){let r=e.replace(/[^\w@-]/g,"");return r.length>1?r:null}let t=e.replace(/[^\w-]/g,"");return t?`@${t}`:null}var eB=v(()=>{});var wy={};nt(wy,{DEFAULT_TASK_CARD_OPTIONS:()=>hS,cleanupTaskCard:()=>f6,createTaskCard:()=>cr,refreshParentTaskSubtasks:()=>tl,showDeleteConfirmationModal:()=>h6,showTaskContextMenu:()=>Ty,updateTaskCard:()=>en});function iB(n,e,t,r){n.addEventListener("click",s=>{s.stopPropagation();let i=r==="due"?e.due:e.scheduled;new Kr({currentValue:ve(i||""),currentTime:Er(i||""),onSelect:async(o,l)=>{try{let c;o?l?c=`${o}T${l}`:c=o:c=void 0,await t.updateTaskProperty(e,r,c)}catch(c){console.error(`Error updating ${r} date:`,c),new Te.Notice(`Failed to update ${r} date`)}}}).show(s)})}function aB(){return["due","scheduled","projects","contexts","tags"]}function i6(n,e,t){try{if(e in tB)return tB[e](n);if(e.startsWith("user:"))return a6(n,e,t);if(n.customProperties&&e in n.customProperties)return n.customProperties[e];if(e.startsWith("formula."))try{let r=e.substring(8),s=n.basesData;if(!(s!=null&&s.formulaResults))return"";let i=s.formulaResults;if(i!=null&&i.cachedFormulaOutputs&&i.cachedFormulaOutputs[r]!==void 0){let a=i.cachedFormulaOutputs[r];return a&&typeof a=="object"&&"icon"in a?"data"in a&&a.data!==null&&a.data!==void 0?a.data:a.icon==="lucide-calendar"&&"date"in a?a.date:a.icon==="lucide-file-question"||a.icon==="lucide-help-circle"?"":a.icon?a.icon.replace("lucide-",""):"":a!=null&&a!==""?a:""}return""}catch(r){return console.debug(`[TaskNotes] Error computing formula ${e}:`,r),"[Formula Error]"}if(n.path){let r=oB(n.path,e,t);if(r!==void 0)return r}return null}catch(r){return console.warn(`TaskCard: Error getting property ${e}:`,r),null}}function a6(n,e,t){var a;let r=e.slice(5),s=(a=t.settings.userFields)==null?void 0:a.find(o=>o.id===r);if(!(s!=null&&s.key))return null;let i=n[s.key];return i===void 0&&(i=oB(n.path,s.key,t)),i}function oB(n,e,t){try{let r=t.app.metadataCache.getCache(n);return r!=null&&r.frontmatter?r.frontmatter[e]:void 0}catch(r){console.warn(`TaskCard: Error accessing frontmatter for ${n}:`,r);return}}function lB(n,e,t,r){let s=i6(t,e,r);if(!o6(s))return null;let i=n.createEl("span",{cls:`task-card__metadata-property task-card__metadata-property--${e.replace(":","-")}`});try{return e in rB?rB[e](i,s,t,r):e.startsWith("user:")?l6(i,e,s,r):c6(i,e,s,r),i}catch(a){return console.warn(`TaskCard: Error rendering property ${e}:`,a),i.textContent=`${e}: (error)`,i}}function o6(n){return n!=null&&!(Array.isArray(n)&&n.length===0)&&!(typeof n=="string"&&n.trim()==="")}function l6(n,e,t,r){var c;let s=e.slice(5),i=(c=r.settings.userFields)==null?void 0:c.find(d=>d.id===s);if(!i){n.textContent=`${s}: (not found)`;return}let a=i.displayName||s;n.createEl("span",{text:`${a}: `});let o=n.createEl("span"),l={metadataCache:r.app.metadataCache,workspace:r.app.workspace};if(typeof t=="string"&&t.trim()!==""){let d=t.trim();if(d.includes("[[")||d.includes("](")||d.includes("#")&&/\s#\w+|\#\w+/.test(d))cy(o,d,l);else{let u=nB(t,i);o.textContent=u}}else if(i.type==="list"&&Array.isArray(t))t.filter(u=>u!=null).forEach((u,h)=>{if(h>0&&o.appendChild(document.createTextNode(", ")),typeof u=="string"&&u.trim()!==""){let f=u.trim();if(f.includes("[[")||f.includes("](")||f.includes("#")&&/\s#\w+|\#\w+/.test(f)){let p=o.createEl("span");cy(p,f,l)}else o.appendChild(document.createTextNode(String(u)))}else o.appendChild(document.createTextNode(String(u)))});else{let d=nB(t,i);d.trim()!==""?o.textContent=d:o.textContent="(empty)"}}function c6(n,e,t,r){let s;e.startsWith("formula.")?s=e.substring(8):s=e.charAt(0).toUpperCase()+e.slice(1),n.createEl("span",{text:`${s}: `});let i=n.createEl("span");Array.isArray(t)?t.filter(o=>o!=null&&o!=="").forEach((o,l)=>{l>0&&i.appendChild(document.createTextNode(", ")),sB(i,o,r)}):sB(i,t,r)}function sB(n,e,t){if(typeof e=="string"&&t){let s={metadataCache:t.app.metadataCache,workspace:t.app.workspace};if(e.includes("[[")||e.includes("[")&&e.includes("](")||e.includes("#")&&/\s#\w+|\#\w+/.test(e)){cy(n,e,s,{onTagClick:async(i,a)=>{let o=i.startsWith("#")?i.slice(1):i;await t.openTagsPane(`#${o}`)||console.log("Could not open search pane, generic property tag clicked:",i)}});return}n.appendChild(document.createTextNode(e));return}let r;if(typeof e=="object"&&e!==null)if(e instanceof Date)r=pr(e.toISOString(),{dateFormat:"MMM d, yyyy",timeFormat:"",showTime:!1});else if(typeof e.toString=="function"&&e.toString()!=="[object Object]")r=e.toString();else{let s=Object.entries(e);s.length<=3?r=s.map(([i,a])=>`${i}: ${a}`).join(", "):r=JSON.stringify(e)}else typeof e=="boolean"?r=e?"\u2713":"\u2717":typeof e=="number"?r=Number.isInteger(e)?String(e):e.toFixed(2):r=String(e);r.length>100&&(r=r.substring(0,97)+"..."),n.appendChild(document.createTextNode(r))}function nB(n,e){if(n==null)return"";try{switch(e.type){case"text":case"number":return String(n);case"date":return pr(String(n),{dateFormat:"MMM d, yyyy",timeFormat:"",showTime:!1});case"boolean":return n?"\u2713":"\u2717";case"list":return Array.isArray(n)?n.flat(2).join(", "):String(n);default:return String(n)}}catch(t){return console.warn("TaskCard: Error formatting user property value:",t),String(n)}}function d6(n,e,t,r){let s=lT(e),i=Ln(e),a="";if(s){let o=pr(e,{dateFormat:"",timeFormat:"h:mm a",showTime:!0});a=o.trim()===""?"Due: Today":`Due: Today at ${o}`}else i?a=`Due: ${pr(e,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})} (overdue)`:a=`Due: ${pr(e,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})}`;n.textContent=a,n.classList.add("task-card__metadata-date","task-card__metadata-date--due"),iB(n,t,r,"due")}function u6(n,e,t,r){let s=lT(e),i=Ln(e),a="";if(s){let o=pr(e,{dateFormat:"",timeFormat:"h:mm a",showTime:!0});a=o.trim()===""?"Scheduled: Today":`Scheduled: Today at ${o}`}else i?a=`Scheduled: ${pr(e,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})} (past)`:a=`Scheduled: ${pr(e,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0})}`;n.textContent=a,n.classList.add("task-card__metadata-date","task-card__metadata-date--scheduled"),iB(n,t,r,"scheduled")}function cB(n,e){if(e.length>0){for(let t=1;t<e.length;t++){let r=n.createEl("span",{cls:"task-card__metadata-separator",text:" \u2022 "});e[t].insertAdjacentElement("beforebegin",r)}n.style.display=""}else n.style.display="none"}function cr(n,e,t,r={}){var O;let s={...hS,...r},i=s.targetDate||e.selectedDate||new Date,a=n.recurrence?Hn(n,i):n.status,o=document.createElement("div");o._taskPath=n.path;let l=e.getActiveTimeSession(n)!==null,c=e.statusManager.isCompletedStatus(a),d=!!n.recurrence,u=["task-card"];c&&u.push("task-card--completed"),n.archived&&u.push("task-card--archived"),l&&u.push("task-card--actively-tracked"),d&&u.push("task-card--recurring"),s.showCheckbox&&u.push("task-card--checkbox-enabled"),n.priority&&u.push(`task-card--priority-${n.priority}`),a&&u.push(`task-card--status-${a}`),((O=e.settings)==null?void 0:O.subtaskChevronPosition)==="left"&&u.push("task-card--chevron-left"),qr(n.projects||[]).length>0&&u.push("task-card--has-projects"),o.className=u.join(" "),o.dataset.taskPath=n.path,o.dataset.key=n.path,o.dataset.status=a;let f=o.createEl("div",{cls:"task-card__main-row"}),p=e.priorityManager.getPriorityConfig(n.priority);p&&o.style.setProperty("--priority-color",p.color);let m=e.statusManager.getStatusConfig(a);if(m&&o.style.setProperty("--current-status-color",m.color),s.showCheckbox){let C=f.createEl("input",{type:"checkbox",cls:"task-card__checkbox"});C.checked=e.statusManager.isCompletedStatus(a),C.addEventListener("click",async P=>{P.stopPropagation();try{n.recurrence?await e.toggleRecurringTaskComplete(n,i):await e.toggleTaskStatus(n)}catch(U){let H=U instanceof Error?U.message:String(U);console.error("Error in task checkbox handler:",{error:H,taskPath:n.path}),new Te.Notice(`Failed to toggle task status: ${H}`)}})}let g=null;(!t||t.includes("status"))&&(g=f.createEl("span",{cls:"task-card__status-dot"}),m&&(g.style.borderColor=m.color)),g&&g.addEventListener("click",async C=>{C.stopPropagation();try{if(n.recurrence){let P=await e.toggleRecurringTaskComplete(n,i),U=Hn(P,i),H=e.statusManager.getStatusConfig(U),Y=e.statusManager.isCompletedStatus(U);H&&(g.style.borderColor=H.color);let z=["task-card"];Y&&z.push("task-card--completed"),n.archived&&z.push("task-card--archived"),e.getActiveTimeSession(n)&&z.push("task-card--actively-tracked"),n.recurrence&&z.push("task-card--recurring"),n.priority&&z.push(`task-card--priority-${n.priority}`),U&&z.push(`task-card--status-${U}`),o.className=z.join(" "),o.dataset.status=U;let ne=o.querySelector(".task-card__title");ne&&ne.classList.toggle("completed",Y)}else{let P=await e.cacheManager.getTaskInfo(n.path);if(!P){new Te.Notice("Task not found");return}let U=P.status||"open",H=e.statusManager.getNextStatus(U);await e.updateTaskProperty(P,"status",H)}}catch(P){let U=P instanceof Error?P.message:String(P);console.error("Error cycling task status:",{error:U,taskPath:n.path}),new Te.Notice(`Failed to update task status: ${U}`)}});let T=!t||t.includes("priority");if(n.priority&&p&&T){let C=f.createEl("span",{cls:"task-card__priority-dot",attr:{"aria-label":`Priority: ${p.label}`}});C.style.borderColor=p.color,C.addEventListener("click",P=>{P.stopPropagation(),new Pi({currentValue:n.priority,onSelect:async H=>{try{await e.updateTaskProperty(n,"priority",H)}catch(Y){console.error("Error updating priority:",Y),new Te.Notice("Failed to update priority")}},plugin:e}).show(P)})}if(n.recurrence){let C=f.createEl("div",{cls:"task-card__recurring-indicator",attr:{"aria-label":`Recurring: ${Bl(n.recurrence)} (click to change)`}});(0,Te.setTooltip)(C,`Recurring: ${Bl(n.recurrence)} (click to change)`,{placement:"top"}),(0,Te.setIcon)(C,"rotate-ccw"),C.addEventListener("click",P=>{P.stopPropagation(),new Wn({currentValue:typeof n.recurrence=="string"?n.recurrence:void 0,onSelect:async H=>{try{await e.updateTaskProperty(n,"recurrence",H||void 0)}catch(Y){console.error("Error updating recurrence:",Y),new Te.Notice("Failed to update recurrence")}},app:e.app}).show(P)})}if(n.reminders&&n.reminders.length>0){let C=f.createEl("div",{cls:"task-card__reminder-indicator",attr:{"aria-label":`${n.reminders.length} reminder${n.reminders.length>1?"s":""} set (click to manage)`}}),P=n.reminders.length,U=P===1?"1 reminder set (click to manage)":`${P} reminders set (click to manage)`;(0,Te.setTooltip)(C,U,{placement:"top"}),(0,Te.setIcon)(C,"bell"),C.addEventListener("click",H=>{H.stopPropagation(),new bi(e.app,e,n,async z=>{try{await e.updateTaskProperty(n,"reminders",z.length>0?z:void 0)}catch(ne){console.error("Error updating reminders:",ne),new Te.Notice("Failed to update reminders")}}).open()})}let w=f.createEl("div",{cls:"task-card__project-indicator-placeholder",attr:{style:"display: none;"}}),b=f.createEl("div",{cls:"task-card__chevron-placeholder",attr:{style:"display: none;"}});e.projectSubtasksService.isTaskUsedAsProject(n.path).then(C=>{var P,U;if(C){if(w.className="task-card__project-indicator",w.removeAttribute("style"),w.setAttribute("aria-label","This task is used as a project (click to filter subtasks)"),(0,Te.setTooltip)(w,"This task is used as a project (click to filter subtasks)",{placement:"top"}),(0,Te.setIcon)(w,"folder"),w.addEventListener("click",async H=>{H.stopPropagation();try{await e.applyProjectSubtaskFilter(n)}catch(Y){console.error("Error filtering project subtasks:",Y),new Te.Notice("Failed to filter project subtasks")}}),(P=e.settings)!=null&&P.showExpandableSubtasks){b.className="task-card__chevron",b.removeAttribute("style");let H=((U=e.expandedProjectsService)==null?void 0:U.isExpanded(n.path))||!1;H&&b.classList.add("task-card__chevron--expanded"),b.setAttribute("aria-label",H?"Collapse subtasks":"Expand subtasks"),(0,Te.setTooltip)(b,H?"Collapse subtasks":"Expand subtasks",{placement:"top"}),(0,Te.setIcon)(b,"chevron-right"),b.addEventListener("click",async Y=>{Y.stopPropagation();try{if(!e.expandedProjectsService){console.error("ExpandedProjectsService not initialized"),new Te.Notice("Service not available. Please try reloading the plugin.");return}let z=e.expandedProjectsService.toggle(n.path);b.classList.toggle("task-card__chevron--expanded",z),b.setAttribute("aria-label",z?"Collapse subtasks":"Expand subtasks"),(0,Te.setTooltip)(b,z?"Collapse subtasks":"Expand subtasks",{placement:"top"}),await zf(o,n,e,z)}catch(z){console.error("Error toggling subtasks:",z),new Te.Notice("Failed to toggle subtasks")}}),H&&zf(o,n,e,!0).catch(Y=>{console.error("Error showing initial subtasks:",Y)})}}else w.remove(),b.remove()}).catch(C=>{console.error("Error checking if task is used as project:",C),w.remove(),b.remove()});let S=f.createEl("div",{cls:"task-card__content"}),k=f.createEl("div",{cls:"task-card__context-menu",attr:{"aria-label":"Task options"}});(0,Te.setIcon)(k,"ellipsis-vertical"),(0,Te.setTooltip)(k,"Task options",{placement:"top"}),k.addEventListener("click",async C=>{C.stopPropagation(),C.preventDefault(),await Ty(C,n.path,e,i)});let D=S.createEl("div",{cls:"task-card__title",text:n.title});e.statusManager.isCompletedStatus(a)&&D.classList.add("completed");let M=S.createEl("div",{cls:"task-card__metadata"}),_=[],W=t||e.settings.defaultVisibleProperties||aB();for(let C of W){if(C==="status"||C==="priority")continue;let P=lB(M,C,n,e);P&&_.push(P)}cB(M,_);let{clickHandler:j,dblclickHandler:R}=yy({task:n,plugin:e,excludeSelector:".task-card__checkbox",contextMenuHandler:async C=>{let P=o.dataset.taskPath;P&&await Ty(C,P,e,i)}});return o.addEventListener("click",j),o.addEventListener("dblclick",R),o.addEventListener("contextmenu",async C=>{C.preventDefault(),C.stopPropagation();let P=o.dataset.taskPath;P&&await Ty(C,P,e,i)}),o.addEventListener("mouseover",vy(n,e)),o}async function Ty(n,e,t,r){try{let s=await t.cacheManager.getTaskInfo(e);if(!s){console.error(`No task found for path: ${e}`);return}new Yl({task:s,plugin:t,targetDate:r,onUpdate:()=>{t.app.workspace.trigger("tasknotes:refresh-views")}}).show(n)}catch(s){let i=s instanceof Error?s.message:String(s);console.error("Error creating context menu:",{error:i,taskPath:e}),new Te.Notice(`Failed to create context menu: ${i}`)}}function en(n,e,t,r,s={}){var W;let a={...hS,...s}.targetDate||t.selectedDate||new Date,o=e.recurrence?Hn(e,a):e.status,l=t.getActiveTimeSession(e)!==null,c=t.statusManager.isCompletedStatus(o),d=!!e.recurrence,u=["task-card"];c&&u.push("task-card--completed"),e.archived&&u.push("task-card--archived"),l&&u.push("task-card--actively-tracked"),d&&u.push("task-card--recurring"),e.priority&&u.push(`task-card--priority-${e.priority}`),o&&u.push(`task-card--status-${o}`),((W=t.settings)==null?void 0:W.subtaskChevronPosition)==="left"&&u.push("task-card--chevron-left"),n.className=u.join(" "),n.dataset.status=o;let h=n.querySelector(".task-card__main-row"),f=t.priorityManager.getPriorityConfig(e.priority);f&&n.style.setProperty("--priority-color",f.color);let p=t.statusManager.getStatusConfig(o);p&&n.style.setProperty("--current-status-color",p.color);let m=n.querySelector(".task-card__checkbox");m&&(m.checked=t.statusManager.isCompletedStatus(o));let g=!r||r.includes("status"),y=n.querySelector(".task-card__status-dot");if(g){if(y)p&&(y.style.borderColor=p.color);else if(h){let j=h.createEl("span",{cls:"task-card__status-dot"});p&&(j.style.borderColor=p.color),j.addEventListener("click",async O=>{O.stopPropagation();try{if(e.recurrence){let C=await t.toggleRecurringTaskComplete(e,a),P=Hn(C,a),U=t.statusManager.getStatusConfig(P),H=t.statusManager.isCompletedStatus(P);U&&(j.style.borderColor=U.color);let Y=["task-card"];H&&Y.push("task-card--completed"),e.archived&&Y.push("task-card--archived"),t.getActiveTimeSession(e)&&Y.push("task-card--actively-tracked"),e.recurrence&&Y.push("task-card--recurring"),e.priority&&Y.push(`task-card--priority-${e.priority}`),P&&Y.push(`task-card--status-${P}`),n.className=Y.join(" "),n.dataset.status=P;let z=n.querySelector(".task-card__title");z&&z.classList.toggle("completed",H)}else{let C=await t.cacheManager.getTaskInfo(e.path);if(!C){new Te.Notice("Task not found");return}let P=C.status||"open",U=t.statusManager.getNextStatus(P);await t.updateTaskProperty(C,"status",U)}}catch(C){let P=C instanceof Error?C.message:String(C);console.error("Error cycling task status:",{error:P,taskPath:e.path}),new Te.Notice(`Failed to update task status: ${P}`)}});let R=n.querySelector(".task-card__checkbox");R?R.insertAdjacentElement("afterend",j):h.insertBefore(j,h.firstChild)}}else y&&y.remove();let T=!r||r.includes("priority"),w=n.querySelector(".task-card__priority-dot");if(T&&e.priority&&f)if(!w&&h){let j=h.createEl("span",{cls:"task-card__priority-dot",attr:{"aria-label":`Priority: ${f.label}`}});j.style.borderColor=f.color,j.addEventListener("click",C=>{C.stopPropagation(),new Pi({currentValue:e.priority,onSelect:async U=>{try{await t.updateTaskProperty(e,"priority",U)}catch(H){console.error("Error updating priority:",H),new Te.Notice("Failed to update priority")}},plugin:t}).show(C)});let R=n.querySelector(".task-card__status-dot"),O=n.querySelector(".task-card__checkbox");R?R.insertAdjacentElement("afterend",j):O?O.insertAdjacentElement("afterend",j):h.insertBefore(j,h.firstChild)}else w&&(w.style.borderColor=f.color,w.setAttribute("aria-label",`Priority: ${f.label}`));else w&&w.remove();let b=n.querySelector(".task-card__recurring-indicator");if(e.recurrence&&!b){let j=h.createEl("span",{cls:"task-card__recurring-indicator",attr:{"aria-label":`Recurring: ${Bl(e.recurrence)}`}});(0,Te.setIcon)(j,"rotate-ccw"),y==null||y.insertAdjacentElement("afterend",j)}else if(!e.recurrence&&b)b.remove();else if(e.recurrence&&b){let j=Bl(e.recurrence);b.setAttribute("aria-label",`Recurring: ${j}`)}let S=n.querySelector(".task-card__reminder-indicator");if(e.reminders&&e.reminders.length>0&&!S){let j=h.createEl("div",{cls:"task-card__reminder-indicator",attr:{"aria-label":`${e.reminders.length} reminder${e.reminders.length>1?"s":""} set (click to manage)`}}),R=e.reminders.length,O=R===1?"1 reminder set (click to manage)":`${R} reminders set (click to manage)`;(0,Te.setTooltip)(j,O,{placement:"top"}),(0,Te.setIcon)(j,"bell"),j.addEventListener("click",P=>{P.stopPropagation(),new bi(t.app,t,e,async H=>{try{await t.updateTaskProperty(e,"reminders",H.length>0?H:void 0)}catch(Y){console.error("Error updating reminders:",Y),new Te.Notice("Failed to update reminders")}}).open()});let C=b||y;C==null||C.insertAdjacentElement("afterend",j)}else if((!e.reminders||e.reminders.length===0)&&S)S.remove();else if(e.reminders&&e.reminders.length>0&&S){let j=e.reminders.length,R=j===1?"1 reminder set (click to manage)":`${j} reminders set (click to manage)`;S.setAttribute("aria-label",`${j} reminder${j>1?"s":""} set (click to manage)`),(0,Te.setTooltip)(S,R,{placement:"top"})}let k=n.querySelector(".task-card__project-indicator"),D=n.querySelector(".task-card__project-indicator-placeholder");t.projectSubtasksService.isTaskUsedAsProject(e.path).then(j=>{var C,P,U;if(j&&!k&&!D){let H=h.createEl("div",{cls:"task-card__project-indicator",attr:{"aria-label":"This task is used as a project (click to filter subtasks)",title:"This task is used as a project (click to filter subtasks)"}});(0,Te.setIcon)(H,"folder"),H.addEventListener("click",async z=>{z.stopPropagation();try{await t.applyProjectSubtaskFilter(e)}catch(ne){console.error("Error filtering project subtasks:",ne),new Te.Notice("Failed to filter project subtasks")}});let Y=n.querySelector(".task-card__recurring-indicator")||n.querySelector(".task-card__priority-dot")||n.querySelector(".task-card__status-dot");Y==null||Y.insertAdjacentElement("afterend",H)}else!j&&(k||D)&&(k==null||k.remove(),D==null||D.remove());let R=n.querySelector(".task-card__chevron"),O=n.querySelector(".task-card__chevron-placeholder");if(j&&((C=t.settings)!=null&&C.showExpandableSubtasks)&&!R&&!O){let H=h.createEl("div",{cls:"task-card__chevron",attr:{"aria-label":"Expand subtasks",title:"Expand subtasks"}}),Y=((P=t.expandedProjectsService)==null?void 0:P.isExpanded(e.path))||!1;Y?(H.classList.add("task-card__chevron--expanded"),H.setAttribute("aria-label","Collapse subtasks"),(0,Te.setTooltip)(H,"Collapse subtasks",{placement:"top"})):(0,Te.setTooltip)(H,"Expand subtasks",{placement:"top"}),(0,Te.setIcon)(H,"chevron-right"),H.addEventListener("click",async ne=>{ne.stopPropagation();try{if(!t.expandedProjectsService){console.error("ExpandedProjectsService not initialized in update"),new Te.Notice("Service not available. Please try reloading the plugin.");return}let le=t.expandedProjectsService.toggle(e.path);H.classList.toggle("task-card__chevron--expanded",le),H.setAttribute("aria-label",le?"Collapse subtasks":"Expand subtasks"),(0,Te.setTooltip)(H,le?"Collapse subtasks":"Expand subtasks",{placement:"top"}),await zf(n,e,t,le)}catch(le){console.error("Error toggling subtasks:",le),new Te.Notice("Failed to toggle subtasks")}});let z=n.querySelector(".task-card__project-indicator");z==null||z.insertAdjacentElement("afterend",H),Y&&(H.classList.add("task-card__chevron--expanded"),H.setAttribute("aria-label","Collapse subtasks"),(0,Te.setTooltip)(H,"Collapse subtasks",{placement:"top"}),zf(n,e,t,!0).catch(ne=>{console.error("Error showing initial subtasks in update:",ne)}))}else if((!j||!((U=t.settings)!=null&&U.showExpandableSubtasks))&&(R||O)){R==null||R.remove(),O==null||O.remove();let H=n.querySelector(".task-card__subtasks");if(H){let Y=H._clickHandler;Y&&(H.removeEventListener("click",Y),delete H._clickHandler),H.remove()}}}).catch(j=>{console.error("Error checking if task is used as project in update:",j)});let M=n.querySelector(".task-card__title");M&&(M.textContent=e.title,M.classList.toggle("completed",t.statusManager.isCompletedStatus(o)));let _=n.querySelector(".task-card__metadata");if(_){_.innerHTML="";let j=[],R=r||t.settings.defaultVisibleProperties||aB();for(let O of R){if(O==="status"||O==="priority")continue;let C=lB(_,O,e,t);C&&j.push(C)}cB(_,j)}}async function h6(n,e){return new Promise((t,r)=>{new uS(e.app,n,async()=>{try{await e.taskService.deleteTask(n),t()}catch(i){r(i)}}).open()})}function f6(n){let e=n.querySelector(".task-card__subtasks");if(e){let t=e._clickHandler;t&&(e.removeEventListener("click",t),delete e._clickHandler)}}async function zf(n,e,t,r){try{let s=n.querySelector(".task-card__subtasks");if(r){if(!s){s=document.createElement("div"),s.className="task-card__subtasks";let a=o=>{o.stopPropagation()};s.addEventListener("click",a),s._clickHandler=a,n.appendChild(s)}for(;s.firstChild;)s.removeChild(s.firstChild);let i=s.createEl("div",{cls:"task-card__subtasks-loading",text:"Loading subtasks..."});try{let a=t.app.vault.getAbstractFileByPath(e.path);if(!(a instanceof Te.TFile))throw new Error("Task file not found");if(!t.projectSubtasksService)throw new Error("projectSubtasksService not initialized");let o=await t.projectSubtasksService.getTasksLinkedToProject(a);if(i.remove(),o.length===0){s.createEl("div",{cls:"task-card__subtasks-loading",text:"No subtasks found"});return}let l=t.projectSubtasksService.sortTasks(o),d=(u=>{var p;let h=[],f=u.closest(".task-card");for(;f;){let m=f._taskPath;m&&h.unshift(m),f=(p=f.parentElement)==null?void 0:p.closest(".task-card")}return h})(n);for(let u of l){if(d.includes(u.path)){console.warn("Circular reference detected in task chain:",{subtask:u.path,parentChain:d,cycle:[...d,u.path]});continue}let h=cr(u,t,void 0,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1});h.classList.add("task-card--subtask"),s.appendChild(h)}}catch(a){console.error("Error loading subtasks:",a),i.textContent="Failed to load subtasks"}}else if(s){let i=s._clickHandler;i&&(s.removeEventListener("click",i),delete s._clickHandler),s.remove()}}catch(s){throw console.error("Error in toggleSubtasks:",s),s}}async function tl(n,e,t){if(!n||!n.projects||n.projects.length===0)return;let r=0,s=10;for(;r<s;){try{let a=await e.cacheManager.getTaskInfo(n.path);if(a&&a.dateModified===n.dateModified)break}catch(a){}await new Promise(a=>setTimeout(a,10)),r++}let i=t.querySelectorAll(".task-card__chevron--expanded");for(let a of i){let o=a.closest(".task-card");if(!o)continue;let l=o.dataset.taskPath;if(!l)continue;let c=e.app.vault.getAbstractFileByPath(l);if(!(c instanceof Te.TFile))continue;let d=c.basename;if(n.projects.flat(2).some(h=>{if(h&&typeof h=="string"&&h.startsWith("[[")&&h.endsWith("]]")){let f=h.slice(2,-2).trim(),p=e.app.metadataCache.getFirstLinkpathDest(f,"");return f===d||p&&p.path===l}return h===d||h===l})&&o.querySelector(".task-card__subtasks"))try{let f=await e.cacheManager.getTaskInfo(l);f&&await zf(o,f,e,!0)}catch(f){console.error("Error refreshing parent task subtasks:",f)}}}var Te,hS,tB,rB,uS,Sn=v(()=>{Te=require("obsidian");WT();Lt();Fe();Vl();Tg();Bd();dS();dm();lS();eB();hS={showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1};tB={due:n=>n.due,scheduled:n=>n.scheduled,projects:n=>n.projects,contexts:n=>n.contexts,tags:n=>n.tags,timeEstimate:n=>n.timeEstimate,totalTrackedTime:n=>n.totalTrackedTime,recurrence:n=>n.recurrence,completedDate:n=>n.completedDate,"file.ctime":n=>n.dateCreated,"file.mtime":n=>n.dateModified};rB={due:(n,e,t,r)=>{typeof e=="string"&&d6(n,e,t,r)},scheduled:(n,e,t,r)=>{typeof e=="string"&&u6(n,e,t,r)},projects:(n,e,t,r)=>{if(Array.isArray(e)){let s={metadataCache:r.app.metadataCache,workspace:r.app.workspace};dy(n,e,s)}},contexts:(n,e,t,r)=>{Array.isArray(e)&&XF(n,e,{onTagClick:async(i,a)=>{let o=i.startsWith("@")?i.slice(1):i;await r.openTagsPane(`#${o}`)||console.log("Could not open search pane, context clicked:",i)}})},tags:(n,e,t,r)=>{Array.isArray(e)&&JF(n,e,{onTagClick:async(i,a)=>{let o=i.startsWith("#")?i.slice(1):i;await r.openTagsPane(`#${o}`)||console.log("Could not open search pane, tag clicked:",i)}})},timeEstimate:(n,e,t,r)=>{typeof e=="number"&&(n.textContent=`${r.formatTime(e)} estimated`)},totalTrackedTime:(n,e,t,r)=>{typeof e=="number"&&e>0&&(n.textContent=`${r.formatTime(e)} tracked`)},recurrence:(n,e)=>{typeof e=="string"&&(n.textContent=`Recurring: ${Bl(e)}`)},completedDate:(n,e)=>{typeof e=="string"&&(n.textContent=`Completed: ${pr(e,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!1})}`)},"file.ctime":(n,e)=>{typeof e=="string"&&(n.textContent=`Created: ${pr(e,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!1})}`)},"file.mtime":(n,e)=>{typeof e=="string"&&(n.textContent=`Modified: ${pr(e,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!1})}`)}};uS=class extends Te.Modal{constructor(e,t,r){super(e),this.task=t,this.onConfirm=r}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Delete Task"});let t=e.createEl("p");t.appendText('Are you sure you want to delete the task "'),t.createEl("strong",{text:this.task.title}),t.appendText('"?'),e.createEl("p",{cls:"mod-warning",text:"This action cannot be undone. The task file will be permanently deleted."});let r=e.createEl("div",{cls:"modal-button-container"});r.style.display="flex",r.style.gap="10px",r.style.justifyContent="flex-end",r.style.marginTop="20px";let s=r.createEl("button",{text:"Cancel"});s.addEventListener("click",()=>{this.close()});let i=r.createEl("button",{text:"Delete",cls:"mod-warning"});i.style.backgroundColor="var(--color-red)",i.style.color="white",i.addEventListener("click",async()=>{try{await this.onConfirm(),this.close(),new Te.Notice("Task deleted successfully")}catch(a){let o=a instanceof Error?a.message:String(a);new Te.Notice(`Failed to delete task: ${o}`),console.error("Error in delete confirmation:",a)}}),s.focus()}onClose(){let{contentEl:e}=this;e.empty()}}});var jc,pS=v(()=>{jc=class n{constructor(e){this.statuses=e}getNextStatus(e){var i;let t=this.getStatusesByOrder(),r=t.findIndex(a=>a.value===e);if(r===-1)return((i=t[0])==null?void 0:i.value)||"open";let s=(r+1)%t.length;return t[s].value}getStatusConfig(e){return this.statuses.find(t=>t.value===e)}getCompletedStatuses(){return this.statuses.filter(e=>e.isCompleted).map(e=>e.value)}getOpenStatuses(){return this.statuses.filter(e=>!e.isCompleted).map(e=>e.value)}getStatusesByOrder(){return[...this.statuses].sort((e,t)=>e.order-t.order)}isCompletedStatus(e){let t=this.getStatusConfig(e);return(t==null?void 0:t.isCompleted)||!1}getStatusOrder(e){let t=this.getStatusConfig(e);return(t==null?void 0:t.order)||0}getStatusStyles(){let e=[];for(let t of this.statuses){let r=`--status-${t.value.replace(/[^a-zA-Z0-9-]/g,"-")}-color`;e.push(`${r}: ${t.color};`)}return`:root { ${e.join(" ")} }`}getAllStatuses(){return[...this.statuses]}getNonCompletionStatuses(){return this.statuses.filter(e=>!e.isCompleted)}updateStatuses(e){this.statuses=e}static validateStatuses(e){let t=[];e.length<2&&t.push("At least 2 statuses are required"),e.some(l=>l.isCompleted)||t.push("At least one status must be marked as completed");let s=e.map(l=>l.value),i=new Set(s);s.length!==i.size&&t.push("Status values must be unique");let a=e.map(l=>l.id),o=new Set(a);a.length!==o.size&&t.push("Status IDs must be unique");for(let l of e){if(!l.value||l.value.trim()===""){t.push("Status values cannot be empty");break}if(!l.label||l.label.trim()===""){t.push("Status labels cannot be empty");break}if(!l.color||!l.color.match(/^#[0-9a-fA-F]{6}$/)){t.push("Status colors must be valid hex colors (#rrggbb)");break}}return{valid:t.length===0,errors:t}}static generateStatusId(e){let t=new Set(e.map(i=>i.id)),r=1,s=`status-${r}`;for(;t.has(s);)r++,s=`status-${r}`;return s}static createDefaultStatus(e){let t=n.generateStatusId(e),r=Math.max(...e.map(s=>s.order),0)+1;return{id:t,value:"new-status",label:"New status",color:"#808080",isCompleted:!1,order:r,autoArchive:!1,autoArchiveDelay:5}}}});var wB={};nt(wB,{TaskLinkDetectionService:()=>Jf});var sl,Jf,mS=v(()=>{sl=require("obsidian"),Jf=class{constructor(e){this.linkCache=new Map;this.plugin=e}async detectTaskLink(e,t,r="wikilink"){let s=r==="wikilink"?this.parseWikilink(e):this.parseMarkdownLink(e);if(!s)return{isValidTaskLink:!1};let{linkPath:i,displayText:a}=s,o=`${t}:${i}`,l=this.linkCache.get(o);if(l){let h=this.plugin.app.vault.getAbstractFileByPath(i);if(h instanceof sl.TFile&&h.stat.mtime===l.lastModified)return l.result}let c=this.resolveLinkPath(i,t);if(!c){let h={isValidTaskLink:!1};return this.cacheResult(o,h,0),h}let d=this.plugin.app.vault.getAbstractFileByPath(c);if(!(d instanceof sl.TFile)){let h={isValidTaskLink:!1};return this.cacheResult(o,h,0),h}try{let h=await this.plugin.cacheManager.getTaskInfo(c);if(h){let f={isValidTaskLink:!0,taskPath:c,taskInfo:h,displayText:a};return this.cacheResult(o,f,d.stat.mtime),f}}catch(h){console.debug("TaskLinkDetectionService: Error checking task info for link:",c,h)}let u={isValidTaskLink:!1};return this.cacheResult(o,u,d.stat.mtime),u}parseWikilink(e){let t=e.slice(2,-2).trim();if(!t)return null;let r=t.indexOf("|");if(r!==-1){let i=t.slice(0,r).trim(),a=t.slice(r+1).trim();return!i||!a?null:{linkPath:(0,sl.parseLinktext)(i).path,displayText:a}}let s=(0,sl.parseLinktext)(t);return{linkPath:s.path,displayText:s.subpath||void 0}}parseMarkdownLink(e){let t=e.match(/^\[([^\]]*)\]\(([^)]+)\)$/);if(!t)return null;let r=t[1].trim(),s=t[2].trim();if(!s)return null;try{s=decodeURIComponent(s)}catch(a){console.debug("TaskLinkDetectionService: Failed to decode URI component:",s,a)}let i=(0,sl.parseLinktext)(s);return{linkPath:i.path,displayText:r||i.subpath||void 0}}resolveLinkPath(e,t){try{let r=this.plugin.app.metadataCache.getFirstLinkpathDest(e,t);return(r==null?void 0:r.path)||null}catch(r){return console.debug("Error resolving link path:",e,r),null}}cacheResult(e,t,r){if(this.linkCache.set(e,{result:t,lastModified:r}),this.linkCache.size>1e3){let s=this.linkCache.keys().next().value;this.linkCache.delete(s)}}clearCacheForFile(e){for(let[t]of this.linkCache)t.includes(e)&&this.linkCache.delete(t)}clearCache(){this.linkCache.clear()}findWikilinks(e){let t=[],r=/\[\[([^\]]+)\]\]/g,s;for(;(s=r.exec(e))!==null;)t.push({match:s[0],start:s.index,end:s.index+s[0].length,type:"wikilink"});let i=/\[([^\]]*)\]\(([^)]+)\)/g;for(r.lastIndex=0;(s=i.exec(e))!==null;)t.push({match:s[0],start:s.index,end:s.index+s[0].length,type:"markdown"});return t.sort((a,o)=>a.start-o.start)}cleanup(){this.linkCache.clear()}}});var bB,dr,Vc,gS=v(()=>{bB=require("@codemirror/view"),dr=require("obsidian");Fe();Lt();Ly();Vl();Tg();Bd();dS();Vc=class n extends bB.WidgetType{constructor(e,t,r,s){super(),this.taskInfo=e,this.plugin=t,this.originalText=r,this.displayText=s}toDOM(e){let t=document.createElement("span"),r=this.plugin.selectedDate||(()=>{let h=new Date;return new Date(Date.UTC(h.getFullYear(),h.getMonth(),h.getDate()))})(),s=this.taskInfo.recurrence?Hn(this.taskInfo,r):this.taskInfo.status,i=["tasknotes-plugin","task-inline-preview"];this.taskInfo.priority&&i.push(`task-inline-preview--priority-${this.taskInfo.priority}`),this.plugin.statusManager.isCompletedStatus(s)&&i.push("task-inline-preview--completed"),t.className=i.join(" ");let a=this.plugin.statusManager.getStatusConfig(s),o=t.createEl("span",{cls:"task-inline-preview__status-dot"});if((0,dr.setTooltip)(o,`Status: ${a?a.label:s}`,{placement:"top"}),a&&(o.style.borderColor=a.color,this.plugin.statusManager.isCompletedStatus(s)?o.style.backgroundColor=a.color:o.style.backgroundColor="transparent"),o.addEventListener("click",async h=>{h.stopPropagation(),h.preventDefault();try{if(this.taskInfo.recurrence){let f=await this.plugin.toggleRecurringTaskComplete(this.taskInfo,r),p=Hn(f,r),m=this.plugin.statusManager.getStatusConfig(p),g=this.plugin.statusManager.isCompletedStatus(p);m&&(o.style.borderColor=m.color,g?o.style.backgroundColor=m.color:o.style.backgroundColor="transparent"),g?t.classList.add("task-inline-preview--completed"):t.classList.remove("task-inline-preview--completed"),this.taskInfo=f}else{let f=await this.plugin.cacheManager.getTaskInfo(this.taskInfo.path);if(!f)return;let p=f.status||"open",m=this.plugin.statusManager.getNextStatus(p);await this.plugin.updateTaskProperty(f,"status",m),this.taskInfo.status=m;let g=this.plugin.statusManager.getStatusConfig(m);g&&(o.style.borderColor=g.color),this.plugin.statusManager.isCompletedStatus(m)?(t.classList.add("task-inline-preview--completed"),g&&(o.style.backgroundColor=g.color)):(t.classList.remove("task-inline-preview--completed"),o.style.backgroundColor="transparent")}setTimeout(()=>{e&&typeof e.dispatch=="function"&&Fa(e,this.taskInfo.path)},50)}catch(f){console.error("Error cycling task status in inline widget:",f)}}),this.taskInfo.priority){let h=this.plugin.priorityManager.getPriorityConfig(this.taskInfo.priority);if(h){let f=t.createEl("span",{cls:"task-inline-preview__priority-dot task-card__priority-dot"});(0,dr.setTooltip)(f,`Priority: ${h.label} (click to change)`,{placement:"top"}),f.style.backgroundColor=h.color,f.addEventListener("click",p=>{p.stopPropagation(),p.preventDefault(),new Pi({currentValue:this.taskInfo.priority,onSelect:async g=>{try{await this.plugin.updateTaskProperty(this.taskInfo,"priority",g),this.taskInfo.priority=g;let y=this.plugin.priorityManager.getPriorityConfig(g);y&&(f.style.backgroundColor=y.color,(0,dr.setTooltip)(f,`Priority: ${y.label} (click to change)`,{placement:"top"}))}catch(y){console.error("Error updating priority:",y),new dr.Notice("Failed to update priority")}},plugin:this.plugin}).show(p)})}}let l=this.taskInfo.title.length>80?this.taskInfo.title.slice(0,77)+"...":this.taskInfo.title;if(t.createEl("span",{cls:"task-inline-preview__title",text:l}),this.taskInfo.due){let h=pr(this.taskInfo.due,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0}),f=pr(this.taskInfo.due,{dateFormat:"MMM d, yyyy",timeFormat:"h:mm a",showTime:!0}),p=t.createEl("span",{cls:"task-inline-preview__date task-inline-preview__date--due task-card__metadata-date task-card__metadata-date--due"});(0,dr.setTooltip)(p,`Due: ${f} (click to change)`,{placement:"top"});let m=p.createEl("span",{cls:"task-inline-preview__date-icon"});(0,dr.setIcon)(m,"calendar"),p.appendText(h),p.addEventListener("click",g=>{g.stopPropagation(),g.preventDefault(),new Kr({currentValue:ve(this.taskInfo.due||""),currentTime:Er(this.taskInfo.due||""),onSelect:async(T,w)=>{try{let b;T?w?b=`${T}T${w}`:b=T:b=void 0,await this.plugin.updateTaskProperty(this.taskInfo,"due",b),this.taskInfo.due=b}catch(b){console.error("Error updating due date:",b),new dr.Notice("Failed to update due date")}}}).show(g)})}if(this.taskInfo.scheduled&&(!this.taskInfo.due||this.taskInfo.scheduled!==this.taskInfo.due)){let h=pr(this.taskInfo.scheduled,{dateFormat:"MMM d",timeFormat:"h:mm a",showTime:!0}),f=pr(this.taskInfo.scheduled,{dateFormat:"MMM d, yyyy",timeFormat:"h:mm a",showTime:!0}),p=t.createEl("span",{cls:"task-inline-preview__date task-inline-preview__date--scheduled task-card__metadata-date task-card__metadata-date--scheduled"});(0,dr.setTooltip)(p,`Scheduled: ${f} (click to change)`,{placement:"top"});let m=p.createEl("span",{cls:"task-inline-preview__date-icon"});(0,dr.setIcon)(m,"clock"),p.appendText(h),p.addEventListener("click",g=>{g.stopPropagation(),g.preventDefault(),new Kr({currentValue:ve(this.taskInfo.scheduled||""),currentTime:Er(this.taskInfo.scheduled||""),onSelect:async(T,w)=>{try{let b;T?w?b=`${T}T${w}`:b=T:b=void 0,await this.plugin.updateTaskProperty(this.taskInfo,"scheduled",b),this.taskInfo.scheduled=b}catch(b){console.error("Error updating scheduled date:",b),new dr.Notice("Failed to update scheduled date")}}}).show(g)})}if(this.taskInfo.recurrence){let h=t.createEl("span",{cls:"task-inline-preview__recurring-indicator",attr:{"aria-label":"Recurring task (click to change)"}});(0,dr.setTooltip)(h,"Recurring task (click to change)",{placement:"top"}),(0,dr.setIcon)(h,"rotate-ccw"),h.addEventListener("click",f=>{f.stopPropagation(),f.preventDefault(),new Wn({currentValue:typeof this.taskInfo.recurrence=="string"?this.taskInfo.recurrence:void 0,onSelect:async m=>{try{await this.plugin.updateTaskProperty(this.taskInfo,"recurrence",m||void 0),this.taskInfo.recurrence=m||void 0}catch(g){console.error("Error updating recurrence:",g),new dr.Notice("Failed to update recurrence")}},app:this.plugin.app}).show(f)})}let c=t.createEl("span",{cls:"task-inline-preview__pencil",text:""});(0,dr.setTooltip)(c,"Task options",{placement:"top"}),(0,dr.setIcon)(c,"ellipsis-vertical"),t.dataset.taskPath=this.taskInfo.path,t.dataset.originalText=this.originalText,this.addDragHandlers(t),c.addEventListener("click",h=>{h.preventDefault(),h.stopPropagation(),this.showTaskContextMenu(h,t)});let{clickHandler:d,dblclickHandler:u}=yy({task:this.taskInfo,plugin:this.plugin,excludeSelector:".task-inline-preview__pencil"});return t.addEventListener("click",async h=>{h.preventDefault(),h.stopPropagation(),await d(h)}),t.addEventListener("dblclick",async h=>{h.preventDefault(),h.stopPropagation(),await u(h)}),t.addEventListener("contextmenu",async h=>{h.preventDefault(),h.stopPropagation(),await this.showTaskContextMenu(h,t)}),t.addEventListener("mouseover",vy(this.taskInfo,this.plugin)),t}addDragHandlers(e){this.plugin.dragDropManager.makeTaskCardDraggable(e,this.taskInfo.path)}async showTaskContextMenu(e,t){try{let{showTaskContextMenu:r}=await Promise.resolve().then(()=>(Sn(),wy)),s=this.plugin.selectedDate||(()=>{let i=new Date;return new Date(Date.UTC(i.getFullYear(),i.getMonth(),i.getDate()))})();await r(e,this.taskInfo.path,this.plugin,s)}catch(r){console.error(`Error showing context menu for task ${this.taskInfo.path}:`,r),await this.plugin.openTaskEditModal(this.taskInfo)}}eq(e){return e instanceof n?this.taskInfo.path===e.taskInfo.path&&this.taskInfo.status===e.taskInfo.status&&this.taskInfo.title===e.taskInfo.title&&this.taskInfo.priority===e.taskInfo.priority&&this.taskInfo.archived===e.taskInfo.archived&&this.taskInfo.due===e.taskInfo.due&&this.taskInfo.scheduled===e.taskInfo.scheduled&&this.taskInfo.recurrence===e.taskInfo.recurrence&&JSON.stringify(this.taskInfo.complete_instances)===JSON.stringify(e.taskInfo.complete_instances)&&this.taskInfo.dateModified===e.taskInfo.dateModified:!1}ignoreEvent(){return!1}get estimatedHeight(){return-1}get block(){return!1}}});function w6(n){let e=new Map;return ii.ViewPlugin.fromClass(class{constructor(t){this.decorations=this.buildDecorations(t)}update(t){var s,i;if(!((s=n==null?void 0:n.settings)!=null&&s.enableTaskLinkOverlay)){this.decorations=ii.Decoration.none;return}try{if(!t.state.field(Wi.editorLivePreviewField)){this.decorations=ii.Decoration.none;return}}catch(a){this.decorations=ii.Decoration.none;return}let r=t.transactions.some(a=>a.effects.some(o=>o.is(yS)));if(t.docChanged||t.selectionSet||r){if(r){let a=(i=t.transactions.flatMap(o=>o.effects).find(o=>o.is(yS)))==null?void 0:i.value;if(a!=null&&a.taskPath)for(let[o]of e.entries())o.includes(a.taskPath)&&e.delete(o);else e.clear()}this.decorations=this.buildDecorations(t.view)}}buildDecorations(t){var r;try{return(r=n==null?void 0:n.settings)!=null&&r.enableTaskLinkOverlay?t.state.field(Wi.editorLivePreviewField)?b6(t.state,n,e):ii.Decoration.none:ii.Decoration.none}catch(s){return console.error("Error building task link decorations:",s),ii.Decoration.none}}},{decorations:t=>t.decorations})}function b6(n,e,t){var l,c;let r=new Fy.RangeSetBuilder;if(!n||!e||!t)return r.finish();let s=n.doc;if(!s||!e.app||!e.app.workspace)return r.finish();let i=e.taskLinkDetectionService||new Jf(e),a=e.app.workspace.getActiveViewOfType(Wi.MarkdownView);if(!a)return r.finish();let o=(l=a.file)==null?void 0:l.path;if(!o||typeof o!="string"||o.length===0)return r.finish();try{let d=s.toString();if(typeof d!="string"||d.length>1e5)return r.finish();let u=(c=n.selection)==null?void 0:c.main.head,h=i.findWikilinks(d);if(!Array.isArray(h))return r.finish();for(let f of h)try{if(!f||typeof f.match!="string"||typeof f.start!="number"||typeof f.end!="number"||f.start<0||f.end<=f.start||f.start>=d.length||f.end>d.length)continue;let p=f.type==="wikilink"?k6(f.match):E6(f.match);if(!p)continue;let{linkPath:m}=p;if(!m||typeof m!="string"||m.trim().length===0)continue;let g=S6(m,o,e);if(!g)continue;let y=D6(g,e);if(y){if(!y.title||typeof y.title!="string"||u!==void 0&&u>=f.start&&u<f.end)continue;let T=`${g}-${f.start}-${f.end}`,w=new Vc(y,e,f.match,p.displayText),b=t.get(T);(!b||!b.eq(w))&&t.set(T,w);let S=ii.Decoration.replace({widget:t.get(T),inclusive:!0});r.add(f.start,f.end,S)}}catch(p){continue}}catch(d){console.error("Error in buildTaskLinkDecorations:",d)}return r.finish()}function k6(n){if(!n||typeof n!="string"||n.length<4||!n.startsWith("[[")||!n.endsWith("]]"))return null;let e=n.slice(2,-2).trim();if(!e||e.length===0||e.length>500)return null;let t=e.indexOf("|");if(t!==-1){let s=e.slice(0,t).trim(),i=e.slice(t+1).trim();if(!s||!i)return null;let a=(0,Wi.parseLinktext)(s);return a.path?{linkPath:a.path,displayText:i}:null}let r=(0,Wi.parseLinktext)(e);return r.path?{linkPath:r.path,displayText:r.subpath||void 0}:null}function E6(n){if(!n||typeof n!="string")return null;let e=n.match(/^\[([^\]]*)\]\(([^)]+)\)$/);if(!e)return null;let t=e[1].trim(),r=e[2].trim();if(!r||r.length===0||r.length>500)return null;try{r=decodeURIComponent(r)}catch(i){}let s=(0,Wi.parseLinktext)(r);return s.path?{linkPath:s.path,displayText:t||s.subpath||void 0}:null}function S6(n,e,t){if(!n||typeof n!="string"||n.trim().length===0||!e||typeof e!="string"||!t||!t.app||!t.app.metadataCache)return null;try{let r=n.replace(/\.\./g,"").trim();if(!r)return null;let s=t.app.metadataCache.getFirstLinkpathDest(r,e);return!s||!s.path||typeof s.path!="string"?null:s.path}catch(r){return null}}function D6(n,e){if(!n||typeof n!="string"||n.trim().length===0||!e)return null;try{let t=/[<>:"|?*]/,r=n.split("").some(a=>{let o=a.charCodeAt(0);return o<=31||o===127});if(t.test(n)||r)return null;let s=e.cacheManager;if(!s||!s.getCachedTaskInfoSync)return null;let i=s.getCachedTaskInfoSync(n);return i&&typeof i=="object"&&i.title?i:null}catch(t){return null}}function kB(n){return w6(n)}function Fa(n,e){if(!n||typeof n.dispatch!="function"){console.warn("Invalid EditorView passed to dispatchTaskUpdate:",n);return}try{n.dispatch({effects:[yS.of({taskPath:e})]})}catch(t){console.error("Error dispatching task update:",t)}}var Fy,ii,Wi,yS,Ly=v(()=>{Fy=require("@codemirror/state"),ii=require("@codemirror/view"),Wi=require("obsidian");mS();gS();yS=Fy.StateEffect.define()});function jB(n,e){var s;let t=new Set(["title","status","priority","archived","due","scheduled","contexts","projects","tags","timeEstimate","completedDate","recurrence","dateCreated","dateModified","timeEntries","reminders","icsEventId"]),r={};return Object.keys(n).forEach(i=>{t.has(i)||(r[i]=n[i])}),{title:n.title||e.name||((s=e.path.split("/").pop())==null?void 0:s.replace(".md",""))||"Untitled",status:n.status||"open",priority:n.priority||"normal",path:e.path,archived:n.archived||!1,due:n.due,scheduled:n.scheduled,contexts:Array.isArray(n.contexts)?n.contexts:n.contexts?[n.contexts]:void 0,projects:Array.isArray(n.projects)?n.projects:n.projects?[n.projects]:void 0,tags:Array.isArray(n.tags)?n.tags:n.tags?[n.tags]:void 0,timeEstimate:n.timeEstimate,completedDate:n.completedDate,recurrence:n.recurrence,dateCreated:n.dateCreated,dateModified:n.dateModified,timeEntries:n.timeEntries,reminders:n.reminders,icsEventId:n.icsEventId,customProperties:Object.keys(r).length>0?r:void 0,basesData:e.basesData}}function t4(n,e){if(!(n!=null&&n.path))return null;let t=n.properties||n.frontmatter||{};if(e!=null&&e.fieldMapper){let r=e.fieldMapper.mapFromFrontmatter(t,n.path,e.settings.storeTitleInFilename);return{...jB(r,n),customProperties:r.customProperties}}else return jB(t,n)}async function iv(n,e,t){let r=t||t4,s=[];for(let i of n)if(i!=null&&i.path)try{let a=r(i,e);a&&s.push(a)}catch(a){console.warn("[TaskNotes][BasesPOC] Error converting Bases item to TaskInfo:",a)}return s}function r4(n){var e,t,r,s,i,a,o,l,c,d,u,h;try{let f=(e=n==null?void 0:n.controller)!=null?e:n,p=(t=n==null?void 0:n.query)!=null?t:f==null?void 0:f.query;if(!f)return[];let m=p==null?void 0:p.properties,g=new Map;if(m&&typeof m=="object")for(let S of Object.keys(m)){g.set(S,S);let k=S.includes(".")?S.split(".").pop():S;g.set(k,S);let D=(s=(r=m[S])==null?void 0:r.getDisplayName)==null?void 0:s.call(r);typeof D=="string"&&D.trim()&&g.set(D.toLowerCase(),S)}let y=S=>{if(S)return g.get(S)||g.get(S.toLowerCase())||S},T=(a=(i=f==null?void 0:f.getViewConfig)==null?void 0:i.call(f))!=null?a:{},w;try{w=(d=(l=(o=p==null?void 0:p.getViewConfig)==null?void 0:o.call(p,"order"))!=null?l:T==null?void 0:T.order)!=null?d:(c=T==null?void 0:T.columns)==null?void 0:c.order}catch(S){w=(h=T==null?void 0:T.order)!=null?h:(u=T==null?void 0:T.columns)==null?void 0:u.order}return!w||!Array.isArray(w)||w.length===0?[]:w.map(y).filter(S=>!!S).map(S=>{var k,D,M;return{id:S,displayName:(M=(D=(k=m==null?void 0:m[S])==null?void 0:k.getDisplayName)==null?void 0:D.call(k))!=null?M:S,visible:!0}})}catch(f){return console.debug("[TaskNotes][Bases] getBasesVisibleProperties failed:",f),[]}}async function VB(n,e,t,r){let{createTaskCard:s}=await Promise.resolve().then(()=>(Sn(),wy)),i=document.createElement("div");i.className="tn-bases-tasknotes-list",i.style.cssText="display: flex; flex-direction: column; gap: 1px;",n.appendChild(i);let a,o={showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1};if(r){let l=r4(r);l.length>0&&(a=l.map(c=>c.id),a=a.map(c=>{var h,f;let d=c,u=(h=t.fieldMapper)==null?void 0:h.fromUserField(c);if(u)d=u;else if(c.startsWith("task."))d=c.substring(5);else if(c.startsWith("note.")){let p=c.substring(5),m=(f=t.fieldMapper)==null?void 0:f.fromUserField(p);m?d=m:p==="dateCreated"?d="dateCreated":p==="dateModified"?d="dateModified":p==="completedDate"?d="completedDate":d=p}else c==="file.ctime"?d="dateCreated":c==="file.mtime"?d="dateModified":c==="file.name"?d="title":c.startsWith("formula.")&&(d=c);return d}))}(!a||a.length===0)&&(a=t.settings.defaultVisibleProperties||["due","scheduled","projects","contexts","tags"]);for(let l of e)try{let c=s(l,t,a,o);i.appendChild(c)}catch(c){console.warn("[TaskNotes][BasesPOC] Error creating task card:",c)}}var PS=v(()=>{});var YB={};nt(YB,{coerceForCompare:()=>cl,getBasesSortComparator:()=>IS});function s4(n){return String(n||"ASC").toUpperCase()==="DESC"?"DESC":"ASC"}function cl(n){if(n==null)return"";if(Array.isArray(n))return cl(n[0]);if(typeof n=="number")return n;if(typeof n=="boolean")return n?1:0;let e=String(n).trim(),t=Number(e);if(!Number.isNaN(t)&&e!=="")return t;let r=Date.parse(e);return Number.isNaN(r)?e.toLowerCase():r}function n4(n){var t,r;let e=new Map;if(!n)return e;for(let s of Object.keys(n)){e.set(s,s);let i=s.includes(".")?s.split(".").pop():s;e.set(i,s);let a=(r=(t=n[s])==null?void 0:t.getDisplayName)==null?void 0:r.call(t);typeof a=="string"&&a.trim()&&e.set(a.toLowerCase(),s)}return e}function IS(n,e){var t,r,s,i,a;try{let o=(t=n==null?void 0:n.controller)!=null?t:n,l=(r=n==null?void 0:n.query)!=null?r:o==null?void 0:o.query;if(!o)return null;let c=(i=(s=o==null?void 0:o.getViewConfig)==null?void 0:s.call(o))!=null?i:{},d;try{d=(a=l==null?void 0:l.getViewConfig)==null?void 0:a.call(l,"sort")}catch(y){}if(d==null&&(d=c==null?void 0:c.sort),!Array.isArray(d)||d.length===0)return null;let u=l==null?void 0:l.properties,h=n4(u),f=y=>{if(y)return h.get(y)||h.get(y.toLowerCase())||y},p=[];for(let y of d){if(!y)continue;let T=typeof y=="string"?y:y.property||y.id||y.key;if(!T)continue;let w=f(String(T));if(!w)continue;let b=s4(y==null?void 0:y.direction);p.push({id:w,direction:b})}if(p.length===0)return null;let m=(y,T)=>{if(T==="file.basename")return(y.split("/").pop()||"").replace(/\.md$/i,"");if(T==="file.path")return y;let w=e.get(y)||{};if(Object.prototype.hasOwnProperty.call(w,T))return w[T];let b=T.includes(".")?T.split(".").pop():T;if(Object.prototype.hasOwnProperty.call(w,b))return w[b]},g=(y,T)=>{for(let{id:w,direction:b}of p){let S,k;switch(w){case"title":S=y.title,k=T.title;break;case"due":S=y.due,k=T.due;break;case"scheduled":S=y.scheduled,k=T.scheduled;break;case"priority":S=y.priority,k=T.priority;break;case"file.basename":case"file.path":S=m(y.path,w),k=m(T.path,w);break;default:S=m(y.path,w),k=m(T.path,w)}let D=cl(S),M=cl(k),_=0;if(typeof D=="number"&&typeof M=="number"?_=D-M:typeof D=="string"&&typeof M=="string"?_=D.localeCompare(M):_=String(D).localeCompare(String(M)),_!==0)return b==="DESC"?-_:_}return 0};return g.__basesSortEntries=p,g}catch(o){return console.debug("[TaskNotes][Bases] getBasesSortComparator failed:",o),null}}var av=v(()=>{});function zB(n,e){return function(r){let s=null,i=r==null?void 0:r.viewContainerEl;if(!i)return console.error("[TaskNotes][BasesPOC] No viewContainerEl found"),{destroy:()=>{}};i.innerHTML="";let a=document.createElement("div");a.className="tn-bases-integration tasknotes-plugin tasknotes-container",i.appendChild(a),s=a;let o=document.createElement("div");o.className="tn-bases-items-container",o.style.cssText="margin-top: 12px;",a.appendChild(o);let l=()=>{var p;let h=[],f=r==null?void 0:r.results;if(f&&f instanceof Map)for(let[m,g]of f.entries()){let y={key:m,data:g,file:g==null?void 0:g.file,path:((p=g==null?void 0:g.file)==null?void 0:p.path)||(g==null?void 0:g.path),properties:(g==null?void 0:g.properties)||(g==null?void 0:g.frontmatter),basesData:g};h.push(y)}return h},c=async()=>{var h,f;if(s)try{let p=l(),m=(h=r==null?void 0:r.ctx)==null?void 0:h.formulas;if(m&&p.length>0)for(let y=0;y<p.length;y++){let T=p[y],w=(f=T.basesData)==null?void 0:f.formulaResults;if(w!=null&&w.cachedFormulaOutputs)for(let b of Object.keys(m)){let S=m[b];if(S&&typeof S.getValue=="function")try{let k=T.basesData,D=T.properties||{},M;if(k.frontmatter&&Object.keys(D).length>0){let _=k.frontmatter;k.frontmatter={..._,...D},M=S.getValue(k),k.frontmatter=_}else M=S.getValue(k);M!==void 0&&(w.cachedFormulaOutputs[b]=M)}catch(k){}}}let g=await iv(p,n);if(o.innerHTML="",g.length===0){let y=document.createElement("div");y.className="tn-bases-empty",y.style.cssText="padding: 20px; text-align: center; color: #666;",y.textContent="No TaskNotes tasks found for this Base.",o.appendChild(y)}else{let y=new Map(p.filter(b=>!!b.path).map(b=>[b.path||"",b.properties||b.frontmatter||{}])),{getBasesSortComparator:T}=await Promise.resolve().then(()=>(av(),YB)),w=T(r,y);w&&g.sort(w),await VB(o,g,n,r)}}catch(p){console.error(`[TaskNotes][BasesPOC] Error rendering Bases ${e.errorPrefix}:`,p);let m=document.createElement("div");m.className="tn-bases-error",m.style.cssText="padding: 20px; color: #d73a49; background: #ffeaea; border-radius: 4px; margin: 10px 0;",m.textContent=`Error loading ${e.errorPrefix} tasks: ${p.message||"Unknown error"}`,o.appendChild(m)}};c();let d=null;return{refresh:c,onResize:()=>{},onDataUpdated:()=>{c()},getEphemeralState:()=>({scrollTop:(s==null?void 0:s.scrollTop)||0}),setEphemeralState:h=>{h!=null&&h.scrollTop&&s&&(s.scrollTop=h.scrollTop)},destroy:()=>{var h;if(d&&((h=r==null?void 0:r.query)!=null&&h.off))try{r.query.off("change",d)}catch(f){}s&&(s.remove(),s=null),d=null},load:()=>{var f;if((f=r==null?void 0:r.query)!=null&&f.on&&!d){d=()=>void c();try{r.query.on("change",d)}catch(p){}}let h=r==null?void 0:r.controller;h!=null&&h.runQuery&&h.runQuery().then(()=>{c()}).catch(p=>{console.warn("[TaskNotes][Bases] Initial formula computation failed:",p)})},unload:()=>{var h;if(d&&((h=r==null?void 0:r.query)!=null&&h.off))try{r.query.off("change",d)}catch(f){}s&&(s.remove(),s=null),d=null}}}}var qB=v(()=>{PS()});function GB(n){return zB(n,{errorPrefix:"Task List"})}var QB=v(()=>{qB()});function RS(n){return n==null?!1:typeof n=="string"?n.trim().length>0:Array.isArray(n)?n.length>0:!0}function KB(n){if(!RS(n))return["none"];if(Array.isArray(n)){let e=[];for(let t of n)RS(t)&&e.push(String(t));return e.length?e:["none"]}return[String(n)]}function ZB(n,e){var t,r,s,i,a,o,l,c,d,u;try{let h=(t=n==null?void 0:n.controller)!=null?t:n,f=(r=n==null?void 0:n.query)!=null?r:h==null?void 0:h.query;if(!h)return null;let p=(i=(s=h==null?void 0:h.getViewConfig)==null?void 0:s.call(h))!=null?i:{},m;try{m=(a=f==null?void 0:f.getViewConfig)==null?void 0:a.call(f,"groupBy")}catch(D){}if(m==null&&(m=p==null?void 0:p.groupBy),!m)return null;let g=Array.isArray(m)?m[0]:m;if(!g||typeof g!="string")return null;let y=f==null?void 0:f.properties,T=new Map;if(y&&typeof y=="object")for(let D of Object.keys(y)){T.set(D,D);let M=D.includes(".")?D.split(".").pop():D;T.set(M,D);let _=(l=(o=y[D])==null?void 0:o.getDisplayName)==null?void 0:l.call(o);typeof _=="string"&&_.trim()&&T.set(_.toLowerCase(),D)}let b=(D=>{if(D)return T.get(D)||T.get(D.toLowerCase())||D})(g);if(!b)return null;let S=(u=(d=(c=y==null?void 0:y[b])==null?void 0:c.getDisplayName)==null?void 0:d.call(c))!=null?u:b;return{normalizedId:b,displayName:S,getGroupValues:D=>{let M=e.get(D)||{},_=M[b];if(RS(_))return KB(_);let W=b.includes(".")?b.split(".").pop():b;return KB(M[W])}}}catch(h){return console.debug("[TaskNotes][Bases] getBasesGroupByConfig failed:",h),null}}var JB=v(()=>{});function XB(n){if(!n)return(t,r)=>String(t).localeCompare(String(r));let e=n.direction;return(t,r)=>{let s=cl(t),i=cl(r),a=0;return typeof s=="number"&&typeof i=="number"?a=s-i:typeof s=="string"&&typeof i=="string"?a=s.localeCompare(i):a=String(s).localeCompare(String(i)),e==="DESC"?-a:a}}var eH=v(()=>{av()});function tH(n){return function(t){let r=null;if(!t||!t.viewContainerEl)return console.error("[TaskNotes][Bases] Invalid Bases container provided"),{destroy:()=>{},load:()=>{},unload:()=>{},refresh:()=>{},onDataUpdated:()=>{},onResize:()=>{},getEphemeralState:()=>({scrollTop:0}),setEphemeralState:()=>{}};let s=t.viewContainerEl;if(!s)return console.error("[TaskNotes][Bases] No viewContainerEl found"),{destroy:()=>{},load:()=>{},unload:()=>{},refresh:()=>{},onDataUpdated:()=>{},onResize:()=>{},getEphemeralState:()=>({scrollTop:0}),setEphemeralState:()=>{}};s.innerHTML="";let i=document.createElement("div");i.className="tn-bases-integration tasknotes-plugin kanban-view",s.appendChild(i),r=i;let a=document.createElement("div");a.className="kanban-view__board",i.appendChild(a);let o=()=>{var m,g;let f=[],p=t.results;if(p&&p instanceof Map)for(let[,y]of p.entries())f.push({key:((m=y==null?void 0:y.file)==null?void 0:m.path)||(y==null?void 0:y.path),data:y,file:y==null?void 0:y.file,path:((g=y==null?void 0:y.file)==null?void 0:g.path)||(y==null?void 0:y.path),properties:(y==null?void 0:y.properties)||(y==null?void 0:y.frontmatter)});return f},l=async()=>{if(r)try{let f=o(),p=await iv(f,n);if(a.innerHTML="",p.length===0){let k=document.createElement("div");k.className="tn-bases-empty",k.style.cssText="padding: 20px; text-align: center; color: var(--text-muted);",k.textContent="No TaskNotes tasks found for this Base.",a.appendChild(k);return}let m=new Map(f.filter(k=>!!k.path).map(k=>[k.path||"",k.properties||{}])),g=ZB(t,m),y=new Map;if(g)for(let k of p){let D=g.getGroupValues(k.path);for(let M of D)y.has(M)||y.set(M,[]),y.get(M).push(k)}else{for(let k of p){let D=k.status||"open";y.has(D)||y.set(D,[]),y.get(D).push(k)}n.statusManager.getAllStatuses().forEach(k=>{y.has(k.value)||y.set(k.value,[])})}let w=IS(t,m)?{id:(g==null?void 0:g.normalizedId)||"status",direction:"ASC"}:null,b=XB(w),S=Array.from(y.keys()).sort(b);for(let k of S){let D=y.get(k)||[],M=c(k,D,g);a.appendChild(M)}}catch(f){console.error("[TaskNotes][Bases] Error rendering Kanban:",f)}},c=(f,p,m)=>{let g=document.createElement("div");g.className="kanban-view__column",g.dataset.columnId=f;let y=g.createDiv({cls:"kanban-view__column-header"}),T;if(m){let S=m.normalizedId.toLowerCase();if(S==="status"||S==="note.status"){let k=n.statusManager.getStatusConfig(f);T=(k==null?void 0:k.label)||f}else if(S==="priority"||S==="note.priority"){let k=n.priorityManager.getPriorityConfig(f);T=(k==null?void 0:k.label)||f}else S==="projects"||S==="project"||S==="note.projects"||S==="note.project"?T=f==="none"?"No Project":f:S==="contexts"||S==="context"||S==="note.contexts"||S==="note.context"?T=f==="none"?"Uncategorized":`@${f}`:S.includes("tag")?T=f==="none"?"Untagged":`#${f}`:T=f==="none"?"None":f}else{let S=n.statusManager.getStatusConfig(f);T=(S==null?void 0:S.label)||f}y.createEl("div",{cls:"kanban-view__column-title",text:T}),y.createEl("div",{text:`${p.length} tasks`,cls:"kanban-view__column-count"});let b=g.createDiv({cls:"kanban-view__column-body"}).createDiv({cls:"kanban-view__tasks-container"});return p.forEach(S=>{let k=n.settings.defaultVisibleProperties,D=cr(S,n,k,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0});D.draggable=!0,D.addEventListener("dragstart",M=>{M.dataTransfer&&(M.dataTransfer.setData("text/plain",S.path),M.dataTransfer.effectAllowed="move")}),b.appendChild(D)}),d(g,async(S,k)=>{try{let D=await n.cacheManager.getCachedTaskInfo(S);if(D&&m){let M=m.normalizedId,_=M.toLowerCase(),W;if(k==="none"||k==="uncategorized"?W=null:W=k,_==="status"||_==="note.status")await n.updateTaskProperty(D,"status",W,{silent:!0});else if(_==="priority"||_==="note.priority")await n.updateTaskProperty(D,"priority",W,{silent:!0});else if(_==="projects"||_==="project"||_==="note.projects"||_==="note.project"){let j=W?Array.isArray(W)?W:[W]:[];await n.updateTaskProperty(D,"projects",j,{silent:!0})}else if(_==="contexts"||_==="context"||_==="note.contexts"||_==="note.context"){let j=W?Array.isArray(W)?W:[W]:[];await n.updateTaskProperty(D,"contexts",j,{silent:!0})}else try{let j=n.app.vault.getAbstractFileByPath(D.path);j&&"stat"in j&&await n.app.fileManager.processFrontMatter(j,R=>{let O=M.includes(".")?M.split(".").pop():M;R[O]=W})}catch(j){console.warn("[TaskNotes][Bases] Frontmatter update failed for custom property:",j)}await l()}else D&&!m&&(await n.updateTaskProperty(D,"status",k,{silent:!0}),await l())}catch(D){console.error("[TaskNotes][Bases] Move failed:",D)}}),g},d=(f,p)=>{f.addEventListener("dragover",m=>{m.preventDefault(),m.dataTransfer&&(m.dataTransfer.dropEffect="move"),f.classList.add("kanban-view__column--dragover")}),f.addEventListener("dragleave",m=>{f.contains(m.relatedTarget)||f.classList.remove("kanban-view__column--dragover")}),f.addEventListener("drop",async m=>{var w;m.preventDefault(),m.stopPropagation(),f.classList.remove("kanban-view__column--dragover");let y=(w=m.dataTransfer)==null?void 0:w.getData("text/plain"),T=f.getAttribute("data-column-id")||"";y&&T&&await p(y,T)})};l();let u=null;return{load:()=>{var p;if((p=t.query)!=null&&p.on&&!u){u=()=>void l();try{t.query.on("change",u)}catch(m){console.debug("[TaskNotes][Bases] Query listener registration failed:",m)}}let f=t.controller;f!=null&&f.runQuery?f.runQuery().then(()=>{l()}).catch(m=>{console.warn("[TaskNotes][Bases] Initial kanban formula computation failed:",m),l()}):l()},unload:()=>{var f;if(u&&((f=t.query)!=null&&f.off))try{t.query.off("change",u)}catch(p){console.debug("[TaskNotes][Bases] Query listener cleanup failed:",p)}u=null},refresh:l,onDataUpdated:()=>{l()},onResize:()=>{},getEphemeralState:()=>({scrollTop:(r==null?void 0:r.scrollTop)||0}),setEphemeralState:f=>{f!=null&&f.scrollTop&&r&&(r.scrollTop=f.scrollTop)},destroy:()=>{var f;if(u&&((f=t.query)!=null&&f.off))try{t.query.off("change",u)}catch(p){}r&&(r.remove(),r=null),u=null}}}}var rH=v(()=>{PS();JB();eH();av();Sn()});var ov={};nt(ov,{registerBasesTaskList:()=>i4,unregisterBasesViews:()=>a4});async function i4(n){if(!n.settings.enableBases||!(0,sH.requireApiVersion)("1.9.12"))return;let e=async()=>{var t,r;try{let s=(r=(t=n.app.internalPlugins).getEnabledPluginById)==null?void 0:r.call(t,"bases");return s!=null&&s.registrations?(s.registrations.tasknotesTaskList||(s.registrations.tasknotesTaskList={name:"TaskNotes Task List",icon:"tasknotes-simple",factory:GB(n)},console.log("[TaskNotes][Bases] Successfully registered tasknotesTaskList view")),s.registrations.tasknotesKanban||(s.registrations.tasknotesKanban={name:"TaskNotes Kanban",icon:"tasknotes-simple",factory:tH(n)},console.log("[TaskNotes][Bases] Successfully registered tasknotesKanban view")),n.app.workspace.iterateAllLeaves(i=>{var a,o;if(((o=(a=i.view)==null?void 0:a.getViewType)==null?void 0:o.call(a))==="bases"){let l=i.view;if(typeof l.refresh=="function")try{l.refresh()}catch(c){console.debug("[TaskNotes][Bases] Error refreshing view:",c)}}}),!0):(console.debug("[TaskNotes][Bases] Bases plugin not available for registration"),!1)}catch(s){return console.warn("[TaskNotes][Bases] Registration attempt failed:",s),!1}};if(await e()){console.log("[TaskNotes][Bases] Successfully registered views");return}for(let t=0;t<5;t++)if(await new Promise(r=>setTimeout(r,200)),await e()){console.log("[TaskNotes][Bases] Successfully registered views on retry");return}console.warn("[TaskNotes][Bases] Failed to register views after multiple attempts")}function a4(n){var e,t;try{let r=(t=(e=n.app.internalPlugins).getEnabledPluginById)==null?void 0:t.call(e,"bases");if(!(r!=null&&r.registrations)){console.log("[TaskNotes][Bases] Bases plugin not available for unregistration");return}r.registrations.tasknotesTaskList&&(delete r.registrations.tasknotesTaskList,console.log("[TaskNotes][Bases] Successfully unregistered tasknotesTaskList view")),r.registrations.tasknotesKanban&&(delete r.registrations.tasknotesKanban,console.log("[TaskNotes][Bases] Successfully unregistered tasknotesKanban view"))}catch(r){console.error("[TaskNotes][Bases] Error during view unregistration:",r)}}var sH,lv=v(()=>{sH=require("obsidian");QB();rH()});var iH=hp(()=>{var nH;(function(n){(function(e){var t=typeof globalThis=="object"?globalThis:typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:o(),r=s(n);typeof t.Reflect!="undefined"&&(r=s(t.Reflect,r)),e(r,t),typeof t.Reflect=="undefined"&&(t.Reflect=n);function s(l,c){return function(d,u){Object.defineProperty(l,d,{configurable:!0,writable:!0,value:u}),c&&c(d,u)}}function i(){try{return Function("return this;")()}catch(l){}}function a(){try{return(0,eval)("(function() { return this; })()")}catch(l){}}function o(){return i()||a()}})(function(e,t){var r=Object.prototype.hasOwnProperty,s=typeof Symbol=="function",i=s&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",a=s&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",o=typeof Object.create=="function",l={__proto__:[]}instanceof Array,c=!o&&!l,d={create:o?function(){return pv(Object.create(null))}:l?function(){return pv({__proto__:null})}:function(){return pv({})},has:c?function(A,F){return r.call(A,F)}:function(A,F){return F in A},get:c?function(A,F){return r.call(A,F)?A[F]:void 0}:function(A,F){return A[F]}},u=Object.getPrototypeOf(Function),h=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:LH(),f=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:FH(),p=typeof WeakMap=="function"?WeakMap:BH(),m=s?Symbol.for("@reflect-metadata:registry"):void 0,g=RH(),y=NH(g);function T(A,F,$,Q){if(q($)){if(!_n(A))throw new TypeError;if(!ed(F))throw new TypeError;return R(A,F)}else{if(!_n(A))throw new TypeError;if(!Ne(F))throw new TypeError;if(!Ne(Q)&&!q(Q)&&!we(Q))throw new TypeError;return we(Q)&&(Q=void 0),$=Ut($),O(A,F,$,Q)}}e("decorate",T);function w(A,F){function $(Q,pe){if(!Ne(Q))throw new TypeError;if(!q(pe)&&!Ki(pe))throw new TypeError;Y(A,F,Q,pe)}return $}e("metadata",w);function b(A,F,$,Q){if(!Ne($))throw new TypeError;return q(Q)||(Q=Ut(Q)),Y(A,F,$,Q)}e("defineMetadata",b);function S(A,F,$){if(!Ne(F))throw new TypeError;return q($)||($=Ut($)),C(A,F,$)}e("hasMetadata",S);function k(A,F,$){if(!Ne(F))throw new TypeError;return q($)||($=Ut($)),P(A,F,$)}e("hasOwnMetadata",k);function D(A,F,$){if(!Ne(F))throw new TypeError;return q($)||($=Ut($)),U(A,F,$)}e("getMetadata",D);function M(A,F,$){if(!Ne(F))throw new TypeError;return q($)||($=Ut($)),H(A,F,$)}e("getOwnMetadata",M);function _(A,F){if(!Ne(A))throw new TypeError;return q(F)||(F=Ut(F)),z(A,F)}e("getMetadataKeys",_);function W(A,F){if(!Ne(A))throw new TypeError;return q(F)||(F=Ut(F)),ne(A,F)}e("getOwnMetadataKeys",W);function j(A,F,$){if(!Ne(F))throw new TypeError;if(q($)||($=Ut($)),!Ne(F))throw new TypeError;q($)||($=Ut($));var Q=td(F,$,!1);return q(Q)?!1:Q.OrdinaryDeleteMetadata(A,F,$)}e("deleteMetadata",j);function R(A,F){for(var $=A.length-1;$>=0;--$){var Q=A[$],pe=Q(F);if(!q(pe)&&!we(pe)){if(!ed(pe))throw new TypeError;F=pe}}return F}function O(A,F,$,Q){for(var pe=A.length-1;pe>=0;--pe){var It=A[pe],Gt=It(F,$,Q);if(!q(Gt)&&!we(Gt)){if(!Ne(Gt))throw new TypeError;Q=Gt}}return Q}function C(A,F,$){var Q=P(A,F,$);if(Q)return!0;var pe=fv(F);return we(pe)?!1:C(A,pe,$)}function P(A,F,$){var Q=td(F,$,!1);return q(Q)?!1:ae(Q.OrdinaryHasOwnMetadata(A,F,$))}function U(A,F,$){var Q=P(A,F,$);if(Q)return H(A,F,$);var pe=fv(F);if(!we(pe))return U(A,pe,$)}function H(A,F,$){var Q=td(F,$,!1);if(!q(Q))return Q.OrdinaryGetOwnMetadata(A,F,$)}function Y(A,F,$,Q){var pe=td($,Q,!0);pe.OrdinaryDefineOwnMetadata(A,F,$,Q)}function z(A,F){var $=ne(A,F),Q=fv(A);if(Q===null)return $;var pe=z(Q,F);if(pe.length<=0)return $;if($.length<=0)return pe;for(var It=new f,Gt=[],Ie=0,J=$;Ie<J.length;Ie++){var re=J[Ie],ie=It.has(re);ie||(It.add(re),Gt.push(re))}for(var ce=0,Oe=pe;ce<Oe.length;ce++){var re=Oe[ce],ie=It.has(re);ie||(It.add(re),Gt.push(re))}return Gt}function ne(A,F){var $=td(A,F,!1);return $?$.OrdinaryOwnMetadataKeys(A,F):[]}function le(A){if(A===null)return 1;switch(typeof A){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return A===null?1:6;default:return 6}}function q(A){return A===void 0}function we(A){return A===null}function ct(A){return typeof A=="symbol"}function Ne(A){return typeof A=="object"?A!==null:typeof A=="function"}function Mn(A,F){switch(le(A)){case 0:return A;case 1:return A;case 2:return A;case 3:return A;case 4:return A;case 5:return A}var $=F===3?"string":F===5?"number":"default",Q=up(A,i);if(Q!==void 0){var pe=Q.call(A,$);if(Ne(pe))throw new TypeError;return pe}return X(A,$==="default"?"number":$)}function X(A,F){if(F==="string"){var $=A.toString;if(on($)){var Q=$.call(A);if(!Ne(Q))return Q}var pe=A.valueOf;if(on(pe)){var Q=pe.call(A);if(!Ne(Q))return Q}}else{var pe=A.valueOf;if(on(pe)){var Q=pe.call(A);if(!Ne(Q))return Q}var It=A.toString;if(on(It)){var Q=It.call(A);if(!Ne(Q))return Q}}throw new TypeError}function ae(A){return!!A}function pt(A){return""+A}function Ut(A){var F=Mn(A,3);return ct(F)?F:pt(F)}function _n(A){return Array.isArray?Array.isArray(A):A instanceof Object?A instanceof Array:Object.prototype.toString.call(A)==="[object Array]"}function on(A){return typeof A=="function"}function ed(A){return typeof A=="function"}function Ki(A){switch(le(A)){case 3:return!0;case 4:return!0;default:return!1}}function Va(A,F){return A===F||A!==A&&F!==F}function up(A,F){var $=A[F];if($!=null){if(!on($))throw new TypeError;return $}}function YS(A){var F=up(A,a);if(!on(F))throw new TypeError;var $=F.call(A);if(!Ne($))throw new TypeError;return $}function zS(A){return A.value}function qS(A){var F=A.next();return F.done?!1:F}function GS(A){var F=A.return;F&&F.call(A)}function fv(A){var F=Object.getPrototypeOf(A);if(typeof A!="function"||A===u||F!==u)return F;var $=A.prototype,Q=$&&Object.getPrototypeOf($);if(Q==null||Q===Object.prototype)return F;var pe=Q.constructor;return typeof pe!="function"||pe===A?F:pe}function IH(){var A;!q(m)&&typeof t.Reflect!="undefined"&&!(m in t.Reflect)&&typeof t.Reflect.defineMetadata=="function"&&(A=OH(t.Reflect));var F,$,Q,pe=new p,It={registerProvider:Gt,getProvider:J,setProvider:ie};return It;function Gt(ce){if(!Object.isExtensible(It))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case A===ce:break;case q(F):F=ce;break;case F===ce:break;case q($):$=ce;break;case $===ce:break;default:Q===void 0&&(Q=new f),Q.add(ce);break}}function Ie(ce,Oe){if(!q(F)){if(F.isProviderFor(ce,Oe))return F;if(!q($)){if($.isProviderFor(ce,Oe))return F;if(!q(Q))for(var mt=YS(Q);;){var Rt=qS(mt);if(!Rt)return;var ln=zS(Rt);if(ln.isProviderFor(ce,Oe))return GS(mt),ln}}}if(!q(A)&&A.isProviderFor(ce,Oe))return A}function J(ce,Oe){var mt=pe.get(ce),Rt;return q(mt)||(Rt=mt.get(Oe)),q(Rt)&&(Rt=Ie(ce,Oe),q(Rt)||(q(mt)&&(mt=new h,pe.set(ce,mt)),mt.set(Oe,Rt))),Rt}function re(ce){if(q(ce))throw new TypeError;return F===ce||$===ce||!q(Q)&&Q.has(ce)}function ie(ce,Oe,mt){if(!re(mt))throw new Error("Metadata provider not registered.");var Rt=J(ce,Oe);if(Rt!==mt){if(!q(Rt))return!1;var ln=pe.get(ce);q(ln)&&(ln=new h,pe.set(ce,ln)),ln.set(Oe,mt)}return!0}}function RH(){var A;return!q(m)&&Ne(t.Reflect)&&Object.isExtensible(t.Reflect)&&(A=t.Reflect[m]),q(A)&&(A=IH()),!q(m)&&Ne(t.Reflect)&&Object.isExtensible(t.Reflect)&&Object.defineProperty(t.Reflect,m,{enumerable:!1,configurable:!1,writable:!1,value:A}),A}function NH(A){var F=new p,$={isProviderFor:function(re,ie){var ce=F.get(re);return q(ce)?!1:ce.has(ie)},OrdinaryDefineOwnMetadata:Gt,OrdinaryHasOwnMetadata:pe,OrdinaryGetOwnMetadata:It,OrdinaryOwnMetadataKeys:Ie,OrdinaryDeleteMetadata:J};return g.registerProvider($),$;function Q(re,ie,ce){var Oe=F.get(re),mt=!1;if(q(Oe)){if(!ce)return;Oe=new h,F.set(re,Oe),mt=!0}var Rt=Oe.get(ie);if(q(Rt)){if(!ce)return;if(Rt=new h,Oe.set(ie,Rt),!A.setProvider(re,ie,$))throw Oe.delete(ie),mt&&F.delete(re),new Error("Wrong provider for target.")}return Rt}function pe(re,ie,ce){var Oe=Q(ie,ce,!1);return q(Oe)?!1:ae(Oe.has(re))}function It(re,ie,ce){var Oe=Q(ie,ce,!1);if(!q(Oe))return Oe.get(re)}function Gt(re,ie,ce,Oe){var mt=Q(ce,Oe,!0);mt.set(re,ie)}function Ie(re,ie){var ce=[],Oe=Q(re,ie,!1);if(q(Oe))return ce;for(var mt=Oe.keys(),Rt=YS(mt),ln=0;;){var QS=qS(Rt);if(!QS)return ce.length=ln,ce;var HH=zS(QS);try{ce[ln]=HH}catch(UH){try{GS(Rt)}finally{throw UH}}ln++}}function J(re,ie,ce){var Oe=Q(ie,ce,!1);if(q(Oe)||!Oe.delete(re))return!1;if(Oe.size===0){var mt=F.get(ie);q(mt)||(mt.delete(ce),mt.size===0&&F.delete(mt))}return!0}}function OH(A){var F=A.defineMetadata,$=A.hasOwnMetadata,Q=A.getOwnMetadata,pe=A.getOwnMetadataKeys,It=A.deleteMetadata,Gt=new p,Ie={isProviderFor:function(J,re){var ie=Gt.get(J);return!q(ie)&&ie.has(re)?!0:pe(J,re).length?(q(ie)&&(ie=new f,Gt.set(J,ie)),ie.add(re),!0):!1},OrdinaryDefineOwnMetadata:F,OrdinaryHasOwnMetadata:$,OrdinaryGetOwnMetadata:Q,OrdinaryOwnMetadataKeys:pe,OrdinaryDeleteMetadata:It};return Ie}function td(A,F,$){var Q=g.getProvider(A,F);if(!q(Q))return Q;if($){if(g.setProvider(A,F,y))return y;throw new Error("Illegal state.")}}function LH(){var A={},F=[],$=(function(){function Ie(J,re,ie){this._index=0,this._keys=J,this._values=re,this._selector=ie}return Ie.prototype["@@iterator"]=function(){return this},Ie.prototype[a]=function(){return this},Ie.prototype.next=function(){var J=this._index;if(J>=0&&J<this._keys.length){var re=this._selector(this._keys[J],this._values[J]);return J+1>=this._keys.length?(this._index=-1,this._keys=F,this._values=F):this._index++,{value:re,done:!1}}return{value:void 0,done:!0}},Ie.prototype.throw=function(J){throw this._index>=0&&(this._index=-1,this._keys=F,this._values=F),J},Ie.prototype.return=function(J){return this._index>=0&&(this._index=-1,this._keys=F,this._values=F),{value:J,done:!0}},Ie})(),Q=(function(){function Ie(){this._keys=[],this._values=[],this._cacheKey=A,this._cacheIndex=-2}return Object.defineProperty(Ie.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Ie.prototype.has=function(J){return this._find(J,!1)>=0},Ie.prototype.get=function(J){var re=this._find(J,!1);return re>=0?this._values[re]:void 0},Ie.prototype.set=function(J,re){var ie=this._find(J,!0);return this._values[ie]=re,this},Ie.prototype.delete=function(J){var re=this._find(J,!1);if(re>=0){for(var ie=this._keys.length,ce=re+1;ce<ie;ce++)this._keys[ce-1]=this._keys[ce],this._values[ce-1]=this._values[ce];return this._keys.length--,this._values.length--,Va(J,this._cacheKey)&&(this._cacheKey=A,this._cacheIndex=-2),!0}return!1},Ie.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=A,this._cacheIndex=-2},Ie.prototype.keys=function(){return new $(this._keys,this._values,pe)},Ie.prototype.values=function(){return new $(this._keys,this._values,It)},Ie.prototype.entries=function(){return new $(this._keys,this._values,Gt)},Ie.prototype["@@iterator"]=function(){return this.entries()},Ie.prototype[a]=function(){return this.entries()},Ie.prototype._find=function(J,re){if(!Va(this._cacheKey,J)){this._cacheIndex=-1;for(var ie=0;ie<this._keys.length;ie++)if(Va(this._keys[ie],J)){this._cacheIndex=ie;break}}return this._cacheIndex<0&&re&&(this._cacheIndex=this._keys.length,this._keys.push(J),this._values.push(void 0)),this._cacheIndex},Ie})();return Q;function pe(Ie,J){return Ie}function It(Ie,J){return J}function Gt(Ie,J){return[Ie,J]}}function FH(){var A=(function(){function F(){this._map=new h}return Object.defineProperty(F.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),F.prototype.has=function($){return this._map.has($)},F.prototype.add=function($){return this._map.set($,$),this},F.prototype.delete=function($){return this._map.delete($)},F.prototype.clear=function(){this._map.clear()},F.prototype.keys=function(){return this._map.keys()},F.prototype.values=function(){return this._map.keys()},F.prototype.entries=function(){return this._map.entries()},F.prototype["@@iterator"]=function(){return this.keys()},F.prototype[a]=function(){return this.keys()},F})();return A}function BH(){var A=16,F=d.create(),$=Q();return(function(){function J(){this._key=Q()}return J.prototype.has=function(re){var ie=pe(re,!1);return ie!==void 0?d.has(ie,this._key):!1},J.prototype.get=function(re){var ie=pe(re,!1);return ie!==void 0?d.get(ie,this._key):void 0},J.prototype.set=function(re,ie){var ce=pe(re,!0);return ce[this._key]=ie,this},J.prototype.delete=function(re){var ie=pe(re,!1);return ie!==void 0?delete ie[this._key]:!1},J.prototype.clear=function(){this._key=Q()},J})();function Q(){var J;do J="@@WeakMap@@"+Ie();while(d.has(F,J));return F[J]=!0,J}function pe(J,re){if(!r.call(J,$)){if(!re)return;Object.defineProperty(J,$,{value:d.create()})}return J[$]}function It(J,re){for(var ie=0;ie<re;++ie)J[ie]=Math.random()*255|0;return J}function Gt(J){if(typeof Uint8Array=="function"){var re=new Uint8Array(J);return typeof crypto!="undefined"?crypto.getRandomValues(re):typeof msCrypto!="undefined"?msCrypto.getRandomValues(re):It(re,J),re}return It(new Array(J),J)}function Ie(){var J=Gt(A);J[6]=J[6]&79|64,J[8]=J[8]&191|128;for(var re="",ie=0;ie<A;++ie){var ce=J[ie];(ie===4||ie===6||ie===8)&&(re+="-"),ce<16&&(re+="0"),re+=ce.toString(16).toLowerCase()}return re}}function pv(A){return A.__=void 0,delete A.__,A}})})(nH||(nH={}))});var oH={};nt(oH,{Delete:()=>ap,Get:()=>Bt,OpenAPI:()=>o4,OpenAPIController:()=>OS,Post:()=>Ht,Put:()=>LS,Route:()=>ip,generateOpenAPISpec:()=>FS,getOpenAPIOperation:()=>u4,getRouteInfo:()=>d4,getRoutes:()=>cv,hasOpenAPIEndpoints:()=>h4});function OS(n){return Reflect.hasMetadata(Zc,n)||Reflect.defineMetadata(Zc,[],n),n}function ip(n,e){return function(t,r,s){Reflect.defineMetadata(NS,{method:n.toLowerCase(),path:e,handler:r},t,r);let i=Reflect.getMetadata("routes",t.constructor)||[];i.push({method:n.toLowerCase(),path:e,handler:r}),Reflect.defineMetadata("routes",i,t.constructor)}}function Bt(n){return ip("GET",n)}function Ht(n){return ip("POST",n)}function LS(n){return ip("PUT",n)}function ap(n){return ip("DELETE",n)}function o4(n){return function(e,t,r){Reflect.defineMetadata(aH,n,e,t);let s=Reflect.getMetadata(Zc,e.constructor)||[],i=Reflect.getMetadata(NS,e,t),{path:a,method:o}=i||l4(t);s.push({path:a,method:o,operation:n}),Reflect.defineMetadata(Zc,s,e.constructor)}}function l4(n){return console.warn(`extractPathAndMethod is deprecated. Use @Route decorators on method: ${n}`),{path:"/api/unknown",method:"get"}}function FS(n){let e=Reflect.getMetadata(Zc,n.constructor)||[],t=cv(n.constructor)||[],r={openapi:"3.0.0",info:{title:"TaskNotes API",version:"1.0.0",description:"RESTful API for managing tasks, time tracking, and automation in TaskNotes",contact:{name:"TaskNotes",url:"https://github.com/your-repo/tasknotes"}},servers:[{url:"http://localhost:8080",description:"Local development server"}],security:[{bearerAuth:[]}],paths:{},components:{securitySchemes:{bearerAuth:{type:"http",scheme:"bearer",bearerFormat:"JWT",description:"Optional bearer token for API authentication"}},schemas:c4()}};for(let s of e)r.paths[s.path]||(r.paths[s.path]={}),r.paths[s.path][s.method.toLowerCase()]=s.operation;for(let s of t)r.paths[s.path]||(r.paths[s.path]={}),r.paths[s.path][s.method.toLowerCase()]||(r.paths[s.path][s.method.toLowerCase()]={summary:`${s.method.toUpperCase()} ${s.path}`,description:`${s.method.toUpperCase()} endpoint for ${s.path}`,responses:{200:{description:"Success",content:{"application/json":{schema:{$ref:"#/components/schemas/APIResponse"}}}},400:{description:"Bad Request",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}},500:{description:"Internal Server Error",content:{"application/json":{schema:{$ref:"#/components/schemas/Error"}}}}}});return r}function c4(){return{APIResponse:{type:"object",properties:{success:{type:"boolean",description:"Whether the request was successful"},data:{description:"Response data (varies by endpoint)"},error:{type:"string",description:"Error message (present when success is false)"},message:{type:"string",description:"Optional success message"}},required:["success"]},Task:{type:"object",properties:{id:{type:"string",description:"Unique task identifier (file path)"},title:{type:"string",description:"Task title",maxLength:200},status:{type:"string",description:"Current task status",enum:["todo","open","completed","in-progress","cancelled"]},priority:{type:"string",description:"Task priority level",enum:["low","normal","medium","high","urgent"]},due:{type:"string",format:"date-time",description:"Due date and time (ISO 8601 format)",nullable:!0},scheduled:{type:"string",format:"date-time",description:"Scheduled date and time (ISO 8601 format)",nullable:!0},path:{type:"string",description:"File path of the task"},archived:{type:"boolean",description:"Whether the task is archived"},tags:{type:"array",items:{type:"string"},description:"Task tags"},contexts:{type:"array",items:{type:"string"},description:"Task contexts (GTD-style)"},projects:{type:"array",items:{type:"string"},description:"Associated projects"},timeEstimate:{type:"integer",minimum:0,description:"Estimated time in minutes",nullable:!0},details:{type:"string",description:"Additional task details/description",nullable:!0},dateCreated:{type:"string",format:"date-time",description:"Task creation timestamp"},dateModified:{type:"string",format:"date-time",description:"Last modification timestamp"}},required:["id","title","status","path"]},TaskCreationData:{type:"object",properties:{title:{type:"string",description:"Task title",maxLength:200},status:{type:"string",description:"Initial task status",enum:["todo","open","in-progress"]},priority:{type:"string",description:"Task priority level",enum:["low","normal","medium","high","urgent"]},due:{type:"string",format:"date-time",description:"Due date and time (ISO 8601 format)"},scheduled:{type:"string",format:"date-time",description:"Scheduled date and time (ISO 8601 format)"},tags:{type:"array",items:{type:"string"},description:"Task tags"},contexts:{type:"array",items:{type:"string"},description:"Task contexts"},projects:{type:"array",items:{type:"string"},description:"Associated projects"},details:{type:"string",description:"Task details/description"},timeEstimate:{type:"integer",minimum:0,description:"Estimated time in minutes"}},required:["title"]},TaskStats:{type:"object",properties:{total:{type:"integer",description:"Total number of tasks"},completed:{type:"integer",description:"Number of completed tasks"},active:{type:"integer",description:"Number of active (non-completed, non-archived) tasks"},overdue:{type:"integer",description:"Number of overdue tasks"},archived:{type:"integer",description:"Number of archived tasks"},withTimeTracking:{type:"integer",description:"Number of tasks with time tracking entries"}},required:["total","completed","active","overdue","archived","withTimeTracking"]},WebhookConfig:{type:"object",properties:{id:{type:"string",description:"Unique webhook identifier"},url:{type:"string",format:"uri",description:"Webhook endpoint URL"},events:{type:"array",items:{type:"string",enum:["task.created","task.updated","task.deleted","task.completed","task.archived","task.unarchived","time.started","time.stopped","pomodoro.started","pomodoro.completed","pomodoro.interrupted","recurring.instance.completed","reminder.triggered"]},description:"Events to subscribe to",minItems:1},active:{type:"boolean",description:"Whether the webhook is active"},transformFile:{type:"string",description:"Optional transform file path for payload customization"},corsHeaders:{type:"boolean",description:"Whether to include custom headers (disable for strict CORS services)"}},required:["url","events"]},PomodoroSession:{type:"object",properties:{id:{type:"string",description:"Unique session identifier"},type:{type:"string",enum:["work","short-break","long-break"],description:"Type of pomodoro session"},duration:{type:"integer",description:"Session duration in seconds"},startTime:{type:"string",format:"date-time",description:"Session start timestamp"},endTime:{type:"string",format:"date-time",description:"Session end timestamp",nullable:!0},task:{$ref:"#/components/schemas/Task",nullable:!0,description:"Associated task (if any)"}},required:["id","type","duration","startTime"]},PomodoroState:{type:"object",properties:{isRunning:{type:"boolean",description:"Whether a pomodoro session is currently running"},timeRemaining:{type:"integer",description:"Time remaining in current session (seconds)"},currentSession:{$ref:"#/components/schemas/PomodoroSession",nullable:!0,description:"Current active session (if any)"},nextSessionType:{type:"string",enum:["work","short-break","long-break"],nullable:!0,description:"Suggested next session type"},totalPomodoros:{type:"integer",description:"Total completed pomodoros (all time)"},currentStreak:{type:"integer",description:"Current consecutive pomodoro streak"},totalMinutesToday:{type:"integer",description:"Total focused minutes today"}},required:["isRunning","timeRemaining"]},PomodoroSessionHistory:{type:"object",properties:{id:{type:"string",description:"Session identifier"},type:{type:"string",enum:["work","short-break","long-break"]},startTime:{type:"string",format:"date-time"},endTime:{type:"string",format:"date-time"},duration:{type:"integer",description:"Actual session duration in seconds"},completed:{type:"boolean",description:"Whether the session was completed (not interrupted)"},taskPath:{type:"string",nullable:!0,description:"Associated task file path"},taskTitle:{type:"string",nullable:!0,description:"Associated task title"}},required:["id","type","startTime","endTime","duration","completed"]},PomodoroStats:{type:"object",properties:{totalSessions:{type:"integer",description:"Total number of sessions"},completedSessions:{type:"integer",description:"Number of completed sessions"},interruptedSessions:{type:"integer",description:"Number of interrupted sessions"},totalFocusTime:{type:"integer",description:"Total focused time in minutes"},workSessions:{type:"integer",description:"Number of work sessions"},breakSessions:{type:"integer",description:"Number of break sessions"},longestStreak:{type:"integer",description:"Longest consecutive completed sessions"},averageSessionLength:{type:"number",description:"Average session length in minutes"}},required:["totalSessions","completedSessions","interruptedSessions","totalFocusTime"]},TimeEntry:{type:"object",properties:{startTime:{type:"string",format:"date-time",description:"ISO timestamp when time tracking started"},endTime:{type:"string",format:"date-time",nullable:!0,description:"ISO timestamp when time tracking ended (null if still running)"},description:{type:"string",nullable:!0,description:"Optional description of work being tracked"},duration:{type:"integer",minimum:0,description:"Duration in minutes (calculated or manually set)"},isActive:{type:"boolean",description:"Whether this time entry is currently active"}},required:["startTime","duration","isActive"]},ActiveTimeSession:{type:"object",properties:{task:{type:"object",properties:{id:{type:"string",description:"Task identifier (file path)"},title:{type:"string",description:"Task title"},status:{type:"string",description:"Task status"},priority:{type:"string",description:"Task priority"},tags:{type:"array",items:{type:"string"},description:"Task tags"},projects:{type:"array",items:{type:"string"},description:"Associated projects"}},required:["id","title","status"]},session:{type:"object",properties:{startTime:{type:"string",format:"date-time",description:"When the session started"},description:{type:"string",nullable:!0,description:"Session description"},elapsedMinutes:{type:"integer",minimum:0,description:"Minutes elapsed since session started"}},required:["startTime","elapsedMinutes"]},elapsedMinutes:{type:"integer",minimum:0,description:"Total elapsed minutes for this session"}},required:["task","session","elapsedMinutes"]},TimeSummary:{type:"object",properties:{period:{type:"string",enum:["today","week","month","all","custom"],description:"Time period for the summary"},dateRange:{type:"object",properties:{from:{type:"string",format:"date-time",description:"Start date of the summary period"},to:{type:"string",format:"date-time",description:"End date of the summary period"}},required:["from","to"]},summary:{type:"object",properties:{totalMinutes:{type:"integer",minimum:0,description:"Total tracked time in minutes"},totalHours:{type:"number",minimum:0,description:"Total tracked time in hours (rounded to 2 decimals)"},tasksWithTime:{type:"integer",minimum:0,description:"Number of tasks with time tracking data"},activeTasks:{type:"integer",minimum:0,description:"Number of tasks with active time tracking"},completedTasks:{type:"integer",minimum:0,description:"Number of completed tasks with time tracking"}},required:["totalMinutes","totalHours","tasksWithTime","activeTasks","completedTasks"]},topTasks:{type:"array",items:{type:"object",properties:{task:{type:"string",description:"Task identifier"},title:{type:"string",description:"Task title"},minutes:{type:"integer",minimum:0,description:"Total minutes tracked for this task"}},required:["task","title","minutes"]},description:"Top 10 tasks by time tracked"},topProjects:{type:"array",items:{type:"object",properties:{project:{type:"string",description:"Project name"},minutes:{type:"integer",minimum:0,description:"Total minutes tracked for this project"}},required:["project","minutes"]},description:"Top 10 projects by time tracked"},topTags:{type:"array",items:{type:"object",properties:{tag:{type:"string",description:"Tag name"},minutes:{type:"integer",minimum:0,description:"Total minutes tracked for this tag"}},required:["tag","minutes"]},description:"Top 10 tags by time tracked"}},required:["period","dateRange","summary","topTasks","topProjects","topTags"]},TaskTimeData:{type:"object",properties:{task:{type:"object",properties:{id:{type:"string",description:"Task identifier (file path)"},title:{type:"string",description:"Task title"},status:{type:"string",description:"Task status"},priority:{type:"string",description:"Task priority"}},required:["id","title","status"]},summary:{type:"object",properties:{totalMinutes:{type:"integer",minimum:0,description:"Total time tracked for this task in minutes"},totalHours:{type:"number",minimum:0,description:"Total time tracked for this task in hours"},totalSessions:{type:"integer",minimum:0,description:"Total number of time tracking sessions"},completedSessions:{type:"integer",minimum:0,description:"Number of completed sessions"},activeSessions:{type:"integer",minimum:0,maximum:1,description:"Number of active sessions (0 or 1)"},averageSessionMinutes:{type:"number",minimum:0,description:"Average session length in minutes"}},required:["totalMinutes","totalHours","totalSessions","completedSessions","activeSessions","averageSessionMinutes"]},activeSession:{type:"object",nullable:!0,properties:{startTime:{type:"string",format:"date-time",description:"When the active session started"},description:{type:"string",nullable:!0,description:"Description of the active session"},elapsedMinutes:{type:"integer",minimum:0,description:"Minutes elapsed since session started"}},required:["startTime","elapsedMinutes"]},timeEntries:{type:"array",items:{$ref:"#/components/schemas/TimeEntry"},description:"All time entries for this task"}},required:["task","summary","timeEntries"]},Error:{type:"object",properties:{success:{type:"boolean",enum:[!1]},error:{type:"string",description:"Error message describing what went wrong"}},required:["success","error"]}}}function d4(n,e){return Reflect.getMetadata(NS,n,e)}function cv(n){return Reflect.getMetadata("routes",n)||[]}function u4(n,e){return Reflect.getMetadata(aH,n,e)}function h4(n){return(Reflect.getMetadata(Zc,n)||[]).length>0}var y0e,aH,Zc,NS,Gi=v(()=>{y0e=ke(iH()),aH=Symbol("openapi:operation"),Zc=Symbol("openapi:endpoints"),NS=Symbol("route")});var lH,dv,cH=v(()=>{lH=require("url");Gi();dv=class{constructor(){this.routes=[]}compilePattern(e){let t=[],r=e.replace(/:([a-zA-Z_][a-zA-Z0-9_]*)/g,(i,a)=>(t.push(a),"([^/]+)"));return{regex:new RegExp(`^${r}$`),paramNames:t}}register(e,t,r){let{regex:s,paramNames:i}=this.compilePattern(t);this.routes.push({method:e,pattern:t,handler:r,regex:s,paramNames:i})}get(e,t){this.register("GET",e,t)}post(e,t){this.register("POST",e,t)}put(e,t){this.register("PUT",e,t)}delete(e,t){this.register("DELETE",e,t)}options(e,t){this.register("OPTIONS",e,t)}async route(e,t){let s=(0,lH.parse)(e.url||"",!0).pathname||"",i=e.method;for(let a of this.routes)if(a.method===i){let o=s.match(a.regex);if(o){let l={};for(let c=0;c<a.paramNames.length;c++){let d=a.paramNames[c],u=o[c+1];u&&(l[d]=decodeURIComponent(u))}return await a.handler(e,t,l),!0}}return!1}registerController(e){let t=cv(e.constructor);for(let r of t){let s=e[r.handler];typeof s=="function"&&this.register(r.method.toUpperCase(),r.path,s.bind(e))}}getRoutes(){return this.routes}}});var nn,Jc=v(()=>{nn=class{sendResponse(e,t,r){e.statusCode=t,e.setHeader("Content-Type","application/json"),e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),e.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),e.end(JSON.stringify(r))}successResponse(e,t){return{success:!0,data:e,message:t}}errorResponse(e){return{success:!1,error:e}}async parseRequestBody(e){return new Promise((t,r)=>{let s="";e.on("data",i=>{s+=i.toString()}),e.on("end",()=>{try{t(s?JSON.parse(s):{})}catch(i){r(new Error("Invalid JSON"))}}),e.on("error",r)})}}});var dH,$r,uH=v(()=>{dH=require("url");Jc();Gi();Lt();$r=class extends nn{constructor(t,r,s,i,a,o){super();this.plugin=t;this.taskService=r;this.filterService=s;this.cacheManager=i;this.statusManager=a;this.webhookNotifier=o}async getTasks(t,r){try{let i=(0,dH.parse)(t.url||"",!0).query;if(["status","priority","project","tag","overdue","completed","archived","due_before","due_after","sort"].some(p=>i[p])){this.sendResponse(r,400,this.errorResponse("For filtering tasks, please use POST /api/tasks/query which supports advanced filtering capabilities. GET /api/tasks is for basic listing only. See API documentation for details."));return}let l=await this.cacheManager.getAllTasks(),c=0,d=50;i.offset&&(c=parseInt(i.offset,10),(isNaN(c)||c<0)&&(c=0)),i.limit&&(d=parseInt(i.limit,10),(isNaN(d)||d<1)&&(d=50),d>200&&(d=200));let u=l.slice(c,c+d),h=this.plugin.app.vault.adapter,f=null;try{"basePath"in h&&typeof h.basePath=="string"?f=h.basePath:"path"in h&&typeof h.path=="string"&&(f=h.path)}catch(p){}this.sendResponse(r,200,this.successResponse({tasks:u,pagination:{total:l.length,offset:c,limit:d,hasMore:c+d<l.length},vault:{name:this.plugin.app.vault.getName(),path:f},note:"For filtering and advanced queries, use POST /api/tasks/query"}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async createTask(t,r){try{let s=await this.parseRequestBody(t);if(!s.title||!s.title.trim()){this.sendResponse(r,400,this.errorResponse("Title is required"));return}await this.applyTaskCreationDefaults(s);let i=await this.taskService.createTask(s);await this.webhookNotifier.triggerWebhook("task.created",{task:i.taskInfo}),this.sendResponse(r,201,this.successResponse(i.taskInfo))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async getTask(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(i);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}this.sendResponse(r,200,this.successResponse(a))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async updateTask(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.parseRequestBody(t),o=await this.cacheManager.getTaskInfo(i);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=await this.taskService.updateTask(o,a);await this.webhookNotifier.triggerWebhook("task.updated",{task:l,previous:o}),this.sendResponse(r,200,this.successResponse(l))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async deleteTask(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(i);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}await this.taskService.deleteTask(a),await this.webhookNotifier.triggerWebhook("task.deleted",{task:a}),this.sendResponse(r,200,this.successResponse({message:"Task deleted successfully"}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async toggleStatus(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(i);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let o=await this.taskService.toggleStatus(a),l=this.statusManager.isCompletedStatus(a.status),c=this.statusManager.isCompletedStatus(o.status);!l&&c?await this.webhookNotifier.triggerWebhook("task.completed",{task:o}):await this.webhookNotifier.triggerWebhook("task.updated",{task:o,previous:a}),this.sendResponse(r,200,this.successResponse(o))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async toggleArchive(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(i);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let o=await this.taskService.toggleArchive(a);o.archived?await this.webhookNotifier.triggerWebhook("task.archived",{task:o}):await this.webhookNotifier.triggerWebhook("task.unarchived",{task:o}),this.sendResponse(r,200,this.successResponse(o))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async completeRecurringInstance(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let{date:a}=await this.parseRequestBody(t),o=await this.cacheManager.getTaskInfo(i);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=a?new Date(a):void 0,c=await this.taskService.toggleRecurringTaskComplete(o,l);this.sendResponse(r,200,this.successResponse(c))}catch(i){this.sendResponse(r,400,this.errorResponse(i.message))}}async queryTasks(t,r){try{let s=await this.parseRequestBody(t),i=await this.filterService.getGroupedTasks(s),a=[];for(let d of i.values())a.push(...d);let o=await this.cacheManager.getAllTasks(),l=this.plugin.app.vault.adapter,c=null;try{"basePath"in l&&typeof l.basePath=="string"?c=l.basePath:"path"in l&&typeof l.path=="string"&&(c=l.path)}catch(d){}this.sendResponse(r,200,this.successResponse({tasks:a,total:o.length,filtered:a.length,vault:{name:this.plugin.app.vault.getName(),path:c}}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async getFilterOptions(t,r){try{let s=await this.filterService.getFilterOptions();this.sendResponse(r,200,this.successResponse(s))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async getStats(t,r){try{let s=await this.cacheManager.getAllTasks(),i={total:s.length,completed:s.filter(a=>this.statusManager.isCompletedStatus(a.status)).length,active:s.filter(a=>!this.statusManager.isCompletedStatus(a.status)&&!a.archived).length,overdue:s.filter(a=>this.statusManager.isCompletedStatus(a.status)||a.archived?!1:a.due&&new Date(a.due)<new Date).length,archived:s.filter(a=>a.archived).length,withTimeTracking:s.filter(a=>a.timeEntries&&a.timeEntries.length>0).length};this.sendResponse(r,200,this.successResponse(i))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async applyTaskCreationDefaults(t){let r=this.plugin.settings.taskCreationDefaults;if(!t.scheduled&&r.defaultScheduledDate!=="none"&&(t.scheduled=Bs(r.defaultScheduledDate)),!t.due&&r.defaultDueDate!=="none"&&(t.due=Bs(r.defaultDueDate)),!t.contexts&&r.defaultContexts&&(t.contexts=r.defaultContexts.split(",").map(s=>s.trim()).filter(s=>s)),!t.projects&&r.defaultProjects&&(t.projects=r.defaultProjects.split(",").map(s=>s.trim()).filter(s=>s)),!t.timeEstimate&&r.defaultTimeEstimate>0&&(t.timeEstimate=r.defaultTimeEstimate),!t.tags&&r.defaultTags&&(t.tags=r.defaultTags.split(",").map(s=>s.trim()).filter(s=>s)),!t.recurrence&&r.defaultRecurrence&&r.defaultRecurrence!=="none"&&(t.recurrence={frequency:r.defaultRecurrence}),!t.reminders&&r.defaultReminders&&r.defaultReminders.length>0){let{convertDefaultRemindersToReminders:s}=await Promise.resolve().then(()=>(Yf(),Vf));t.reminders=s(r.defaultReminders)}}};Me([Bt("/api/tasks")],$r.prototype,"getTasks",1),Me([Ht("/api/tasks")],$r.prototype,"createTask",1),Me([Bt("/api/tasks/:id")],$r.prototype,"getTask",1),Me([LS("/api/tasks/:id")],$r.prototype,"updateTask",1),Me([ap("/api/tasks/:id")],$r.prototype,"deleteTask",1),Me([Ht("/api/tasks/:id/toggle-status")],$r.prototype,"toggleStatus",1),Me([Ht("/api/tasks/:id/archive")],$r.prototype,"toggleArchive",1),Me([Ht("/api/tasks/:id/complete-instance")],$r.prototype,"completeRecurringInstance",1),Me([Ht("/api/tasks/query")],$r.prototype,"queryTasks",1),Me([Bt("/api/filter-options")],$r.prototype,"getFilterOptions",1),Me([Bt("/api/stats")],$r.prototype,"getStats",1)});var hH,li,fH=v(()=>{hH=require("url");Jc();Gi();li=class extends nn{constructor(t,r,s,i,a){super();this.plugin=t;this.taskService=r;this.cacheManager=s;this.statusManager=i;this.webhookNotifier=a}async startTimeTracking(t,r,s){var i;try{let a=s==null?void 0:s.id;if(!a){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let o=await this.cacheManager.getTaskInfo(a);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=await this.taskService.startTimeTracking(o);await this.webhookNotifier.triggerWebhook("time.started",{task:l,session:(i=l.timeEntries)==null?void 0:i[l.timeEntries.length-1]}),this.sendResponse(r,200,this.successResponse(l))}catch(a){this.sendResponse(r,400,this.errorResponse(a.message))}}async stopTimeTracking(t,r,s){var i;try{let a=s==null?void 0:s.id;if(!a){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let o=await this.cacheManager.getTaskInfo(a);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let l=await this.taskService.stopTimeTracking(o);await this.webhookNotifier.triggerWebhook("time.stopped",{task:l,session:(i=l.timeEntries)==null?void 0:i[l.timeEntries.length-1]}),this.sendResponse(r,200,this.successResponse(l))}catch(a){this.sendResponse(r,400,this.errorResponse(a.message))}}async startTimeTrackingWithDescription(t,r,s){var i;try{let a=s==null?void 0:s.id;if(!a){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let o=await this.cacheManager.getTaskInfo(a);if(!o){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let c=(await this.parseRequestBody(t)).description||"",d=await this.taskService.startTimeTracking(o);if(c&&d.timeEntries&&d.timeEntries.length>0){let u=d.timeEntries[d.timeEntries.length-1];u&&!u.endTime&&(u.description=c,await this.taskService.updateTask(d,{timeEntries:d.timeEntries}))}await this.webhookNotifier.triggerWebhook("time.started",{task:d,session:(i=d.timeEntries)==null?void 0:i[d.timeEntries.length-1]}),this.sendResponse(r,200,this.successResponse({task:d,message:c?`Time tracking started with description: ${c}`:"Time tracking started"}))}catch(a){this.sendResponse(r,400,this.errorResponse(a.message))}}async getActiveTimeSessions(t,r){try{let s=await this.cacheManager.getAllTasks(),i=[];for(let a of s){let o=this.plugin.getActiveTimeSession(a);if(o){let l=new Date(o.startTime),c=Math.floor((Date.now()-l.getTime())/(1e3*60));i.push({task:{id:a.path,title:a.title,status:a.status,priority:a.priority,tags:a.tags||[],projects:a.projects||[]},session:{startTime:o.startTime,description:o.description,elapsedMinutes:c},elapsedMinutes:c})}}this.sendResponse(r,200,this.successResponse({activeSessions:i,totalActiveSessions:i.length,totalElapsedMinutes:i.reduce((a,o)=>a+o.elapsedMinutes,0)}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async getTimeSummary(t,r){try{let i=(0,hH.parse)(t.url||"",!0).query,a=await this.cacheManager.getAllTasks(),o=i.period||"today",l=i.from?new Date(i.from):null,c=i.to?new Date(i.to):null,d,u=new Date;switch(o){case"today":d=new Date,d.setHours(0,0,0,0);break;case"week":d=new Date,d.setDate(d.getDate()-d.getDay()),d.setHours(0,0,0,0);break;case"month":d=new Date,d.setDate(1),d.setHours(0,0,0,0);break;case"all":d=new Date(0);break;default:l?(d=l,c&&(u=c)):(d=new Date,d.setHours(0,0,0,0))}let h=0,f=0,p=0,m=[],g=new Map,y=new Map;for(let S of a){if(!S.timeEntries||S.timeEntries.length===0)continue;let k=0,D=!1;for(let M of S.timeEntries){let _=new Date(M.startTime),W=M.endTime?new Date(M.endTime):new Date;if(_>=d&&_<=u)if(M.duration)k+=M.duration;else if(M.endTime){let j=W.getTime()-_.getTime();k+=Math.floor(j/(1e3*60))}else{let j=Math.floor((Date.now()-_.getTime())/6e4);k+=j,D=!0}}if(k>0){if(h+=k,m.push({task:S.path,title:S.title,minutes:k}),D?p++:this.statusManager.isCompletedStatus(S.status)&&f++,S.projects)for(let M of S.projects){let _=g.get(M)||0;g.set(M,_+k)}if(S.tags)for(let M of S.tags){let _=y.get(M)||0;y.set(M,_+k)}}}m.sort((S,k)=>k.minutes-S.minutes);let T=m.slice(0,10),w=Array.from(g.entries()).sort((S,k)=>k[1]-S[1]).slice(0,10).map(([S,k])=>({project:S,minutes:k})),b=Array.from(y.entries()).sort((S,k)=>k[1]-S[1]).slice(0,10).map(([S,k])=>({tag:S,minutes:k}));this.sendResponse(r,200,this.successResponse({period:o,dateRange:{from:d.toISOString(),to:u.toISOString()},summary:{totalMinutes:h,totalHours:Math.round(h/60*100)/100,tasksWithTime:m.length,activeTasks:p,completedTasks:f},topTasks:T,topProjects:w,topTags:b}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async getTaskTimeData(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Task ID is required"));return}let a=await this.cacheManager.getTaskInfo(i);if(!a){this.sendResponse(r,404,this.errorResponse("Task not found"));return}let o=a.timeEntries||[],l=this.plugin.getActiveTimeSession(a),c=this.calculateTotalTimeSpent(o),d=o.filter(p=>p.endTime).length,u=l?1:0,h=o.filter(p=>p.endTime&&p.duration),f=h.length>0?Math.round(h.reduce((p,m)=>p+(m.duration||0),0)/h.length*100)/100:0;this.sendResponse(r,200,this.successResponse({task:{id:a.path,title:a.title,status:a.status,priority:a.priority},summary:{totalMinutes:c,totalHours:Math.round(c/60*100)/100,totalSessions:o.length,completedSessions:d,activeSessions:u,averageSessionMinutes:f},activeSession:l?{startTime:l.startTime,description:l.description,elapsedMinutes:Math.floor((Date.now()-new Date(l.startTime).getTime())/(1e3*60))}:null,timeEntries:o.map(p=>({startTime:p.startTime,endTime:p.endTime||null,description:p.description||null,duration:p.duration||(p.endTime?Math.floor((new Date(p.endTime).getTime()-new Date(p.startTime).getTime())/(1e3*60)):Math.floor((Date.now()-new Date(p.startTime).getTime())/(1e3*60))),isActive:!p.endTime}))}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}calculateTotalTimeSpent(t){return!t||t.length===0?0:t.reduce((r,s)=>{if(s.duration)return r+s.duration;if(s.endTime){let i=new Date(s.endTime).getTime()-new Date(s.startTime).getTime();return r+Math.floor(i/(1e3*60))}else{let i=Date.now()-new Date(s.startTime).getTime();return r+Math.floor(i/(1e3*60))}},0)}};Me([Ht("/api/tasks/:id/time/start")],li.prototype,"startTimeTracking",1),Me([Ht("/api/tasks/:id/time/stop")],li.prototype,"stopTimeTracking",1),Me([Ht("/api/tasks/:id/time/start-with-description")],li.prototype,"startTimeTrackingWithDescription",1),Me([Bt("/api/time/active")],li.prototype,"getActiveTimeSessions",1),Me([Bt("/api/time/summary")],li.prototype,"getTimeSummary",1),Me([Bt("/api/tasks/:id/time")],li.prototype,"getTaskTimeData",1)});var BS,xn,pH=v(()=>{BS=require("url");Jc();Gi();xn=class extends nn{constructor(t,r){super();this.plugin=t;this.cacheManager=r}async startPomodoro(t,r){try{let s=await this.parseRequestBody(t),i;if(s.taskId){let c=await this.cacheManager.getTaskInfo(s.taskId);if(!c){this.sendResponse(r,404,this.errorResponse("Task not found"));return}i=c}if(this.plugin.pomodoroService.getState().isRunning){this.sendResponse(r,400,this.errorResponse("Pomodoro session is already running. Stop or pause the current session first."));return}let o=s.duration?parseInt(s.duration):void 0;await this.plugin.pomodoroService.startPomodoro(i,o);let l=this.plugin.pomodoroService.getState();this.sendResponse(r,200,this.successResponse({session:l.currentSession,task:i||null,message:"Pomodoro session started"}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async stopPomodoro(t,r){try{if(!this.plugin.pomodoroService.getState().currentSession){this.sendResponse(r,400,this.errorResponse("No active pomodoro session to stop"));return}await this.plugin.pomodoroService.stopPomodoro(),this.sendResponse(r,200,this.successResponse({message:"Pomodoro session stopped and reset"}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async pausePomodoro(t,r){try{let s=this.plugin.pomodoroService.getState();if(!s.isRunning||!s.currentSession){this.sendResponse(r,400,this.errorResponse("No running pomodoro session to pause"));return}await this.plugin.pomodoroService.pausePomodoro();let i=this.plugin.pomodoroService.getState();this.sendResponse(r,200,this.successResponse({timeRemaining:i.timeRemaining,message:"Pomodoro session paused"}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async resumePomodoro(t,r){try{let s=this.plugin.pomodoroService.getState();if(s.isRunning){this.sendResponse(r,400,this.errorResponse("Pomodoro session is already running"));return}if(!s.currentSession){this.sendResponse(r,400,this.errorResponse("No paused session to resume"));return}await this.plugin.pomodoroService.resumePomodoro();let i=this.plugin.pomodoroService.getState();this.sendResponse(r,200,this.successResponse({timeRemaining:i.timeRemaining,message:"Pomodoro session resumed"}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async getPomodoroStatus(t,r){try{let i={...this.plugin.pomodoroService.getState(),totalPomodoros:await this.plugin.pomodoroService.getPomodorosCompleted(),currentStreak:await this.plugin.pomodoroService.getCurrentStreak(),totalMinutesToday:await this.plugin.pomodoroService.getTotalMinutesToday()};this.sendResponse(r,200,this.successResponse(i))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async getPomodoroSessions(t,r){try{let i=(0,BS.parse)(t.url||"",!0).query,a=await this.plugin.pomodoroService.getSessionHistory();if(i.date&&typeof i.date=="string"){let l=i.date;a=a.filter(c=>new Date(c.startTime).toISOString().split("T")[0]===l)}let o=a.length;if(i.limit&&typeof i.limit=="string"){let l=parseInt(i.limit);l>0&&(a=a.slice(-l))}this.sendResponse(r,200,this.successResponse({sessions:a,total:o}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async getPomodoroStats(t,r){try{let i=(0,BS.parse)(t.url||"",!0).query,a;if(i.date&&typeof i.date=="string"){let o=new Date(i.date);a=await this.plugin.pomodoroService.getStatsForDate(o)}else a=await this.plugin.pomodoroService.getTodayStats();this.sendResponse(r,200,this.successResponse(a))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}};Me([Ht("/api/pomodoro/start")],xn.prototype,"startPomodoro",1),Me([Ht("/api/pomodoro/stop")],xn.prototype,"stopPomodoro",1),Me([Ht("/api/pomodoro/pause")],xn.prototype,"pausePomodoro",1),Me([Ht("/api/pomodoro/resume")],xn.prototype,"resumePomodoro",1),Me([Bt("/api/pomodoro/status")],xn.prototype,"getPomodoroStatus",1),Me([Bt("/api/pomodoro/sessions")],xn.prototype,"getPomodoroSessions",1),Me([Bt("/api/pomodoro/stats")],xn.prototype,"getPomodoroStats",1)});var Qi,mH=v(()=>{Jc();Lt();Gi();Qi=class extends nn{constructor(t,r,s,i,a){super();this.plugin=t;this.taskService=r;this.nlParser=s;this.webhookNotifier=i;this.httpAPIService=a}async healthCheck(t,r){let s=this.plugin.app.vault.getName(),i=this.plugin.app.vault.adapter,a=null;try{"basePath"in i&&typeof i.basePath=="string"?a=i.basePath:"path"in i&&typeof i.path=="string"&&(a=i.path)}catch(o){}this.sendResponse(r,200,this.successResponse({status:"ok",timestamp:new Date().toISOString(),vault:{name:s,path:a}}))}async handleNLPParse(t,r){try{let s=await this.parseRequestBody(t);if(!s.text||typeof s.text!="string"){this.sendResponse(r,400,this.errorResponse("Text field is required and must be a string"));return}let i=this.nlParser.parseInput(s.text),a={title:i.title,details:i.details,priority:i.priority,status:i.status||this.getDefaultStatus(),tags:i.tags,contexts:i.contexts,projects:i.projects,recurrence:i.recurrence,timeEstimate:i.estimate};i.dueDate&&(a.due=i.dueDate,i.dueTime&&(a.due=`${i.dueDate} ${i.dueTime}`)),i.scheduledDate&&(a.scheduled=i.scheduledDate,i.scheduledTime&&(a.scheduled=`${i.scheduledDate} ${i.scheduledTime}`)),this.sendResponse(r,200,this.successResponse({parsed:i,taskData:a}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async handleNLPCreate(t,r){try{let s=await this.parseRequestBody(t);if(!s.text||typeof s.text!="string"){this.sendResponse(r,400,this.errorResponse("Text field is required and must be a string"));return}let i=this.nlParser.parseInput(s.text),a={title:i.title,details:i.details,priority:i.priority,status:i.status||this.getDefaultStatus(),tags:i.tags,contexts:i.contexts,projects:i.projects,recurrence:i.recurrence,timeEstimate:i.estimate,creationContext:"api"};i.dueDate&&(a.due=i.dueDate,i.dueTime&&(a.due=`${i.dueDate} ${i.dueTime}`)),i.scheduledDate&&(a.scheduled=i.scheduledDate,i.scheduledTime&&(a.scheduled=`${i.scheduledDate} ${i.scheduledTime}`)),await this.applyTaskCreationDefaults(a);let o=await this.taskService.createTask(a);await this.webhookNotifier.triggerWebhook("task.created",{task:o.taskInfo,source:"nlp",originalText:s.text}),this.sendResponse(r,201,this.successResponse({task:o.taskInfo,parsed:i}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async handleOpenAPISpec(t,r){try{let s=this.httpAPIService&&this.httpAPIService.generateOpenAPISpec?this.httpAPIService.generateOpenAPISpec():FS(this);r.statusCode=200,r.setHeader("Content-Type","application/json"),r.setHeader("Access-Control-Allow-Origin","*"),r.end(JSON.stringify(s,null,2))}catch(s){console.error("OpenAPI spec generation error:",s),this.sendResponse(r,500,this.errorResponse("Failed to generate API specification"))}}async handleSwaggerUI(t,r){try{let s=this.generateSwaggerUIHTML();r.statusCode=200,r.setHeader("Content-Type","text/html"),r.setHeader("Access-Control-Allow-Origin","*"),r.end(s)}catch(s){console.error("Swagger UI generation error:",s),this.sendResponse(r,500,this.errorResponse("Failed to generate API documentation"))}}async applyTaskCreationDefaults(t){let r=this.plugin.settings.taskCreationDefaults;if(!t.scheduled&&r.defaultScheduledDate!=="none"&&(t.scheduled=Bs(r.defaultScheduledDate)),!t.due&&r.defaultDueDate!=="none"&&(t.due=Bs(r.defaultDueDate)),!t.contexts&&r.defaultContexts&&(t.contexts=r.defaultContexts.split(",").map(s=>s.trim()).filter(s=>s)),!t.projects&&r.defaultProjects&&(t.projects=r.defaultProjects.split(",").map(s=>s.trim()).filter(s=>s)),!t.timeEstimate&&r.defaultTimeEstimate>0&&(t.timeEstimate=r.defaultTimeEstimate),!t.tags&&r.defaultTags&&(t.tags=r.defaultTags.split(",").map(s=>s.trim()).filter(s=>s)),!t.recurrence&&r.defaultRecurrence&&r.defaultRecurrence!=="none"&&(t.recurrence={frequency:r.defaultRecurrence}),!t.reminders&&r.defaultReminders&&r.defaultReminders.length>0){let{convertDefaultRemindersToReminders:s}=await Promise.resolve().then(()=>(Yf(),Vf));t.reminders=s(r.defaultReminders)}}getDefaultStatus(){let t=this.plugin.settings.customStatuses;return t&&t.length>0?[...t].sort((s,i)=>s.order-i.order)[0].value:"open"}generateSwaggerUIHTML(){return`<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>TaskNotes API Documentation</title>
	<link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui.css" />
	<style>
		body { margin: 0; }
		.swagger-ui .topbar { display: none; }
		.swagger-ui .info .title { color: #663399; }
	</style>
</head>
<body>
	<div id="swagger-ui"></div>
	<script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-bundle.js"><\/script>
	<script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-standalone-preset.js"><\/script>
	<script>
		SwaggerUIBundle({
			url: 'http://localhost:${this.plugin.settings.apiPort}/api/docs',
			dom_id: '#swagger-ui',
			deepLinking: true,
			presets: [
				SwaggerUIBundle.presets.apis,
				SwaggerUIStandalonePreset
			],
			plugins: [
				SwaggerUIBundle.plugins.DownloadUrl
			],
			layout: "StandaloneLayout",
			tryItOutEnabled: true,
			displayRequestDuration: true,
			docExpansion: 'list',
			filter: true,
			validatorUrl: null
		});
	<\/script>
</body>
</html>`}};Me([Bt("/api/health")],Qi.prototype,"healthCheck",1),Me([Ht("/api/nlp/parse")],Qi.prototype,"handleNLPParse",1),Me([Ht("/api/nlp/create")],Qi.prototype,"handleNLPCreate",1),Me([Bt("/api/docs")],Qi.prototype,"handleOpenAPISpec",1),Me([Bt("/api/docs/ui")],Qi.prototype,"handleSwaggerUI",1)});var uv,$a,gH=v(()=>{Jc();uv=require("crypto");Gi();$a=class extends nn{constructor(t){super();this.plugin=t;this.webhooks=new Map;this.webhookDeliveryQueue=[];this.loadWebhooks()}async registerWebhook(t,r){try{let s=await this.parseRequestBody(t);if(!s.url||typeof s.url!="string"){this.sendResponse(r,400,this.errorResponse("URL is required and must be a string"));return}if(!s.events||!Array.isArray(s.events)||s.events.length===0){this.sendResponse(r,400,this.errorResponse("Events array is required and must not be empty"));return}let i=s.id||this.generateWebhookId(),a=s.secret||this.generateWebhookSecret(),o={id:i,url:s.url,events:s.events,secret:a,active:s.active!==!1,createdAt:new Date().toISOString(),failureCount:0,successCount:0,transformFile:s.transformFile||void 0,corsHeaders:s.corsHeaders!==!1};this.webhooks.set(i,o),await this.saveWebhooks(),this.sendResponse(r,201,this.successResponse({webhook:o,message:"Webhook registered successfully. Save the secret for signature validation."}))}catch(s){this.sendResponse(r,400,this.errorResponse(s.message))}}async listWebhooks(t,r){try{let s=Array.from(this.webhooks.values()).map(i=>({...i,secret:void 0}));this.sendResponse(r,200,this.successResponse({webhooks:s,total:s.length}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async deleteWebhook(t,r,s){try{let i=s==null?void 0:s.id;if(!i){this.sendResponse(r,400,this.errorResponse("Webhook ID is required"));return}if(!this.webhooks.has(i)){this.sendResponse(r,404,this.errorResponse("Webhook not found"));return}this.webhooks.delete(i),await this.saveWebhooks(),this.sendResponse(r,200,this.successResponse({message:"Webhook deleted successfully"}))}catch(i){this.sendResponse(r,500,this.errorResponse(i.message))}}async getWebhookDeliveries(t,r){try{let s=this.webhookDeliveryQueue.slice(-100);this.sendResponse(r,200,this.successResponse({deliveries:s,total:s.length}))}catch(s){this.sendResponse(r,500,this.errorResponse(s.message))}}async triggerWebhook(t,r){setImmediate(()=>{this.processWebhookTrigger(t,r).catch(s=>{console.error("Webhook processing error:",s)})})}async processWebhookTrigger(t,r){let s=Array.from(this.webhooks.values()).filter(l=>l.active&&l.events.includes(t));if(s.length===0)return;let i=this.plugin.app.vault.adapter,a=null;try{"basePath"in i&&typeof i.basePath=="string"?a=i.basePath:"path"in i&&typeof i.path=="string"&&(a=i.path)}catch(l){}let o={event:t,timestamp:new Date().toISOString(),vault:{name:this.plugin.app.vault.getName(),path:a},data:r};for(let l of s){let c=o;if(l.transformFile)try{c=await this.applyTransformation(l.transformFile,o)}catch(u){console.error(`Transform error for ${l.transformFile}:`,u)}let d={id:this.generateDeliveryId(),webhookId:l.id,event:t,payload:c,status:"pending",attempts:0};this.webhookDeliveryQueue.push(d),this.deliverWebhook(l,d)}this.webhookDeliveryQueue.length>100&&(this.webhookDeliveryQueue=this.webhookDeliveryQueue.slice(-100))}async deliverWebhook(t,r,s=0){try{r.attempts++,r.lastAttempt=new Date().toISOString();let a=this.generateSignature(r.payload,t.secret),o={"Content-Type":"application/json"};t.corsHeaders!==!1&&(o["X-TaskNotes-Event"]=r.event,o["X-TaskNotes-Signature"]=a,o["X-TaskNotes-Delivery-ID"]=r.id);let l=await fetch(t.url,{method:"POST",headers:o,body:JSON.stringify(r.payload)});if(r.responseStatus=l.status,l.ok)r.status="success",t.successCount++,t.lastTriggered=new Date().toISOString();else throw new Error(`HTTP ${l.status}: ${l.statusText}`)}catch(a){if(r.error=a.message,t.failureCount++,s<3){let o=Math.pow(2,s)*1e3;setTimeout(()=>{this.deliverWebhook(t,r,s+1)},o)}else r.status="failed",t.failureCount>10&&(t.active=!1,console.warn(`Webhook ${t.id} disabled after ${t.failureCount} failures`))}await this.saveWebhooks()}generateSignature(t,r){let s=(0,uv.createHmac)("sha256",r);return s.update(JSON.stringify(t)),s.digest("hex")}generateWebhookId(){return`wh_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}generateWebhookSecret(){return(0,uv.createHash)("sha256").update(Date.now().toString()+Math.random().toString()).digest("hex")}generateDeliveryId(){return`del_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}async saveWebhooks(){let t=Array.from(this.webhooks.values());this.plugin.settings.webhooks=t,await this.plugin.saveSettings()}loadWebhooks(){if(this.plugin.settings.webhooks){this.webhooks.clear();for(let t of this.plugin.settings.webhooks)this.webhooks.set(t.id,t)}}async applyTransformation(t,r){try{return t.endsWith(".js")?await this.applyJSTransformation(t,r):t.endsWith(".json")?await this.applyJSONTransformation(t,r):r}catch(s){throw console.error(`Transformation failed for ${t}:`,s),s}}async applyJSTransformation(t,r){try{let s=await this.plugin.app.vault.adapter.read(t);return new Function("payload",`
				${s}
				if (typeof transform === 'function') {
					return transform(payload);
				} else {
					throw new Error('Transform file must export a transform function');
				}
			`)(r)}catch(s){throw console.error("JS transformation error:",s),s}}async applyJSONTransformation(t,r){try{let s=await this.plugin.app.vault.adapter.read(t),i=JSON.parse(s),a=i[r.event]||i.default;if(!a)throw new Error(`No template found for event ${r.event} and no default template`);return this.interpolateTemplate(a,r)}catch(s){throw console.error("JSON transformation error:",s),s}}interpolateTemplate(t,r){if(typeof t=="string")return t.replace(/\$\{([^}]+)\}/g,(s,i)=>this.getNestedValue(r,i)||s);if(Array.isArray(t))return t.map(s=>this.interpolateTemplate(s,r));if(t&&typeof t=="object"){let s={};for(let[i,a]of Object.entries(t))s[i]=this.interpolateTemplate(a,r);return s}else return t}getNestedValue(t,r){return r.split(".").reduce((s,i)=>s&&s[i]!==void 0?s[i]:void 0,t)}};Me([Ht("/api/webhooks")],$a.prototype,"registerWebhook",1),Me([Bt("/api/webhooks")],$a.prototype,"listWebhooks",1),Me([ap("/api/webhooks/:id")],$a.prototype,"deleteWebhook",1),Me([Bt("/api/webhooks/deliveries")],$a.prototype,"getWebhookDeliveries",1)});var TH={};nt(TH,{HTTPAPIService:()=>op});var yH,vH,op,wH=v(()=>{yH=require("http"),vH=require("url");$f();pS();Gi();cH();uH();fH();pH();mH();gH();op=class{constructor(e,t,r,s){this.plugin=e;let i=new ei(e.settings.customStatuses,e.settings.customPriorities,e.settings.nlpDefaultToScheduled,e.settings.nlpLanguage),a=new jc(e.settings.customStatuses);this.webhookController=new $a(e),this.tasksController=new $r(e,t,r,s,a,this.webhookController),this.timeTrackingController=new li(e,t,s,a,this.webhookController),this.pomodoroController=new xn(e,s),this.systemController=new Qi(e,t,i,this.webhookController,this),this.router=new dv,this.setupRoutes()}setupRoutes(){this.router.registerController(this.tasksController),this.router.registerController(this.timeTrackingController),this.router.registerController(this.pomodoroController),this.router.registerController(this.systemController),this.router.registerController(this.webhookController)}generateOpenAPISpec(){let{generateOpenAPISpec:e}=(Gi(),fp(oH)),t=e(this.systemController),r=[this.tasksController,this.timeTrackingController,this.pomodoroController,this.systemController,this.webhookController];t.paths={};for(let s of r){let i=e(s);i.paths&&(t.paths={...t.paths,...i.paths})}return t.servers=[{url:`http://localhost:${this.plugin.settings.apiPort}`,description:"TaskNotes API Server"}],t}async handleCORSPreflight(e,t){t.statusCode=200,t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),t.end()}authenticate(e){let t=this.plugin.settings.apiAuthToken;if(!t)return!0;let r=e.headers.authorization;return!r||!r.startsWith("Bearer ")?!1:r.substring(7)===t}sendResponse(e,t,r){e.statusCode=t,e.setHeader("Content-Type","application/json"),e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),e.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),e.end(JSON.stringify(r))}successResponse(e,t){return{success:!0,data:e,message:t}}errorResponse(e){return{success:!1,error:e}}async handleRequest(e,t){try{if(e.method==="OPTIONS"){await this.handleCORSPreflight(e,t);return}if(((0,vH.parse)(e.url||"",!0).pathname||"").startsWith("/api/")&&!this.authenticate(e)){this.sendResponse(t,401,this.errorResponse("Authentication required"));return}await this.router.route(e,t)||this.sendResponse(t,404,this.errorResponse("Not found"))}catch(r){console.error("API Error:",r),this.sendResponse(t,500,this.errorResponse("Internal server error"))}}async triggerWebhook(e,t){await this.webhookController.triggerWebhook(e,t)}async start(){return new Promise((e,t)=>{try{this.server=(0,yH.createServer)((r,s)=>{this.handleRequest(r,s).catch(i=>{console.error("Request handling error:",i),this.sendResponse(s,500,this.errorResponse("Internal server error"))})}),this.server.listen(this.plugin.settings.apiPort,()=>{console.log(`TaskNotes API server started on port ${this.plugin.settings.apiPort}`),e()}),this.server.on("error",r=>{console.error("API server error:",r),t(r)})}catch(r){t(r)}})}async stop(){return new Promise(e=>{this.server?this.server.close(()=>{console.log("TaskNotes API server stopped"),e()}):e()})}isRunning(){return!!this.server&&this.server.listening}getPort(){return this.plugin.settings.apiPort}};op=Me([OS],op)});var jr,HS=v(()=>{Fe();jr=class{static parseTaskLine(e){if(typeof e!="string")return{isTaskLine:!1,originalText:"",error:"Invalid input: line must be a string"};if(e.length>2e3)return{isTaskLine:!1,originalText:e,error:"Line too long to process safely"};let r=e.trim().match(this.CHECKBOX_PATTERN);if(!r)return{isTaskLine:!1,originalText:e};try{let[,,s,,i]=r;if(typeof s!="string"||typeof i!="string")return{isTaskLine:!0,originalText:e,error:"Invalid checkbox format"};let a=s.toLowerCase()==="x",o=this.parseTaskContent(i,a);return!o||!o.title||o.title.trim().length===0?{isTaskLine:!0,originalText:e,error:"Task must have a title"}:{isTaskLine:!0,originalText:e,parsedData:o}}catch(s){return{isTaskLine:!0,originalText:e,error:`Failed to parse task: ${s instanceof Error?s.message:"Unknown error"}`}}}static parseTaskContent(e,t){if(typeof e!="string")throw new Error("Content must be a string");if(e.length>1e3)throw new Error("Content too long to process safely");let r=e;try{let s=this.extractDate(r,this.EMOJI_PATTERNS.DUE_DATE),i=this.extractDate(r,this.EMOJI_PATTERNS.SCHEDULED_DATE),a=this.extractDate(r,this.EMOJI_PATTERNS.START_DATE),o=this.extractDate(r,this.EMOJI_PATTERNS.CREATED_DATE),l=this.extractDate(r,this.EMOJI_PATTERNS.DONE_DATE),c=this.extractPriority(r),{recurrence:d,recurrenceData:u}=this.extractRecurrence(r),h=this.extractTags(r),f=this.extractCleanTitle(r);if(!f||f.trim().length===0)throw new Error("Title cannot be empty after parsing");let p;if(t||l)p="done";else if(a)try{!_l(a)&&!sa(a)?p="scheduled":p="open"}catch(m){}return{title:f.trim(),status:p,priority:c,dueDate:s,scheduledDate:i,startDate:a,createdDate:o,doneDate:l,recurrence:d,recurrenceData:u,tags:h.length>0?h:void 0,projects:void 0,isCompleted:t}}catch(s){throw new Error(`Failed to parse task content: ${s instanceof Error?s.message:"Unknown error"}`)}}static extractDate(e,t){if(!(typeof e!="string"||!t))try{let s=new RegExp(t.source,"g").exec(e);if(s&&s[1]){let i=s[1].trim();if(!/^\d{4}-\d{2}-\d{2}$/.test(i))return;try{let a=qe(i);if(isNaN(a.getTime()))return;let o=a.getUTCFullYear();return o<1900||o>2100?void 0:me(a)}catch(a){return}}}catch(r){console.debug("Error extracting date:",r)}}static extractPriority(e){if(new RegExp(this.EMOJI_PATTERNS.HIGH_PRIORITY.source).test(e))return"high";if(new RegExp(this.EMOJI_PATTERNS.MEDIUM_PRIORITY.source).test(e))return"medium";if(new RegExp(this.EMOJI_PATTERNS.LOW_PRIORITY.source).test(e))return"low"}static extractRecurrence(e){let r=new RegExp(this.EMOJI_PATTERNS.RECURRENCE.source,"g").exec(e);if(!r||!r[1])return{};let s=r[1].trim();if(s.includes("every day"))return{recurrence:"daily",recurrenceData:{frequency:"daily"}};if(s.includes("every week"))return{recurrence:"weekly",recurrenceData:{frequency:"weekly"}};if(s.includes("every month"))return{recurrence:"monthly",recurrenceData:{frequency:"monthly"}};if(s.includes("every year"))return{recurrence:"yearly",recurrenceData:{frequency:"yearly"}};let i=s.match(/every\s+(monday|tuesday|wednesday|thursday|friday|saturday|sunday)/i);return i?{recurrence:"weekly",recurrenceData:{frequency:"weekly",days_of_week:[i[1].toLowerCase().substring(0,3)]}}:{recurrence:"custom",recurrenceData:{frequency:"custom",raw:s}}}static extractTags(e){if(typeof e!="string")return[];try{let t=new RegExp(this.TAG_PATTERN.source,"g"),r=[],s;for(;(s=t.exec(e))!==null;)if(s[0]){let i=s[0].substring(1);i&&!r.includes(i)&&r.push(i)}return r}catch(t){return console.debug("Error extracting tags:",t),[]}}static extractCleanTitle(e){if(typeof e!="string")return"";try{let t=e;Object.values(this.EMOJI_PATTERNS).forEach(s=>{try{let i=new RegExp(s.source,"g");t=t.replace(i,"")}catch(i){console.debug("Error applying emoji pattern:",i)}});try{let s=new RegExp(this.TAG_PATTERN.source,"g");t=t.replace(s,"")}catch(s){console.debug("Error removing tags from title:",s)}let r=t.replace(/\s+/g," ").trim();return r.length===0?"Untitled Task":r}catch(t){return console.debug("Error extracting clean title:",t),"Untitled Task"}}static isTasksPluginFormat(e){if(typeof e!="string"||e.length>1e3)return!1;try{let t=e.trim();return this.CHECKBOX_PATTERN.test(t)?Object.values(this.EMOJI_PATTERNS).some(i=>{try{return new RegExp(i.source).test(t)}catch(a){return!1}}):!1}catch(t){return console.debug("Error validating Tasks plugin format:",t),!1}}static getSummary(e){let t=[];return t.push(`Title: "${e.title}"`),t.push(`Status: ${e.status}`),t.push(`Priority: ${e.priority}`),e.dueDate&&t.push(`Due: ${e.dueDate}`),e.startDate&&t.push(`Start: ${e.startDate}`),e.scheduledDate&&t.push(`Scheduled: ${e.scheduledDate}`),e.createdDate&&t.push(`Created: ${e.createdDate}`),e.doneDate&&t.push(`Done: ${e.doneDate}`),e.recurrence&&t.push(`Recurrence: ${e.recurrence}`),e.tags&&e.tags.length>0&&t.push(`Tags: ${e.tags.map(r=>"#"+r).join(", ")}`),e.projects&&e.projects.length>0&&t.push(`Projects: ${e.projects.map(r=>r.includes(" ")?`+[[${r}]]`:`+${r}`).join(", ")}`),t.join(" | ")}};jr.EMOJI_PATTERNS={DUE_DATE:/📅\s*(\d{4}-\d{2}-\d{2})/g,SCHEDULED_DATE:/⏳\s*(\d{4}-\d{2}-\d{2})/g,START_DATE:/🛫\s*(\d{4}-\d{2}-\d{2})/g,CREATED_DATE:/➕\s*(\d{4}-\d{2}-\d{2})/g,DONE_DATE:/✅\s*(\d{4}-\d{2}-\d{2})/g,HIGH_PRIORITY:/⏫/g,MEDIUM_PRIORITY:/🔼/g,LOW_PRIORITY:/⏬/g,RECURRENCE:/🔁\s*([^📅⏳🛫➕✅⏫🔼⏬🔁#]+?)(?=\s*[📅⏳🛫➕✅⏫🔼⏬🔁#]|$)/gu},jr.TAG_PATTERN=/#[\w/]+/g,jr.CHECKBOX_PATTERN=/^(\s*(?:[-*+]|\d+\.)\s+\[)([ xX])(\]\s+)(.*)/});var bH={};nt(bH,{InstantTaskConvertService:()=>US});var Vr,US,kH=v(()=>{Vr=require("obsidian");HS();$f();Fe();Lt();Ly();Sl();US=class{constructor(e,t,r){this.plugin=e,this.statusManager=t,this.priorityManager=r,this.nlParser=new ei(e.settings.customStatuses,e.settings.customPriorities,e.settings.nlpDefaultToScheduled,e.settings.nlpLanguage)}async batchConvertAllTasks(e){try{let t=this.findAllCheckboxTasks(e);if(t.length===0){new Vr.Notice("No checkbox tasks found in the current note.");return}new Vr.Notice(`Converting ${t.length} task${t.length===1?"":"s"}...`);let r=await this.batchConvertTasksOptimized(e,t);if(r.failures.length===0)new Vr.Notice(`\u2705 Successfully converted ${r.successCount} task${r.successCount===1?"":"s"} to TaskNotes!`);else{let s=`Converted ${r.successCount} task${r.successCount===1?"":"s"}.`;r.failures.length>0&&(s+=` ${r.failures.length} failed.`),new Vr.Notice(s),console.warn("Batch conversion failures:",r.failures)}}catch(t){console.error("Error during batch task conversion:",t),new Vr.Notice("Failed to perform batch conversion. Please try again.")}}async batchConvertTasksOptimized(e,t){let r=[],s=[],i=t.map(async o=>{try{let l=await this.parseTaskForBatch(o.line);if(!l)throw new Error("Failed to parse task");let c=await this.createTaskFile(l),d=this.generateLinkText(o.line,c);return{lineNumber:o.lineNumber,line:o.line,file:c,linkText:d}}catch(l){return r.push({lineNumber:o.lineNumber+1,error:l instanceof Error?l.message:String(l)}),null}}),a=await Promise.all(i);for(let o of a)o&&s.push(o);return s.length>0&&this.replaceAllTaskLines(e,s),{successCount:s.length,failures:r}}async instantConvertTask(e,t){try{let r=this.validateInputParameters(e,t);if(!r.isValid){new Vr.Notice(r.error||"Invalid input parameters.");return}let s=this.extractSelectionInfo(e,t),i=s.taskLine,a=s.details,o,l=jr.parseTaskLine(i);if(l.isTaskLine){if(l.error||!l.parsedData){new Vr.Notice(`Error parsing task: ${l.error||"No data extracted"}`);return}if(!this.hasUsefulMetadata(l.parsedData)&&this.plugin.settings.enableNaturalLanguageInput){let m=this.tryNLPFallback(i,a||"");m?o=m:o=l.parsedData}else o=l.parsedData}else{let p=this.extractLineContentAsTitle(i);if(!p.trim()){new Vr.Notice("Current line is empty or contains no valid content.");return}if(this.plugin.settings.enableNaturalLanguageInput){let m=this.tryNLPFallback(p,a||"");m?o=m:o={title:p,isCompleted:!1}}else o={title:p,isCompleted:!1}}let c=this.validateTaskData(o);if(!c.isValid){new Vr.Notice(c.error||"Invalid task data.");return}let d=await this.createTaskFile(o,a),u=await this.replaceOriginalTaskLines(e,s,d,o.title);if(!u.success){new Vr.Notice(u.error||"Failed to replace task line.");try{await this.plugin.app.vault.delete(d)}catch(p){console.warn("Failed to clean up created file after replacement failure:",p)}return}let h=this.sanitizeTitle(o.title),f=d.basename;f.startsWith("task-")&&f!==h?new Vr.Notice(`Task converted: "${o.title}" (filename shortened due to length)`):new Vr.Notice(`Task converted: ${o.title}`),await this.refreshTaskLinkOverlays(e,d)}catch(r){console.error("Error during instant task conversion:",r),r.message.includes("file already exists")?new Vr.Notice("A file with this name already exists. Please try again or rename the task."):new Vr.Notice("Failed to convert task. Please try again.")}}extractSelectionInfo(e,t){let r=e.getSelection();if(r&&r.trim()){let i=e.listSelections()[0],a=Math.min(i.anchor.line,i.head.line),o=Math.max(i.anchor.line,i.head.line);if(t>=a&&t<=o){let l=[];for(let h=a;h<=o;h++)l.push(e.getLine(h));let c=l[0],u=l.slice(1).join(`
`).trimEnd();return{taskLine:c,details:u,startLine:a,endLine:o,originalContent:l}}}let s=e.getLine(t);return{taskLine:s,details:"",startLine:t,endLine:t,originalContent:[s]}}validateInputParameters(e,t){if(!e)return{isValid:!1,error:"Editor is not available."};let r=e.lineCount();if(t<0||t>=r)return{isValid:!1,error:`Line number ${t} is out of bounds (0-${r-1}).`};let s=e.getLine(t);return s==null?{isValid:!1,error:`Cannot read line ${t}.`}:{isValid:!0}}validateTaskData(e){if(!e.title||e.title.trim().length===0)return{isValid:!1,error:"Task title cannot be empty."};let t=["dueDate","scheduledDate","startDate","createdDate","doneDate"];for(let r of t){let s=e[r];if(s&&!this.isValidDateFormat(s))return{isValid:!1,error:`Invalid date format in ${r}: ${s}`}}return{isValid:!0}}isValidDateFormat(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))return!1;try{let r=qe(e);return me(r)===e}catch(r){return!1}}async createTaskFile(e,t=""){var W,j;let r=this.sanitizeTitle(e.title)||"Untitled Task",s=this.plugin.app.workspace.getActiveFile(),i=s?this.plugin.app.fileManager.generateMarkdownLink(s,s.path):"",a=this.sanitizeDate(e.dueDate),o=this.sanitizeDate(e.scheduledDate),l=((W=e.dueTime)==null?void 0:W.trim())||void 0,c=((j=e.scheduledTime)==null?void 0:j.trim())||void 0,d,u,h,f,p=[],m=[this.plugin.settings.taskTag],g,y,T=e.tags||[],w=e.contexts||[],b=e.projects||[];if(this.plugin.settings.useDefaultsOnInstantConvert){let R=this.plugin.settings.taskCreationDefaults;if(d=(e.priority?this.sanitizePriority(e.priority):"")||this.plugin.settings.defaultTaskPriority,u=(e.status?this.sanitizeStatus(e.status):"")||this.plugin.settings.defaultTaskStatus,a?h=l?Fr(a,l):a:R.defaultDueDate!=="none"&&(h=Bs(R.defaultDueDate)),o?f=c?Fr(o,c):o:R.defaultScheduledDate!=="none"&&(f=Bs(R.defaultScheduledDate)),p=[],w.length>0&&p.push(...w),R.defaultContexts){let O=R.defaultContexts.split(",").map(C=>C.trim()).filter(C=>C);p.push(...O)}if(p=[...new Set(p)],m=[this.plugin.settings.taskTag],T.length>0&&m.push(...T),R.defaultTags){let O=R.defaultTags.split(",").map(C=>C.trim()).filter(C=>C);m.push(...O)}m=[...new Set(m)],R.defaultTimeEstimate&&R.defaultTimeEstimate>0&&(g=R.defaultTimeEstimate),R.defaultRecurrence&&R.defaultRecurrence!=="none"&&(y={frequency:R.defaultRecurrence})}else d=(e.priority?this.sanitizePriority(e.priority):"")||"none",u=(e.status?this.sanitizeStatus(e.status):"")||"none",h=a?l?Fr(a,l):a:void 0,f=o?c?Fr(o,c):o:void 0,p=[],w.length>0&&p.push(...w),m=[this.plugin.settings.taskTag],T.length>0&&m.push(...T),m=[...new Set(m)];let S=[];if(this.plugin.settings.useDefaultsOnInstantConvert){let R=this.plugin.settings.taskCreationDefaults;if(R.defaultProjects){let O=un(R.defaultProjects);S.push(...O)}R.useParentNoteAsProject&&s&&S.push(i)}b.length>0&&S.push(...b);let k=[...new Set(S)],D;if(this.plugin.settings.useDefaultsOnInstantConvert){let R=this.plugin.settings.taskCreationDefaults;if(R.defaultReminders&&R.defaultReminders.length>0){let{convertDefaultRemindersToReminders:O}=await Promise.resolve().then(()=>(Yf(),Vf));D=O(R.defaultReminders)}}let M={title:r,status:u,priority:d,due:h,scheduled:f,contexts:p.length>0?p:void 0,projects:k.length>0?k:void 0,tags:m,timeEstimate:g,recurrence:y,reminders:D,details:t,parentNote:i,creationContext:"inline-conversion",dateCreated:Le(),dateModified:Le()},{file:_}=await this.plugin.taskService.createTask(M);return _}sanitizeTitle(e){return e?e.trim().substring(0,200):""}sanitizePriority(e){return this.priorityManager.getAllPriorities().map(r=>r&&typeof r=="object"?r.value:r).filter(r=>r!=null).includes(e)?e:""}sanitizeStatus(e){return this.statusManager.getAllStatuses().map(r=>r&&typeof r=="object"?r.value:r).filter(r=>r!=null).includes(e)?e:""}sanitizeDate(e){return!e||!this.isValidDateFormat(e)?"":e}async replaceOriginalTaskLines(e,t,r,s){var i;try{if(!e||!r)return{success:!1,error:"Invalid editor or file reference."};let{startLine:a,endLine:o,originalContent:l}=t,c=e.lineCount();if(a<0||o>=c)return{success:!1,error:`Line range ${a}-${o} is no longer valid (current line count: ${c}).`};for(let b=0;b<l.length;b++)if(e.getLine(a+b)!==l[b])return{success:!1,error:"Content has changed since parsing. Please try again."};let d=jr.parseTaskLine(l[0]),u=d.isTaskLine;if(u&&!d.isTaskLine)return{success:!1,error:"First line is no longer a valid task."};if(!u&&!this.extractLineContentAsTitle(l[0]).trim())return{success:!1,error:"First line no longer contains valid content."};let h=((i=l[0].match(/^(\s*)/))==null?void 0:i[1])||"",f="";if(u){let b=l[0].match(/^\s*((?:[-*+]|\d+\.)\s+)\[/);f=(b==null?void 0:b[1])||"- "}else{let b=l[0].match(/^\s*([-*+]\s+)/),S=l[0].match(/^\s*(\d+\.\s+)/),k=l[0].match(/^\s*(>\s*)/);b?f=b[1]:S?f=S[1]:k?f=k[1]:f="- "}let p=this.plugin.app.workspace.getActiveFile(),m=(p==null?void 0:p.path)||"",g=this.plugin.app.fileManager.generateMarkdownLink(r,m),y=`${h}${f}${g}`;if(y.length>500)return{success:!1,error:"Generated link text is too long."};let T={line:a,ch:0},w={line:o,ch:e.getLine(o).length};return e.replaceRange(y,T,w),{success:!0}}catch(a){return console.error("Error replacing task lines:",a),{success:!1,error:`Failed to replace lines: ${a.message}`}}}async refreshTaskLinkOverlays(e,t){try{await this.forceMetadataCacheUpdate(t),setTimeout(()=>{try{let r=e.cm;if(r){let s=e.getCursor();Fa(r,t.path),setTimeout(()=>{try{e.setCursor(s)}catch(i){console.debug("Error restoring cursor position:",i)}},10)}}catch(r){console.debug("Error dispatching task update for overlays:",r)}},100)}catch(r){console.debug("Error refreshing task link overlays:",r)}}async forceMetadataCacheUpdate(e){try{await this.plugin.app.vault.cachedRead(e),this.plugin.app.metadataCache.getFileCache(e)===null&&setTimeout(async()=>{try{await this.plugin.app.vault.cachedRead(e)}catch(t){console.debug("Error in delayed cache update:",t)}},10)}catch(t){console.debug("Error forcing metadata cache update:",t)}}hasUsefulMetadata(e){return!!(e.dueDate||e.scheduledDate||e.startDate||e.priority||e.status||e.recurrence||e.createdDate||e.doneDate||e.tags&&e.tags.length>0||e.projects&&e.projects.length>0)}tryNLPFallback(e,t){var r;try{let s=this.extractTaskContent(e);if(!s.trim())return null;let i=t.trim().length>0?`${s}
${t}`:s,a=this.nlParser.parseInput(i);return(r=a.title)!=null&&r.trim()?{title:a.title.trim(),isCompleted:a.isCompleted||!1,status:a.status,priority:a.priority,dueDate:a.dueDate,scheduledDate:a.scheduledDate,dueTime:a.dueTime,scheduledTime:a.scheduledTime,recurrence:a.recurrence,tags:a.tags&&a.tags.length>0?a.tags:void 0,projects:a.projects&&a.projects.length>0?this.resolveProjectLinks(a.projects):void 0,contexts:a.contexts&&a.contexts.length>0?a.contexts:void 0,startDate:void 0,createdDate:void 0,doneDate:void 0,recurrenceData:void 0}:null}catch(s){return console.debug("NLP fallback parsing failed:",s),null}}resolveProjectLinks(e){var t,r,s;try{if(!((r=(t=this.plugin.app)==null?void 0:t.workspace)!=null&&r.getActiveFile)||!((s=this.plugin.app)!=null&&s.metadataCache))return e;let i=this.plugin.app.workspace.getActiveFile(),a=(i==null?void 0:i.path)||"";return e.map(o=>{let l=o.match(/^\[\[([^\]]+)\]\]$/);if(l){let c=l[1],d=c;c.includes("|")&&(d=c.split("|")[0]);try{let u=this.plugin.app.metadataCache.getFirstLinkpathDest(d,a);if(u)return`[[${this.plugin.app.metadataCache.fileToLinktext(u,a,!0)}]]`}catch(u){console.debug("Error resolving project link:",u)}return o}return o})}catch(i){return console.debug("Error in resolveProjectLinks:",i),e}}extractTaskContent(e){return e.replace(/^\s*(?:[-*+]|\d+\.)\s*\[[ xX]\]\s*/,"").trim()}extractLineContentAsTitle(e){let t=e.trim();for(t=t.replace(/^\s*[-*+]\s+/,""),t=t.replace(/^\s*\d+\.\s+/,"");t.match(/^\s*>\s*/);)t=t.replace(/^\s*>\s*/,"");return t=t.replace(/^\s*#+\s+/,""),t.match(/^\s*(-{3,}|={3,})\s*$/)?"":t.trim()}findAllCheckboxTasks(e){let t=[],r=e.lineCount();for(let s=0;s<r;s++){let i=e.getLine(s);if(jr.parseTaskLine(i).isTaskLine){t.push({lineNumber:s,line:i});continue}if(i.trim().includes("[ ]")||i.trim().includes("[x]")||i.trim().includes("[X]")){let o=i.trim();for(;o.match(/^\s*>\s*/);)o=o.replace(/^\s*>\s*/,"");jr.parseTaskLine(o).isTaskLine&&t.push({lineNumber:s,line:i})}}return t}async parseTaskForBatch(e){try{let t=jr.parseTaskLine(e);if(t.isTaskLine){if(t.error||!t.parsedData)return null;if(!this.hasUsefulMetadata(t.parsedData)&&this.plugin.settings.enableNaturalLanguageInput){let s=this.tryNLPFallback(e,"");if(s)return s}return t.parsedData}else{let r=this.extractLineContentAsTitle(e);if(!r.trim())return null;if(this.plugin.settings.enableNaturalLanguageInput){let s=this.tryNLPFallback(r,"");if(s)return s}return{title:r,isCompleted:!1}}}catch(t){return console.warn("Error parsing task for batch:",t),null}}generateLinkText(e,t){var d;let r=((d=e.match(/^(\s*)/))==null?void 0:d[1])||"",i=jr.parseTaskLine(e).isTaskLine,a="";if(i){let u=e.match(/^\s*((?:[-*+]|\d+\.)\s+)\[/);a=(u==null?void 0:u[1])||"- "}else{let u=e.match(/^\s*([-*+]\s+)/),h=e.match(/^\s*(\d+\.\s+)/),f=e.match(/^\s*(>\s*)/);u?a=u[1]:h?a=h[1]:f?a=f[1]:a="- "}let o=this.plugin.app.workspace.getActiveFile(),l=(o==null?void 0:o.path)||"",c=this.plugin.app.fileManager.generateMarkdownLink(t,l);return`${r}${a}${c}`}replaceAllTaskLines(e,t){let r=t.sort((s,i)=>i.lineNumber-s.lineNumber);for(let s of r){let i=e.getLine(s.lineNumber).length;e.replaceRange(s.linkText,{line:s.lineNumber,ch:0},{line:s.lineNumber,ch:i})}}}});var SH={};nt(SH,{createInstantConvertButtons:()=>p4,createInstantConvertField:()=>EH});function EH(n){return hv.StateField.define({create(){return an.Decoration.none},update(e,t){if(!n||!t)return an.Decoration.none;if(!n.settings||!n.settings.enableInstantTaskConvert)return an.Decoration.none;if(!t.state)return console.warn("Invalid transaction state in instant convert field update"),an.Decoration.none;try{return!t.docChanged&&e!==an.Decoration.none?e.map(t.changes):f4(t.state,n)}catch(r){return console.error("Error updating instant convert decorations:",r),an.Decoration.none}},provide(e){return an.EditorView.decorations.from(e)}})}function f4(n,e){let t=new hv.RangeSetBuilder,r=n.doc;if(!r||!e)return console.warn("Invalid state or plugin for building convert button decorations"),t.finish();if(typeof r.lines!="number"||r.lines<0)return console.warn("Invalid document lines count:",r.lines),t.finish();for(let s=0;s<r.lines;s++)try{let i=r.line(s+1);if(!i||typeof i.text!="string")continue;let a=i.text;if(a.length>1e3)continue;let o=jr.parseTaskLine(a);if(o.isTaskLine&&o.parsedData){if(!o.parsedData.title||o.parsedData.title.trim().length===0||typeof i.to!="number"||i.to<0)continue;let l=new WS(e,s),c=an.Decoration.widget({widget:l,side:1});t.add(i.to,i.to,c)}}catch(i){console.debug("Error processing line",s,":",i);continue}return t.finish()}function p4(n){return EH(n)}var hv,an,Xc,WS,DH=v(()=>{hv=require("@codemirror/state"),an=require("@codemirror/view"),Xc=require("obsidian");HS();WS=class n extends an.WidgetType{constructor(e,t){super(),this.plugin=e,this.lineNumber=t}toDOM(e){let t=document.createElement("span");t.className="tasknotes-plugin";let r=t.createEl("button",{cls:"instant-convert-button",attr:{"aria-label":"Convert to TaskNote"}});(0,Xc.setTooltip)(r,"Convert to TaskNote",{placement:"top"});let s=r.createEl("span",{cls:"instant-convert-button__icon"});return(0,Xc.setIcon)(s,"file-plus"),r.addEventListener("mousedown",async i=>{i.preventDefault(),i.stopPropagation();try{if(!this.validateButtonClick())return;let a=this.plugin.app.workspace.getActiveViewOfType(Xc.MarkdownView);if(!a){console.warn("No active markdown view available for task conversion");return}let o=a.editor;if(!this.validateEditorState(o))return;this.plugin.instantTaskConvertService&&o&&await this.plugin.instantTaskConvertService.instantConvertTask(o,this.lineNumber)}catch(a){console.error("Error in convert button click handler:",a)}}),t}eq(e){return e instanceof n&&e.plugin===this.plugin&&e.lineNumber===this.lineNumber}get estimatedHeight(){return-1}ignoreEvent(){return!1}validateButtonClick(){return this.plugin?this.plugin.settings.enableInstantTaskConvert?typeof this.lineNumber!="number"||this.lineNumber<0?(console.warn("Invalid line number for task conversion:",this.lineNumber),!1):!0:(console.warn("Instant task conversion is disabled"),!1):(console.warn("Plugin not available for task conversion"),!1)}validateEditorState(e){if(!e)return console.warn("Editor not available for task conversion"),!1;let t=e.lineCount();if(this.lineNumber>=t)return console.warn(`Line number ${this.lineNumber} is out of bounds (total lines: ${t})`),!1;try{let r=e.getLine(this.lineNumber);return r?jr.parseTaskLine(r).isTaskLine?!0:(console.warn(`Line ${this.lineNumber} is no longer a task`),!1):(console.warn(`Cannot read line ${this.lineNumber}`),!1)}catch(r){return console.warn("Error validating line content:",r),!1}}}});var CH={};nt(CH,{DueDateModal:()=>$S});var lp,$S,xH=v(()=>{lp=require("obsidian");At();Fe();$S=class extends lp.Modal{constructor(e,t,r){super(e),this.task=t,this.plugin=r}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-plugin"),this.titleEl.setText("Set due date"),this.titleEl.setAttribute("id","due-date-modal-title"),this.containerEl.setAttribute("aria-labelledby","due-date-modal-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),e.createEl("p",{text:`Task: ${this.task.title}`,cls:"due-date-modal__task-title"});let r=new lp.Setting(e).setName("Due date & time").setDesc("Enter due date and optional time (leave time empty for date-only)").controlEl.createDiv({cls:"modal-form__datetime-container"});this.dueDateInput=r.createEl("input",{type:"date",cls:"modal-form__input modal-form__input--date",attr:{"aria-label":"Due date for task",placeholder:"YYYY-MM-DD"}}),this.dueDateInput.value=ve(this.task.due||""),this.dueTimeInput=r.createEl("input",{type:"time",cls:"modal-form__input modal-form__input--time",attr:{"aria-label":"Due time for task (optional)",placeholder:"HH:MM"}}),this.dueTimeInput.value=Er(this.task.due||"")||"",this.dueDateInput.addEventListener("keydown",p=>{p.key==="Enter"?this.save():p.key==="Escape"&&this.close()}),this.dueTimeInput.addEventListener("keydown",p=>{p.key==="Enter"?this.save():p.key==="Escape"&&this.close()}),setTimeout(()=>this.dueDateInput.focus(),100);let s=e.createDiv({cls:"modal-form__group"});new lp.Setting(s).setName("Quick options").setHeading();let i=s.createDiv({cls:"modal-form__quick-actions"});i.createEl("button",{text:"Today",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to today"}}).addEventListener("click",()=>{this.dueDateInput.value=x(new Date,"yyyy-MM-dd")}),i.createEl("button",{text:"Tomorrow",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to tomorrow"}}).addEventListener("click",()=>{this.dueDateInput.value=x(hl(new Date,{days:1}),"yyyy-MM-dd")}),i.createEl("button",{text:"Next week",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date to next week"}}).addEventListener("click",()=>{this.dueDateInput.value=x(hl(new Date,{weeks:1}),"yyyy-MM-dd")}),i.createEl("button",{text:"Now",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set due date and time to now"}}).addEventListener("click",()=>{let p=new Date;this.dueDateInput.value=x(p,"yyyy-MM-dd"),this.dueTimeInput.value=x(p,"HH:mm")}),i.createEl("button",{text:"Clear",cls:"modal-form__button modal-form__button--quick-date modal-form__button--quick-date--clear",attr:{"aria-label":"Clear due date"}}).addEventListener("click",()=>{this.dueDateInput.value="",this.dueTimeInput.value=""});let u=e.createDiv({cls:"modal-form__buttons"});u.createEl("button",{text:"Save",cls:"modal-form__button modal-form__button--primary"}).addEventListener("click",()=>this.save()),u.createEl("button",{text:"Cancel",cls:"modal-form__button modal-form__button--secondary"}).addEventListener("click",()=>this.close())}async save(){let e=this.dueDateInput.value.trim(),t=this.dueTimeInput.value.trim(),r;if(e?t?r=Fr(e,t):r=e:r=void 0,!Yp(e,t)){let s=this.contentEl.createEl("div",{text:"Please enter a valid date and time format",cls:"modal-form__error",attr:{role:"alert","aria-live":"assertive"}});this.dueDateInput.setAttribute("aria-invalid","true"),this.dueDateInput.setAttribute("aria-describedby","due-date-error"),s.setAttribute("id","due-date-error"),setTimeout(()=>{s.remove(),this.dueDateInput.removeAttribute("aria-invalid"),this.dueDateInput.removeAttribute("aria-describedby")},3e3);return}try{await this.plugin.taskService.updateProperty(this.task,"due",r),this.close()}catch(s){console.error("Failed to update due date:",s);let i=this.contentEl.createEl("div",{text:"Failed to update due date. Please try again.",cls:"modal-form__error"});setTimeout(()=>i.remove(),3e3)}}onClose(){let{contentEl:e}=this;e.empty()}}});var MH={};nt(MH,{ScheduledDateModal:()=>jS});var cp,jS,_H=v(()=>{cp=require("obsidian");At();Fe();jS=class extends cp.Modal{constructor(e,t,r){super(e),this.task=t,this.plugin=r}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-plugin"),this.titleEl.setText("Set scheduled date"),this.titleEl.setAttribute("id","scheduled-date-modal-title"),this.containerEl.setAttribute("aria-labelledby","scheduled-date-modal-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),e.createEl("p",{text:`Task: ${this.task.title}`,cls:"scheduled-date-modal__task-title"});let r=new cp.Setting(e).setName("Scheduled Date & Time").setDesc("Enter scheduled date and optional time (leave time empty for date-only)").controlEl.createDiv({cls:"modal-form__datetime-container"});this.scheduledDateInput=r.createEl("input",{type:"date",cls:"modal-form__input modal-form__input--date",attr:{"aria-label":"Scheduled date for task",placeholder:"YYYY-MM-DD"}}),this.scheduledDateInput.value=ve(this.task.scheduled||""),this.scheduledTimeInput=r.createEl("input",{type:"time",cls:"modal-form__input modal-form__input--time",attr:{"aria-label":"Scheduled time for task (optional)",placeholder:"HH:MM"}}),this.scheduledTimeInput.value=Er(this.task.scheduled||"")||"",this.scheduledDateInput.addEventListener("keydown",p=>{p.key==="Enter"?this.save():p.key==="Escape"&&this.close()}),this.scheduledTimeInput.addEventListener("keydown",p=>{p.key==="Enter"?this.save():p.key==="Escape"&&this.close()}),window.setTimeout(()=>this.scheduledDateInput.focus(),100);let s=e.createDiv({cls:"modal-form__group"});new cp.Setting(s).setName("Quick options").setHeading();let i=s.createDiv({cls:"modal-form__quick-actions"});i.createEl("button",{text:"Today",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to today"}}).addEventListener("click",()=>{this.scheduledDateInput.value=x(new Date,"yyyy-MM-dd")}),i.createEl("button",{text:"Tomorrow",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to tomorrow"}}).addEventListener("click",()=>{this.scheduledDateInput.value=x(hl(new Date,{days:1}),"yyyy-MM-dd")}),i.createEl("button",{text:"Next week",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date to next week"}}).addEventListener("click",()=>{this.scheduledDateInput.value=x(hl(new Date,{weeks:1}),"yyyy-MM-dd")}),i.createEl("button",{text:"Now",cls:"modal-form__button modal-form__button--quick-date",attr:{"aria-label":"Set scheduled date and time to now"}}).addEventListener("click",()=>{let p=new Date;this.scheduledDateInput.value=x(p,"yyyy-MM-dd"),this.scheduledTimeInput.value=x(p,"HH:mm")}),i.createEl("button",{text:"Clear",cls:"modal-form__button modal-form__button--quick-date modal-form__button--quick-date--clear",attr:{"aria-label":"Clear scheduled date"}}).addEventListener("click",()=>{this.scheduledDateInput.value="",this.scheduledTimeInput.value=""});let u=e.createDiv({cls:"modal-form__buttons"});u.createEl("button",{text:"Save",cls:"modal-form__button modal-form__button--primary"}).addEventListener("click",()=>this.save()),u.createEl("button",{text:"Cancel",cls:"modal-form__button modal-form__button--secondary"}).addEventListener("click",()=>this.close())}async save(){let e=this.scheduledDateInput.value.trim(),t=this.scheduledTimeInput.value.trim(),r;if(e?t?r=Fr(e,t):r=e:r=void 0,!Yp(e,t)){let s=this.contentEl.createEl("div",{text:"Please enter a valid date and time format",cls:"modal-form__error",attr:{role:"alert","aria-live":"assertive"}});this.scheduledDateInput.setAttribute("aria-invalid","true"),this.scheduledDateInput.setAttribute("aria-describedby","scheduled-date-error"),s.setAttribute("id","scheduled-date-error"),window.setTimeout(()=>{s.remove(),this.scheduledDateInput.removeAttribute("aria-invalid"),this.scheduledDateInput.removeAttribute("aria-describedby")},3e3);return}try{await this.plugin.taskService.updateProperty(this.task,"scheduled",r),this.close()}catch(s){console.error("Failed to update scheduled date:",s);let i=this.contentEl.createEl("div",{text:"Failed to update scheduled date. Please try again.",cls:"modal-form__error"});window.setTimeout(()=>i.remove(),3e3)}}onClose(){let{contentEl:e}=this;e.empty()}}});var AH={};nt(AH,{TaskActionPaletteModal:()=>VS});var tr,VS,PH=v(()=>{tr=require("obsidian"),VS=class extends tr.FuzzySuggestModal{constructor(e,t,r,s){super(e),this.task=t,this.plugin=r,this.targetDate=s,this.actions=this.buildActionsList(),this.setPlaceholder("Type to search for an action..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to execute"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText(`Quick actions: ${t.title}`),this.titleEl.setAttribute("id","task-action-palette-title"),this.containerEl.setAttribute("aria-labelledby","task-action-palette-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),this.containerEl.addClass("task-action-palette-modal")}buildActionsList(){let e=[];(this.task.recurrence?this.plugin.statusManager.getNonCompletionStatuses():this.plugin.statusManager.getAllStatuses()).forEach(s=>{let i=this.task.status===s.value;e.push({id:`status-${s.value}`,title:`Change status to "${s.label}"`,description:`Set task status to ${s.label}`,icon:i?"check":"circle",category:"status",keywords:["status",s.value,s.label,"change","set"],isApplicable:()=>!i,execute:async a=>{await this.plugin.updateTaskProperty(a,"status",s.value),new tr.Notice(`Status changed to ${s.label}`)}})}),this.plugin.priorityManager.getAllPriorities().forEach(s=>{let i=this.task.priority===s.value;e.push({id:`priority-${s.value}`,title:`Set priority to "${s.label}"`,description:`Change task priority to ${s.label}`,icon:i?"check":"flag",category:"priority",keywords:["priority",s.value,s.label,"change","set"],isApplicable:()=>!i,execute:async a=>{await this.plugin.updateTaskProperty(a,"priority",s.value),new tr.Notice(`Priority changed to ${s.label}`)}})}),e.push({id:"set-due-date",title:"Set due date",description:"Set or change the task due date",icon:"calendar",category:"dates",keywords:["due","date","deadline","set","change"],isApplicable:()=>!0,execute:async s=>{this.plugin.openDueDateModal(s)}},{id:"set-scheduled-date",title:"Set scheduled date",description:"Set or change when the task is scheduled",icon:"calendar-clock",category:"dates",keywords:["scheduled","date","schedule","set","change"],isApplicable:()=>!0,execute:async s=>{this.plugin.openScheduledDateModal(s)}},{id:"clear-due-date",title:"Clear due date",description:"Remove the due date from this task",icon:"calendar-x",category:"dates",keywords:["clear","remove","due","date"],isApplicable:s=>!!s.due,execute:async s=>{await this.plugin.updateTaskProperty(s,"due",void 0),new tr.Notice("Due date cleared")}},{id:"clear-scheduled-date",title:"Clear scheduled date",description:"Remove the scheduled date from this task",icon:"calendar-x",category:"dates",keywords:["clear","remove","scheduled","date"],isApplicable:s=>!!s.scheduled,execute:async s=>{await this.plugin.updateTaskProperty(s,"scheduled",void 0),new tr.Notice("Scheduled date cleared")}});let r=this.plugin.getActiveTimeSession(this.task);return e.push({id:"toggle-time-tracking",title:r?"Stop time tracking":"Start time tracking",description:r?"Stop tracking time for this task":"Start tracking time for this task",icon:r?"pause":"play",category:"tracking",keywords:["time","tracking","timer",r?"stop":"start"],isApplicable:()=>!0,execute:async s=>{this.plugin.getActiveTimeSession(s)?(await this.plugin.stopTimeTracking(s),new tr.Notice("Time tracking stopped")):(await this.plugin.startTimeTracking(s),new tr.Notice("Time tracking started"))}}),e.push({id:"toggle-archive",title:this.task.archived?"Unarchive task":"Archive task",description:this.task.archived?"Move task back to active tasks":"Archive this task",icon:this.task.archived?"archive-restore":"archive",category:"organization",keywords:["archive",this.task.archived?"unarchive":"archive","organize"],isApplicable:()=>!0,execute:async s=>{await this.plugin.toggleTaskArchive(s),new tr.Notice(s.archived?"Task unarchived":"Task archived")}}),this.task.recurrence&&e.push({id:"complete-recurring-instance",title:"Complete this occurrence",description:"Mark this specific instance of the recurring task as complete",icon:"check-circle",category:"status",keywords:["complete","done","finish","recurring","instance","occurrence"],isApplicable:(s,i,a)=>!i.statusManager.isCompletedStatus(s.status),execute:async(s,i,a)=>{await i.toggleRecurringTaskComplete(s,a),new tr.Notice("Recurring task instance completed")}}),e.push({id:"edit-task",title:"Edit task details",description:"Open the full task editor",icon:"edit",category:"other",keywords:["edit","modify","details","properties"],isApplicable:()=>!0,execute:async s=>{await this.plugin.openTaskEditModal(s)}},{id:"open-task-file",title:"Open task file",description:"Open the task file in the editor",icon:"file-text",category:"other",keywords:["open","file","editor","edit"],isApplicable:()=>!0,execute:async s=>{let i=this.plugin.app.vault.getAbstractFileByPath(s.path);i&&await this.plugin.app.workspace.getLeaf(!0).openFile(i)}},{id:"copy-task-title",title:"Copy task title",description:"Copy the task title to clipboard",icon:"copy",category:"other",keywords:["copy","clipboard","title"],isApplicable:()=>!0,execute:async s=>{try{await navigator.clipboard.writeText(s.title),new tr.Notice("Task title copied to clipboard")}catch(i){new tr.Notice("Failed to copy to clipboard")}}},{id:"copy-task-link",title:"Copy task link",description:"Copy a wikilink to this task",icon:"link",category:"other",keywords:["copy","link","wikilink","reference"],isApplicable:()=>!0,execute:async s=>{try{let i=this.plugin.app.vault.getAbstractFileByPath(s.path);if(i){let a=this.plugin.app.metadataCache.fileToLinktext(i,"");await navigator.clipboard.writeText(`[[${a}]]`),new tr.Notice("Task link copied to clipboard")}}catch(i){new tr.Notice("Failed to copy to clipboard")}}},{id:"delete-task",title:"Delete task",description:"Permanently delete this task",icon:"trash",category:"other",keywords:["delete","remove","trash"],isApplicable:()=>!0,execute:async s=>{this.close();let{showDeleteConfirmationModal:i}=await Promise.resolve().then(()=>(Sn(),wy));await i(s,this.plugin)}}),e}getItems(){return this.actions.filter(e=>e.isApplicable(this.task,this.plugin,this.targetDate)).sort((e,t)=>{var a,o;let r={status:0,priority:1,dates:2,tracking:3,organization:4,other:5},s=(a=r[e.category])!=null?a:999,i=(o=r[t.category])!=null?o:999;return s!==i?s-i:e.title.localeCompare(t.title)})}getItemText(e){return[e.title,e.description,e.category,...e.keywords].join(" ")}renderSuggestion(e,t){let r=e.item,s=t.createDiv({cls:"task-action-palette__suggestion"}),i=s.createDiv({cls:"task-action-palette__icon"});(0,tr.setIcon)(i,r.icon);let a=s.createDiv({cls:"task-action-palette__content"});a.createDiv({cls:"task-action-palette__title",text:r.title}),a.createDiv({cls:"task-action-palette__description",text:r.description}),s.createDiv({cls:"task-action-palette__badge"}).createSpan({cls:`task-action-palette__category task-action-palette__category--${r.category}`,text:r.category})}async onChooseItem(e,t){try{let r=await this.plugin.cacheManager.getTaskInfo(this.task.path);if(!r){new tr.Notice("Task not found");return}await e.execute(r,this.plugin,this.targetDate)}catch(r){let s=r instanceof Error?r.message:String(r);console.error("Error executing action:",{error:s,actionId:e.id,taskPath:this.task.path}),new tr.Notice(`Failed to execute action: ${s}`)}}}});var g4={};nt(g4,{default:()=>m4});module.exports=fp(g4);var ge=require("obsidian");At();var ja=ke(dn());xp();var pd=require("obsidian");var Ka=require("obsidian");function be(n,e){return new Ka.Setting(n).setName(e.name).setDesc(e.desc).addToggle(t=>{t.setValue(e.getValue()).onChange(e.setValue)})}function et(n,e){return new Ka.Setting(n).setName(e.name).setDesc(e.desc).addText(t=>(t.setValue(e.getValue()).onChange(e.setValue),e.placeholder&&t.setPlaceholder(e.placeholder),e.ariaLabel&&t.inputEl.setAttribute("aria-label",e.ariaLabel),t.inputEl.addClass("settings-view__input"),t))}function gt(n,e){return new Ka.Setting(n).setName(e.name).setDesc(e.desc).addDropdown(t=>(e.options.forEach(r=>{t.addOption(r.value,r.label)}),t.setValue(e.getValue()).onChange(e.setValue),e.ariaLabel&&t.selectEl.setAttribute("aria-label",e.ariaLabel),t))}function zr(n,e){return new Ka.Setting(n).setName(e.name).setDesc(e.desc).addText(t=>(t.setValue(e.getValue().toString()).onChange(r=>{let s=parseInt(r);if(!isNaN(s)){if(e.min!==void 0&&s<e.min||e.max!==void 0&&s>e.max)return;e.setValue(s)}}),t.inputEl.type="number",e.placeholder&&t.setPlaceholder(e.placeholder),e.min!==void 0&&t.inputEl.setAttribute("min",e.min.toString()),e.max!==void 0&&t.inputEl.setAttribute("max",e.max.toString()),e.ariaLabel&&t.inputEl.setAttribute("aria-label",e.ariaLabel),t.inputEl.addClass("settings-view__input"),t))}function Za(n,e){return new Ka.Setting(n).setName(e.name).setDesc(e.desc).addButton(t=>(t.setButtonText(e.buttonText).onClick(e.onClick),e.buttonClass?t.buttonEl.addClass(e.buttonClass):t.buttonEl.addClasses(["tn-btn","tn-btn--ghost"]),t))}function Ce(n,e){return new Ka.Setting(n).setName(e).setHeading()}function xe(n,e){return n.createEl("p",{text:e,cls:"settings-view__help-note"})}function Yv(n,e){return n.createEl("p",{text:e,cls:"settings-validation-note"})}function T_(n,e,t=!1){let r;return function(...s){let i=()=>{r=void 0,t||n.apply(this,s)},a=t&&!r;clearTimeout(r),r=setTimeout(i,e),a&&n.apply(this,s)}}function fd(n,e,t){n.empty(),Ce(n,"Task Storage"),xe(n,"Configure where tasks are stored and how they are identified."),et(n,{name:"Default tasks folder",desc:"Default location for new tasks",placeholder:"TaskNotes",getValue:()=>e.settings.tasksFolder,setValue:async r=>{e.settings.tasksFolder=r,t()},ariaLabel:"Default folder path for new tasks"}),be(n,{name:"Move archived tasks to folder",desc:"Automatically move archived tasks to an archive folder",getValue:()=>e.settings.moveArchivedTasks,setValue:async r=>{e.settings.moveArchivedTasks=r,t(),fd(n,e,t)}}),e.settings.moveArchivedTasks&&et(n,{name:"Archive folder",desc:"Folder to move tasks to when archived",placeholder:"TaskNotes/Archive",getValue:()=>e.settings.archiveFolder,setValue:async r=>{e.settings.archiveFolder=r,t()},ariaLabel:"Archive folder path"}),Ce(n,"Task Identification"),xe(n,"Choose how TaskNotes identifies notes as tasks."),gt(n,{name:"Identify tasks by",desc:"Choose whether to identify tasks by tag or by a frontmatter property",options:[{value:"tag",label:"Tag"},{value:"property",label:"Property"}],getValue:()=>e.settings.taskIdentificationMethod,setValue:async r=>{e.settings.taskIdentificationMethod=r,t(),fd(n,e,t)},ariaLabel:"Task identification method"}),e.settings.taskIdentificationMethod==="tag"?et(n,{name:"Task tag",desc:"Tag that identifies notes as tasks (without #)",placeholder:"task",getValue:()=>e.settings.taskTag,setValue:async r=>{e.settings.taskTag=r,t()},ariaLabel:"Task identification tag"}):(et(n,{name:"Task property name",desc:'The frontmatter property name (e.g., "category")',placeholder:"category",getValue:()=>e.settings.taskPropertyName,setValue:async r=>{e.settings.taskPropertyName=r,t()}}),et(n,{name:"Task property value",desc:'The value that identifies a note as a task (e.g., "task")',placeholder:"task",getValue:()=>e.settings.taskPropertyValue,setValue:async r=>{e.settings.taskPropertyValue=r,t()}})),Ce(n,"Folder Management"),et(n,{name:"Excluded folders",desc:"Comma-separated list of folders to exclude from Notes tab",placeholder:"Templates, Archive",getValue:()=>e.settings.excludedFolders,setValue:async r=>{e.settings.excludedFolders=r,t()},ariaLabel:"Excluded folder paths"}),Ce(n,"Task Interaction"),xe(n,"Configure how clicking on tasks behaves."),gt(n,{name:"Single-click action",desc:"Action performed when single-clicking a task card",options:[{value:"edit",label:"Edit task"},{value:"openNote",label:"Open note"}],getValue:()=>e.settings.singleClickAction,setValue:async r=>{e.settings.singleClickAction=r,t()}}),gt(n,{name:"Double-click action",desc:"Action performed when double-clicking a task card",options:[{value:"edit",label:"Edit task"},{value:"openNote",label:"Open note"},{value:"none",label:"No action"}],getValue:()=>e.settings.doubleClickAction,setValue:async r=>{e.settings.doubleClickAction=r,t()}})}var di=require("obsidian");var zv=require("obsidian");function Pn(n,e){let t=n.createDiv("tasknotes-settings__card");e.id&&t.setAttribute("data-card-id",e.id),e.draggable&&t.addClass("tasknotes-settings__card--draggable"),e.collapsible&&(t.addClass("tasknotes-settings__card--collapsible"),e.defaultCollapsed&&t.addClass("tasknotes-settings__card--collapsed"));let r=t.createDiv("tasknotes-settings__card-header"),s=null;e.draggable&&(r.addClass("tasknotes-settings__card-header--with-drag-handle"),s=r.createDiv("tasknotes-settings__card-drag-handle"),s.textContent="\u22EE\u22EE",s.draggable=!0,s.title="Drag to reorder");let i=r.createDiv();if(i.style.display="flex",i.style.alignItems="center",i.style.flex="1",i.style.minWidth="0",e.colorIndicator){let c=i.createDiv("tasknotes-settings__card-color-indicator");c.style.backgroundColor=e.colorIndicator.color,e.colorIndicator.cssVar&&c.style.setProperty("--card-color",e.colorIndicator.color)}let a=i.createDiv("tasknotes-settings__card-info"),o=a.createSpan("tasknotes-settings__card-primary-text");if(o.textContent=e.header.primaryText,e.header.secondaryText){let c=a.createSpan("tasknotes-settings__card-secondary-text");c.textContent=e.header.secondaryText}let l=r.createDiv();if(l.style.display="flex",l.style.alignItems="center",l.style.gap="0.5rem",e.header.meta&&e.header.meta.length>0){let c=l.createDiv("tasknotes-settings__card-meta");e.header.meta.forEach(d=>{c.appendChild(d)})}if(e.header.actions&&e.header.actions.length>0){let c=l.querySelector(".tasknotes-settings__card-header-actions")||l.createDiv("tasknotes-settings__card-header-actions");e.header.actions.forEach(d=>{let u=c.createEl("button",{cls:"tasknotes-settings__card-header-btn"});d.variant==="delete"&&u.addClass("tasknotes-settings__card-header-btn--delete");let h=u.createSpan();(0,zv.setIcon)(h,d.icon),d.tooltip&&(u.title=d.tooltip),u.onclick=f=>{f.stopPropagation(),d.onClick()}})}if(e.collapsible){let c=()=>{t.hasClass("tasknotes-settings__card--collapsed")?(t.removeClass("tasknotes-settings__card--collapsed"),r.title="Collapse card"):(t.addClass("tasknotes-settings__card--collapsed"),r.title="Expand card")};r.addClass("tasknotes-settings__card-header--clickable"),r.title=e.defaultCollapsed?"Expand card":"Collapse card",r.onclick=d=>{d.target.closest(".tasknotes-settings__card-header-actions")||c()}}if(e.content&&e.content.sections.length>0){let c=t.createDiv("tasknotes-settings__card-content");e.draggable&&c.addClass("tasknotes-settings__card-content--with-drag-handle"),e.content.sections.forEach(d=>{d.rows.forEach(u=>{let h=c.createDiv("tasknotes-settings__card-config-row");u.fullWidth&&(h.style.flexDirection="column",h.style.alignItems="flex-start",h.style.gap="0.5rem");let f=h.createSpan("tasknotes-settings__card-config-label");f.textContent=u.label,h.appendChild(u.input)})})}if(e.actions&&e.actions.buttons.length>0){let c=t.createDiv("tasknotes-settings__card-actions");e.draggable&&c.addClass("tasknotes-settings__card-actions--with-drag-handle"),e.actions.buttons.forEach(d=>{let u=c.createEl("button",{text:d.text,cls:"tasknotes-settings__card-action-btn"});if(d.variant&&u.addClass(`tasknotes-settings__card-action-btn--${d.variant}`),d.icon){let h=u.createSpan();(0,zv.setIcon)(h,d.icon),u.insertBefore(h,u.firstChild)}d.disabled&&(u.disabled=!0),u.onclick=d.onClick})}return t}function Zi(n,e="default"){let t=document.createElement("span");return t.addClass("tasknotes-settings__card-status-badge"),t.addClass(`tasknotes-settings__card-status-badge--${e}`),t.textContent=n,t}function In(n,e){return{icon:"trash-2",variant:"delete",tooltip:e||"Delete",onClick:n}}function Nt(n="text",e,t){let r=document.createElement("input");return r.type=n,r.addClass("tasknotes-settings__card-input"),e&&(r.placeholder=e),t&&(r.value=t),r}function Ja(n,e){let t=document.createElement("select");return t.addClass("tasknotes-settings__card-input"),n.forEach(r=>{let s=t.createEl("option",{value:r.value,text:r.label});e===r.value&&(s.selected=!0)}),t}function w_(n,e,t){let r=n.querySelector(".tasknotes-settings__card-drag-handle");if(!r)return;let s=n.getAttribute("data-card-id");s&&(r.addEventListener("dragstart",i=>{i.dataTransfer&&(i.dataTransfer.setData("text/plain",s),n.addClass("tasknotes-settings__card--dragging"))}),r.addEventListener("dragend",()=>{n.removeClass("tasknotes-settings__card--dragging")}),n.addEventListener("dragover",i=>{i.preventDefault();let a=e.querySelector(".tasknotes-settings__card--dragging");if(a&&a!==n){let o=n.getBoundingClientRect(),l=o.top+o.height/2;n.removeClass("tasknotes-settings__card--drag-over-top","tasknotes-settings__card--drag-over-bottom"),i.clientY<l?n.addClass("tasknotes-settings__card--drag-over-top"):n.addClass("tasknotes-settings__card--drag-over-bottom")}}),n.addEventListener("dragleave",()=>{n.removeClass("tasknotes-settings__card--drag-over-top","tasknotes-settings__card--drag-over-bottom")}),n.addEventListener("drop",i=>{i.preventDefault(),n.removeClass("tasknotes-settings__card--drag-over-top","tasknotes-settings__card--drag-over-bottom");let a=i.dataTransfer.getData("text/plain"),o=s;if(a!==o){let l=n.getBoundingClientRect(),c=l.top+l.height/2,d=i.clientY<c;t(a,o,d)}}))}function Xa(n,e,t,r){let s=Nt("number");return n!==void 0&&(s.min=n.toString()),e!==void 0&&(s.max=e.toString()),t!==void 0&&(s.step=t.toString()),r!==void 0&&(s.value=r.toString()),s}function Mp(n,e){let t=document.createElement("input");return t.type="url",t.addClass("tasknotes-settings__card-input"),n&&(t.placeholder=n),e&&(t.value=e),t}function bl(n){let e=document.createElement("span");return e.addClass("tasknotes-settings__card-info-badge"),e.textContent=n,e}function Ji(n,e,t,r){n.empty();let s=n.createDiv("tasknotes-settings__empty-state");s.createSpan("tasknotes-settings__empty-icon");let i=s.createSpan({text:e,cls:"tasknotes-settings__empty-text"});if(t&&r){let a=s.createEl("button",{text:t,cls:"tn-btn tn-btn--primary"});a.style.marginTop="1rem",a.onclick=r}}function Ap(n,e,t){n.empty(),Array.isArray(e.settings.userFields)||(e.settings.userFields=[]),Ce(n,"Task Statuses"),xe(n,"Customize the status options available for your tasks. These statuses control the task lifecycle and determine when tasks are considered complete.");let r=n.createDiv("tasknotes-settings__help-section");r.createEl("h4",{text:"How statuses work:"});let s=r.createEl("ul");s.createEl("li",{text:'Value: The internal identifier stored in your task files (e.g., "in-progress")'}),s.createEl("li",{text:'Label: The display name shown in the interface (e.g., "In Progress")'}),s.createEl("li",{text:"Color: Visual indicator color for the status dot and badges"}),s.createEl("li",{text:"Completed: When checked, tasks with this status are considered finished and may be filtered differently"}),s.createEl("li",{text:"Auto-archive: When enabled, tasks will be automatically archived after the specified delay (1-1440 minutes)"}),r.createEl("p",{text:"The order below determines the sequence when cycling through statuses by clicking on task status badges.",cls:"settings-help-note"});let i=n.createDiv("tasknotes-statuses-container");_p(i,e,t),new di.Setting(n).setName("Add new status").setDesc("Create a new status option for your tasks").addButton(u=>u.setButtonText("Add status").onClick(async()=>{let f={id:`status_${Date.now()}`,value:"",label:"",color:"#6366f1",completed:!1,isCompleted:!1,order:e.settings.customStatuses.length,autoArchive:!1,autoArchiveDelay:5};e.settings.customStatuses.push(f),t(),_p(i,e,t)})),Yv(n,'Note: You must have at least 2 statuses, and at least one status must be marked as "Completed".'),Ce(n,"Task Priorities"),xe(n,"Customize the priority levels available for your tasks. Priority weights determine sorting order and visual hierarchy in your task views.");let a=n.createDiv("tasknotes-settings__help-section");a.createEl("h4",{text:"How priorities work:"});let o=a.createEl("ul");o.createEl("li",{text:'Value: The internal identifier stored in your task files (e.g., "high")'}),o.createEl("li",{text:'Display Label: The display name shown in the interface (e.g., "High Priority")'}),o.createEl("li",{text:"Color: Visual indicator color for the priority dot and badges"}),o.createEl("li",{text:"Weight: Numeric value for sorting (higher weights appear first in lists)"}),a.createEl("p",{text:"Tasks are automatically sorted by priority weight in descending order (highest weight first). Weights can be any positive number.",cls:"settings-help-note"});let l=n.createDiv("tasknotes-priorities-container");qv(l,e,t),new di.Setting(n).setName("Add new priority").setDesc("Create a new priority level for your tasks").addButton(u=>u.setButtonText("Add priority").onClick(async()=>{let f={id:`priority_${Date.now()}`,value:"",label:"",color:"#6366f1",weight:1};e.settings.customPriorities.push(f),t(),qv(l,e,t)})),Yv(n,"Note: You must have at least 1 priority. Higher weights take precedence in sorting and visual hierarchy."),Ce(n,"Field Mapping");let c=n.createDiv("tasknotes-settings__warning");if(c.createEl("strong",{text:"\u26A0\uFE0F Warning: "}),c.appendText("TaskNotes will read AND write using these property names. Changing these after creating tasks may cause inconsistencies."),xe(n,"Configure which frontmatter properties TaskNotes should use for each field."),gW(n,e,t),Za(n,{name:"Reset field mappings",desc:"Reset all field mappings to default values",buttonText:"Reset to Defaults",onClick:async()=>{try{let{DEFAULT_FIELD_MAPPING:u}=await Promise.resolve().then(()=>(xp(),v_));e.settings.fieldMapping={...u},t(),Ap(n.parentElement,e,t),new di.Notice("Field mappings reset to defaults")}catch(u){console.error("Error resetting field mappings:",u),new di.Notice("Failed to reset field mappings")}}}),Ce(n,"Custom User Fields"),xe(n,"Define custom frontmatter properties to appear as type-aware filter options across views. Each row: Display Name, Property Name, Type."),e.settings.userField&&e.settings.userField.enabled){let u=e.settings.userField,h=(u.displayName||u.key||"field").toLowerCase().replace(/[^a-z0-9_-]/g,"-");e.settings.userFields.find(f=>f.id===h||f.key===u.key)||(e.settings.userFields.push({id:h,displayName:u.displayName||"",key:u.key||"",type:u.type||"text"}),t())}let d=n.createDiv("tasknotes-user-fields-container");kl(d,e,t),new di.Setting(n).setName("Add new user field").setDesc("Create a new custom field that will appear in filters and views").addButton(u=>u.setButtonText("Add user field").onClick(async()=>{e.settings.userFields||(e.settings.userFields=[]);let f={id:`field_${Date.now()}`,displayName:"",key:"",type:"text"};e.settings.userFields.push(f),t(),kl(d,e,t)}))}function _p(n,e,t){if(n.empty(),!e.settings.customStatuses||e.settings.customStatuses.length===0){Ji(n,"No custom statuses configured. Add a status to get started.","Add Status",()=>{let s=document.querySelector('[data-setting-name="Add new status"] button');s&&s.click()});return}[...e.settings.customStatuses].sort((s,i)=>s.order-i.order).forEach(s=>{let i=Nt("text","in-progress",s.value),a=Nt("text","In Progress",s.label),o=Nt("color","",s.color),l=document.createElement("input");l.type="checkbox",l.checked=s.isCompleted||!1,l.addClass("tasknotes-card-input");let c=document.createElement("input");c.type="checkbox",c.checked=s.autoArchive||!1,c.addClass("tasknotes-card-input");let d=Xa(1,1440,1,s.autoArchiveDelay||5),u=s.isCompleted?[Zi("Completed","completed")]:[],h=()=>{if(confirm(`Are you sure you want to delete the status "${s.label||s.value}"?`)){let y=e.settings.customStatuses.findIndex(T=>T.id===s.id);y!==-1&&(e.settings.customStatuses.splice(y,1),e.settings.customStatuses.forEach((T,w)=>{T.order=w}),t(),_p(n,e,t))}},f={id:s.id,draggable:!0,collapsible:!0,defaultCollapsed:!0,colorIndicator:{color:s.color,cssVar:"--status-color"},header:{primaryText:s.value||"untitled",secondaryText:s.label||"No label",meta:u,actions:[In(h)]},content:{sections:[{rows:[{label:"Value:",input:i},{label:"Label:",input:a},{label:"Color:",input:o},{label:"Completed:",input:l},{label:"Auto-archive:",input:c},{label:"Delay (minutes):",input:d}]}]}},p=Pn(n,f),m=()=>{let g=d.closest(".tasknotes-settings__card-config-row");g&&(g.style.display=s.autoArchive?"flex":"none")};m(),i.addEventListener("change",()=>{s.value=i.value,p.querySelector(".tasknotes-settings__card-primary-text").textContent=s.value||"untitled",t()}),a.addEventListener("change",()=>{s.label=a.value,p.querySelector(".tasknotes-settings__card-secondary-text").textContent=s.label||"No label",t()}),o.addEventListener("change",()=>{s.color=o.value;let g=p.querySelector(".tasknotes-settings__card-color-indicator");g&&(g.style.backgroundColor=s.color),t()}),l.addEventListener("change",()=>{s.isCompleted=l.checked;let g=p.querySelector(".tasknotes-settings__card-meta");g&&(g.empty(),s.isCompleted&&g.appendChild(Zi("Completed","completed"))),t()}),c.addEventListener("change",()=>{s.autoArchive=c.checked,t(),m()}),d.addEventListener("change",()=>{let g=parseInt(d.value);!isNaN(g)&&g>=1&&g<=1440&&(s.autoArchiveDelay=g,t())}),w_(p,n,(g,y,T)=>{let w=e.settings.customStatuses.findIndex(M=>M.id===g),b=e.settings.customStatuses.findIndex(M=>M.id===y);if(w===-1||b===-1)return;let S=[...e.settings.customStatuses],[k]=S.splice(w,1),D=b;w<b&&(D=b-1),T||D++,S.splice(D,0,k),S.forEach((M,_)=>{M.order=_}),e.settings.customStatuses=S,t(),_p(n,e,t)})})}function qv(n,e,t){if(n.empty(),!e.settings.customPriorities||e.settings.customPriorities.length===0){Ji(n,"No custom priorities configured. Add a priority to get started.","Add Priority",()=>{let s=document.querySelector('[data-setting-name="Add new priority"] button');s&&s.click()});return}[...e.settings.customPriorities].sort((s,i)=>i.weight-s.weight).forEach((s,i)=>{let a=Nt("text","high",s.value),o=Nt("text","High Priority",s.label),l=Nt("color","",s.color),c=Xa(0,void 0,1,s.weight),d=Pn(n,{id:s.id,collapsible:!0,defaultCollapsed:!0,colorIndicator:{color:s.color},header:{primaryText:s.label||s.value||"untitled",secondaryText:`Weight: ${s.weight}`,actions:[In(()=>{if(e.settings.customPriorities.length<=1){new di.Notice("You must have at least one priority");return}e.settings.customPriorities.splice(i,1),t(),qv(n,e,t)},"Delete priority")]},content:{sections:[{rows:[{label:"Value:",input:a},{label:"Label:",input:o},{label:"Color:",input:l},{label:"Weight:",input:c}]}]}});a.addEventListener("change",()=>{s.value=a.value,t()}),o.addEventListener("change",()=>{s.label=o.value,d.querySelector(".tasknotes-settings__card-primary-text").textContent=s.label||s.value||"untitled",t()}),l.addEventListener("change",()=>{s.color=l.value;let u=d.querySelector(".tasknotes-settings__card-color-indicator");u&&(u.style.backgroundColor=s.color),t()}),c.addEventListener("input",()=>{let u=parseInt(c.value);!isNaN(u)&&u>=0&&(s.weight=u,d.querySelector(".tasknotes-settings__card-secondary-text").textContent=`Weight: ${s.weight}`,t())})})}function gW(n,e,t){let r=n.createEl("table",{cls:"tasknotes-settings__table"}),s=r.createEl("tr");s.createEl("th",{cls:"tasknotes-settings__table-header",text:"TaskNotes field"}),s.createEl("th",{cls:"tasknotes-settings__table-header",text:"Your property name"}),[["title","Title"],["status","Status"],["priority","Priority"],["due","Due date"],["scheduled","Scheduled date"],["contexts","Contexts"],["projects","Projects"],["timeEstimate","Time estimate"],["recurrence","Recurrence"],["dateCreated","Created date"],["completedDate","Completed date"],["dateModified","Modified date"],["archiveTag","Archive tag"],["timeEntries","Time entries"],["completeInstances","Complete instances"],["pomodoros","Pomodoros"],["icsEventId","ICS Event ID"],["icsEventTag","ICS Event Tag"],["reminders","Reminders"]].forEach(([a,o])=>{let l=r.createEl("tr",{cls:"tasknotes-settings__table-row"}),c=l.createEl("td",{cls:"tasknotes-settings__table-cell"});c.textContent=o;let u=l.createEl("td",{cls:"tasknotes-settings__table-cell"}).createEl("input",{type:"text",cls:"settings-input field-mapping-input",value:e.settings.fieldMapping[a]||"",attr:{placeholder:a,"aria-label":`Property name for ${o}`}});u.addEventListener("change",async()=>{try{e.settings.fieldMapping[a]=u.value,t()}catch(h){console.error(`Error updating field mapping for ${a}:`,h),new di.Notice(`Failed to update field mapping for ${o}. Please try again.`)}})})}function kl(n,e,t){if(n.empty(),e.settings.userFields||(e.settings.userFields=[]),e.settings.userFields.length===0){Ji(n,"No custom user fields configured. Add a field to create custom properties for your tasks.","Add User Field",()=>{let r=document.querySelector('[data-setting-name="Add new user field"] button');r&&r.click()});return}e.settings.userFields.forEach((r,s)=>{let i=Nt("text","Display Name",r.displayName),a=Nt("text","property-name",r.key),o=Ja([{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"boolean",label:"Boolean"},{value:"date",label:"Date"},{value:"list",label:"List"}],r.type);i.addEventListener("change",()=>{r.displayName=i.value,t(),kl(n,e,t)}),a.addEventListener("change",()=>{r.key=a.value,t(),kl(n,e,t)}),o.addEventListener("change",()=>{r.type=o.value,t(),kl(n,e,t)}),Pn(n,{id:r.id,collapsible:!0,defaultCollapsed:!0,header:{primaryText:r.displayName||"Unnamed Field",secondaryText:r.key||"no-key",meta:[Zi(r.type.charAt(0).toUpperCase()+r.type.slice(1),"default")],actions:[In(()=>{e.settings.userFields&&(e.settings.userFields.splice(s,1),t(),kl(n,e,t))},"Delete field")]},content:{sections:[{rows:[{label:"Display Name:",input:i},{label:"Property Key:",input:a},{label:"Type:",input:o}]}]}})})}var Gv=require("obsidian");var Rn=require("obsidian");var eo=class{constructor(e){this.deps=e}stringifyFmValue(e){if(e==null)return"";if(Array.isArray(e))return e.map(s=>this.stringifyFmValue(s)).filter(Boolean).join(", ");let t=typeof e;if(t==="string"){let s=e.trim(),i=s.match(/^\[\[([^\]]+)\]\]$/);if(i){let l=i[1].split("|");if(l.length>1&&l[1].trim())return l[1].trim();let c=l[0].split("#")[0].trim();return(c.split("/").pop()||c).replace(/\.md$/i,"")}let a=s.match(/^\[([^\]]+)\]\(([^)]+)\)$/);return a?a[1].trim():s}if(t==="number"||t==="boolean")return String(e);if(t==="object"){let r=e;if(typeof r.path=="string"){let s=r.path;return(s.split("/").pop()||s).replace(/\.md$/i,"")}return""}return""}resolve(e,t){if(!e)return"";if(e.startsWith("file."))switch(e){case"file.basename":return t.basename||"";case"file.name":return t.name||"";case"file.path":return t.path||"";case"file.parent":return t.parent||"";default:return""}if(e==="title")return t.title||"";if(e==="aliases"){let i=t.aliases||[];return i.length?i.join(", "):""}let r=e;e.startsWith("frontmatter:")&&(r=e.slice(12));let s=this.deps.getFrontmatter(t)||{};return this.stringifyFmValue(s[r])}};Pp();var El=class extends Rn.FuzzySuggestModal{constructor(e,t,r){super(e),this.plugin=t,this.onChoose=r,this.setPlaceholder("Type to search for project notes..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){var s,i,a,o,l,c;let e=this.app.vault.getAllLoadedFiles().filter(d=>d instanceof Rn.TFile&&d.extension==="md"&&!d.path.includes(".trash")),t=(a=(i=(s=this.plugin.settings)==null?void 0:s.projectAutosuggest)==null?void 0:i.requiredTags)!=null?a:[],r=(c=(l=(o=this.plugin.settings)==null?void 0:o.projectAutosuggest)==null?void 0:l.includeFolders)!=null?c:[];return t.length===0&&r.length===0?e:e.filter(d=>{var h,f;if(!(d instanceof Rn.TFile))return!1;let u=this.app.metadataCache.getFileCache(d);if(t.length>0){let p=((h=u==null?void 0:u.tags)==null?void 0:h.map(T=>T.tag.replace("#","")))||[],m=((f=u==null?void 0:u.frontmatter)==null?void 0:f.tags)||[],g=[...p,...Array.isArray(m)?m:[m].filter(Boolean)];if(!t.some(T=>g.includes(T)))return!1}return!(r.length>0&&!r.some(m=>d.path.startsWith(m)||d.path.startsWith(m+"/")))})}getItemText(e){var a,o,l,c;if(!(e instanceof Rn.TFile))return e.name;let t=`${e.name} ${e.path}`,r=(l=(o=(a=this.plugin.settings)==null?void 0:a.projectAutosuggest)==null?void 0:o.rows)!=null?l:[],s=new Set;for(let d of r)try{let u=Xi(d);for(let h of u)h.searchable&&!h.property.startsWith("literal:")&&s.add(h.property)}catch(u){}let i=this.app.metadataCache.getFileCache(e);if(i!=null&&i.frontmatter){let d=this.plugin.fieldMapper.mapFromFrontmatter(i.frontmatter,e.path,this.plugin.settings.storeTitleInFilename),u=typeof d.title=="string"?d.title:"";u&&(t+=` ${u}`);let h=(0,Rn.parseFrontMatterAliases)(i.frontmatter)||[];Array.isArray(h)&&h.length>0&&(t+=` ${h.join(" ")}`);for(let f of s){let p="";switch(f){case"file.path":p=e.path;break;case"file.parent":p=((c=e.parent)==null?void 0:c.name)||"";break;case"file.basename":p=e.basename;break;case"title":case"aliases":break;default:let m=i.frontmatter[f];m!=null&&(p=Array.isArray(m)?m.join(" "):String(m));break}p&&(t+=` ${p}`)}}return t}renderSuggestion(e,t){var a,o,l,c,d;let r=e.item;if(t.empty(),!(r instanceof Rn.TFile)){t.textContent=r.name;return}let s=t.createDiv({cls:"project-suggestion"}),i=((l=(o=(a=this.plugin.settings)==null?void 0:a.projectAutosuggest)==null?void 0:o.rows)!=null?l:[]).slice(0,3);if(i.length===0){s.createSpan({cls:"project-name",text:r.basename});return}try{let u=this.app.metadataCache.getFileCache(r),h=(u==null?void 0:u.frontmatter)||{},f=this.plugin.fieldMapper.mapFromFrontmatter(h,r.path,this.plugin.settings.storeTitleInFilename),p=typeof f.title=="string"?f.title:"",m=(0,Rn.parseFrontMatterAliases)(h)||[],g=Array.isArray(m)?m.filter(b=>typeof b=="string"):[],y={basename:r.basename,name:r.name,path:r.path,parent:((c=r.parent)==null?void 0:c.path)||"",title:p,aliases:g,frontmatter:h},T=new eo({getFrontmatter:()=>h}),w=s.createDiv({cls:"project-name",text:r.basename});for(let b=0;b<Math.min(i.length,3);b++){let S=i[b];if(S)try{let k=Xi(S),D=[];for(let _ of k){if(_.property.startsWith("literal:")){D.push(_.property.slice(8));continue}let W=T.resolve(_.property,y)||"";if(W)if(_.showName){let j=(d=_.displayName)!=null?d:_.property;D.push(`${j}: ${W}`)}else D.push(W)}let M=D.join(" ");if(M.trim()){let _=s.createDiv({cls:"project-meta"});_.textContent=M}}catch(k){}}}catch(u){console.error("Error rendering project suggestion:",u),s.createSpan({cls:"project-name",text:r.basename})}}onChooseItem(e,t){this.onChoose(e)}};Sl();function Ip(n,e,t){n.empty(),Ce(n,"Basic Defaults"),xe(n,"Set default values for new tasks to speed up task creation."),gt(n,{name:"Default status",desc:"Default status for new tasks",options:e.settings.customStatuses.map(o=>({value:o.value,label:o.label||o.value})),getValue:()=>e.settings.defaultTaskStatus,setValue:async o=>{e.settings.defaultTaskStatus=o,t()}}),gt(n,{name:"Default priority",desc:"Default priority for new tasks",options:[{value:"",label:"No default"},...e.settings.customPriorities.map(o=>({value:o.value,label:o.label||o.value}))],getValue:()=>e.settings.defaultTaskPriority,setValue:async o=>{e.settings.defaultTaskPriority=o,t()}}),et(n,{name:"Default contexts",desc:"Comma-separated list of default contexts (e.g., @home, @work)",placeholder:"@home, @work",getValue:()=>e.settings.taskCreationDefaults.defaultContexts,setValue:async o=>{e.settings.taskCreationDefaults.defaultContexts=o,t()}}),et(n,{name:"Default tags",desc:"Comma-separated list of default tags (without #)",placeholder:"important, urgent",getValue:()=>e.settings.taskCreationDefaults.defaultTags,setValue:async o=>{e.settings.taskCreationDefaults.defaultTags=o,t()}});let r=[],s=n.createDiv("default-projects-container"),i=s.createDiv();new Gv.Setting(i).setName("Default projects").setDesc("Default project links for new tasks").addButton(o=>{o.setButtonText("Select Projects").setTooltip("Choose project notes to link by default").onClick(()=>{new El(e.app,e,c=>{if(!r.includes(c)){r.push(c);let d=r.map(u=>`[[${u.path.replace(/\.md$/,"")}]]`).join(", ");e.settings.taskCreationDefaults.defaultProjects=d,t(),Qv(s,e,t,r)}}).open()}),o.buttonEl.addClass("tn-btn"),o.buttonEl.addClass("tn-btn--ghost")}),e.settings.taskCreationDefaults.defaultProjects&&un(e.settings.taskCreationDefaults.defaultProjects).map(l=>l.replace(/\[\[|\]\]/g,"").trim()).filter(l=>l).forEach(l=>{let c=e.app.vault.getAbstractFileByPath(l+".md")||e.app.vault.getAbstractFileByPath(l);c&&r.push(c)}),Qv(s,e,t,r),be(n,{name:"Use parent note as project during instant conversion",desc:"Automatically link the parent note as a project when using instant task conversion",getValue:()=>e.settings.taskCreationDefaults.useParentNoteAsProject,setValue:async o=>{e.settings.taskCreationDefaults.useParentNoteAsProject=o,t()}}),zr(n,{name:"Default time estimate",desc:"Default time estimate in minutes (0 = no default)",placeholder:"60",min:0,getValue:()=>e.settings.taskCreationDefaults.defaultTimeEstimate,setValue:async o=>{e.settings.taskCreationDefaults.defaultTimeEstimate=o,t()}}),gt(n,{name:"Default recurrence",desc:"Default recurrence pattern for new tasks",options:[{value:"none",label:"None"},{value:"daily",label:"Daily"},{value:"weekly",label:"Weekly"},{value:"monthly",label:"Monthly"},{value:"yearly",label:"Yearly"}],getValue:()=>e.settings.taskCreationDefaults.defaultRecurrence,setValue:async o=>{e.settings.taskCreationDefaults.defaultRecurrence=o,t()}}),Ce(n,"Date Defaults"),xe(n,"Set default due and scheduled dates for new tasks."),gt(n,{name:"Default due date",desc:"Default due date for new tasks",options:[{value:"none",label:"None"},{value:"today",label:"Today"},{value:"tomorrow",label:"Tomorrow"},{value:"next-week",label:"Next week"}],getValue:()=>e.settings.taskCreationDefaults.defaultDueDate,setValue:async o=>{e.settings.taskCreationDefaults.defaultDueDate=o,t()}}),gt(n,{name:"Default scheduled date",desc:"Default scheduled date for new tasks",options:[{value:"none",label:"None"},{value:"today",label:"Today"},{value:"tomorrow",label:"Tomorrow"},{value:"next-week",label:"Next week"}],getValue:()=>e.settings.taskCreationDefaults.defaultScheduledDate,setValue:async o=>{e.settings.taskCreationDefaults.defaultScheduledDate=o,t()}}),Ce(n,"Default reminders"),xe(n,"Configure default reminders that will be added to new tasks.");let a=n.createDiv("tasknotes-reminders-container");if(Kv(a,e,t),new Gv.Setting(n).setName("Add default reminder").setDesc("Create a new default reminder that will be added to all new tasks").addButton(o=>o.setButtonText("Add reminder").onClick(async()=>{let c={id:`reminder_${Date.now()}`,type:"relative",relatedTo:"due",offset:1,unit:"hours",direction:"before",description:"Reminder"};e.settings.taskCreationDefaults.defaultReminders=e.settings.taskCreationDefaults.defaultReminders||[],e.settings.taskCreationDefaults.defaultReminders.push(c),t(),Kv(a,e,t)})),Ce(n,"Body Template"),xe(n,"Configure a template file to use for new task content."),be(n,{name:"Use body template",desc:"Use a template file for task body content",getValue:()=>e.settings.taskCreationDefaults.useBodyTemplate,setValue:async o=>{e.settings.taskCreationDefaults.useBodyTemplate=o,t(),Ip(n,e,t)}}),e.settings.taskCreationDefaults.useBodyTemplate&&et(n,{name:"Body template file",desc:"Path to template file for task body content. Supports template variables like {{title}}, {{date}}, {{time}}, {{priority}}, {{status}}, etc.",placeholder:"Templates/Task Template.md",getValue:()=>e.settings.taskCreationDefaults.bodyTemplate,setValue:async o=>{e.settings.taskCreationDefaults.bodyTemplate=o,t()},ariaLabel:"Path to body template file"}),e.settings.taskCreationDefaults.useBodyTemplate){let o=n.createDiv("tasknotes-settings__help-section");o.createEl("h4",{text:"Template variables:"});let l=o.createEl("ul");l.createEl("li",{text:"{{title}} - Task title"}),l.createEl("li",{text:"{{details}} - User-provided details from modal"}),l.createEl("li",{text:"{{date}} - Current date (YYYY-MM-DD)"}),l.createEl("li",{text:"{{time}} - Current time (HH:MM)"}),l.createEl("li",{text:"{{priority}} - Task priority"}),l.createEl("li",{text:"{{status}} - Task status"}),l.createEl("li",{text:"{{contexts}} - Task contexts"}),l.createEl("li",{text:"{{tags}} - Task tags"}),l.createEl("li",{text:"{{projects}} - Task projects"})}Ce(n,"Instant Task Conversion"),xe(n,"Configure behavior when converting text to tasks instantly."),be(n,{name:"Use task defaults on instant convert",desc:"Apply default task settings when converting text to tasks instantly",getValue:()=>e.settings.useDefaultsOnInstantConvert,setValue:async o=>{e.settings.useDefaultsOnInstantConvert=o,t()}})}function Qv(n,e,t,r){let s=n.querySelector(".default-projects-list");if(s&&s.remove(),r.length===0)return;let i=n.createDiv("default-projects-list");r.forEach(a=>{Pn(i,{id:a.path,collapsible:!0,defaultCollapsed:!0,header:{primaryText:a.name.replace(/\.md$/,""),actions:[In(()=>{let o=r.indexOf(a);if(o>-1){r.splice(o,1);let l=r.map(c=>`[[${c.path.replace(/\.md$/,"")}]]`).join(", ");e.settings.taskCreationDefaults.defaultProjects=l,t(),Qv(n,e,t,r)}},`Remove ${a.name} from default projects`)]}})})}function b_(n,e){let t=Xa(1,void 0,1,n.offset);t.addEventListener("input",()=>{let a=parseInt(t.value);!isNaN(a)&&a>0&&e({offset:a})});let r=Ja([{value:"minutes",label:"minutes"},{value:"hours",label:"hours"},{value:"days",label:"days"}],n.unit);r.addEventListener("change",()=>{e({unit:r.value})});let s=Ja([{value:"before",label:"before"},{value:"after",label:"after"}],n.direction);s.addEventListener("change",()=>{e({direction:s.value})});let i=Ja([{value:"due",label:"due date"},{value:"scheduled",label:"scheduled date"}],n.relatedTo);return i.addEventListener("change",()=>{e({relatedTo:i.value})}),[{label:"Offset:",input:t},{label:"Unit:",input:r},{label:"Direction:",input:s},{label:"Related to:",input:i}]}function k_(n,e){let t=Nt("date",n.absoluteDate||new Date().toISOString().split("T")[0]);t.addEventListener("input",()=>{e({absoluteDate:t.value})});let r=Nt("time",n.absoluteTime||"09:00");return r.addEventListener("input",()=>{e({absoluteTime:r.value})}),[{label:"Date:",input:t},{label:"Time:",input:r}]}function Kv(n,e,t){if(n.empty(),!e.settings.taskCreationDefaults.defaultReminders||e.settings.taskCreationDefaults.defaultReminders.length===0){Ji(n,"No default reminders configured. Add a reminder to automatically notify you about new tasks.","Add Reminder",()=>{let r=document.querySelector('[data-setting-name="Add default reminder"] button');r&&r.click()});return}e.settings.taskCreationDefaults.defaultReminders.forEach((r,s)=>{let i=E_(r),a=Nt("text","Reminder description",r.description),o=Ja([{value:"relative",label:"Relative (before/after task dates)"},{value:"absolute",label:"Absolute (specific date/time)"}],r.type),l=u=>{Object.assign(r,u),t();let h=n.querySelector(`[data-card-id="${r.id}"]`);if(h){let f=h.querySelector(".tasknotes-settings__card-secondary-text");f&&(f.textContent=E_(r))}},c=r.type==="relative"?b_(r,l):k_(r,l),d=Pn(n,{id:r.id,collapsible:!0,defaultCollapsed:!0,header:{primaryText:r.description||"Unnamed Reminder",secondaryText:i,actions:[In(()=>{e.settings.taskCreationDefaults.defaultReminders.splice(s,1),t(),Kv(n,e,t)},"Delete reminder")]},content:{sections:[{rows:[{label:"Description:",input:a},{label:"Type:",input:o}]},{rows:c}]}});a.addEventListener("input",()=>{r.description=a.value,t();let u=d.querySelector(".tasknotes-settings__card-primary-text");u&&(u.textContent=r.description||"Unnamed Reminder")}),o.addEventListener("change",()=>{r.type=o.value,t();let u=r.type==="relative"?b_(r,l):k_(r,l),h=d.querySelector(".tasknotes-settings__card-content");if(h&&h.children[1]){let f=document.createElement("div");u.forEach(p=>{let m=f.createDiv("tasknotes-settings__card-config-row");p.fullWidth&&(m.style.flexDirection="column",m.style.alignItems="flex-start",m.style.gap="0.5rem");let g=m.createSpan("tasknotes-settings__card-config-label");g.textContent=p.label,m.appendChild(p.input)}),h.replaceChild(f,h.children[1])}})})}function E_(n){if(n.type==="relative"){let e=n.direction==="before"?"before":"after",t=n.unit||"hours",r=n.offset||1,s=n.relatedTo==="due"?"due date":"scheduled date";return`${r} ${t} ${e} ${s}`}else{let e=n.absoluteDate||"No date",t=n.absoluteTime||"No time";return`${e} at ${t}`}}var S_=require("obsidian");function Nn(n,e,t){var c;n.empty(),Ce(n,"Task Cards"),xe(n,"Configure how task cards are displayed across all views.");let r=n.createDiv("visible-properties-container"),s=r.createDiv();new S_.Setting(s).setName("Default visible properties").setDesc("Choose which properties appear on task cards by default.");let i={core:[{key:"status",label:"Status Dot"},{key:"priority",label:"Priority Dot"},{key:"due",label:"Due Date"},{key:"scheduled",label:"Scheduled Date"},{key:"timeEstimate",label:"Time Estimate"},{key:"totalTrackedTime",label:"Total Tracked Time"},{key:"recurrence",label:"Recurrence"},{key:"completedDate",label:"Completed Date"},{key:"file.ctime",label:"Created Date"},{key:"file.mtime",label:"Modified Date"}],organization:[{key:"projects",label:"Projects"},{key:"contexts",label:"Contexts"},{key:"tags",label:"Tags"}],user:[]};e.settings.userFields&&e.settings.userFields.forEach(d=>{d.displayName&&d.key&&i.user.push({key:`user:${d.id}`,label:d.displayName})});let a=e.settings.defaultVisibleProperties||[],o=r.createDiv("tasknotes-settings__properties-container"),l=(d,u)=>{if(u.length===0)return;let h=o.createDiv("tasknotes-settings__property-group"),f=h.createDiv("tasknotes-settings__property-group-header");f.textContent=d;let p=h.createDiv("tasknotes-settings__property-toggles");u.forEach(m=>{let g=p.createDiv("tasknotes-settings__property-toggle"),y=g.createEl("input",{type:"checkbox",cls:"tasknotes-settings__property-checkbox",attr:{id:`visible-prop-${m.key}`,"aria-label":`Show ${m.label} on task cards`}});y.checked=a.includes(m.key);let T=g.createEl("label",{text:m.label,cls:"tasknotes-settings__property-label",attr:{for:`visible-prop-${m.key}`}});y.addEventListener("change",()=>{let w=[...a];y.checked?w.includes(m.key)||w.push(m.key):w=w.filter(b=>b!==m.key),e.settings.defaultVisibleProperties=w,t()})})};if(l("CORE PROPERTIES",i.core),l("ORGANIZATION",i.organization),i.user.length>0&&l("CUSTOM PROPERTIES",i.user),Ce(n,"Task Filenames"),xe(n,"Configure how task files are named when created."),be(n,{name:"Store title in filename",desc:"Use the task title as the filename. Filename will update when the task title is changed (Recommended).",getValue:()=>e.settings.storeTitleInFilename,setValue:async d=>{e.settings.storeTitleInFilename=d,t(),Nn(n,e,t)}}),e.settings.storeTitleInFilename||(gt(n,{name:"Filename format",desc:"How task filenames should be generated",options:[{value:"title",label:"Task title (Non-updating)"},{value:"zettel",label:"Zettelkasten format (YYMMDD + base36 seconds since midnight)"},{value:"timestamp",label:"Full timestamp (YYYY-MM-DD-HHMMSS)"},{value:"custom",label:"Custom template"}],getValue:()=>e.settings.taskFilenameFormat,setValue:async d=>{e.settings.taskFilenameFormat=d,t(),Nn(n,e,t)},ariaLabel:"Task filename generation format"}),e.settings.taskFilenameFormat==="custom"&&(et(n,{name:"Custom filename template",desc:"Template for custom filenames. Available variables: {title}, {titleLower}, {titleUpper}, {titleSnake}, {titleKebab}, {titleCamel}, {titlePascal}, {date}, {shortDate}, {time}, {time12}, {time24}, {timestamp}, {dateTime}, {year}, {month}, {monthName}, {monthNameShort}, {day}, {dayName}, {dayNameShort}, {hour}, {hour12}, {minute}, {second}, {milliseconds}, {ms}, {ampm}, {week}, {quarter}, {unix}, {unixMs}, {timezone}, {timezoneShort}, {utcOffset}, {utcOffsetShort}, {utcZ}, {zettel}, {nano}, {priority}, {priorityShort}, {status}, {statusShort}, {dueDate}, {scheduledDate}",placeholder:"{date}-{title}-{dueDate}",getValue:()=>e.settings.customFilenameTemplate,setValue:async d=>{e.settings.customFilenameTemplate=d,t()},ariaLabel:"Custom filename template with variables"}),xe(n,"Note: {dueDate} and {scheduledDate} are in YYYY-MM-DD format and will be empty if not set."))),Ce(n,"Calendar View"),xe(n,"Customize the appearance and behavior of the calendar view."),gt(n,{name:"Default view",desc:"The calendar view shown when opening the calendar tab",options:[{value:"dayGridMonth",label:"Month Grid"},{value:"timeGridWeek",label:"Week Timeline"},{value:"timeGridDay",label:"Day Timeline"},{value:"multiMonthYear",label:"Year View"},{value:"timeGridCustom",label:"Custom Multi-Day"}],getValue:()=>e.settings.calendarViewSettings.defaultView,setValue:async d=>{e.settings.calendarViewSettings.defaultView=d,t(),Nn(n,e,t)}}),e.settings.calendarViewSettings.defaultView==="timeGridCustom"&&zr(n,{name:"Custom view day count",desc:"Number of days to show in custom multi-day view",placeholder:"3",min:2,max:10,getValue:()=>e.settings.calendarViewSettings.customDayCount,setValue:async d=>{e.settings.calendarViewSettings.customDayCount=d,t()}}),gt(n,{name:"First day of week",desc:"Which day should be the first column in week views",options:[{value:"0",label:"Sunday"},{value:"1",label:"Monday"},{value:"2",label:"Tuesday"},{value:"3",label:"Wednesday"},{value:"4",label:"Thursday"},{value:"5",label:"Friday"},{value:"6",label:"Saturday"}],getValue:()=>e.settings.calendarViewSettings.firstDay.toString(),setValue:async d=>{e.settings.calendarViewSettings.firstDay=parseInt(d),t()}}),gt(n,{name:"Time format",desc:"Display time in 12-hour or 24-hour format",options:[{value:"12",label:"12-hour (AM/PM)"},{value:"24",label:"24-hour"}],getValue:()=>e.settings.calendarViewSettings.timeFormat,setValue:async d=>{e.settings.calendarViewSettings.timeFormat=d,t()}}),be(n,{name:"Show weekends",desc:"Display weekends in calendar views",getValue:()=>e.settings.calendarViewSettings.showWeekends,setValue:async d=>{e.settings.calendarViewSettings.showWeekends=d,t()}}),be(n,{name:"Show week numbers",desc:"Display week numbers in calendar views",getValue:()=>e.settings.calendarViewSettings.weekNumbers,setValue:async d=>{e.settings.calendarViewSettings.weekNumbers=d,t()}}),be(n,{name:"Show today highlight",desc:"Highlight the current day in calendar views",getValue:()=>e.settings.calendarViewSettings.showTodayHighlight,setValue:async d=>{e.settings.calendarViewSettings.showTodayHighlight=d,t()}}),be(n,{name:"Show current time indicator",desc:"Display a line showing the current time in timeline views",getValue:()=>e.settings.calendarViewSettings.nowIndicator,setValue:async d=>{e.settings.calendarViewSettings.nowIndicator=d,t()}}),be(n,{name:"Selection mirror",desc:"Show a visual preview while dragging to select time ranges",getValue:()=>e.settings.calendarViewSettings.selectMirror,setValue:async d=>{e.settings.calendarViewSettings.selectMirror=d,t()}}),et(n,{name:"Calendar locale",desc:'Calendar locale for date formatting and calendar system (e.g., "en", "fa" for Farsi/Persian, "de" for German). Leave empty to auto-detect from browser.',placeholder:"Auto-detect",getValue:()=>e.settings.calendarViewSettings.locale||"",setValue:async d=>{e.settings.calendarViewSettings.locale=d,t()}}),Ce(n,"Default Event Visibility"),xe(n,"Configure which event types are visible by default when opening the Advanced Calendar. Users can still toggle these on/off in the calendar view."),be(n,{name:"Show scheduled tasks",desc:"Display tasks with scheduled dates by default",getValue:()=>e.settings.calendarViewSettings.defaultShowScheduled,setValue:async d=>{e.settings.calendarViewSettings.defaultShowScheduled=d,t()}}),be(n,{name:"Show due dates",desc:"Display task due dates by default",getValue:()=>e.settings.calendarViewSettings.defaultShowDue,setValue:async d=>{e.settings.calendarViewSettings.defaultShowDue=d,t()}}),be(n,{name:"Show due dates when scheduled",desc:"Display due dates even for tasks that already have scheduled dates",getValue:()=>e.settings.calendarViewSettings.defaultShowDueWhenScheduled,setValue:async d=>{e.settings.calendarViewSettings.defaultShowDueWhenScheduled=d,t()}}),be(n,{name:"Show time entries",desc:"Display completed time tracking entries by default",getValue:()=>e.settings.calendarViewSettings.defaultShowTimeEntries,setValue:async d=>{e.settings.calendarViewSettings.defaultShowTimeEntries=d,t()}}),be(n,{name:"Show recurring tasks",desc:"Display recurring task instances by default",getValue:()=>e.settings.calendarViewSettings.defaultShowRecurring,setValue:async d=>{e.settings.calendarViewSettings.defaultShowRecurring=d,t()}}),be(n,{name:"Show ICS events",desc:"Display events from ICS subscriptions by default",getValue:()=>e.settings.calendarViewSettings.defaultShowICSEvents,setValue:async d=>{e.settings.calendarViewSettings.defaultShowICSEvents=d,t()}}),Ce(n,"Timeblocking"),xe(n,"Configure timeblock functionality for lightweight scheduling in daily notes."),be(n,{name:"Enable timeblocking",desc:"Enable timeblock functionality for lightweight scheduling in daily notes",getValue:()=>e.settings.calendarViewSettings.enableTimeblocking,setValue:async d=>{e.settings.calendarViewSettings.enableTimeblocking=d,t(),Nn(n,e,t)}}),e.settings.calendarViewSettings.enableTimeblocking&&be(n,{name:"Show timeblocks",desc:"Display timeblocks from daily notes by default",getValue:()=>e.settings.calendarViewSettings.defaultShowTimeblocks,setValue:async d=>{e.settings.calendarViewSettings.defaultShowTimeblocks=d,t()}}),Ce(n,"Time Settings"),xe(n,"Configure time-related display settings for timeline views."),gt(n,{name:"Time slot duration",desc:"Duration of each time slot in timeline views",options:[{value:"00:15:00",label:"15 minutes"},{value:"00:30:00",label:"30 minutes"},{value:"01:00:00",label:"60 minutes"}],getValue:()=>e.settings.calendarViewSettings.slotDuration,setValue:async d=>{e.settings.calendarViewSettings.slotDuration=d,t()}}),et(n,{name:"Start time",desc:"Earliest time shown in timeline views (HH:MM format)",placeholder:"06:00",getValue:()=>e.settings.calendarViewSettings.slotMinTime.slice(0,5),setValue:async d=>{e.settings.calendarViewSettings.slotMinTime=d+":00",t()}}),et(n,{name:"End time",desc:"Latest time shown in timeline views (HH:MM format)",placeholder:"22:00",getValue:()=>e.settings.calendarViewSettings.slotMaxTime.slice(0,5),setValue:async d=>{e.settings.calendarViewSettings.slotMaxTime=d+":00",t()}}),et(n,{name:"Initial scroll time",desc:"Time to scroll to when opening timeline views (HH:MM format)",placeholder:"09:00",getValue:()=>e.settings.calendarViewSettings.scrollTime.slice(0,5),setValue:async d=>{e.settings.calendarViewSettings.scrollTime=d+":00",t()}}),Ce(n,"UI Elements"),xe(n,"Configure the display of various UI elements."),be(n,{name:"Show tracked tasks in status bar",desc:"Display currently tracked tasks in Obsidian's status bar",getValue:()=>e.settings.showTrackedTasksInStatusBar,setValue:async d=>{e.settings.showTrackedTasksInStatusBar=d,t()}}),be(n,{name:"Show project subtasks widget",desc:"Display a widget showing subtasks for the current project note",getValue:()=>e.settings.showProjectSubtasks,setValue:async d=>{e.settings.showProjectSubtasks=d,t(),Nn(n,e,t)}}),e.settings.showProjectSubtasks&&gt(n,{name:"Project subtasks position",desc:"Where to position the project subtasks widget",options:[{value:"top",label:"Top of note"},{value:"bottom",label:"Bottom of note"}],getValue:()=>e.settings.projectSubtasksPosition,setValue:async d=>{e.settings.projectSubtasksPosition=d,t()}}),be(n,{name:"Show expandable subtasks",desc:"Allow expanding/collapsing subtask sections in task cards",getValue:()=>e.settings.showExpandableSubtasks,setValue:async d=>{e.settings.showExpandableSubtasks=d,t(),Nn(n,e,t)}}),e.settings.showExpandableSubtasks&&gt(n,{name:"Subtask chevron position",desc:"Position of expand/collapse chevrons in task cards",options:[{value:"left",label:"Left side"},{value:"right",label:"Right side"}],getValue:()=>e.settings.subtaskChevronPosition,setValue:async d=>{e.settings.subtaskChevronPosition=d,t()}}),gt(n,{name:"Views button alignment",desc:"Alignment of the views/filters button in the task interface",options:[{value:"left",label:"Left side"},{value:"right",label:"Right side"}],getValue:()=>e.settings.viewsButtonAlignment,setValue:async d=>{e.settings.viewsButtonAlignment=d,t()}}),Ce(n,"Project Autosuggest"),xe(n,"Customize how project suggestions display during task creation."),et(n,{name:"Required tags",desc:"Show only notes with any of these tags (comma-separated). Leave empty to show all notes.",placeholder:"project, active, important",getValue:()=>{var d,u,h;return(h=(u=(d=e.settings.projectAutosuggest)==null?void 0:d.requiredTags)==null?void 0:u.join(", "))!=null?h:""},setValue:async d=>{e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1,requiredTags:[],includeFolders:[]}),e.settings.projectAutosuggest.requiredTags=d.split(",").map(u=>u.trim()).filter(u=>u.length>0),t()},ariaLabel:"Required tags for project suggestions"}),et(n,{name:"Include folders",desc:"Show only notes in these folders (comma-separated paths). Leave empty to show all folders.",placeholder:"Projects/, Work/Active, Personal",getValue:()=>{var d,u,h;return(h=(u=(d=e.settings.projectAutosuggest)==null?void 0:d.includeFolders)==null?void 0:u.join(", "))!=null?h:""},setValue:async d=>{e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1,requiredTags:[],includeFolders:[]}),e.settings.projectAutosuggest.includeFolders=d.split(",").map(u=>u.trim()).filter(u=>u.length>0),t()},ariaLabel:"Include folders for project suggestions"}),be(n,{name:"Customize suggestion display",desc:"Show advanced options to configure how project suggestions appear and what information they display.",getValue:()=>{var d,u;return(u=(d=e.settings.projectAutosuggest)==null?void 0:d.showAdvanced)!=null?u:!1},setValue:async d=>{e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1}),e.settings.projectAutosuggest.showAdvanced=d,t(),Nn(n,e,t)}}),(c=e.settings.projectAutosuggest)!=null&&c.showAdvanced){be(n,{name:"Enable fuzzy matching",desc:"Allow typos and partial matches in project search. May be slower in large vaults.",getValue:()=>{var p,m;return(m=(p=e.settings.projectAutosuggest)==null?void 0:p.enableFuzzy)!=null?m:!1},setValue:async p=>{e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1}),e.settings.projectAutosuggest.enableFuzzy=p,t()}}),xe(n,"Configure up to 3 lines of information to show for each project suggestion.");let d=()=>{var p,m;return((m=(p=e.settings.projectAutosuggest)==null?void 0:p.rows)!=null?m:[]).slice(0,3)},u=async(p,m)=>{var T;e.settings.projectAutosuggest||(e.settings.projectAutosuggest={enableFuzzy:!1,rows:[],showAdvanced:!1});let y=[...(T=e.settings.projectAutosuggest.rows)!=null?T:[]];y[p]=m,e.settings.projectAutosuggest.rows=y.slice(0,3),t()};et(n,{name:"Row 1",desc:"Format: {property|flags}. Properties: title, aliases, file.path, file.parent. Flags: n(Label) shows label, s makes searchable. Example: {title|n(Title)|s}",placeholder:"{title|n(Title)}",getValue:()=>d()[0]||"",setValue:async p=>u(0,p),ariaLabel:"Project autosuggest display row 1"}),et(n,{name:"Row 2 (optional)",desc:"Common patterns: {aliases|n(Aliases)}, {file.parent|n(Folder)}, literal:Custom Text",placeholder:"{aliases|n(Aliases)}",getValue:()=>d()[1]||"",setValue:async p=>u(1,p),ariaLabel:"Project autosuggest display row 2"}),et(n,{name:"Row 3 (optional)",desc:"Additional info like {file.path|n(Path)} or custom frontmatter fields",placeholder:"{file.path|n(Path)}",getValue:()=>d()[2]||"",setValue:async p=>u(2,p),ariaLabel:"Project autosuggest display row 3"});let h=n.createDiv("tasknotes-settings__help-section");h.createEl("h4",{text:"Quick Reference"});let f=h.createEl("ul");f.createEl("li",{text:"Available properties: title, aliases, file.path, file.parent, or any frontmatter field"}),f.createEl("li",{text:'Add labels: {title|n(Title)} \u2192 "Title: My Project"'}),f.createEl("li",{text:"Make searchable: {description|s} includes description in + search"}),f.createEl("li",{text:"Static text: literal:My Custom Label"}),h.createEl("p",{text:"Filename, title, and aliases are always searchable by default.",cls:"settings-help-note"})}}var X_=require("obsidian");var Rp=require("obsidian"),Zv=class extends Rp.Modal{constructor(e,t){super(e),this.hasExistingData=t}show(){return new Promise(e=>{this.resolve=e,this.open()})}onOpen(){let{contentEl:e}=this;e.empty();let t=this.hasExistingData?"Migrate pomodoro data?":"Switch to daily notes storage?";new Rp.Setting(e).setName(t).setHeading();let r=this.hasExistingData?"This will migrate your existing pomodoro session data to daily notes frontmatter. The data will be grouped by date and stored in each daily note.":"Pomodoro session data will be stored in daily notes frontmatter instead of the plugin data file.",i=e.createEl("p").createEl("strong");i.textContent=r,e.createEl("br"),e.createEl("p",{text:"What this means:"});let a=e.createEl("ul");["Daily Notes core plugin must remain enabled","Data will be stored in your daily notes frontmatter",this.hasExistingData?"Existing plugin data will be migrated and then cleared":"Future sessions will be saved to daily notes","This provides better data longevity with your notes"].forEach(h=>{let f=a.createEl("li");f.textContent=`\u2022 ${h}`}),e.createEl("br");let l=e.createEl("p");if(this.hasExistingData){let h=l.createEl("strong");h.textContent="\u26A0\uFE0F Make sure you have backups if needed. This change cannot be automatically undone."}else l.textContent="You can switch back to plugin storage at any time in the future.";let c=e.createEl("div",{cls:"modal-button-container"});c.style.display="flex",c.style.gap="10px",c.style.justifyContent="flex-end",c.style.marginTop="20px",c.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.resolve(!1),this.close()});let u=c.createEl("button",{text:this.hasExistingData?"Migrate data":"Switch storage",cls:"mod-cta"});u.addEventListener("click",()=>{this.resolve(!0),this.close()}),window.setTimeout(()=>{u.focus()},50)}onClose(){let{contentEl:e}=this;e.empty(),this.resolve&&this.resolve(!1)}};async function D_(n,e){return new Zv(n,e).show()}Xv();function ea(n,e,t){n.empty(),Ce(n,"Inline Tasks"),xe(n,"Configure inline task features for seamless task management within any note."),be(n,{name:"Task link overlay",desc:"Show interactive overlays when hovering over task links",getValue:()=>e.settings.enableTaskLinkOverlay,setValue:async r=>{e.settings.enableTaskLinkOverlay=r,t()}}),be(n,{name:"Instant task convert",desc:"Enable instant conversion of text to tasks using keyboard shortcuts",getValue:()=>e.settings.enableInstantTaskConvert,setValue:async r=>{e.settings.enableInstantTaskConvert=r,t(),ea(n,e,t)}}),e.settings.enableInstantTaskConvert&&et(n,{name:"Inline task convert folder",desc:"Folder for inline task conversion. Use {{currentNotePath}} for relative to current note",placeholder:"TaskNotes",getValue:()=>e.settings.inlineTaskConvertFolder,setValue:async r=>{e.settings.inlineTaskConvertFolder=r,t()}}),Ce(n,"Natural Language Processing"),xe(n,"Enable smart parsing of task details from natural language input."),be(n,{name:"Enable natural language task input",desc:"Parse due dates, priorities, and contexts from natural language when creating tasks",getValue:()=>e.settings.enableNaturalLanguageInput,setValue:async r=>{e.settings.enableNaturalLanguageInput=r,t(),ea(n,e,t)}}),e.settings.enableNaturalLanguageInput&&(be(n,{name:"Default to scheduled",desc:"When NLP detects a date without context, treat it as scheduled rather than due",getValue:()=>e.settings.nlpDefaultToScheduled,setValue:async r=>{e.settings.nlpDefaultToScheduled=r,t()}}),gt(n,{name:"NLP language",desc:"Language for natural language processing patterns and date parsing",options:Z_(),getValue:()=>e.settings.nlpLanguage,setValue:async r=>{e.settings.nlpLanguage=r,t()}}),et(n,{name:"Status suggestion trigger",desc:"Text to trigger status suggestions (leave empty to disable)",placeholder:"@",getValue:()=>e.settings.statusSuggestionTrigger,setValue:async r=>{e.settings.statusSuggestionTrigger=r,t()}})),Ce(n,"Pomodoro Timer"),xe(n,"Built-in Pomodoro timer for time management and productivity tracking."),zr(n,{name:"Work duration",desc:"Duration of work intervals in minutes",placeholder:"25",min:1,max:120,getValue:()=>e.settings.pomodoroWorkDuration,setValue:async r=>{e.settings.pomodoroWorkDuration=r,t()}}),zr(n,{name:"Short break duration",desc:"Duration of short breaks in minutes",placeholder:"5",min:1,max:60,getValue:()=>e.settings.pomodoroShortBreakDuration,setValue:async r=>{e.settings.pomodoroShortBreakDuration=r,t()}}),zr(n,{name:"Long break duration",desc:"Duration of long breaks in minutes",placeholder:"15",min:1,max:120,getValue:()=>e.settings.pomodoroLongBreakDuration,setValue:async r=>{e.settings.pomodoroLongBreakDuration=r,t()}}),zr(n,{name:"Long break interval",desc:"Number of work sessions before a long break",placeholder:"4",min:1,max:10,getValue:()=>e.settings.pomodoroLongBreakInterval,setValue:async r=>{e.settings.pomodoroLongBreakInterval=r,t()}}),be(n,{name:"Auto-start breaks",desc:"Automatically start break timers after work sessions",getValue:()=>e.settings.pomodoroAutoStartBreaks,setValue:async r=>{e.settings.pomodoroAutoStartBreaks=r,t()}}),be(n,{name:"Auto-start work",desc:"Automatically start work sessions after breaks",getValue:()=>e.settings.pomodoroAutoStartWork,setValue:async r=>{e.settings.pomodoroAutoStartWork=r,t()}}),be(n,{name:"Pomodoro notifications",desc:"Show notifications when Pomodoro sessions end",getValue:()=>e.settings.pomodoroNotifications,setValue:async r=>{e.settings.pomodoroNotifications=r,t()}}),be(n,{name:"Sound enabled",desc:"Play sound when Pomodoro sessions end",getValue:()=>e.settings.pomodoroSoundEnabled,setValue:async r=>{e.settings.pomodoroSoundEnabled=r,t(),ea(n,e,t)}}),e.settings.pomodoroSoundEnabled&&zr(n,{name:"Sound volume",desc:"Volume for Pomodoro sounds (0-100)",placeholder:"50",min:0,max:100,getValue:()=>e.settings.pomodoroSoundVolume,setValue:async r=>{e.settings.pomodoroSoundVolume=r,t()}}),gt(n,{name:"Pomodoro data storage",desc:"Where to store Pomodoro session history",options:[{value:"plugin",label:"Plugin data (recommended)"},{value:"daily-notes",label:"Daily notes"}],getValue:()=>e.settings.pomodoroStorageLocation,setValue:async r=>{let s=r;if(s!==e.settings.pomodoroStorageLocation){let i=await e.loadData(),a=(i==null?void 0:i.pomodoroHistory)&&Array.isArray(i.pomodoroHistory)&&i.pomodoroHistory.length>0;await D_(e.app,a)?(e.settings.pomodoroStorageLocation=s,t(),new X_.Notice(`Pomodoro storage location changed to ${s==="plugin"?"plugin data":"daily notes"}`)):ea(n,e,t)}}}),Ce(n,"Notifications"),xe(n,"Configure task reminder notifications and alerts."),be(n,{name:"Enable notifications",desc:"Enable task reminder notifications",getValue:()=>e.settings.enableNotifications,setValue:async r=>{e.settings.enableNotifications=r,t(),ea(n,e,t)}}),e.settings.enableNotifications&&gt(n,{name:"Notification type",desc:"Type of notifications to show",options:[{value:"in-app",label:"In-app notifications"},{value:"system",label:"System notifications"}],getValue:()=>e.settings.notificationType,setValue:async r=>{e.settings.notificationType=r,t()}}),Ce(n,"Performance & Behavior"),xe(n,"Configure plugin performance and behavioral options."),be(n,{name:"Hide completed tasks from overdue",desc:"Exclude completed tasks from overdue task calculations",getValue:()=>e.settings.hideCompletedFromOverdue,setValue:async r=>{e.settings.hideCompletedFromOverdue=r,t()}}),be(n,{name:"Disable note indexing",desc:"Disable automatic indexing of notes for better performance (may reduce some features)",getValue:()=>e.settings.disableNoteIndexing,setValue:async r=>{e.settings.disableNoteIndexing=r,t()}}),e.settings.suggestionDebounceMs!==void 0&&zr(n,{name:"Suggestion debounce",desc:"Debounce delay for file suggestions in milliseconds (0 = disabled)",placeholder:"300",min:0,max:2e3,getValue:()=>e.settings.suggestionDebounceMs||0,setValue:async r=>{e.settings.suggestionDebounceMs=r>0?r:void 0,t()}}),Ce(n,"Time Tracking"),xe(n,"Configure automatic time tracking behaviors."),be(n,{name:"Auto-stop tracking on complete",desc:"Automatically stop time tracking when a task is marked complete",getValue:()=>e.settings.autoStopTimeTrackingOnComplete,setValue:async r=>{e.settings.autoStopTimeTrackingOnComplete=r,t()}}),be(n,{name:"Time tracking stop notification",desc:"Show notification when time tracking is automatically stopped",getValue:()=>e.settings.autoStopTimeTrackingNotification,setValue:async r=>{e.settings.autoStopTimeTrackingNotification=r,t()}}),Ce(n,"Recurring Tasks"),xe(n,"Configure behavior for recurring task management."),be(n,{name:"Maintain due date offset in recurring tasks",desc:"When completing recurring tasks, maintain the offset between due and scheduled dates",getValue:()=>e.settings.maintainDueDateOffsetInRecurring,setValue:async r=>{e.settings.maintainDueDateOffsetInRecurring=r,t()}})}var ue=require("obsidian");async function eA(n,e=8080){let t=n.createEl("p",{text:"Loading API endpoints...",attr:{style:"color: var(--text-muted); font-style: italic; margin: 16px 0;"}});try{console.log(`Fetching API documentation from http://localhost:${e}/api/docs`);let r=await fetch(`http://localhost:${e}/api/docs`);if(console.log("API docs response:",r.status,r.statusText),!r.ok)throw new Error(`API unavailable (${r.status}: ${r.statusText})`);let s=await r.json();console.log("OpenAPI spec loaded:",s),t.remove();let i={};if(s.paths)for(let[a,o]of Object.entries(s.paths))for(let[l,c]of Object.entries(o)){let u=(c.tags||["General"])[0];i[u]||(i[u]=[]),i[u].push({method:l.toUpperCase(),path:a,summary:c.summary||c.description||"No description"})}Object.keys(i).length>0?Object.entries(i).forEach(([a,o])=>{n.createEl("h5",{text:a,attr:{style:"margin: 16px 0 8px 0; font-weight: 600; color: var(--text-normal);"}});let l=n.createEl("ul");o.forEach(c=>{l.createEl("li",{text:`${c.method} ${c.path} - ${c.summary}`})})}):n.createEl("p",{text:"No API endpoints found in specification.",attr:{style:"color: var(--text-muted); margin: 16px 0;"}})}catch(r){console.error("Error loading API endpoints:",r),t.remove(),n.createEl("p",{text:`API server not accessible (${r.message}). Ensure the TaskNotes API server is running on port ${e}.`,attr:{style:"color: var(--text-muted); font-style: italic; margin: 16px 0;"}})}}Op();function tA(n){let t=new Date().getTime()-n.getTime(),r=Math.floor(t/1e3),s=Math.floor(r/60),i=Math.floor(s/60),a=Math.floor(i/24);return a>0?`${a} day${a>1?"s":""} ago`:i>0?`${i} hour${i>1?"s":""} ago`:s>0?`${s} minute${s>1?"s":""} ago`:"Just now"}function to(n,e,t){n.empty(),Ce(n,"Bases integration"),xe(n,"Configure integration with the Obsidian Bases plugin. This is an experimental feature, and currently relies on undocumented Obsidian APIs. Behaviour may change or break. "),be(n,{name:"Enable Bases integration",desc:"Enable TaskNotes views to be used within Obsidian Bases plugin. Bases plugin must be enabled for this to work.",getValue:()=>e.settings.enableBases,setValue:async s=>{e.settings.enableBases=s,t(),s?new ue.Notice("Bases integration enabled. Please restart Obsidian to complete the setup."):new ue.Notice("Bases integration disabled. Please restart Obsidian to complete the removal.")}}),Ce(n,"Calendar subscriptions"),xe(n,"Subscribe to external calendars via ICS/iCal URLs to view events alongside your tasks."),et(n,{name:"Default note template",desc:"Path to template file for notes created from ICS events",placeholder:"Templates/Event Template.md",getValue:()=>e.settings.icsIntegration.defaultNoteTemplate,setValue:async s=>{e.settings.icsIntegration.defaultNoteTemplate=s,t()}}),et(n,{name:"Default note folder",desc:"Folder for notes created from ICS events",placeholder:"Calendar/Events",getValue:()=>e.settings.icsIntegration.defaultNoteFolder,setValue:async s=>{e.settings.icsIntegration.defaultNoteFolder=s,t()}}),gt(n,{name:"ICS note filename format",desc:"How filenames are generated for notes created from ICS events",options:[{value:"title",label:"Event title"},{value:"zettel",label:"Zettelkasten format"},{value:"timestamp",label:"Timestamp"},{value:"custom",label:"Custom template"}],getValue:()=>e.settings.icsIntegration.icsNoteFilenameFormat,setValue:async s=>{e.settings.icsIntegration.icsNoteFilenameFormat=s,t(),to(n,e,t)}}),e.settings.icsIntegration.icsNoteFilenameFormat==="custom"&&et(n,{name:"Custom ICS filename template",desc:"Template for custom ICS event filenames",placeholder:"{date}-{title}",getValue:()=>e.settings.icsIntegration.customICSNoteFilenameTemplate,setValue:async s=>{e.settings.icsIntegration.customICSNoteFilenameTemplate=s,t()}}),Ce(n,"Calendar subscriptions list");let r=n.createDiv("ics-subscriptions-container");if(Dl(r,e,t),Za(n,{name:"Add Calendar Subscription",desc:"Add a new calendar subscription from ICS/iCal URL or local file",buttonText:"Add Subscription",onClick:async()=>{let s={name:"New Calendar",url:"",color:"#6366f1",enabled:!1,type:"remote",refreshInterval:60};if(!e.icsSubscriptionService){new ue.Notice("ICS subscription service not available");return}try{await e.icsSubscriptionService.addSubscription(s),new ue.Notice("New calendar subscription added - please configure the details"),Dl(r,e,t)}catch(i){console.error("Error adding subscription:",i),new ue.Notice("Failed to add subscription")}}}),Za(n,{name:"Refresh all subscriptions",desc:"Manually refresh all enabled calendar subscriptions",buttonText:"Refresh All",onClick:async()=>{if(e.icsSubscriptionService)try{await e.icsSubscriptionService.refreshAllSubscriptions(),new ue.Notice("All calendar subscriptions refreshed successfully")}catch(s){console.error("Error refreshing subscriptions:",s),new ue.Notice("Failed to refresh some calendar subscriptions")}}}),Ce(n,"Automatic ICS export"),xe(n,"Automatically export all your tasks to an ICS file."),be(n,{name:"Enable automatic export",desc:"Automatically keep an ICS file updated with all your tasks",getValue:()=>e.settings.icsIntegration.enableAutoExport,setValue:async s=>{e.settings.icsIntegration.enableAutoExport=s,t(),new ue.Notice("Please reload Obsidian for the automatic export changes to take effect."),to(n,e,t)}}),e.settings.icsIntegration.enableAutoExport){et(n,{name:"Export file path",desc:"Path where the ICS file will be saved (relative to vault root)",placeholder:"tasknotes-calendar.ics",getValue:()=>e.settings.icsIntegration.autoExportPath,setValue:async i=>{e.settings.icsIntegration.autoExportPath=i||"tasknotes-calendar.ics",t()}}),zr(n,{name:"Update interval (between 5 and 1440 minutes)",desc:"How often to update the export file",placeholder:"60",min:5,max:1440,getValue:()=>e.settings.icsIntegration.autoExportInterval,setValue:async i=>{e.settings.icsIntegration.autoExportInterval=Math.max(5,i||60),t(),e.autoExportService&&e.autoExportService.updateInterval(e.settings.icsIntegration.autoExportInterval)}});let s=n.createDiv("auto-export-status");if(s.style.marginTop="10px",s.style.padding="10px",s.style.backgroundColor="var(--background-secondary)",s.style.borderRadius="4px",e.autoExportService){let i=e.autoExportService.getLastExportTime(),a=e.autoExportService.getNextExportTime();s.innerHTML=`
                <div style="font-weight: 500; margin-bottom: 5px;">Export Status:</div>
                <div style="font-size: 0.9em; opacity: 0.8;">
                    ${i?`Last export: ${i.toLocaleString()}`:"No exports yet"}<br>
                    ${a?`Next export: ${a.toLocaleString()}`:"Not scheduled"}
                </div>
            `}else s.innerHTML=`
                <div style="font-weight: 500; color: var(--text-warning);">
                    Auto export service not initialized - please restart Obsidian
                </div>
            `;Za(n,{name:"Export now",desc:"Manually trigger an immediate export",buttonText:"Export Now",onClick:async()=>{if(e.autoExportService)try{await e.autoExportService.exportNow(),new ue.Notice("Tasks exported successfully"),to(n,e,t)}catch(i){console.error("Manual export failed:",i),new ue.Notice("Export failed - check console for details")}else new ue.Notice("Auto export service not available")}})}if(!ue.Platform.isMobile){if(Ce(n,"HTTP API"),xe(n,"Enable HTTP API for external integrations and automations."),be(n,{name:"Enable HTTP API",desc:"Start local HTTP server for API access",getValue:()=>e.settings.enableAPI,setValue:async i=>{e.settings.enableAPI=i,t(),to(n,e,t)}}),e.settings.enableAPI){zr(n,{name:"API port",desc:"Port number for the HTTP API server",placeholder:"3000",min:1024,max:65535,getValue:()=>e.settings.apiPort,setValue:async d=>{e.settings.apiPort=d,t()}}),et(n,{name:"API authentication token",desc:"Token required for API authentication (leave empty for no auth)",placeholder:"your-secret-token",getValue:()=>e.settings.apiAuthToken,setValue:async d=>{e.settings.apiAuthToken=d,t()}});let i=n.createDiv("tasknotes-settings__help-section"),a=i.createDiv("tasknotes-settings__collapsible-header"),o=a.createDiv("tasknotes-settings__collapsible-header-content"),l=o.createSpan("tasknotes-settings__collapsible-icon");l.textContent="\u25B6",o.createSpan({text:"Available API Endpoints",cls:"tasknotes-settings__collapsible-title"});let c=i.createDiv("tasknotes-settings__collapsible-content");c.style.display="none",a.addEventListener("click",()=>{let d=c.style.display!=="none";c.style.display=d?"none":"block",l.textContent=d?"\u25B6":"\u25BC"}),eA(c,e.settings.apiPort)}Ce(n,"Webhooks");let s=n.createDiv("setting-item-description");s.createEl("p",{text:"Webhooks send real-time notifications to external services when TaskNotes events occur."}),s.createEl("p",{text:"Configure webhooks to integrate with automation tools, sync services, or custom applications."}),Lp(n,e,t),Za(n,{name:"Add Webhook",desc:"Register a new webhook endpoint",buttonText:"Add Webhook",onClick:async()=>{new sT(e.app,async a=>{var l;let o={id:`wh_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,url:a.url||"",events:a.events||[],secret:TW(),active:!0,createdAt:new Date().toISOString(),failureCount:0,successCount:0,transformFile:a.transformFile,corsHeaders:a.corsHeaders};e.settings.webhooks||(e.settings.webhooks=[]),e.settings.webhooks.push(o),t(),Lp(((l=n.querySelector(".tasknotes-webhooks-container"))==null?void 0:l.parentElement)||n,e,t),new tT(e.app,o.secret).open(),new ue.Notice("Webhook created successfully")}).open()}})}Ce(n,"Other plugin integrations"),xe(n,"Configure integrations with other Obsidian plugins.")}function Dl(n,e,t){if(n.empty(),!e.icsSubscriptionService){xe(n,"ICS subscription service not available.");return}let r=e.icsSubscriptionService.getSubscriptions();if(r.length===0){let s=n.createDiv("tasknotes-webhooks-empty-state");s.createSpan("tasknotes-webhooks-empty-icon"),s.createSpan({text:"No calendar subscriptions configured. Add a subscription to sync external calendars.",cls:"tasknotes-webhooks-empty-text"});return}r.forEach(s=>{let i=Nt("checkbox");i.checked=s.enabled;let a=Nt("text","Calendar name",s.name),o=document.createElement("select");o.className="tasknotes-settings__card-input",o.innerHTML=`
            <option value="remote" ${s.type==="remote"?"selected":""}>Remote URL</option>
            <option value="local" ${s.type==="local"?"selected":""}>Local File</option>
        `;let l;if(s.type==="remote")l=Mp("ICS/iCal URL",s.url);else{let y=Nt("text","Local file path (e.g., Calendar.ics)",s.filePath||"");y.setAttribute("placeholder","Calendar.ics"),l=y}let c=Nt("color","",s.color),d=Xa(5,1440,5,s.refreshInterval||60),u=async y=>{try{await e.icsSubscriptionService.updateSubscription(s.id,y),t(),Dl(n,e,t)}catch(T){console.error("Error updating subscription:",T),new ue.Notice("Failed to update subscription"),Dl(n,e,t)}};i.addEventListener("change",()=>u({enabled:i.checked})),a.addEventListener("blur",()=>u({name:a.value.trim()})),c.addEventListener("change",()=>u({color:c.value})),d.addEventListener("blur",()=>{let y=parseInt(d.value)||60;u({refreshInterval:y})}),o.addEventListener("change",async()=>{let y=o.value,T=s.type;s.type=y,y==="remote"?(s.url=s.filePath||"",s.filePath=void 0):(s.filePath=s.url||"",s.url=void 0),t();let w=o.closest(".tasknotes-settings__card");if(w){let b=w.querySelector(".tasknotes-settings__card-config-row:nth-child(4)");if(b){let S=b.querySelector("input");S&&S.remove();let k;if(y==="remote")k=Mp("ICS/iCal URL",s.url);else{let W=Nt("text","Local file path (e.g., Calendar.ics)",s.filePath||"");W.setAttribute("placeholder","Calendar.ics"),k=W}k.addEventListener("blur",()=>{let W=k.value.trim();s.type==="remote"?u({url:W}):u({filePath:W})}),b.appendChild(k);let D=b.querySelector(".tasknotes-settings__card-config-label");D&&(D.textContent=y==="remote"?"URL:":"File Path:");let M=w.querySelector(".tasknotes-settings__card-secondary-text");M&&(M.textContent=y==="remote"?"Remote Calendar":"Local File");let _=w.querySelector(".tasknotes-settings__card-meta .info-badge");_&&(_.textContent=y==="remote"?"Remote":"Local File")}}}),l.addEventListener("blur",()=>{let y=l.value.trim();s.type==="remote"?u({url:y}):u({filePath:y})});let h=Zi(s.enabled?"Enabled":"Disabled",s.enabled?"active":"inactive"),f=bl(s.type==="remote"?"Remote":"Local File"),p=[h,f];if(s.lastFetched){let y=new Date(s.lastFetched),T=tA(y),w=bl(`Synced ${T}`);p.push(w)}if(s.lastError){let y=Zi("Error","inactive");y.title=s.lastError,p.push(y)}let m=[{label:"Enabled:",input:i},{label:"Name:",input:a},{label:"Type:",input:o},{label:s.type==="remote"?"URL:":"File Path:",input:l},{label:"Color:",input:c},{label:"Refresh (min):",input:d}],g=Pn(n,{id:s.id,collapsible:!0,defaultCollapsed:!0,colorIndicator:{color:s.color},header:{primaryText:s.name,secondaryText:s.type==="remote"?"Remote Calendar":"Local File",meta:p,actions:[In(async()=>{if(await ta(e.app,{title:"Delete Subscription",message:`Are you sure you want to delete the subscription "${s.name}"? This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0}))try{await e.icsSubscriptionService.removeSubscription(s.id),new ue.Notice(`Deleted subscription "${s.name}"`),t(),Dl(n,e,t)}catch(T){console.error("Error deleting subscription:",T),new ue.Notice("Failed to delete subscription")}},"Delete subscription")]},content:{sections:[{rows:m}]},actions:{buttons:[{text:"Refresh Now",icon:"refresh-cw",variant:s.enabled?"primary":"secondary",disabled:!s.enabled,onClick:async()=>{if(!s.enabled){new ue.Notice("Enable the subscription first");return}try{await e.icsSubscriptionService.refreshSubscription(s.id),new ue.Notice(`Refreshed "${s.name}"`),Dl(n,e,t)}catch(y){console.error("Error refreshing subscription:",y),new ue.Notice("Failed to refresh subscription")}}}]}})})}function Lp(n,e,t){let r=n.querySelector(".tasknotes-webhooks-container");r&&r.remove();let s=n.createDiv("tasknotes-webhooks-container");if(!e.settings.webhooks||e.settings.webhooks.length===0){Ji(s,"No webhooks configured. Add a webhook to receive real-time notifications.","Add Webhook",()=>{var a;let i=(a=n.closest(".settings-tab-content"))==null?void 0:a.querySelector("button.tn-btn--primary");i&&i.click()});return}e.settings.webhooks.forEach((i,a)=>{let o=Zi(i.active?"Active":"Inactive",i.active?"active":"inactive"),l=bl(`\u2713 ${i.successCount||0}`),c=bl(`\u2717 ${i.failureCount||0}`),d=Mp("Webhook URL",i.url),u=Nt("checkbox");u.checked=i.active,d.addEventListener("blur",()=>{d.value.trim()!==i.url&&(i.url=d.value.trim(),t(),new ue.Notice("Webhook URL updated"))}),u.addEventListener("change",()=>{i.active=u.checked,t();let g=u.closest(".tasknotes-settings__card");if(g){let y=g.querySelector(".tasknotes-settings__card-status-badge--active, .tasknotes-settings__card-status-badge--inactive");y&&(y.textContent=i.active?"Active":"Inactive",y.className=i.active?"tasknotes-settings__card-status-badge tasknotes-settings__card-status-badge--active":"tasknotes-settings__card-status-badge tasknotes-settings__card-status-badge--inactive");let T=g.querySelector('[aria-label*="Test"]');T&&(T.disabled=!i.active||!i.url)}new ue.Notice(`Webhook ${i.active?"enabled":"disabled"}`)});let h=i.createdAt?new Date(i.createdAt):null,f=h?`Created ${tA(h)}`:"Creation date unknown",p=document.createElement("div");if(p.style.display="flex",p.style.flexWrap="wrap",p.style.gap="0.5rem",p.style.alignItems="center",p.style.minHeight="1.5rem",p.style.lineHeight="1.5rem",i.events.length===0){let g=document.createElement("span");g.textContent="No events selected",g.style.color="var(--text-muted)",g.style.fontStyle="italic",g.style.lineHeight="1.5rem",p.appendChild(g)}else i.events.forEach((g,y)=>{let T=bl(g);T.style.marginBottom="0",T.style.flexShrink="0",p.appendChild(T)});let m=i.transformFile?(()=>{let g=document.createElement("span");return g.textContent=i.transformFile,g.style.fontFamily="monospace",g.style.fontSize="0.85rem",g.style.color="var(--text-muted)",g.style.lineHeight="1.5rem",g.style.padding="0.25rem 0.5rem",g.style.background="var(--background-modifier-form-field)",g.style.borderRadius="4px",g.style.border="1px solid var(--background-modifier-border)",g})():(()=>{let g=document.createElement("span");return g.textContent="Raw payload (no transform)",g.style.color="var(--text-muted)",g.style.fontStyle="italic",g.style.lineHeight="1.5rem",g})();Pn(s,{id:i.id,collapsible:!0,defaultCollapsed:!0,header:{primaryText:"Webhook",secondaryText:f,meta:[o,l,c],actions:[In(async()=>{await ta(e.app,{title:"Delete Webhook",message:`Are you sure you want to delete this webhook?

URL: ${i.url}

This action cannot be undone.`,confirmText:"Delete",cancelText:"Cancel",isDestructive:!0})&&(e.settings.webhooks.splice(a,1),t(),Lp(n,e,t),new ue.Notice("Webhook deleted"))})]},content:{sections:[{rows:[{label:"Active:",input:u},{label:"URL:",input:d},{label:"Events:",input:p},{label:"Transform:",input:m}]}]},actions:{buttons:[{text:"Edit Events",icon:"settings",variant:"secondary",onClick:async()=>{new rT(e.app,i,async y=>{Object.assign(i,y),t(),Lp(n,e,t),new ue.Notice("Webhook updated")}).open()}}]}})})}function TW(){return Array.from(crypto.getRandomValues(new Uint8Array(32))).map(n=>n.toString(16).padStart(2,"0")).join("")}var tT=class extends ue.Modal{constructor(e,t){super(e),this.secret=t}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-webhook-modal");let t=e.createDiv({cls:"tasknotes-webhook-secret-notice"}),r=t.createDiv({cls:"tasknotes-webhook-secret-title"}),s=r.createSpan();(0,ue.setIcon)(s,"shield-check"),r.createSpan({text:"Webhook Secret Generated"});let i=t.createDiv({cls:"tasknotes-webhook-secret-content"});i.createEl("p",{text:"Your webhook secret has been generated. Save this secret as you won't be able to view it again:"}),i.createEl("code",{text:this.secret,cls:"tasknotes-webhook-secret-code"}),i.createEl("p",{text:"Use this secret to verify webhook payloads in your receiving application."});let o=e.createDiv({cls:"tasknotes-webhook-modal-buttons"}).createEl("button",{text:"Got it",cls:"tasknotes-webhook-modal-btn save"});o.onclick=()=>this.close()}onClose(){let{contentEl:e}=this;e.empty()}},rT=class extends ue.Modal{constructor(e,t,r){var s;super(e),this.webhook=t,this.selectedEvents=[...t.events],this.transformFile=t.transformFile||"",this.corsHeaders=(s=t.corsHeaders)!=null?s:!0,this.onSubmit=r}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("tasknotes-webhook-modal");let t=e.createDiv({cls:"tasknotes-webhook-modal-header"}),r=t.createSpan({cls:"tasknotes-webhook-modal-icon"});(0,ue.setIcon)(r,"webhook"),t.createEl("h2",{text:"Edit Webhook",cls:"tasknotes-webhook-modal-title"});let s=e.createDiv({cls:"tasknotes-webhook-modal-section"}),i=s.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),a=i.createSpan();(0,ue.setIcon)(a,"zap"),i.createEl("h3",{text:"Events to subscribe to"});let o=s.createDiv({cls:"tasknotes-webhook-events-list"});[{id:"task.created",label:"Task Created",desc:"When new tasks are created"},{id:"task.updated",label:"Task Updated",desc:"When tasks are modified"},{id:"task.completed",label:"Task Completed",desc:"When tasks are marked complete"},{id:"task.deleted",label:"Task Deleted",desc:"When tasks are deleted"},{id:"task.archived",label:"Task Archived",desc:"When tasks are archived"},{id:"task.unarchived",label:"Task Unarchived",desc:"When tasks are unarchived"},{id:"time.started",label:"Time Started",desc:"When time tracking starts"},{id:"time.stopped",label:"Time Stopped",desc:"When time tracking stops"},{id:"pomodoro.started",label:"Pomodoro Started",desc:"When pomodoro sessions begin"},{id:"pomodoro.completed",label:"Pomodoro Completed",desc:"When pomodoro sessions finish"},{id:"pomodoro.interrupted",label:"Pomodoro Interrupted",desc:"When pomodoro sessions are stopped"},{id:"recurring.instance.completed",label:"Recurring Instance Completed",desc:"When recurring task instances complete"},{id:"reminder.triggered",label:"Reminder Triggered",desc:"When task reminders activate"}].forEach(b=>{new ue.Setting(o).setName(b.label).setDesc(b.desc).addToggle(S=>(S.toggleEl.setAttribute("aria-label",`Subscribe to ${b.label} events`),S.setValue(this.selectedEvents.includes(b.id)).onChange(k=>{if(k)this.selectedEvents.push(b.id);else{let D=this.selectedEvents.indexOf(b.id);D>-1&&this.selectedEvents.splice(D,1)}})))});let c=e.createDiv({cls:"tasknotes-webhook-modal-section"}),d=c.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),u=d.createSpan();(0,ue.setIcon)(u,"file-code"),d.createEl("h3",{text:"Transform Configuration (Optional)"}),new ue.Setting(c).setName("Transform File").setDesc("Path to a .js or .json file in your vault that transforms webhook payloads").addText(b=>(b.inputEl.setAttribute("aria-label","Transform file path"),b.setPlaceholder("discord-transform.js").setValue(this.transformFile).onChange(S=>{this.transformFile=S})));let h=e.createDiv({cls:"tasknotes-webhook-modal-section"}),f=h.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),p=f.createSpan();(0,ue.setIcon)(p,"settings"),f.createEl("h3",{text:"Headers Configuration"}),new ue.Setting(h).setName("Include custom headers").setDesc("Include TaskNotes headers (event type, signature, delivery ID). Turn off for Discord, Slack, and other services with strict CORS policies.").addToggle(b=>(b.toggleEl.setAttribute("aria-label","Include custom headers"),b.setValue(this.corsHeaders).onChange(S=>{this.corsHeaders=S})));let m=e.createDiv({cls:"tasknotes-webhook-modal-buttons"}),g=m.createEl("button",{text:"Cancel",cls:"tasknotes-webhook-modal-btn cancel",attr:{"aria-label":"Cancel webhook editing"}}),y=g.createSpan({cls:"tasknotes-webhook-modal-btn-icon"});(0,ue.setIcon)(y,"x"),g.onclick=()=>this.close();let T=m.createEl("button",{text:"Save Changes",cls:"tasknotes-webhook-modal-btn save mod-cta",attr:{"aria-label":"Save webhook changes"}}),w=T.createSpan({cls:"tasknotes-webhook-modal-btn-icon"});(0,ue.setIcon)(w,"save"),T.onclick=()=>{if(this.selectedEvents.length===0){new ue.Notice("Please select at least one event");return}this.onSubmit({events:this.selectedEvents,transformFile:this.transformFile.trim()||void 0,corsHeaders:this.corsHeaders}),this.close()}}onClose(){let{contentEl:e}=this;e.empty()}},sT=class extends ue.Modal{constructor(t,r){super(t);this.url="";this.selectedEvents=[];this.transformFile="";this.corsHeaders=!0;this.onSubmit=r}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("tasknotes-webhook-modal");let r=t.createDiv({cls:"tasknotes-webhook-modal-header"}),s=r.createSpan({cls:"tasknotes-webhook-modal-icon"});(0,ue.setIcon)(s,"webhook"),r.createEl("h2",{text:"Add Webhook",cls:"tasknotes-webhook-modal-title"});let i=t.createDiv({cls:"tasknotes-webhook-modal-section"});new ue.Setting(i).setName("Webhook URL").setDesc("The endpoint where webhook payloads will be sent").addText(C=>(C.inputEl.setAttribute("aria-label","Webhook URL"),C.setPlaceholder("https://your-service.com/webhook").setValue(this.url).onChange(P=>{this.url=P})));let a=t.createDiv({cls:"tasknotes-webhook-modal-section"}),o=a.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),l=o.createSpan();(0,ue.setIcon)(l,"zap"),o.createEl("h3",{text:"Events to subscribe to"});let c=a.createDiv({cls:"tasknotes-webhook-events-list"});[{id:"task.created",label:"Task Created",desc:"When new tasks are created"},{id:"task.updated",label:"Task Updated",desc:"When tasks are modified"},{id:"task.completed",label:"Task Completed",desc:"When tasks are marked complete"},{id:"task.deleted",label:"Task Deleted",desc:"When tasks are deleted"},{id:"task.archived",label:"Task Archived",desc:"When tasks are archived"},{id:"task.unarchived",label:"Task Unarchived",desc:"When tasks are unarchived"},{id:"time.started",label:"Time Started",desc:"When time tracking starts"},{id:"time.stopped",label:"Time Stopped",desc:"When time tracking stops"},{id:"pomodoro.started",label:"Pomodoro Started",desc:"When pomodoro sessions begin"},{id:"pomodoro.completed",label:"Pomodoro Completed",desc:"When pomodoro sessions finish"},{id:"pomodoro.interrupted",label:"Pomodoro Interrupted",desc:"When pomodoro sessions are stopped"},{id:"recurring.instance.completed",label:"Recurring Instance Completed",desc:"When recurring task instances complete"},{id:"reminder.triggered",label:"Reminder Triggered",desc:"When task reminders activate"}].forEach(C=>{new ue.Setting(c).setName(C.label).setDesc(C.desc).addToggle(P=>(P.toggleEl.setAttribute("aria-label",`Subscribe to ${C.label} events`),P.setValue(this.selectedEvents.includes(C.id)).onChange(U=>{if(U)this.selectedEvents.push(C.id);else{let H=this.selectedEvents.indexOf(C.id);H>-1&&this.selectedEvents.splice(H,1)}})))});let u=t.createDiv({cls:"tasknotes-webhook-modal-section"}),h=u.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),f=h.createSpan();(0,ue.setIcon)(f,"file-code"),h.createEl("h3",{text:"Transform Configuration (Optional)"}),new ue.Setting(u).setName("Transform File").setDesc("Path to a .js or .json file in your vault that transforms webhook payloads").addText(C=>(C.inputEl.setAttribute("aria-label","Transform file path"),C.setPlaceholder("discord-transform.js").setValue(this.transformFile).onChange(P=>{this.transformFile=P})));let p=u.createDiv({cls:"tasknotes-webhook-transform-help"}),m=p.createDiv({cls:"tasknotes-webhook-help-header"}),g=m.createSpan();(0,ue.setIcon)(g,"info"),m.createSpan({text:"Transform files allow you to customize webhook payloads:"});let y=p.createEl("ul",{cls:"tasknotes-webhook-help-list"}),T=y.createEl("li");T.createEl("strong",{text:".js files:"}),T.appendText(" Custom JavaScript transforms");let w=y.createEl("li");w.createEl("strong",{text:".json files:"}),w.appendText(" Templates with "),w.createEl("code",{text:"${data.task.title}"});let b=y.createEl("li");b.createEl("strong",{text:"Leave empty:"}),b.appendText(" Send raw data");let S=p.createDiv({cls:"tasknotes-webhook-help-example"});S.createEl("strong",{text:"Example:"}),S.appendText(" "),S.createEl("code",{text:"discord-transform.js"});let k=t.createDiv({cls:"tasknotes-webhook-modal-section"}),D=k.createDiv({cls:"tasknotes-webhook-modal-subsection-header"}),M=D.createSpan();(0,ue.setIcon)(M,"settings"),D.createEl("h3",{text:"Headers Configuration"}),new ue.Setting(k).setName("Include custom headers").setDesc("Include TaskNotes headers (event type, signature, delivery ID). Turn off for Discord, Slack, and other services with strict CORS policies.").addToggle(C=>(C.toggleEl.setAttribute("aria-label","Include custom headers"),C.setValue(this.corsHeaders).onChange(P=>{this.corsHeaders=P})));let _=t.createDiv({cls:"tasknotes-webhook-modal-buttons"}),W=_.createEl("button",{text:"Cancel",cls:"tasknotes-webhook-modal-btn cancel",attr:{"aria-label":"Cancel webhook creation"}}),j=W.createSpan({cls:"tasknotes-webhook-modal-btn-icon"});(0,ue.setIcon)(j,"x"),W.onclick=()=>this.close();let R=_.createEl("button",{text:"Add Webhook",cls:"tasknotes-webhook-modal-btn save mod-cta",attr:{"aria-label":"Create webhook"}}),O=R.createSpan({cls:"tasknotes-webhook-modal-btn-icon"});(0,ue.setIcon)(O,"plus"),R.onclick=()=>{if(!this.url.trim()){new ue.Notice("Webhook URL is required");return}if(this.selectedEvents.length===0){new ue.Notice("Please select at least one event");return}this.onSubmit({url:this.url.trim(),events:this.selectedEvents,transformFile:this.transformFile.trim()||void 0,corsHeaders:this.corsHeaders}),this.close()}}onClose(){let{contentEl:t}=this;t.empty()}};var Fp=class extends pd.PluginSettingTab{constructor(t,r){super(t,r);this.activeTab="general";this.tabContents={};this.debouncedSave=T_(()=>this.plugin.saveSettings(),500,!0);this.plugin=r}display(){let{containerEl:t}=this;t.empty(),t.addClass("tasknotes-settings"),t.addClass("tasknotes-plugin"),t.addClass("settings-view");let r=t.createDiv("settings-tab-nav settings-view__tab-nav"),s=[{id:"general",name:"General",renderFn:fd},{id:"task-properties",name:"Task Properties",renderFn:Ap},{id:"defaults",name:"Defaults & Templates",renderFn:Ip},{id:"appearance",name:"Appearance & UI",renderFn:Nn},{id:"features",name:"Features",renderFn:ea},{id:"integrations",name:"Integrations",renderFn:to}],i=pd.Platform.isMobile?s.filter(o=>o.id!=="integrations"||this.hasNonAPIIntegrations()):s;pd.Platform.isMobile&&this.activeTab==="integrations"&&!this.hasNonAPIIntegrations()&&(this.activeTab="general"),i.forEach(o=>{let l=this.activeTab===o.id,c=r.createEl("button",{text:o.name,cls:l?"settings-tab-button settings-view__tab-button active settings-view__tab-button--active":"settings-tab-button settings-view__tab-button",attr:{role:"tab","aria-selected":l.toString(),"aria-controls":`settings-tab-${o.id}`,id:`tab-button-${o.id}`,tabindex:l?"0":"-1"}});c.addEventListener("click",()=>{this.switchTab(o.id)}),c.addEventListener("keydown",d=>{if(d.key==="ArrowLeft"||d.key==="ArrowRight"){d.preventDefault();let u=i.findIndex(p=>p.id===o.id),h=d.key==="ArrowRight"?(u+1)%i.length:(u-1+i.length)%i.length,f=i[h].id;this.switchTab(f)}})});let a=t.createDiv("settings-tab-contents settings-view__tab-contents");i.forEach(o=>{let l=a.createDiv("settings-tab-content settings-view__tab-content");l.setAttribute("role","tabpanel"),l.setAttribute("id",`settings-tab-${o.id}`),l.setAttribute("aria-labelledby",`tab-button-${o.id}`),this.activeTab===o.id&&(l.addClass("active"),l.addClass("settings-view__tab-content--active"),o.renderFn(l,this.plugin,this.debouncedSave)),this.tabContents[o.id]=l})}switchTab(t){this.activeTab=t,this.containerEl.querySelectorAll(".settings-tab-button").forEach(s=>{let i=s.id===`tab-button-${t}`;s.classList.toggle("active",i),s.classList.toggle("settings-view__tab-button--active",i),s.setAttribute("aria-selected",i.toString()),s.setAttribute("tabindex",i?"0":"-1")}),this.containerEl.querySelectorAll(".settings-tab-content").forEach(s=>{let i=s.id===`settings-tab-${t}`;s.classList.toggle("active",i),s.classList.toggle("settings-view__tab-content--active",i)});let r=this.tabContents[t];if(r&&r.children.length===0){let s=this.getTabConfigurations().find(i=>i.id===t);s&&s.renderFn(r,this.plugin,this.debouncedSave)}setTimeout(()=>{let s=this.containerEl.querySelector(`#tab-button-${t}`);s&&s.focus()},50)}getTabConfigurations(){return[{id:"general",name:"General",renderFn:fd},{id:"task-properties",name:"Task Properties",renderFn:Ap},{id:"defaults",name:"Defaults & Templates",renderFn:Ip},{id:"appearance",name:"Appearance & UI",renderFn:Nn},{id:"features",name:"Features",renderFn:ea},{id:"integrations",name:"Integrations",renderFn:to}]}hasNonAPIIntegrations(){return!0}};var Cl="tasknotes-mini-calendar-view",ui="tasknotes-advanced-calendar-view",Rs="tasknotes-task-list-view",md="tasknotes-notes-view",Qt="tasknotes-agenda-view",gd="tasknotes-pomodoro-view",yd="tasknotes-pomodoro-stats-view",vd="tasknotes-stats-view",hn="tasknotes-kanban-view",rA="tasknotes-subtask-widget-view",ra="date-selected";var fr="data-changed",tt="task-updated",Bp="task-deleted",Hp="pomodoro-start",Up="pomodoro-complete",Wp="pomodoro-interrupt",fn="pomodoro-tick",sA="timeblocking-toggled";var pn="date-changed",Td=[{id:"title",label:"Title",category:"text",supportedOperators:["is","is-not","contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"text"},{id:"path",label:"Path",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"status",label:"Status",category:"select",supportedOperators:["is","is-not","is-empty","is-not-empty"],valueInputType:"select"},{id:"priority",label:"Priority",category:"select",supportedOperators:["is","is-not","is-empty","is-not-empty"],valueInputType:"select"},{id:"tags",label:"Tags",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"contexts",label:"Contexts",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"projects",label:"Projects",category:"select",supportedOperators:["contains","does-not-contain","is-empty","is-not-empty"],valueInputType:"select"},{id:"due",label:"Due Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"scheduled",label:"Scheduled Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"completedDate",label:"Completed Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"file.ctime",label:"Created Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"file.mtime",label:"Modified Date",category:"date",supportedOperators:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],valueInputType:"date"},{id:"archived",label:"Archived",category:"boolean",supportedOperators:["is-checked","is-not-checked"],valueInputType:"none"},{id:"timeEstimate",label:"Time Estimate",category:"numeric",supportedOperators:["is","is-not","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal"],valueInputType:"number"},{id:"recurrence",label:"Recurrence",category:"special",supportedOperators:["is-empty","is-not-empty"],valueInputType:"none"},{id:"status.isCompleted",label:"Completed",category:"boolean",supportedOperators:["is-checked","is-not-checked"],valueInputType:"none"}],$p=[{id:"is",label:"is",requiresValue:!0},{id:"is-not",label:"is not",requiresValue:!0},{id:"contains",label:"contains",requiresValue:!0},{id:"does-not-contain",label:"does not contain",requiresValue:!0},{id:"is-before",label:"is before",requiresValue:!0},{id:"is-after",label:"is after",requiresValue:!0},{id:"is-on-or-before",label:"is on or before",requiresValue:!0},{id:"is-on-or-after",label:"is on or after",requiresValue:!0},{id:"is-empty",label:"is empty",requiresValue:!1},{id:"is-not-empty",label:"is not empty",requiresValue:!1},{id:"is-checked",label:"is checked",requiresValue:!1},{id:"is-not-checked",label:"is not checked",requiresValue:!1},{id:"is-greater-than",label:"is greater than",requiresValue:!0},{id:"is-less-than",label:"is less than",requiresValue:!0},{id:"is-greater-than-or-equal",label:"is equal or greater than",requiresValue:!0},{id:"is-less-than-or-equal",label:"is equal or less than",requiresValue:!0}];var Gr=require("obsidian");At();Fe();var am=ke(dn());Lt();var Hl=require("obsidian"),la=class la{constructor(){this.metrics=new Map;this.markers=new Map;this.enabled=!0;this.mutationObservers=new Set;this.performanceObservers=new Set}static getInstance(){return la.instance||(la.instance=new la),la.instance}startTimer(e){this.enabled&&this.markers.set(e,performance.now())}endTimer(e){if(!this.enabled)return 0;let t=this.markers.get(e);if(t===void 0)return e.includes("-measure-")||console.warn(`No start marker found for operation: ${e}`),0;let r=performance.now()-t;return this.recordMetric(e,r),this.markers.delete(e),r}async measure(e,t){if(!this.enabled)return t();let r=performance.now();try{return await t()}finally{let s=performance.now()-r;this.recordMetric(e,s)}}measureSync(e,t){if(!this.enabled)return t();let r=performance.now();try{return t()}finally{let s=performance.now()-r;this.recordMetric(e,s)}}recordMetric(e,t){if(!this.enabled)return;this.metrics.has(e)||this.metrics.set(e,[]);let r=this.metrics.get(e);r.push(t),r.length>50&&r.splice(0,r.length-50)}getStats(e){let t=this.metrics.get(e);if(!t||t.length===0)return null;let r=[...t].sort((a,o)=>a-o),s=r.length,i=r.reduce((a,o)=>a+o,0);return{count:s,average:i/s,min:r[0],max:r[s-1],median:r[Math.floor(s/2)],p95:r[Math.floor(s*.95)]}}getAllStats(){let e={};for(let[t]of this.metrics)e[t]=this.getStats(t);return e}logSummary(){if(!this.enabled)return;console.group("[Performance Summary]");let e=this.getAllStats();["cache-file-read","task-list-render","calendar-render","task-update","file-index","dom-update"].forEach(r=>{let s=e[r];s&&console.log(`${r}:`,{average:`${s.average.toFixed(2)}ms`,p95:`${s.p95.toFixed(2)}ms`,count:s.count})}),console.groupEnd()}monitorDOMMutations(e){if(!this.enabled)return()=>{};let t=0,r=performance.now(),s=new MutationObserver(i=>{t+=i.length;let a=performance.now()-r;t>100&&a<1e3&&console.warn(`High DOM mutation rate: ${t} mutations in ${a.toFixed(2)}ms`)});return s.observe(e,{childList:!0,subtree:!0,attributes:!0}),this.mutationObservers.add(s),()=>{s.disconnect(),this.mutationObservers.delete(s),this.recordMetric("dom-mutations",t)}}recordMemoryUsage(e){if(!this.enabled||!("memory"in performance))return;let t=performance.memory,r={used:t.usedJSHeapSize/1024/1024,total:t.totalJSHeapSize/1024/1024,limit:t.jsHeapSizeLimit/1024/1024},s=e?`memory-${e}`:"memory-usage";this.recordMetric(s,r.used),r.used>100&&console.warn(`High memory usage: ${r.used.toFixed(2)}MB`)}trackLongTasks(){if(!this.enabled||!("PerformanceObserver"in window))return()=>{};let e=new PerformanceObserver(t=>{for(let r of t.getEntries())r.duration>50&&(console.warn(`Long task detected: ${r.duration.toFixed(2)}ms`),this.recordMetric("long-task",r.duration))});try{e.observe({entryTypes:["longtask"]}),this.performanceObservers.add(e)}catch(t){console.warn("Long task monitoring not supported")}return()=>{e.disconnect(),this.performanceObservers.delete(e)}}mark(e){if(this.enabled)try{performance.mark(`tasknotes-${e}`)}catch(t){}}measureBetweenMarks(e,t,r){if(this.enabled)try{performance.measure(`tasknotes-${r}`,`tasknotes-${e}`,`tasknotes-${t}`)}catch(s){}}clear(){this.metrics.clear(),this.markers.clear()}destroy(){for(let e of this.mutationObservers)e.disconnect();this.mutationObservers.clear();for(let e of this.performanceObservers)e.disconnect();this.performanceObservers.clear(),this.clear(),la.instance=null}setEnabled(e){this.enabled=e,e||this.clear()}exportData(){let e={timestamp:new Date().toISOString(),stats:this.getAllStats(),platform:{isDesktop:Hl.Platform.isDesktop,isMobile:Hl.Platform.isMobile,isWin:Hl.Platform.isWin,isMacOS:Hl.Platform.isMacOS,isLinux:Hl.Platform.isLinux},memoryInfo:"memory"in performance?performance.memory:null};return JSON.stringify(e,null,2)}};la.instance=null;var LT=la;var vi=LT.getInstance();Fe();var Ul=class Ul extends Gr.ItemView{constructor(t,r){super(t);this.colorizeMode="tasks";this.listeners=[];this.monthCalculationCache=new Map;this.debouncedRefresh=null;this.currentCacheKey="";this.calendarDayElements=null;this.elementToDateMap=new Map;this.plugin=r;let s=this.plugin.selectedDate;this.displayedMonth=s.getUTCMonth(),this.displayedYear=s.getUTCFullYear(),this.registerEvents()}registerEvents(){this.listeners.forEach(i=>this.plugin.emitter.offref(i)),this.listeners=[];let t=this.plugin.emitter.on(fr,()=>{this.refresh()});this.listeners.push(t);let r=this.plugin.emitter.on(ra,i=>{this.displayedMonth!==i.getUTCMonth()||this.displayedYear!==i.getUTCFullYear()?(this.displayedMonth=i.getUTCMonth(),this.displayedYear=i.getUTCFullYear(),this.clearMonthCalculationCache(),this.colorizeMode==="daily"&&this.plugin.cacheManager.rebuildDailyNotesCache(i.getUTCFullYear(),i.getUTCMonth()),this.refresh()):(this.updateSelectedDate(i),this.updateMonthDisplay())});this.listeners.push(r);let s=this.plugin.emitter.on(tt,({path:i,originalTask:a,updatedTask:o})=>{if(!i||!o){console.error("EVENT_TASK_UPDATED received invalid data:",{path:i,originalTask:a,updatedTask:o});return}this.handleTaskUpdate(a,o)});this.listeners.push(s)}getViewType(){return Cl}getDisplayText(){return"Mini Calendar"}getIcon(){return"calendar-days"}async onOpen(){await this.plugin.onReady();let t=this.contentEl;t.empty();let r=t.createDiv({cls:"tasknotes-plugin mini-calendar-view"});this.showLoadingIndicator(),this.renderView(r),await this.refresh(),this.registerKeyboardNavigation()}renderView(t){t.empty(),this.createCalendarControls(t),this.createCalendarGrid(t),this.colorizeCalendar()}colorizeCalendar(){switch(this.colorizeMode){case"tasks":this.colorizeCalendarForTasks();break;case"notes":this.colorizeCalendarForNotes();break;case"daily":this.colorizeCalendarForDailyNotes();break}}async navigateToPreviousPeriod(){let t=new Date(this.plugin.selectedDate),r=new Date(t.getTime());r.setUTCMonth(t.getUTCMonth()-1),this.plugin.setSelectedDate(r)}async navigateToNextPeriod(){let t=new Date(this.plugin.selectedDate),r=new Date(t.getTime());r.setUTCMonth(t.getUTCMonth()+1),this.plugin.setSelectedDate(r)}async navigateToToday(){let t=Ge(),r=wt(t);this.plugin.setSelectedDate(r)}async onClose(){this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.monthCalculationCache.clear(),this.elementToDateMap.clear(),this.calendarDayElements=null,this.currentCacheKey="",this.contentEl.empty()}registerKeyboardNavigation(){this.registerDomEvent(document,"keydown",async t=>{if(!this.isThisViewActive())return;let r=new Date(this.plugin.selectedDate),s;switch(t.key){case"ArrowLeft":s=new Date(r),s.setUTCDate(r.getUTCDate()-1);break;case"ArrowRight":s=new Date(r),s.setUTCDate(r.getUTCDate()+1);break;case"ArrowUp":s=new Date(r),s.setUTCDate(r.getUTCDate()-7);break;case"ArrowDown":s=new Date(r),s.setUTCDate(r.getUTCDate()+7);break;case"Enter":t.preventDefault(),this.plugin.navigateToDailyNote(r);return;default:return}s&&(t.preventDefault(),this.plugin.setSelectedDate(s))})}isThisViewActive(){return this.app.workspace.getActiveViewOfType(Ul)===this}navigateDate(t,r){let s=new Date(this.plugin.selectedDate),i=new Date(s);i.setUTCDate(s.getUTCDate()+r*7+t),this.plugin.setSelectedDate(i)}async refresh(){this.showLoadingIndicator();try{let t=this.contentEl.querySelector(".mini-calendar-view");t||(t=this.contentEl.createDiv({cls:"tasknotes-plugin mini-calendar-view"})),this.renderView(t)}finally{this.hideLoadingIndicator()}}updateSelectedDate(t){let r=this.contentEl.querySelectorAll(".mini-calendar-view__day");r.forEach(s=>{s.classList.remove("mini-calendar-view__day--selected"),s.setAttribute("aria-selected","false"),s.setAttribute("tabindex","-1")}),r.forEach(s=>{let i=s;(i.getAttribute("aria-label")||"").includes(x(t,"EEEE, MMMM d, yyyy"))&&(i.classList.add("mini-calendar-view__day--selected"),i.setAttribute("aria-selected","true"),i.setAttribute("tabindex","0"),i.focus())}),this.plugin.selectedDate=t}updateMonthDisplay(){let t=this.contentEl.querySelector(".mini-calendar-view__month-display");t&&(t.textContent=x(this.plugin.selectedDate,"MMMM yyyy"))}showLoadingIndicator(){let t=this.contentEl.querySelector(".mini-calendar-view")||this.contentEl;if(t.querySelector(".cache-loading-indicator"))return;let r=document.createElement("div");r.className="cache-loading-indicator",r.textContent="Loading calendar data...",t.prepend(r)}hideLoadingIndicator(){let t=this.contentEl.querySelector(".cache-loading-indicator");t&&t.remove()}createCalendarControls(t){let s=t.createDiv({cls:"mini-calendar-view__controls"}).createDiv({cls:"mini-calendar-view__header"}),i=s.createEl("select",{cls:"mini-calendar-view__view-selector",attr:{title:"Change view","aria-label":"Change calendar view"}});[{value:"tasks",text:"Tasks"},{value:"notes",text:"Notes"},{value:"daily",text:"Daily notes"}].forEach(u=>{let h=i.createEl("option",{value:u.value,text:u.text});u.value===this.colorizeMode&&(h.selected=!0)}),i.addEventListener("change",async()=>{let u=i.value;this.showLoadingIndicator();try{await this.setColorizeMode(u)}finally{this.hideLoadingIndicator()}});let o=s.createDiv({cls:"mini-calendar-view__navigation"});o.createEl("button",{text:"\u2039",cls:"mini-calendar-view__nav-button mini-calendar-view__nav-button--prev",attr:{"aria-label":"Previous month",title:"Previous month"}}).addEventListener("click",()=>{this.navigateToPreviousPeriod()}),o.createDiv({cls:"mini-calendar-view__month-display",text:x(this.plugin.selectedDate,"MMMM yyyy")}),o.createEl("button",{text:"\u203A",cls:"mini-calendar-view__nav-button mini-calendar-view__nav-button--next",attr:{"aria-label":"Next month",title:"Next month"}}).addEventListener("click",()=>{this.navigateToNextPeriod()}),s.createEl("button",{text:"Today",cls:"mini-calendar-view__today-button",attr:{"aria-label":"Go to today",title:"Go to today"}}).addEventListener("click",()=>{this.navigateToToday()})}async setColorizeMode(t){if(this.colorizeMode!==t){if(this.colorizeMode=t,t==="daily"){let r=this.plugin.selectedDate.getUTCFullYear(),s=this.plugin.selectedDate.getUTCMonth();await this.plugin.cacheManager.rebuildDailyNotesCache(r,s)}this.colorizeCalendar()}}createCalendarGrid(t){let r=t.createDiv({cls:"mini-calendar-view__grid-container"}),s=this.plugin.selectedDate,i=s.getUTCMonth(),a=s.getUTCFullYear(),o=new Date(Date.UTC(a,i,1)),l=new Date(Date.UTC(a,i+1,0)),c=this.plugin.settings.calendarViewSettings.firstDay||0,d=(o.getUTCDay()-c+7)%7,u=r.createDiv({cls:"mini-calendar-view__grid",attr:{role:"grid","aria-label":`Calendar for ${x(this.plugin.selectedDate,"MMMM yyyy")}`,id:"calendar-grid"}}),h=u.createDiv({cls:"mini-calendar-view__grid-header",attr:{role:"row"}}),f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];[...f.slice(c),...f.slice(0,c)].forEach((D,M)=>{h.createDiv({text:D,cls:"mini-calendar-view__day-header",attr:{role:"columnheader","aria-label":D}})});let m=d,g=42,y=l.getUTCDate(),T=g-y-m,w=new Date(Date.UTC(a,i,0)).getUTCDate(),b=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}});for(let D=0;D<m;D++){let M=w-m+D+1,_=new Date(Date.UTC(a,i-1,M)),W=Pd(_,s),j=b.createDiv({cls:`mini-calendar-view__day mini-calendar-view__day--outside-month${W?" mini-calendar-view__day--selected":""}`,text:M.toString(),attr:{role:"gridcell",tabindex:W?"0":"-1","aria-label":x(_,"EEEE, MMMM d, yyyy"),"aria-selected":W?"true":"false"}});j.addEventListener("click",()=>{this.plugin.setSelectedDate(_)}),j.addEventListener("mouseover",R=>{this.showDayPreview(R,_,j)}),j.addEventListener("keydown",R=>{(R.key==="Enter"||R.key===" ")&&(R.preventDefault(),this.plugin.setSelectedDate(_))}),this.addDropHandlers(j,_)}let S=Ge(),k=wt(S);for(let D=1;D<=y;D++){(D+m-1)%7===0&&D>1&&(b=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}}));let M=new Date(Date.UTC(a,i,D)),_=Pd(M,k),W=Pd(M,s),j="mini-calendar-view__day";_&&(j+=" mini-calendar-view__day--today"),W&&(j+=" mini-calendar-view__day--selected");let R=b.createDiv({cls:j,text:D.toString(),attr:{role:"gridcell",tabindex:W?"0":"-1","aria-label":x(M,"EEEE, MMMM d, yyyy")+(_?" (Today)":""),"aria-selected":W?"true":"false","aria-current":_?"date":null}});R.addEventListener("click",()=>{this.plugin.setSelectedDate(M)}),R.addEventListener("mouseover",O=>{this.showDayPreview(O,M,R)}),R.addEventListener("keydown",O=>{(O.key==="Enter"||O.key===" ")&&(O.preventDefault(),this.plugin.setSelectedDate(M))}),this.addDropHandlers(R,M)}for(let D=1;D<=T;D++){(D+m+y-1)%7===0&&D>1&&(b=u.createDiv({cls:"mini-calendar-view__week",attr:{role:"row"}}));let M=new Date(Date.UTC(a,i+1,D)),_=Pd(M,s),W=b.createDiv({cls:`mini-calendar-view__day mini-calendar-view__day--outside-month${_?" mini-calendar-view__day--selected":""}`,text:D.toString(),attr:{role:"gridcell",tabindex:_?"0":"-1","aria-label":x(M,"EEEE, MMMM d, yyyy"),"aria-selected":_?"true":"false"}});W.addEventListener("click",()=>{this.plugin.setSelectedDate(M)}),W.addEventListener("mouseover",j=>{this.showDayPreview(j,M,W)}),W.addEventListener("keydown",j=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),this.plugin.setSelectedDate(M))}),this.addDropHandlers(W,M)}}clearCalendarColorization(){this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(r=>{r.querySelectorAll(".note-indicator, .task-indicator, .daily-note-indicator").forEach(s=>s.remove()),r.classList.remove("mini-calendar-view__day--has-notes-few","mini-calendar-view__day--has-notes-some","mini-calendar-view__day--has-notes-many","mini-calendar-view__day--has-tasks","mini-calendar-view__day--has-completed-tasks","mini-calendar-view__day--has-archived-tasks","mini-calendar-view__day--has-scheduled-tasks","mini-calendar-view__day--has-daily-note")})}async colorizeCalendarForNotes(){return vi.measure("calendar-colorize-notes",async()=>{this.clearCalendarColorization();let t=this.plugin.selectedDate.getFullYear(),r=this.plugin.selectedDate.getMonth(),s;try{s=await this.plugin.cacheManager.getCalendarData(t,r)}catch(o){console.warn("Failed to get calendar data from unified cache manager:",o),s=await this.plugin.cacheManager.getCalendarData(t,r)}let i=s.notes;this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(o=>{let l=o.innerText.trim();if(l){let c=this.plugin.selectedDate.getUTCFullYear(),d=this.plugin.selectedDate.getUTCMonth(),u=parseInt(l);if(isNaN(u))return;let h=d;o.classList.contains("mini-calendar-view__day--outside-month")&&(u>15?h=d===0?11:d-1:h=d===11?0:d+1);let f=wd(c,h,u),p=me(f),m=i.get(p)||0;if(m>0){let g=document.createElement("div");g.className="note-indicator";let y="";m>=5?(y="many-notes",o.classList.add("mini-calendar-view__day--has-notes-many")):m>=2?(y="some-notes",o.classList.add("mini-calendar-view__day--has-notes-some")):(y="few-notes",o.classList.add("mini-calendar-view__day--has-notes-few")),g.classList.add(y),g.setAttribute("aria-label",`${m} note${m>1?"s":""}`),(0,Gr.setTooltip)(g,`${m} note${m>1?"s":""}`,{placement:"top"}),o.appendChild(g)}}})})}async colorizeCalendarForTasks(){this.clearCalendarColorization();let t=this.plugin.selectedDate.getUTCFullYear(),r=this.plugin.selectedDate.getUTCMonth(),i=(await this.plugin.cacheManager.getCalendarData(t,r)).tasks;this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(o=>{let l=o.innerText.trim();if(l){let c=this.plugin.selectedDate.getUTCFullYear(),d=this.plugin.selectedDate.getUTCMonth(),u=parseInt(l);if(isNaN(u))return;let h=`${c}-${d}-${u}-${o.classList.contains("mini-calendar-view__day--outside-month")}`,f=this.monthCalculationCache.get(h);if(!f){let g=d;o.classList.contains("mini-calendar-view__day--outside-month")&&(u>15?g=d===0?11:d-1:g=d===11?0:d+1);let y=wd(c,g,u),T=me(y);f={actualMonth:g,dateObj:y,dateKey:T},this.monthCalculationCache.set(h,f)}let{dateKey:p}=f,m=i.get(p);if(m&&(m.hasDue||m.hasScheduled)){let g=document.createElement("div");g.className="task-indicator";let y="";m.hasArchived?(o.classList.add("mini-calendar-view__day--has-archived-tasks"),g.classList.add("archived-tasks"),y="Archived"):m.hasCompleted?(o.classList.add("mini-calendar-view__day--has-completed-tasks"),g.classList.add("completed-tasks"),y="Completed"):m.hasDue?(o.classList.add("mini-calendar-view__day--has-tasks"),g.classList.add("due-tasks"),y="Due"):m.hasScheduled&&(o.classList.add("mini-calendar-view__day--has-scheduled-tasks"),g.classList.add("scheduled-tasks"),y="Scheduled"),g.setAttribute("aria-label",`${y} tasks (${m.count})`),(0,Gr.setTooltip)(g,`${y} tasks (${m.count})`,{placement:"top"}),o.appendChild(g)}}})}async colorizeCalendarForDailyNotes(){this.clearCalendarColorization();let t=this.plugin.selectedDate.getUTCFullYear(),r=this.plugin.selectedDate.getUTCMonth(),s;Ul.dailyNotesInitialized?s=(await this.plugin.cacheManager.getCalendarData(t,r)).dailyNotes:(await this.plugin.cacheManager.rebuildDailyNotesCache(t,r),Ul.dailyNotesInitialized=!0,s=(await this.plugin.cacheManager.getCalendarData(t,r)).dailyNotes),this.contentEl.querySelectorAll(".mini-calendar-view__day").forEach(a=>{let o=a.innerText.trim();if(o){let l=this.plugin.selectedDate.getUTCFullYear(),c=this.plugin.selectedDate.getUTCMonth(),d=parseInt(o);if(isNaN(d))return;let u=`${l}-${c}-${d}-${a.classList.contains("mini-calendar-view__day--outside-month")}`,h=this.monthCalculationCache.get(u);if(!h){let p=c;a.classList.contains("mini-calendar-view__day--outside-month")&&(d>15?p=c===0?11:c-1:p=c===11?0:c+1);let m=wd(l,p,d),g=me(m);h={actualMonth:p,dateObj:m,dateKey:g},this.monthCalculationCache.set(u,h)}let f=h.dateKey;if(s.has(f)){let p=document.createElement("div");p.className="daily-note-indicator",a.classList.add("mini-calendar-view__day--has-daily-note"),p.setAttribute("aria-label","Daily note exists"),(0,Gr.setTooltip)(p,"Daily note exists",{placement:"top"}),a.appendChild(p)}}})}handleTaskUpdate(t,r){if(this.colorizeMode!=="tasks")return;let s=new Set;t!=null&&t.due&&s.add(ve(t.due)),r.due&&s.add(ve(r.due)),t!=null&&t.scheduled&&s.add(ve(t.scheduled)),r.scheduled&&s.add(ve(r.scheduled)),s.size!==0&&this.updateCalendarCellsForDates(Array.from(s))}async updateCalendarCellsForDates(t){if(t.length===0)return;let r=this.plugin.selectedDate.getUTCFullYear(),s=this.plugin.selectedDate.getUTCMonth(),a=(await this.plugin.cacheManager.getCalendarData(r,s)).tasks,o=`${r}-${s}`;(this.currentCacheKey!==o||!this.calendarDayElements)&&(this.calendarDayElements=this.contentEl.querySelectorAll(".mini-calendar-view__day"),this.currentCacheKey=o,this.buildElementToDateMap(r,s));let l=new Set(t),c=[];for(let[d,u]of this.elementToDateMap)l.has(u.dateKey)&&c.push({element:d,dateKey:u.dateKey});requestAnimationFrame(()=>{c.forEach(({element:d,dateKey:u})=>{this.updateSingleCalendarCell(d,u,a)})})}updateSingleCalendarCell(t,r,s){t.querySelectorAll(".task-indicator").forEach(a=>a.remove()),t.classList.remove("has-tasks","has-scheduled-tasks","has-completed-tasks","has-archived-tasks");let i=s.get(r);if(i&&(i.hasDue||i.hasScheduled)){let a=document.createElement("div");a.className="task-indicator";let o="";i.hasArchived?(t.classList.add("has-archived-tasks"),a.classList.add("archived-tasks"),o="Archived"):i.hasCompleted?(t.classList.add("has-completed-tasks"),a.classList.add("completed-tasks"),o="Completed"):i.hasDue?(t.classList.add("has-tasks"),a.classList.add("due-tasks"),o="Due"):i.hasScheduled&&(t.classList.add("has-scheduled-tasks"),a.classList.add("scheduled-tasks"),o="Scheduled"),a.setAttribute("aria-label",`${o} tasks (${i.count})`),(0,Gr.setTooltip)(a,`${o} tasks (${i.count})`,{placement:"top"}),t.appendChild(a)}}getCellDate(t,r,s,i){let a=i;t.classList.contains("outside-month")&&(r>15?a=i===0?11:i-1:a=i===11?0:i+1);try{return wd(s,a,r)}catch(o){return console.error("Error creating date:",o),null}}buildElementToDateMap(t,r){this.elementToDateMap.clear(),this.calendarDayElements&&this.calendarDayElements.forEach(s=>{let i=s,a=i.innerText.trim();if(!a||isNaN(parseInt(a)))return;let o=parseInt(a),l=this.getCellDate(i,o,t,r);if(l){let c=me(l);this.elementToDateMap.set(s,{date:o,dateKey:c})}})}clearMonthCalculationCache(){let t=`${this.plugin.selectedDate.getUTCFullYear()}-${this.plugin.selectedDate.getUTCMonth()}`;for(let[r]of this.monthCalculationCache)r.startsWith(t)||this.monthCalculationCache.delete(r)}initializeDebouncedRefresh(){this.debouncedRefresh||(this.debouncedRefresh=(0,Gr.debounce)(()=>{this.refresh()},150))}getViewStartDate(){return iT(this.plugin.selectedDate.getUTCFullYear(),this.plugin.selectedDate.getUTCMonth(),1)}getViewEndDate(){return iT(this.plugin.selectedDate.getUTCFullYear(),this.plugin.selectedDate.getUTCMonth()+1,0)}showDayPreview(t,r,s){let i=this.getDailyNotePath(r);if(!i)return;let a=this.app.vault.getAbstractFileByPath(i);a&&a instanceof Gr.TFile&&this.app.workspace.trigger("hover-link",{event:t,source:"tasknotes-calendar",hoverParent:this,targetEl:s,linktext:i,sourcePath:i})}getDailyNotePath(t){try{let r=window.moment(t),s=(0,am.getAllDailyNotes)(),i=(0,am.getDailyNote)(r,s);return i?i.path:null}catch(r){return null}}addDropHandlers(t,r){t.addEventListener("dragover",s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",t.classList.add("mini-calendar-view__day--dragover")}),t.addEventListener("dragleave",s=>{t.contains(s.relatedTarget)||t.classList.remove("mini-calendar-view__day--dragover")}),t.addEventListener("drop",async s=>{var i,a;s.preventDefault(),s.stopPropagation(),t.classList.remove("mini-calendar-view__day--dragover");try{let o=((i=s.dataTransfer)==null?void 0:i.getData("text/plain"))||((a=s.dataTransfer)==null?void 0:a.getData("application/x-task-path"));if(!o){console.warn("No task path found in drop data");return}let l=await this.plugin.cacheManager.getTaskInfo(o);if(!l){console.warn("Task not found:",o);return}let c=me(r);await this.plugin.taskService.updateProperty(l,"due",c),new Gr.Notice(`Task "${l.title}" due date set to ${x(r,"MMM d, yyyy")}`),this.refresh()}catch(o){console.error("Error handling task drop on mini calendar:",o),new Gr.Notice("Failed to update task due date")}})}};Ul.dailyNotesInitialized=!1;var im=Ul;var je=require("obsidian");cm();var yr=require("obsidian");cm();FT();BT();lm();var jl=class{constructor(e){this.menu=new yr.Menu,this.options=e,this.buildMenu()}buildMenu(){let{icsEvent:e,plugin:t,subscriptionName:r}=this.options;this.menu.addItem(s=>s.setTitle("Show details").setIcon("info").onClick(()=>{new co(t.app,t,e,r).open()})),this.menu.addSeparator(),this.menu.addItem(s=>s.setTitle("Create task from event").setIcon("check-circle").onClick(async()=>{await this.createTaskFromEvent()})),this.menu.addItem(s=>s.setTitle("Create note from event").setIcon("file-plus").onClick(()=>{this.createNoteFromEvent()})),this.menu.addItem(s=>s.setTitle("Link existing note").setIcon("link").onClick(()=>{this.linkExistingNote()})),this.menu.addSeparator(),this.menu.addItem(s=>s.setTitle("Copy title").setIcon("copy").onClick(async()=>{try{await navigator.clipboard.writeText(e.title),new yr.Notice("Event title copied to clipboard")}catch(i){new yr.Notice("Failed to copy to clipboard")}})),e.location&&this.menu.addItem(s=>s.setTitle("Copy location").setIcon("map-pin").onClick(async()=>{try{await navigator.clipboard.writeText(e.location),new yr.Notice("Location copied to clipboard")}catch(i){new yr.Notice("Failed to copy to clipboard")}})),e.url&&this.menu.addItem(s=>s.setTitle("Copy URL").setIcon("external-link").onClick(async()=>{try{await navigator.clipboard.writeText(e.url),new yr.Notice("Event URL copied to clipboard")}catch(i){new yr.Notice("Failed to copy to clipboard")}})),this.menu.addItem(s=>s.setTitle("Copy as markdown").setIcon("file-text").onClick(async()=>{let i=this.formatEventAsMarkdown();try{await navigator.clipboard.writeText(i),new yr.Notice("Event details copied as markdown")}catch(a){new yr.Notice("Failed to copy to clipboard")}}))}async createTaskFromEvent(){await Qr.execute(async()=>{let e=await this.options.plugin.icsNoteService.createTaskFromICS(this.options.icsEvent);new yr.Notice(`Task created: ${e.taskInfo.title}`);let t=this.options.plugin.app.vault.getAbstractFileByPath(e.file.path);t instanceof yr.TFile&&await this.options.plugin.app.workspace.getLeaf().openFile(t),this.options.onUpdate&&this.options.onUpdate()},{errorMessage:"Failed to create task from event"})}createNoteFromEvent(){try{new Wl(this.options.plugin.app,this.options.plugin,{icsEvent:this.options.icsEvent,subscriptionName:this.options.subscriptionName||"Unknown Calendar",onContentCreated:async t=>{new yr.Notice("Note created successfully"),await this.options.plugin.app.workspace.getLeaf().openFile(t),this.options.onUpdate&&this.options.onUpdate()}}).open()}catch(e){console.error("Error opening creation modal:",e),new yr.Notice("Failed to open creation modal")}}async linkExistingNote(){await Qr.execute(async()=>{new $l(this.options.plugin.app,this.options.plugin,async t=>{await Qr.execute(async()=>{await this.options.plugin.icsNoteService.linkNoteToICS(t.path,this.options.icsEvent),new yr.Notice(`Linked note "${t.name}" to event`),this.options.onUpdate&&this.options.onUpdate()},{errorMessage:"Failed to link note"})}).open()},{errorMessage:"Failed to open note selection"})}formatEventAsMarkdown(){let{icsEvent:e,subscriptionName:t}=this.options,r=[];r.push(`## ${e.title||"Untitled Event"}`),r.push(""),t&&r.push(`**Calendar:** ${t}`);let s=new Date(e.start),i=s.toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});if(!e.allDay&&(i+=` at ${s.toLocaleTimeString()}`,e.end)){let a=new Date(e.end);i+=` - ${a.toLocaleTimeString()}`}return r.push(`**Date & Time:** ${i}`),e.location&&r.push(`**Location:** ${e.location}`),e.description&&(r.push(""),r.push("### Description"),r.push(e.description)),e.url&&(r.push(""),r.push(`**URL:** ${e.url}`)),r.join(`
`)}show(e){this.menu.showAtMouseEvent(e)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4})}};WT();var it=require("obsidian");var ca=require("obsidian"),zl=class extends ca.FuzzySuggestModal{constructor(e,t,r){super(e),this.plugin=t,this.onChoose=r,this.setPlaceholder("Type to search for files and notes..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to cancel"}])}getItems(){return this.app.vault.getAllLoadedFiles()}getItemText(e){let t=`${e.name} ${e.path}`;if(e instanceof ca.TFile){let r=this.app.metadataCache.getFileCache(e);if(r!=null&&r.frontmatter){let s=(0,ca.parseFrontMatterAliases)(r.frontmatter);s&&s.length>0&&(t+=` ${s.join(" ")}`)}}return t}renderSuggestion(e,t){let r=e.item;t.empty();let s=t.createDiv({cls:"attachment-suggestion"}),i=s.createSpan({cls:"attachment-name"});if(i.textContent=r.name,r instanceof ca.TFile){let a=this.app.metadataCache.getFileCache(r);if(a!=null&&a.frontmatter){let o=this.plugin.fieldMapper.toUserField("title"),l=a.frontmatter[o];if(l){let c=s.createDiv({cls:"attachment-title"});c.textContent=l}else{let c=(0,ca.parseFrontMatterAliases)(a.frontmatter);if(c&&c.length>0){let d=s.createDiv({cls:"attachment-aliases"});d.textContent=c.join(", ")}}}}if(r.path!==r.name){let a=s.createDiv({cls:"attachment-path"});a.textContent=r.path}}onChooseItem(e,t){this.onChoose(e)}};var ki=ke(dn()),hm=class extends it.Modal{constructor(t,r,s,i){super(t);this.selectedAttachments=[];this.plugin=r,this.timeblock={...s},this.originalTimeblock=s,this.eventDate=i}async onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("timeblock-info-modal"),new it.Setting(t).setName("Edit Timeblock").setHeading();let r=t.createDiv({cls:"timeblock-date-display"});r.createEl("strong",{text:"Date & Time: "});let s=`${this.eventDate.toLocaleDateString()} from ${this.timeblock.startTime} to ${this.timeblock.endTime}`;r.createSpan({text:s}),new it.Setting(t).setName("Title").setDesc("Title for your timeblock").addText(d=>{this.titleInput=d.inputEl,d.setPlaceholder("e.g., Deep work session").setValue(this.timeblock.title||"").onChange(()=>this.validateForm())}),new it.Setting(t).setName("Description").setDesc("Optional description for the timeblock").addTextArea(d=>{this.descriptionInput=d.inputEl,d.setPlaceholder("Focus on new features, no interruptions").setValue(this.timeblock.description||""),this.descriptionInput.rows=3}),new it.Setting(t).setName("Color").setDesc("Optional color for the timeblock").addText(d=>{this.colorInput=d.inputEl,d.setPlaceholder("#3b82f6").setValue(this.timeblock.color||"#6366f1"),this.colorInput.type="color"}),new it.Setting(t).setName("Attachments").setDesc("Files or notes linked to this timeblock").addButton(d=>{d.setButtonText("Add Attachment").setTooltip("Select a file or note using fuzzy search").onClick(()=>{new zl(this.app,this.plugin,h=>{this.addAttachment(h)}).open()})}),this.attachmentsList=t.createDiv({cls:"timeblock-attachments-list"}),await this.initializeAttachments(),this.renderAttachmentsList();let i=t.createDiv({cls:"timeblock-modal-buttons"});i.style.display="flex",i.style.justifyContent="space-between",i.style.alignItems="center",i.style.marginTop="20px",i.createEl("button",{text:"Delete Timeblock",cls:"mod-warning timeblock-delete-button"}).addEventListener("click",()=>this.handleDelete());let o=i.createDiv({cls:"timeblock-modal-buttons-right"});o.style.display="flex",o.style.gap="8px",o.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),o.createEl("button",{text:"Save Changes",cls:"mod-cta timeblock-save-button"}).addEventListener("click",()=>this.handleSave()),this.validateForm(),window.setTimeout(()=>this.titleInput.focus(),50)}validateForm(){var i;let t=this.contentEl.querySelector(".timeblock-save-button");if(!t)return;let s=!!((i=this.titleInput)==null?void 0:i.value.trim());t.disabled=!s,t.style.opacity=s?"1":"0.5"}async initializeAttachments(){if(this.timeblock.attachments)for(let t of this.timeblock.attachments){let r=t.replace(/^\[\[|\]\]$/g,""),s=this.app.vault.getAbstractFileByPath(r);s&&this.selectedAttachments.push(s)}}addAttachment(t){if(this.selectedAttachments.some(r=>r.path===t.path)){new it.Notice(`"${t.name}" is already attached`);return}this.selectedAttachments.push(t),this.renderAttachmentsList(),new it.Notice(`Added "${t.name}" as attachment`)}removeAttachment(t){this.selectedAttachments=this.selectedAttachments.filter(r=>r.path!==t.path),this.renderAttachmentsList(),new it.Notice(`Removed "${t.name}" from attachments`)}openAttachment(t){t instanceof it.TFile?this.app.workspace.getLeaf(!1).openFile(t):new it.Notice(`Cannot open "${t.name}" - file type not supported`)}renderAttachmentsList(){if(this.attachmentsList.empty(),this.selectedAttachments.length===0){let t=this.attachmentsList.createDiv({cls:"timeblock-attachments-empty"});t.textContent="No attachments";return}this.selectedAttachments.forEach(t=>{let r=this.attachmentsList.createDiv({cls:"timeblock-attachment-item"}),s=r.createDiv({cls:"timeblock-attachment-info"});s.style.cursor="pointer",(0,it.setTooltip)(s,"Click to open",{placement:"top"}),s.addEventListener("click",()=>this.openAttachment(t));let i=s.createSpan({cls:"timeblock-attachment-name"});if(i.textContent=t.name,t.path!==t.name){let o=s.createDiv({cls:"timeblock-attachment-path"});o.textContent=t.path}let a=r.createEl("button",{cls:"timeblock-attachment-remove",text:"\xD7"});(0,it.setTooltip)(a,"Remove attachment",{placement:"top"}),a.addEventListener("click",o=>{o.stopPropagation(),this.removeAttachment(t)})})}async handleSave(){try{let t=this.titleInput.value.trim();if(!t){new it.Notice("Please enter a title for the timeblock");return}this.timeblock.title=t,this.timeblock.description=this.descriptionInput.value.trim()||void 0,this.timeblock.color=this.colorInput.value||void 0;let r=this.selectedAttachments.map(s=>`[[${s.path}]]`);this.timeblock.attachments=r.length>0?r:void 0,await this.updateTimeblockInDailyNote(),this.plugin.emitter.trigger("data-changed"),new it.Notice(`Timeblock "${t}" updated successfully`),this.close()}catch(t){console.error("Error updating timeblock:",t),new it.Notice("Failed to update timeblock. Check console for details.")}}async updateTimeblockInDailyNote(){if(!(0,ki.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let t=this.eventDate.toISOString().split("T")[0],r=window.moment(t),s=(0,ki.getAllDailyNotes)(),i=(0,ki.getDailyNote)(r,s);if(!i)throw new Error("Daily note not found");let a=await this.app.vault.read(i),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let h=a.substring(3,u);l=a.substring(u+3);try{o=(0,it.parseYaml)(h)||{}}catch(f){console.error("Error parsing existing frontmatter:",f),o={}}}}if(o.timeblocks&&Array.isArray(o.timeblocks)){let u=o.timeblocks.findIndex(h=>h.id===this.originalTimeblock.id||h.title===this.originalTimeblock.title&&h.startTime===this.originalTimeblock.startTime&&h.endTime===this.originalTimeblock.endTime);if(u>=0)o.timeblocks[u]=this.timeblock;else throw new Error("Timeblock not found in daily note")}else throw new Error("No timeblocks found in daily note");let d=`---
${(0,it.stringifyYaml)(o)}---${l}`;await this.app.vault.modify(i,d)}async handleDelete(){if(await this.showDeleteConfirmation())try{await this.deleteTimeblockFromDailyNote(),this.plugin.emitter.trigger("data-changed"),new it.Notice(`Timeblock "${this.timeblock.title}" deleted successfully`),this.close()}catch(r){console.error("Error deleting timeblock:",r),new it.Notice("Failed to delete timeblock. Check console for details.")}}async showDeleteConfirmation(){return new Promise(t=>{let r=new it.Modal(this.app);r.titleEl.setText("Delete Timeblock");let s=r.contentEl;s.createEl("p",{text:`Are you sure you want to delete the timeblock "${this.timeblock.title}"?`}),s.createEl("p",{text:"This action cannot be undone.",cls:"mod-warning"});let i=s.createDiv({cls:"modal-button-container"});i.style.display="flex",i.style.justifyContent="flex-end",i.style.gap="8px",i.style.marginTop="20px";let a=i.createEl("button",{text:"Cancel"});a.addEventListener("click",()=>{r.close(),t(!1)}),i.createEl("button",{text:"Delete",cls:"mod-warning"}).addEventListener("click",()=>{r.close(),t(!0)}),r.open(),setTimeout(()=>a.focus(),50)})}async deleteTimeblockFromDailyNote(){if(!(0,ki.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let t=this.eventDate.toISOString().split("T")[0],r=window.moment(t),s=(0,ki.getAllDailyNotes)(),i=(0,ki.getDailyNote)(r,s);if(!i)throw new Error("Daily note not found");let a=await this.app.vault.read(i),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let h=a.substring(3,u);l=a.substring(u+3);try{o=(0,it.parseYaml)(h)||{}}catch(f){console.error("Error parsing existing frontmatter:",f),o={}}}}if(o.timeblocks&&Array.isArray(o.timeblocks)){let u=o.timeblocks.findIndex(h=>h.id===this.originalTimeblock.id||h.title===this.originalTimeblock.title&&h.startTime===this.originalTimeblock.startTime&&h.endTime===this.originalTimeblock.endTime);if(u>=0)o.timeblocks.splice(u,1),o.timeblocks.length===0&&delete o.timeblocks;else throw new Error("Timeblock not found in daily note")}else throw new Error("No timeblocks found in daily note");let c=Object.keys(o).length>0?(0,it.stringifyYaml)(o):"",d=c?`---
${c}---${l}`:l.trim();await this.app.vault.modify(i,d)}onClose(){let{contentEl:t}=this;t.empty()}};At();var ym,he,wP,jT,ql,ho,gP,bP,kP,pm={},EP=[],n$=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function da(n,e){for(var t in e)n[t]=e[t];return n}function SP(n){var e=n.parentNode;e&&e.removeChild(n)}function E(n,e,t){var r,s,i,a={};for(i in e)i=="key"?r=e[i]:i=="ref"?s=e[i]:a[i]=e[i];if(arguments.length>2&&(a.children=arguments.length>3?ym.call(arguments,2):t),typeof n=="function"&&n.defaultProps!=null)for(i in n.defaultProps)a[i]===void 0&&(a[i]=n.defaultProps[i]);return fm(n,a,r,s,null)}function fm(n,e,t,r,s){var i={type:n,props:e,key:t,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s==null?++wP:s};return s==null&&he.vnode!=null&&he.vnode(i),i}function Dt(){return{current:null}}function Ze(n){return n.children}function i$(n,e,t,r,s){var i;for(i in t)i==="children"||i==="key"||i in e||mm(n,i,null,t[i],r);for(i in e)s&&typeof e[i]!="function"||i==="children"||i==="key"||i==="value"||i==="checked"||t[i]===e[i]||mm(n,i,e[i],t[i],r)}function yP(n,e,t){e[0]==="-"?n.setProperty(e,t==null?"":t):n[e]=t==null?"":typeof t!="number"||n$.test(e)?t:t+"px"}function mm(n,e,t,r,s){var i;e:if(e==="style")if(typeof t=="string")n.style.cssText=t;else{if(typeof r=="string"&&(n.style.cssText=r=""),r)for(e in r)t&&e in t||yP(n.style,e,"");if(t)for(e in t)r&&t[e]===r[e]||yP(n.style,e,t[e])}else if(e[0]==="o"&&e[1]==="n")i=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in n?e.toLowerCase().slice(2):e.slice(2),n.l||(n.l={}),n.l[e+i]=t,t?r||n.addEventListener(e,i?TP:vP,i):n.removeEventListener(e,i?TP:vP,i);else if(e!=="dangerouslySetInnerHTML"){if(s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="width"&&e!=="height"&&e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in n)try{n[e]=t==null?"":t;break e}catch(a){}typeof t=="function"||(t==null||t===!1&&e.indexOf("-")==-1?n.removeAttribute(e):n.setAttribute(e,t))}}function vP(n){ql=!0;try{return this.l[n.type+!1](he.event?he.event(n):n)}finally{ql=!1}}function TP(n){ql=!0;try{return this.l[n.type+!0](he.event?he.event(n):n)}finally{ql=!1}}function vr(n,e){this.props=n,this.context=e}function Hd(n,e){if(e==null)return n.__?Hd(n.__,n.__.__k.indexOf(n)+1):null;for(var t;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null)return t.__e;return typeof n.type=="function"?Hd(n):null}function DP(n){var e,t;if((n=n.__)!=null&&n.__c!=null){for(n.__e=n.__c.base=null,e=0;e<n.__k.length;e++)if((t=n.__k[e])!=null&&t.__e!=null){n.__e=n.__c.base=t.__e;break}return DP(n)}}function a$(n){ql?setTimeout(n):bP(n)}function $T(n){(!n.__d&&(n.__d=!0)&&ho.push(n)&&!gm.__r++||gP!==he.debounceRendering)&&((gP=he.debounceRendering)||a$)(gm)}function gm(){var n,e,t,r,s,i,a,o;for(ho.sort(function(l,c){return l.__v.__b-c.__v.__b});n=ho.shift();)n.__d&&(e=ho.length,r=void 0,s=void 0,a=(i=(t=n).__v).__e,(o=t.__P)&&(r=[],(s=da({},i)).__v=i.__v+1,VT(o,i,s,t.__n,o.ownerSVGElement!==void 0,i.__h!=null?[a]:null,r,a==null?Hd(i):a,i.__h),AP(r,i),i.__e!=a&&DP(i)),ho.length>e&&ho.sort(function(l,c){return l.__v.__b-c.__v.__b}));gm.__r=0}function CP(n,e,t,r,s,i,a,o,l,c){var d,u,h,f,p,m,g,y=r&&r.__k||EP,T=y.length;for(t.__k=[],d=0;d<e.length;d++)if((f=t.__k[d]=(f=e[d])==null||typeof f=="boolean"?null:typeof f=="string"||typeof f=="number"||typeof f=="bigint"?fm(null,f,null,null,f):Array.isArray(f)?fm(Ze,{children:f},null,null,null):f.__b>0?fm(f.type,f.props,f.key,f.ref?f.ref:null,f.__v):f)!=null){if(f.__=t,f.__b=t.__b+1,(h=y[d])===null||h&&f.key==h.key&&f.type===h.type)y[d]=void 0;else for(u=0;u<T;u++){if((h=y[u])&&f.key==h.key&&f.type===h.type){y[u]=void 0;break}h=null}VT(n,f,h=h||pm,s,i,a,o,l,c),p=f.__e,(u=f.ref)&&h.ref!=u&&(g||(g=[]),h.ref&&g.push(h.ref,null,f),g.push(u,f.__c||p,f)),p!=null?(m==null&&(m=p),typeof f.type=="function"&&f.__k===h.__k?f.__d=l=xP(f,l,n):l=MP(n,f,h,y,p,l),typeof t.type=="function"&&(t.__d=l)):l&&h.__e==l&&l.parentNode!=n&&(l=Hd(h))}for(t.__e=m,d=T;d--;)y[d]!=null&&(typeof t.type=="function"&&y[d].__e!=null&&y[d].__e==t.__d&&(t.__d=_P(r).nextSibling),IP(y[d],y[d]));if(g)for(d=0;d<g.length;d++)PP(g[d],g[++d],g[++d])}function xP(n,e,t){for(var r,s=n.__k,i=0;s&&i<s.length;i++)(r=s[i])&&(r.__=n,e=typeof r.type=="function"?xP(r,e,t):MP(t,r,r,s,r.__e,e));return e}function Ud(n,e){return e=e||[],n==null||typeof n=="boolean"||(Array.isArray(n)?n.some(function(t){Ud(t,e)}):e.push(n)),e}function MP(n,e,t,r,s,i){var a,o,l;if(e.__d!==void 0)a=e.__d,e.__d=void 0;else if(t==null||s!=i||s.parentNode==null)e:if(i==null||i.parentNode!==n)n.appendChild(s),a=null;else{for(o=i,l=0;(o=o.nextSibling)&&l<r.length;l+=1)if(o==s)break e;n.insertBefore(s,i),a=i}return a!==void 0?a:s.nextSibling}function _P(n){var e,t,r;if(n.type==null||typeof n.type=="string")return n.__e;if(n.__k){for(e=n.__k.length-1;e>=0;e--)if((t=n.__k[e])&&(r=_P(t)))return r}return null}function VT(n,e,t,r,s,i,a,o,l){var c,d,u,h,f,p,m,g,y,T,w,b,S,k,D,M=e.type;if(e.constructor!==void 0)return null;t.__h!=null&&(l=t.__h,o=e.__e=t.__e,e.__h=null,i=[o]),(c=he.__b)&&c(e);try{e:if(typeof M=="function"){if(g=e.props,y=(c=M.contextType)&&r[c.__c],T=c?y?y.props.value:c.__:r,t.__c?m=(d=e.__c=t.__c).__=d.__E:("prototype"in M&&M.prototype.render?e.__c=d=new M(g,T):(e.__c=d=new vr(g,T),d.constructor=M,d.render=l$),y&&y.sub(d),d.props=g,d.state||(d.state={}),d.context=T,d.__n=r,u=d.__d=!0,d.__h=[],d._sb=[]),d.__s==null&&(d.__s=d.state),M.getDerivedStateFromProps!=null&&(d.__s==d.state&&(d.__s=da({},d.__s)),da(d.__s,M.getDerivedStateFromProps(g,d.__s))),h=d.props,f=d.state,d.__v=e,u)M.getDerivedStateFromProps==null&&d.componentWillMount!=null&&d.componentWillMount(),d.componentDidMount!=null&&d.__h.push(d.componentDidMount);else{if(M.getDerivedStateFromProps==null&&g!==h&&d.componentWillReceiveProps!=null&&d.componentWillReceiveProps(g,T),!d.__e&&d.shouldComponentUpdate!=null&&d.shouldComponentUpdate(g,d.__s,T)===!1||e.__v===t.__v){for(e.__v!==t.__v&&(d.props=g,d.state=d.__s,d.__d=!1),e.__e=t.__e,e.__k=t.__k,e.__k.forEach(function(_){_&&(_.__=e)}),w=0;w<d._sb.length;w++)d.__h.push(d._sb[w]);d._sb=[],d.__h.length&&a.push(d);break e}d.componentWillUpdate!=null&&d.componentWillUpdate(g,d.__s,T),d.componentDidUpdate!=null&&d.__h.push(function(){d.componentDidUpdate(h,f,p)})}if(d.context=T,d.props=g,d.__P=n,b=he.__r,S=0,"prototype"in M&&M.prototype.render){for(d.state=d.__s,d.__d=!1,b&&b(e),c=d.render(d.props,d.state,d.context),k=0;k<d._sb.length;k++)d.__h.push(d._sb[k]);d._sb=[]}else do d.__d=!1,b&&b(e),c=d.render(d.props,d.state,d.context),d.state=d.__s;while(d.__d&&++S<25);d.state=d.__s,d.getChildContext!=null&&(r=da(da({},r),d.getChildContext())),u||d.getSnapshotBeforeUpdate==null||(p=d.getSnapshotBeforeUpdate(h,f)),D=c!=null&&c.type===Ze&&c.key==null?c.props.children:c,CP(n,Array.isArray(D)?D:[D],e,t,r,s,i,a,o,l),d.base=e.__e,e.__h=null,d.__h.length&&a.push(d),m&&(d.__E=d.__=null),d.__e=!1}else i==null&&e.__v===t.__v?(e.__k=t.__k,e.__e=t.__e):e.__e=o$(t.__e,e,t,r,s,i,a,l);(c=he.diffed)&&c(e)}catch(_){e.__v=null,(l||i!=null)&&(e.__e=o,e.__h=!!l,i[i.indexOf(o)]=null),he.__e(_,e,t)}}function AP(n,e){he.__c&&he.__c(e,n),n.some(function(t){try{n=t.__h,t.__h=[],n.some(function(r){r.call(t)})}catch(r){he.__e(r,t.__v)}})}function o$(n,e,t,r,s,i,a,o){var l,c,d,u=t.props,h=e.props,f=e.type,p=0;if(f==="svg"&&(s=!0),i!=null){for(;p<i.length;p++)if((l=i[p])&&"setAttribute"in l==!!f&&(f?l.localName===f:l.nodeType===3)){n=l,i[p]=null;break}}if(n==null){if(f===null)return document.createTextNode(h);n=s?document.createElementNS("http://www.w3.org/2000/svg",f):document.createElement(f,h.is&&h),i=null,o=!1}if(f===null)u===h||o&&n.data===h||(n.data=h);else{if(i=i&&ym.call(n.childNodes),c=(u=t.props||pm).dangerouslySetInnerHTML,d=h.dangerouslySetInnerHTML,!o){if(i!=null)for(u={},p=0;p<n.attributes.length;p++)u[n.attributes[p].name]=n.attributes[p].value;(d||c)&&(d&&(c&&d.__html==c.__html||d.__html===n.innerHTML)||(n.innerHTML=d&&d.__html||""))}if(i$(n,h,u,s,o),d)e.__k=[];else if(p=e.props.children,CP(n,Array.isArray(p)?p:[p],e,t,r,s&&f!=="foreignObject",i,a,i?i[0]:t.__k&&Hd(t,0),o),i!=null)for(p=i.length;p--;)i[p]!=null&&SP(i[p]);o||("value"in h&&(p=h.value)!==void 0&&(p!==n.value||f==="progress"&&!p||f==="option"&&p!==u.value)&&mm(n,"value",p,u.value,!1),"checked"in h&&(p=h.checked)!==void 0&&p!==n.checked&&mm(n,"checked",p,u.checked,!1))}return n}function PP(n,e,t){try{typeof n=="function"?n(e):n.current=e}catch(r){he.__e(r,t)}}function IP(n,e,t){var r,s;if(he.unmount&&he.unmount(n),(r=n.ref)&&(r.current&&r.current!==n.__e||PP(r,null,e)),(r=n.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){he.__e(i,e)}r.base=r.__P=null,n.__c=void 0}if(r=n.__k)for(s=0;s<r.length;s++)r[s]&&IP(r[s],e,t||typeof n.type!="function");t||n.__e==null||SP(n.__e),n.__=n.__e=n.__d=void 0}function l$(n,e,t){return this.constructor(n,t)}function ua(n,e,t){var r,s,i;he.__&&he.__(n,e),s=(r=typeof t=="function")?null:t&&t.__k||e.__k,i=[],VT(e,n=(!r&&t||e).__k=E(Ze,null,[n]),s||pm,pm,e.ownerSVGElement!==void 0,!r&&t?[t]:s?null:e.firstChild?ym.call(e.childNodes):null,i,!r&&t?t:s?s.__e:e.firstChild,r),AP(i,n)}function vm(n,e){var t={__c:e="__cC"+kP++,__:n,Consumer:function(r,s){return r.children(s)},Provider:function(r){var s,i;return this.getChildContext||(s=[],(i={})[e]=this,this.getChildContext=function(){return i},this.shouldComponentUpdate=function(a){this.props.value!==a.value&&s.some(function(o){o.__e=!0,$T(o)})},this.sub=function(a){s.push(a);var o=a.componentWillUnmount;a.componentWillUnmount=function(){s.splice(s.indexOf(a),1),o&&o.call(a)}}),r.children}};return t.Provider.__=t.Consumer.contextType=t}ym=EP.slice,he={__e:function(n,e,t,r){for(var s,i,a;e=e.__;)if((s=e.__c)&&!s.__)try{if((i=s.constructor)&&i.getDerivedStateFromError!=null&&(s.setState(i.getDerivedStateFromError(n)),a=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(n,r||{}),a=s.__d),a)return s.__E=s}catch(o){n=o}throw n}},wP=0,jT=function(n){return n!=null&&n.constructor===void 0},ql=!1,vr.prototype.setState=function(n,e){var t;t=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=da({},this.state),typeof n=="function"&&(n=n(da({},t),this.props)),n&&da(t,n),n!=null&&this.__v&&(e&&this._sb.push(e),$T(this))},vr.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),$T(this))},vr.prototype.render=Ze,ho=[],bP=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,gm.__r=0,kP=0;var d$,$n,YT,RP;var UP=[],zT=[],NP=he.__b,OP=he.__r,LP=he.diffed,FP=he.__c,BP=he.unmount;function u$(){for(var n;n=UP.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(Tm),n.__H.__h.forEach(qT),n.__H.__h=[]}catch(e){n.__H.__h=[],he.__e(e,n.__v)}}he.__b=function(n){$n=null,NP&&NP(n)},he.__r=function(n){OP&&OP(n),d$=0;var e=($n=n.__c).__H;e&&(YT===$n?(e.__h=[],$n.__h=[],e.__.forEach(function(t){t.__N&&(t.__=t.__N),t.__V=zT,t.__N=t.i=void 0})):(e.__h.forEach(Tm),e.__h.forEach(qT),e.__h=[])),YT=$n},he.diffed=function(n){LP&&LP(n);var e=n.__c;e&&e.__H&&(e.__H.__h.length&&(UP.push(e)!==1&&RP===he.requestAnimationFrame||((RP=he.requestAnimationFrame)||h$)(u$)),e.__H.__.forEach(function(t){t.i&&(t.__H=t.i),t.__V!==zT&&(t.__=t.__V),t.i=void 0,t.__V=zT})),YT=$n=null},he.__c=function(n,e){e.some(function(t){try{t.__h.forEach(Tm),t.__h=t.__h.filter(function(r){return!r.__||qT(r)})}catch(r){e.some(function(s){s.__h&&(s.__h=[])}),e=[],he.__e(r,t.__v)}}),FP&&FP(n,e)},he.unmount=function(n){BP&&BP(n);var e,t=n.__c;t&&t.__H&&(t.__H.__.forEach(function(r){try{Tm(r)}catch(s){e=s}}),t.__H=void 0,e&&he.__e(e,t.__v))};var HP=typeof requestAnimationFrame=="function";function h$(n){var e,t=function(){clearTimeout(r),HP&&cancelAnimationFrame(e),setTimeout(n)},r=setTimeout(t,100);HP&&(e=requestAnimationFrame(t))}function Tm(n){var e=$n,t=n.__c;typeof t=="function"&&(n.__c=void 0,t()),$n=e}function qT(n){var e=$n;n.__c=n.__(),$n=e}function f$(n,e){for(var t in e)n[t]=e[t];return n}function WP(n,e){for(var t in n)if(t!=="__source"&&!(t in e))return!0;for(var r in e)if(r!=="__source"&&n[r]!==e[r])return!0;return!1}function $P(n){this.props=n}($P.prototype=new vr).isPureReactComponent=!0,$P.prototype.shouldComponentUpdate=function(n,e){return WP(this.props,n)||WP(this.state,e)};var jP=he.__b;he.__b=function(n){n.type&&n.type.__f&&n.ref&&(n.props.ref=n.ref,n.ref=null),jP&&jP(n)};var Qae=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;var p$=he.__e;he.__e=function(n,e,t,r){if(n.then){for(var s,i=e;i=i.__;)if((s=i.__c)&&s.__c)return e.__e==null&&(e.__e=t.__e,e.__k=t.__k),s.__c(n,e)}p$(n,e,t,r)};var VP=he.unmount;function KP(n,e,t){return n&&(n.__c&&n.__c.__H&&(n.__c.__H.__.forEach(function(r){typeof r.__c=="function"&&r.__c()}),n.__c.__H=null),(n=f$({},n)).__c!=null&&(n.__c.__P===t&&(n.__c.__P=e),n.__c=null),n.__k=n.__k&&n.__k.map(function(r){return KP(r,e,t)})),n}function ZP(n,e,t){return n&&(n.__v=null,n.__k=n.__k&&n.__k.map(function(r){return ZP(r,e,t)}),n.__c&&n.__c.__P===e&&(n.__e&&t.insertBefore(n.__e,n.__d),n.__c.__e=!0,n.__c.__P=t)),n}function GT(){this.__u=0,this.t=null,this.__b=null}function JP(n){var e=n.__.__c;return e&&e.__a&&e.__a(n)}function wm(){this.u=null,this.o=null}he.unmount=function(n){var e=n.__c;e&&e.__R&&e.__R(),e&&n.__h===!0&&(n.type=null),VP&&VP(n)},(GT.prototype=new vr).__c=function(n,e){var t=e.__c,r=this;r.t==null&&(r.t=[]),r.t.push(t);var s=JP(r.__v),i=!1,a=function(){i||(i=!0,t.__R=null,s?s(o):o())};t.__R=a;var o=function(){if(!--r.__u){if(r.state.__a){var c=r.state.__a;r.__v.__k[0]=ZP(c,c.__c.__P,c.__c.__O)}var d;for(r.setState({__a:r.__b=null});d=r.t.pop();)d.forceUpdate()}},l=e.__h===!0;r.__u++||l||r.setState({__a:r.__b=r.__v.__k[0]}),n.then(a,a)},GT.prototype.componentWillUnmount=function(){this.t=[]},GT.prototype.render=function(n,e){if(this.__b){if(this.__v.__k){var t=document.createElement("div"),r=this.__v.__k[0].__c;this.__v.__k[0]=KP(this.__b,t,r.__O=r.__P)}this.__b=null}var s=e.__a&&E(Ze,null,n.fallback);return s&&(s.__h=null),[E(Ze,null,e.__a?null:n.children),s]};var YP=function(n,e,t){if(++t[1]===t[0]&&n.o.delete(e),n.props.revealOrder&&(n.props.revealOrder[0]!=="t"||!n.o.size))for(t=n.u;t;){for(;t.length>3;)t.pop()();if(t[1]<t[0])break;n.u=t=t[2]}};function m$(n){return this.getChildContext=function(){return n.context},n.children}function g$(n){var e=this,t=n.i;e.componentWillUnmount=function(){ua(null,e.l),e.l=null,e.i=null},e.i&&e.i!==t&&e.componentWillUnmount(),n.__v?(e.l||(e.i=t,e.l={nodeType:1,parentNode:t,childNodes:[],appendChild:function(r){this.childNodes.push(r),e.i.appendChild(r)},insertBefore:function(r,s){this.childNodes.push(r),e.i.appendChild(r)},removeChild:function(r){this.childNodes.splice(this.childNodes.indexOf(r)>>>1,1),e.i.removeChild(r)}}),ua(E(m$,{context:e.context},n.__v),e.l)):e.l&&e.componentWillUnmount()}function XP(n,e){var t=E(g$,{__v:n,i:e});return t.containerInfo=e,t}(wm.prototype=new vr).__a=function(n){var e=this,t=JP(e.__v),r=e.o.get(n);return r[0]++,function(s){var i=function(){e.props.revealOrder?(r.push(s),YP(e,n,r)):s()};t?t(i):i()}},wm.prototype.render=function(n){this.u=null,this.o=new Map;var e=Ud(n.children);n.revealOrder&&n.revealOrder[0]==="b"&&e.reverse();for(var t=e.length;t--;)this.o.set(e[t],this.u=[1,0,this.u]);return n.children},wm.prototype.componentDidUpdate=wm.prototype.componentDidMount=function(){var n=this;this.o.forEach(function(e,t){YP(n,t,e)})};var y$=typeof Symbol!="undefined"&&Symbol.for&&Symbol.for("react.element")||60103,v$=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,T$=typeof document!="undefined",w$=function(n){return(typeof Symbol!="undefined"&&typeof Symbol()=="symbol"?/fil|che|rad/i:/fil|che|ra/i).test(n)};vr.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(n){Object.defineProperty(vr.prototype,n,{configurable:!0,get:function(){return this["UNSAFE_"+n]},set:function(e){Object.defineProperty(this,n,{configurable:!0,writable:!0,value:e})}})});var zP=he.event;function b$(){}function k$(){return this.cancelBubble}function E$(){return this.defaultPrevented}he.event=function(n){return zP&&(n=zP(n)),n.persist=b$,n.isPropagationStopped=k$,n.isDefaultPrevented=E$,n.nativeEvent=n};var S$,qP={configurable:!0,get:function(){return this.class}},GP=he.vnode;he.vnode=function(n){var e=n.type,t=n.props,r=t;if(typeof e=="string"){var s=e.indexOf("-")===-1;for(var i in r={},t){var a=t[i];T$&&i==="children"&&e==="noscript"||i==="value"&&"defaultValue"in t&&a==null||(i==="defaultValue"&&"value"in t&&t.value==null?i="value":i==="download"&&a===!0?a="":/ondoubleclick/i.test(i)?i="ondblclick":/^onchange(textarea|input)/i.test(i+e)&&!w$(t.type)?i="oninput":/^onfocus$/i.test(i)?i="onfocusin":/^onblur$/i.test(i)?i="onfocusout":/^on(Ani|Tra|Tou|BeforeInp|Compo)/.test(i)?i=i.toLowerCase():s&&v$.test(i)?i=i.replace(/[A-Z0-9]/g,"-$&").toLowerCase():a===null&&(a=void 0),/^oninput$/i.test(i)&&(i=i.toLowerCase(),r[i]&&(i="oninputCapture")),r[i]=a)}e=="select"&&r.multiple&&Array.isArray(r.value)&&(r.value=Ud(t.children).forEach(function(o){o.props.selected=r.value.indexOf(o.props.value)!=-1})),e=="select"&&r.defaultValue!=null&&(r.value=Ud(t.children).forEach(function(o){o.props.selected=r.multiple?r.defaultValue.indexOf(o.props.value)!=-1:r.defaultValue==o.props.value})),n.props=r,t.class!=t.className&&(qP.enumerable="className"in t,t.className!=null&&(r.class=t.className),Object.defineProperty(r,"className",qP))}n.$$typeof=y$,GP&&GP(n)};var QP=he.__r;he.__r=function(n){QP&&QP(n),S$=n.__c};var fI=[],iw=new Map;function Ta(n){fI.push(n),iw.forEach(e=>{gI(e,n)})}function pI(n){n.isConnected&&n.getRootNode&&mI(n.getRootNode())}function mI(n){let e=iw.get(n);if(!e||!e.isConnected){if(e=n.querySelector("style[data-fullcalendar]"),!e){e=document.createElement("style"),e.setAttribute("data-fullcalendar","");let t=C$();t&&(e.nonce=t);let r=n===document?document.head:n,s=n===document?r.querySelector("script,link[rel=stylesheet],link[as=style],style"):r.firstChild;r.insertBefore(e,s)}iw.set(n,e),D$(e)}}function D$(n){for(let e of fI)gI(n,e)}function gI(n,e){let{sheet:t}=n,r=t.cssRules.length;e.split("}").forEach((s,i)=>{s=s.trim(),s&&t.insertRule(s+"}",r+i)})}var QT;function C$(){return QT===void 0&&(QT=x$()),QT}function x$(){let n=document.querySelector('meta[name="csp-nonce"]');if(n&&n.hasAttribute("content"))return n.getAttribute("content");let e=document.querySelector("script[nonce]");return e&&e.nonce||""}typeof document!="undefined"&&mI(document);var M$=':root{--fc-small-font-size:.85em;--fc-page-bg-color:#fff;--fc-neutral-bg-color:hsla(0,0%,82%,.3);--fc-neutral-text-color:grey;--fc-border-color:#ddd;--fc-button-text-color:#fff;--fc-button-bg-color:#2c3e50;--fc-button-border-color:#2c3e50;--fc-button-hover-bg-color:#1e2b37;--fc-button-hover-border-color:#1a252f;--fc-button-active-bg-color:#1a252f;--fc-button-active-border-color:#151e27;--fc-event-bg-color:#3788d8;--fc-event-border-color:#3788d8;--fc-event-text-color:#fff;--fc-event-selected-overlay-color:rgba(0,0,0,.25);--fc-more-link-bg-color:#d0d0d0;--fc-more-link-text-color:inherit;--fc-event-resizer-thickness:8px;--fc-event-resizer-dot-total-width:8px;--fc-event-resizer-dot-border-width:1px;--fc-non-business-color:hsla(0,0%,84%,.3);--fc-bg-event-color:#8fdf82;--fc-bg-event-opacity:0.3;--fc-highlight-color:rgba(188,232,241,.3);--fc-today-bg-color:rgba(255,220,40,.15);--fc-now-indicator-color:red}.fc-not-allowed,.fc-not-allowed .fc-event{cursor:not-allowed}.fc{display:flex;flex-direction:column;font-size:1em}.fc,.fc *,.fc :after,.fc :before{box-sizing:border-box}.fc table{border-collapse:collapse;border-spacing:0;font-size:1em}.fc th{text-align:center}.fc td,.fc th{padding:0;vertical-align:top}.fc a[data-navlink]{cursor:pointer}.fc a[data-navlink]:hover{text-decoration:underline}.fc-direction-ltr{direction:ltr;text-align:left}.fc-direction-rtl{direction:rtl;text-align:right}.fc-theme-standard td,.fc-theme-standard th{border:1px solid var(--fc-border-color)}.fc-liquid-hack td,.fc-liquid-hack th{position:relative}@font-face{font-family:fcicons;font-style:normal;font-weight:400;src:url("data:application/x-font-ttf;charset=utf-8;base64,AAEAAAALAIAAAwAwT1MvMg8SBfAAAAC8AAAAYGNtYXAXVtKNAAABHAAAAFRnYXNwAAAAEAAAAXAAAAAIZ2x5ZgYydxIAAAF4AAAFNGhlYWQUJ7cIAAAGrAAAADZoaGVhB20DzAAABuQAAAAkaG10eCIABhQAAAcIAAAALGxvY2ED4AU6AAAHNAAAABhtYXhwAA8AjAAAB0wAAAAgbmFtZXsr690AAAdsAAABhnBvc3QAAwAAAAAI9AAAACAAAwPAAZAABQAAApkCzAAAAI8CmQLMAAAB6wAzAQkAAAAAAAAAAAAAAAAAAAABEAAAAAAAAAAAAAAAAAAAAABAAADpBgPA/8AAQAPAAEAAAAABAAAAAAAAAAAAAAAgAAAAAAADAAAAAwAAABwAAQADAAAAHAADAAEAAAAcAAQAOAAAAAoACAACAAIAAQAg6Qb//f//AAAAAAAg6QD//f//AAH/4xcEAAMAAQAAAAAAAAAAAAAAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAWIAjQKeAskAEwAAJSc3NjQnJiIHAQYUFwEWMjc2NCcCnuLiDQ0MJAz/AA0NAQAMJAwNDcni4gwjDQwM/wANIwz/AA0NDCMNAAAAAQFiAI0CngLJABMAACUBNjQnASYiBwYUHwEHBhQXFjI3AZ4BAA0N/wAMJAwNDeLiDQ0MJAyNAQAMIw0BAAwMDSMM4uINIwwNDQAAAAIA4gC3Ax4CngATACcAACUnNzY0JyYiDwEGFB8BFjI3NjQnISc3NjQnJiIPAQYUHwEWMjc2NCcB87e3DQ0MIw3VDQ3VDSMMDQ0BK7e3DQ0MJAzVDQ3VDCQMDQ3zuLcMJAwNDdUNIwzWDAwNIwy4twwkDA0N1Q0jDNYMDA0jDAAAAgDiALcDHgKeABMAJwAAJTc2NC8BJiIHBhQfAQcGFBcWMjchNzY0LwEmIgcGFB8BBwYUFxYyNwJJ1Q0N1Q0jDA0Nt7cNDQwjDf7V1Q0N1QwkDA0Nt7cNDQwkDLfWDCMN1Q0NDCQMt7gMIw0MDNYMIw3VDQ0MJAy3uAwjDQwMAAADAFUAAAOrA1UAMwBoAHcAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMhMjY1NCYjISIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAAVYRGRkR/qoRGRkRA1UFBAUOCQkVDAsZDf2rDRkLDBUJCA4FBQUFBQUOCQgVDAsZDQJVDRkLDBUJCQ4FBAVVAgECBQMCBwQECAX9qwQJAwQHAwMFAQICAgIBBQMDBwQDCQQCVQUIBAQHAgMFAgEC/oAZEhEZGRESGQAAAAADAFUAAAOrA1UAMwBoAIkAABMiBgcOAQcOAQcOARURFBYXHgEXHgEXHgEzITI2Nz4BNz4BNz4BNRE0JicuAScuAScuASMFITIWFx4BFx4BFx4BFREUBgcOAQcOAQcOASMhIiYnLgEnLgEnLgE1ETQ2Nz4BNz4BNz4BMxMzFRQWMzI2PQEzMjY1NCYrATU0JiMiBh0BIyIGFRQWM9UNGAwLFQkJDgUFBQUFBQ4JCRULDBgNAlYNGAwLFQkJDgUFBQUFBQ4JCRULDBgN/aoCVgQIBAQHAwMFAQIBAQIBBQMDBwQECAT9qgQIBAQHAwMFAQIBAQIBBQMDBwQECASAgBkSEhmAERkZEYAZEhIZgBEZGREDVQUEBQ4JCRUMCxkN/asNGQsMFQkIDgUFBQUFBQ4JCBUMCxkNAlUNGQsMFQkJDgUEBVUCAQIFAwIHBAQIBf2rBAkDBAcDAwUBAgICAgEFAwMHBAMJBAJVBQgEBAcCAwUCAQL+gIASGRkSgBkSERmAEhkZEoAZERIZAAABAOIAjQMeAskAIAAAExcHBhQXFjI/ARcWMjc2NC8BNzY0JyYiDwEnJiIHBhQX4uLiDQ0MJAzi4gwkDA0N4uINDQwkDOLiDCQMDQ0CjeLiDSMMDQ3h4Q0NDCMN4uIMIw0MDOLiDAwNIwwAAAABAAAAAQAAa5n0y18PPPUACwQAAAAAANivOVsAAAAA2K85WwAAAAADqwNVAAAACAACAAAAAAAAAAEAAAPA/8AAAAQAAAAAAAOrAAEAAAAAAAAAAAAAAAAAAAALBAAAAAAAAAAAAAAAAgAAAAQAAWIEAAFiBAAA4gQAAOIEAABVBAAAVQQAAOIAAAAAAAoAFAAeAEQAagCqAOoBngJkApoAAQAAAAsAigADAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGZjaWNvbnMAZgBjAGkAYwBvAG4Ac1ZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGZjaWNvbnMAZgBjAGkAYwBvAG4Ac2ZjaWNvbnMAZgBjAGkAYwBvAG4Ac1JlZ3VsYXIAUgBlAGcAdQBsAGEAcmZjaWNvbnMAZgBjAGkAYwBvAG4Ac0ZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=") format("truetype")}.fc-icon{speak:none;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;display:inline-block;font-family:fcicons!important;font-style:normal;font-variant:normal;font-weight:400;height:1em;line-height:1;text-align:center;text-transform:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:1em}.fc-icon-chevron-left:before{content:"\\e900"}.fc-icon-chevron-right:before{content:"\\e901"}.fc-icon-chevrons-left:before{content:"\\e902"}.fc-icon-chevrons-right:before{content:"\\e903"}.fc-icon-minus-square:before{content:"\\e904"}.fc-icon-plus-square:before{content:"\\e905"}.fc-icon-x:before{content:"\\e906"}.fc .fc-button{border-radius:0;font-family:inherit;font-size:inherit;line-height:inherit;margin:0;overflow:visible;text-transform:none}.fc .fc-button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}.fc .fc-button{-webkit-appearance:button}.fc .fc-button:not(:disabled){cursor:pointer}.fc .fc-button{background-color:transparent;border:1px solid transparent;border-radius:.25em;display:inline-block;font-size:1em;font-weight:400;line-height:1.5;padding:.4em .65em;text-align:center;-webkit-user-select:none;-moz-user-select:none;user-select:none;vertical-align:middle}.fc .fc-button:hover{text-decoration:none}.fc .fc-button:focus{box-shadow:0 0 0 .2rem rgba(44,62,80,.25);outline:0}.fc .fc-button:disabled{opacity:.65}.fc .fc-button-primary{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:hover{background-color:var(--fc-button-hover-bg-color);border-color:var(--fc-button-hover-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:disabled{background-color:var(--fc-button-bg-color);border-color:var(--fc-button-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button-primary:not(:disabled).fc-button-active,.fc .fc-button-primary:not(:disabled):active{background-color:var(--fc-button-active-bg-color);border-color:var(--fc-button-active-border-color);color:var(--fc-button-text-color)}.fc .fc-button-primary:not(:disabled).fc-button-active:focus,.fc .fc-button-primary:not(:disabled):active:focus{box-shadow:0 0 0 .2rem rgba(76,91,106,.5)}.fc .fc-button .fc-icon{font-size:1.5em;vertical-align:middle}.fc .fc-button-group{display:inline-flex;position:relative;vertical-align:middle}.fc .fc-button-group>.fc-button{flex:1 1 auto;position:relative}.fc .fc-button-group>.fc-button.fc-button-active,.fc .fc-button-group>.fc-button:active,.fc .fc-button-group>.fc-button:focus,.fc .fc-button-group>.fc-button:hover{z-index:1}.fc-direction-ltr .fc-button-group>.fc-button:not(:first-child){border-bottom-left-radius:0;border-top-left-radius:0;margin-left:-1px}.fc-direction-ltr .fc-button-group>.fc-button:not(:last-child){border-bottom-right-radius:0;border-top-right-radius:0}.fc-direction-rtl .fc-button-group>.fc-button:not(:first-child){border-bottom-right-radius:0;border-top-right-radius:0;margin-right:-1px}.fc-direction-rtl .fc-button-group>.fc-button:not(:last-child){border-bottom-left-radius:0;border-top-left-radius:0}.fc .fc-toolbar{align-items:center;display:flex;justify-content:space-between}.fc .fc-toolbar.fc-header-toolbar{margin-bottom:1.5em}.fc .fc-toolbar.fc-footer-toolbar{margin-top:1.5em}.fc .fc-toolbar-title{font-size:1.75em;margin:0}.fc-direction-ltr .fc-toolbar>*>:not(:first-child){margin-left:.75em}.fc-direction-rtl .fc-toolbar>*>:not(:first-child){margin-right:.75em}.fc-direction-rtl .fc-toolbar-ltr{flex-direction:row-reverse}.fc .fc-scroller{-webkit-overflow-scrolling:touch;position:relative}.fc .fc-scroller-liquid{height:100%}.fc .fc-scroller-liquid-absolute{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-scroller-harness{direction:ltr;overflow:hidden;position:relative}.fc .fc-scroller-harness-liquid{height:100%}.fc-direction-rtl .fc-scroller-harness>.fc-scroller{direction:rtl}.fc-theme-standard .fc-scrollgrid{border:1px solid var(--fc-border-color)}.fc .fc-scrollgrid,.fc .fc-scrollgrid table{table-layout:fixed;width:100%}.fc .fc-scrollgrid table{border-left-style:hidden;border-right-style:hidden;border-top-style:hidden}.fc .fc-scrollgrid{border-bottom-width:0;border-collapse:separate;border-right-width:0}.fc .fc-scrollgrid-liquid{height:100%}.fc .fc-scrollgrid-section,.fc .fc-scrollgrid-section table,.fc .fc-scrollgrid-section>td{height:1px}.fc .fc-scrollgrid-section-liquid>td{height:100%}.fc .fc-scrollgrid-section>*{border-left-width:0;border-top-width:0}.fc .fc-scrollgrid-section-footer>*,.fc .fc-scrollgrid-section-header>*{border-bottom-width:0}.fc .fc-scrollgrid-section-body table,.fc .fc-scrollgrid-section-footer table{border-bottom-style:hidden}.fc .fc-scrollgrid-section-sticky>*{background:var(--fc-page-bg-color);position:sticky;z-index:3}.fc .fc-scrollgrid-section-header.fc-scrollgrid-section-sticky>*{top:0}.fc .fc-scrollgrid-section-footer.fc-scrollgrid-section-sticky>*{bottom:0}.fc .fc-scrollgrid-sticky-shim{height:1px;margin-bottom:-1px}.fc-sticky{position:sticky}.fc .fc-view-harness{flex-grow:1;position:relative}.fc .fc-view-harness-active>.fc-view{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-col-header-cell-cushion{display:inline-block;padding:2px 4px}.fc .fc-bg-event,.fc .fc-highlight,.fc .fc-non-business{bottom:0;left:0;position:absolute;right:0;top:0}.fc .fc-non-business{background:var(--fc-non-business-color)}.fc .fc-bg-event{background:var(--fc-bg-event-color);opacity:var(--fc-bg-event-opacity)}.fc .fc-bg-event .fc-event-title{font-size:var(--fc-small-font-size);font-style:italic;margin:.5em}.fc .fc-highlight{background:var(--fc-highlight-color)}.fc .fc-cell-shaded,.fc .fc-day-disabled{background:var(--fc-neutral-bg-color)}a.fc-event,a.fc-event:hover{text-decoration:none}.fc-event.fc-event-draggable,.fc-event[href]{cursor:pointer}.fc-event .fc-event-main{position:relative;z-index:2}.fc-event-dragging:not(.fc-event-selected){opacity:.75}.fc-event-dragging.fc-event-selected{box-shadow:0 2px 7px rgba(0,0,0,.3)}.fc-event .fc-event-resizer{display:none;position:absolute;z-index:4}.fc-event-selected .fc-event-resizer,.fc-event:hover .fc-event-resizer{display:block}.fc-event-selected .fc-event-resizer{background:var(--fc-page-bg-color);border-color:inherit;border-radius:calc(var(--fc-event-resizer-dot-total-width)/2);border-style:solid;border-width:var(--fc-event-resizer-dot-border-width);height:var(--fc-event-resizer-dot-total-width);width:var(--fc-event-resizer-dot-total-width)}.fc-event-selected .fc-event-resizer:before{bottom:-20px;content:"";left:-20px;position:absolute;right:-20px;top:-20px}.fc-event-selected,.fc-event:focus{box-shadow:0 2px 5px rgba(0,0,0,.2)}.fc-event-selected:before,.fc-event:focus:before{bottom:0;content:"";left:0;position:absolute;right:0;top:0;z-index:3}.fc-event-selected:after,.fc-event:focus:after{background:var(--fc-event-selected-overlay-color);bottom:-1px;content:"";left:-1px;position:absolute;right:-1px;top:-1px;z-index:1}.fc-h-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-h-event .fc-event-main{color:var(--fc-event-text-color)}.fc-h-event .fc-event-main-frame{display:flex}.fc-h-event .fc-event-time{max-width:100%;overflow:hidden}.fc-h-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-width:0}.fc-h-event .fc-event-title{display:inline-block;left:0;max-width:100%;overflow:hidden;right:0;vertical-align:top}.fc-h-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-start),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-end){border-bottom-left-radius:0;border-left-width:0;border-top-left-radius:0}.fc-direction-ltr .fc-daygrid-block-event:not(.fc-event-end),.fc-direction-rtl .fc-daygrid-block-event:not(.fc-event-start){border-bottom-right-radius:0;border-right-width:0;border-top-right-radius:0}.fc-h-event:not(.fc-event-selected) .fc-event-resizer{bottom:0;top:0;width:var(--fc-event-resizer-thickness)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end{cursor:w-resize;left:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-direction-ltr .fc-h-event:not(.fc-event-selected) .fc-event-resizer-end,.fc-direction-rtl .fc-h-event:not(.fc-event-selected) .fc-event-resizer-start{cursor:e-resize;right:calc(var(--fc-event-resizer-thickness)*-.5)}.fc-h-event.fc-event-selected .fc-event-resizer{margin-top:calc(var(--fc-event-resizer-dot-total-width)*-.5);top:50%}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-start,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-end{left:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc-direction-ltr .fc-h-event.fc-event-selected .fc-event-resizer-end,.fc-direction-rtl .fc-h-event.fc-event-selected .fc-event-resizer-start{right:calc(var(--fc-event-resizer-dot-total-width)*-.5)}.fc .fc-popover{box-shadow:0 2px 6px rgba(0,0,0,.15);position:absolute;z-index:9999}.fc .fc-popover-header{align-items:center;display:flex;flex-direction:row;justify-content:space-between;padding:3px 4px}.fc .fc-popover-title{margin:0 2px}.fc .fc-popover-close{cursor:pointer;font-size:1.1em;opacity:.65}.fc-theme-standard .fc-popover{background:var(--fc-page-bg-color);border:1px solid var(--fc-border-color)}.fc-theme-standard .fc-popover-header{background:var(--fc-neutral-bg-color)}';Ta(M$);var mo=class{constructor(e){this.drainedOption=e,this.isRunning=!1,this.isDirty=!1,this.pauseDepths={},this.timeoutId=0}request(e){this.isDirty=!0,this.isPaused()||(this.clearTimeout(),e==null?this.tryDrain():this.timeoutId=setTimeout(this.tryDrain.bind(this),e))}pause(e=""){let{pauseDepths:t}=this;t[e]=(t[e]||0)+1,this.clearTimeout()}resume(e="",t){let{pauseDepths:r}=this;e in r&&(t?delete r[e]:(r[e]-=1,r[e]<=0&&delete r[e]),this.tryDrain())}isPaused(){return Object.keys(this.pauseDepths).length}tryDrain(){if(!this.isRunning&&!this.isPaused()){for(this.isRunning=!0;this.isDirty;)this.isDirty=!1,this.drained();this.isRunning=!1}}clear(){this.clearTimeout(),this.isDirty=!1,this.pauseDepths={}}clearTimeout(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=0)}drained(){this.drainedOption&&this.drainedOption()}};function ru(n){n.parentNode&&n.parentNode.removeChild(n)}function Zt(n,e){if(n.closest)return n.closest(e);if(!document.documentElement.contains(n))return null;do{if(Hm(n,e))return n;n=n.parentElement||n.parentNode}while(n!==null&&n.nodeType===1);return null}function Hm(n,e){return(n.matches||n.matchesSelector||n.msMatchesSelector).call(n,e)}function yI(n,e){let t=n instanceof HTMLElement?[n]:n,r=[];for(let s=0;s<t.length;s+=1){let i=t[s].querySelectorAll(e);for(let a=0;a<i.length;a+=1)r.push(i[a])}return r}var _$=/(top|left|right|bottom|width|height)$/i;function xo(n,e){for(let t in e)mw(n,t,e[t])}function mw(n,e,t){t==null?n.style[e]="":typeof t=="number"&&_$.test(e)?n.style[e]=`${t}px`:n.style[e]=t}function Um(n){var e,t;return(t=(e=n.composedPath)===null||e===void 0?void 0:e.call(n)[0])!==null&&t!==void 0?t:n.target}var eI=0;function xi(){return eI+=1,"fc-dom-"+eI}function su(n){n.preventDefault()}function A$(n,e){return t=>{let r=Zt(t.target,n);r&&e.call(r,t,r)}}function gw(n,e,t,r){let s=A$(t,r);return n.addEventListener(e,s),()=>{n.removeEventListener(e,s)}}function vI(n,e,t,r){let s;return gw(n,"mouseover",e,(i,a)=>{if(a!==s){s=a,t(i,a);let o=l=>{s=null,r(l,a),a.removeEventListener("mouseleave",o)};a.addEventListener("mouseleave",o)}})}var tI=["webkitTransitionEnd","otransitionend","oTransitionEnd","msTransitionEnd","transitionend"];function yw(n,e){let t=r=>{e(r),tI.forEach(s=>{n.removeEventListener(s,t)})};tI.forEach(r=>{n.addEventListener(r,t)})}function TI(n){return Object.assign({onClick:n},wI(n))}function wI(n){return{tabIndex:0,onKeyDown(e){(e.key==="Enter"||e.key===" ")&&(n(e),e.preventDefault())}}}var rI=0;function Mi(){return rI+=1,String(rI)}function Zl(){document.body.classList.add("fc-not-allowed")}function Jl(){document.body.classList.remove("fc-not-allowed")}function vw(n){n.style.userSelect="none",n.style.webkitUserSelect="none",n.addEventListener("selectstart",su)}function Tw(n){n.style.userSelect="",n.style.webkitUserSelect="",n.removeEventListener("selectstart",su)}function ww(n){n.addEventListener("contextmenu",su)}function bw(n){n.removeEventListener("contextmenu",su)}function bI(n){let e=[],t=[],r,s;for(typeof n=="string"?t=n.split(/\s*,\s*/):typeof n=="function"?t=[n]:Array.isArray(n)&&(t=n),r=0;r<t.length;r+=1)s=t[r],typeof s=="string"?e.push(s.charAt(0)==="-"?{field:s.substring(1),order:-1}:{field:s,order:1}):typeof s=="function"&&e.push({func:s});return e}function kI(n,e,t){let r,s;for(r=0;r<t.length;r+=1)if(s=P$(n,e,t[r]),s)return s;return 0}function P$(n,e,t){return t.func?t.func(n,e):EI(n[t.field],e[t.field])*(t.order||1)}function EI(n,e){return!n&&!e?0:e==null?-1:n==null?1:typeof n=="string"||typeof e=="string"?String(n).localeCompare(String(e)):n-e}function po(n,e){let t=String(n);return"000".substr(0,e-t.length)+t}function Xl(n,e,t){return typeof n=="function"?n(...e):typeof n=="string"?e.reduce((r,s,i)=>r.replace("$"+i,s||""),n):t}function kw(n,e){return n-e}function Wd(n){return n%1===0}function I$(n){let e=n.querySelector(".fc-scrollgrid-shrink-frame"),t=n.querySelector(".fc-scrollgrid-shrink-cushion");if(!e)throw new Error("needs fc-scrollgrid-shrink-frame className");if(!t)throw new Error("needs fc-scrollgrid-shrink-cushion className");return n.getBoundingClientRect().width-e.getBoundingClientRect().width+t.getBoundingClientRect().width}var sI=["years","months","days","milliseconds"],R$=/^(-?)(?:(\d+)\.)?(\d+):(\d\d)(?::(\d\d)(?:\.(\d\d\d))?)?/;function Ee(n,e){return typeof n=="string"?N$(n):typeof n=="object"&&n?nI(n):typeof n=="number"?nI({[e||"milliseconds"]:n}):null}function N$(n){let e=R$.exec(n);if(e){let t=e[1]?-1:1;return{years:0,months:0,days:t*(e[2]?parseInt(e[2],10):0),milliseconds:t*((e[3]?parseInt(e[3],10):0)*60*60*1e3+(e[4]?parseInt(e[4],10):0)*60*1e3+(e[5]?parseInt(e[5],10):0)*1e3+(e[6]?parseInt(e[6],10):0))}}return null}function nI(n){let e={years:n.years||n.year||0,months:n.months||n.month||0,days:n.days||n.day||0,milliseconds:(n.hours||n.hour||0)*60*60*1e3+(n.minutes||n.minute||0)*60*1e3+(n.seconds||n.second||0)*1e3+(n.milliseconds||n.millisecond||n.ms||0)},t=n.weeks||n.week;return t&&(e.days+=t*7,e.specifiedWeeks=!0),e}function O$(n,e){return n.years===e.years&&n.months===e.months&&n.days===e.days&&n.milliseconds===e.milliseconds}function nu(n,e){return{years:n.years+e.years,months:n.months+e.months,days:n.days+e.days,milliseconds:n.milliseconds+e.milliseconds}}function SI(n,e){return{years:n.years-e.years,months:n.months-e.months,days:n.days-e.days,milliseconds:n.milliseconds-e.milliseconds}}function Ew(n,e){return{years:n.years*e,months:n.months*e,days:n.days*e,milliseconds:n.milliseconds*e}}function L$(n){return Gl(n)/365}function F$(n){return Gl(n)/30}function Gl(n){return gs(n)/864e5}function gs(n){return n.years*(365*864e5)+n.months*(30*864e5)+n.days*864e5+n.milliseconds}function iu(n,e){let t=null;for(let r=0;r<sI.length;r+=1){let s=sI[r];if(e[s]){let i=n[s]/e[s];if(!Wd(i)||t!==null&&t!==i)return null;t=i}else if(n[s])return null}return t}function $d(n){let e=n.milliseconds;if(e){if(e%1e3!==0)return{unit:"millisecond",value:e};if(e%(1e3*60)!==0)return{unit:"second",value:e/1e3};if(e%(1e3*60*60)!==0)return{unit:"minute",value:e/(1e3*60)};if(e)return{unit:"hour",value:e/(1e3*60*60)}}return n.days?n.specifiedWeeks&&n.days%7===0?{unit:"week",value:n.days/7}:{unit:"day",value:n.days}:n.months?{unit:"month",value:n.months}:n.years?{unit:"year",value:n.years}:{unit:"millisecond",value:0}}function zn(n,e,t){if(n===e)return!0;let r=n.length,s;if(r!==e.length)return!1;for(s=0;s<r;s+=1)if(!(t?t(n[s],e[s]):n[s]===e[s]))return!1;return!0}var B$=["sun","mon","tue","wed","thu","fri","sat"];function Wm(n,e){let t=fa(n);return t[2]+=e*7,Zr(t)}function Ft(n,e){let t=fa(n);return t[2]+=e,Zr(t)}function jn(n,e){let t=fa(n);return t[6]+=e,Zr(t)}function Sw(n,e){return _i(n,e)/7}function _i(n,e){return(e.valueOf()-n.valueOf())/(1e3*60*60*24)}function H$(n,e){return(e.valueOf()-n.valueOf())/(1e3*60*60)}function U$(n,e){return(e.valueOf()-n.valueOf())/(1e3*60)}function W$(n,e){return(e.valueOf()-n.valueOf())/1e3}function DI(n,e){let t=at(n),r=at(e);return{years:0,months:0,days:Math.round(_i(t,r)),milliseconds:e.valueOf()-r.valueOf()-(n.valueOf()-t.valueOf())}}function CI(n,e){let t=Ql(n,e);return t!==null&&t%7===0?t/7:null}function Ql(n,e){return pa(n)===pa(e)?Math.round(_i(n,e)):null}function at(n){return Zr([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()])}function $$(n){return Zr([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours()])}function j$(n){return Zr([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes()])}function V$(n){return Zr([n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds()])}function Y$(n,e,t){let r=n.getUTCFullYear(),s=KT(n,r,e,t);if(s<1)return KT(n,r-1,e,t);let i=KT(n,r+1,e,t);return i>=1?Math.min(s,i):s}function KT(n,e,t,r){let s=Zr([e,0,1+z$(e,t,r)]),i=at(n),a=Math.round(_i(s,i));return Math.floor(a/7)+1}function z$(n,e,t){let r=7+e-t;return-((7+Zr([n,0,r]).getUTCDay()-e)%7)+r-1}function iI(n){return[n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()]}function aI(n){return new Date(n[0],n[1]||0,n[2]==null?1:n[2],n[3]||0,n[4]||0,n[5]||0)}function fa(n){return[n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds()]}function Zr(n){return n.length===1&&(n=n.concat([0])),new Date(Date.UTC(...n))}function Dw(n){return!isNaN(n.valueOf())}function pa(n){return n.getUTCHours()*1e3*60*60+n.getUTCMinutes()*1e3*60+n.getUTCSeconds()*1e3+n.getUTCMilliseconds()}function $m(n,e,t=!1){let r=n.toISOString();return r=r.replace(".000",""),t&&(r=r.replace("T00:00:00Z","")),r.length>10&&(e==null?r=r.replace("Z",""):e!==0&&(r=r.replace("Z",xw(e,!0)))),r}function au(n){return n.toISOString().replace(/T.*$/,"")}function ec(n){return n.toISOString().match(/^\d{4}-\d{2}/)[0]}function Cw(n){return po(n.getUTCHours(),2)+":"+po(n.getUTCMinutes(),2)+":"+po(n.getUTCSeconds(),2)}function xw(n,e=!1){let t=n<0?"-":"+",r=Math.abs(n),s=Math.floor(r/60),i=Math.round(r%60);return e?`${t+po(s,2)}:${po(i,2)}`:`GMT${t}${s}${i?`:${po(i,2)}`:""}`}function de(n,e,t){let r,s;return function(...i){if(!r)s=n.apply(this,i);else if(!zn(r,i)){t&&t(s);let a=n.apply(this,i);(!e||!e(a,s))&&(s=a)}return r=i,s}}function tc(n,e,t){let r,s;return i=>{if(!r)s=n.call(this,i);else if(!Mr(r,i)){t&&t(s);let a=n.call(this,i);(!e||!e(a,s))&&(s=a)}return r=i,s}}var ZT={week:3,separator:9,omitZeroMinute:9,meridiem:9,omitCommas:9},Mm={timeZoneName:7,era:6,year:5,month:4,day:2,weekday:2,hour:1,minute:1,second:1},bm=/\s*([ap])\.?m\.?/i,q$=/,/g,G$=/\s+/g,Q$=/\u200e/g,K$=/UTC|GMT/,aw=class{constructor(e){let t={},r={},s=9;for(let i in e)i in ZT?(r[i]=e[i],ZT[i]<9&&(s=Math.min(ZT[i],s))):(t[i]=e[i],i in Mm&&(s=Math.min(Mm[i],s)));this.standardDateProps=t,this.extendedSettings=r,this.smallestUnitNum=s,this.buildFormattingFunc=de(oI)}format(e,t){return this.buildFormattingFunc(this.standardDateProps,this.extendedSettings,t)(e)}formatRange(e,t,r,s){let{standardDateProps:i,extendedSettings:a}=this,o=rj(e.marker,t.marker,r.calendarSystem);if(!o)return this.format(e,r);let l=o;l>1&&(i.year==="numeric"||i.year==="2-digit")&&(i.month==="numeric"||i.month==="2-digit")&&(i.day==="numeric"||i.day==="2-digit")&&(l=1);let c=this.format(e,r),d=this.format(t,r);if(c===d)return c;let u=sj(i,l),h=oI(u,a,r),f=h(e),p=h(t),m=nj(c,f,d,p),g=a.separator||s||r.defaultSeparator||"";return m?m.before+f+g+p+m.after:c+g+d}getSmallestUnit(){switch(this.smallestUnitNum){case 7:case 6:case 5:return"year";case 4:return"month";case 3:return"week";case 2:return"day";default:return"time"}}};function oI(n,e,t){let r=Object.keys(n).length;return r===1&&n.timeZoneName==="short"?s=>xw(s.timeZoneOffset):r===0&&e.week?s=>tj(t.computeWeekNumber(s.marker),t.weekText,t.weekTextLong,t.locale,e.week):Z$(n,e,t)}function Z$(n,e,t){n=Object.assign({},n),e=Object.assign({},e),J$(n,e),n.timeZone="UTC";let r=new Intl.DateTimeFormat(t.locale.codes,n),s;if(e.omitZeroMinute){let i=Object.assign({},n);delete i.minute,s=new Intl.DateTimeFormat(t.locale.codes,i)}return i=>{let{marker:a}=i,o;s&&!a.getUTCMinutes()?o=s:o=r;let l=o.format(a);return X$(l,i,n,e,t)}}function J$(n,e){n.timeZoneName&&(n.hour||(n.hour="2-digit"),n.minute||(n.minute="2-digit")),n.timeZoneName==="long"&&(n.timeZoneName="short"),e.omitZeroMinute&&(n.second||n.millisecond)&&delete e.omitZeroMinute}function X$(n,e,t,r,s){return n=n.replace(Q$,""),t.timeZoneName==="short"&&(n=ej(n,s.timeZone==="UTC"||e.timeZoneOffset==null?"UTC":xw(e.timeZoneOffset))),r.omitCommas&&(n=n.replace(q$,"").trim()),r.omitZeroMinute&&(n=n.replace(":00","")),r.meridiem===!1?n=n.replace(bm,"").trim():r.meridiem==="narrow"?n=n.replace(bm,(i,a)=>a.toLocaleLowerCase()):r.meridiem==="short"?n=n.replace(bm,(i,a)=>`${a.toLocaleLowerCase()}m`):r.meridiem==="lowercase"&&(n=n.replace(bm,i=>i.toLocaleLowerCase())),n=n.replace(G$," "),n=n.trim(),n}function ej(n,e){let t=!1;return n=n.replace(K$,()=>(t=!0,e)),t||(n+=` ${e}`),n}function tj(n,e,t,r,s){let i=[];return s==="long"?i.push(t):(s==="short"||s==="narrow")&&i.push(e),(s==="long"||s==="short")&&i.push(" "),i.push(r.simpleNumberFormat.format(n)),r.options.direction==="rtl"&&i.reverse(),i.join("")}function rj(n,e,t){return t.getMarkerYear(n)!==t.getMarkerYear(e)?5:t.getMarkerMonth(n)!==t.getMarkerMonth(e)?4:t.getMarkerDay(n)!==t.getMarkerDay(e)?2:pa(n)!==pa(e)?1:0}function sj(n,e){let t={};for(let r in n)(!(r in Mm)||Mm[r]<=e)&&(t[r]=n[r]);return t}function nj(n,e,t,r){let s=0;for(;s<n.length;){let i=n.indexOf(e,s);if(i===-1)break;let a=n.substr(0,i);s=i+e.length;let o=n.substr(s),l=0;for(;l<t.length;){let c=t.indexOf(r,l);if(c===-1)break;let d=t.substr(0,c);l=c+r.length;let u=t.substr(l);if(a===d&&o===u)return{before:a,after:o}}}return null}function lI(n,e){let t=e.markerToArray(n.marker);return{marker:n.marker,timeZoneOffset:n.timeZoneOffset,array:t,year:t[0],month:t[1],day:t[2],hour:t[3],minute:t[4],second:t[5],millisecond:t[6]}}function _m(n,e,t,r){let s=lI(n,t.calendarSystem),i=e?lI(e,t.calendarSystem):null;return{date:s,start:s,end:i,timeZone:t.timeZone,localeCodes:t.locale.codes,defaultSeparator:r||t.defaultSeparator}}var ow=class{constructor(e){this.cmdStr=e}format(e,t,r){return t.cmdFormatter(this.cmdStr,_m(e,null,t,r))}formatRange(e,t,r,s){return r.cmdFormatter(this.cmdStr,_m(e,t,r,s))}},lw=class{constructor(e){this.func=e}format(e,t,r){return this.func(_m(e,null,t,r))}formatRange(e,t,r,s){return this.func(_m(e,t,r,s))}};function rt(n){return typeof n=="object"&&n?new aw(n):typeof n=="string"?new ow(n):typeof n=="function"?new lw(n):null}var Mw={navLinkDayClick:L,navLinkWeekClick:L,duration:Ee,bootstrapFontAwesome:L,buttonIcons:L,customButtons:L,defaultAllDayEventDuration:Ee,defaultTimedEventDuration:Ee,nextDayThreshold:Ee,scrollTime:Ee,scrollTimeReset:Boolean,slotMinTime:Ee,slotMaxTime:Ee,dayPopoverFormat:rt,slotDuration:Ee,snapDuration:Ee,headerToolbar:L,footerToolbar:L,defaultRangeSeparator:String,titleRangeSeparator:String,forceEventDuration:Boolean,dayHeaders:Boolean,dayHeaderFormat:rt,dayHeaderClassNames:L,dayHeaderContent:L,dayHeaderDidMount:L,dayHeaderWillUnmount:L,dayCellClassNames:L,dayCellContent:L,dayCellDidMount:L,dayCellWillUnmount:L,initialView:String,aspectRatio:Number,weekends:Boolean,weekNumberCalculation:L,weekNumbers:Boolean,weekNumberClassNames:L,weekNumberContent:L,weekNumberDidMount:L,weekNumberWillUnmount:L,editable:Boolean,viewClassNames:L,viewDidMount:L,viewWillUnmount:L,nowIndicator:Boolean,nowIndicatorSnap:L,nowIndicatorClassNames:L,nowIndicatorContent:L,nowIndicatorDidMount:L,nowIndicatorWillUnmount:L,showNonCurrentDates:Boolean,lazyFetching:Boolean,startParam:String,endParam:String,timeZoneParam:String,timeZone:String,locales:L,locale:L,themeSystem:String,dragRevertDuration:Number,dragScroll:Boolean,allDayMaintainDuration:Boolean,unselectAuto:Boolean,dropAccept:L,eventOrder:bI,eventOrderStrict:Boolean,handleWindowResize:Boolean,windowResizeDelay:Number,longPressDelay:Number,eventDragMinDistance:Number,expandRows:Boolean,height:L,contentHeight:L,direction:String,weekNumberFormat:rt,eventResizableFromStart:Boolean,displayEventTime:Boolean,displayEventEnd:Boolean,weekText:String,weekTextLong:String,progressiveEventRendering:Boolean,businessHours:L,initialDate:L,now:L,eventDataTransform:L,stickyHeaderDates:L,stickyFooterScrollbar:L,viewHeight:L,defaultAllDay:Boolean,eventSourceFailure:L,eventSourceSuccess:L,eventDisplay:String,eventStartEditable:Boolean,eventDurationEditable:Boolean,eventOverlap:L,eventConstraint:L,eventAllow:L,eventBackgroundColor:String,eventBorderColor:String,eventTextColor:String,eventColor:String,eventClassNames:L,eventContent:L,eventDidMount:L,eventWillUnmount:L,selectConstraint:L,selectOverlap:L,selectAllow:L,droppable:Boolean,unselectCancel:String,slotLabelFormat:L,slotLaneClassNames:L,slotLaneContent:L,slotLaneDidMount:L,slotLaneWillUnmount:L,slotLabelClassNames:L,slotLabelContent:L,slotLabelDidMount:L,slotLabelWillUnmount:L,dayMaxEvents:L,dayMaxEventRows:L,dayMinWidth:Number,slotLabelInterval:Ee,allDayText:String,allDayClassNames:L,allDayContent:L,allDayDidMount:L,allDayWillUnmount:L,slotMinWidth:Number,navLinks:Boolean,eventTimeFormat:rt,rerenderDelay:Number,moreLinkText:L,moreLinkHint:L,selectMinDistance:Number,selectable:Boolean,selectLongPressDelay:Number,eventLongPressDelay:Number,selectMirror:Boolean,eventMaxStack:Number,eventMinHeight:Number,eventMinWidth:Number,eventShortHeight:Number,slotEventOverlap:Boolean,plugins:L,firstDay:Number,dayCount:Number,dateAlignment:String,dateIncrement:Ee,hiddenDays:L,fixedWeekCount:Boolean,validRange:L,visibleRange:L,titleFormat:L,eventInteractive:Boolean,noEventsText:String,viewHint:L,navLinkHint:L,closeHint:String,timeHint:String,eventHint:String,moreLinkClick:L,moreLinkClassNames:L,moreLinkContent:L,moreLinkDidMount:L,moreLinkWillUnmount:L,monthStartFormat:rt,handleCustomRendering:L,customRenderingMetaMap:L,customRenderingReplaces:Boolean},qn={eventDisplay:"auto",defaultRangeSeparator:" - ",titleRangeSeparator:" \u2013 ",defaultTimedEventDuration:"01:00:00",defaultAllDayEventDuration:{day:1},forceEventDuration:!1,nextDayThreshold:"00:00:00",dayHeaders:!0,initialView:"",aspectRatio:1.35,headerToolbar:{start:"title",center:"",end:"today prev,next"},weekends:!0,weekNumbers:!1,weekNumberCalculation:"local",editable:!1,nowIndicator:!1,scrollTime:"06:00:00",scrollTimeReset:!0,slotMinTime:"00:00:00",slotMaxTime:"24:00:00",showNonCurrentDates:!0,lazyFetching:!0,startParam:"start",endParam:"end",timeZoneParam:"timeZone",timeZone:"local",locales:[],locale:"",themeSystem:"standard",dragRevertDuration:500,dragScroll:!0,allDayMaintainDuration:!1,unselectAuto:!0,dropAccept:"*",eventOrder:"start,-duration,allDay,title",dayPopoverFormat:{month:"long",day:"numeric",year:"numeric"},handleWindowResize:!0,windowResizeDelay:100,longPressDelay:1e3,eventDragMinDistance:5,expandRows:!1,navLinks:!1,selectable:!1,eventMinHeight:15,eventMinWidth:30,eventShortHeight:30,monthStartFormat:{month:"long",day:"numeric"},nowIndicatorSnap:"auto"},_w={datesSet:L,eventsSet:L,eventAdd:L,eventChange:L,eventRemove:L,windowResize:L,eventClick:L,eventMouseEnter:L,eventMouseLeave:L,select:L,unselect:L,loading:L,_unmount:L,_beforeprint:L,_afterprint:L,_noEventDrop:L,_noEventResize:L,_resize:L,_scrollRequest:L},Aw={buttonText:L,buttonHints:L,views:L,plugins:L,initialEvents:L,events:L,eventSources:L},wa={headerToolbar:fo,footerToolbar:fo,buttonText:fo,buttonHints:fo,buttonIcons:fo,dateIncrement:fo,plugins:km,events:km,eventSources:km,resources:km};function fo(n,e){return typeof n=="object"&&typeof e=="object"&&n&&e?Mr(n,e):n===e}function km(n,e){return Array.isArray(n)&&Array.isArray(e)?zn(n,e):n===e}var xI={type:String,component:L,buttonText:String,buttonTextKey:String,dateProfileGeneratorClass:L,usesMinMaxTime:Boolean,classNames:L,content:L,didMount:L,willUnmount:L};function jm(n){return Vm(n,wa)}function ou(n,e){let t={},r={};for(let s in e)s in n&&(t[s]=e[s](n[s]));for(let s in n)s in e||(r[s]=n[s]);return{refined:t,extra:r}}function L(n){return n}var{hasOwnProperty:Am}=Object.prototype;function Vm(n,e){let t={};if(e){for(let r in e)if(e[r]===fo){let s=[];for(let i=n.length-1;i>=0;i-=1){let a=n[i][r];if(typeof a=="object"&&a)s.unshift(a);else if(a!==void 0){t[r]=a;break}}s.length&&(t[r]=Vm(s))}}for(let r=n.length-1;r>=0;r-=1){let s=n[r];for(let i in s)i in t||(t[i]=s[i])}return t}function Ei(n,e){let t={};for(let r in n)e(n[r],r)&&(t[r]=n[r]);return t}function Us(n,e){let t={};for(let r in n)t[r]=e(n[r],r);return t}function Pw(n){let e={};for(let t of n)e[t]=!0;return e}function Ym(n){let e=[];for(let t in n)e.push(n[t]);return e}function Mr(n,e){if(n===e)return!0;for(let t in n)if(Am.call(n,t)&&!(t in e))return!1;for(let t in e)if(Am.call(e,t)&&n[t]!==e[t])return!1;return!0}var ij=/^on[A-Z]/;function aj(n,e){let t=oj(n,e);for(let r of t)if(!ij.test(r))return!1;return!0}function oj(n,e){let t=[];for(let r in n)Am.call(n,r)&&(r in e||t.push(r));for(let r in e)Am.call(e,r)&&n[r]!==e[r]&&t.push(r);return t}function Cm(n,e,t={}){if(n===e)return!0;for(let r in e)if(!(r in n&&lj(n[r],e[r],t[r])))return!1;for(let r in n)if(!(r in e))return!1;return!0}function lj(n,e,t){return n===e||t===!0?!0:t?t(n,e):!1}function MI(n,e=0,t,r=1){let s=[];t==null&&(t=Object.keys(n).length);for(let i=e;i<t;i+=r){let a=n[i];a!==void 0&&s.push(a)}return s}var _I={};function cj(n,e){_I[n]=e}function dj(n){return new _I[n]}var cw=class{getMarkerYear(e){return e.getUTCFullYear()}getMarkerMonth(e){return e.getUTCMonth()}getMarkerDay(e){return e.getUTCDate()}arrayToMarker(e){return Zr(e)}markerToArray(e){return fa(e)}};cj("gregory",cw);var uj=/^\s*(\d{4})(-?(\d{2})(-?(\d{2})([T ](\d{2}):?(\d{2})(:?(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/;function AI(n){let e=uj.exec(n);if(e){let t=new Date(Date.UTC(Number(e[1]),e[3]?Number(e[3])-1:0,Number(e[5]||1),Number(e[7]||0),Number(e[8]||0),Number(e[10]||0),e[12]?+`0.${e[12]}`*1e3:0));if(Dw(t)){let r=null;return e[13]&&(r=(e[15]==="-"?-1:1)*(Number(e[16]||0)*60+Number(e[18]||0))),{marker:t,isTimeUnspecified:!e[6],timeZoneOffset:r}}}return null}var jd=class{constructor(e){let t=this.timeZone=e.timeZone,r=t!=="local"&&t!=="UTC";e.namedTimeZoneImpl&&r&&(this.namedTimeZoneImpl=new e.namedTimeZoneImpl(t)),this.canComputeOffset=!!(!r||this.namedTimeZoneImpl),this.calendarSystem=dj(e.calendarSystem),this.locale=e.locale,this.weekDow=e.locale.week.dow,this.weekDoy=e.locale.week.doy,e.weekNumberCalculation==="ISO"&&(this.weekDow=1,this.weekDoy=4),typeof e.firstDay=="number"&&(this.weekDow=e.firstDay),typeof e.weekNumberCalculation=="function"&&(this.weekNumberFunc=e.weekNumberCalculation),this.weekText=e.weekText!=null?e.weekText:e.locale.options.weekText,this.weekTextLong=(e.weekTextLong!=null?e.weekTextLong:e.locale.options.weekTextLong)||this.weekText,this.cmdFormatter=e.cmdFormatter,this.defaultSeparator=e.defaultSeparator}createMarker(e){let t=this.createMarkerMeta(e);return t===null?null:t.marker}createNowMarker(){return this.canComputeOffset?this.timestampToMarker(new Date().valueOf()):Zr(iI(new Date))}createMarkerMeta(e){if(typeof e=="string")return this.parse(e);let t=null;return typeof e=="number"?t=this.timestampToMarker(e):e instanceof Date?(e=e.valueOf(),isNaN(e)||(t=this.timestampToMarker(e))):Array.isArray(e)&&(t=Zr(e)),t===null||!Dw(t)?null:{marker:t,isTimeUnspecified:!1,forcedTzo:null}}parse(e){let t=AI(e);if(t===null)return null;let{marker:r}=t,s=null;return t.timeZoneOffset!==null&&(this.canComputeOffset?r=this.timestampToMarker(r.valueOf()-t.timeZoneOffset*60*1e3):s=t.timeZoneOffset),{marker:r,isTimeUnspecified:t.isTimeUnspecified,forcedTzo:s}}getYear(e){return this.calendarSystem.getMarkerYear(e)}getMonth(e){return this.calendarSystem.getMarkerMonth(e)}getDay(e){return this.calendarSystem.getMarkerDay(e)}add(e,t){let r=this.calendarSystem.markerToArray(e);return r[0]+=t.years,r[1]+=t.months,r[2]+=t.days,r[6]+=t.milliseconds,this.calendarSystem.arrayToMarker(r)}subtract(e,t){let r=this.calendarSystem.markerToArray(e);return r[0]-=t.years,r[1]-=t.months,r[2]-=t.days,r[6]-=t.milliseconds,this.calendarSystem.arrayToMarker(r)}addYears(e,t){let r=this.calendarSystem.markerToArray(e);return r[0]+=t,this.calendarSystem.arrayToMarker(r)}addMonths(e,t){let r=this.calendarSystem.markerToArray(e);return r[1]+=t,this.calendarSystem.arrayToMarker(r)}diffWholeYears(e,t){let{calendarSystem:r}=this;return pa(e)===pa(t)&&r.getMarkerDay(e)===r.getMarkerDay(t)&&r.getMarkerMonth(e)===r.getMarkerMonth(t)?r.getMarkerYear(t)-r.getMarkerYear(e):null}diffWholeMonths(e,t){let{calendarSystem:r}=this;return pa(e)===pa(t)&&r.getMarkerDay(e)===r.getMarkerDay(t)?r.getMarkerMonth(t)-r.getMarkerMonth(e)+(r.getMarkerYear(t)-r.getMarkerYear(e))*12:null}greatestWholeUnit(e,t){let r=this.diffWholeYears(e,t);return r!==null?{unit:"year",value:r}:(r=this.diffWholeMonths(e,t),r!==null?{unit:"month",value:r}:(r=CI(e,t),r!==null?{unit:"week",value:r}:(r=Ql(e,t),r!==null?{unit:"day",value:r}:(r=H$(e,t),Wd(r)?{unit:"hour",value:r}:(r=U$(e,t),Wd(r)?{unit:"minute",value:r}:(r=W$(e,t),Wd(r)?{unit:"second",value:r}:{unit:"millisecond",value:t.valueOf()-e.valueOf()}))))))}countDurationsBetween(e,t,r){let s;return r.years&&(s=this.diffWholeYears(e,t),s!==null)?s/L$(r):r.months&&(s=this.diffWholeMonths(e,t),s!==null)?s/F$(r):r.days&&(s=Ql(e,t),s!==null)?s/Gl(r):(t.valueOf()-e.valueOf())/gs(r)}startOf(e,t){return t==="year"?this.startOfYear(e):t==="month"?this.startOfMonth(e):t==="week"?this.startOfWeek(e):t==="day"?at(e):t==="hour"?$$(e):t==="minute"?j$(e):t==="second"?V$(e):null}startOfYear(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e)])}startOfMonth(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e)])}startOfWeek(e){return this.calendarSystem.arrayToMarker([this.calendarSystem.getMarkerYear(e),this.calendarSystem.getMarkerMonth(e),e.getUTCDate()-(e.getUTCDay()-this.weekDow+7)%7])}computeWeekNumber(e){return this.weekNumberFunc?this.weekNumberFunc(this.toDate(e)):Y$(e,this.weekDow,this.weekDoy)}format(e,t,r={}){return t.format({marker:e,timeZoneOffset:r.forcedTzo!=null?r.forcedTzo:this.offsetForMarker(e)},this)}formatRange(e,t,r,s={}){return s.isEndExclusive&&(t=jn(t,-1)),r.formatRange({marker:e,timeZoneOffset:s.forcedStartTzo!=null?s.forcedStartTzo:this.offsetForMarker(e)},{marker:t,timeZoneOffset:s.forcedEndTzo!=null?s.forcedEndTzo:this.offsetForMarker(t)},this,s.defaultSeparator)}formatIso(e,t={}){let r=null;return t.omitTimeZoneOffset||(t.forcedTzo!=null?r=t.forcedTzo:r=this.offsetForMarker(e)),$m(e,r,t.omitTime)}timestampToMarker(e){return this.timeZone==="local"?Zr(iI(new Date(e))):this.timeZone==="UTC"||!this.namedTimeZoneImpl?new Date(e):Zr(this.namedTimeZoneImpl.timestampToArray(e))}offsetForMarker(e){return this.timeZone==="local"?-aI(fa(e)).getTimezoneOffset():this.timeZone==="UTC"?0:this.namedTimeZoneImpl?this.namedTimeZoneImpl.offsetForArray(fa(e)):null}toDate(e,t){return this.timeZone==="local"?aI(fa(e)):this.timeZone==="UTC"?new Date(e.valueOf()):this.namedTimeZoneImpl?new Date(e.valueOf()-this.namedTimeZoneImpl.offsetForArray(fa(e))*1e3*60):new Date(e.valueOf()-(t||0))}},Si=class{constructor(e){this.iconOverrideOption&&this.setIconOverride(e[this.iconOverrideOption])}setIconOverride(e){let t,r;if(typeof e=="object"&&e){t=Object.assign({},this.iconClasses);for(r in e)t[r]=this.applyIconOverridePrefix(e[r]);this.iconClasses=t}else e===!1&&(this.iconClasses={})}applyIconOverridePrefix(e){let t=this.iconOverridePrefix;return t&&e.indexOf(t)!==0&&(e=t+e),e}getClass(e){return this.classes[e]||""}getIconClass(e,t){let r;return t&&this.rtlIconClasses?r=this.rtlIconClasses[e]||this.iconClasses[e]:r=this.iconClasses[e],r?`${this.baseIconClass} ${r}`:""}getCustomButtonIconClass(e){let t;return this.iconOverrideCustomButtonOption&&(t=e[this.iconOverrideCustomButtonOption],t)?`${this.baseIconClass} ${this.applyIconOverridePrefix(t)}`:""}};Si.prototype.classes={};Si.prototype.iconClasses={};Si.prototype.baseIconClass="";Si.prototype.iconOverridePrefix="";function Vd(n){n();let e=he.debounceRendering,t=[];function r(s){t.push(s)}for(he.debounceRendering=r,ua(E(dw,{}),document.createElement("div"));t.length;)t.shift()();he.debounceRendering=e}var dw=class extends vr{render(){return E("div",{})}componentDidMount(){this.setState({})}};function PI(n){let e=vm(n),t=e.Provider;return e.Provider=function(){let r=!this.getChildContext,s=t.apply(this,arguments);if(r){let i=[];this.shouldComponentUpdate=a=>{this.props.value!==a.value&&i.forEach(o=>{o.context=a.value,o.forceUpdate()})},this.sub=a=>{i.push(a);let o=a.componentWillUnmount;a.componentWillUnmount=()=>{i.splice(i.indexOf(a),1),o&&o.call(a)}}}return s},e}var Pm=class{constructor(e,t,r,s){this.execFunc=e,this.emitter=t,this.scrollTime=r,this.scrollTimeReset=s,this.handleScrollRequest=i=>{this.queuedRequest=Object.assign({},this.queuedRequest||{},i),this.drain()},t.on("_scrollRequest",this.handleScrollRequest),this.fireInitialScroll()}detach(){this.emitter.off("_scrollRequest",this.handleScrollRequest)}update(e){e&&this.scrollTimeReset?this.fireInitialScroll():this.drain()}fireInitialScroll(){this.handleScrollRequest({time:this.scrollTime})}drain(){this.queuedRequest&&this.execFunc(this.queuedRequest)&&(this.queuedRequest=null)}},$s=PI({});function II(n,e,t,r,s,i,a,o,l,c,d,u,h,f){return{dateEnv:s,nowManager:i,options:t,pluginHooks:o,emitter:d,dispatch:l,getCurrentData:c,calendarApi:u,viewSpec:n,viewApi:e,dateProfileGenerator:r,theme:a,isRtl:t.direction==="rtl",addResizeHandler(p){d.on("_resize",p)},removeResizeHandler(p){d.off("_resize",p)},createScrollResponder(p){return new Pm(p,d,Ee(t.scrollTime),t.scrollTimeReset)},registerInteractiveComponent:h,unregisterInteractiveComponent:f}}var Vn=class extends vr{shouldComponentUpdate(e,t){return!Cm(this.props,e,this.propEquality)||!Cm(this.state,t,this.stateEquality)}safeSetState(e){Cm(this.state,Object.assign(Object.assign({},this.state),e),this.stateEquality)||this.setState(e)}};Vn.addPropsEquality=hj;Vn.addStateEquality=fj;Vn.contextType=$s;Vn.prototype.propEquality={};Vn.prototype.stateEquality={};var He=class extends Vn{};He.contextType=$s;function hj(n){let e=Object.create(this.prototype.propEquality);Object.assign(e,n),this.prototype.propEquality=e}function fj(n){let e=Object.create(this.prototype.stateEquality);Object.assign(e,n),this.prototype.stateEquality=e}function vs(n,e){typeof n=="function"?n(e):n&&(n.current=e)}var Yd=class extends He{constructor(){super(...arguments),this.id=Mi(),this.queuedDomNodes=[],this.currentDomNodes=[],this.handleEl=e=>{let{options:t}=this.context,{generatorName:r}=this.props;(!t.customRenderingReplaces||!uw(r,t))&&this.updateElRef(e)},this.updateElRef=e=>{this.props.elRef&&vs(this.props.elRef,e)}}render(){let{props:e,context:t}=this,{options:r}=t,{customGenerator:s,defaultGenerator:i,renderProps:a}=e,o=Iw(e,[],this.handleEl),l=!1,c,d=[],u;if(s!=null){let h=typeof s=="function"?s(a,E):s;if(h===!0)l=!0;else{let f=h&&typeof h=="object";f&&"html"in h?o.dangerouslySetInnerHTML={__html:h.html}:f&&"domNodes"in h?d=Array.prototype.slice.call(h.domNodes):(f?jT(h):typeof h!="function")?c=h:u=h}}else l=!uw(e.generatorName,r);return l&&i&&(c=i(a)),this.queuedDomNodes=d,this.currentGeneratorMeta=u,E(e.elTag,o,c)}componentDidMount(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentDidUpdate(){this.applyQueueudDomNodes(),this.triggerCustomRendering(!0)}componentWillUnmount(){this.triggerCustomRendering(!1)}triggerCustomRendering(e){var t;let{props:r,context:s}=this,{handleCustomRendering:i,customRenderingMetaMap:a}=s.options;if(i){let o=(t=this.currentGeneratorMeta)!==null&&t!==void 0?t:a==null?void 0:a[r.generatorName];o&&i(Object.assign(Object.assign({id:this.id,isActive:e,containerEl:this.base,reportNewContainerEl:this.updateElRef,generatorMeta:o},r),{elClasses:(r.elClasses||[]).filter(pj)}))}}applyQueueudDomNodes(){let{queuedDomNodes:e,currentDomNodes:t}=this,r=this.base;if(!zn(e,t)){t.forEach(ru);for(let s of e)r.appendChild(s);this.currentDomNodes=e}}};Yd.addPropsEquality({elClasses:zn,elStyle:Mr,elAttrs:aj,renderProps:Mr});function uw(n,e){var t;return!!(e.handleCustomRendering&&n&&(!((t=e.customRenderingMetaMap)===null||t===void 0)&&t[n]))}function Iw(n,e,t){let r=Object.assign(Object.assign({},n.elAttrs),{ref:t});return(n.elClasses||e)&&(r.className=(n.elClasses||[]).concat(e||[]).concat(r.className||[]).filter(Boolean).join(" ")),n.elStyle&&(r.style=n.elStyle),r}function pj(n){return!!n}var Rw=PI(0),sr=class extends vr{constructor(){super(...arguments),this.InnerContent=mj.bind(void 0,this),this.handleEl=e=>{this.el=e,this.props.elRef&&(vs(this.props.elRef,e),e&&this.didMountMisfire&&this.componentDidMount())}}render(){let{props:e}=this,t=gj(e.classNameGenerator,e.renderProps);if(e.children){let r=Iw(e,t,this.handleEl),s=e.children(this.InnerContent,e.renderProps,r);return e.elTag?E(e.elTag,r,s):s}else return E(Yd,Object.assign(Object.assign({},e),{elRef:this.handleEl,elTag:e.elTag||"div",elClasses:(e.elClasses||[]).concat(t),renderId:this.context}))}componentDidMount(){var e,t;this.el?(t=(e=this.props).didMount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el})):this.didMountMisfire=!0}componentWillUnmount(){var e,t;(t=(e=this.props).willUnmount)===null||t===void 0||t.call(e,Object.assign(Object.assign({},this.props.renderProps),{el:this.el}))}};sr.contextType=Rw;function mj(n,e){let t=n.props;return E(Yd,Object.assign({renderProps:t.renderProps,generatorName:t.generatorName,customGenerator:t.customGenerator,defaultGenerator:t.defaultGenerator,renderId:n.context},e))}function gj(n,e){let t=typeof n=="function"?n(e):n||[];return typeof t=="string"?[t]:t}var gn=class extends He{render(){let{props:e,context:t}=this,{options:r}=t,s={view:t.viewApi};return E(sr,{elRef:e.elRef,elTag:e.elTag||"div",elAttrs:e.elAttrs,elClasses:[...Nw(e.viewSpec),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,classNameGenerator:r.viewClassNames,generatorName:void 0,didMount:r.viewDidMount,willUnmount:r.viewWillUnmount},()=>e.children)}};function Nw(n){return[`fc-${n.type}-view`,"fc-view"]}function yj(n,e){let t=null,r=null;return n.start&&(t=e.createMarker(n.start)),n.end&&(r=e.createMarker(n.end)),!t&&!r||t&&r&&r<t?null:{start:t,end:r}}function cI(n,e){let t=[],{start:r}=e,s,i;for(n.sort(vj),s=0;s<n.length;s+=1)i=n[s],i.start>r&&t.push({start:r,end:i.start}),i.end>r&&(r=i.end);return r<e.end&&t.push({start:r,end:e.end}),t}function vj(n,e){return n.start.valueOf()-e.start.valueOf()}function ys(n,e){let{start:t,end:r}=n,s=null;return e.start!==null&&(t===null?t=e.start:t=new Date(Math.max(t.valueOf(),e.start.valueOf()))),e.end!=null&&(r===null?r=e.end:r=new Date(Math.min(r.valueOf(),e.end.valueOf()))),(t===null||r===null||t<r)&&(s={start:t,end:r}),s}function RI(n,e){return(n.start===null?null:n.start.valueOf())===(e.start===null?null:e.start.valueOf())&&(n.end===null?null:n.end.valueOf())===(e.end===null?null:e.end.valueOf())}function zm(n,e){return(n.end===null||e.start===null||n.end>e.start)&&(n.start===null||e.end===null||n.start<e.end)}function rc(n,e){return(n.start===null||e.start!==null&&e.start>=n.start)&&(n.end===null||e.end!==null&&e.end<=n.end)}function Hs(n,e){return(n.start===null||e>=n.start)&&(n.end===null||e<n.end)}function Tj(n,e){return e.start!=null&&n<e.start?e.start:e.end!=null&&n>=e.end?new Date(e.end.valueOf()-1):n}function NI(n){let e=Math.floor(_i(n.start,n.end))||1,t=at(n.start),r=Ft(t,e);return{start:t,end:r}}function Ow(n,e=Ee(0)){let t=null,r=null;if(n.end){r=at(n.end);let s=n.end.valueOf()-r.valueOf();s&&s>=gs(e)&&(r=Ft(r,1))}return n.start&&(t=at(n.start),r&&r<=t&&(r=Ft(t,1))),{start:t,end:r}}function ma(n,e,t,r){return r==="year"?Ee(t.diffWholeYears(n,e),"year"):r==="month"?Ee(t.diffWholeMonths(n,e),"month"):DI(n,e)}var go=class{constructor(e){this.props=e,this.initHiddenDays()}buildPrev(e,t,r){let{dateEnv:s}=this.props,i=s.subtract(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(i,-1,r)}buildNext(e,t,r){let{dateEnv:s}=this.props,i=s.add(s.startOf(t,e.currentRangeUnit),e.dateIncrement);return this.build(i,1,r)}build(e,t,r=!0){let{props:s}=this,i,a,o,l,c,d;return i=this.buildValidRange(),i=this.trimHiddenDays(i),r&&(e=Tj(e,i)),a=this.buildCurrentRangeInfo(e,t),o=/^(year|month|week|day)$/.test(a.unit),l=this.buildRenderRange(this.trimHiddenDays(a.range),a.unit,o),l=this.trimHiddenDays(l),c=l,s.showNonCurrentDates||(c=ys(c,a.range)),c=this.adjustActiveRange(c),c=ys(c,i),d=zm(a.range,i),Hs(l,e)||(e=l.start),{currentDate:e,validRange:i,currentRange:a.range,currentRangeUnit:a.unit,isRangeAllDay:o,activeRange:c,renderRange:l,slotMinTime:s.slotMinTime,slotMaxTime:s.slotMaxTime,isValid:d,dateIncrement:this.buildDateIncrement(a.duration)}}buildValidRange(){let e=this.props.validRangeInput,t=typeof e=="function"?e.call(this.props.calendarApi,this.props.dateEnv.toDate(this.props.nowManager.getDateMarker())):e;return this.refineRange(t)||{start:null,end:null}}buildCurrentRangeInfo(e,t){let{props:r}=this,s=null,i=null,a=null,o;return r.duration?(s=r.duration,i=r.durationUnit,a=this.buildRangeFromDuration(e,t,s,i)):(o=this.props.dayCount)?(i="day",a=this.buildRangeFromDayCount(e,t,o)):(a=this.buildCustomVisibleRange(e))?i=r.dateEnv.greatestWholeUnit(a.start,a.end).unit:(s=this.getFallbackDuration(),i=$d(s).unit,a=this.buildRangeFromDuration(e,t,s,i)),{duration:s,unit:i,range:a}}getFallbackDuration(){return Ee({day:1})}adjustActiveRange(e){let{dateEnv:t,usesMinMaxTime:r,slotMinTime:s,slotMaxTime:i}=this.props,{start:a,end:o}=e;return r&&(Gl(s)<0&&(a=at(a),a=t.add(a,s)),Gl(i)>1&&(o=at(o),o=Ft(o,-1),o=t.add(o,i))),{start:a,end:o}}buildRangeFromDuration(e,t,r,s){let{dateEnv:i,dateAlignment:a}=this.props,o,l,c;if(!a){let{dateIncrement:u}=this.props;u&&gs(u)<gs(r)?a=$d(u).unit:a=s}Gl(r)<=1&&this.isHiddenDay(o)&&(o=this.skipHiddenDays(o,t),o=at(o));function d(){o=i.startOf(e,a),l=i.add(o,r),c={start:o,end:l}}return d(),this.trimHiddenDays(c)||(e=this.skipHiddenDays(e,t),d()),c}buildRangeFromDayCount(e,t,r){let{dateEnv:s,dateAlignment:i}=this.props,a=0,o=e,l;i&&(o=s.startOf(o,i)),o=at(o),o=this.skipHiddenDays(o,t),l=o;do l=Ft(l,1),this.isHiddenDay(l)||(a+=1);while(a<r);return{start:o,end:l}}buildCustomVisibleRange(e){let{props:t}=this,r=t.visibleRangeInput,s=typeof r=="function"?r.call(t.calendarApi,t.dateEnv.toDate(e)):r,i=this.refineRange(s);return i&&(i.start==null||i.end==null)?null:i}buildRenderRange(e,t,r){return e}buildDateIncrement(e){let{dateIncrement:t}=this.props,r;return t||((r=this.props.dateAlignment)?Ee(1,r):e||Ee({days:1}))}refineRange(e){if(e){let t=yj(e,this.props.dateEnv);return t&&(t=Ow(t)),t}return null}initHiddenDays(){let e=this.props.hiddenDays||[],t=[],r=0,s;for(this.props.weekends===!1&&e.push(0,6),s=0;s<7;s+=1)(t[s]=e.indexOf(s)!==-1)||(r+=1);if(!r)throw new Error("invalid hiddenDays");this.isHiddenDayHash=t}trimHiddenDays(e){let{start:t,end:r}=e;return t&&(t=this.skipHiddenDays(t)),r&&(r=this.skipHiddenDays(r,-1,!0)),t==null||r==null||t<r?{start:t,end:r}:null}isHiddenDay(e){return e instanceof Date&&(e=e.getUTCDay()),this.isHiddenDayHash[e]}skipHiddenDays(e,t=1,r=!1){for(;this.isHiddenDayHash[(e.getUTCDay()+(r?t:0)+7)%7];)e=Ft(e,t);return e}};function sc(n,e,t,r){return{instanceId:Mi(),defId:n,range:e,forcedStartTzo:t==null?null:t,forcedEndTzo:r==null?null:r}}function wj(n,e,t,r){for(let s=0;s<r.length;s+=1){let i=r[s].parse(n,t);if(i){let{allDay:a}=n;return a==null&&(a=e,a==null&&(a=i.allDayGuess,a==null&&(a=!1))),{allDay:a,duration:i.duration,typeData:i.typeData,typeId:s}}}return null}function yo(n,e,t){let{dateEnv:r,pluginHooks:s,options:i}=t,{defs:a,instances:o}=n;o=Ei(o,l=>!a[l.defId].recurringDef);for(let l in a){let c=a[l];if(c.recurringDef){let{duration:d}=c.recurringDef;d||(d=c.allDay?i.defaultAllDayEventDuration:i.defaultTimedEventDuration);let u=bj(c,d,e,r,s.recurringTypes);for(let h of u){let f=sc(l,{start:h,end:r.add(h,d)});o[f.instanceId]=f}}}return{defs:a,instances:o}}function bj(n,e,t,r,s){let a=s[n.recurringDef.typeId].expand(n.recurringDef.typeData,{start:r.subtract(t.start,e),end:t.end},r);return n.allDay&&(a=a.map(at)),a}var xm={id:String,groupId:String,title:String,url:String,interactive:Boolean},OI={start:L,end:L,date:L,allDay:Boolean},kj=Object.assign(Object.assign(Object.assign({},xm),OI),{extendedProps:L});function LI(n,e,t,r,s=Lw(t),i,a){let{refined:o,extra:l}=lu(n,t,s),c=Sj(e,t),d=wj(o,c,t.dateEnv,t.pluginHooks.recurringTypes);if(d){let h=Kl(o,l,e?e.sourceId:"",d.allDay,!!d.duration,t,i);return h.recurringDef={typeId:d.typeId,typeData:d.typeData,duration:d.duration},{def:h,instance:null}}let u=Ej(o,c,t,r);if(u){let h=Kl(o,l,e?e.sourceId:"",u.allDay,u.hasEnd,t,i),f=sc(h.defId,u.range,u.forcedStartTzo,u.forcedEndTzo);return a&&h.publicId&&a[h.publicId]&&(f.instanceId=a[h.publicId]),{def:h,instance:f}}return null}function lu(n,e,t=Lw(e)){return ou(n,t)}function Lw(n){return Object.assign(Object.assign(Object.assign({},Im),kj),n.pluginHooks.eventRefiners)}function Kl(n,e,t,r,s,i,a){let o={title:n.title||"",groupId:n.groupId||"",publicId:n.id||"",url:n.url||"",recurringDef:null,defId:(a&&n.id?a[n.id]:"")||Mi(),sourceId:t,allDay:r,hasEnd:s,interactive:n.interactive,ui:nc(n,i),extendedProps:Object.assign(Object.assign({},n.extendedProps||{}),e)};for(let l of i.pluginHooks.eventDefMemberAdders)Object.assign(o,l(n));return Object.freeze(o.ui.classNames),Object.freeze(o.extendedProps),o}function Ej(n,e,t,r){let{allDay:s}=n,i,a=null,o=!1,l,c=null,d=n.start!=null?n.start:n.date;if(i=t.dateEnv.createMarkerMeta(d),i)a=i.marker;else if(!r)return null;return n.end!=null&&(l=t.dateEnv.createMarkerMeta(n.end)),s==null&&(e!=null?s=e:s=(!i||i.isTimeUnspecified)&&(!l||l.isTimeUnspecified)),s&&a&&(a=at(a)),l&&(c=l.marker,s&&(c=at(c)),a&&c<=a&&(c=null)),c?o=!0:r||(o=t.options.forceEventDuration||!1,c=t.dateEnv.add(a,s?t.options.defaultAllDayEventDuration:t.options.defaultTimedEventDuration)),{allDay:s,hasEnd:o,range:{start:a,end:c},forcedStartTzo:i?i.forcedTzo:null,forcedEndTzo:l?l.forcedTzo:null}}function Sj(n,e){let t=null;return n&&(t=n.defaultAllDay),t==null&&(t=e.options.defaultAllDay),t}function zd(n,e,t,r,s,i){let a=Jt(),o=Lw(t);for(let l of n){let c=LI(l,e,t,r,o,s,i);c&&vo(c,a)}return a}function vo(n,e=Jt()){return e.defs[n.def.defId]=n.def,n.instance&&(e.instances[n.instance.instanceId]=n.instance),e}function cu(n,e){let t=n.instances[e];if(t){let r=n.defs[t.defId],s=Gm(n,i=>Dj(r,i));return s.defs[r.defId]=r,s.instances[t.instanceId]=t,s}return Jt()}function Dj(n,e){return!!(n.groupId&&n.groupId===e.groupId)}function Jt(){return{defs:{},instances:{}}}function qm(n,e){return{defs:Object.assign(Object.assign({},n.defs),e.defs),instances:Object.assign(Object.assign({},n.instances),e.instances)}}function Gm(n,e){let t=Ei(n.defs,e),r=Ei(n.instances,s=>t[s.defId]);return{defs:t,instances:r}}function Cj(n,e){let{defs:t,instances:r}=n,s={},i={};for(let a in t)e.defs[a]||(s[a]=t[a]);for(let a in r)!e.instances[a]&&s[r[a].defId]&&(i[a]=r[a]);return{defs:s,instances:i}}function xj(n,e){return Array.isArray(n)?zd(n,null,e,!0):typeof n=="object"&&n?zd([n],null,e,!0):n!=null?String(n):null}function hw(n){return Array.isArray(n)?n:typeof n=="string"?n.split(/\s+/):[]}var Im={display:String,editable:Boolean,startEditable:Boolean,durationEditable:Boolean,constraint:L,overlap:L,allow:L,className:hw,classNames:hw,color:String,backgroundColor:String,borderColor:String,textColor:String},Mj={display:null,startEditable:null,durationEditable:null,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]};function nc(n,e){let t=xj(n.constraint,e);return{display:n.display||null,startEditable:n.startEditable!=null?n.startEditable:n.editable,durationEditable:n.durationEditable!=null?n.durationEditable:n.editable,constraints:t!=null?[t]:[],overlap:n.overlap!=null?n.overlap:null,allows:n.allow!=null?[n.allow]:[],backgroundColor:n.backgroundColor||n.color||"",borderColor:n.borderColor||n.color||"",textColor:n.textColor||"",classNames:(n.className||[]).concat(n.classNames||[])}}function Fw(n){return n.reduce(_j,Mj)}function _j(n,e){return{display:e.display!=null?e.display:n.display,startEditable:e.startEditable!=null?e.startEditable:n.startEditable,durationEditable:e.durationEditable!=null?e.durationEditable:n.durationEditable,constraints:n.constraints.concat(e.constraints),overlap:typeof e.overlap=="boolean"?e.overlap:n.overlap,allows:n.allows.concat(e.allows),backgroundColor:e.backgroundColor||n.backgroundColor,borderColor:e.borderColor||n.borderColor,textColor:e.textColor||n.textColor,classNames:n.classNames.concat(e.classNames)}}var Aj={id:String,defaultAllDay:Boolean,url:String,format:String,events:L,eventDataTransform:L,success:L,failure:L};function Bw(n,e,t=Hw(e)){let r;if(typeof n=="string"?r={url:n}:typeof n=="function"||Array.isArray(n)?r={events:n}:typeof n=="object"&&n&&(r=n),r){let{refined:s,extra:i}=ou(r,t),a=Pj(s,e);if(a)return{_raw:n,isFetching:!1,latestFetchId:"",fetchRange:null,defaultAllDay:s.defaultAllDay,eventDataTransform:s.eventDataTransform,success:s.success,failure:s.failure,publicId:s.id||"",sourceId:Mi(),sourceDefId:a.sourceDefId,meta:a.meta,ui:nc(s,e),extendedProps:i}}return null}function Hw(n){return Object.assign(Object.assign(Object.assign({},Im),Aj),n.pluginHooks.eventSourceRefiners)}function Pj(n,e){let t=e.pluginHooks.eventSourceDefs;for(let r=t.length-1;r>=0;r-=1){let i=t[r].parseMeta(n);if(i)return{sourceDefId:r,meta:i}}return null}function FI(n,e,t,r,s){switch(e.type){case"RECEIVE_EVENTS":return Ij(n,t[e.sourceId],e.fetchId,e.fetchRange,e.rawEvents,s);case"RESET_RAW_EVENTS":return Rj(n,t[e.sourceId],e.rawEvents,r.activeRange,s);case"ADD_EVENTS":return Nj(n,e.eventStore,r?r.activeRange:null,s);case"RESET_EVENTS":return e.eventStore;case"MERGE_EVENTS":return qm(n,e.eventStore);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return r?yo(n,r.activeRange,s):n;case"REMOVE_EVENTS":return Cj(n,e.eventStore);case"REMOVE_EVENT_SOURCE":return HI(n,e.sourceId);case"REMOVE_ALL_EVENT_SOURCES":return Gm(n,i=>!i.sourceId);case"REMOVE_ALL_EVENTS":return Jt();default:return n}}function Ij(n,e,t,r,s,i){if(e&&t===e.latestFetchId){let a=zd(BI(s,e,i),e,i);return r&&(a=yo(a,r,i)),qm(HI(n,e.sourceId),a)}return n}function Rj(n,e,t,r,s){let{defIdMap:i,instanceIdMap:a}=Lj(n),o=zd(BI(t,e,s),e,s,!1,i,a);return yo(o,r,s)}function BI(n,e,t){let r=t.options.eventDataTransform,s=e?e.eventDataTransform:null;return s&&(n=dI(n,s)),r&&(n=dI(n,r)),n}function dI(n,e){let t;if(!e)t=n;else{t=[];for(let r of n){let s=e(r);s?t.push(s):s==null&&t.push(r)}}return t}function Nj(n,e,t,r){return t&&(e=yo(e,t,r)),qm(n,e)}function Uw(n,e,t){let{defs:r}=n,s=Us(n.instances,i=>r[i.defId].allDay?i:Object.assign(Object.assign({},i),{range:{start:t.createMarker(e.toDate(i.range.start,i.forcedStartTzo)),end:t.createMarker(e.toDate(i.range.end,i.forcedEndTzo))},forcedStartTzo:t.canComputeOffset?null:i.forcedStartTzo,forcedEndTzo:t.canComputeOffset?null:i.forcedEndTzo}));return{defs:r,instances:s}}function HI(n,e){return Gm(n,t=>t.sourceId!==e)}function Oj(n,e){return{defs:n.defs,instances:Ei(n.instances,t=>!e[t.instanceId])}}function Lj(n){let{defs:e,instances:t}=n,r={},s={};for(let i in e){let a=e[i],{publicId:o}=a;o&&(r[o]=i)}for(let i in t){let a=t[i],o=e[a.defId],{publicId:l}=o;l&&(s[l]=i)}return{defIdMap:r,instanceIdMap:s}}var Di=class{constructor(){this.handlers={},this.thisContext=null}setThisContext(e){this.thisContext=e}setOptions(e){this.options=e}on(e,t){Fj(this.handlers,e,t)}off(e,t){Bj(this.handlers,e,t)}trigger(e,...t){let r=this.handlers[e]||[],s=this.options&&this.options[e],i=[].concat(s||[],r);for(let a of i)a.apply(this.thisContext,t)}hasHandlers(e){return!!(this.handlers[e]&&this.handlers[e].length||this.options&&this.options[e])}};function Fj(n,e,t){(n[e]||(n[e]=[])).push(t)}function Bj(n,e,t){t?n[e]&&(n[e]=n[e].filter(r=>r!==t)):delete n[e]}var Hj={startTime:"09:00",endTime:"17:00",daysOfWeek:[1,2,3,4,5],display:"inverse-background",classNames:"fc-non-business",groupId:"_businessHours"};function Ww(n,e){return zd(Uj(n),null,e)}function Uj(n){let e;return n===!0?e=[{}]:Array.isArray(n)?e=n.filter(t=>t.daysOfWeek):typeof n=="object"&&n?e=[n]:e=[],e=e.map(t=>Object.assign(Object.assign({},Hj),t)),e}function Qm(n,e,t){t.emitter.trigger("select",Object.assign(Object.assign({},$w(n,t)),{jsEvent:e?e.origEvent:null,view:t.viewApi||t.calendarApi.view}))}function Wj(n,e){e.emitter.trigger("unselect",{jsEvent:n?n.origEvent:null,view:e.viewApi||e.calendarApi.view})}function $w(n,e){let t={};for(let r of e.pluginHooks.dateSpanTransforms)Object.assign(t,r(n,e));return Object.assign(t,Xj(n,e.dateEnv)),t}function qd(n,e,t){let{dateEnv:r,options:s}=t,i=e;return n?(i=at(i),i=r.add(i,s.defaultAllDayEventDuration)):i=r.add(i,s.defaultTimedEventDuration),i}function du(n,e,t,r){let s=Nm(n.defs,e),i=Jt();for(let a in n.defs){let o=n.defs[a];i.defs[a]=$j(o,s[a],t,r)}for(let a in n.instances){let o=n.instances[a],l=i.defs[o.defId];i.instances[a]=jj(o,l,s[o.defId],t,r)}return i}function $j(n,e,t,r){let s=t.standardProps||{};s.hasEnd==null&&e.durationEditable&&(t.startDelta||t.endDelta)&&(s.hasEnd=!0);let i=Object.assign(Object.assign(Object.assign({},n),s),{ui:Object.assign(Object.assign({},n.ui),s.ui)});t.extendedProps&&(i.extendedProps=Object.assign(Object.assign({},i.extendedProps),t.extendedProps));for(let a of r.pluginHooks.eventDefMutationAppliers)a(i,t,r);return!i.hasEnd&&r.options.forceEventDuration&&(i.hasEnd=!0),i}function jj(n,e,t,r,s){let{dateEnv:i}=s,a=r.standardProps&&r.standardProps.allDay===!0,o=r.standardProps&&r.standardProps.hasEnd===!1,l=Object.assign({},n);return a&&(l.range=NI(l.range)),r.datesDelta&&t.startEditable&&(l.range={start:i.add(l.range.start,r.datesDelta),end:i.add(l.range.end,r.datesDelta)}),r.startDelta&&t.durationEditable&&(l.range={start:i.add(l.range.start,r.startDelta),end:l.range.end}),r.endDelta&&t.durationEditable&&(l.range={start:l.range.start,end:i.add(l.range.end,r.endDelta)}),o&&(l.range={start:l.range.start,end:qd(e.allDay,l.range.start,s)}),e.allDay&&(l.range={start:at(l.range.start),end:at(l.range.end)}),l.range.end<l.range.start&&(l.range.end=qd(e.allDay,l.range.start,s)),l}var ha=class{constructor(e,t){this.context=e,this.internalEventSource=t}remove(){this.context.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:this.internalEventSource.sourceId})}refetch(){this.context.dispatch({type:"FETCH_EVENT_SOURCES",sourceIds:[this.internalEventSource.sourceId],isRefetch:!0})}get id(){return this.internalEventSource.publicId}get url(){return this.internalEventSource.meta.url}get format(){return this.internalEventSource.meta.format}},dt=class n{constructor(e,t,r){this._context=e,this._def=t,this._instance=r||null}setProp(e,t){if(e in OI)console.warn("Could not set date-related prop 'name'. Use one of the date-related methods instead.");else if(e==="id")t=xm[e](t),this.mutate({standardProps:{publicId:t}});else if(e in xm)t=xm[e](t),this.mutate({standardProps:{[e]:t}});else if(e in Im){let r=Im[e](t);e==="color"?r={backgroundColor:t,borderColor:t}:e==="editable"?r={startEditable:t,durationEditable:t}:r={[e]:t},this.mutate({standardProps:{ui:r}})}else console.warn(`Could not set prop '${e}'. Use setExtendedProp instead.`)}setExtendedProp(e,t){this.mutate({extendedProps:{[e]:t}})}setStart(e,t={}){let{dateEnv:r}=this._context,s=r.createMarker(e);if(s&&this._instance){let i=this._instance.range,a=ma(i.start,s,r,t.granularity);t.maintainDuration?this.mutate({datesDelta:a}):this.mutate({startDelta:a})}}setEnd(e,t={}){let{dateEnv:r}=this._context,s;if(!(e!=null&&(s=r.createMarker(e),!s))&&this._instance)if(s){let i=ma(this._instance.range.end,s,r,t.granularity);this.mutate({endDelta:i})}else this.mutate({standardProps:{hasEnd:!1}})}setDates(e,t,r={}){let{dateEnv:s}=this._context,i={allDay:r.allDay},a=s.createMarker(e),o;if(a&&!(t!=null&&(o=s.createMarker(t),!o))&&this._instance){let l=this._instance.range;r.allDay===!0&&(l=NI(l));let c=ma(l.start,a,s,r.granularity);if(o){let d=ma(l.end,o,s,r.granularity);O$(c,d)?this.mutate({datesDelta:c,standardProps:i}):this.mutate({startDelta:c,endDelta:d,standardProps:i})}else i.hasEnd=!1,this.mutate({datesDelta:c,standardProps:i})}}moveStart(e){let t=Ee(e);t&&this.mutate({startDelta:t})}moveEnd(e){let t=Ee(e);t&&this.mutate({endDelta:t})}moveDates(e){let t=Ee(e);t&&this.mutate({datesDelta:t})}setAllDay(e,t={}){let r={allDay:e},{maintainDuration:s}=t;s==null&&(s=this._context.options.allDayMaintainDuration),this._def.allDay!==e&&(r.hasEnd=s),this.mutate({standardProps:r})}formatRange(e){let{dateEnv:t}=this._context,r=this._instance,s=rt(e);return this._def.hasEnd?t.formatRange(r.range.start,r.range.end,s,{forcedStartTzo:r.forcedStartTzo,forcedEndTzo:r.forcedEndTzo}):t.format(r.range.start,s,{forcedTzo:r.forcedStartTzo})}mutate(e){let t=this._instance;if(t){let r=this._def,s=this._context,{eventStore:i}=s.getCurrentData(),a=cu(i,t.instanceId);a=du(a,{"":{display:"",startEditable:!0,durationEditable:!0,constraints:[],overlap:null,allows:[],backgroundColor:"",borderColor:"",textColor:"",classNames:[]}},e,s);let l=new n(s,r,t);this._def=a.defs[r.defId],this._instance=a.instances[t.instanceId],s.dispatch({type:"MERGE_EVENTS",eventStore:a}),s.emitter.trigger("eventChange",{oldEvent:l,event:this,relatedEvents:Gn(a,s,t),revert(){s.dispatch({type:"RESET_EVENTS",eventStore:i})}})}}remove(){let e=this._context,t=UI(this);e.dispatch({type:"REMOVE_EVENTS",eventStore:t}),e.emitter.trigger("eventRemove",{event:this,relatedEvents:[],revert(){e.dispatch({type:"MERGE_EVENTS",eventStore:t})}})}get source(){let{sourceId:e}=this._def;return e?new ha(this._context,this._context.getCurrentData().eventSources[e]):null}get start(){return this._instance?this._context.dateEnv.toDate(this._instance.range.start):null}get end(){return this._instance&&this._def.hasEnd?this._context.dateEnv.toDate(this._instance.range.end):null}get startStr(){let e=this._instance;return e?this._context.dateEnv.formatIso(e.range.start,{omitTime:this._def.allDay,forcedTzo:e.forcedStartTzo}):""}get endStr(){let e=this._instance;return e&&this._def.hasEnd?this._context.dateEnv.formatIso(e.range.end,{omitTime:this._def.allDay,forcedTzo:e.forcedEndTzo}):""}get id(){return this._def.publicId}get groupId(){return this._def.groupId}get allDay(){return this._def.allDay}get title(){return this._def.title}get url(){return this._def.url}get display(){return this._def.ui.display||"auto"}get startEditable(){return this._def.ui.startEditable}get durationEditable(){return this._def.ui.durationEditable}get constraint(){return this._def.ui.constraints[0]||null}get overlap(){return this._def.ui.overlap}get allow(){return this._def.ui.allows[0]||null}get backgroundColor(){return this._def.ui.backgroundColor}get borderColor(){return this._def.ui.borderColor}get textColor(){return this._def.ui.textColor}get classNames(){return this._def.ui.classNames}get extendedProps(){return this._def.extendedProps}toPlainObject(e={}){let t=this._def,{ui:r}=t,{startStr:s,endStr:i}=this,a={allDay:t.allDay};return t.title&&(a.title=t.title),s&&(a.start=s),i&&(a.end=i),t.publicId&&(a.id=t.publicId),t.groupId&&(a.groupId=t.groupId),t.url&&(a.url=t.url),r.display&&r.display!=="auto"&&(a.display=r.display),e.collapseColor&&r.backgroundColor&&r.backgroundColor===r.borderColor?a.color=r.backgroundColor:(r.backgroundColor&&(a.backgroundColor=r.backgroundColor),r.borderColor&&(a.borderColor=r.borderColor)),r.textColor&&(a.textColor=r.textColor),r.classNames.length&&(a.classNames=r.classNames),Object.keys(t.extendedProps).length&&(e.collapseExtendedProps?Object.assign(a,t.extendedProps):a.extendedProps=t.extendedProps),a}toJSON(){return this.toPlainObject()}};function UI(n){let e=n._def,t=n._instance;return{defs:{[e.defId]:e},instances:t?{[t.instanceId]:t}:{}}}function Gn(n,e,t){let{defs:r,instances:s}=n,i=[],a=t?t.instanceId:"";for(let o in s){let l=s[o],c=r[l.defId];l.instanceId!==a&&i.push(new dt(e,c,l))}return i}function Rm(n,e,t,r){let s={},i={},a={},o=[],l=[],c=Nm(n.defs,e);for(let d in n.defs){let u=n.defs[d];c[u.defId].display==="inverse-background"&&(u.groupId?(s[u.groupId]=[],a[u.groupId]||(a[u.groupId]=u)):i[d]=[])}for(let d in n.instances){let u=n.instances[d],h=n.defs[u.defId],f=c[h.defId],p=u.range,m=!h.allDay&&r?Ow(p,r):p,g=ys(m,t);g&&(f.display==="inverse-background"?h.groupId?s[h.groupId].push(g):i[u.defId].push(g):f.display!=="none"&&(f.display==="background"?o:l).push({def:h,ui:f,instance:u,range:g,isStart:m.start&&m.start.valueOf()===g.start.valueOf(),isEnd:m.end&&m.end.valueOf()===g.end.valueOf()}))}for(let d in s){let u=s[d],h=cI(u,t);for(let f of h){let p=a[d],m=c[p.defId];o.push({def:p,ui:m,instance:null,range:f,isStart:!1,isEnd:!1})}}for(let d in i){let u=i[d],h=cI(u,t);for(let f of h)o.push({def:n.defs[d],ui:c[d],instance:null,range:f,isStart:!1,isEnd:!1})}return{bg:o,fg:l}}function jw(n){return n.ui.display==="background"||n.ui.display==="inverse-background"}function uI(n,e){n.fcSeg=e}function Ai(n){return n.fcSeg||n.parentNode.fcSeg||null}function Nm(n,e){return Us(n,t=>WI(t,e))}function WI(n,e){let t=[];return e[""]&&t.push(e[""]),e[n.defId]&&t.push(e[n.defId]),t.push(n.ui),Fw(t)}function uu(n,e){let t=n.map(Vj);return t.sort((r,s)=>kI(r,s,e)),t.map(r=>r._seg)}function Vj(n){let{eventRange:e}=n,t=e.def,r=e.instance?e.instance.range:e.range,s=r.start?r.start.valueOf():0,i=r.end?r.end.valueOf():0;return Object.assign(Object.assign(Object.assign({},t.extendedProps),t),{id:t.publicId,start:s,end:i,duration:i-s,allDay:Number(t.allDay),_seg:n})}function Yj(n,e){let{pluginHooks:t}=e,r=t.isDraggableTransformers,{def:s,ui:i}=n.eventRange,a=i.startEditable;for(let o of r)a=o(a,s,i,e);return a}function zj(n,e){return n.isStart&&n.eventRange.ui.durationEditable&&e.options.eventResizableFromStart}function qj(n,e){return n.isEnd&&n.eventRange.ui.durationEditable}function Km(n,e,t,r,s,i,a){let{dateEnv:o,options:l}=t,{displayEventTime:c,displayEventEnd:d}=l,u=n.eventRange.def,h=n.eventRange.instance;c==null&&(c=r!==!1),d==null&&(d=s!==!1);let f=h.range.start,p=h.range.end,m=i||n.start||n.eventRange.range.start,g=a||n.end||n.eventRange.range.end,y=at(f).valueOf()===at(m).valueOf(),T=at(jn(p,-1)).valueOf()===at(jn(g,-1)).valueOf();return c&&!u.allDay&&(y||T)?(m=y?f:m,g=T?p:g,d&&u.hasEnd?o.formatRange(m,g,e,{forcedStartTzo:i?null:h.forcedStartTzo,forcedEndTzo:a?null:h.forcedEndTzo}):o.format(m,e,{forcedTzo:i?null:h.forcedStartTzo})):""}function Tn(n,e,t){let r=n.eventRange.range;return{isPast:r.end<=(t||e.start),isFuture:r.start>=(t||e.end),isToday:e&&Hs(e,r.start)}}function Gj(n){let e=["fc-event"];return n.isMirror&&e.push("fc-event-mirror"),n.isDraggable&&e.push("fc-event-draggable"),(n.isStartResizable||n.isEndResizable)&&e.push("fc-event-resizable"),n.isDragging&&e.push("fc-event-dragging"),n.isResizing&&e.push("fc-event-resizing"),n.isSelected&&e.push("fc-event-selected"),n.isStart&&e.push("fc-event-start"),n.isEnd&&e.push("fc-event-end"),n.isPast&&e.push("fc-event-past"),n.isToday&&e.push("fc-event-today"),n.isFuture&&e.push("fc-event-future"),e}function hu(n){return n.instance?n.instance.instanceId:`${n.def.defId}:${n.range.start.toISOString()}`}function Zm(n,e){let{def:t,instance:r}=n.eventRange,{url:s}=t;if(s)return{href:s};let{emitter:i,options:a}=e,{eventInteractive:o}=a;return o==null&&(o=t.interactive,o==null&&(o=!!i.hasHandlers("eventClick"))),o?wI(l=>{i.trigger("eventClick",{el:l.target,event:new dt(e,t,r),jsEvent:l,view:e.viewApi})}):{}}var Qj={start:L,end:L,allDay:Boolean};function Kj(n,e,t){let r=Zj(n,e),{range:s}=r;if(!s.start)return null;if(!s.end){if(t==null)return null;s.end=e.add(s.start,t)}return r}function Zj(n,e){let{refined:t,extra:r}=ou(n,Qj),s=t.start?e.createMarkerMeta(t.start):null,i=t.end?e.createMarkerMeta(t.end):null,{allDay:a}=t;return a==null&&(a=s&&s.isTimeUnspecified&&(!i||i.isTimeUnspecified)),Object.assign({range:{start:s?s.marker:null,end:i?i.marker:null},allDay:a},r)}function Vw(n,e){return RI(n.range,e.range)&&n.allDay===e.allDay&&Jj(n,e)}function Jj(n,e){for(let t in e)if(t!=="range"&&t!=="allDay"&&n[t]!==e[t])return!1;for(let t in n)if(!(t in e))return!1;return!0}function Xj(n,e){return Object.assign(Object.assign({},$I(n.range,e,n.allDay)),{allDay:n.allDay})}function Yw(n,e,t){return Object.assign(Object.assign({},$I(n,e,t)),{timeZone:e.timeZone})}function $I(n,e,t){return{start:e.toDate(n.start),end:e.toDate(n.end),startStr:e.formatIso(n.start,{omitTime:t}),endStr:e.formatIso(n.end,{omitTime:t})}}function e2(n,e,t){let r=lu({editable:!1},t),s=Kl(r.refined,r.extra,"",n.allDay,!0,t);return{def:s,ui:WI(s,e),instance:sc(s.defId,n.range),range:n.range,isStart:!0,isEnd:!0}}function zw(n,e,t){let r=!1,s=function(o){r||(r=!0,e(o))},i=function(o){r||(r=!0,t(o))},a=n(s,i);a&&typeof a.then=="function"&&a.then(s,i)}var Om=class extends Error{constructor(e,t){super(e),this.response=t}};function qw(n,e,t){n=n.toUpperCase();let r={method:n};return n==="GET"?e+=(e.indexOf("?")===-1?"?":"&")+new URLSearchParams(t):(r.body=new URLSearchParams(t),r.headers={"Content-Type":"application/x-www-form-urlencoded"}),fetch(e,r).then(s=>{if(s.ok)return s.json().then(i=>[i,s],()=>{throw new Om("Failure parsing JSON",s)});throw new Om("Request failed",s)})}var JT;function Gw(){return JT==null&&(JT=t2()),JT}function t2(){if(typeof document=="undefined")return!0;let n=document.createElement("div");n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.innerHTML="<table><tr><td><div></div></td></tr></table>",n.querySelector("table").style.height="100px",n.querySelector("div").style.height="100%",document.body.appendChild(n);let t=n.querySelector("div").offsetHeight>0;return document.body.removeChild(n),t}var Gd=class extends He{constructor(){super(...arguments),this.state={forPrint:!1},this.handleBeforePrint=()=>{Vd(()=>{this.setState({forPrint:!0})})},this.handleAfterPrint=()=>{Vd(()=>{this.setState({forPrint:!1})})}}render(){let{props:e}=this,{options:t}=e,{forPrint:r}=this.state,s=r||t.height==="auto"||t.contentHeight==="auto",i=!s&&t.height!=null?t.height:"",a=["fc",r?"fc-media-print":"fc-media-screen",`fc-direction-${t.direction}`,e.theme.getClass("root")];return Gw()||a.push("fc-liquid-hack"),e.children(a,i,s,r)}componentDidMount(){let{emitter:e}=this.props;e.on("_beforeprint",this.handleBeforePrint),e.on("_afterprint",this.handleAfterPrint)}componentWillUnmount(){let{emitter:e}=this.props;e.off("_beforeprint",this.handleBeforePrint),e.off("_afterprint",this.handleAfterPrint)}},yn=class{constructor(e){this.component=e.component,this.isHitComboAllowed=e.isHitComboAllowed||null}destroy(){}};function jI(n,e){return{component:n,el:e.el,useEventCenter:e.useEventCenter!=null?e.useEventCenter:!0,isHitComboAllowed:e.isHitComboAllowed||null}}function fu(n){return{[n.component.uid]:n}}var Mo={},Ws=class extends vr{constructor(e,t){super(e,t),this.handleRefresh=()=>{let r=this.computeTiming();r.state.nowDate.valueOf()!==this.state.nowDate.valueOf()&&this.setState(r.state),this.clearTimeout(),this.setTimeout(r.waitMs)},this.handleVisibilityChange=()=>{document.hidden||this.handleRefresh()},this.state=this.computeTiming().state}render(){let{props:e,state:t}=this;return e.children(t.nowDate,t.todayRange)}componentDidMount(){this.setTimeout(),this.context.nowManager.addResetListener(this.handleRefresh),document.addEventListener("visibilitychange",this.handleVisibilityChange)}componentDidUpdate(e){e.unit!==this.props.unit&&(this.clearTimeout(),this.setTimeout())}componentWillUnmount(){this.clearTimeout(),this.context.nowManager.removeResetListener(this.handleRefresh),document.removeEventListener("visibilitychange",this.handleVisibilityChange)}computeTiming(){let{props:e,context:t}=this,r=t.nowManager.getDateMarker(),{nowIndicatorSnap:s}=t.options;s==="auto"&&(s=/year|month|week|day/.test(e.unit)||(e.unitValue||1)===1);let i,a;return s?(i=t.dateEnv.startOf(r,e.unit),a=t.dateEnv.add(i,Ee(1,e.unit)).valueOf()-r.valueOf()):(i=r,a=1e3*60),a=Math.min(1e3*60*60*24,a),{state:{nowDate:i,todayRange:r2(i)},waitMs:a}}setTimeout(e=this.computeTiming().waitMs){this.timeoutId=setTimeout(()=>{let t=this.computeTiming();this.setState(t.state,()=>{this.setTimeout(t.waitMs)})},e)}clearTimeout(){this.timeoutId&&clearTimeout(this.timeoutId)}};Ws.contextType=$s;function r2(n){let e=at(n),t=Ft(e,1);return{start:e,end:t}}var Qd=class{getCurrentData(){return this.currentDataManager.getCurrentData()}dispatch(e){this.currentDataManager.dispatch(e)}get view(){return this.getCurrentData().viewApi}batchRendering(e){e()}updateSize(){this.trigger("_resize",!0)}setOption(e,t){this.dispatch({type:"SET_OPTION",optionName:e,rawOptionValue:t})}getOption(e){return this.currentDataManager.currentCalendarOptionsInput[e]}getAvailableLocaleCodes(){return Object.keys(this.getCurrentData().availableRawLocales)}on(e,t){let{currentDataManager:r}=this;r.currentCalendarOptionsRefiners[e]?r.emitter.on(e,t):console.warn(`Unknown listener name '${e}'`)}off(e,t){this.currentDataManager.emitter.off(e,t)}trigger(e,...t){this.currentDataManager.emitter.trigger(e,...t)}changeView(e,t){this.batchRendering(()=>{if(this.unselect(),t)if(t.start&&t.end)this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e}),this.dispatch({type:"SET_OPTION",optionName:"visibleRange",rawOptionValue:t});else{let{dateEnv:r}=this.getCurrentData();this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e,dateMarker:r.createMarker(t)})}else this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:e})})}zoomTo(e,t){let r=this.getCurrentData(),s;t=t||"day",s=r.viewSpecs[t]||this.getUnitViewSpec(t),this.unselect(),s?this.dispatch({type:"CHANGE_VIEW_TYPE",viewType:s.type,dateMarker:e}):this.dispatch({type:"CHANGE_DATE",dateMarker:e})}getUnitViewSpec(e){let{viewSpecs:t,toolbarConfig:r}=this.getCurrentData(),s=[].concat(r.header?r.header.viewsWithButtons:[],r.footer?r.footer.viewsWithButtons:[]),i,a;for(let o in t)s.push(o);for(i=0;i<s.length;i+=1)if(a=t[s[i]],a&&a.singleUnit===e)return a;return null}prev(){this.unselect(),this.dispatch({type:"PREV"})}next(){this.unselect(),this.dispatch({type:"NEXT"})}prevYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,-1)})}nextYear(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.dateEnv.addYears(e.currentDate,1)})}today(){let e=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:e.nowManager.getDateMarker()})}gotoDate(e){let t=this.getCurrentData();this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.createMarker(e)})}incrementDate(e){let t=this.getCurrentData(),r=Ee(e);r&&(this.unselect(),this.dispatch({type:"CHANGE_DATE",dateMarker:t.dateEnv.add(t.currentDate,r)}))}getDate(){let e=this.getCurrentData();return e.dateEnv.toDate(e.currentDate)}formatDate(e,t){let{dateEnv:r}=this.getCurrentData();return r.format(r.createMarker(e),rt(t))}formatRange(e,t,r){let{dateEnv:s}=this.getCurrentData();return s.formatRange(s.createMarker(e),s.createMarker(t),rt(r),r)}formatIso(e,t){let{dateEnv:r}=this.getCurrentData();return r.formatIso(r.createMarker(e),{omitTime:t})}select(e,t){let r;t==null?e.start!=null?r=e:r={start:e,end:null}:r={start:e,end:t};let s=this.getCurrentData(),i=Kj(r,s.dateEnv,Ee({days:1}));i&&(this.dispatch({type:"SELECT_DATES",selection:i}),Qm(i,null,s))}unselect(e){let t=this.getCurrentData();t.dateSelection&&(this.dispatch({type:"UNSELECT_DATES"}),Wj(e,t))}addEvent(e,t){if(e instanceof dt){let a=e._def,o=e._instance;return this.getCurrentData().eventStore.defs[a.defId]||(this.dispatch({type:"ADD_EVENTS",eventStore:vo({def:a,instance:o})}),this.triggerEventAdd(e)),e}let r=this.getCurrentData(),s;if(t instanceof ha)s=t.internalEventSource;else if(typeof t=="boolean")t&&([s]=Ym(r.eventSources));else if(t!=null){let a=this.getEventSourceById(t);if(!a)return console.warn(`Could not find an event source with ID "${t}"`),null;s=a.internalEventSource}let i=LI(e,s,r,!1);if(i){let a=new dt(r,i.def,i.def.recurringDef?null:i.instance);return this.dispatch({type:"ADD_EVENTS",eventStore:vo(i)}),this.triggerEventAdd(a),a}return null}triggerEventAdd(e){let{emitter:t}=this.getCurrentData();t.trigger("eventAdd",{event:e,relatedEvents:[],revert:()=>{this.dispatch({type:"REMOVE_EVENTS",eventStore:UI(e)})}})}getEventById(e){let t=this.getCurrentData(),{defs:r,instances:s}=t.eventStore;e=String(e);for(let i in r){let a=r[i];if(a.publicId===e){if(a.recurringDef)return new dt(t,a,null);for(let o in s){let l=s[o];if(l.defId===a.defId)return new dt(t,a,l)}}}return null}getEvents(){let e=this.getCurrentData();return Gn(e.eventStore,e)}removeAllEvents(){this.dispatch({type:"REMOVE_ALL_EVENTS"})}getEventSources(){let e=this.getCurrentData(),t=e.eventSources,r=[];for(let s in t)r.push(new ha(e,t[s]));return r}getEventSourceById(e){let t=this.getCurrentData(),r=t.eventSources;e=String(e);for(let s in r)if(r[s].publicId===e)return new ha(t,r[s]);return null}addEventSource(e){let t=this.getCurrentData();if(e instanceof ha)return t.eventSources[e.internalEventSource.sourceId]||this.dispatch({type:"ADD_EVENT_SOURCES",sources:[e.internalEventSource]}),e;let r=Bw(e,t);return r?(this.dispatch({type:"ADD_EVENT_SOURCES",sources:[r]}),new ha(t,r)):null}removeAllEventSources(){this.dispatch({type:"REMOVE_ALL_EVENT_SOURCES"})}refetchEvents(){this.dispatch({type:"FETCH_EVENT_SOURCES",isRefetch:!0})}scrollToTime(e){let t=Ee(e);t&&this.trigger("_scrollRequest",{time:t})}};function Qw(n,e){return n.left>=e.left&&n.left<e.right&&n.top>=e.top&&n.top<e.bottom}function Jm(n,e){let t={left:Math.max(n.left,e.left),right:Math.min(n.right,e.right),top:Math.max(n.top,e.top),bottom:Math.min(n.bottom,e.bottom)};return t.left<t.right&&t.top<t.bottom?t:!1}function Kw(n,e){return{left:Math.min(Math.max(n.left,e.left),e.right),top:Math.min(Math.max(n.top,e.top),e.bottom)}}function Zw(n){return{left:(n.left+n.right)/2,top:(n.top+n.bottom)/2}}function Jw(n,e){return{left:n.left-e.left,top:n.top-e.top}}var XT=Jt(),Kd=class{constructor(){this.getKeysForEventDefs=de(this._getKeysForEventDefs),this.splitDateSelection=de(this._splitDateSpan),this.splitEventStore=de(this._splitEventStore),this.splitIndividualUi=de(this._splitIndividualUi),this.splitEventDrag=de(this._splitInteraction),this.splitEventResize=de(this._splitInteraction),this.eventUiBuilders={}}splitProps(e){let t=this.getKeyInfo(e),r=this.getKeysForEventDefs(e.eventStore),s=this.splitDateSelection(e.dateSelection),i=this.splitIndividualUi(e.eventUiBases,r),a=this.splitEventStore(e.eventStore,r),o=this.splitEventDrag(e.eventDrag),l=this.splitEventResize(e.eventResize),c={};this.eventUiBuilders=Us(t,(d,u)=>this.eventUiBuilders[u]||de(s2));for(let d in t){let u=t[d],h=a[d]||XT,f=this.eventUiBuilders[d];c[d]={businessHours:u.businessHours||e.businessHours,dateSelection:s[d]||null,eventStore:h,eventUiBases:f(e.eventUiBases[""],u.ui,i[d]),eventSelection:h.instances[e.eventSelection]?e.eventSelection:"",eventDrag:o[d]||null,eventResize:l[d]||null}}return c}_splitDateSpan(e){let t={};if(e){let r=this.getKeysForDateSpan(e);for(let s of r)t[s]=e}return t}_getKeysForEventDefs(e){return Us(e.defs,t=>this.getKeysForEventDef(t))}_splitEventStore(e,t){let{defs:r,instances:s}=e,i={};for(let a in r)for(let o of t[a])i[o]||(i[o]=Jt()),i[o].defs[a]=r[a];for(let a in s){let o=s[a];for(let l of t[o.defId])i[l]&&(i[l].instances[a]=o)}return i}_splitIndividualUi(e,t){let r={};for(let s in e)if(s)for(let i of t[s])r[i]||(r[i]={}),r[i][s]=e[s];return r}_splitInteraction(e){let t={};if(e){let r=this._splitEventStore(e.affectedEvents,this._getKeysForEventDefs(e.affectedEvents)),s=this._getKeysForEventDefs(e.mutatedEvents),i=this._splitEventStore(e.mutatedEvents,s),a=o=>{t[o]||(t[o]={affectedEvents:r[o]||XT,mutatedEvents:i[o]||XT,isEvent:e.isEvent})};for(let o in r)a(o);for(let o in i)a(o)}return t}};function s2(n,e,t){let r=[];n&&r.push(n),e&&r.push(e);let s={"":Fw(r)};return t&&Object.assign(s,t),s}function Xw(n,e,t,r){return{dow:n.getUTCDay(),isDisabled:!!(r&&(!r.activeRange||!Hs(r.activeRange,n))),isOther:!!(r&&!Hs(r.currentRange,n)),isToday:!!(e&&Hs(e,n)),isPast:!!(t?n<t:e&&n<e.start),isFuture:!!(t?n>t:e&&n>=e.end)}}function Xm(n,e){let t=["fc-day",`fc-day-${B$[n.dow]}`];return n.isDisabled?t.push("fc-day-disabled"):(n.isToday&&(t.push("fc-day-today"),t.push(e.getClass("today"))),n.isPast&&t.push("fc-day-past"),n.isFuture&&t.push("fc-day-future"),n.isOther&&t.push("fc-day-other")),t}var n2=rt({year:"numeric",month:"long",day:"numeric"}),i2=rt({week:"long"});function _o(n,e,t="day",r=!0){let{dateEnv:s,options:i,calendarApi:a}=n,o=s.format(e,t==="week"?i2:n2);if(i.navLinks){let l=s.toDate(e),c=d=>{let u=t==="day"?i.navLinkDayClick:t==="week"?i.navLinkWeekClick:null;typeof u=="function"?u.call(a,s.toDate(e),d):(typeof u=="string"&&(t=u),a.zoomTo(e,t))};return Object.assign({title:Xl(i.navLinkHint,[o,l],o),"data-navlink":""},r?TI(c):{onClick:c})}return{"aria-label":o}}var ew=null;function VI(){return ew===null&&(ew=a2()),ew}function a2(){let n=document.createElement("div");xo(n,{position:"absolute",top:-1e3,left:0,border:0,padding:0,overflow:"scroll",direction:"rtl"}),n.innerHTML="<div></div>",document.body.appendChild(n);let t=n.firstChild.getBoundingClientRect().left>n.getBoundingClientRect().left;return ru(n),t}var tw;function YI(){return tw||(tw=o2()),tw}function o2(){let n=document.createElement("div");n.style.overflow="scroll",n.style.position="absolute",n.style.top="-9999px",n.style.left="-9999px",document.body.appendChild(n);let e=zI(n);return document.body.removeChild(n),e}function zI(n){return{x:n.offsetHeight-n.clientHeight,y:n.offsetWidth-n.clientWidth}}function qI(n,e=!1){let t=window.getComputedStyle(n),r=parseInt(t.borderLeftWidth,10)||0,s=parseInt(t.borderRightWidth,10)||0,i=parseInt(t.borderTopWidth,10)||0,a=parseInt(t.borderBottomWidth,10)||0,o=zI(n),l=o.y-r-s,c=o.x-i-a,d={borderLeft:r,borderRight:s,borderTop:i,borderBottom:a,scrollbarBottom:c,scrollbarLeft:0,scrollbarRight:0};return VI()&&t.direction==="rtl"?d.scrollbarLeft=l:d.scrollbarRight=l,e&&(d.paddingLeft=parseInt(t.paddingLeft,10)||0,d.paddingRight=parseInt(t.paddingRight,10)||0,d.paddingTop=parseInt(t.paddingTop,10)||0,d.paddingBottom=parseInt(t.paddingBottom,10)||0),d}function eb(n,e=!1,t){let r=t?n.getBoundingClientRect():pu(n),s=qI(n,e),i={left:r.left+s.borderLeft+s.scrollbarLeft,right:r.right-s.borderRight-s.scrollbarRight,top:r.top+s.borderTop,bottom:r.bottom-s.borderBottom-s.scrollbarBottom};return e&&(i.left+=s.paddingLeft,i.right-=s.paddingRight,i.top+=s.paddingTop,i.bottom-=s.paddingBottom),i}function pu(n){let e=n.getBoundingClientRect();return{left:e.left+window.scrollX,top:e.top+window.scrollY,right:e.right+window.scrollX,bottom:e.bottom+window.scrollY}}function l2(n){let e=eg(n),t=n.getBoundingClientRect();for(let r of e){let s=Jm(t,r.getBoundingClientRect());if(s)t=s;else return null}return t}function eg(n){let e=[];for(;n instanceof HTMLElement;){let t=window.getComputedStyle(n);if(t.position==="fixed")break;/(auto|scroll)/.test(t.overflow+t.overflowY+t.overflowX)&&e.push(n),n=n.parentNode}return e}var vn=class{constructor(e,t,r,s){this.els=t;let i=this.originClientRect=e.getBoundingClientRect();r&&this.buildElHorizontals(i.left),s&&this.buildElVerticals(i.top)}buildElHorizontals(e){let t=[],r=[];for(let s of this.els){let i=s.getBoundingClientRect();t.push(i.left-e),r.push(i.right-e)}this.lefts=t,this.rights=r}buildElVerticals(e){let t=[],r=[];for(let s of this.els){let i=s.getBoundingClientRect();t.push(i.top-e),r.push(i.bottom-e)}this.tops=t,this.bottoms=r}leftToIndex(e){let{lefts:t,rights:r}=this,s=t.length,i;for(i=0;i<s;i+=1)if(e>=t[i]&&e<r[i])return i}topToIndex(e){let{tops:t,bottoms:r}=this,s=t.length,i;for(i=0;i<s;i+=1)if(e>=t[i]&&e<r[i])return i}getWidth(e){return this.rights[e]-this.lefts[e]}getHeight(e){return this.bottoms[e]-this.tops[e]}similarTo(e){return Em(this.tops||[],e.tops||[])&&Em(this.bottoms||[],e.bottoms||[])&&Em(this.lefts||[],e.lefts||[])&&Em(this.rights||[],e.rights||[])}};function Em(n,e){let t=n.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(Math.round(n[r])!==Math.round(e[r]))return!1;return!0}var To=class{getMaxScrollTop(){return this.getScrollHeight()-this.getClientHeight()}getMaxScrollLeft(){return this.getScrollWidth()-this.getClientWidth()}canScrollVertically(){return this.getMaxScrollTop()>0}canScrollHorizontally(){return this.getMaxScrollLeft()>0}canScrollUp(){return this.getScrollTop()>0}canScrollDown(){return this.getScrollTop()<this.getMaxScrollTop()}canScrollLeft(){return this.getScrollLeft()>0}canScrollRight(){return this.getScrollLeft()<this.getMaxScrollLeft()}},Zd=class extends To{constructor(e){super(),this.el=e}getScrollTop(){return this.el.scrollTop}getScrollLeft(){return this.el.scrollLeft}setScrollTop(e){this.el.scrollTop=e}setScrollLeft(e){this.el.scrollLeft=e}getScrollWidth(){return this.el.scrollWidth}getScrollHeight(){return this.el.scrollHeight}getClientHeight(){return this.el.clientHeight}getClientWidth(){return this.el.clientWidth}},Jd=class extends To{getScrollTop(){return window.scrollY}getScrollLeft(){return window.scrollX}setScrollTop(e){window.scroll(window.scrollX,e)}setScrollLeft(e){window.scroll(e,window.scrollY)}getScrollWidth(){return document.documentElement.scrollWidth}getScrollHeight(){return document.documentElement.scrollHeight}getClientHeight(){return document.documentElement.clientHeight}getClientWidth(){return document.documentElement.clientWidth}},nr=class extends He{constructor(){super(...arguments),this.uid=Mi()}prepareHits(){}queryHit(e,t,r,s){return null}isValidSegDownEl(e){return!this.props.eventDrag&&!this.props.eventResize&&!Zt(e,".fc-event-mirror")}isValidDateDownEl(e){return!Zt(e,".fc-event:not(.fc-bg-event)")&&!Zt(e,".fc-more-link")&&!Zt(e,"a[data-navlink]")&&!Zt(e,".fc-popover")}};var wo=class{constructor(e=t=>t.thickness||1){this.getEntryThickness=e,this.strictOrder=!1,this.allowReslicing=!1,this.maxCoord=-1,this.maxStackCnt=-1,this.levelCoords=[],this.entriesByLevel=[],this.stackCnts={}}addSegs(e){let t=[];for(let r of e)this.insertEntry(r,t);return t}insertEntry(e,t){let r=this.findInsertion(e);this.isInsertionValid(r,e)?this.insertEntryAt(e,r):this.handleInvalidInsertion(r,e,t)}isInsertionValid(e,t){return(this.maxCoord===-1||e.levelCoord+this.getEntryThickness(t)<=this.maxCoord)&&(this.maxStackCnt===-1||e.stackCnt<this.maxStackCnt)}handleInvalidInsertion(e,t,r){if(this.allowReslicing&&e.touchingEntry){let s=Object.assign(Object.assign({},t),{span:mu(t.span,e.touchingEntry.span)});r.push(s),this.splitEntry(t,e.touchingEntry,r)}else r.push(t)}splitEntry(e,t,r){let s=e.span,i=t.span;s.start<i.start&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:s.start,end:i.start}},r),s.end>i.end&&this.insertEntry({index:e.index,thickness:e.thickness,span:{start:i.end,end:s.end}},r)}insertEntryAt(e,t){let{entriesByLevel:r,levelCoords:s}=this;t.lateral===-1?(rw(s,t.level,t.levelCoord),rw(r,t.level,[e])):rw(r[t.level],t.lateral,e),this.stackCnts[Yn(e)]=t.stackCnt}findInsertion(e){let{levelCoords:t,entriesByLevel:r,strictOrder:s,stackCnts:i}=this,a=t.length,o=0,l=-1,c=-1,d=null,u=0;for(let p=0;p<a;p+=1){let m=t[p];if(!s&&m>=o+this.getEntryThickness(e))break;let g=r[p],y,T=eu(g,e.span.start,Xd),w=T[0]+T[1];for(;(y=g[w])&&y.span.start<e.span.end;){let b=m+this.getEntryThickness(y);b>o&&(o=b,d=y,l=p,c=w),b===o&&(u=Math.max(u,i[Yn(y)]+1)),w+=1}}let h=0;if(d)for(h=l+1;h<a&&t[h]<o;)h+=1;let f=-1;return h<a&&t[h]===o&&(f=eu(r[h],e.span.end,Xd)[0]),{touchingLevel:l,touchingLateral:c,touchingEntry:d,stackCnt:u,levelCoord:o,level:h,lateral:f}}toRects(){let{entriesByLevel:e,levelCoords:t}=this,r=e.length,s=[];for(let i=0;i<r;i+=1){let a=e[i],o=t[i];for(let l of a)s.push(Object.assign(Object.assign({},l),{thickness:this.getEntryThickness(l),levelCoord:o}))}return s}};function Xd(n){return n.span.end}function Yn(n){return n.index+":"+n.span.start}function tb(n){let e=[];for(let t of n){let r=[],s={span:t.span,entries:[t]};for(let i of e)mu(i.span,s.span)?s={entries:i.entries.concat(s.entries),span:c2(i.span,s.span)}:r.push(i);r.push(s),e=r}return e}function c2(n,e){return{start:Math.min(n.start,e.start),end:Math.max(n.end,e.end)}}function mu(n,e){let t=Math.max(n.start,e.start),r=Math.min(n.end,e.end);return t<r?{start:t,end:r}:null}function rw(n,e,t){n.splice(e,0,t)}function eu(n,e,t){let r=0,s=n.length;if(!s||e<t(n[r]))return[0,0];if(e>t(n[s-1]))return[s,0];for(;r<s;){let i=Math.floor(r+(s-r)/2),a=t(n[i]);if(e<a)s=i;else if(e>a)r=i+1;else return[i,1]}return[r,0]}var tu=class{constructor(e,t){this.emitter=new Di}destroy(){}setMirrorIsVisible(e){}setMirrorNeedsRevert(e){}setAutoScrollEnabled(e){}},ic={},d2={startTime:Ee,duration:Ee,create:Boolean,sourceId:String};function gu(n){let{refined:e,extra:t}=ou(n,d2);return{startTime:e.startTime||null,duration:e.duration||null,create:e.create!=null?e.create:!0,sourceId:e.sourceId,leftoverProps:t}}function GI(n,e){return!n||e>10?rt({weekday:"short"}):e>1?rt({weekday:"short",month:"numeric",day:"numeric",omitCommas:!0}):rt({weekday:"long"})}var QI="fc-col-header-cell";function KI(n){return n.text}var Lm=class extends He{render(){let{dateEnv:e,options:t,theme:r,viewApi:s}=this.context,{props:i}=this,{date:a,dateProfile:o}=i,l=Xw(a,i.todayRange,null,o),c=[QI].concat(Xm(l,r)),d=e.format(a,i.dayHeaderFormat),u=!l.isDisabled&&i.colCnt>1?_o(this.context,a):{},h=e.toDate(a);e.namedTimeZoneImpl&&(h=jn(h,36e5));let f=Object.assign(Object.assign(Object.assign({date:h,view:s},i.extraRenderProps),{text:d}),l);return E(sr,{elTag:"th",elClasses:c,elAttrs:Object.assign({role:"columnheader",colSpan:i.colSpan,"data-date":l.isDisabled?void 0:au(a)},i.extraDataAttrs),renderProps:f,generatorName:"dayHeaderContent",customGenerator:t.dayHeaderContent,defaultGenerator:KI,classNameGenerator:t.dayHeaderClassNames,didMount:t.dayHeaderDidMount,willUnmount:t.dayHeaderWillUnmount},p=>E("div",{className:"fc-scrollgrid-sync-inner"},!l.isDisabled&&E(p,{elTag:"a",elAttrs:u,elClasses:["fc-col-header-cell-cushion",i.isSticky&&"fc-sticky"]})))}},u2=rt({weekday:"long"}),Fm=class extends He{render(){let{props:e}=this,{dateEnv:t,theme:r,viewApi:s,options:i}=this.context,a=Ft(new Date(2592e5),e.dow),o={dow:e.dow,isDisabled:!1,isFuture:!1,isPast:!1,isToday:!1,isOther:!1},l=t.format(a,e.dayHeaderFormat),c=Object.assign(Object.assign(Object.assign(Object.assign({date:a},o),{view:s}),e.extraRenderProps),{text:l});return E(sr,{elTag:"th",elClasses:[QI,...Xm(o,r),...e.extraClassNames||[]],elAttrs:Object.assign({role:"columnheader",colSpan:e.colSpan},e.extraDataAttrs),renderProps:c,generatorName:"dayHeaderContent",customGenerator:i.dayHeaderContent,defaultGenerator:KI,classNameGenerator:i.dayHeaderClassNames,didMount:i.dayHeaderDidMount,willUnmount:i.dayHeaderWillUnmount},d=>E("div",{className:"fc-scrollgrid-sync-inner"},E(d,{elTag:"a",elClasses:["fc-col-header-cell-cushion",e.isSticky&&"fc-sticky"],elAttrs:{"aria-label":t.format(a,u2)}})))}},Ci=class extends He{constructor(){super(...arguments),this.createDayHeaderFormatter=de(h2)}render(){let{context:e}=this,{dates:t,dateProfile:r,datesRepDistinctDays:s,renderIntro:i}=this.props,a=this.createDayHeaderFormatter(e.options.dayHeaderFormat,s,t.length);return E(Ws,{unit:"day"},(o,l)=>E("tr",{role:"row"},i&&i("day"),t.map(c=>s?E(Lm,{key:c.toISOString(),date:c,dateProfile:r,todayRange:l,colCnt:t.length,dayHeaderFormat:a}):E(Fm,{key:c.getUTCDay(),dow:c.getUTCDay(),dayHeaderFormat:a}))))}};function h2(n,e,t){return n||GI(e,t)}var bo=class{constructor(e,t){let r=e.start,{end:s}=e,i=[],a=[],o=-1;for(;r<s;)t.isHiddenDay(r)?i.push(o+.5):(o+=1,i.push(o),a.push(r)),r=Ft(r,1);this.dates=a,this.indices=i,this.cnt=a.length}sliceRange(e){let t=this.getDateDayIndex(e.start),r=this.getDateDayIndex(Ft(e.end,-1)),s=Math.max(0,t),i=Math.min(this.cnt-1,r);return s=Math.ceil(s),i=Math.floor(i),s<=i?{firstIndex:s,lastIndex:i,isStart:t===s,isEnd:r===i}:null}getDateDayIndex(e){let{indices:t}=this,r=Math.floor(_i(this.dates[0],e));return r<0?t[0]-1:r>=t.length?t[t.length-1]+1:t[r]}},ko=class{constructor(e,t){let{dates:r}=e,s,i,a;if(t){for(i=r[0].getUTCDay(),s=1;s<r.length&&r[s].getUTCDay()!==i;s+=1);a=Math.ceil(r.length/s)}else a=1,s=r.length;this.rowCnt=a,this.colCnt=s,this.daySeries=e,this.cells=this.buildCells(),this.headerDates=this.buildHeaderDates()}buildCells(){let e=[];for(let t=0;t<this.rowCnt;t+=1){let r=[];for(let s=0;s<this.colCnt;s+=1)r.push(this.buildCell(t,s));e.push(r)}return e}buildCell(e,t){let r=this.daySeries.dates[e*this.colCnt+t];return{key:r.toISOString(),date:r}}buildHeaderDates(){let e=[];for(let t=0;t<this.colCnt;t+=1)e.push(this.cells[0][t].date);return e}sliceRange(e){let{colCnt:t}=this,r=this.daySeries.sliceRange(e),s=[];if(r){let{firstIndex:i,lastIndex:a}=r,o=i;for(;o<=a;){let l=Math.floor(o/t),c=Math.min((l+1)*t,a+1);s.push({row:l,firstCol:o%t,lastCol:(c-1)%t,isStart:r.isStart&&o===i,isEnd:r.isEnd&&c-1===a}),o=c}}return s}},Eo=class{constructor(){this.sliceBusinessHours=de(this._sliceBusinessHours),this.sliceDateSelection=de(this._sliceDateSpan),this.sliceEventStore=de(this._sliceEventStore),this.sliceEventDrag=de(this._sliceInteraction),this.sliceEventResize=de(this._sliceInteraction),this.forceDayIfListItem=!1}sliceProps(e,t,r,s,...i){let{eventUiBases:a}=e,o=this.sliceEventStore(e.eventStore,a,t,r,...i);return{dateSelectionSegs:this.sliceDateSelection(e.dateSelection,t,r,a,s,...i),businessHourSegs:this.sliceBusinessHours(e.businessHours,t,r,s,...i),fgEventSegs:o.fg,bgEventSegs:o.bg,eventDrag:this.sliceEventDrag(e.eventDrag,a,t,r,...i),eventResize:this.sliceEventResize(e.eventResize,a,t,r,...i),eventSelection:e.eventSelection}}sliceNowDate(e,t,r,s,...i){return this._sliceDateSpan({range:{start:e,end:jn(e,1)},allDay:!1},t,r,{},s,...i)}_sliceBusinessHours(e,t,r,s,...i){return e?this._sliceEventStore(yo(e,Sm(t,!!r),s),{},t,r,...i).bg:[]}_sliceEventStore(e,t,r,s,...i){if(e){let a=Rm(e,t,Sm(r,!!s),s);return{bg:this.sliceEventRanges(a.bg,i),fg:this.sliceEventRanges(a.fg,i)}}return{bg:[],fg:[]}}_sliceInteraction(e,t,r,s,...i){if(!e)return null;let a=Rm(e.mutatedEvents,t,Sm(r,!!s),s);return{segs:this.sliceEventRanges(a.fg,i),affectedInstances:e.affectedEvents.instances,isEvent:e.isEvent}}_sliceDateSpan(e,t,r,s,i,...a){if(!e)return[];let o=Sm(t,!!r),l=ys(e.range,o);if(l){e=Object.assign(Object.assign({},e),{range:l});let c=e2(e,s,i),d=this.sliceRange(e.range,...a);for(let u of d)u.eventRange=c;return d}return[]}sliceEventRanges(e,t){let r=[];for(let s of e)r.push(...this.sliceEventRange(s,t));return r}sliceEventRange(e,t){let r=e.range;this.forceDayIfListItem&&e.ui.display==="list-item"&&(r={start:r.start,end:Ft(r.start,1)});let s=this.sliceRange(r,...t);for(let i of s)i.eventRange=e,i.isStart=e.isStart&&i.isStart,i.isEnd=e.isEnd&&i.isEnd;return s}};function Sm(n,e){let t=n.activeRange;return e?t:{start:jn(t.start,n.slotMinTime.milliseconds),end:jn(t.end,n.slotMaxTime.milliseconds-864e5)}}function yu(n,e,t){let{instances:r}=n.mutatedEvents;for(let s in r)if(!rc(e.validRange,r[s].range))return!1;return ZI({eventDrag:n},t)}function rb(n,e,t){return rc(e.validRange,n.range)?ZI({dateSelection:n},t):!1}function ZI(n,e){let t=e.getCurrentData(),r=Object.assign({businessHours:t.businessHours,dateSelection:"",eventStore:t.eventStore,eventUiBases:t.eventUiBases,eventSelection:"",eventDrag:null,eventResize:null},n);return(e.pluginHooks.isPropsValid||JI)(r,e)}function JI(n,e,t={},r){return!(n.eventDrag&&!f2(n,e,t,r)||n.dateSelection&&!p2(n,e,t,r))}function f2(n,e,t,r){let s=e.getCurrentData(),i=n.eventDrag,a=i.mutatedEvents,o=a.defs,l=a.instances,c=Nm(o,i.isEvent?n.eventUiBases:{"":s.selectionConfig});r&&(c=Us(c,r));let d=Oj(n.eventStore,i.affectedEvents.instances),u=d.defs,h=d.instances,f=Nm(u,n.eventUiBases);for(let p in l){let m=l[p],g=m.range,y=c[m.defId],T=o[m.defId];if(!XI(y.constraints,g,d,n.businessHours,e))return!1;let{eventOverlap:w}=e.options,b=typeof w=="function"?w:null;for(let k in h){let D=h[k];if(zm(g,D.range)&&(f[D.defId].overlap===!1&&i.isEvent||y.overlap===!1||b&&!b(new dt(e,u[D.defId],D),new dt(e,T,m))))return!1}let S=s.eventStore;for(let k of y.allows){let D=Object.assign(Object.assign({},t),{range:m.range,allDay:T.allDay}),M=S.defs[T.defId],_=S.instances[p],W;if(M?W=new dt(e,M,_):W=new dt(e,T),!k($w(D,e),W))return!1}}return!0}function p2(n,e,t,r){let s=n.eventStore,i=s.defs,a=s.instances,o=n.dateSelection,l=o.range,{selectionConfig:c}=e.getCurrentData();if(r&&(c=r(c)),!XI(c.constraints,l,s,n.businessHours,e))return!1;let{selectOverlap:d}=e.options,u=typeof d=="function"?d:null;for(let h in a){let f=a[h];if(zm(l,f.range)&&(c.overlap===!1||u&&!u(new dt(e,i[f.defId],f),null)))return!1}for(let h of c.allows){let f=Object.assign(Object.assign({},t),o);if(!h($w(f,e),null))return!1}return!0}function XI(n,e,t,r,s){for(let i of n)if(!g2(m2(i,e,t,r,s),e))return!1;return!0}function m2(n,e,t,r,s){return n==="businessHours"?sw(yo(r,e,s)):typeof n=="string"?sw(Gm(t,i=>i.groupId===n)):typeof n=="object"&&n?sw(yo(n,e,s)):[]}function sw(n){let{instances:e}=n,t=[];for(let r in e)t.push(e[r].range);return t}function g2(n,e){for(let t of n)if(rc(t,e))return!0;return!1}var Dm=/^(visible|hidden)$/,Bm=class extends He{constructor(){super(...arguments),this.handleEl=e=>{this.el=e,vs(this.props.elRef,e)}}render(){let{props:e}=this,{liquid:t,liquidIsAbsolute:r}=e,s=t&&r,i=["fc-scroller"];return t&&(r?i.push("fc-scroller-liquid-absolute"):i.push("fc-scroller-liquid")),E("div",{ref:this.handleEl,className:i.join(" "),style:{overflowX:e.overflowX,overflowY:e.overflowY,left:s&&-(e.overcomeLeft||0)||"",right:s&&-(e.overcomeRight||0)||"",bottom:s&&-(e.overcomeBottom||0)||"",marginLeft:!s&&-(e.overcomeLeft||0)||"",marginRight:!s&&-(e.overcomeRight||0)||"",marginBottom:!s&&-(e.overcomeBottom||0)||"",maxHeight:e.maxHeight||""}},e.children)}needsXScrolling(){if(Dm.test(this.props.overflowX))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().width-this.getYScrollbarWidth(),{children:r}=e;for(let s=0;s<r.length;s+=1)if(r[s].getBoundingClientRect().width>t)return!0;return!1}needsYScrolling(){if(Dm.test(this.props.overflowY))return!1;let{el:e}=this,t=this.el.getBoundingClientRect().height-this.getXScrollbarWidth(),{children:r}=e;for(let s=0;s<r.length;s+=1)if(r[s].getBoundingClientRect().height>t)return!0;return!1}getXScrollbarWidth(){return Dm.test(this.props.overflowX)?0:this.el.offsetHeight-this.el.clientHeight}getYScrollbarWidth(){return Dm.test(this.props.overflowY)?0:this.el.offsetWidth-this.el.clientWidth}},Jr=class{constructor(e){this.masterCallback=e,this.currentMap={},this.depths={},this.callbackMap={},this.handleValue=(t,r)=>{let{depths:s,currentMap:i}=this,a=!1,o=!1;t!==null?(a=r in i,i[r]=t,s[r]=(s[r]||0)+1,o=!0):(s[r]-=1,s[r]||(delete i[r],delete this.callbackMap[r],a=!0)),this.masterCallback&&(a&&this.masterCallback(null,String(r)),o&&this.masterCallback(t,String(r)))}}createRef(e){let t=this.callbackMap[e];return t||(t=this.callbackMap[e]=r=>{this.handleValue(r,String(e))}),t}collect(e,t,r){return MI(this.currentMap,e,t,r)}getAll(){return Ym(this.currentMap)}};function eR(n){let e=yI(n,".fc-scrollgrid-shrink"),t=0;for(let r of e)t=Math.max(t,I$(r));return Math.ceil(t)}function sb(n,e){return n.liquid&&e.liquid}function tR(n,e){return e.maxHeight!=null||sb(n,e)}function rR(n,e,t,r){let{expandRows:s}=t;return typeof e.content=="function"?e.content(t):E("table",{role:"presentation",className:[e.tableClassName,n.syncRowHeights?"fc-scrollgrid-sync-table":""].join(" "),style:{minWidth:t.tableMinWidth,width:t.clientWidth,height:s?t.clientHeight:""}},t.tableColGroupNode,E(r?"thead":"tbody",{role:"presentation"},typeof e.rowContent=="function"?e.rowContent(t):e.rowContent))}function sR(n,e){return zn(n,e,Mr)}function nR(n,e){let t=[];for(let r of n){let s=r.span||1;for(let i=0;i<s;i+=1)t.push(E("col",{style:{width:r.width==="shrink"?iR(e):r.width||"",minWidth:r.minWidth||""}}))}return E("colgroup",{},...t)}function iR(n){return n==null?4:n}function aR(n){for(let e of n)if(e.width==="shrink")return!0;return!1}function oR(n,e){let t=["fc-scrollgrid",e.theme.getClass("table")];return n&&t.push("fc-scrollgrid-liquid"),t}function lR(n,e){let t=["fc-scrollgrid-section",`fc-scrollgrid-section-${n.type}`,n.className];return e&&n.liquid&&n.maxHeight==null&&t.push("fc-scrollgrid-section-liquid"),n.isSticky&&t.push("fc-scrollgrid-section-sticky"),t}function ac(n){return E("div",{className:"fc-scrollgrid-sticky-shim",style:{width:n.clientWidth,minWidth:n.tableMinWidth}})}function Ao(n){let{stickyHeaderDates:e}=n;return(e==null||e==="auto")&&(e=n.height==="auto"||n.viewHeight==="auto"),e}function vu(n){let{stickyFooterScrollbar:e}=n;return(e==null||e==="auto")&&(e=n.height==="auto"||n.viewHeight==="auto"),e}var ga=class extends He{constructor(){super(...arguments),this.processCols=de(e=>e,sR),this.renderMicroColGroup=de(nR),this.scrollerRefs=new Jr,this.scrollerElRefs=new Jr(this._handleScrollerEl.bind(this)),this.state={shrinkWidth:null,forceYScrollbars:!1,scrollerClientWidths:{},scrollerClientHeights:{}},this.handleSizing=()=>{this.safeSetState(Object.assign({shrinkWidth:this.computeShrinkWidth()},this.computeScrollerDims()))}}render(){let{props:e,state:t,context:r}=this,s=e.sections||[],i=this.processCols(e.cols),a=this.renderMicroColGroup(i,t.shrinkWidth),o=oR(e.liquid,r);e.collapsibleWidth&&o.push("fc-scrollgrid-collapsible");let l=s.length,c=0,d,u=[],h=[],f=[];for(;c<l&&(d=s[c]).type==="header";)u.push(this.renderSection(d,a,!0)),c+=1;for(;c<l&&(d=s[c]).type==="body";)h.push(this.renderSection(d,a,!1)),c+=1;for(;c<l&&(d=s[c]).type==="footer";)f.push(this.renderSection(d,a,!0)),c+=1;let p=!Gw(),m={role:"rowgroup"};return E("table",{role:"grid",className:o.join(" "),style:{height:e.height}},!!(!p&&u.length)&&E("thead",m,...u),!!(!p&&h.length)&&E("tbody",m,...h),!!(!p&&f.length)&&E("tfoot",m,...f),p&&E("tbody",m,...u,...h,...f))}renderSection(e,t,r){return"outerContent"in e?E(Ze,{key:e.key},e.outerContent):E("tr",{key:e.key,role:"presentation",className:lR(e,this.props.liquid).join(" ")},this.renderChunkTd(e,t,e.chunk,r))}renderChunkTd(e,t,r,s){if("outerContent"in r)return r.outerContent;let{props:i}=this,{forceYScrollbars:a,scrollerClientWidths:o,scrollerClientHeights:l}=this.state,c=tR(i,e),d=sb(i,e),u=i.liquid?a?"scroll":c?"auto":"hidden":"visible",h=e.key,f=rR(e,r,{tableColGroupNode:t,tableMinWidth:"",clientWidth:!i.collapsibleWidth&&o[h]!==void 0?o[h]:null,clientHeight:l[h]!==void 0?l[h]:null,expandRows:e.expandRows,syncRowHeights:!1,rowSyncHeights:[],reportRowHeightChange:()=>{}},s);return E(s?"th":"td",{ref:r.elRef,role:"presentation"},E("div",{className:`fc-scroller-harness${d?" fc-scroller-harness-liquid":""}`},E(Bm,{ref:this.scrollerRefs.createRef(h),elRef:this.scrollerElRefs.createRef(h),overflowY:u,overflowX:i.liquid?"hidden":"visible",maxHeight:e.maxHeight,liquid:d,liquidIsAbsolute:!0},f)))}_handleScrollerEl(e,t){let r=y2(this.props.sections,t);r&&vs(r.chunk.scrollerElRef,e)}componentDidMount(){this.handleSizing(),this.context.addResizeHandler(this.handleSizing)}componentDidUpdate(){this.handleSizing()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}computeShrinkWidth(){return aR(this.props.cols)?eR(this.scrollerElRefs.getAll()):0}computeScrollerDims(){let e=YI(),{scrollerRefs:t,scrollerElRefs:r}=this,s=!1,i={},a={};for(let o in t.currentMap){let l=t.currentMap[o];if(l&&l.needsYScrolling()){s=!0;break}}for(let o of this.props.sections){let l=o.key,c=r.currentMap[l];if(c){let d=c.parentNode;i[l]=Math.floor(d.getBoundingClientRect().width-(s?e.y:0)),a[l]=Math.floor(d.getBoundingClientRect().height)}}return{forceYScrollbars:s,scrollerClientWidths:i,scrollerClientHeights:a}}};ga.addStateEquality({scrollerClientWidths:Mr,scrollerClientHeights:Mr});function y2(n,e){for(let t of n)if(t.key===e)return t;return null}var So=class extends He{constructor(){super(...arguments),this.buildPublicEvent=de((e,t,r)=>new dt(e,t,r)),this.handleEl=e=>{this.el=e,vs(this.props.elRef,e),e&&uI(e,this.props.seg)}}render(){let{props:e,context:t}=this,{options:r}=t,{seg:s}=e,{eventRange:i}=s,{ui:a}=i,o={event:this.buildPublicEvent(t,i.def,i.instance),view:t.viewApi,timeText:e.timeText,textColor:a.textColor,backgroundColor:a.backgroundColor,borderColor:a.borderColor,isDraggable:!e.disableDragging&&Yj(s,t),isStartResizable:!e.disableResizing&&zj(s,t),isEndResizable:!e.disableResizing&&qj(s),isMirror:!!(e.isDragging||e.isResizing||e.isDateSelecting),isStart:!!s.isStart,isEnd:!!s.isEnd,isPast:!!e.isPast,isFuture:!!e.isFuture,isToday:!!e.isToday,isSelected:!!e.isSelected,isDragging:!!e.isDragging,isResizing:!!e.isResizing};return E(sr,{elRef:this.handleEl,elTag:e.elTag,elAttrs:e.elAttrs,elClasses:[...Gj(o),...s.eventRange.ui.classNames,...e.elClasses||[]],elStyle:e.elStyle,renderProps:o,generatorName:"eventContent",customGenerator:r.eventContent,defaultGenerator:e.defaultGenerator,classNameGenerator:r.eventClassNames,didMount:r.eventDidMount,willUnmount:r.eventWillUnmount},e.children)}componentDidUpdate(e){this.el&&this.props.seg!==e.seg&&uI(this.el,this.props.seg)}},ya=class extends He{render(){let{props:e,context:t}=this,{options:r}=t,{seg:s}=e,{ui:i}=s.eventRange,a=r.eventTimeFormat||e.defaultTimeFormat,o=Km(s,a,t,e.defaultDisplayEventTime,e.defaultDisplayEventEnd);return E(So,Object.assign({},e,{elTag:"a",elStyle:{borderColor:i.borderColor,backgroundColor:i.backgroundColor},elAttrs:Zm(s,t),defaultGenerator:v2,timeText:o}),(l,c)=>E(Ze,null,E(l,{elTag:"div",elClasses:["fc-event-main"],elStyle:{color:c.textColor}}),!!c.isStartResizable&&E("div",{className:"fc-event-resizer fc-event-resizer-start"}),!!c.isEndResizable&&E("div",{className:"fc-event-resizer fc-event-resizer-end"})))}};ya.addPropsEquality({seg:Mr});function v2(n){return E("div",{className:"fc-event-main-frame"},n.timeText&&E("div",{className:"fc-event-time"},n.timeText),E("div",{className:"fc-event-title-container"},E("div",{className:"fc-event-title fc-sticky"},n.event.title||E(Ze,null,"\xA0"))))}var Tu=n=>E($s.Consumer,null,e=>{let{options:t}=e,r={isAxis:n.isAxis,date:e.dateEnv.toDate(n.date),view:e.viewApi};return E(sr,{elRef:n.elRef,elTag:n.elTag||"div",elAttrs:n.elAttrs,elClasses:n.elClasses,elStyle:n.elStyle,renderProps:r,generatorName:"nowIndicatorContent",customGenerator:t.nowIndicatorContent,classNameGenerator:t.nowIndicatorClassNames,didMount:t.nowIndicatorDidMount,willUnmount:t.nowIndicatorWillUnmount},n.children)}),T2=rt({day:"numeric"}),va=class extends He{constructor(){super(...arguments),this.refineRenderProps=tc(w2)}render(){let{props:e,context:t}=this,{options:r}=t,s=this.refineRenderProps({date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,isMonthStart:e.isMonthStart||!1,showDayNumber:e.showDayNumber,extraRenderProps:e.extraRenderProps,viewApi:t.viewApi,dateEnv:t.dateEnv,monthStartFormat:r.monthStartFormat});return E(sr,{elRef:e.elRef,elTag:e.elTag,elAttrs:Object.assign(Object.assign({},e.elAttrs),s.isDisabled?{}:{"data-date":au(e.date)}),elClasses:[...Xm(s,t.theme),...e.elClasses||[]],elStyle:e.elStyle,renderProps:s,generatorName:"dayCellContent",customGenerator:r.dayCellContent,defaultGenerator:e.defaultGenerator,classNameGenerator:s.isDisabled?void 0:r.dayCellClassNames,didMount:r.dayCellDidMount,willUnmount:r.dayCellWillUnmount},e.children)}};function oc(n){return!!(n.dayCellContent||uw("dayCellContent",n))}function w2(n){let{date:e,dateEnv:t,dateProfile:r,isMonthStart:s}=n,i=Xw(e,n.todayRange,null,r),a=n.showDayNumber?t.format(e,s?n.monthStartFormat:T2):"";return Object.assign(Object.assign(Object.assign({date:t.toDate(e),view:n.viewApi},i),{isMonthStart:s,dayNumberText:a}),n.extraRenderProps)}var Do=class extends He{render(){let{props:e}=this,{seg:t}=e;return E(So,{elTag:"div",elClasses:["fc-bg-event"],elStyle:{backgroundColor:t.eventRange.ui.backgroundColor},defaultGenerator:b2,seg:t,timeText:"",isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:!1,isPast:e.isPast,isFuture:e.isFuture,isToday:e.isToday,disableDragging:!0,disableResizing:!0})}};function b2(n){let{title:e}=n.event;return e&&E("div",{className:"fc-event-title"},n.event.title)}function wu(n){return E("div",{className:`fc-${n}`})}var bu=n=>E($s.Consumer,null,e=>{let{dateEnv:t,options:r}=e,{date:s}=n,i=r.weekNumberFormat||n.defaultFormat,a=t.computeWeekNumber(s),o=t.format(s,i),l={num:a,text:o,date:s};return E(sr,{elRef:n.elRef,elTag:n.elTag,elAttrs:n.elAttrs,elClasses:n.elClasses,elStyle:n.elStyle,renderProps:l,generatorName:"weekNumberContent",customGenerator:r.weekNumberContent,defaultGenerator:k2,classNameGenerator:r.weekNumberClassNames,didMount:r.weekNumberDidMount,willUnmount:r.weekNumberWillUnmount},n.children)});function k2(n){return n.text}var nw=10,fw=class extends He{constructor(){super(...arguments),this.state={titleId:xi()},this.handleRootEl=e=>{this.rootEl=e,this.props.elRef&&vs(this.props.elRef,e)},this.handleDocumentMouseDown=e=>{let t=Um(e);this.rootEl.contains(t)||this.handleCloseClick()},this.handleDocumentKeyDown=e=>{e.key==="Escape"&&this.handleCloseClick()},this.handleCloseClick=()=>{let{onClose:e}=this.props;e&&e()}}render(){let{theme:e,options:t}=this.context,{props:r,state:s}=this,i=["fc-popover",e.getClass("popover")].concat(r.extraClassNames||[]);return XP(E("div",Object.assign({},r.extraAttrs,{id:r.id,className:i.join(" "),"aria-labelledby":s.titleId,ref:this.handleRootEl}),E("div",{className:"fc-popover-header "+e.getClass("popoverHeader")},E("span",{className:"fc-popover-title",id:s.titleId},r.title),E("span",{className:"fc-popover-close "+e.getIconClass("close"),title:t.closeHint,onClick:this.handleCloseClick})),E("div",{className:"fc-popover-body "+e.getClass("popoverContent")},r.children)),r.parentEl)}componentDidMount(){document.addEventListener("mousedown",this.handleDocumentMouseDown),document.addEventListener("keydown",this.handleDocumentKeyDown),this.updateSize()}componentWillUnmount(){document.removeEventListener("mousedown",this.handleDocumentMouseDown),document.removeEventListener("keydown",this.handleDocumentKeyDown)}updateSize(){let{isRtl:e}=this.context,{alignmentEl:t,alignGridTop:r}=this.props,{rootEl:s}=this,i=l2(t);if(i){let a=s.getBoundingClientRect(),o=r?Zt(t,".fc-scrollgrid").getBoundingClientRect().top:i.top,l=e?i.right-a.width:i.left;o=Math.max(o,nw),l=Math.min(l,document.documentElement.clientWidth-nw-a.width),l=Math.max(l,nw);let c=s.offsetParent.getBoundingClientRect();xo(s,{top:o-c.top,left:l-c.left})}}},pw=class extends nr{constructor(){super(...arguments),this.handleRootEl=e=>{this.rootEl=e,e?this.context.registerInteractiveComponent(this,{el:e,useEventCenter:!1}):this.context.unregisterInteractiveComponent(this)}}render(){let{options:e,dateEnv:t}=this.context,{props:r}=this,{startDate:s,todayRange:i,dateProfile:a}=r,o=t.format(s,e.dayPopoverFormat);return E(va,{elRef:this.handleRootEl,date:s,dateProfile:a,todayRange:i},(l,c,d)=>E(fw,{elRef:d.ref,id:r.id,title:o,extraClassNames:["fc-more-popover"].concat(d.className||[]),extraAttrs:d,parentEl:r.parentEl,alignmentEl:r.alignmentEl,alignGridTop:r.alignGridTop,onClose:r.onClose},oc(e)&&E(l,{elTag:"div",elClasses:["fc-more-popover-misc"]}),r.children))}queryHit(e,t,r,s){let{rootEl:i,props:a}=this;return e>=0&&e<r&&t>=0&&t<s?{dateProfile:a.dateProfile,dateSpan:Object.assign({allDay:!a.forceTimed,range:{start:a.startDate,end:a.endDate}},a.extraDateSpan),dayEl:i,rect:{left:0,top:0,right:r,bottom:s},layer:1}:null}},Co=class extends He{constructor(){super(...arguments),this.state={isPopoverOpen:!1,popoverId:xi()},this.handleLinkEl=e=>{this.linkEl=e,this.props.elRef&&vs(this.props.elRef,e)},this.handleClick=e=>{let{props:t,context:r}=this,{moreLinkClick:s}=r.options,i=hI(t).start;function a(o){let{def:l,instance:c,range:d}=o.eventRange;return{event:new dt(r,l,c),start:r.dateEnv.toDate(d.start),end:r.dateEnv.toDate(d.end),isStart:o.isStart,isEnd:o.isEnd}}typeof s=="function"&&(s=s({date:i,allDay:!!t.allDayDate,allSegs:t.allSegs.map(a),hiddenSegs:t.hiddenSegs.map(a),jsEvent:e,view:r.viewApi})),!s||s==="popover"?this.setState({isPopoverOpen:!0}):typeof s=="string"&&r.calendarApi.zoomTo(i,s)},this.handlePopoverClose=()=>{this.setState({isPopoverOpen:!1})}}render(){let{props:e,state:t}=this;return E($s.Consumer,null,r=>{let{viewApi:s,options:i,calendarApi:a}=r,{moreLinkText:o}=i,{moreCnt:l}=e,c=hI(e),d=typeof o=="function"?o.call(a,l):`+${l} ${o}`,u=Xl(i.moreLinkHint,[l],d),h={num:l,shortText:`+${l}`,text:d,view:s};return E(Ze,null,!!e.moreCnt&&E(sr,{elTag:e.elTag||"a",elRef:this.handleLinkEl,elClasses:[...e.elClasses||[],"fc-more-link"],elStyle:e.elStyle,elAttrs:Object.assign(Object.assign(Object.assign({},e.elAttrs),TI(this.handleClick)),{title:u,"aria-expanded":t.isPopoverOpen,"aria-controls":t.isPopoverOpen?t.popoverId:""}),renderProps:h,generatorName:"moreLinkContent",customGenerator:i.moreLinkContent,defaultGenerator:e.defaultGenerator||E2,classNameGenerator:i.moreLinkClassNames,didMount:i.moreLinkDidMount,willUnmount:i.moreLinkWillUnmount},e.children),t.isPopoverOpen&&E(pw,{id:t.popoverId,startDate:c.start,endDate:c.end,dateProfile:e.dateProfile,todayRange:e.todayRange,extraDateSpan:e.extraDateSpan,parentEl:this.parentEl,alignmentEl:e.alignmentElRef?e.alignmentElRef.current:this.linkEl,alignGridTop:e.alignGridTop,forceTimed:e.forceTimed,onClose:this.handlePopoverClose},e.popoverContent()))})}componentDidMount(){this.updateParentEl()}componentDidUpdate(){this.updateParentEl()}updateParentEl(){this.linkEl&&(this.parentEl=Zt(this.linkEl,".fc-view-harness"))}};function E2(n){return n.text}function hI(n){if(n.allDayDate)return{start:n.allDayDate,end:Ft(n.allDayDate,1)};let{hiddenSegs:e}=n;return{start:tg(e),end:D2(e)}}function tg(n){return n.reduce(S2).eventRange.range.start}function S2(n,e){return n.eventRange.range.start<e.eventRange.range.start?n:e}function D2(n){return n.reduce(C2).eventRange.range.end}function C2(n,e){return n.eventRange.range.end>e.eventRange.range.end?n:e}var x2=[],mR={code:"en",week:{dow:0,doy:4},direction:"ltr",buttonText:{prev:"prev",next:"next",prevYear:"prev year",nextYear:"next year",year:"year",today:"today",month:"month",week:"week",day:"day",list:"list"},weekText:"W",weekTextLong:"Week",closeHint:"Close",timeHint:"Time",eventHint:"Event",allDayText:"all-day",moreLinkText:"more",noEventsText:"No events to display"},gR=Object.assign(Object.assign({},mR),{buttonHints:{prev:"Previous $0",next:"Next $0",today(n,e){return e==="day"?"Today":`This ${n}`}},viewHint:"$0 view",navLinkHint:"Go to $0",moreLinkHint(n){return`Show ${n} more event${n===1?"":"s"}`}});function M2(n){let e=n.length>0?n[0].code:"en",t=x2.concat(n),r={en:gR};for(let s of t)r[s.code]=s;return{map:r,defaultCode:e}}function yR(n,e){return typeof n=="object"&&!Array.isArray(n)?vR(n.code,[n.code],n):_2(n,e)}function _2(n,e){let t=[].concat(n||[]),r=A2(t,e)||gR;return vR(n,t,r)}function A2(n,e){for(let t=0;t<n.length;t+=1){let r=n[t].toLocaleLowerCase().split("-");for(let s=r.length;s>0;s-=1){let i=r.slice(0,s).join("-");if(e[i])return e[i]}}return null}function vR(n,e,t){let r=Vm([mR,t],["buttonText"]);delete r.code;let{week:s}=r;return delete r.week,{codeArg:n,codes:e,week:s,simpleNumberFormat:new Intl.NumberFormat(n),options:r}}function Xr(n){return{id:Mi(),name:n.name,premiumReleaseDate:n.premiumReleaseDate?new Date(n.premiumReleaseDate):void 0,deps:n.deps||[],reducers:n.reducers||[],isLoadingFuncs:n.isLoadingFuncs||[],contextInit:[].concat(n.contextInit||[]),eventRefiners:n.eventRefiners||{},eventDefMemberAdders:n.eventDefMemberAdders||[],eventSourceRefiners:n.eventSourceRefiners||{},isDraggableTransformers:n.isDraggableTransformers||[],eventDragMutationMassagers:n.eventDragMutationMassagers||[],eventDefMutationAppliers:n.eventDefMutationAppliers||[],dateSelectionTransformers:n.dateSelectionTransformers||[],datePointTransforms:n.datePointTransforms||[],dateSpanTransforms:n.dateSpanTransforms||[],views:n.views||{},viewPropsTransformers:n.viewPropsTransformers||[],isPropsValid:n.isPropsValid||null,externalDefTransforms:n.externalDefTransforms||[],viewContainerAppends:n.viewContainerAppends||[],eventDropTransformers:n.eventDropTransformers||[],componentInteractions:n.componentInteractions||[],calendarInteractions:n.calendarInteractions||[],themeClasses:n.themeClasses||{},eventSourceDefs:n.eventSourceDefs||[],cmdFormatter:n.cmdFormatter,recurringTypes:n.recurringTypes||[],namedTimeZonedImpl:n.namedTimeZonedImpl,initialView:n.initialView||"",elementDraggingImpl:n.elementDraggingImpl,optionChangeHandlers:n.optionChangeHandlers||{},scrollGridImpl:n.scrollGridImpl||null,listenerRefiners:n.listenerRefiners||{},optionRefiners:n.optionRefiners||{},propSetHandlers:n.propSetHandlers||{}}}function P2(n,e){let t={},r={premiumReleaseDate:void 0,reducers:[],isLoadingFuncs:[],contextInit:[],eventRefiners:{},eventDefMemberAdders:[],eventSourceRefiners:{},isDraggableTransformers:[],eventDragMutationMassagers:[],eventDefMutationAppliers:[],dateSelectionTransformers:[],datePointTransforms:[],dateSpanTransforms:[],views:{},viewPropsTransformers:[],isPropsValid:null,externalDefTransforms:[],viewContainerAppends:[],eventDropTransformers:[],componentInteractions:[],calendarInteractions:[],themeClasses:{},eventSourceDefs:[],cmdFormatter:null,recurringTypes:[],namedTimeZonedImpl:null,initialView:"",elementDraggingImpl:null,optionChangeHandlers:{},scrollGridImpl:null,listenerRefiners:{},optionRefiners:{},propSetHandlers:{}};function s(i){for(let a of i){let o=a.name,l=t[o];l===void 0?(t[o]=a.id,s(a.deps),r=R2(r,a)):l!==a.id&&console.warn(`Duplicate plugin '${o}'`)}}return n&&s(n),s(e),r}function I2(){let n=[],e=[],t;return(r,s)=>((!t||!zn(r,n)||!zn(s,e))&&(t=P2(r,s)),n=r,e=s,t)}function R2(n,e){return{premiumReleaseDate:N2(n.premiumReleaseDate,e.premiumReleaseDate),reducers:n.reducers.concat(e.reducers),isLoadingFuncs:n.isLoadingFuncs.concat(e.isLoadingFuncs),contextInit:n.contextInit.concat(e.contextInit),eventRefiners:Object.assign(Object.assign({},n.eventRefiners),e.eventRefiners),eventDefMemberAdders:n.eventDefMemberAdders.concat(e.eventDefMemberAdders),eventSourceRefiners:Object.assign(Object.assign({},n.eventSourceRefiners),e.eventSourceRefiners),isDraggableTransformers:n.isDraggableTransformers.concat(e.isDraggableTransformers),eventDragMutationMassagers:n.eventDragMutationMassagers.concat(e.eventDragMutationMassagers),eventDefMutationAppliers:n.eventDefMutationAppliers.concat(e.eventDefMutationAppliers),dateSelectionTransformers:n.dateSelectionTransformers.concat(e.dateSelectionTransformers),datePointTransforms:n.datePointTransforms.concat(e.datePointTransforms),dateSpanTransforms:n.dateSpanTransforms.concat(e.dateSpanTransforms),views:Object.assign(Object.assign({},n.views),e.views),viewPropsTransformers:n.viewPropsTransformers.concat(e.viewPropsTransformers),isPropsValid:e.isPropsValid||n.isPropsValid,externalDefTransforms:n.externalDefTransforms.concat(e.externalDefTransforms),viewContainerAppends:n.viewContainerAppends.concat(e.viewContainerAppends),eventDropTransformers:n.eventDropTransformers.concat(e.eventDropTransformers),calendarInteractions:n.calendarInteractions.concat(e.calendarInteractions),componentInteractions:n.componentInteractions.concat(e.componentInteractions),themeClasses:Object.assign(Object.assign({},n.themeClasses),e.themeClasses),eventSourceDefs:n.eventSourceDefs.concat(e.eventSourceDefs),cmdFormatter:e.cmdFormatter||n.cmdFormatter,recurringTypes:n.recurringTypes.concat(e.recurringTypes),namedTimeZonedImpl:e.namedTimeZonedImpl||n.namedTimeZonedImpl,initialView:n.initialView||e.initialView,elementDraggingImpl:n.elementDraggingImpl||e.elementDraggingImpl,optionChangeHandlers:Object.assign(Object.assign({},n.optionChangeHandlers),e.optionChangeHandlers),scrollGridImpl:e.scrollGridImpl||n.scrollGridImpl,listenerRefiners:Object.assign(Object.assign({},n.listenerRefiners),e.listenerRefiners),optionRefiners:Object.assign(Object.assign({},n.optionRefiners),e.optionRefiners),propSetHandlers:Object.assign(Object.assign({},n.propSetHandlers),e.propSetHandlers)}}function N2(n,e){return n===void 0?e:e===void 0?n:new Date(Math.max(n.valueOf(),e.valueOf()))}var Qn=class extends Si{};Qn.prototype.classes={root:"fc-theme-standard",tableCellShaded:"fc-cell-shaded",buttonGroup:"fc-button-group",button:"fc-button fc-button-primary",buttonActive:"fc-button-active"};Qn.prototype.baseIconClass="fc-icon";Qn.prototype.iconClasses={close:"fc-icon-x",prev:"fc-icon-chevron-left",next:"fc-icon-chevron-right",prevYear:"fc-icon-chevrons-left",nextYear:"fc-icon-chevrons-right"};Qn.prototype.rtlIconClasses={prev:"fc-icon-chevron-right",next:"fc-icon-chevron-left",prevYear:"fc-icon-chevrons-right",nextYear:"fc-icon-chevrons-left"};Qn.prototype.iconOverrideOption="buttonIcons";Qn.prototype.iconOverrideCustomButtonOption="icon";Qn.prototype.iconOverridePrefix="fc-icon-";function O2(n,e){let t={},r;for(r in n)ib(r,t,n,e);for(r in e)ib(r,t,n,e);return t}function ib(n,e,t,r){if(e[n])return e[n];let s=L2(n,e,t,r);return s&&(e[n]=s),s}function L2(n,e,t,r){let s=t[n],i=r[n],a=d=>s&&s[d]!==null?s[d]:i&&i[d]!==null?i[d]:null,o=a("component"),l=a("superType"),c=null;if(l){if(l===n)throw new Error("Can't have a custom view type that references itself");c=ib(l,e,t,r)}return!o&&c&&(o=c.component),o?{type:n,component:o,defaults:Object.assign(Object.assign({},c?c.defaults:{}),s?s.rawOptions:{}),overrides:Object.assign(Object.assign({},c?c.overrides:{}),i?i.rawOptions:{})}:null}function cR(n){return Us(n,F2)}function F2(n){let e=typeof n=="function"?{component:n}:n,{component:t}=e;return e.content?t=dR(e):t&&!(t.prototype instanceof He)&&(t=dR(Object.assign(Object.assign({},e),{content:t}))),{superType:e.type,component:t,rawOptions:e}}function dR(n){return e=>E($s.Consumer,null,t=>E(sr,{elTag:"div",elClasses:Nw(t.viewSpec),renderProps:Object.assign(Object.assign({},e),{nextDayThreshold:t.options.nextDayThreshold}),generatorName:void 0,customGenerator:n.content,classNameGenerator:n.classNames,didMount:n.didMount,willUnmount:n.willUnmount}))}function B2(n,e,t,r){let s=cR(n),i=cR(e.views),a=O2(s,i);return Us(a,o=>H2(o,i,e,t,r))}function H2(n,e,t,r,s){let i=n.overrides.duration||n.defaults.duration||r.duration||t.duration,a=null,o="",l="",c={};if(i&&(a=U2(i),a)){let h=$d(a);o=h.unit,h.value===1&&(l=o,c=e[o]?e[o].rawOptions:{})}let d=h=>{let f=h.buttonText||{},p=n.defaults.buttonTextKey;return p!=null&&f[p]!=null?f[p]:f[n.type]!=null?f[n.type]:f[l]!=null?f[l]:null},u=h=>{let f=h.buttonHints||{},p=n.defaults.buttonTextKey;return p!=null&&f[p]!=null?f[p]:f[n.type]!=null?f[n.type]:f[l]!=null?f[l]:null};return{type:n.type,component:n.component,duration:a,durationUnit:o,singleUnit:l,optionDefaults:n.defaults,optionOverrides:Object.assign(Object.assign({},c),n.overrides),buttonTextOverride:d(r)||d(t)||n.overrides.buttonText,buttonTextDefault:d(s)||n.defaults.buttonText||d(qn)||n.type,buttonTitleOverride:u(r)||u(t)||n.overrides.buttonHint,buttonTitleDefault:u(s)||n.defaults.buttonHint||u(qn)}}var uR={};function U2(n){let e=JSON.stringify(n),t=uR[e];return t===void 0&&(t=Ee(n),uR[e]=t),t}function W2(n,e){switch(e.type){case"CHANGE_VIEW_TYPE":n=e.viewType}return n}function $2(n,e){switch(e.type){case"CHANGE_DATE":return e.dateMarker;default:return n}}function j2(n,e,t){let r=n.initialDate;return r!=null?e.createMarker(r):t.getDateMarker()}function V2(n,e){switch(e.type){case"SET_OPTION":return Object.assign(Object.assign({},n),{[e.optionName]:e.rawOptionValue});default:return n}}function Y2(n,e,t,r){let s;switch(e.type){case"CHANGE_VIEW_TYPE":return r.build(e.dateMarker||t);case"CHANGE_DATE":return r.build(e.dateMarker);case"PREV":if(s=r.buildPrev(n,t),s.isValid)return s;break;case"NEXT":if(s=r.buildNext(n,t),s.isValid)return s;break}return n}function z2(n,e,t){let r=e?e.activeRange:null;return wR({},X2(n,t),r,t)}function q2(n,e,t,r){let s=t?t.activeRange:null;switch(e.type){case"ADD_EVENT_SOURCES":return wR(n,e.sources,s,r);case"REMOVE_EVENT_SOURCE":return Q2(n,e.sourceId);case"PREV":case"NEXT":case"CHANGE_DATE":case"CHANGE_VIEW_TYPE":return t?bR(n,s,r):n;case"FETCH_EVENT_SOURCES":return pb(n,e.sourceIds?Pw(e.sourceIds):kR(n,r),s,e.isRefetch||!1,r);case"RECEIVE_EVENTS":case"RECEIVE_EVENT_ERROR":return J2(n,e.sourceId,e.fetchId,e.fetchRange);case"REMOVE_ALL_EVENT_SOURCES":return{};default:return n}}function G2(n,e,t){let r=e?e.activeRange:null;return pb(n,kR(n,t),r,!0,t)}function TR(n){for(let e in n)if(n[e].isFetching)return!0;return!1}function wR(n,e,t,r){let s={};for(let i of e)s[i.sourceId]=i;return t&&(s=bR(s,t,r)),Object.assign(Object.assign({},n),s)}function Q2(n,e){return Ei(n,t=>t.sourceId!==e)}function bR(n,e,t){return pb(n,Ei(n,r=>K2(r,e,t)),e,!1,t)}function K2(n,e,t){return ER(n,t)?!t.options.lazyFetching||!n.fetchRange||n.isFetching||e.start<n.fetchRange.start||e.end>n.fetchRange.end:!n.latestFetchId}function pb(n,e,t,r,s){let i={};for(let a in n){let o=n[a];e[a]?i[a]=Z2(o,t,r,s):i[a]=o}return i}function Z2(n,e,t,r){let{options:s,calendarApi:i}=r,a=r.pluginHooks.eventSourceDefs[n.sourceDefId],o=Mi();return a.fetch({eventSource:n,range:e,isRefetch:t,context:r},l=>{let{rawEvents:c}=l;s.eventSourceSuccess&&(c=s.eventSourceSuccess.call(i,c,l.response)||c),n.success&&(c=n.success.call(i,c,l.response)||c),r.dispatch({type:"RECEIVE_EVENTS",sourceId:n.sourceId,fetchId:o,fetchRange:e,rawEvents:c})},l=>{let c=!1;s.eventSourceFailure&&(s.eventSourceFailure.call(i,l),c=!0),n.failure&&(n.failure(l),c=!0),c||console.warn(l.message,l),r.dispatch({type:"RECEIVE_EVENT_ERROR",sourceId:n.sourceId,fetchId:o,fetchRange:e,error:l})}),Object.assign(Object.assign({},n),{isFetching:!0,latestFetchId:o})}function J2(n,e,t,r){let s=n[e];return s&&t===s.latestFetchId?Object.assign(Object.assign({},n),{[e]:Object.assign(Object.assign({},s),{isFetching:!1,fetchRange:r})}):n}function kR(n,e){return Ei(n,t=>ER(t,e))}function X2(n,e){let t=Hw(e),r=[].concat(n.eventSources||[]),s=[];n.initialEvents&&r.unshift(n.initialEvents),n.events&&r.unshift(n.events);for(let i of r){let a=Bw(i,e,t);a&&s.push(a)}return s}function ER(n,e){return!e.pluginHooks.eventSourceDefs[n.sourceDefId].ignoreRange}function eV(n,e){switch(e.type){case"UNSELECT_DATES":return null;case"SELECT_DATES":return e.selection;default:return n}}function tV(n,e){switch(e.type){case"UNSELECT_EVENT":return"";case"SELECT_EVENT":return e.eventInstanceId;default:return n}}function rV(n,e){let t;switch(e.type){case"UNSET_EVENT_DRAG":return null;case"SET_EVENT_DRAG":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return n}}function sV(n,e){let t;switch(e.type){case"UNSET_EVENT_RESIZE":return null;case"SET_EVENT_RESIZE":return t=e.state,{affectedEvents:t.affectedEvents,mutatedEvents:t.mutatedEvents,isEvent:t.isEvent};default:return n}}function nV(n,e,t,r,s){let i=n.headerToolbar?hR(n.headerToolbar,n,e,t,r,s):null,a=n.footerToolbar?hR(n.footerToolbar,n,e,t,r,s):null;return{header:i,footer:a}}function hR(n,e,t,r,s,i){let a={},o=[],l=!1;for(let c in n){let d=n[c],u=iV(d,e,t,r,s,i);a[c]=u.widgets,o.push(...u.viewsWithButtons),l=l||u.hasTitle}return{sectionWidgets:a,viewsWithButtons:o,hasTitle:l}}function iV(n,e,t,r,s,i){let a=e.direction==="rtl",o=e.customButtons||{},l=t.buttonText||{},c=e.buttonText||{},d=t.buttonHints||{},u=e.buttonHints||{},h=n?n.split(" "):[],f=[],p=!1;return{widgets:h.map(g=>g.split(",").map(y=>{if(y==="title")return p=!0,{buttonName:y};let T,w,b,S,k,D;if(T=o[y])b=M=>{T.click&&T.click.call(M.target,M,M.target)},(S=r.getCustomButtonIconClass(T))||(S=r.getIconClass(y,a))||(k=T.text),D=T.hint||T.text;else if(w=s[y]){f.push(y),b=()=>{i.changeView(y)},(k=w.buttonTextOverride)||(S=r.getIconClass(y,a))||(k=w.buttonTextDefault);let M=w.buttonTextOverride||w.buttonTextDefault;D=Xl(w.buttonTitleOverride||w.buttonTitleDefault||e.viewHint,[M,y],M)}else if(i[y])if(b=()=>{i[y]()},(k=l[y])||(S=r.getIconClass(y,a))||(k=c[y]),y==="prevYear"||y==="nextYear"){let M=y==="prevYear"?"prev":"next";D=Xl(d[M]||u[M],[c.year||"year","year"],c[y])}else D=M=>Xl(d[y]||u[y],[c[M]||M,M],c[y]);return{buttonName:y,buttonClick:b,buttonIcon:S,buttonText:k,buttonHint:D}})),viewsWithButtons:f,hasTitle:p}}var ab=class{constructor(e,t,r){this.type=e,this.getCurrentData=t,this.dateEnv=r}get calendar(){return this.getCurrentData().calendarApi}get title(){return this.getCurrentData().viewTitle}get activeStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.start)}get activeEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.activeRange.end)}get currentStart(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.start)}get currentEnd(){return this.dateEnv.toDate(this.getCurrentData().dateProfile.currentRange.end)}getOption(e){return this.getCurrentData().options[e]}},aV={ignoreRange:!0,parseMeta(n){return Array.isArray(n.events)?n.events:null},fetch(n,e){e({rawEvents:n.eventSource.meta})}},oV=Xr({name:"array-event-source",eventSourceDefs:[aV]}),lV={parseMeta(n){return typeof n.events=="function"?n.events:null},fetch(n,e,t){let{dateEnv:r}=n.context,s=n.eventSource.meta;zw(s.bind(null,Yw(n.range,r)),i=>e({rawEvents:i}),t)}},cV=Xr({name:"func-event-source",eventSourceDefs:[lV]}),dV={method:String,extraParams:L,startParam:String,endParam:String,timeZoneParam:String},uV={parseMeta(n){return n.url&&(n.format==="json"||!n.format)?{url:n.url,format:"json",method:(n.method||"GET").toUpperCase(),extraParams:n.extraParams,startParam:n.startParam,endParam:n.endParam,timeZoneParam:n.timeZoneParam}:null},fetch(n,e,t){let{meta:r}=n.eventSource,s=fV(r,n.range,n.context);qw(r.method,r.url,s).then(([i,a])=>{e({rawEvents:i,response:a})},t)}},hV=Xr({name:"json-event-source",eventSourceRefiners:dV,eventSourceDefs:[uV]});function fV(n,e,t){let{dateEnv:r,options:s}=t,i,a,o,l,c={};return i=n.startParam,i==null&&(i=s.startParam),a=n.endParam,a==null&&(a=s.endParam),o=n.timeZoneParam,o==null&&(o=s.timeZoneParam),typeof n.extraParams=="function"?l=n.extraParams():l=n.extraParams||{},Object.assign(c,l),c[i]=r.formatIso(e.start),c[a]=r.formatIso(e.end),r.timeZone!=="local"&&(c[o]=r.timeZone),c}var pV={daysOfWeek:L,startTime:Ee,endTime:Ee,duration:Ee,startRecur:L,endRecur:L},mV={parse(n,e){if(n.daysOfWeek||n.startTime||n.endTime||n.startRecur||n.endRecur){let t={daysOfWeek:n.daysOfWeek||null,startTime:n.startTime||null,endTime:n.endTime||null,startRecur:n.startRecur?e.createMarker(n.startRecur):null,endRecur:n.endRecur?e.createMarker(n.endRecur):null,dateEnv:e},r;return n.duration&&(r=n.duration),!r&&n.startTime&&n.endTime&&(r=SI(n.endTime,n.startTime)),{allDayGuess:!n.startTime&&!n.endTime,duration:r,typeData:t}}return null},expand(n,e,t){let r=ys(e,{start:n.startRecur,end:n.endRecur});return r?yV(n.daysOfWeek,n.startTime,n.dateEnv,t,r):[]}},gV=Xr({name:"simple-recurring-event",recurringTypes:[mV],eventRefiners:pV});function yV(n,e,t,r,s){let i=n?Pw(n):null,a=at(s.start),o=s.end,l=[];for(e&&(e.milliseconds<0?o=Ft(o,1):e.milliseconds>=1e3*60*60*24&&(a=Ft(a,-1)));a<o;){let c;(!i||i[a.getUTCDay()])&&(e?c=r.add(a,e):c=a,l.push(r.createMarker(t.toDate(c)))),a=Ft(a,1)}return l}var vV=Xr({name:"change-handler",optionChangeHandlers:{events(n,e){fR([n],e)},eventSources:fR}});function fR(n,e){let t=Ym(e.getCurrentData().eventSources);if(t.length===1&&n.length===1&&Array.isArray(t[0]._raw)&&Array.isArray(n[0])){e.dispatch({type:"RESET_RAW_EVENTS",sourceId:t[0].sourceId,rawEvents:n[0]});return}let r=[];for(let s of n){let i=!1;for(let a=0;a<t.length;a+=1)if(t[a]._raw===s){t.splice(a,1),i=!0;break}i||r.push(s)}for(let s of t)e.dispatch({type:"REMOVE_EVENT_SOURCE",sourceId:s.sourceId});for(let s of r)e.calendarApi.addEventSource(s)}function TV(n,e){e.emitter.trigger("datesSet",Object.assign(Object.assign({},Yw(n.activeRange,e.dateEnv)),{view:e.viewApi}))}function wV(n,e){let{emitter:t}=e;t.hasHandlers("eventsSet")&&t.trigger("eventsSet",Gn(n,e))}var bV=[oV,cV,hV,gV,vV,Xr({name:"misc",isLoadingFuncs:[n=>TR(n.eventSources)],propSetHandlers:{dateProfile:TV,eventStore:wV}})],ob=class{constructor(e,t){this.runTaskOption=e,this.drainedOption=t,this.queue=[],this.delayedRunner=new mo(this.drain.bind(this))}request(e,t){this.queue.push(e),this.delayedRunner.request(t)}pause(e){this.delayedRunner.pause(e)}resume(e,t){this.delayedRunner.resume(e,t)}drain(){let{queue:e}=this;for(;e.length;){let t=[],r;for(;r=e.shift();)this.runTask(r),t.push(r);this.drained(t)}}runTask(e){this.runTaskOption&&this.runTaskOption(e)}drained(e){this.drainedOption&&this.drainedOption(e)}};function kV(n,e,t){let r;return/^(year|month)$/.test(n.currentRangeUnit)?r=n.currentRange:r=n.activeRange,t.formatRange(r.start,r.end,rt(e.titleFormat||EV(n)),{isEndExclusive:n.isRangeAllDay,defaultSeparator:e.titleRangeSeparator})}function EV(n){let{currentRangeUnit:e}=n;if(e==="year")return{year:"numeric"};if(e==="month")return{year:"numeric",month:"long"};let t=Ql(n.currentRange.start,n.currentRange.end);return t!==null&&t>1?{year:"numeric",month:"short",day:"numeric"}:{year:"numeric",month:"long",day:"numeric"}}var rg=class{constructor(){this.resetListeners=new Set}handleInput(e,t){let r=this.dateEnv;if(e!==r&&(typeof t=="function"?this.nowFn=t:r||(this.nowAnchorDate=e.toDate(t?e.createMarker(t):e.createNowMarker()),this.nowAnchorQueried=Date.now()),this.dateEnv=e,r))for(let s of this.resetListeners.values())s()}getDateMarker(){return this.nowAnchorDate?this.dateEnv.timestampToMarker(this.nowAnchorDate.valueOf()+(Date.now()-this.nowAnchorQueried)):this.dateEnv.createMarker(this.nowFn())}addResetListener(e){this.resetListeners.add(e)}removeResetListener(e){this.resetListeners.delete(e)}},lb=class{constructor(e){this.computeCurrentViewData=de(this._computeCurrentViewData),this.organizeRawLocales=de(M2),this.buildLocale=de(yR),this.buildPluginHooks=I2(),this.buildDateEnv=de(SV),this.buildTheme=de(DV),this.parseToolbars=de(nV),this.buildViewSpecs=de(B2),this.buildDateProfileGenerator=tc(CV),this.buildViewApi=de(xV),this.buildViewUiProps=tc(AV),this.buildEventUiBySource=de(MV,Mr),this.buildEventUiBases=de(_V),this.parseContextBusinessHours=tc(PV),this.buildTitle=de(kV),this.nowManager=new rg,this.emitter=new Di,this.actionRunner=new ob(this._handleAction.bind(this),this.updateData.bind(this)),this.currentCalendarOptionsInput={},this.currentCalendarOptionsRefined={},this.currentViewOptionsInput={},this.currentViewOptionsRefined={},this.currentCalendarOptionsRefiners={},this.optionsForRefining=[],this.optionsForHandling=[],this.getCurrentData=()=>this.data,this.dispatch=h=>{this.actionRunner.request(h)},this.props=e,this.actionRunner.pause(),this.nowManager=new rg;let t={},r=this.computeOptionsData(e.optionOverrides,t,e.calendarApi),s=r.calendarOptions.initialView||r.pluginHooks.initialView,i=this.computeCurrentViewData(s,r,e.optionOverrides,t);e.calendarApi.currentDataManager=this,this.emitter.setThisContext(e.calendarApi),this.emitter.setOptions(i.options);let a={nowManager:this.nowManager,dateEnv:r.dateEnv,options:r.calendarOptions,pluginHooks:r.pluginHooks,calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},o=j2(r.calendarOptions,r.dateEnv,this.nowManager),l=i.dateProfileGenerator.build(o);Hs(l.activeRange,o)||(o=l.currentRange.start);for(let h of r.pluginHooks.contextInit)h(a);let c=z2(r.calendarOptions,l,a),d={dynamicOptionOverrides:t,currentViewType:s,currentDate:o,dateProfile:l,businessHours:this.parseContextBusinessHours(a),eventSources:c,eventUiBases:{},eventStore:Jt(),renderableEventStore:Jt(),dateSelection:null,eventSelection:"",eventDrag:null,eventResize:null,selectionConfig:this.buildViewUiProps(a).selectionConfig},u=Object.assign(Object.assign({},a),d);for(let h of r.pluginHooks.reducers)Object.assign(d,h(null,null,u));nb(d,a)&&this.emitter.trigger("loading",!0),this.state=d,this.updateData(),this.actionRunner.resume()}resetOptions(e,t){let{props:r}=this;t===void 0?r.optionOverrides=e:(r.optionOverrides=Object.assign(Object.assign({},r.optionOverrides||{}),e),this.optionsForRefining.push(...t)),(t===void 0||t.length)&&this.actionRunner.request({type:"NOTHING"})}_handleAction(e){let{props:t,state:r,emitter:s}=this,i=V2(r.dynamicOptionOverrides,e),a=this.computeOptionsData(t.optionOverrides,i,t.calendarApi),o=W2(r.currentViewType,e),l=this.computeCurrentViewData(o,a,t.optionOverrides,i);t.calendarApi.currentDataManager=this,s.setThisContext(t.calendarApi),s.setOptions(l.options);let c={nowManager:this.nowManager,dateEnv:a.dateEnv,options:a.calendarOptions,pluginHooks:a.pluginHooks,calendarApi:t.calendarApi,dispatch:this.dispatch,emitter:s,getCurrentData:this.getCurrentData},{currentDate:d,dateProfile:u}=r;this.data&&this.data.dateProfileGenerator!==l.dateProfileGenerator&&(u=l.dateProfileGenerator.build(d)),d=$2(d,e),u=Y2(u,e,d,l.dateProfileGenerator),(e.type==="PREV"||e.type==="NEXT"||!Hs(u.currentRange,d))&&(d=u.currentRange.start);let h=q2(r.eventSources,e,u,c),f=FI(r.eventStore,e,h,u,c),m=TR(h)&&!l.options.progressiveEventRendering&&r.renderableEventStore||f,{eventUiSingleBase:g,selectionConfig:y}=this.buildViewUiProps(c),T=this.buildEventUiBySource(h),w=this.buildEventUiBases(m.defs,g,T),b={dynamicOptionOverrides:i,currentViewType:o,currentDate:d,dateProfile:u,eventSources:h,eventStore:f,renderableEventStore:m,selectionConfig:y,eventUiBases:w,businessHours:this.parseContextBusinessHours(c),dateSelection:eV(r.dateSelection,e),eventSelection:tV(r.eventSelection,e),eventDrag:rV(r.eventDrag,e),eventResize:sV(r.eventResize,e)},S=Object.assign(Object.assign({},c),b);for(let M of a.pluginHooks.reducers)Object.assign(b,M(r,e,S));let k=nb(r,c),D=nb(b,c);!k&&D?s.trigger("loading",!0):k&&!D&&s.trigger("loading",!1),this.state=b,t.onAction&&t.onAction(e)}updateData(){let{props:e,state:t}=this,r=this.data,s=this.computeOptionsData(e.optionOverrides,t.dynamicOptionOverrides,e.calendarApi),i=this.computeCurrentViewData(t.currentViewType,s,e.optionOverrides,t.dynamicOptionOverrides),a=this.data=Object.assign(Object.assign(Object.assign({nowManager:this.nowManager,viewTitle:this.buildTitle(t.dateProfile,i.options,s.dateEnv),calendarApi:e.calendarApi,dispatch:this.dispatch,emitter:this.emitter,getCurrentData:this.getCurrentData},s),i),t),o=s.pluginHooks.optionChangeHandlers,l=r&&r.calendarOptions,c=s.calendarOptions;if(l&&l!==c){l.timeZone!==c.timeZone&&(t.eventSources=a.eventSources=G2(a.eventSources,t.dateProfile,a),t.eventStore=a.eventStore=Uw(a.eventStore,r.dateEnv,a.dateEnv),t.renderableEventStore=a.renderableEventStore=Uw(a.renderableEventStore,r.dateEnv,a.dateEnv));for(let d in o)(this.optionsForHandling.indexOf(d)!==-1||l[d]!==c[d])&&o[d](c[d],a)}this.optionsForHandling=[],e.onData&&e.onData(a)}computeOptionsData(e,t,r){if(!this.optionsForRefining.length&&e===this.stableOptionOverrides&&t===this.stableDynamicOptionOverrides)return this.stableCalendarOptionsData;let{refinedOptions:s,pluginHooks:i,localeDefaults:a,availableLocaleData:o,extra:l}=this.processRawCalendarOptions(e,t);pR(l);let c=this.buildDateEnv(s.timeZone,s.locale,s.weekNumberCalculation,s.firstDay,s.weekText,i,o,s.defaultRangeSeparator),d=this.buildViewSpecs(i.views,this.stableOptionOverrides,this.stableDynamicOptionOverrides,a),u=this.buildTheme(s,i),h=this.parseToolbars(s,this.stableOptionOverrides,u,d,r);return this.stableCalendarOptionsData={calendarOptions:s,pluginHooks:i,dateEnv:c,viewSpecs:d,theme:u,toolbarConfig:h,localeDefaults:a,availableRawLocales:o.map}}processRawCalendarOptions(e,t){let{locales:r,locale:s}=jm([qn,e,t]),i=this.organizeRawLocales(r),a=i.map,o=this.buildLocale(s||i.defaultCode,a).options,l=this.buildPluginHooks(e.plugins||[],bV),c=this.currentCalendarOptionsRefiners=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Mw),_w),Aw),l.listenerRefiners),l.optionRefiners),d={},u=jm([qn,o,e,t]),h={},f=this.currentCalendarOptionsInput,p=this.currentCalendarOptionsRefined,m=!1;for(let g in u)this.optionsForRefining.indexOf(g)===-1&&(u[g]===f[g]||wa[g]&&g in f&&wa[g](f[g],u[g]))?h[g]=p[g]:c[g]?(h[g]=c[g](u[g]),m=!0):d[g]=f[g];return m&&(this.currentCalendarOptionsInput=u,this.currentCalendarOptionsRefined=h,this.stableOptionOverrides=e,this.stableDynamicOptionOverrides=t),this.optionsForHandling.push(...this.optionsForRefining),this.optionsForRefining=[],{rawOptions:this.currentCalendarOptionsInput,refinedOptions:this.currentCalendarOptionsRefined,pluginHooks:l,availableLocaleData:i,localeDefaults:o,extra:d}}_computeCurrentViewData(e,t,r,s){let i=t.viewSpecs[e];if(!i)throw new Error(`viewType "${e}" is not available. Please make sure you've loaded all neccessary plugins`);let{refinedOptions:a,extra:o}=this.processRawViewOptions(i,t.pluginHooks,t.localeDefaults,r,s);pR(o),this.nowManager.handleInput(t.dateEnv,a.now);let l=this.buildDateProfileGenerator({dateProfileGeneratorClass:i.optionDefaults.dateProfileGeneratorClass,nowManager:this.nowManager,duration:i.duration,durationUnit:i.durationUnit,usesMinMaxTime:i.optionDefaults.usesMinMaxTime,dateEnv:t.dateEnv,calendarApi:this.props.calendarApi,slotMinTime:a.slotMinTime,slotMaxTime:a.slotMaxTime,showNonCurrentDates:a.showNonCurrentDates,dayCount:a.dayCount,dateAlignment:a.dateAlignment,dateIncrement:a.dateIncrement,hiddenDays:a.hiddenDays,weekends:a.weekends,validRangeInput:a.validRange,visibleRangeInput:a.visibleRange,fixedWeekCount:a.fixedWeekCount}),c=this.buildViewApi(e,this.getCurrentData,t.dateEnv);return{viewSpec:i,options:a,dateProfileGenerator:l,viewApi:c}}processRawViewOptions(e,t,r,s,i){let a=jm([qn,e.optionDefaults,r,s,e.optionOverrides,i]),o=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Mw),_w),Aw),xI),t.listenerRefiners),t.optionRefiners),l={},c=this.currentViewOptionsInput,d=this.currentViewOptionsRefined,u=!1,h={};for(let f in a)a[f]===c[f]||wa[f]&&wa[f](a[f],c[f])?l[f]=d[f]:(a[f]===this.currentCalendarOptionsInput[f]||wa[f]&&wa[f](a[f],this.currentCalendarOptionsInput[f])?f in this.currentCalendarOptionsRefined&&(l[f]=this.currentCalendarOptionsRefined[f]):o[f]?l[f]=o[f](a[f]):h[f]=a[f],u=!0);return u&&(this.currentViewOptionsInput=a,this.currentViewOptionsRefined=l),{rawOptions:this.currentViewOptionsInput,refinedOptions:this.currentViewOptionsRefined,extra:h}}};function SV(n,e,t,r,s,i,a,o){let l=yR(e||a.defaultCode,a.map);return new jd({calendarSystem:"gregory",timeZone:n,namedTimeZoneImpl:i.namedTimeZonedImpl,locale:l,weekNumberCalculation:t,firstDay:r,weekText:s,cmdFormatter:i.cmdFormatter,defaultSeparator:o})}function DV(n,e){let t=e.themeClasses[n.themeSystem]||Qn;return new t(n)}function CV(n){let e=n.dateProfileGeneratorClass||go;return new e(n)}function xV(n,e,t){return new ab(n,e,t)}function MV(n){return Us(n,e=>e.ui)}function _V(n,e,t){let r={"":e};for(let s in n){let i=n[s];i.sourceId&&t[i.sourceId]&&(r[s]=t[i.sourceId])}return r}function AV(n){let{options:e}=n;return{eventUiSingleBase:nc({display:e.eventDisplay,editable:e.editable,startEditable:e.eventStartEditable,durationEditable:e.eventDurationEditable,constraint:e.eventConstraint,overlap:typeof e.eventOverlap=="boolean"?e.eventOverlap:void 0,allow:e.eventAllow,backgroundColor:e.eventBackgroundColor,borderColor:e.eventBorderColor,textColor:e.eventTextColor,color:e.eventColor},n),selectionConfig:nc({constraint:e.selectConstraint,overlap:typeof e.selectOverlap=="boolean"?e.selectOverlap:void 0,allow:e.selectAllow},n)}}function nb(n,e){for(let t of e.pluginHooks.isLoadingFuncs)if(t(n))return!0;return!1}function PV(n){return Ww(n.options.businessHours,n)}function pR(n,e){for(let t in n)console.warn(`Unknown option '${t}'`+(e?` for view '${e}'`:""))}var cb=class extends He{render(){let e=this.props.widgetGroups.map(t=>this.renderWidgetGroup(t));return E("div",{className:"fc-toolbar-chunk"},...e)}renderWidgetGroup(e){let{props:t}=this,{theme:r}=this.context,s=[],i=!0;for(let a of e){let{buttonName:o,buttonClick:l,buttonText:c,buttonIcon:d,buttonHint:u}=a;if(o==="title")i=!1,s.push(E("h2",{className:"fc-toolbar-title",id:t.titleId},t.title));else{let h=o===t.activeButton,f=!t.isTodayEnabled&&o==="today"||!t.isPrevEnabled&&o==="prev"||!t.isNextEnabled&&o==="next",p=[`fc-${o}-button`,r.getClass("button")];h&&p.push(r.getClass("buttonActive")),s.push(E("button",{type:"button",title:typeof u=="function"?u(t.navUnit):u,disabled:f,"aria-pressed":h,className:p.join(" "),onClick:l},c||(d?E("span",{className:d,role:"img"}):"")))}}if(s.length>1){let a=i&&r.getClass("buttonGroup")||"";return E("div",{className:a},...s)}return s[0]}},sg=class extends He{render(){let{model:e,extraClassName:t}=this.props,r=!1,s,i,a=e.sectionWidgets,o=a.center;return a.left?(r=!0,s=a.left):s=a.start,a.right?(r=!0,i=a.right):i=a.end,E("div",{className:[t||"","fc-toolbar",r?"fc-toolbar-ltr":""].join(" ")},this.renderSection("start",s||[]),this.renderSection("center",o||[]),this.renderSection("end",i||[]))}renderSection(e,t){let{props:r}=this;return E(cb,{key:e,widgetGroups:t,title:r.title,navUnit:r.navUnit,activeButton:r.activeButton,isTodayEnabled:r.isTodayEnabled,isPrevEnabled:r.isPrevEnabled,isNextEnabled:r.isNextEnabled,titleId:r.titleId})}},db=class extends He{constructor(){super(...arguments),this.state={availableWidth:null},this.handleEl=e=>{this.el=e,vs(this.props.elRef,e),this.updateAvailableWidth()},this.handleResize=()=>{this.updateAvailableWidth()}}render(){let{props:e,state:t}=this,{aspectRatio:r}=e,s=["fc-view-harness",r||e.liquid||e.height?"fc-view-harness-active":"fc-view-harness-passive"],i="",a="";return r?t.availableWidth!==null?i=t.availableWidth/r:a=`${1/r*100}%`:i=e.height||"",E("div",{"aria-labelledby":e.labeledById,ref:this.handleEl,className:s.join(" "),style:{height:i,paddingBottom:a}},e.children)}componentDidMount(){this.context.addResizeHandler(this.handleResize)}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}updateAvailableWidth(){this.el&&this.props.aspectRatio&&this.setState({availableWidth:this.el.offsetWidth})}},ub=class extends yn{constructor(e){super(e),this.handleSegClick=(t,r)=>{let{component:s}=this,{context:i}=s,a=Ai(r);if(a&&s.isValidSegDownEl(t.target)){let o=Zt(t.target,".fc-event-forced-url"),l=o?o.querySelector("a[href]").href:"";i.emitter.trigger("eventClick",{el:r,event:new dt(s.context,a.eventRange.def,a.eventRange.instance),jsEvent:t,view:i.viewApi}),l&&!t.defaultPrevented&&(window.location.href=l)}},this.destroy=gw(e.el,"click",".fc-event",this.handleSegClick)}},hb=class extends yn{constructor(e){super(e),this.handleEventElRemove=t=>{t===this.currentSegEl&&this.handleSegLeave(null,this.currentSegEl)},this.handleSegEnter=(t,r)=>{Ai(r)&&(this.currentSegEl=r,this.triggerEvent("eventMouseEnter",t,r))},this.handleSegLeave=(t,r)=>{this.currentSegEl&&(this.currentSegEl=null,this.triggerEvent("eventMouseLeave",t,r))},this.removeHoverListeners=vI(e.el,".fc-event",this.handleSegEnter,this.handleSegLeave)}destroy(){this.removeHoverListeners()}triggerEvent(e,t,r){let{component:s}=this,{context:i}=s,a=Ai(r);(!t||s.isValidSegDownEl(t.target))&&i.emitter.trigger(e,{el:r,event:new dt(i,a.eventRange.def,a.eventRange.instance),jsEvent:t,view:i.viewApi})}},fb=class extends Vn{constructor(){super(...arguments),this.buildViewContext=de(II),this.buildViewPropTransformers=de(RV),this.buildToolbarProps=de(IV),this.headerRef=Dt(),this.footerRef=Dt(),this.interactionsStore={},this.state={viewLabelId:xi()},this.registerInteractiveComponent=(e,t)=>{let r=jI(e,t),a=[ub,hb].concat(this.props.pluginHooks.componentInteractions).map(o=>new o(r));this.interactionsStore[e.uid]=a,Mo[e.uid]=r},this.unregisterInteractiveComponent=e=>{let t=this.interactionsStore[e.uid];if(t){for(let r of t)r.destroy();delete this.interactionsStore[e.uid]}delete Mo[e.uid]},this.resizeRunner=new mo(()=>{this.props.emitter.trigger("_resize",!0),this.props.emitter.trigger("windowResize",{view:this.props.viewApi})}),this.handleWindowResize=e=>{let{options:t}=this.props;t.handleWindowResize&&e.target===window&&this.resizeRunner.request(t.windowResizeDelay)}}render(){let{props:e}=this,{toolbarConfig:t,options:r}=e,s=!1,i="",a;e.isHeightAuto||e.forPrint?i="":r.height!=null?s=!0:r.contentHeight!=null?i=r.contentHeight:a=Math.max(r.aspectRatio,.5);let o=this.buildViewContext(e.viewSpec,e.viewApi,e.options,e.dateProfileGenerator,e.dateEnv,e.nowManager,e.theme,e.pluginHooks,e.dispatch,e.getCurrentData,e.emitter,e.calendarApi,this.registerInteractiveComponent,this.unregisterInteractiveComponent),l=t.header&&t.header.hasTitle?this.state.viewLabelId:void 0;return E($s.Provider,{value:o},E(Ws,{unit:"day"},c=>{let d=this.buildToolbarProps(e.viewSpec,e.dateProfile,e.dateProfileGenerator,e.currentDate,c,e.viewTitle);return E(Ze,null,t.header&&E(sg,Object.assign({ref:this.headerRef,extraClassName:"fc-header-toolbar",model:t.header,titleId:l},d)),E(db,{liquid:s,height:i,aspectRatio:a,labeledById:l},this.renderView(e),this.buildAppendContent()),t.footer&&E(sg,Object.assign({ref:this.footerRef,extraClassName:"fc-footer-toolbar",model:t.footer,titleId:""},d)))}))}componentDidMount(){let{props:e}=this;this.calendarInteractions=e.pluginHooks.calendarInteractions.map(r=>new r(e)),window.addEventListener("resize",this.handleWindowResize);let{propSetHandlers:t}=e.pluginHooks;for(let r in t)t[r](e[r],e)}componentDidUpdate(e){let{props:t}=this,{propSetHandlers:r}=t.pluginHooks;for(let s in r)t[s]!==e[s]&&r[s](t[s],t)}componentWillUnmount(){window.removeEventListener("resize",this.handleWindowResize),this.resizeRunner.clear();for(let e of this.calendarInteractions)e.destroy();this.props.emitter.trigger("_unmount")}buildAppendContent(){let{props:e}=this,t=e.pluginHooks.viewContainerAppends.map(r=>r(e));return E(Ze,{},...t)}renderView(e){let{pluginHooks:t}=e,{viewSpec:r}=e,s={dateProfile:e.dateProfile,businessHours:e.businessHours,eventStore:e.renderableEventStore,eventUiBases:e.eventUiBases,dateSelection:e.dateSelection,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,isHeightAuto:e.isHeightAuto,forPrint:e.forPrint},i=this.buildViewPropTransformers(t.viewPropsTransformers);for(let o of i)Object.assign(s,o.transform(s,e));let a=r.component;return E(a,Object.assign({},s))}};function IV(n,e,t,r,s,i){let a=t.build(s,void 0,!1),o=t.buildPrev(e,r,!1),l=t.buildNext(e,r,!1);return{title:i,activeButton:n.type,navUnit:n.singleUnit,isTodayEnabled:a.isValid&&!Hs(e.currentRange,s),isPrevEnabled:o.isValid,isNextEnabled:l.isValid}}function RV(n){return n.map(e=>new e)}var ng=class extends Qd{constructor(e,t={}){super(),this.isRendering=!1,this.isRendered=!1,this.currentClassNames=[],this.customContentRenderId=0,this.handleAction=r=>{switch(r.type){case"SET_EVENT_DRAG":case"SET_EVENT_RESIZE":this.renderRunner.tryDrain()}},this.handleData=r=>{this.currentData=r,this.renderRunner.request(r.calendarOptions.rerenderDelay)},this.handleRenderRequest=()=>{if(this.isRendering){this.isRendered=!0;let{currentData:r}=this;Vd(()=>{ua(E(Gd,{options:r.calendarOptions,theme:r.theme,emitter:r.emitter},(s,i,a,o)=>(this.setClassNames(s),this.setHeight(i),E(Rw.Provider,{value:this.customContentRenderId},E(fb,Object.assign({isHeightAuto:a,forPrint:o},r))))),this.el)})}else this.isRendered&&(this.isRendered=!1,ua(null,this.el),this.setClassNames([]),this.setHeight(""))},pI(e),this.el=e,this.renderRunner=new mo(this.handleRenderRequest),new lb({optionOverrides:t,calendarApi:this,onAction:this.handleAction,onData:this.handleData})}render(){let e=this.isRendering;e?this.customContentRenderId+=1:this.isRendering=!0,this.renderRunner.request(),e&&this.updateSize()}destroy(){this.isRendering&&(this.isRendering=!1,this.renderRunner.request())}updateSize(){Vd(()=>{super.updateSize()})}batchRendering(e){this.renderRunner.pause("batchRendering"),e(),this.renderRunner.resume("batchRendering")}pauseRendering(){this.renderRunner.pause("pauseRendering")}resumeRendering(){this.renderRunner.resume("pauseRendering",!0)}resetOptions(e,t){this.currentDataManager.resetOptions(e,t)}setClassNames(e){if(!zn(e,this.currentClassNames)){let{classList:t}=this.el;for(let r of this.currentClassNames)t.remove(r);for(let r of e)t.add(r);this.currentClassNames=e}}setHeight(e){mw(this.el,"height",e)}};var En=ke(dn());var mb=class extends nr{constructor(){super(...arguments),this.headerElRef=Dt()}renderSimpleLayout(e,t){let{props:r,context:s}=this,i=[],a=Ao(s.options);return e&&i.push({type:"header",key:"header",isSticky:a,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),i.push({type:"body",key:"body",liquid:!0,chunk:{content:t}}),E(gn,{elClasses:["fc-daygrid"],viewSpec:s.viewSpec},E(ga,{liquid:!r.isHeightAuto&&!r.forPrint,collapsibleWidth:r.forPrint,cols:[],sections:i}))}renderHScrollLayout(e,t,r,s){let i=this.context.pluginHooks.scrollGridImpl;if(!i)throw new Error("No ScrollGrid implementation");let{props:a,context:o}=this,l=!a.forPrint&&Ao(o.options),c=!a.forPrint&&vu(o.options),d=[];return e&&d.push({type:"header",key:"header",isSticky:l,chunks:[{key:"main",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),d.push({type:"body",key:"body",liquid:!0,chunks:[{key:"main",content:t}]}),c&&d.push({type:"footer",key:"footer",isSticky:!0,chunks:[{key:"main",content:ac}]}),E(gn,{elClasses:["fc-daygrid"],viewSpec:o.viewSpec},E(i,{liquid:!a.isHeightAuto&&!a.forPrint,forPrint:a.forPrint,collapsibleWidth:a.forPrint,colGroups:[{cols:[{span:r,minWidth:s}]}],sections:d}))}};function ag(n,e){let t=[];for(let r=0;r<e;r+=1)t[r]=[];for(let r of n)t[r.row].push(r);return t}function ig(n,e){let t=[];for(let r=0;r<e;r+=1)t[r]=[];for(let r of n)t[r.firstCol].push(r);return t}function SR(n,e){let t=[];if(n){for(let r=0;r<e;r+=1)t[r]={affectedInstances:n.affectedInstances,isEvent:n.isEvent,segs:[]};for(let r of n.segs)t[r.row].segs.push(r)}else for(let r=0;r<e;r+=1)t[r]=null;return t}var DR=rt({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"narrow"});function CR(n){let{display:e}=n.eventRange.ui;return e==="list-item"||e==="auto"&&!n.eventRange.def.allDay&&n.firstCol===n.lastCol&&n.isStart&&n.isEnd}var og=class extends He{render(){let{props:e}=this;return E(ya,Object.assign({},e,{elClasses:["fc-daygrid-event","fc-daygrid-block-event","fc-h-event"],defaultTimeFormat:DR,defaultDisplayEventEnd:e.defaultDisplayEventEnd,disableResizing:!e.seg.eventRange.def.allDay}))}},lg=class extends He{render(){let{props:e,context:t}=this,{options:r}=t,{seg:s}=e,i=r.eventTimeFormat||DR,a=Km(s,i,t,!0,e.defaultDisplayEventEnd);return E(So,Object.assign({},e,{elTag:"a",elClasses:["fc-daygrid-event","fc-daygrid-dot-event"],elAttrs:Zm(e.seg,t),defaultGenerator:NV,timeText:a,isResizing:!1,isDateSelecting:!1}))}};function NV(n){return E(Ze,null,E("div",{className:"fc-daygrid-event-dot",style:{borderColor:n.borderColor||n.backgroundColor}}),n.timeText&&E("div",{className:"fc-event-time"},n.timeText),E("div",{className:"fc-event-title"},n.event.title||E(Ze,null,"\xA0")))}var gb=class extends He{constructor(){super(...arguments),this.compileSegs=de(OV)}render(){let{props:e}=this,{allSegs:t,invisibleSegs:r}=this.compileSegs(e.singlePlacements);return E(Co,{elClasses:["fc-daygrid-more-link"],dateProfile:e.dateProfile,todayRange:e.todayRange,allDayDate:e.allDayDate,moreCnt:e.moreCnt,allSegs:t,hiddenSegs:r,alignmentElRef:e.alignmentElRef,alignGridTop:e.alignGridTop,extraDateSpan:e.extraDateSpan,popoverContent:()=>{let s=(e.eventDrag?e.eventDrag.affectedInstances:null)||(e.eventResize?e.eventResize.affectedInstances:null)||{};return E(Ze,null,t.map(i=>{let a=i.eventRange.instance.instanceId;return E("div",{className:"fc-daygrid-event-harness",key:a,style:{visibility:s[a]?"hidden":""}},CR(i)?E(lg,Object.assign({seg:i,isDragging:!1,isSelected:a===e.eventSelection,defaultDisplayEventEnd:!1},Tn(i,e.todayRange))):E(og,Object.assign({seg:i,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:a===e.eventSelection,defaultDisplayEventEnd:!1},Tn(i,e.todayRange))))}))}})}};function OV(n){let e=[],t=[];for(let r of n)e.push(r.seg),r.isVisible||t.push(r.seg);return{allSegs:e,invisibleSegs:t}}var LV=rt({week:"narrow"}),yb=class extends nr{constructor(){super(...arguments),this.rootElRef=Dt(),this.state={dayNumberId:xi()},this.handleRootEl=e=>{vs(this.rootElRef,e),vs(this.props.elRef,e)}}render(){let{context:e,props:t,state:r,rootElRef:s}=this,{options:i,dateEnv:a}=e,{date:o,dateProfile:l}=t,c=t.showDayNumber&&BV(o,l.currentRange,a);return E(va,{elTag:"td",elRef:this.handleRootEl,elClasses:["fc-daygrid-day",...t.extraClassNames||[]],elAttrs:Object.assign(Object.assign(Object.assign({},t.extraDataAttrs),t.showDayNumber?{"aria-labelledby":r.dayNumberId}:{}),{role:"gridcell"}),defaultGenerator:FV,date:o,dateProfile:l,todayRange:t.todayRange,showDayNumber:t.showDayNumber,isMonthStart:c,extraRenderProps:t.extraRenderProps},(d,u)=>E("div",{ref:t.innerElRef,className:"fc-daygrid-day-frame fc-scrollgrid-sync-inner",style:{minHeight:t.minHeight}},t.showWeekNumber&&E(bu,{elTag:"a",elClasses:["fc-daygrid-week-number"],elAttrs:_o(e,o,"week"),date:o,defaultFormat:LV}),!u.isDisabled&&(t.showDayNumber||oc(i)||t.forceDayTop)?E("div",{className:"fc-daygrid-day-top"},E(d,{elTag:"a",elClasses:["fc-daygrid-day-number",c&&"fc-daygrid-month-start"],elAttrs:Object.assign(Object.assign({},_o(e,o)),{id:r.dayNumberId})})):t.showDayNumber?E("div",{className:"fc-daygrid-day-top",style:{visibility:"hidden"}},E("a",{className:"fc-daygrid-day-number"},"\xA0")):void 0,E("div",{className:"fc-daygrid-day-events",ref:t.fgContentElRef},t.fgContent,E("div",{className:"fc-daygrid-day-bottom",style:{marginTop:t.moreMarginTop}},E(gb,{allDayDate:o,singlePlacements:t.singlePlacements,moreCnt:t.moreCnt,alignmentElRef:s,alignGridTop:!t.showDayNumber,extraDateSpan:t.extraDateSpan,dateProfile:t.dateProfile,eventSelection:t.eventSelection,eventDrag:t.eventDrag,eventResize:t.eventResize,todayRange:t.todayRange}))),E("div",{className:"fc-daygrid-day-bg"},t.bgContent)))}};function FV(n){return n.dayNumberText||E(Ze,null,"\xA0")}function BV(n,e,t){let{start:r,end:s}=e,i=jn(s,-1),a=t.getYear(r),o=t.getMonth(r),l=t.getYear(i),c=t.getMonth(i);return!(a===l&&o===c)&&(n.valueOf()===r.valueOf()||t.getDay(n)===1&&n.valueOf()<s.valueOf())}function xR(n){return n.eventRange.instance.instanceId+":"+n.firstCol}function MR(n){return xR(n)+":"+n.lastCol}function HV(n,e,t,r,s,i,a){let o=new vb(y=>{let T=n[y.index].eventRange.instance.instanceId+":"+y.span.start+":"+(y.span.end-1);return s[T]||1});o.allowReslicing=!0,o.strictOrder=r,e===!0||t===!0?(o.maxCoord=i,o.hiddenConsumes=!0):typeof e=="number"?o.maxStackCnt=e:typeof t=="number"&&(o.maxStackCnt=t,o.hiddenConsumes=!0);let l=[],c=[];for(let y=0;y<n.length;y+=1){let T=n[y],w=MR(T);s[w]!=null?l.push({index:y,span:{start:T.firstCol,end:T.lastCol+1}}):c.push(T)}let d=o.addSegs(l),u=o.toRects(),{singleColPlacements:h,multiColPlacements:f,leftoverMargins:p}=UV(u,n,a),m=[],g=[];for(let y of c){f[y.firstCol].push({seg:y,isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let T=y.firstCol;T<=y.lastCol;T+=1)h[T].push({seg:lc(y,T,T+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let y=0;y<a.length;y+=1)m.push(0);for(let y of d){let T=n[y.index],w=y.span;f[w.start].push({seg:lc(T,w.start,w.end,a),isVisible:!1,isAbsolute:!0,absoluteTop:0,marginTop:0});for(let b=w.start;b<w.end;b+=1)m[b]+=1,h[b].push({seg:lc(T,b,b+1,a),isVisible:!1,isAbsolute:!1,absoluteTop:0,marginTop:0})}for(let y=0;y<a.length;y+=1)g.push(p[y]);return{singleColPlacements:h,multiColPlacements:f,moreCnts:m,moreMarginTops:g}}function UV(n,e,t){let r=WV(n,t.length),s=[],i=[],a=[];for(let o=0;o<t.length;o+=1){let l=r[o],c=[],d=0,u=0;for(let f of l){let p=e[f.index];c.push({seg:lc(p,o,o+1,t),isVisible:!0,isAbsolute:!1,absoluteTop:f.levelCoord,marginTop:f.levelCoord-d}),d=f.levelCoord+f.thickness}let h=[];d=0,u=0;for(let f of l){let p=e[f.index],m=f.span.end-f.span.start>1,g=f.span.start===o;u+=f.levelCoord-d,d=f.levelCoord+f.thickness,m?(u+=f.thickness,g&&h.push({seg:lc(p,f.span.start,f.span.end,t),isVisible:!0,isAbsolute:!0,absoluteTop:f.levelCoord,marginTop:0})):g&&(h.push({seg:lc(p,f.span.start,f.span.end,t),isVisible:!0,isAbsolute:!1,absoluteTop:f.levelCoord,marginTop:u}),u=0)}s.push(c),i.push(h),a.push(u)}return{singleColPlacements:s,multiColPlacements:i,leftoverMargins:a}}function WV(n,e){let t=[];for(let r=0;r<e;r+=1)t.push([]);for(let r of n)for(let s=r.span.start;s<r.span.end;s+=1)t[s].push(r);return t}function lc(n,e,t,r){if(n.firstCol===e&&n.lastCol===t-1)return n;let s=n.eventRange,i=s.range,a=ys(i,{start:r[e].date,end:Ft(r[t-1].date,1)});return Object.assign(Object.assign({},n),{firstCol:e,lastCol:t-1,eventRange:{def:s.def,ui:Object.assign(Object.assign({},s.ui),{durationEditable:!1}),instance:s.instance,range:a},isStart:n.isStart&&a.start.valueOf()===i.start.valueOf(),isEnd:n.isEnd&&a.end.valueOf()===i.end.valueOf()})}var vb=class extends wo{constructor(){super(...arguments),this.hiddenConsumes=!1,this.forceHidden={}}addSegs(e){let t=super.addSegs(e),{entriesByLevel:r}=this,s=i=>!this.forceHidden[Yn(i)];for(let i=0;i<r.length;i+=1)r[i]=r[i].filter(s);return t}handleInvalidInsertion(e,t,r){let{entriesByLevel:s,forceHidden:i}=this,{touchingEntry:a,touchingLevel:o,touchingLateral:l}=e;if(this.hiddenConsumes&&a){let c=Yn(a);if(!i[c])if(this.allowReslicing){let d=Object.assign(Object.assign({},a),{span:mu(a.span,t.span)}),u=Yn(d);i[u]=!0,s[o][l]=d,r.push(d),this.splitEntry(a,t,r)}else i[c]=!0,r.push(a)}super.handleInvalidInsertion(e,t,r)}},cg=class extends nr{constructor(){super(...arguments),this.cellElRefs=new Jr,this.frameElRefs=new Jr,this.fgElRefs=new Jr,this.segHarnessRefs=new Jr,this.rootElRef=Dt(),this.state={framePositions:null,maxContentHeight:null,segHeights:{}},this.handleResize=e=>{e&&this.updateSizing(!0)}}render(){let{props:e,state:t,context:r}=this,{options:s}=r,i=e.cells.length,a=ig(e.businessHourSegs,i),o=ig(e.bgEventSegs,i),l=ig(this.getHighlightSegs(),i),c=ig(this.getMirrorSegs(),i),{singleColPlacements:d,multiColPlacements:u,moreCnts:h,moreMarginTops:f}=HV(uu(e.fgEventSegs,s.eventOrder),e.dayMaxEvents,e.dayMaxEventRows,s.eventOrderStrict,t.segHeights,t.maxContentHeight,e.cells),p=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{};return E("tr",{ref:this.rootElRef,role:"row"},e.renderIntro&&e.renderIntro(),e.cells.map((m,g)=>{let y=this.renderFgSegs(g,e.forPrint?d[g]:u[g],e.todayRange,p),T=this.renderFgSegs(g,$V(c[g],u),e.todayRange,{},!!e.eventDrag,!!e.eventResize,!1);return E(yb,{key:m.key,elRef:this.cellElRefs.createRef(m.key),innerElRef:this.frameElRefs.createRef(m.key),dateProfile:e.dateProfile,date:m.date,showDayNumber:e.showDayNumbers,showWeekNumber:e.showWeekNumbers&&g===0,forceDayTop:e.showWeekNumbers,todayRange:e.todayRange,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,extraRenderProps:m.extraRenderProps,extraDataAttrs:m.extraDataAttrs,extraClassNames:m.extraClassNames,extraDateSpan:m.extraDateSpan,moreCnt:h[g],moreMarginTop:f[g],singlePlacements:d[g],fgContentElRef:this.fgElRefs.createRef(m.key),fgContent:E(Ze,null,E(Ze,null,y),E(Ze,null,T)),bgContent:E(Ze,null,this.renderFillSegs(l[g],"highlight"),this.renderFillSegs(a[g],"non-business"),this.renderFillSegs(o[g],"bg-event")),minHeight:e.cellMinHeight})}))}componentDidMount(){this.updateSizing(!0),this.context.addResizeHandler(this.handleResize)}componentDidUpdate(e,t){let r=this.props;this.updateSizing(!Mr(e,r))}componentWillUnmount(){this.context.removeResizeHandler(this.handleResize)}getHighlightSegs(){let{props:e}=this;return e.eventDrag&&e.eventDrag.segs.length?e.eventDrag.segs:e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:e.dateSelectionSegs}getMirrorSegs(){let{props:e}=this;return e.eventResize&&e.eventResize.segs.length?e.eventResize.segs:[]}renderFgSegs(e,t,r,s,i,a,o){let{context:l}=this,{eventSelection:c}=this.props,{framePositions:d}=this.state,u=this.props.cells.length===1,h=i||a||o,f=[];if(d)for(let p of t){let{seg:m}=p,{instanceId:g}=m.eventRange.instance,y=p.isVisible&&!s[g],T=p.isAbsolute,w="",b="";T&&(l.isRtl?(b=0,w=d.lefts[m.lastCol]-d.lefts[m.firstCol]):(w=0,b=d.rights[m.firstCol]-d.rights[m.lastCol])),f.push(E("div",{className:"fc-daygrid-event-harness"+(T?" fc-daygrid-event-harness-abs":""),key:xR(m),ref:h?null:this.segHarnessRefs.createRef(MR(m)),style:{visibility:y?"":"hidden",marginTop:T?"":p.marginTop,top:T?p.absoluteTop:"",left:w,right:b}},CR(m)?E(lg,Object.assign({seg:m,isDragging:i,isSelected:g===c,defaultDisplayEventEnd:u},Tn(m,r))):E(og,Object.assign({seg:m,isDragging:i,isResizing:a,isDateSelecting:o,isSelected:g===c,defaultDisplayEventEnd:u},Tn(m,r)))))}return f}renderFillSegs(e,t){let{isRtl:r}=this.context,{todayRange:s}=this.props,{framePositions:i}=this.state,a=[];if(i)for(let o of e){let l=r?{right:0,left:i.lefts[o.lastCol]-i.lefts[o.firstCol]}:{left:0,right:i.rights[o.firstCol]-i.rights[o.lastCol]};a.push(E("div",{key:hu(o.eventRange),className:"fc-daygrid-bg-harness",style:l},t==="bg-event"?E(Do,Object.assign({seg:o},Tn(o,s))):wu(t)))}return E(Ze,{},...a)}updateSizing(e){let{props:t,state:r,frameElRefs:s}=this;if(!t.forPrint&&t.clientWidth!==null){if(e){let l=t.cells.map(c=>s.currentMap[c.key]);if(l.length){let c=this.rootElRef.current,d=new vn(c,l,!0,!1);(!r.framePositions||!r.framePositions.similarTo(d))&&this.setState({framePositions:new vn(c,l,!0,!1)})}}let i=this.state.segHeights,a=this.querySegHeights(),o=t.dayMaxEvents===!0||t.dayMaxEventRows===!0;this.safeSetState({segHeights:Object.assign(Object.assign({},i),a),maxContentHeight:o?this.computeMaxContentHeight():null})}}querySegHeights(){let e=this.segHarnessRefs.currentMap,t={};for(let r in e){let s=Math.round(e[r].getBoundingClientRect().height);t[r]=Math.max(t[r]||0,s)}return t}computeMaxContentHeight(){let e=this.props.cells[0].key,t=this.cellElRefs.currentMap[e],r=this.fgElRefs.currentMap[e];return t.getBoundingClientRect().bottom-r.getBoundingClientRect().top}getCellEls(){let e=this.cellElRefs.currentMap;return this.props.cells.map(t=>e[t.key])}};cg.addStateEquality({segHeights:Mr});function $V(n,e){if(!n.length)return[];let t=jV(e);return n.map(r=>({seg:r,isVisible:!0,isAbsolute:!0,absoluteTop:t[r.eventRange.instance.instanceId],marginTop:0}))}function jV(n){let e={};for(let t of n)for(let r of t)e[r.seg.eventRange.instance.instanceId]=r.absoluteTop;return e}var ku=class extends nr{constructor(){super(...arguments),this.splitBusinessHourSegs=de(ag),this.splitBgEventSegs=de(VV),this.splitFgEventSegs=de(ag),this.splitDateSelectionSegs=de(ag),this.splitEventDrag=de(SR),this.splitEventResize=de(SR),this.rowRefs=new Jr}render(){let{props:e,context:t}=this,r=e.cells.length,s=this.splitBusinessHourSegs(e.businessHourSegs,r),i=this.splitBgEventSegs(e.bgEventSegs,r),a=this.splitFgEventSegs(e.fgEventSegs,r),o=this.splitDateSelectionSegs(e.dateSelectionSegs,r),l=this.splitEventDrag(e.eventDrag,r),c=this.splitEventResize(e.eventResize,r),d=r>=7&&e.clientWidth?e.clientWidth/t.options.aspectRatio/6:null;return E(Ws,{unit:"day"},(u,h)=>E(Ze,null,e.cells.map((f,p)=>E(cg,{ref:this.rowRefs.createRef(p),key:f.length?f[0].date.toISOString():p,showDayNumbers:r>1,showWeekNumbers:e.showWeekNumbers,todayRange:h,dateProfile:e.dateProfile,cells:f,renderIntro:e.renderRowIntro,businessHourSegs:s[p],eventSelection:e.eventSelection,bgEventSegs:i[p],fgEventSegs:a[p],dateSelectionSegs:o[p],eventDrag:l[p],eventResize:c[p],dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,clientWidth:e.clientWidth,clientHeight:e.clientHeight,cellMinHeight:d,forPrint:e.forPrint}))))}componentDidMount(){this.registerInteractiveComponent()}componentDidUpdate(){this.registerInteractiveComponent()}registerInteractiveComponent(){if(!this.rootEl){let e=this.rowRefs.currentMap[0].getCellEls()[0],t=e?e.closest(".fc-daygrid-body"):null;t&&(this.rootEl=t,this.context.registerInteractiveComponent(this,{el:t,isHitComboAllowed:this.props.isHitComboAllowed}))}}componentWillUnmount(){this.rootEl&&(this.context.unregisterInteractiveComponent(this),this.rootEl=null)}prepareHits(){this.rowPositions=new vn(this.rootEl,this.rowRefs.collect().map(e=>e.getCellEls()[0]),!1,!0),this.colPositions=new vn(this.rootEl,this.rowRefs.currentMap[0].getCellEls(),!0,!1)}queryHit(e,t){let{colPositions:r,rowPositions:s}=this,i=r.leftToIndex(e),a=s.topToIndex(t);if(a!=null&&i!=null){let o=this.props.cells[a][i];return{dateProfile:this.props.dateProfile,dateSpan:Object.assign({range:this.getCellRange(a,i),allDay:!0},o.extraDateSpan),dayEl:this.getCellEl(a,i),rect:{left:r.lefts[i],right:r.rights[i],top:s.tops[a],bottom:s.bottoms[a]},layer:0}}return null}getCellEl(e,t){return this.rowRefs.currentMap[e].getCellEls()[t]}getCellRange(e,t){let r=this.props.cells[e][t].date,s=Ft(r,1);return{start:r,end:s}}};function VV(n,e){return ag(n.filter(YV),e)}function YV(n){return n.eventRange.def.allDay}var Tb=class extends nr{constructor(){super(...arguments),this.elRef=Dt(),this.needsScrollReset=!1}render(){let{props:e}=this,{dayMaxEventRows:t,dayMaxEvents:r,expandRows:s}=e,i=r===!0||t===!0;i&&!s&&(i=!1,t=null,r=null);let a=["fc-daygrid-body",i?"fc-daygrid-body-balanced":"fc-daygrid-body-unbalanced",s?"":"fc-daygrid-body-natural"];return E("div",{ref:this.elRef,className:a.join(" "),style:{width:e.clientWidth,minWidth:e.tableMinWidth}},E("table",{role:"presentation",className:"fc-scrollgrid-sync-table",style:{width:e.clientWidth,minWidth:e.tableMinWidth,height:s?e.clientHeight:""}},e.colGroupNode,E("tbody",{role:"presentation"},E(ku,{dateProfile:e.dateProfile,cells:e.cells,renderRowIntro:e.renderRowIntro,showWeekNumbers:e.showWeekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,dayMaxEvents:r,dayMaxEventRows:t,forPrint:e.forPrint,isHitComboAllowed:e.isHitComboAllowed}))))}componentDidMount(){this.requestScrollReset()}componentDidUpdate(e){e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.props.clientWidth){let e=zV(this.elRef.current,this.props.dateProfile);if(e){let t=e.closest(".fc-daygrid-body"),r=t.closest(".fc-scroller"),s=e.getBoundingClientRect().top-t.getBoundingClientRect().top;r.scrollTop=s?s+1:0}this.needsScrollReset=!1}}};function zV(n,e){let t;return e.currentRangeUnit.match(/year|month/)&&(t=n.querySelector(`[data-date="${ec(e.currentDate)}-01"]`)),t||(t=n.querySelector(`[data-date="${au(e.currentDate)}"]`)),t}var Eu=class extends Eo{constructor(){super(...arguments),this.forceDayIfListItem=!0}sliceRange(e,t){return t.sliceRange(e)}},Su=class extends nr{constructor(){super(...arguments),this.slicer=new Eu,this.tableRef=Dt()}render(){let{props:e,context:t}=this;return E(Tb,Object.assign({ref:this.tableRef},this.slicer.sliceProps(e,e.dateProfile,e.nextDayThreshold,t,e.dayTableModel),{dateProfile:e.dateProfile,cells:e.dayTableModel.cells,colGroupNode:e.colGroupNode,tableMinWidth:e.tableMinWidth,renderRowIntro:e.renderRowIntro,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.showWeekNumbers,expandRows:e.expandRows,headerAlignElRef:e.headerAlignElRef,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:e.forPrint}))}},dg=class extends mb{constructor(){super(...arguments),this.buildDayTableModel=de(wb),this.headerRef=Dt(),this.tableRef=Dt()}render(){let{options:e,dateProfileGenerator:t}=this.context,{props:r}=this,s=this.buildDayTableModel(r.dateProfile,t),i=e.dayHeaders&&E(Ci,{ref:this.headerRef,dateProfile:r.dateProfile,dates:s.headerDates,datesRepDistinctDays:s.rowCnt===1}),a=o=>E(Su,{ref:this.tableRef,dateProfile:r.dateProfile,dayTableModel:s,businessHours:r.businessHours,dateSelection:r.dateSelection,eventStore:r.eventStore,eventUiBases:r.eventUiBases,eventSelection:r.eventSelection,eventDrag:r.eventDrag,eventResize:r.eventResize,nextDayThreshold:e.nextDayThreshold,colGroupNode:o.tableColGroupNode,tableMinWidth:o.tableMinWidth,dayMaxEvents:e.dayMaxEvents,dayMaxEventRows:e.dayMaxEventRows,showWeekNumbers:e.weekNumbers,expandRows:!r.isHeightAuto,headerAlignElRef:this.headerElRef,clientWidth:o.clientWidth,clientHeight:o.clientHeight,forPrint:r.forPrint});return e.dayMinWidth?this.renderHScrollLayout(i,a,s.colCnt,e.dayMinWidth):this.renderSimpleLayout(i,a)}};function wb(n,e){let t=new bo(n.renderRange,e);return new ko(t,/year|month|week/.test(n.currentRangeUnit))}var cc=class extends go{buildRenderRange(e,t,r){let s=super.buildRenderRange(e,t,r),{props:i}=this;return bb({currentRange:s,snapToWeek:/^(year|month)$/.test(t),fixedWeekCount:i.fixedWeekCount,dateEnv:i.dateEnv})}};function bb(n){let{dateEnv:e,currentRange:t}=n,{start:r,end:s}=t,i;if(n.snapToWeek&&(r=e.startOfWeek(r),i=e.startOfWeek(s),i.valueOf()!==s.valueOf()&&(s=Wm(i,1))),n.fixedWeekCount){let a=e.startOfWeek(e.startOfMonth(Ft(t.end,-1))),o=Math.ceil(Sw(a,s));s=Wm(s,6-o)}return{start:r,end:s}}var qV=':root{--fc-daygrid-event-dot-width:8px}.fc-daygrid-day-events:after,.fc-daygrid-day-events:before,.fc-daygrid-day-frame:after,.fc-daygrid-day-frame:before,.fc-daygrid-event-harness:after,.fc-daygrid-event-harness:before{clear:both;content:"";display:table}.fc .fc-daygrid-body{position:relative;z-index:1}.fc .fc-daygrid-day.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-daygrid-day-frame{min-height:100%;position:relative}.fc .fc-daygrid-day-top{display:flex;flex-direction:row-reverse}.fc .fc-day-other .fc-daygrid-day-top{opacity:.3}.fc .fc-daygrid-day-number{padding:4px;position:relative;z-index:4}.fc .fc-daygrid-month-start{font-size:1.1em;font-weight:700}.fc .fc-daygrid-day-events{margin-top:1px}.fc .fc-daygrid-body-balanced .fc-daygrid-day-events{left:0;position:absolute;right:0}.fc .fc-daygrid-body-unbalanced .fc-daygrid-day-events{min-height:2em;position:relative}.fc .fc-daygrid-body-natural .fc-daygrid-day-events{margin-bottom:1em}.fc .fc-daygrid-event-harness{position:relative}.fc .fc-daygrid-event-harness-abs{left:0;position:absolute;right:0;top:0}.fc .fc-daygrid-bg-harness{bottom:0;position:absolute;top:0}.fc .fc-daygrid-day-bg .fc-non-business{z-index:1}.fc .fc-daygrid-day-bg .fc-bg-event{z-index:2}.fc .fc-daygrid-day-bg .fc-highlight{z-index:3}.fc .fc-daygrid-event{margin-top:1px;z-index:6}.fc .fc-daygrid-event.fc-event-mirror{z-index:7}.fc .fc-daygrid-day-bottom{font-size:.85em;margin:0 2px}.fc .fc-daygrid-day-bottom:after,.fc .fc-daygrid-day-bottom:before{clear:both;content:"";display:table}.fc .fc-daygrid-more-link{border-radius:3px;cursor:pointer;line-height:1;margin-top:1px;max-width:100%;overflow:hidden;padding:2px;position:relative;white-space:nowrap;z-index:4}.fc .fc-daygrid-more-link:hover{background-color:rgba(0,0,0,.1)}.fc .fc-daygrid-week-number{background-color:var(--fc-neutral-bg-color);color:var(--fc-neutral-text-color);min-width:1.5em;padding:2px;position:absolute;text-align:center;top:0;z-index:5}.fc .fc-more-popover .fc-popover-body{min-width:220px;padding:10px}.fc-direction-ltr .fc-daygrid-event.fc-event-start,.fc-direction-rtl .fc-daygrid-event.fc-event-end{margin-left:2px}.fc-direction-ltr .fc-daygrid-event.fc-event-end,.fc-direction-rtl .fc-daygrid-event.fc-event-start{margin-right:2px}.fc-direction-ltr .fc-daygrid-more-link{float:left}.fc-direction-ltr .fc-daygrid-week-number{border-radius:0 0 3px 0;left:0}.fc-direction-rtl .fc-daygrid-more-link{float:right}.fc-direction-rtl .fc-daygrid-week-number{border-radius:0 0 0 3px;right:0}.fc-liquid-hack .fc-daygrid-day-frame{position:static}.fc-daygrid-event{border-radius:3px;font-size:var(--fc-small-font-size);position:relative;white-space:nowrap}.fc-daygrid-block-event .fc-event-time{font-weight:700}.fc-daygrid-block-event .fc-event-time,.fc-daygrid-block-event .fc-event-title{padding:1px}.fc-daygrid-dot-event{align-items:center;display:flex;padding:2px 0}.fc-daygrid-dot-event .fc-event-title{flex-grow:1;flex-shrink:1;font-weight:700;min-width:0;overflow:hidden}.fc-daygrid-dot-event.fc-event-mirror,.fc-daygrid-dot-event:hover{background:rgba(0,0,0,.1)}.fc-daygrid-dot-event.fc-event-selected:before{bottom:-10px;top:-10px}.fc-daygrid-event-dot{border:calc(var(--fc-daygrid-event-dot-width)/2) solid var(--fc-event-border-color);border-radius:calc(var(--fc-daygrid-event-dot-width)/2);box-sizing:content-box;height:0;margin:0 4px;width:0}.fc-direction-ltr .fc-daygrid-event .fc-event-time{margin-right:3px}.fc-direction-rtl .fc-daygrid-event .fc-event-time{margin-left:3px}';Ta(qV);var _R=Xr({name:"@fullcalendar/daygrid",initialView:"dayGridMonth",views:{dayGrid:{component:dg,dateProfileGeneratorClass:cc},dayGridDay:{type:"dayGrid",duration:{days:1}},dayGridWeek:{type:"dayGrid",duration:{weeks:1}},dayGridMonth:{type:"dayGrid",duration:{months:1},fixedWeekCount:!0},dayGridYear:{type:"dayGrid",duration:{years:1}}}});var Eb=class extends Kd{getKeyInfo(){return{allDay:{},timed:{}}}getKeysForDateSpan(e){return e.allDay?["allDay"]:["timed"]}getKeysForEventDef(e){return e.allDay?jw(e)?["timed","allDay"]:["allDay"]:["timed"]}},GV=rt({hour:"numeric",minute:"2-digit",omitZeroMinute:!0,meridiem:"short"});function NR(n){let e=["fc-timegrid-slot","fc-timegrid-slot-label",n.isLabeled?"fc-scrollgrid-shrink":"fc-timegrid-slot-minor"];return E($s.Consumer,null,t=>{if(!n.isLabeled)return E("td",{className:e.join(" "),"data-time":n.isoTimeStr});let{dateEnv:r,options:s,viewApi:i}=t,a=s.slotLabelFormat==null?GV:Array.isArray(s.slotLabelFormat)?rt(s.slotLabelFormat[0]):rt(s.slotLabelFormat),o={level:0,time:n.time,date:r.toDate(n.date),view:i,text:r.format(n.date,a)};return E(sr,{elTag:"td",elClasses:e,elAttrs:{"data-time":n.isoTimeStr},renderProps:o,generatorName:"slotLabelContent",customGenerator:s.slotLabelContent,defaultGenerator:QV,classNameGenerator:s.slotLabelClassNames,didMount:s.slotLabelDidMount,willUnmount:s.slotLabelWillUnmount},l=>E("div",{className:"fc-timegrid-slot-label-frame fc-scrollgrid-shrink-frame"},E(l,{elTag:"div",elClasses:["fc-timegrid-slot-label-cushion","fc-scrollgrid-shrink-cushion"]})))})}function QV(n){return n.text}var Sb=class extends He{render(){return this.props.slatMetas.map(e=>E("tr",{key:e.key},E(NR,Object.assign({},e))))}},KV=rt({week:"short"}),ZV=5,Db=class extends nr{constructor(){super(...arguments),this.allDaySplitter=new Eb,this.headerElRef=Dt(),this.rootElRef=Dt(),this.scrollerElRef=Dt(),this.state={slatCoords:null},this.handleScrollTopRequest=e=>{let t=this.scrollerElRef.current;t&&(t.scrollTop=e)},this.renderHeadAxis=(e,t="")=>{let{options:r}=this.context,{dateProfile:s}=this.props,i=s.renderRange,o=_i(i.start,i.end)===1?_o(this.context,i.start,"week"):{};return r.weekNumbers&&e==="day"?E(bu,{elTag:"th",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},date:i.start,defaultFormat:KV},l=>E("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame","fc-timegrid-axis-frame-liquid"].join(" "),style:{height:t}},E(l,{elTag:"a",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"],elAttrs:o}))):E("th",{"aria-hidden":!0,className:"fc-timegrid-axis"},E("div",{className:"fc-timegrid-axis-frame",style:{height:t}}))},this.renderTableRowAxis=e=>{let{options:t,viewApi:r}=this.context,s={text:t.allDayText,view:r};return E(sr,{elTag:"td",elClasses:["fc-timegrid-axis","fc-scrollgrid-shrink"],elAttrs:{"aria-hidden":!0},renderProps:s,generatorName:"allDayContent",customGenerator:t.allDayContent,defaultGenerator:JV,classNameGenerator:t.allDayClassNames,didMount:t.allDayDidMount,willUnmount:t.allDayWillUnmount},i=>E("div",{className:["fc-timegrid-axis-frame","fc-scrollgrid-shrink-frame",e==null?" fc-timegrid-axis-frame-liquid":""].join(" "),style:{height:e}},E(i,{elTag:"span",elClasses:["fc-timegrid-axis-cushion","fc-scrollgrid-shrink-cushion","fc-scrollgrid-sync-inner"]})))},this.handleSlatCoords=e=>{this.setState({slatCoords:e})}}renderSimpleLayout(e,t,r){let{context:s,props:i}=this,a=[],o=Ao(s.options);return e&&a.push({type:"header",key:"header",isSticky:o,chunk:{elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}}),t&&(a.push({type:"body",key:"all-day",chunk:{content:t}}),a.push({type:"body",key:"all-day-divider",outerContent:E("tr",{role:"presentation",className:"fc-scrollgrid-section"},E("td",{className:"fc-timegrid-divider "+s.theme.getClass("tableCellShaded")}))})),a.push({type:"body",key:"body",liquid:!0,expandRows:!!s.options.expandRows,chunk:{scrollerElRef:this.scrollerElRef,content:r}}),E(gn,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:s.viewSpec},E(ga,{liquid:!i.isHeightAuto&&!i.forPrint,collapsibleWidth:i.forPrint,cols:[{width:"shrink"}],sections:a}))}renderHScrollLayout(e,t,r,s,i,a,o){let l=this.context.pluginHooks.scrollGridImpl;if(!l)throw new Error("No ScrollGrid implementation");let{context:c,props:d}=this,u=!d.forPrint&&Ao(c.options),h=!d.forPrint&&vu(c.options),f=[];e&&f.push({type:"header",key:"header",isSticky:u,syncRowHeights:!0,chunks:[{key:"axis",rowContent:m=>E("tr",{role:"presentation"},this.renderHeadAxis("day",m.rowSyncHeights[0]))},{key:"cols",elRef:this.headerElRef,tableClassName:"fc-col-header",rowContent:e}]}),t&&(f.push({type:"body",key:"all-day",syncRowHeights:!0,chunks:[{key:"axis",rowContent:m=>E("tr",{role:"presentation"},this.renderTableRowAxis(m.rowSyncHeights[0]))},{key:"cols",content:t}]}),f.push({key:"all-day-divider",type:"body",outerContent:E("tr",{role:"presentation",className:"fc-scrollgrid-section"},E("td",{colSpan:2,className:"fc-timegrid-divider "+c.theme.getClass("tableCellShaded")}))}));let p=c.options.nowIndicator;return f.push({type:"body",key:"body",liquid:!0,expandRows:!!c.options.expandRows,chunks:[{key:"axis",content:m=>E("div",{className:"fc-timegrid-axis-chunk"},E("table",{"aria-hidden":!0,style:{height:m.expandRows?m.clientHeight:""}},m.tableColGroupNode,E("tbody",null,E(Sb,{slatMetas:a}))),E("div",{className:"fc-timegrid-now-indicator-container"},E(Ws,{unit:p?"minute":"day"},g=>{let y=p&&o&&o.safeComputeTop(g);return typeof y=="number"?E(Tu,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:y},isAxis:!0,date:g}):null})))},{key:"cols",scrollerElRef:this.scrollerElRef,content:r}]}),h&&f.push({key:"footer",type:"footer",isSticky:!0,chunks:[{key:"axis",content:ac},{key:"cols",content:ac}]}),E(gn,{elRef:this.rootElRef,elClasses:["fc-timegrid"],viewSpec:c.viewSpec},E(l,{liquid:!d.isHeightAuto&&!d.forPrint,forPrint:d.forPrint,collapsibleWidth:!1,colGroups:[{width:"shrink",cols:[{width:"shrink"}]},{cols:[{span:s,minWidth:i}]}],sections:f}))}getAllDayMaxEventProps(){let{dayMaxEvents:e,dayMaxEventRows:t}=this.context.options;return(e===!0||t===!0)&&(e=void 0,t=ZV),{dayMaxEvents:e,dayMaxEventRows:t}}};function JV(n){return n.text}var Cb=class{constructor(e,t,r){this.positions=e,this.dateProfile=t,this.slotDuration=r}safeComputeTop(e){let{dateProfile:t}=this;if(Hs(t.currentRange,e)){let r=at(e),s=e.valueOf()-r.valueOf();if(s>=gs(t.slotMinTime)&&s<gs(t.slotMaxTime))return this.computeTimeTop(Ee(s))}return null}computeDateTop(e,t){return t||(t=at(e)),this.computeTimeTop(Ee(e.valueOf()-t.valueOf()))}computeTimeTop(e){let{positions:t,dateProfile:r}=this,s=t.els.length,i=(e.milliseconds-gs(r.slotMinTime))/gs(this.slotDuration),a,o;return i=Math.max(0,i),i=Math.min(s,i),a=Math.floor(i),a=Math.min(a,s-1),o=i-a,t.tops[a]+t.getHeight(a)*o}},xb=class extends He{render(){let{props:e,context:t}=this,{options:r}=t,{slatElRefs:s}=e;return E("tbody",null,e.slatMetas.map((i,a)=>{let o={time:i.time,date:t.dateEnv.toDate(i.date),view:t.viewApi};return E("tr",{key:i.key,ref:s.createRef(i.key)},e.axis&&E(NR,Object.assign({},i)),E(sr,{elTag:"td",elClasses:["fc-timegrid-slot","fc-timegrid-slot-lane",!i.isLabeled&&"fc-timegrid-slot-minor"],elAttrs:{"data-time":i.isoTimeStr},renderProps:o,generatorName:"slotLaneContent",customGenerator:r.slotLaneContent,classNameGenerator:r.slotLaneClassNames,didMount:r.slotLaneDidMount,willUnmount:r.slotLaneWillUnmount}))}))}},Mb=class extends He{constructor(){super(...arguments),this.rootElRef=Dt(),this.slatElRefs=new Jr}render(){let{props:e,context:t}=this;return E("div",{ref:this.rootElRef,className:"fc-timegrid-slots"},E("table",{"aria-hidden":!0,className:t.theme.getClass("table"),style:{minWidth:e.tableMinWidth,width:e.clientWidth,height:e.minHeight}},e.tableColGroupNode,E(xb,{slatElRefs:this.slatElRefs,axis:e.axis,slatMetas:e.slatMetas})))}componentDidMount(){this.updateSizing()}componentDidUpdate(){this.updateSizing()}componentWillUnmount(){this.props.onCoords&&this.props.onCoords(null)}updateSizing(){let{context:e,props:t}=this;t.onCoords&&t.clientWidth!==null&&this.rootElRef.current.offsetHeight&&t.onCoords(new Cb(new vn(this.rootElRef.current,XV(this.slatElRefs.currentMap,t.slatMetas),!1,!0),this.props.dateProfile,e.options.slotDuration))}};function XV(n,e){return e.map(t=>n[t.key])}function Du(n,e){let t=[],r;for(r=0;r<e;r+=1)t.push([]);if(n)for(r=0;r<n.length;r+=1)t[n[r].col].push(n[r]);return t}function AR(n,e){let t=[];if(n){for(let r=0;r<e;r+=1)t[r]={affectedInstances:n.affectedInstances,isEvent:n.isEvent,segs:[]};for(let r of n.segs)t[r.col].segs.push(r)}else for(let r=0;r<e;r+=1)t[r]=null;return t}var _b=class extends He{render(){let{props:e}=this;return E(Co,{elClasses:["fc-timegrid-more-link"],elStyle:{top:e.top,bottom:e.bottom},allDayDate:null,moreCnt:e.hiddenSegs.length,allSegs:e.hiddenSegs,hiddenSegs:e.hiddenSegs,extraDateSpan:e.extraDateSpan,dateProfile:e.dateProfile,todayRange:e.todayRange,popoverContent:()=>OR(e.hiddenSegs,e),defaultGenerator:eY,forceTimed:!0},t=>E(t,{elTag:"div",elClasses:["fc-timegrid-more-link-inner","fc-sticky"]}))}};function eY(n){return n.shortText}function tY(n,e,t){let r=new wo;e!=null&&(r.strictOrder=e),t!=null&&(r.maxStackCnt=t);let s=r.addSegs(n),i=tb(s),a=rY(r);return a=aY(a,1),{segRects:oY(a),hiddenGroups:i}}function rY(n){let{entriesByLevel:e}=n,t=Ob((r,s)=>r+":"+s,(r,s)=>{let i=iY(n,r,s),a=PR(i,t),o=e[r][s];return[Object.assign(Object.assign({},o),{nextLevelNodes:a[0]}),o.thickness+a[1]]});return PR(e.length?{level:0,lateralStart:0,lateralEnd:e[0].length}:null,t)[0]}function PR(n,e){if(!n)return[[],0];let{level:t,lateralStart:r,lateralEnd:s}=n,i=r,a=[];for(;i<s;)a.push(e(t,i)),i+=1;return a.sort(sY),[a.map(nY),a[0][1]]}function sY(n,e){return e[1]-n[1]}function nY(n){return n[0]}function iY(n,e,t){let{levelCoords:r,entriesByLevel:s}=n,i=s[e][t],a=r[e]+i.thickness,o=r.length,l=e;for(;l<o&&r[l]<a;l+=1);for(;l<o;l+=1){let c=s[l],d,u=eu(c,i.span.start,Xd),h=u[0]+u[1],f=h;for(;(d=c[f])&&d.span.start<i.span.end;)f+=1;if(h<f)return{level:l,lateralStart:h,lateralEnd:f}}return null}function aY(n,e){let t=Ob((r,s,i)=>Yn(r),(r,s,i)=>{let{nextLevelNodes:a,thickness:o}=r,l=o+i,c=o/l,d,u=[];if(!a.length)d=e;else for(let f of a)if(d===void 0){let p=t(f,s,l);d=p[0],u.push(p[1])}else{let p=t(f,d,0);u.push(p[1])}let h=(d-s)*c;return[d-h,Object.assign(Object.assign({},r),{thickness:h,nextLevelNodes:u})]});return n.map(r=>t(r,0,0)[1])}function oY(n){let e=[],t=Ob((s,i,a)=>Yn(s),(s,i,a)=>{let o=Object.assign(Object.assign({},s),{levelCoord:i,stackDepth:a,stackForward:0});return e.push(o),o.stackForward=r(s.nextLevelNodes,i+s.thickness,a+1)+1});function r(s,i,a){let o=0;for(let l of s)o=Math.max(t(l,i,a),o);return o}return r(n,0,0),e}function Ob(n,e){let t={};return(...r)=>{let s=n(...r);return s in t?t[s]:t[s]=e(...r)}}function IR(n,e,t=null,r=0){let s=[];if(t)for(let i=0;i<n.length;i+=1){let a=n[i],o=t.computeDateTop(a.start,e),l=Math.max(o+(r||0),t.computeDateTop(a.end,e));s.push({start:Math.round(o),end:Math.round(l)})}return s}function lY(n,e,t,r){let s=[],i=[];for(let c=0;c<n.length;c+=1){let d=e[c];d?s.push({index:c,thickness:1,span:d}):i.push(n[c])}let{segRects:a,hiddenGroups:o}=tY(s,t,r),l=[];for(let c of a)l.push({seg:n[c.index],rect:c});for(let c of i)l.push({seg:c,rect:null});return{segPlacements:l,hiddenGroups:o}}var cY=rt({hour:"numeric",minute:"2-digit",meridiem:!1}),ug=class extends He{render(){return E(ya,Object.assign({},this.props,{elClasses:["fc-timegrid-event","fc-v-event",this.props.isShort&&"fc-timegrid-event-short"],defaultTimeFormat:cY}))}},Ab=class extends He{constructor(){super(...arguments),this.sortEventSegs=de(uu)}render(){let{props:e,context:t}=this,{options:r}=t,s=r.selectMirror,i=e.eventDrag&&e.eventDrag.segs||e.eventResize&&e.eventResize.segs||s&&e.dateSelectionSegs||[],a=e.eventDrag&&e.eventDrag.affectedInstances||e.eventResize&&e.eventResize.affectedInstances||{},o=this.sortEventSegs(e.fgEventSegs,r.eventOrder);return E(va,{elTag:"td",elRef:e.elRef,elClasses:["fc-timegrid-col",...e.extraClassNames||[]],elAttrs:Object.assign({role:"gridcell"},e.extraDataAttrs),date:e.date,dateProfile:e.dateProfile,todayRange:e.todayRange,extraRenderProps:e.extraRenderProps},l=>E("div",{className:"fc-timegrid-col-frame"},E("div",{className:"fc-timegrid-col-bg"},this.renderFillSegs(e.businessHourSegs,"non-business"),this.renderFillSegs(e.bgEventSegs,"bg-event"),this.renderFillSegs(e.dateSelectionSegs,"highlight")),E("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(o,a,!1,!1,!1)),E("div",{className:"fc-timegrid-col-events"},this.renderFgSegs(i,{},!!e.eventDrag,!!e.eventResize,!!s,"mirror")),E("div",{className:"fc-timegrid-now-indicator-container"},this.renderNowIndicator(e.nowIndicatorSegs)),oc(r)&&E(l,{elTag:"div",elClasses:["fc-timegrid-col-misc"]})))}renderFgSegs(e,t,r,s,i,a){let{props:o}=this;return o.forPrint?OR(e,o):this.renderPositionedFgSegs(e,t,r,s,i,a)}renderPositionedFgSegs(e,t,r,s,i,a){let{eventMaxStack:o,eventShortHeight:l,eventOrderStrict:c,eventMinHeight:d}=this.context.options,{date:u,slatCoords:h,eventSelection:f,todayRange:p,nowDate:m}=this.props,g=r||s||i,y=IR(e,u,h,d),{segPlacements:T,hiddenGroups:w}=lY(e,y,c,o);return E(Ze,null,this.renderHiddenGroups(w,e),T.map(b=>{let{seg:S,rect:k}=b,D=S.eventRange.instance.instanceId,M=g||!!(!t[D]&&k),_=kb(k&&k.span),W=!g&&k?this.computeSegHStyle(k):{left:0,right:0},j=!!k&&k.stackForward>0,R=!!k&&k.span.end-k.span.start<l;return E("div",{className:"fc-timegrid-event-harness"+(j?" fc-timegrid-event-harness-inset":""),key:a||D,style:Object.assign(Object.assign({visibility:M?"":"hidden"},_),W)},E(ug,Object.assign({seg:S,isDragging:r,isResizing:s,isDateSelecting:i,isSelected:D===f,isShort:R},Tn(S,p,m))))}))}renderHiddenGroups(e,t){let{extraDateSpan:r,dateProfile:s,todayRange:i,nowDate:a,eventSelection:o,eventDrag:l,eventResize:c}=this.props;return E(Ze,null,e.map(d=>{let u=kb(d.span),h=dY(d.entries,t);return E(_b,{key:$m(tg(h)),hiddenSegs:h,top:u.top,bottom:u.bottom,extraDateSpan:r,dateProfile:s,todayRange:i,nowDate:a,eventSelection:o,eventDrag:l,eventResize:c})}))}renderFillSegs(e,t){let{props:r,context:s}=this,a=IR(e,r.date,r.slatCoords,s.options.eventMinHeight).map((o,l)=>{let c=e[l];return E("div",{key:hu(c.eventRange),className:"fc-timegrid-bg-harness",style:kb(o)},t==="bg-event"?E(Do,Object.assign({seg:c},Tn(c,r.todayRange,r.nowDate))):wu(t))});return E(Ze,null,a)}renderNowIndicator(e){let{slatCoords:t,date:r}=this.props;return t?e.map((s,i)=>E(Tu,{key:i,elClasses:["fc-timegrid-now-indicator-line"],elStyle:{top:t.computeDateTop(s.start,r)},isAxis:!1,date:r})):null}computeSegHStyle(e){let{isRtl:t,options:r}=this.context,s=r.slotEventOverlap,i=e.levelCoord,a=e.levelCoord+e.thickness,o,l;s&&(a=Math.min(1,i+(a-i)*2)),t?(o=1-a,l=i):(o=i,l=1-a);let c={zIndex:e.stackDepth+1,left:o*100+"%",right:l*100+"%"};return s&&!e.stackForward&&(c[t?"marginLeft":"marginRight"]=20),c}};function OR(n,{todayRange:e,nowDate:t,eventSelection:r,eventDrag:s,eventResize:i}){let a=(s?s.affectedInstances:null)||(i?i.affectedInstances:null)||{};return E(Ze,null,n.map(o=>{let l=o.eventRange.instance.instanceId;return E("div",{key:l,style:{visibility:a[l]?"hidden":""}},E(ug,Object.assign({seg:o,isDragging:!1,isResizing:!1,isDateSelecting:!1,isSelected:l===r,isShort:!1},Tn(o,e,t))))}))}function kb(n){return n?{top:n.start,bottom:-n.end}:{top:"",bottom:""}}function dY(n,e){return n.map(t=>e[t.index])}var Pb=class extends He{constructor(){super(...arguments),this.splitFgEventSegs=de(Du),this.splitBgEventSegs=de(Du),this.splitBusinessHourSegs=de(Du),this.splitNowIndicatorSegs=de(Du),this.splitDateSelectionSegs=de(Du),this.splitEventDrag=de(AR),this.splitEventResize=de(AR),this.rootElRef=Dt(),this.cellElRefs=new Jr}render(){let{props:e,context:t}=this,r=t.options.nowIndicator&&e.slatCoords&&e.slatCoords.safeComputeTop(e.nowDate),s=e.cells.length,i=this.splitFgEventSegs(e.fgEventSegs,s),a=this.splitBgEventSegs(e.bgEventSegs,s),o=this.splitBusinessHourSegs(e.businessHourSegs,s),l=this.splitNowIndicatorSegs(e.nowIndicatorSegs,s),c=this.splitDateSelectionSegs(e.dateSelectionSegs,s),d=this.splitEventDrag(e.eventDrag,s),u=this.splitEventResize(e.eventResize,s);return E("div",{className:"fc-timegrid-cols",ref:this.rootElRef},E("table",{role:"presentation",style:{minWidth:e.tableMinWidth,width:e.clientWidth}},e.tableColGroupNode,E("tbody",{role:"presentation"},E("tr",{role:"row"},e.axis&&E("td",{"aria-hidden":!0,className:"fc-timegrid-col fc-timegrid-axis"},E("div",{className:"fc-timegrid-col-frame"},E("div",{className:"fc-timegrid-now-indicator-container"},typeof r=="number"&&E(Tu,{elClasses:["fc-timegrid-now-indicator-arrow"],elStyle:{top:r},isAxis:!0,date:e.nowDate})))),e.cells.map((h,f)=>E(Ab,{key:h.key,elRef:this.cellElRefs.createRef(h.key),dateProfile:e.dateProfile,date:h.date,nowDate:e.nowDate,todayRange:e.todayRange,extraRenderProps:h.extraRenderProps,extraDataAttrs:h.extraDataAttrs,extraClassNames:h.extraClassNames,extraDateSpan:h.extraDateSpan,fgEventSegs:i[f],bgEventSegs:a[f],businessHourSegs:o[f],nowIndicatorSegs:l[f],dateSelectionSegs:c[f],eventDrag:d[f],eventResize:u[f],slatCoords:e.slatCoords,eventSelection:e.eventSelection,forPrint:e.forPrint}))))))}componentDidMount(){this.updateCoords()}componentDidUpdate(){this.updateCoords()}updateCoords(){let{props:e}=this;e.onColCoords&&e.clientWidth!==null&&e.onColCoords(new vn(this.rootElRef.current,uY(this.cellElRefs.currentMap,e.cells),!0,!1))}};function uY(n,e){return e.map(t=>n[t.key])}var Ib=class extends nr{constructor(){super(...arguments),this.processSlotOptions=de(hY),this.state={slatCoords:null},this.handleRootEl=e=>{e?this.context.registerInteractiveComponent(this,{el:e,isHitComboAllowed:this.props.isHitComboAllowed}):this.context.unregisterInteractiveComponent(this)},this.handleScrollRequest=e=>{let{onScrollTopRequest:t}=this.props,{slatCoords:r}=this.state;if(t&&r){if(e.time){let s=r.computeTimeTop(e.time);s=Math.ceil(s),s&&(s+=1),t(s)}return!0}return!1},this.handleColCoords=e=>{this.colCoords=e},this.handleSlatCoords=e=>{this.setState({slatCoords:e}),this.props.onSlatCoords&&this.props.onSlatCoords(e)}}render(){let{props:e,state:t}=this;return E("div",{className:"fc-timegrid-body",ref:this.handleRootEl,style:{width:e.clientWidth,minWidth:e.tableMinWidth}},E(Mb,{axis:e.axis,dateProfile:e.dateProfile,slatMetas:e.slatMetas,clientWidth:e.clientWidth,minHeight:e.expandRows?e.clientHeight:"",tableMinWidth:e.tableMinWidth,tableColGroupNode:e.axis?e.tableColGroupNode:null,onCoords:this.handleSlatCoords}),E(Pb,{cells:e.cells,axis:e.axis,dateProfile:e.dateProfile,businessHourSegs:e.businessHourSegs,bgEventSegs:e.bgEventSegs,fgEventSegs:e.fgEventSegs,dateSelectionSegs:e.dateSelectionSegs,eventSelection:e.eventSelection,eventDrag:e.eventDrag,eventResize:e.eventResize,todayRange:e.todayRange,nowDate:e.nowDate,nowIndicatorSegs:e.nowIndicatorSegs,clientWidth:e.clientWidth,tableMinWidth:e.tableMinWidth,tableColGroupNode:e.tableColGroupNode,slatCoords:t.slatCoords,onColCoords:this.handleColCoords,forPrint:e.forPrint}))}componentDidMount(){this.scrollResponder=this.context.createScrollResponder(this.handleScrollRequest)}componentDidUpdate(e){this.scrollResponder.update(e.dateProfile!==this.props.dateProfile)}componentWillUnmount(){this.scrollResponder.detach()}queryHit(e,t){let{dateEnv:r,options:s}=this.context,{colCoords:i}=this,{dateProfile:a}=this.props,{slatCoords:o}=this.state,{snapDuration:l,snapsPerSlot:c}=this.processSlotOptions(this.props.slotDuration,s.snapDuration),d=i.leftToIndex(e),u=o.positions.topToIndex(t);if(d!=null&&u!=null){let h=this.props.cells[d],f=o.positions.tops[u],p=o.positions.getHeight(u),m=(t-f)/p,g=Math.floor(m*c),y=u*c+g,T=this.props.cells[d].date,w=nu(a.slotMinTime,Ew(l,y)),b=r.add(T,w),S=r.add(b,l);return{dateProfile:a,dateSpan:Object.assign({range:{start:b,end:S},allDay:!1},h.extraDateSpan),dayEl:i.els[d],rect:{left:i.lefts[d],right:i.rights[d],top:f,bottom:f+p},layer:0}}return null}};function hY(n,e){let t=e||n,r=iu(n,t);return r===null&&(t=n,r=1),{snapDuration:t,snapsPerSlot:r}}var Rb=class extends Eo{sliceRange(e,t){let r=[];for(let s=0;s<t.length;s+=1){let i=ys(e,t[s]);i&&r.push({start:i.start,end:i.end,isStart:i.start.valueOf()===e.start.valueOf(),isEnd:i.end.valueOf()===e.end.valueOf(),col:s})}return r}},Nb=class extends nr{constructor(){super(...arguments),this.buildDayRanges=de(fY),this.slicer=new Rb,this.timeColsRef=Dt()}render(){let{props:e,context:t}=this,{dateProfile:r,dayTableModel:s}=e,{nowIndicator:i,nextDayThreshold:a}=t.options,o=this.buildDayRanges(s,r,t.dateEnv);return E(Ws,{unit:i?"minute":"day"},(l,c)=>E(Ib,Object.assign({ref:this.timeColsRef},this.slicer.sliceProps(e,r,null,t,o),{forPrint:e.forPrint,axis:e.axis,dateProfile:r,slatMetas:e.slatMetas,slotDuration:e.slotDuration,cells:s.cells[0],tableColGroupNode:e.tableColGroupNode,tableMinWidth:e.tableMinWidth,clientWidth:e.clientWidth,clientHeight:e.clientHeight,expandRows:e.expandRows,nowDate:l,nowIndicatorSegs:i&&this.slicer.sliceNowDate(l,r,a,t,o),todayRange:c,onScrollTopRequest:e.onScrollTopRequest,onSlatCoords:e.onSlatCoords})))}};function fY(n,e,t){let r=[];for(let s of n.headerDates)r.push({start:t.add(s,e.slotMinTime),end:t.add(s,e.slotMaxTime)});return r}var RR=[{hours:1},{minutes:30},{minutes:15},{seconds:30},{seconds:15}];function pY(n,e,t,r,s){let i=new Date(0),a=n,o=Ee(0),l=t||mY(r),c=[];for(;gs(a)<gs(e);){let d=s.add(i,a),u=iu(o,l)!==null;c.push({date:d,time:a,key:d.toISOString(),isoTimeStr:Cw(d),isLabeled:u}),a=nu(a,r),o=nu(o,r)}return c}function mY(n){let e,t,r;for(e=RR.length-1;e>=0;e-=1)if(t=Ee(RR[e]),r=iu(t,n),r!==null&&r>1)return t;return n}var hg=class extends Db{constructor(){super(...arguments),this.buildTimeColsModel=de(gY),this.buildSlatMetas=de(pY)}render(){let{options:e,dateEnv:t,dateProfileGenerator:r}=this.context,{props:s}=this,{dateProfile:i}=s,a=this.buildTimeColsModel(i,r),o=this.allDaySplitter.splitProps(s),l=this.buildSlatMetas(i.slotMinTime,i.slotMaxTime,e.slotLabelInterval,e.slotDuration,t),{dayMinWidth:c}=e,d=!c,u=c,h=e.dayHeaders&&E(Ci,{dates:a.headerDates,dateProfile:i,datesRepDistinctDays:!0,renderIntro:d?this.renderHeadAxis:null}),f=e.allDaySlot!==!1&&(m=>E(Su,Object.assign({},o.allDay,{dateProfile:i,dayTableModel:a,nextDayThreshold:e.nextDayThreshold,tableMinWidth:m.tableMinWidth,colGroupNode:m.tableColGroupNode,renderRowIntro:d?this.renderTableRowAxis:null,showWeekNumbers:!1,expandRows:!1,headerAlignElRef:this.headerElRef,clientWidth:m.clientWidth,clientHeight:m.clientHeight,forPrint:s.forPrint},this.getAllDayMaxEventProps()))),p=m=>E(Nb,Object.assign({},o.timed,{dayTableModel:a,dateProfile:i,axis:d,slotDuration:e.slotDuration,slatMetas:l,forPrint:s.forPrint,tableColGroupNode:m.tableColGroupNode,tableMinWidth:m.tableMinWidth,clientWidth:m.clientWidth,clientHeight:m.clientHeight,onSlatCoords:this.handleSlatCoords,expandRows:m.expandRows,onScrollTopRequest:this.handleScrollTopRequest}));return u?this.renderHScrollLayout(h,f,p,a.colCnt,c,l,this.state.slatCoords):this.renderSimpleLayout(h,f,p)}};function gY(n,e){let t=new bo(n.renderRange,e);return new ko(t,!1)}var yY='.fc-v-event{background-color:var(--fc-event-bg-color);border:1px solid var(--fc-event-border-color);display:block}.fc-v-event .fc-event-main{color:var(--fc-event-text-color);height:100%}.fc-v-event .fc-event-main-frame{display:flex;flex-direction:column;height:100%}.fc-v-event .fc-event-time{flex-grow:0;flex-shrink:0;max-height:100%;overflow:hidden}.fc-v-event .fc-event-title-container{flex-grow:1;flex-shrink:1;min-height:0}.fc-v-event .fc-event-title{bottom:0;max-height:100%;overflow:hidden;top:0}.fc-v-event:not(.fc-event-start){border-top-left-radius:0;border-top-right-radius:0;border-top-width:0}.fc-v-event:not(.fc-event-end){border-bottom-left-radius:0;border-bottom-right-radius:0;border-bottom-width:0}.fc-v-event.fc-event-selected:before{left:-10px;right:-10px}.fc-v-event .fc-event-resizer-start{cursor:n-resize}.fc-v-event .fc-event-resizer-end{cursor:s-resize}.fc-v-event:not(.fc-event-selected) .fc-event-resizer{height:var(--fc-event-resizer-thickness);left:0;right:0}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-start{top:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event:not(.fc-event-selected) .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-thickness)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer{left:50%;margin-left:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-start{top:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc-v-event.fc-event-selected .fc-event-resizer-end{bottom:calc(var(--fc-event-resizer-dot-total-width)/-2)}.fc .fc-timegrid .fc-daygrid-body{z-index:2}.fc .fc-timegrid-divider{padding:0 0 2px}.fc .fc-timegrid-body{min-height:100%;position:relative;z-index:1}.fc .fc-timegrid-axis-chunk{position:relative}.fc .fc-timegrid-axis-chunk>table,.fc .fc-timegrid-slots{position:relative;z-index:1}.fc .fc-timegrid-slot{border-bottom:0;height:1.5em}.fc .fc-timegrid-slot:empty:before{content:"\\00a0"}.fc .fc-timegrid-slot-minor{border-top-style:dotted}.fc .fc-timegrid-slot-label-cushion{display:inline-block;white-space:nowrap}.fc .fc-timegrid-slot-label{vertical-align:middle}.fc .fc-timegrid-axis-cushion,.fc .fc-timegrid-slot-label-cushion{padding:0 4px}.fc .fc-timegrid-axis-frame-liquid{height:100%}.fc .fc-timegrid-axis-frame{align-items:center;display:flex;justify-content:flex-end;overflow:hidden}.fc .fc-timegrid-axis-cushion{flex-shrink:0;max-width:60px}.fc-direction-ltr .fc-timegrid-slot-label-frame{text-align:right}.fc-direction-rtl .fc-timegrid-slot-label-frame{text-align:left}.fc-liquid-hack .fc-timegrid-axis-frame-liquid{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col.fc-day-today{background-color:var(--fc-today-bg-color)}.fc .fc-timegrid-col-frame{min-height:100%;position:relative}.fc-media-screen.fc-liquid-hack .fc-timegrid-col-frame{bottom:0;height:auto;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols{bottom:0;left:0;position:absolute;right:0;top:0}.fc-media-screen .fc-timegrid-cols>table{height:100%}.fc-media-screen .fc-timegrid-col-bg,.fc-media-screen .fc-timegrid-col-events,.fc-media-screen .fc-timegrid-now-indicator-container{left:0;position:absolute;right:0;top:0}.fc .fc-timegrid-col-bg{z-index:2}.fc .fc-timegrid-col-bg .fc-non-business{z-index:1}.fc .fc-timegrid-col-bg .fc-bg-event{z-index:2}.fc .fc-timegrid-col-bg .fc-highlight{z-index:3}.fc .fc-timegrid-bg-harness{left:0;position:absolute;right:0}.fc .fc-timegrid-col-events{z-index:3}.fc .fc-timegrid-now-indicator-container{bottom:0;overflow:hidden}.fc-direction-ltr .fc-timegrid-col-events{margin:0 2.5% 0 2px}.fc-direction-rtl .fc-timegrid-col-events{margin:0 2px 0 2.5%}.fc-timegrid-event-harness{position:absolute}.fc-timegrid-event-harness>.fc-timegrid-event{bottom:0;left:0;position:absolute;right:0;top:0}.fc-timegrid-event-harness-inset .fc-timegrid-event,.fc-timegrid-event.fc-event-mirror,.fc-timegrid-more-link{box-shadow:0 0 0 1px var(--fc-page-bg-color)}.fc-timegrid-event,.fc-timegrid-more-link{border-radius:3px;font-size:var(--fc-small-font-size)}.fc-timegrid-event{margin-bottom:1px}.fc-timegrid-event .fc-event-main{padding:1px 1px 0}.fc-timegrid-event .fc-event-time{font-size:var(--fc-small-font-size);margin-bottom:1px;white-space:nowrap}.fc-timegrid-event-short .fc-event-main-frame{flex-direction:row;overflow:hidden}.fc-timegrid-event-short .fc-event-time:after{content:"\\00a0-\\00a0"}.fc-timegrid-event-short .fc-event-title{font-size:var(--fc-small-font-size)}.fc-timegrid-more-link{background:var(--fc-more-link-bg-color);color:var(--fc-more-link-text-color);cursor:pointer;margin-bottom:1px;position:absolute;z-index:9999}.fc-timegrid-more-link-inner{padding:3px 2px;top:0}.fc-direction-ltr .fc-timegrid-more-link{right:0}.fc-direction-rtl .fc-timegrid-more-link{left:0}.fc .fc-timegrid-now-indicator-arrow,.fc .fc-timegrid-now-indicator-line{pointer-events:none}.fc .fc-timegrid-now-indicator-line{border-color:var(--fc-now-indicator-color);border-style:solid;border-width:1px 0 0;left:0;position:absolute;right:0;z-index:4}.fc .fc-timegrid-now-indicator-arrow{border-color:var(--fc-now-indicator-color);border-style:solid;margin-top:-5px;position:absolute;z-index:4}.fc-direction-ltr .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 0 5px 6px;left:0}.fc-direction-rtl .fc-timegrid-now-indicator-arrow{border-bottom-color:transparent;border-top-color:transparent;border-width:5px 6px 5px 0;right:0}';Ta(yY);var vY={allDaySlot:Boolean},LR=Xr({name:"@fullcalendar/timegrid",initialView:"timeGridWeek",optionRefiners:vY,views:{timeGrid:{component:hg,usesMinMaxTime:!0,allDaySlot:!0,slotDuration:"00:30:00",slotEventOverlap:!0},timeGridDay:{type:"timeGrid",duration:{days:1}},timeGridWeek:{type:"timeGrid",duration:{weeks:1}}}});var Lb=class extends nr{constructor(){super(...arguments),this.buildDayTableModel=de(wb),this.slicer=new Eu,this.state={labelId:xi()}}render(){let{props:e,state:t,context:r}=this,{dateProfile:s,forPrint:i}=e,{options:a}=r,o=this.buildDayTableModel(s,r.dateProfileGenerator),l=this.slicer.sliceProps(e,s,a.nextDayThreshold,r,o),c=e.tableWidth!=null?e.tableWidth/a.aspectRatio:null,d=o.cells.length,u=c!=null?c/d:null;return E("div",{ref:e.elRef,"data-date":e.isoDateStr,className:"fc-multimonth-month",style:{width:e.width},role:"grid","aria-labelledby":t.labelId},E("div",{className:"fc-multimonth-header",style:{marginBottom:u},role:"presentation"},E("div",{className:"fc-multimonth-title",id:t.labelId},r.dateEnv.format(e.dateProfile.currentRange.start,e.titleFormat)),E("table",{className:["fc-multimonth-header-table",r.theme.getClass("table")].join(" "),role:"presentation"},E("thead",{role:"rowgroup"},E(Ci,{dateProfile:e.dateProfile,dates:o.headerDates,datesRepDistinctDays:!1})))),E("div",{className:["fc-multimonth-daygrid","fc-daygrid","fc-daygrid-body",!i&&"fc-daygrid-body-balanced",i&&"fc-daygrid-body-unbalanced",i&&"fc-daygrid-body-natural"].join(" "),style:{marginTop:-u}},E("table",{className:["fc-multimonth-daygrid-table",r.theme.getClass("table")].join(" "),style:{height:i?"":c},role:"presentation"},E("tbody",{role:"rowgroup"},E(ku,Object.assign({},l,{dateProfile:s,cells:o.cells,eventSelection:e.eventSelection,dayMaxEvents:!i,dayMaxEventRows:!i,showWeekNumbers:a.weekNumbers,clientWidth:e.clientWidth,clientHeight:e.clientHeight,forPrint:i}))))))}},Fb=class extends nr{constructor(){super(...arguments),this.splitDateProfileByMonth=de(wY),this.buildMonthFormat=de(EY),this.scrollElRef=Dt(),this.firstMonthElRef=Dt(),this.needsScrollReset=!1,this.handleSizing=e=>{e&&this.updateSize()}}render(){let{context:e,props:t,state:r}=this,{options:s}=e,{clientWidth:i,clientHeight:a}=r,o=r.monthHPadding||0,l=Math.min(i!=null?Math.floor(i/(s.multiMonthMinWidth+o)):1,s.multiMonthMaxColumns)||1,c=100/l+"%",d=i==null?null:i/l-o,u=i!=null&&l===1,h=this.splitDateProfileByMonth(e.dateProfileGenerator,t.dateProfile,e.dateEnv,u?!1:s.fixedWeekCount,s.showNonCurrentDates),f=this.buildMonthFormat(s.multiMonthTitleFormat,h),p=["fc-multimonth",u?"fc-multimonth-singlecol":"fc-multimonth-multicol",d!=null&&d<400?"fc-multimonth-compact":"",t.isHeightAuto?"":"fc-scroller"];return E(gn,{elRef:this.scrollElRef,elClasses:p,viewSpec:e.viewSpec},h.map((m,g)=>{let y=ec(m.currentRange.start);return E(Lb,Object.assign({},t,{key:y,isoDateStr:y,elRef:g===0?this.firstMonthElRef:void 0,titleFormat:f,dateProfile:m,width:c,tableWidth:d,clientWidth:i,clientHeight:a}))}))}componentDidMount(){this.updateSize(),this.context.addResizeHandler(this.handleSizing),this.requestScrollReset()}componentDidUpdate(e){Mr(e,this.props)||this.handleSizing(!1),e.dateProfile!==this.props.dateProfile?this.requestScrollReset():this.flushScrollReset()}componentWillUnmount(){this.context.removeResizeHandler(this.handleSizing)}updateSize(){let e=this.scrollElRef.current,t=this.firstMonthElRef.current;e&&this.setState({clientWidth:e.clientWidth,clientHeight:e.clientHeight}),t&&e&&this.state.monthHPadding==null&&this.setState({monthHPadding:e.clientWidth-t.firstChild.offsetWidth})}requestScrollReset(){this.needsScrollReset=!0,this.flushScrollReset()}flushScrollReset(){if(this.needsScrollReset&&this.state.monthHPadding!=null){let{currentDate:e}=this.props.dateProfile,t=this.scrollElRef.current,r=t.querySelector(`[data-date="${ec(e)}"]`);t.scrollTop=r.getBoundingClientRect().top-this.firstMonthElRef.current.getBoundingClientRect().top,this.needsScrollReset=!1}}shouldComponentUpdate(){return!0}},TY=Ee(1,"month");function wY(n,e,t,r,s){let{start:i,end:a}=e.currentRange,o=i,l=[];for(;o.valueOf()<a.valueOf();){let c=t.add(o,TY),d={start:n.skipHiddenDays(o),end:n.skipHiddenDays(c,-1,!0)},u=bb({currentRange:d,snapToWeek:!0,fixedWeekCount:r,dateEnv:t});u={start:n.skipHiddenDays(u.start),end:n.skipHiddenDays(u.end,-1,!0)};let h=e.activeRange?ys(e.activeRange,s?u:d):null;l.push({currentDate:e.currentDate,isValid:e.isValid,validRange:e.validRange,renderRange:u,activeRange:h,currentRange:d,currentRangeUnit:"month",isRangeAllDay:!0,dateIncrement:e.dateIncrement,slotMinTime:e.slotMaxTime,slotMaxTime:e.slotMinTime}),o=c}return l}var bY=rt({year:"numeric",month:"long"}),kY=rt({month:"long"});function EY(n,e){return n||(e[0].currentRange.start.getUTCFullYear()!==e[e.length-1].currentRange.start.getUTCFullYear()?bY:kY)}var SY={multiMonthTitleFormat:rt,multiMonthMaxColumns:Number,multiMonthMinWidth:Number},DY=".fc .fc-multimonth{border:1px solid var(--fc-border-color);display:flex;flex-wrap:wrap;overflow-x:hidden;overflow-y:auto}.fc .fc-multimonth-title{font-size:1.2em;font-weight:700;padding:1em 0;text-align:center}.fc .fc-multimonth-daygrid{background:var(--fc-page-bg-color)}.fc .fc-multimonth-daygrid-table,.fc .fc-multimonth-header-table{table-layout:fixed;width:100%}.fc .fc-multimonth-daygrid-table{border-top-style:hidden!important}.fc .fc-multimonth-singlecol .fc-multimonth{position:relative}.fc .fc-multimonth-singlecol .fc-multimonth-header{background:var(--fc-page-bg-color);position:relative;top:0;z-index:2}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid{position:relative;z-index:1}.fc .fc-multimonth-singlecol .fc-multimonth-daygrid-table,.fc .fc-multimonth-singlecol .fc-multimonth-header-table{border-left-style:hidden;border-right-style:hidden}.fc .fc-multimonth-singlecol .fc-multimonth-month:last-child .fc-multimonth-daygrid-table{border-bottom-style:hidden}.fc .fc-multimonth-multicol{line-height:1}.fc .fc-multimonth-multicol .fc-multimonth-month{padding:0 1.2em 1.2em}.fc .fc-multimonth-multicol .fc-daygrid-more-link{border:1px solid var(--fc-event-border-color);display:block;float:none;padding:1px}.fc .fc-multimonth-compact{line-height:1}.fc .fc-multimonth-compact .fc-multimonth-daygrid-table,.fc .fc-multimonth-compact .fc-multimonth-header-table{font-size:.9em}.fc-media-screen .fc-multimonth-singlecol .fc-multimonth-header{position:sticky}.fc-media-print .fc-multimonth{overflow:visible}";Ta(DY);var FR=Xr({name:"@fullcalendar/multimonth",initialView:"multiMonthYear",optionRefiners:SY,views:{multiMonth:{component:Fb,dateProfileGeneratorClass:cc,multiMonthMinWidth:350,multiMonthMaxColumns:3},multiMonthYear:{type:"multiMonth",duration:{years:1},fixedWeekCount:!0,showNonCurrentDates:!1}}});ic.touchMouseIgnoreWait=500;var Bb=0,fg=0,Hb=!1,pg=class{constructor(e){this.subjectEl=null,this.selector="",this.handleSelector="",this.shouldIgnoreMove=!1,this.shouldWatchScroll=!0,this.isDragging=!1,this.isTouchDragging=!1,this.wasTouchScroll=!1,this.handleMouseDown=t=>{if(!this.shouldIgnoreMouse()&&CY(t)&&this.tryStart(t)){let r=this.createEventFromMouse(t,!0);this.emitter.trigger("pointerdown",r),this.initScrollWatch(r),this.shouldIgnoreMove||document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}},this.handleMouseMove=t=>{let r=this.createEventFromMouse(t);this.recordCoords(r),this.emitter.trigger("pointermove",r)},this.handleMouseUp=t=>{document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.emitter.trigger("pointerup",this.createEventFromMouse(t)),this.cleanup()},this.handleTouchStart=t=>{if(this.tryStart(t)){this.isTouchDragging=!0;let r=this.createEventFromTouch(t,!0);this.emitter.trigger("pointerdown",r),this.initScrollWatch(r);let s=t.target;this.shouldIgnoreMove||s.addEventListener("touchmove",this.handleTouchMove),s.addEventListener("touchend",this.handleTouchEnd),s.addEventListener("touchcancel",this.handleTouchEnd),window.addEventListener("scroll",this.handleTouchScroll,!0)}},this.handleTouchMove=t=>{let r=this.createEventFromTouch(t);this.recordCoords(r),this.emitter.trigger("pointermove",r)},this.handleTouchEnd=t=>{if(this.isDragging){let r=t.target;r.removeEventListener("touchmove",this.handleTouchMove),r.removeEventListener("touchend",this.handleTouchEnd),r.removeEventListener("touchcancel",this.handleTouchEnd),window.removeEventListener("scroll",this.handleTouchScroll,!0),this.emitter.trigger("pointerup",this.createEventFromTouch(t)),this.cleanup(),this.isTouchDragging=!1,xY()}},this.handleTouchScroll=()=>{this.wasTouchScroll=!0},this.handleScroll=t=>{if(!this.shouldIgnoreMove){let r=window.scrollX-this.prevScrollX+this.prevPageX,s=window.scrollY-this.prevScrollY+this.prevPageY;this.emitter.trigger("pointermove",{origEvent:t,isTouch:this.isTouchDragging,subjectEl:this.subjectEl,pageX:r,pageY:s,deltaX:r-this.origPageX,deltaY:s-this.origPageY})}},this.containerEl=e,this.emitter=new Di,e.addEventListener("mousedown",this.handleMouseDown),e.addEventListener("touchstart",this.handleTouchStart,{passive:!0}),MY()}destroy(){this.containerEl.removeEventListener("mousedown",this.handleMouseDown),this.containerEl.removeEventListener("touchstart",this.handleTouchStart,{passive:!0}),_Y()}tryStart(e){let t=this.querySubjectEl(e),r=e.target;return t&&(!this.handleSelector||Zt(r,this.handleSelector))?(this.subjectEl=t,this.isDragging=!0,this.wasTouchScroll=!1,!0):!1}cleanup(){Hb=!1,this.isDragging=!1,this.subjectEl=null,this.destroyScrollWatch()}querySubjectEl(e){return this.selector?Zt(e.target,this.selector):this.containerEl}shouldIgnoreMouse(){return Bb||this.isTouchDragging}cancelTouchScroll(){this.isDragging&&(Hb=!0)}initScrollWatch(e){this.shouldWatchScroll&&(this.recordCoords(e),window.addEventListener("scroll",this.handleScroll,!0))}recordCoords(e){this.shouldWatchScroll&&(this.prevPageX=e.pageX,this.prevPageY=e.pageY,this.prevScrollX=window.scrollX,this.prevScrollY=window.scrollY)}destroyScrollWatch(){this.shouldWatchScroll&&window.removeEventListener("scroll",this.handleScroll,!0)}createEventFromMouse(e,t){let r=0,s=0;return t?(this.origPageX=e.pageX,this.origPageY=e.pageY):(r=e.pageX-this.origPageX,s=e.pageY-this.origPageY),{origEvent:e,isTouch:!1,subjectEl:this.subjectEl,pageX:e.pageX,pageY:e.pageY,deltaX:r,deltaY:s}}createEventFromTouch(e,t){let r=e.touches,s,i,a=0,o=0;return r&&r.length?(s=r[0].pageX,i=r[0].pageY):(s=e.pageX,i=e.pageY),t?(this.origPageX=s,this.origPageY=i):(a=s-this.origPageX,o=i-this.origPageY),{origEvent:e,isTouch:!0,subjectEl:this.subjectEl,pageX:s,pageY:i,deltaX:a,deltaY:o}}};function CY(n){return n.button===0&&!n.ctrlKey}function xY(){Bb+=1,setTimeout(()=>{Bb-=1},ic.touchMouseIgnoreWait)}function MY(){fg+=1,fg===1&&window.addEventListener("touchmove",HR,{passive:!1})}function _Y(){fg-=1,fg||window.removeEventListener("touchmove",HR,{passive:!1})}function HR(n){Hb&&n.preventDefault()}var Ub=class{constructor(){this.isVisible=!1,this.sourceEl=null,this.mirrorEl=null,this.sourceElRect=null,this.parentNode=document.body,this.zIndex=9999,this.revertDuration=0}start(e,t,r){this.sourceEl=e,this.sourceElRect=this.sourceEl.getBoundingClientRect(),this.origScreenX=t-window.scrollX,this.origScreenY=r-window.scrollY,this.deltaX=0,this.deltaY=0,this.updateElPosition()}handleMove(e,t){this.deltaX=e-window.scrollX-this.origScreenX,this.deltaY=t-window.scrollY-this.origScreenY,this.updateElPosition()}setIsVisible(e){e?this.isVisible||(this.mirrorEl&&(this.mirrorEl.style.display=""),this.isVisible=e,this.updateElPosition()):this.isVisible&&(this.mirrorEl&&(this.mirrorEl.style.display="none"),this.isVisible=e)}stop(e,t){let r=()=>{this.cleanup(),t()};e&&this.mirrorEl&&this.isVisible&&this.revertDuration&&(this.deltaX||this.deltaY)?this.doRevertAnimation(r,this.revertDuration):setTimeout(r,0)}doRevertAnimation(e,t){let r=this.mirrorEl,s=this.sourceEl.getBoundingClientRect();r.style.transition="top "+t+"ms,left "+t+"ms",xo(r,{left:s.left,top:s.top}),yw(r,()=>{r.style.transition="",e()})}cleanup(){this.mirrorEl&&(ru(this.mirrorEl),this.mirrorEl=null),this.sourceEl=null}updateElPosition(){this.sourceEl&&this.isVisible&&xo(this.getMirrorEl(),{left:this.sourceElRect.left+this.deltaX,top:this.sourceElRect.top+this.deltaY})}getMirrorEl(){let e=this.sourceElRect,t=this.mirrorEl;return t||(t=this.mirrorEl=this.sourceEl.cloneNode(!0),t.style.userSelect="none",t.style.webkitUserSelect="none",t.style.pointerEvents="none",t.classList.add("fc-event-dragging"),xo(t,{position:"fixed",zIndex:this.zIndex,visibility:"",boxSizing:"border-box",width:e.right-e.left,height:e.bottom-e.top,right:"auto",bottom:"auto",margin:0}),this.parentNode.appendChild(t)),t}},mg=class extends To{constructor(e,t){super(),this.handleScroll=()=>{this.scrollTop=this.scrollController.getScrollTop(),this.scrollLeft=this.scrollController.getScrollLeft(),this.handleScrollChange()},this.scrollController=e,this.doesListening=t,this.scrollTop=this.origScrollTop=e.getScrollTop(),this.scrollLeft=this.origScrollLeft=e.getScrollLeft(),this.scrollWidth=e.getScrollWidth(),this.scrollHeight=e.getScrollHeight(),this.clientWidth=e.getClientWidth(),this.clientHeight=e.getClientHeight(),this.clientRect=this.computeClientRect(),this.doesListening&&this.getEventTarget().addEventListener("scroll",this.handleScroll)}destroy(){this.doesListening&&this.getEventTarget().removeEventListener("scroll",this.handleScroll)}getScrollTop(){return this.scrollTop}getScrollLeft(){return this.scrollLeft}setScrollTop(e){this.scrollController.setScrollTop(e),this.doesListening||(this.scrollTop=Math.max(Math.min(e,this.getMaxScrollTop()),0),this.handleScrollChange())}setScrollLeft(e){this.scrollController.setScrollLeft(e),this.doesListening||(this.scrollLeft=Math.max(Math.min(e,this.getMaxScrollLeft()),0),this.handleScrollChange())}getClientWidth(){return this.clientWidth}getClientHeight(){return this.clientHeight}getScrollWidth(){return this.scrollWidth}getScrollHeight(){return this.scrollHeight}handleScrollChange(){}},gg=class extends mg{constructor(e,t){super(new Zd(e),t)}getEventTarget(){return this.scrollController.el}computeClientRect(){return eb(this.scrollController.el)}},Wb=class extends mg{constructor(e){super(new Jd,e)}getEventTarget(){return window}computeClientRect(){return{left:this.scrollLeft,right:this.scrollLeft+this.clientWidth,top:this.scrollTop,bottom:this.scrollTop+this.clientHeight}}handleScrollChange(){this.clientRect=this.computeClientRect()}},BR=typeof performance=="function"?performance.now:Date.now,$b=class{constructor(){this.isEnabled=!0,this.scrollQuery=[window,".fc-scroller"],this.edgeThreshold=50,this.maxVelocity=300,this.pointerScreenX=null,this.pointerScreenY=null,this.isAnimating=!1,this.scrollCaches=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.animate=()=>{if(this.isAnimating){let e=this.computeBestEdge(this.pointerScreenX+window.scrollX,this.pointerScreenY+window.scrollY);if(e){let t=BR();this.handleSide(e,(t-this.msSinceRequest)/1e3),this.requestAnimation(t)}else this.isAnimating=!1}}}start(e,t,r){this.isEnabled&&(this.scrollCaches=this.buildCaches(r),this.pointerScreenX=null,this.pointerScreenY=null,this.everMovedUp=!1,this.everMovedDown=!1,this.everMovedLeft=!1,this.everMovedRight=!1,this.handleMove(e,t))}handleMove(e,t){if(this.isEnabled){let r=e-window.scrollX,s=t-window.scrollY,i=this.pointerScreenY===null?0:s-this.pointerScreenY,a=this.pointerScreenX===null?0:r-this.pointerScreenX;i<0?this.everMovedUp=!0:i>0&&(this.everMovedDown=!0),a<0?this.everMovedLeft=!0:a>0&&(this.everMovedRight=!0),this.pointerScreenX=r,this.pointerScreenY=s,this.isAnimating||(this.isAnimating=!0,this.requestAnimation(BR()))}}stop(){if(this.isEnabled){this.isAnimating=!1;for(let e of this.scrollCaches)e.destroy();this.scrollCaches=null}}requestAnimation(e){this.msSinceRequest=e,requestAnimationFrame(this.animate)}handleSide(e,t){let{scrollCache:r}=e,{edgeThreshold:s}=this,i=s-e.distance,a=i*i/(s*s)*this.maxVelocity*t,o=1;switch(e.name){case"left":o=-1;case"right":r.setScrollLeft(r.getScrollLeft()+a*o);break;case"top":o=-1;case"bottom":r.setScrollTop(r.getScrollTop()+a*o);break}}computeBestEdge(e,t){let{edgeThreshold:r}=this,s=null,i=this.scrollCaches||[];for(let a of i){let o=a.clientRect,l=e-o.left,c=o.right-e,d=t-o.top,u=o.bottom-t;l>=0&&c>=0&&d>=0&&u>=0&&(d<=r&&this.everMovedUp&&a.canScrollUp()&&(!s||s.distance>d)&&(s={scrollCache:a,name:"top",distance:d}),u<=r&&this.everMovedDown&&a.canScrollDown()&&(!s||s.distance>u)&&(s={scrollCache:a,name:"bottom",distance:u}),l<=r&&this.everMovedLeft&&a.canScrollLeft()&&(!s||s.distance>l)&&(s={scrollCache:a,name:"left",distance:l}),c<=r&&this.everMovedRight&&a.canScrollRight()&&(!s||s.distance>c)&&(s={scrollCache:a,name:"right",distance:c}))}return s}buildCaches(e){return this.queryScrollEls(e).map(t=>t===window?new Wb(!1):new gg(t,!1))}queryScrollEls(e){let t=[];for(let r of this.scrollQuery)typeof r=="object"?t.push(r):t.push(...Array.prototype.slice.call(e.getRootNode().querySelectorAll(r)));return t}},ba=class extends tu{constructor(e,t){super(e),this.containerEl=e,this.delay=null,this.minDistance=0,this.touchScrollAllowed=!0,this.mirrorNeedsRevert=!1,this.isInteracting=!1,this.isDragging=!1,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,this.delayTimeoutId=null,this.onPointerDown=s=>{this.isDragging||(this.isInteracting=!0,this.isDelayEnded=!1,this.isDistanceSurpassed=!1,vw(document.body),ww(document.body),s.isTouch||s.origEvent.preventDefault(),this.emitter.trigger("pointerdown",s),this.isInteracting&&!this.pointer.shouldIgnoreMove&&(this.mirror.setIsVisible(!1),this.mirror.start(s.subjectEl,s.pageX,s.pageY),this.startDelay(s),this.minDistance||this.handleDistanceSurpassed(s)))},this.onPointerMove=s=>{if(this.isInteracting){if(this.emitter.trigger("pointermove",s),!this.isDistanceSurpassed){let i=this.minDistance,a,{deltaX:o,deltaY:l}=s;a=o*o+l*l,a>=i*i&&this.handleDistanceSurpassed(s)}this.isDragging&&(s.origEvent.type!=="scroll"&&(this.mirror.handleMove(s.pageX,s.pageY),this.autoScroller.handleMove(s.pageX,s.pageY)),this.emitter.trigger("dragmove",s))}},this.onPointerUp=s=>{this.isInteracting&&(this.isInteracting=!1,Tw(document.body),bw(document.body),this.emitter.trigger("pointerup",s),this.isDragging&&(this.autoScroller.stop(),this.tryStopDrag(s)),this.delayTimeoutId&&(clearTimeout(this.delayTimeoutId),this.delayTimeoutId=null))};let r=this.pointer=new pg(e);r.emitter.on("pointerdown",this.onPointerDown),r.emitter.on("pointermove",this.onPointerMove),r.emitter.on("pointerup",this.onPointerUp),t&&(r.selector=t),this.mirror=new Ub,this.autoScroller=new $b}destroy(){this.pointer.destroy(),this.onPointerUp({})}startDelay(e){typeof this.delay=="number"?this.delayTimeoutId=setTimeout(()=>{this.delayTimeoutId=null,this.handleDelayEnd(e)},this.delay):this.handleDelayEnd(e)}handleDelayEnd(e){this.isDelayEnded=!0,this.tryStartDrag(e)}handleDistanceSurpassed(e){this.isDistanceSurpassed=!0,this.tryStartDrag(e)}tryStartDrag(e){this.isDelayEnded&&this.isDistanceSurpassed&&(!this.pointer.wasTouchScroll||this.touchScrollAllowed)&&(this.isDragging=!0,this.mirrorNeedsRevert=!1,this.autoScroller.start(e.pageX,e.pageY,this.containerEl),this.emitter.trigger("dragstart",e),this.touchScrollAllowed===!1&&this.pointer.cancelTouchScroll())}tryStopDrag(e){this.mirror.stop(this.mirrorNeedsRevert,this.stopDrag.bind(this,e))}stopDrag(e){this.isDragging=!1,this.emitter.trigger("dragend",e)}setIgnoreMove(e){this.pointer.shouldIgnoreMove=e}setMirrorIsVisible(e){this.mirror.setIsVisible(e)}setMirrorNeedsRevert(e){this.mirrorNeedsRevert=e}setAutoScrollEnabled(e){this.autoScroller.isEnabled=e}},jb=class{constructor(e){this.el=e,this.origRect=pu(e),this.scrollCaches=eg(e).map(t=>new gg(t,!0))}destroy(){for(let e of this.scrollCaches)e.destroy()}computeLeft(){let e=this.origRect.left;for(let t of this.scrollCaches)e+=t.origScrollLeft-t.getScrollLeft();return e}computeTop(){let e=this.origRect.top;for(let t of this.scrollCaches)e+=t.origScrollTop-t.getScrollTop();return e}isWithinClipping(e,t){let r={left:e,top:t};for(let s of this.scrollCaches)if(!AY(s.getEventTarget())&&!Qw(r,s.clientRect))return!1;return!0}};function AY(n){let e=n.tagName;return e==="HTML"||e==="BODY"}var Po=class{constructor(e,t){this.useSubjectCenter=!1,this.requireInitial=!0,this.disablePointCheck=!1,this.initialHit=null,this.movingHit=null,this.finalHit=null,this.handlePointerDown=r=>{let{dragging:s}=this;this.initialHit=null,this.movingHit=null,this.finalHit=null,this.prepareHits(),this.processFirstCoord(r),this.initialHit||!this.requireInitial?(s.setIgnoreMove(!1),this.emitter.trigger("pointerdown",r)):s.setIgnoreMove(!0)},this.handleDragStart=r=>{this.emitter.trigger("dragstart",r),this.handleMove(r,!0)},this.handleDragMove=r=>{this.emitter.trigger("dragmove",r),this.handleMove(r)},this.handlePointerUp=r=>{this.releaseHits(),this.emitter.trigger("pointerup",r)},this.handleDragEnd=r=>{this.movingHit&&this.emitter.trigger("hitupdate",null,!0,r),this.finalHit=this.movingHit,this.movingHit=null,this.emitter.trigger("dragend",r)},this.droppableStore=t,e.emitter.on("pointerdown",this.handlePointerDown),e.emitter.on("dragstart",this.handleDragStart),e.emitter.on("dragmove",this.handleDragMove),e.emitter.on("pointerup",this.handlePointerUp),e.emitter.on("dragend",this.handleDragEnd),this.dragging=e,this.emitter=new Di}processFirstCoord(e){let t={left:e.pageX,top:e.pageY},r=t,s=e.subjectEl,i;s instanceof HTMLElement&&(i=pu(s),r=Kw(r,i));let a=this.initialHit=this.queryHitForOffset(r.left,r.top);if(a){if(this.useSubjectCenter&&i){let o=Jm(i,a.rect);o&&(r=Zw(o))}this.coordAdjust=Jw(r,t)}else this.coordAdjust={left:0,top:0}}handleMove(e,t){let r=this.queryHitForOffset(e.pageX+this.coordAdjust.left,e.pageY+this.coordAdjust.top);(t||!vg(this.movingHit,r))&&(this.movingHit=r,this.emitter.trigger("hitupdate",r,!1,e))}prepareHits(){this.offsetTrackers=Us(this.droppableStore,e=>(e.component.prepareHits(),new jb(e.el)))}releaseHits(){let{offsetTrackers:e}=this;for(let t in e)e[t].destroy();this.offsetTrackers={}}queryHitForOffset(e,t){let{droppableStore:r,offsetTrackers:s}=this,i=null;for(let a in r){let o=r[a].component,l=s[a];if(l&&l.isWithinClipping(e,t)){let c=l.computeLeft(),d=l.computeTop(),u=e-c,h=t-d,{origRect:f}=l,p=f.right-f.left,m=f.bottom-f.top;if(u>=0&&u<p&&h>=0&&h<m){let g=o.queryHit(u,h,p,m);g&&rc(g.dateProfile.activeRange,g.dateSpan.range)&&(this.disablePointCheck||l.el.contains(l.el.getRootNode().elementFromPoint(u+c-window.scrollX,h+d-window.scrollY)))&&(!i||g.layer>i.layer)&&(g.componentId=a,g.context=o.context,g.rect.left+=c,g.rect.right+=c,g.rect.top+=d,g.rect.bottom+=d,i=g)}}}return i}};function vg(n,e){return!n&&!e?!0:!!n!=!!e?!1:Vw(n.dateSpan,e.dateSpan)}function Qb(n,e){let t={};for(let r of e.pluginHooks.datePointTransforms)Object.assign(t,r(n,e));return Object.assign(t,PY(n,e.dateEnv)),t}function PY(n,e){return{date:e.toDate(n.range.start),dateStr:e.formatIso(n.range.start,{omitTime:n.allDay}),allDay:n.allDay}}var Vb=class extends yn{constructor(e){super(e),this.handlePointerDown=r=>{let{dragging:s}=this,i=r.origEvent.target;s.setIgnoreMove(!this.component.isValidDateDownEl(i))},this.handleDragEnd=r=>{let{component:s}=this,{pointer:i}=this.dragging;if(!i.wasTouchScroll){let{initialHit:a,finalHit:o}=this.hitDragging;if(a&&o&&vg(a,o)){let{context:l}=s,c=Object.assign(Object.assign({},Qb(a.dateSpan,l)),{dayEl:a.dayEl,jsEvent:r.origEvent,view:l.viewApi||l.calendarApi.view});l.emitter.trigger("dateClick",c)}}},this.dragging=new ba(e.el),this.dragging.autoScroller.isEnabled=!1;let t=this.hitDragging=new Po(this.dragging,fu(e));t.emitter.on("pointerdown",this.handlePointerDown),t.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}},Yb=class extends yn{constructor(e){super(e),this.dragSelection=null,this.handlePointerDown=a=>{let{component:o,dragging:l}=this,{options:c}=o.context,d=c.selectable&&o.isValidDateDownEl(a.origEvent.target);l.setIgnoreMove(!d),l.delay=a.isTouch?IY(o):null},this.handleDragStart=a=>{this.component.context.calendarApi.unselect(a)},this.handleHitUpdate=(a,o)=>{let{context:l}=this.component,c=null,d=!1;if(a){let u=this.hitDragging.initialHit;a.componentId===u.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(u,a)||(c=RY(u,a,l.pluginHooks.dateSelectionTransformers)),(!c||!rb(c,a.dateProfile,l))&&(d=!0,c=null)}c?l.dispatch({type:"SELECT_DATES",selection:c}):o||l.dispatch({type:"UNSELECT_DATES"}),d?Zl():Jl(),o||(this.dragSelection=c)},this.handlePointerUp=a=>{this.dragSelection&&(Qm(this.dragSelection,a,this.component.context),this.dragSelection=null)};let{component:t}=e,{options:r}=t.context,s=this.dragging=new ba(e.el);s.touchScrollAllowed=!1,s.minDistance=r.selectMinDistance||0,s.autoScroller.isEnabled=r.dragScroll;let i=this.hitDragging=new Po(this.dragging,fu(e));i.emitter.on("pointerdown",this.handlePointerDown),i.emitter.on("dragstart",this.handleDragStart),i.emitter.on("hitupdate",this.handleHitUpdate),i.emitter.on("pointerup",this.handlePointerUp)}destroy(){this.dragging.destroy()}};function IY(n){let{options:e}=n.context,t=e.selectLongPressDelay;return t==null&&(t=e.longPressDelay),t}function RY(n,e,t){let r=n.dateSpan,s=e.dateSpan,i=[r.range.start,r.range.end,s.range.start,s.range.end];i.sort(kw);let a={};for(let o of t){let l=o(n,e);if(l===!1)return null;l&&Object.assign(a,l)}return a.range={start:i[0],end:i[3]},a.allDay=r.allDay,a}var Cu=class n extends yn{constructor(e){super(e),this.subjectEl=null,this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=a=>{let o=a.origEvent.target,{component:l,dragging:c}=this,{mirror:d}=c,{options:u}=l.context,h=l.context;this.subjectEl=a.subjectEl;let f=this.subjectSeg=Ai(a.subjectEl),m=(this.eventRange=f.eventRange).instance.instanceId;this.relevantEvents=cu(h.getCurrentData().eventStore,m),c.minDistance=a.isTouch?0:u.eventDragMinDistance,c.delay=a.isTouch&&m!==l.props.eventSelection?OY(l):null,u.fixedMirrorParent?d.parentNode=u.fixedMirrorParent:d.parentNode=Zt(o,".fc"),d.revertDuration=u.dragRevertDuration;let g=l.isValidSegDownEl(o)&&!Zt(o,".fc-event-resizer");c.setIgnoreMove(!g),this.isDragging=g&&a.subjectEl.classList.contains("fc-event-draggable")},this.handleDragStart=a=>{let o=this.component.context,l=this.eventRange,c=l.instance.instanceId;a.isTouch?c!==this.component.props.eventSelection&&o.dispatch({type:"SELECT_EVENT",eventInstanceId:c}):o.dispatch({type:"UNSELECT_EVENT"}),this.isDragging&&(o.calendarApi.unselect(a),o.emitter.trigger("eventDragStart",{el:this.subjectEl,event:new dt(o,l.def,l.instance),jsEvent:a.origEvent,view:o.viewApi}))},this.handleHitUpdate=(a,o)=>{if(!this.isDragging)return;let l=this.relevantEvents,c=this.hitDragging.initialHit,d=this.component.context,u=null,h=null,f=null,p=!1,m={affectedEvents:l,mutatedEvents:Jt(),isEvent:!0};if(a){u=a.context;let g=u.options;d===u||g.editable&&g.droppable?(h=NY(c,a,this.eventRange.instance.range.start,u.getCurrentData().pluginHooks.eventDragMutationMassagers),h&&(f=du(l,u.getCurrentData().eventUiBases,h,u),m.mutatedEvents=f,yu(m,a.dateProfile,u)||(p=!0,h=null,f=null,m.mutatedEvents=Jt()))):u=null}this.displayDrag(u,m),p?Zl():Jl(),o||(d===u&&vg(c,a)&&(h=null),this.dragging.setMirrorNeedsRevert(!h),this.dragging.setMirrorIsVisible(!a||!this.subjectEl.getRootNode().querySelector(".fc-event-mirror")),this.receivingContext=u,this.validMutation=h,this.mutatedRelevantEvents=f)},this.handlePointerUp=()=>{this.isDragging||this.cleanup()},this.handleDragEnd=a=>{if(this.isDragging){let o=this.component.context,l=o.viewApi,{receivingContext:c,validMutation:d}=this,u=this.eventRange.def,h=this.eventRange.instance,f=new dt(o,u,h),p=this.relevantEvents,m=this.mutatedRelevantEvents,{finalHit:g}=this.hitDragging;if(this.clearDrag(),o.emitter.trigger("eventDragStop",{el:this.subjectEl,event:f,jsEvent:a.origEvent,view:l}),d){if(c===o){let y=new dt(o,m.defs[u.defId],h?m.instances[h.instanceId]:null);o.dispatch({type:"MERGE_EVENTS",eventStore:m});let T={oldEvent:f,event:y,relatedEvents:Gn(m,o,h),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:p})}},w={};for(let b of o.getCurrentData().pluginHooks.eventDropTransformers)Object.assign(w,b(d,o));o.emitter.trigger("eventDrop",Object.assign(Object.assign(Object.assign({},T),w),{el:a.subjectEl,delta:d.datesDelta,jsEvent:a.origEvent,view:l})),o.emitter.trigger("eventChange",T)}else if(c){let y={event:f,relatedEvents:Gn(p,o,h),revert(){o.dispatch({type:"MERGE_EVENTS",eventStore:p})}};o.emitter.trigger("eventLeave",Object.assign(Object.assign({},y),{draggedEl:a.subjectEl,view:l})),o.dispatch({type:"REMOVE_EVENTS",eventStore:p}),o.emitter.trigger("eventRemove",y);let T=m.defs[u.defId],w=m.instances[h.instanceId],b=new dt(c,T,w);c.dispatch({type:"MERGE_EVENTS",eventStore:m});let S={event:b,relatedEvents:Gn(m,c,w),revert(){c.dispatch({type:"REMOVE_EVENTS",eventStore:m})}};c.emitter.trigger("eventAdd",S),a.isTouch&&c.dispatch({type:"SELECT_EVENT",eventInstanceId:h.instanceId}),c.emitter.trigger("drop",Object.assign(Object.assign({},Qb(g.dateSpan,c)),{draggedEl:a.subjectEl,jsEvent:a.origEvent,view:g.context.viewApi})),c.emitter.trigger("eventReceive",Object.assign(Object.assign({},S),{draggedEl:a.subjectEl,view:g.context.viewApi}))}}else o.emitter.trigger("_noEventDrop")}this.cleanup()};let{component:t}=this,{options:r}=t.context,s=this.dragging=new ba(e.el);s.pointer.selector=n.SELECTOR,s.touchScrollAllowed=!1,s.autoScroller.isEnabled=r.dragScroll;let i=this.hitDragging=new Po(this.dragging,Mo);i.useSubjectCenter=e.useEventCenter,i.emitter.on("pointerdown",this.handlePointerDown),i.emitter.on("dragstart",this.handleDragStart),i.emitter.on("hitupdate",this.handleHitUpdate),i.emitter.on("pointerup",this.handlePointerUp),i.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}displayDrag(e,t){let r=this.component.context,s=this.receivingContext;s&&s!==e&&(s===r?s.dispatch({type:"SET_EVENT_DRAG",state:{affectedEvents:t.affectedEvents,mutatedEvents:Jt(),isEvent:!0}}):s.dispatch({type:"UNSET_EVENT_DRAG"})),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){let e=this.component.context,{receivingContext:t}=this;t&&t.dispatch({type:"UNSET_EVENT_DRAG"}),e!==t&&e.dispatch({type:"UNSET_EVENT_DRAG"})}cleanup(){this.subjectSeg=null,this.isDragging=!1,this.eventRange=null,this.relevantEvents=null,this.receivingContext=null,this.validMutation=null,this.mutatedRelevantEvents=null}};Cu.SELECTOR=".fc-event-draggable, .fc-event-resizable";function NY(n,e,t,r){let s=n.dateSpan,i=e.dateSpan,a=s.range.start,o=i.range.start,l={};s.allDay!==i.allDay&&(l.allDay=i.allDay,l.hasEnd=e.context.options.allDayMaintainDuration,i.allDay?a=at(t):a=t);let c=ma(a,o,n.context.dateEnv,n.componentId===e.componentId?n.largeUnit:null);c.milliseconds&&(l.allDay=!1);let d={datesDelta:c,standardProps:l};for(let u of r)u(d,n,e);return d}function OY(n){let{options:e}=n.context,t=e.eventLongPressDelay;return t==null&&(t=e.longPressDelay),t}var zb=class extends yn{constructor(e){super(e),this.draggingSegEl=null,this.draggingSeg=null,this.eventRange=null,this.relevantEvents=null,this.validMutation=null,this.mutatedRelevantEvents=null,this.handlePointerDown=i=>{let{component:a}=this,o=this.querySegEl(i),l=Ai(o),c=this.eventRange=l.eventRange;this.dragging.minDistance=a.context.options.eventDragMinDistance,this.dragging.setIgnoreMove(!this.component.isValidSegDownEl(i.origEvent.target)||i.isTouch&&this.component.props.eventSelection!==c.instance.instanceId)},this.handleDragStart=i=>{let{context:a}=this.component,o=this.eventRange;this.relevantEvents=cu(a.getCurrentData().eventStore,this.eventRange.instance.instanceId);let l=this.querySegEl(i);this.draggingSegEl=l,this.draggingSeg=Ai(l),a.calendarApi.unselect(),a.emitter.trigger("eventResizeStart",{el:l,event:new dt(a,o.def,o.instance),jsEvent:i.origEvent,view:a.viewApi})},this.handleHitUpdate=(i,a,o)=>{let{context:l}=this.component,c=this.relevantEvents,d=this.hitDragging.initialHit,u=this.eventRange.instance,h=null,f=null,p=!1,m={affectedEvents:c,mutatedEvents:Jt(),isEvent:!0};i&&(i.componentId===d.componentId&&this.isHitComboAllowed&&!this.isHitComboAllowed(d,i)||(h=LY(d,i,o.subjectEl.classList.contains("fc-event-resizer-start"),u.range))),h&&(f=du(c,l.getCurrentData().eventUiBases,h,l),m.mutatedEvents=f,yu(m,i.dateProfile,l)||(p=!0,h=null,f=null,m.mutatedEvents=null)),f?l.dispatch({type:"SET_EVENT_RESIZE",state:m}):l.dispatch({type:"UNSET_EVENT_RESIZE"}),p?Zl():Jl(),a||(h&&vg(d,i)&&(h=null),this.validMutation=h,this.mutatedRelevantEvents=f)},this.handleDragEnd=i=>{let{context:a}=this.component,o=this.eventRange.def,l=this.eventRange.instance,c=new dt(a,o,l),d=this.relevantEvents,u=this.mutatedRelevantEvents;if(a.emitter.trigger("eventResizeStop",{el:this.draggingSegEl,event:c,jsEvent:i.origEvent,view:a.viewApi}),this.validMutation){let h=new dt(a,u.defs[o.defId],l?u.instances[l.instanceId]:null);a.dispatch({type:"MERGE_EVENTS",eventStore:u});let f={oldEvent:c,event:h,relatedEvents:Gn(u,a,l),revert(){a.dispatch({type:"MERGE_EVENTS",eventStore:d})}};a.emitter.trigger("eventResize",Object.assign(Object.assign({},f),{el:this.draggingSegEl,startDelta:this.validMutation.startDelta||Ee(0),endDelta:this.validMutation.endDelta||Ee(0),jsEvent:i.origEvent,view:a.viewApi})),a.emitter.trigger("eventChange",f)}else a.emitter.trigger("_noEventResize");this.draggingSeg=null,this.relevantEvents=null,this.validMutation=null};let{component:t}=e,r=this.dragging=new ba(e.el);r.pointer.selector=".fc-event-resizer",r.touchScrollAllowed=!1,r.autoScroller.isEnabled=t.context.options.dragScroll;let s=this.hitDragging=new Po(this.dragging,fu(e));s.emitter.on("pointerdown",this.handlePointerDown),s.emitter.on("dragstart",this.handleDragStart),s.emitter.on("hitupdate",this.handleHitUpdate),s.emitter.on("dragend",this.handleDragEnd)}destroy(){this.dragging.destroy()}querySegEl(e){return Zt(e.subjectEl,".fc-event")}};function LY(n,e,t,r){let s=n.context.dateEnv,i=n.dateSpan.range.start,a=e.dateSpan.range.start,o=ma(i,a,s,n.largeUnit);if(t){if(s.add(r.start,o)<r.end)return{startDelta:o}}else if(s.add(r.end,o)>r.start)return{endDelta:o};return null}var qb=class{constructor(e){this.context=e,this.isRecentPointerDateSelect=!1,this.matchesCancel=!1,this.matchesEvent=!1,this.onSelect=r=>{r.jsEvent&&(this.isRecentPointerDateSelect=!0)},this.onDocumentPointerDown=r=>{let s=this.context.options.unselectCancel,i=Um(r.origEvent);this.matchesCancel=!!Zt(i,s),this.matchesEvent=!!Zt(i,Cu.SELECTOR)},this.onDocumentPointerUp=r=>{let{context:s}=this,{documentPointer:i}=this,a=s.getCurrentData();if(!i.wasTouchScroll){if(a.dateSelection&&!this.isRecentPointerDateSelect){let o=s.options.unselectAuto;o&&(!o||!this.matchesCancel)&&s.calendarApi.unselect(r)}a.eventSelection&&!this.matchesEvent&&s.dispatch({type:"UNSELECT_EVENT"})}this.isRecentPointerDateSelect=!1};let t=this.documentPointer=new pg(document);t.shouldIgnoreMove=!0,t.shouldWatchScroll=!1,t.emitter.on("pointerdown",this.onDocumentPointerDown),t.emitter.on("pointerup",this.onDocumentPointerUp),e.emitter.on("select",this.onSelect)}destroy(){this.context.emitter.off("select",this.onSelect),this.documentPointer.destroy()}},FY={fixedMirrorParent:L},BY={dateClick:L,eventDragStart:L,eventDragStop:L,eventDrop:L,eventResizeStart:L,eventResizeStop:L,eventResize:L,drop:L,eventReceive:L,eventLeave:L},Gb=class{constructor(e,t){this.receivingContext=null,this.droppableEvent=null,this.suppliedDragMeta=null,this.dragMeta=null,this.handleDragStart=s=>{this.dragMeta=this.buildDragMeta(s.subjectEl)},this.handleHitUpdate=(s,i,a)=>{let{dragging:o}=this.hitDragging,l=null,c=null,d=!1,u={affectedEvents:Jt(),mutatedEvents:Jt(),isEvent:this.dragMeta.create};s&&(l=s.context,this.canDropElOnCalendar(a.subjectEl,l)&&(c=HY(s.dateSpan,this.dragMeta,l),u.mutatedEvents=vo(c),d=!yu(u,s.dateProfile,l),d&&(u.mutatedEvents=Jt(),c=null))),this.displayDrag(l,u),o.setMirrorIsVisible(i||!c||!document.querySelector(".fc-event-mirror")),d?Zl():Jl(),i||(o.setMirrorNeedsRevert(!c),this.receivingContext=l,this.droppableEvent=c)},this.handleDragEnd=s=>{let{receivingContext:i,droppableEvent:a}=this;if(this.clearDrag(),i&&a){let o=this.hitDragging.finalHit,l=o.context.viewApi,c=this.dragMeta;if(i.emitter.trigger("drop",Object.assign(Object.assign({},Qb(o.dateSpan,i)),{draggedEl:s.subjectEl,jsEvent:s.origEvent,view:l})),c.create){let d=vo(a);i.dispatch({type:"MERGE_EVENTS",eventStore:d}),s.isTouch&&i.dispatch({type:"SELECT_EVENT",eventInstanceId:a.instance.instanceId}),i.emitter.trigger("eventReceive",{event:new dt(i,a.def,a.instance),relatedEvents:[],revert(){i.dispatch({type:"REMOVE_EVENTS",eventStore:d})},draggedEl:s.subjectEl,view:l})}}this.receivingContext=null,this.droppableEvent=null};let r=this.hitDragging=new Po(e,Mo);r.requireInitial=!1,r.emitter.on("dragstart",this.handleDragStart),r.emitter.on("hitupdate",this.handleHitUpdate),r.emitter.on("dragend",this.handleDragEnd),this.suppliedDragMeta=t}buildDragMeta(e){return typeof this.suppliedDragMeta=="object"?gu(this.suppliedDragMeta):typeof this.suppliedDragMeta=="function"?gu(this.suppliedDragMeta(e)):UY(e)}displayDrag(e,t){let r=this.receivingContext;r&&r!==e&&r.dispatch({type:"UNSET_EVENT_DRAG"}),e&&e.dispatch({type:"SET_EVENT_DRAG",state:t})}clearDrag(){this.receivingContext&&this.receivingContext.dispatch({type:"UNSET_EVENT_DRAG"})}canDropElOnCalendar(e,t){let r=t.options.dropAccept;return typeof r=="function"?r.call(t.calendarApi,e):typeof r=="string"&&r?!!Hm(e,r):!0}};function HY(n,e,t){let r=Object.assign({},e.leftoverProps);for(let d of t.pluginHooks.externalDefTransforms)Object.assign(r,d(n,e));let{refined:s,extra:i}=lu(r,t),a=Kl(s,i,e.sourceId,n.allDay,t.options.forceEventDuration||!!e.duration,t),o=n.range.start;n.allDay&&e.startTime&&(o=t.dateEnv.add(o,e.startTime));let l=e.duration?t.dateEnv.add(o,e.duration):qd(n.allDay,o,t),c=sc(a.defId,{start:o,end:l});return{def:a,instance:c}}function UY(n){let e=WY(n,"event"),t=e?JSON.parse(e):{create:!1};return gu(t)}ic.dataAttrPrefix="";function WY(n,e){let t=ic.dataAttrPrefix,r=(t?t+"-":"")+e;return n.getAttribute("data-"+r)||""}var yg=class{constructor(e,t={}){this.handlePointerDown=s=>{let{dragging:i}=this,{minDistance:a,longPressDelay:o}=this.settings;i.minDistance=a!=null?a:s.isTouch?0:qn.eventDragMinDistance,i.delay=s.isTouch?o!=null?o:qn.longPressDelay:0},this.handleDragStart=s=>{s.isTouch&&this.dragging.delay&&s.subjectEl.classList.contains("fc-event")&&this.dragging.mirror.getMirrorEl().classList.add("fc-event-selected")},this.settings=t;let r=this.dragging=new ba(e);r.touchScrollAllowed=!1,t.itemSelector!=null&&(r.pointer.selector=t.itemSelector),t.appendTo!=null&&(r.mirror.parentNode=t.appendTo),r.emitter.on("pointerdown",this.handlePointerDown),r.emitter.on("dragstart",this.handleDragStart),new Gb(r,t.eventData)}destroy(){this.dragging.destroy()}};var UR=Xr({name:"@fullcalendar/interaction",componentInteractions:[Vb,Yb,Cu,zb],calendarInteractions:[qb],elementDraggingImpl:ba,optionRefiners:FY,listenerRefiners:BY});var Ms=require("obsidian");var Ve=require("obsidian");Vl();Tg();var $R=require("obsidian"),wg=class{constructor(e){this.menu=new $R.Menu,this.options=e,this.buildMenu()}buildMenu(){this.getStatusOptions().forEach((t,r)=>{this.menu.addItem(s=>{let i=t.label;s.setIcon("circle"),t.value===this.options.currentValue&&(i=`\u2713 ${t.label}`),s.setTitle(i),s.onClick(async()=>{this.options.onSelect(t.value)})})})}getStatusOptions(){let e=this.options.plugin.settings.customStatuses,t=[];return e&&e.length>0&&[...e].sort((s,i)=>s.order-i.order).forEach(s=>{t.push({label:s.label,value:s.value,color:s.color})}),t}capitalizeFirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}show(e){this.menu.showAtMouseEvent(e),setTimeout(()=>{this.applyColorStyling()},10)}showAtElement(e){this.menu.showAtPosition({x:e.getBoundingClientRect().left,y:e.getBoundingClientRect().bottom+4}),setTimeout(()=>{this.applyColorStyling()},10)}applyColorStyling(){let e=this.getStatusOptions(),t=document.querySelector(".menu");if(!t)return;let r=t.querySelectorAll(".menu-item");e.forEach((s,i)=>{let a=r[i];if(a&&s.color){let o=a.querySelector(".menu-item-icon");o&&(o.style.color=s.color)}})}};Bd();var Kb=require("obsidian");dm();var dc=class{constructor(e,t,r,s){this.plugin=e,this.task=t,this.triggerElement=r,this.onUpdate=s}show(e){let t=new Kb.Menu;this.addQuickRemindersSection(t,"due","Remind before due..."),this.addQuickRemindersSection(t,"scheduled","Remind before scheduled..."),t.addSeparator(),t.addItem(r=>{r.setTitle("Manage All Reminders...").setIcon("settings").onClick(()=>{this.openReminderModal()})}),this.task.reminders&&this.task.reminders.length>0&&t.addItem(r=>{r.setTitle("Clear All Reminders").setIcon("trash").onClick(async()=>{await this.clearAllReminders()})}),e?t.showAtMouseEvent(e):t.showAtMouseEvent(new MouseEvent("contextmenu"))}addQuickRemindersSection(e,t,r){if(!(t==="due"?this.task.due:this.task.scheduled)){e.addItem(i=>{i.setTitle(r).setIcon("bell").setDisabled(!0)});return}e.addItem(i=>{i.setTitle(r).setIcon("bell").onClick(a=>{this.showQuickReminderSubmenu(t,a instanceof MouseEvent?a:void 0)})})}showQuickReminderSubmenu(e,t){let r=new Kb.Menu;[{label:"At time of event",offset:"PT0M"},{label:"5 minutes before",offset:"-PT5M"},{label:"15 minutes before",offset:"-PT15M"},{label:"1 hour before",offset:"-PT1H"},{label:"1 day before",offset:"-P1D"}].forEach(i=>{r.addItem(a=>{a.setTitle(i.label).onClick(async()=>{await this.addQuickReminder(e,i.offset,i.label)})})}),t?r.showAtMouseEvent(t):r.showAtMouseEvent(new MouseEvent("contextmenu"))}async addQuickReminder(e,t,r){let s={id:`rem_${Date.now()}`,type:"relative",relatedTo:e,offset:t,description:r},i=[...this.task.reminders||[],s];await this.saveReminders(i)}async clearAllReminders(){await this.saveReminders([])}async saveReminders(e){let t;if(this.task.path&&this.task.path.trim()!==""){let r=await this.plugin.cacheManager.getTaskInfo(this.task.path);r?(t={...r,reminders:e},await this.plugin.taskService.updateProperty(t,"reminders",e)):t={...this.task,reminders:e}}else t={...this.task,reminders:e};this.onUpdate(t)}openReminderModal(){new bi(this.plugin.app,this.plugin,this.task,async t=>{await this.saveReminders(t)}).open()}};Fe();Lt();var uc=class extends Ve.Modal{constructor(t,r){super(t);this.title="";this.details="";this.dueDate="";this.scheduledDate="";this.priority="normal";this.status="open";this.contexts="";this.projects="";this.tags="";this.timeEstimate=0;this.recurrenceRule="";this.reminders=[];this.userFields={};this.selectedProjectFiles=[];this.isExpanded=!1;this.plugin=r}onOpen(){this.containerEl.addClass("tasknotes-plugin","minimalist-task-modal"),this.titleEl.setText(this.getModalTitle());let t=this.titleEl.createSpan("modal-header-icon");(0,Ve.setIcon)(t,"tasknotes-simple"),this.titleEl.insertBefore(t,this.titleEl.firstChild),this.initializeFormData().then(()=>{this.createModalContent(),this.focusTitleInput()})}createModalContent(){let{contentEl:t}=this;t.empty();let r=t.createDiv("minimalist-modal-container");this.createTitleInput(r),this.createActionBar(r),this.createDetailsSection(r),this.createActionButtons(r)}createTitleInput(t){let r=t.createDiv("title-input-container");this.titleInput=r.createEl("input",{type:"text",cls:"title-input",placeholder:"What needs to be done?"}),this.titleInput.value=this.title,this.titleInput.addEventListener("input",s=>{this.title=s.target.value})}createActionBar(t){this.actionBar=t.createDiv("action-bar"),this.createActionIcon(this.actionBar,"calendar","Set due date",(r,s)=>{this.showDateContextMenu(s,"due")},"due-date"),this.createActionIcon(this.actionBar,"calendar-clock","Set scheduled date",(r,s)=>{this.showDateContextMenu(s,"scheduled")},"scheduled-date"),this.createActionIcon(this.actionBar,"dot-square","Set status",(r,s)=>{this.showStatusContextMenu(s)},"status"),this.createActionIcon(this.actionBar,"star","Set priority",(r,s)=>{this.showPriorityContextMenu(s)},"priority"),this.createActionIcon(this.actionBar,"refresh-ccw","Set recurrence",(r,s)=>{this.showRecurrenceContextMenu(s)},"recurrence"),this.createActionIcon(this.actionBar,"bell","Set reminders",(r,s)=>{this.showReminderContextMenu(s)},"reminders"),this.updateIconStates()}createActionIcon(t,r,s,i,a){let o=t.createDiv("action-icon");o.setAttribute("aria-label",s),o.setAttribute("data-initial-tooltip",s),a&&o.setAttribute("data-type",a);let l=o.createSpan("icon");return(0,Ve.setIcon)(l,r),o.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation(),i(o,c)}),o}createDetailsSection(t){this.detailsContainer=t.createDiv("details-container"),this.isExpanded||(this.detailsContainer.style.display="none");let r=this.getModalTitle()==="Edit task",s=this.getModalTitle()==="Create task"&&this.plugin.settings.enableNaturalLanguageInput;if(r||s){let i=this.detailsContainer.createDiv("detail-label");i.textContent="Title";let a=this.detailsContainer.createEl("input",{type:"text",cls:"title-input-detailed",placeholder:"Task title..."});a.value=this.title,a.addEventListener("input",o=>{this.title=o.target.value}),s&&!this.titleInput&&(this.titleInput=a)}if(this.getModalTitle()!=="Edit task"){let i=this.detailsContainer.createDiv("detail-label");i.textContent="Details",this.detailsInput=this.detailsContainer.createEl("textarea",{cls:"details-input",placeholder:"Add more details..."}),this.detailsInput.value=this.details,this.detailsInput.addEventListener("input",a=>{this.details=a.target.value})}this.createAdditionalFields(this.detailsContainer)}createAdditionalFields(t){new Ve.Setting(t).setName("Projects").addButton(r=>{r.setButtonText("Add Project").setTooltip("Select a project note using fuzzy search").onClick(()=>{new El(this.app,this.plugin,i=>{this.addProject(i)}).open()}),r.buttonEl.addClasses(["tn-btn","tn-btn--ghost"])}),this.projectsList=t.createDiv({cls:"task-projects-list"}),new Ve.Setting(t).setName("Contexts").addText(r=>{r.setPlaceholder("context1, context2").setValue(this.contexts).onChange(s=>{this.contexts=s}),this.contextsInput=r.inputEl,new Xb(this.app,r.inputEl,this.plugin)}),new Ve.Setting(t).setName("Tags").addText(r=>{r.setPlaceholder("tag1, tag2").setValue(this.tags).onChange(s=>{this.tags=oa(s)}),this.tagsInput=r.inputEl,new ek(this.app,r.inputEl,this.plugin)}),new Ve.Setting(t).setName("Time estimate (minutes)").addText(r=>{r.setPlaceholder("30").setValue(this.timeEstimate.toString()).onChange(s=>{this.timeEstimate=parseInt(s)||0})}),this.createUserFields(t)}createUserFields(t){var s;let r=((s=this.plugin.settings)==null?void 0:s.userFields)||[];r.length>0&&t.createDiv({cls:"user-fields-separator"}).createDiv({text:"Custom Fields",cls:"detail-label-section"});for(let i of r){if(!i||!i.key||!i.displayName)continue;let a=this.userFields[i.key]||"";switch(i.type){case"boolean":new Ve.Setting(t).setName(i.displayName).addToggle(o=>{o.setValue(a===!0||a==="true").onChange(l=>{this.userFields[i.key]=l})});break;case"number":new Ve.Setting(t).setName(i.displayName).addText(o=>{o.setPlaceholder("0").setValue(a?String(a):"").onChange(l=>{let c=parseFloat(l);this.userFields[i.key]=isNaN(c)?null:c})});break;case"date":new Ve.Setting(t).setName(i.displayName).addText(o=>{o.setPlaceholder("YYYY-MM-DD").setValue(a?String(a):"").onChange(d=>{this.userFields[i.key]=d||null});let l=o.inputEl.parentElement;l&&l.addClass("tn-date-control");let c=l==null?void 0:l.createEl("button",{cls:"user-field-date-picker-btn"});c&&(c.setAttribute("aria-label",`Pick ${i.displayName.toLowerCase()} date`),(0,Ve.setIcon)(c,"calendar"),c.addEventListener("click",d=>{d.preventDefault(),new Kr({currentValue:o.getValue()||void 0,onSelect:h=>{o.setValue(h||""),this.userFields[i.key]=h||null}}).showAtElement(c)}))});break;case"list":new Ve.Setting(t).setName(i.displayName).addText(o=>{var d;let l=Array.isArray(a)?a.join(", "):a?String(a):"";o.setPlaceholder("item1, item2, item3").setValue(l).onChange(u=>{u.trim()?this.userFields[i.key]=u.split(",").map(h=>h.trim()).filter(h=>h):this.userFields[i.key]=null}),new bg(this.app,o.inputEl,this.plugin,i);let c=t.querySelector(".user-field-link-preview");c&&((d=c.detach)==null||d.call(c))});break;case"text":default:new Ve.Setting(t).setName(i.displayName).addText(o=>{o.setPlaceholder(`Enter ${i.displayName.toLowerCase()}...`).setValue(a?String(a):"").onChange(l=>{this.userFields[i.key]=l||null}),new bg(this.app,o.inputEl,this.plugin,i)});break}}}createActionButtons(t){let r=t.createDiv("button-container");this.getModalTitle()==="Edit task"&&(r.createEl("button",{cls:"open-note-button",text:"Open note"}).addEventListener("click",async()=>{await this.openTaskNote()}),r.createDiv("button-spacer")),r.createEl("button",{cls:"save-button",text:"Save"}).addEventListener("click",async()=>{await this.handleSave(),this.close()}),r.createEl("button",{cls:"cancel-button",text:"Cancel"}).addEventListener("click",()=>{this.close()})}expandModal(){this.isExpanded||(this.isExpanded=!0,this.detailsContainer.style.display="block",this.containerEl.addClass("expanded"),this.detailsContainer.style.opacity="0",this.detailsContainer.style.transform="translateY(-10px)",setTimeout(()=>{this.detailsContainer.style.opacity="1",this.detailsContainer.style.transform="translateY(0)"},50))}showDateContextMenu(t,r){let s=r==="due"?this.dueDate:this.scheduledDate,i=r==="due"?"Set Due Date":"Set Scheduled Date";new Kr({currentValue:s?ve(s):void 0,currentTime:s?Er(s):void 0,title:i,onSelect:(o,l)=>{if(o){let c=l?Fr(o,l):o;r==="due"?this.dueDate=c:this.scheduledDate=c}else r==="due"?this.dueDate="":this.scheduledDate="";this.updateDateIconState()}}).show(t)}showStatusContextMenu(t){new wg({currentValue:this.status,onSelect:s=>{this.status=s,this.updateStatusIconState()},plugin:this.plugin}).show(t)}showPriorityContextMenu(t){new Pi({currentValue:this.priority,onSelect:s=>{this.priority=s,this.updatePriorityIconState()},plugin:this.plugin}).show(t)}showRecurrenceContextMenu(t){new Wn({currentValue:this.recurrenceRule,onSelect:s=>{this.recurrenceRule=s||"",this.updateRecurrenceIconState()},app:this.app}).show(t)}showReminderContextMenu(t){let r={title:this.title,status:this.status,priority:this.priority,due:this.dueDate,scheduled:this.scheduledDate,path:"",archived:!1,reminders:this.reminders};new dc(this.plugin,r,t.target,i=>{this.reminders=i.reminders||[],this.updateReminderIconState()}).show(t)}updateDateIconState(){this.updateIconStates()}updateStatusIconState(){this.updateIconStates()}updatePriorityIconState(){this.updateIconStates()}updateRecurrenceIconState(){this.updateIconStates()}updateReminderIconState(){this.updateIconStates()}getDefaultStatus(){let t=this.plugin.settings.customStatuses;return t&&t.length>0?[...t].sort((s,i)=>s.order-i.order)[0].value:"open"}getDefaultPriority(){let t=this.plugin.settings.customPriorities;return t&&t.length>0?[...t].sort((s,i)=>s.weight-i.weight)[0].value:"normal"}getRecurrenceDisplayText(){if(!this.recurrenceRule)return"";let t=this.recurrenceRule;if(t.includes("FREQ=DAILY"))return"Daily";if(t.includes("FREQ=WEEKLY")){if(t.includes("INTERVAL=2"))return"Every 2 weeks";if(t.includes("BYDAY=MO,TU,WE,TH,FR"))return"Weekdays";if(t.includes("BYDAY=")){let s=t.match(/BYDAY=([A-Z]{2})/);return s?`Weekly on ${{SU:"Sunday",MO:"Monday",TU:"Tuesday",WE:"Wednesday",TH:"Thursday",FR:"Friday",SA:"Saturday"}[s[1]]||s[1]}`:"Weekly"}else return"Weekly"}else if(t.includes("FREQ=MONTHLY")){if(t.includes("INTERVAL=3"))return"Every 3 months";if(t.includes("BYMONTHDAY=")){let s=t.match(/BYMONTHDAY=(\d+)/);return s?`Monthly on the ${this.getOrdinal(parseInt(s[1]))}`:"Monthly"}else return t.includes("BYDAY=")?"Monthly (by weekday)":"Monthly"}else if(t.includes("FREQ=YEARLY")){if(t.includes("BYMONTH=")&&t.includes("BYMONTHDAY=")){let s=t.match(/BYMONTH=(\d+)/),i=t.match(/BYMONTHDAY=(\d+)/);if(s&&i){let o=["","January","February","March","April","May","June","July","August","September","October","November","December"][parseInt(s[1])],l=this.getOrdinal(parseInt(i[1]));return`Yearly on ${o} ${l}`}}return"Yearly"}let r="";if(t.includes("COUNT=")){let s=t.match(/COUNT=(\d+)/);s&&(r=` (${s[1]} times)`)}else if(t.includes("UNTIL=")){let s=t.match(/UNTIL=(\d{8})/);if(s){let i=s[1];r=` (until ${`${i.slice(0,4)}-${i.slice(4,6)}-${i.slice(6,8)}`})`}}return"Custom"+r}getOrdinal(t){let r=["th","st","nd","rd"],s=t%100;return t+(r[(s-20)%10]||r[s]||r[0])}updateIconStates(){if(!this.actionBar)return;let t=this.actionBar.querySelector('[data-type="due-date"]');t&&(this.dueDate?(t.classList.add("has-value"),(0,Ve.setTooltip)(t,`Due: ${this.dueDate}`,{placement:"top"})):(t.classList.remove("has-value"),(0,Ve.setTooltip)(t,"Set due date",{placement:"top"})));let r=this.actionBar.querySelector('[data-type="scheduled-date"]');r&&(this.scheduledDate?(r.classList.add("has-value"),(0,Ve.setTooltip)(r,`Scheduled: ${this.scheduledDate}`,{placement:"top"})):(r.classList.remove("has-value"),(0,Ve.setTooltip)(r,"Set scheduled date",{placement:"top"})));let s=this.actionBar.querySelector('[data-type="status"]');if(s){let l=this.plugin.settings.customStatuses.find(u=>u.value===this.status),c=l?l.label:this.status;this.status&&l&&l.value!==this.getDefaultStatus()?(s.classList.add("has-value"),(0,Ve.setTooltip)(s,`Status: ${c}`,{placement:"top"})):(s.classList.remove("has-value"),(0,Ve.setTooltip)(s,"Set status",{placement:"top"}));let d=s.querySelector(".icon");d&&l&&l.color?d.style.color=l.color:d&&(d.style.color="")}let i=this.actionBar.querySelector('[data-type="priority"]');if(i){let l=this.plugin.settings.customPriorities.find(u=>u.value===this.priority),c=l?l.label:this.priority;this.priority&&l&&l.value!==this.getDefaultPriority()?(i.classList.add("has-value"),(0,Ve.setTooltip)(i,`Priority: ${c}`,{placement:"top"})):(i.classList.remove("has-value"),(0,Ve.setTooltip)(i,"Set priority",{placement:"top"}));let d=i.querySelector(".icon");d&&l&&l.color?d.style.color=l.color:d&&(d.style.color="")}let a=this.actionBar.querySelector('[data-type="recurrence"]');a&&(this.recurrenceRule&&this.recurrenceRule.trim()?(a.classList.add("has-value"),(0,Ve.setTooltip)(a,`Recurrence: ${this.getRecurrenceDisplayText()}`,{placement:"top"})):(a.classList.remove("has-value"),(0,Ve.setTooltip)(a,"Set recurrence",{placement:"top"})));let o=this.actionBar.querySelector('[data-type="reminders"]');if(o)if(this.reminders&&this.reminders.length>0){o.classList.add("has-value");let l=this.reminders.length,c=l===1?"1 reminder set":`${l} reminders set`;(0,Ve.setTooltip)(o,c,{placement:"top"})}else o.classList.remove("has-value"),(0,Ve.setTooltip)(o,"Set reminders",{placement:"top"})}focusTitleInput(){setTimeout(()=>{this.titleInput.focus(),this.titleInput.select()},100)}addProject(t){this.selectedProjectFiles.some(r=>r.path===t.path)||(this.selectedProjectFiles.push(t),this.updateProjectsFromFiles(),this.renderProjectsList())}removeProject(t){this.selectedProjectFiles=this.selectedProjectFiles.filter(r=>r.path!==t.path),this.updateProjectsFromFiles(),this.renderProjectsList()}updateProjectsFromFiles(){let t=this.app.workspace.getActiveFile(),r=(t==null?void 0:t.path)||"";this.projects=this.selectedProjectFiles.map(s=>`[[${this.app.metadataCache.fileToLinktext(s,r,!0)}]]`).join(", ")}initializeProjectsFromStrings(t){this.selectedProjectFiles=[];for(let r of t){if(!r||typeof r!="string"||r.trim()==="")continue;let s=r.match(/^\[\[([^\]]+)\]\]$/);if(s){let i=s[1],a=this.app.metadataCache.getFirstLinkpathDest(i,"");a&&this.selectedProjectFiles.push(a)}else{let a=this.app.vault.getMarkdownFiles().find(o=>o.basename===r||o.name===r+".md");a&&this.selectedProjectFiles.push(a)}}this.updateProjectsFromFiles()}renderProjectsList(){this.projectsList&&(this.projectsList.empty(),this.selectedProjectFiles.length!==0&&this.selectedProjectFiles.forEach(t=>{let r=this.projectsList.createDiv({cls:"task-project-item"}),s=r.createDiv({cls:"task-project-info"}),i=s.createSpan({cls:"task-project-name"});if(i.textContent=t.name,t.path!==t.name){let o=s.createDiv({cls:"task-project-path"});o.textContent=t.path}let a=r.createEl("button",{cls:"task-project-remove",text:"\xD7"});(0,Ve.setTooltip)(a,"Remove project",{placement:"top"}),a.addEventListener("click",()=>{this.removeProject(t)})}))}validateForm(){return this.title.trim().length>0}},Xb=class extends Ve.AbstractInputSuggest{constructor(e,t,r){super(e,t),this.plugin=r,this.input=t}async getSuggestions(e){let t=this.input.value.split(",").map(i=>i.trim()),r=t[t.length-1];return r?this.plugin.cacheManager.getAllContexts().filter(i=>i&&typeof i=="string").filter(i=>i.toLowerCase().includes(r.toLowerCase())&&!t.slice(0,-1).includes(i)).slice(0,10).map(i=>({value:i,display:i,type:"context",toString(){return this.value}})):[]}renderSuggestion(e,t){t.textContent=e.display}selectSuggestion(e){let t=this.input.value.split(",").map(r=>r.trim());t[t.length-1]=e.value,this.input.value=t.join(", ")+", ",this.input.dispatchEvent(new Event("input",{bubbles:!0})),this.input.focus()}},ek=class extends Ve.AbstractInputSuggest{constructor(e,t,r){super(e,t),this.plugin=r,this.input=t}async getSuggestions(e){let t=this.input.value.split(",").map(i=>i.trim()),r=t[t.length-1];return r?this.plugin.cacheManager.getAllTags().filter(i=>i&&typeof i=="string").filter(i=>i.toLowerCase().includes(r.toLowerCase())&&!t.slice(0,-1).includes(i)).slice(0,10).map(i=>({value:i,display:i,type:"tag",toString(){return this.value}})):[]}renderSuggestion(e,t){t.textContent=e.display}selectSuggestion(e){let t=this.input.value.split(",").map(r=>r.trim());t[t.length-1]=e.value,this.input.value=t.join(", ")+", ",this.input.dispatchEvent(new Event("input",{bubbles:!0})),this.input.focus()}},bg=class extends Ve.AbstractInputSuggest{constructor(e,t,r,s){super(e,t),this.plugin=r,this.input=t,this.fieldConfig=s}async getSuggestions(e){let t=this.fieldConfig.type==="list",r="",s=[];if(t?(s=this.input.value.split(",").map(o=>o.trim()),r=s[s.length-1]||""):r=this.input.value.trim(),!r)return[];let i=r.match(/\[\[([^\]]*)$/);if(i){let o=i[1]||"",{FileSuggestHelper:l}=await Promise.resolve().then(()=>(Jb(),Zb));return(await l.suggest(this.plugin,o)).map(d=>({value:d.insertText,display:d.displayText,type:"user-field",fieldKey:this.fieldConfig.key,toString(){return this.value}}))}return(await this.getExistingUserFieldValues(this.fieldConfig.key)).filter(o=>o&&typeof o=="string").filter(o=>o.toLowerCase().includes(r.toLowerCase())&&(!t||!s.slice(0,-1).includes(o))).slice(0,10).map(o=>({value:o,display:o,type:"user-field",fieldKey:this.fieldConfig.key,toString(){return this.value}}))}async getExistingUserFieldValues(e){var s,i;let t=async()=>{try{let a=this.plugin.app.vault.getMarkdownFiles(),o=new Set;for(let l of a)try{let c=this.plugin.app.metadataCache.getFileCache(l),d=c==null?void 0:c.frontmatter;if(d&&d[e]!==void 0){let u=d[e];Array.isArray(u)?u.forEach(h=>{typeof h=="string"&&h.trim()&&o.add(h.trim())}):typeof u=="string"&&u.trim()?o.add(u.trim()):(typeof u=="number"||typeof u=="boolean")&&o.add(u.toString())}if(o.size>=200)break}catch(c){continue}return Array.from(o).sort()}catch(a){return console.error("Error getting user field values:",a),[]}},r=(i=(s=this.plugin.settings)==null?void 0:s.suggestionDebounceMs)!=null?i:0;return r?new Promise(a=>{let o=this.plugin;o.__userFieldSuggestTimer&&clearTimeout(o.__userFieldSuggestTimer),o.__userFieldSuggestTimer=setTimeout(async()=>{let l=await t();a(l)},r)}):t()}renderSuggestion(e,t){t.textContent=e.display}selectSuggestion(e){var r;if(this.fieldConfig.type==="list"){let s=this.input.value.split(","),i=(r=s.pop())!=null?r:"",a=s.join(","),o=i.trim(),l=/\[\[/.test(o)?o.replace(/\[\[[^\]]*$/,`[[${e.value}]]`):e.value,c=(a?a+", ":"")+l;this.input.value=c.endsWith(",")?c+" ":c+", "}else{let s=this.input.value,i=s.replace(/\[\[[^\]]*$/,`[[${e.value}]]`);this.input.value=i===s?e.value:i}this.input.dispatchEvent(new Event("input",{bubbles:!0})),this.input.focus()}};Fe();At();var tk=require("obsidian");function YR(n,e){if(!n||!e)throw new Error("Invalid context or settings provided");if(!n.title||typeof n.title!="string")throw new Error("Context must have a valid title");if(n.title.trim().length===0)throw new Error("Title cannot be empty");let t=n.date||new Date;if(!(t instanceof Date)||isNaN(t.getTime()))throw new Error("Invalid date provided in context");try{let r=e.icsIntegration;if(r)switch(r.icsNoteFilenameFormat){case"title":return _r(n.title);case"zettel":return Io(t);case"timestamp":return zR(t);case"custom":{let s={icsEventTitle:n.icsEventTitle?_r(n.icsEventTitle):_r(n.title),icsEventLocation:n.icsEventLocation?_r(n.icsEventLocation):"",icsEventDescription:n.icsEventDescription?_r(n.icsEventDescription.substring(0,50)):"",icsEventTitleWithDate:_r(`${n.icsEventTitle||n.title} - ${x(t,"PPP")}`)};return qR(n,r.customICSNoteFilenameTemplate,t,s)}default:return _r(n.title)}return _r(n.title)}catch(r){return console.error("Error generating ICS note filename:",r),_r(n.title)}}function kg(n,e){if(!n||!e)throw new Error("Invalid context or settings provided");if(!n.title||typeof n.title!="string")throw new Error("Context must have a valid title");if(n.title.trim().length===0)throw new Error("Title cannot be empty");let t=n.date||new Date;if(!(t instanceof Date)||isNaN(t.getTime()))throw new Error("Invalid date provided in context");if(e.storeTitleInFilename)return _r(n.title);try{switch(e.taskFilenameFormat){case"title":return _r(n.title);case"zettel":return Io(t);case"timestamp":return zR(t);case"custom":return qR(n,e.customFilenameTemplate,t);default:return Io(t)}}catch(r){return console.error("Error generating filename:",r),Io(t)}}function Io(n){let e=x(n,"yyMMdd"),t=new Date(n);t.setHours(0,0,0,0);let s=Math.floor((n.getTime()-t.getTime())/1e3).toString(36);return`${e}${s}`}function zR(n){return x(n,"yyyy-MM-dd-HHmmss")}function qR(n,e,t,r){if(!n||!e||!t)throw new Error("Invalid inputs for custom filename generation");if(typeof e!="string"||e.trim().length===0)throw new Error("Template must be a non-empty string");if(!(t instanceof Date)||isNaN(t.getTime()))throw new Error("Invalid date for filename generation");try{let s=_r(n.title),i=n.priority&&["low","normal","medium","high"].includes(n.priority)?n.priority:"normal",a=n.status&&["open","in-progress","done","scheduled"].includes(n.status)?n.status:"open",o={title:s,date:x(t,"yyyy-MM-dd"),time:x(t,"HHmmss"),priority:i,status:a,timestamp:x(t,"yyyy-MM-dd-HHmmss"),dateTime:x(t,"yyyy-MM-dd-HHmm"),year:x(t,"yyyy"),month:x(t,"MM"),day:x(t,"dd"),hour:x(t,"HH"),minute:x(t,"mm"),second:x(t,"ss"),dueDate:n.dueDate||"",scheduledDate:n.scheduledDate||"",shortDate:x(t,"yyMMdd"),monthName:x(t,"MMMM"),monthNameShort:x(t,"MMM"),dayName:x(t,"EEEE"),dayNameShort:x(t,"EEE"),week:x(t,"ww"),quarter:x(t,"q"),time12:x(t,"hh:mm a"),time24:x(t,"HH:mm"),hourPadded:x(t,"HH"),hour12:x(t,"hh"),ampm:x(t,"a"),unix:Math.floor(t.getTime()/1e3).toString(),unixMs:t.getTime().toString(),milliseconds:x(t,"SSS"),ms:x(t,"SSS"),timezone:x(t,"xxx"),timezoneShort:x(t,"xx"),utcOffset:x(t,"xxx"),utcOffsetShort:x(t,"xx"),utcZ:"Z",priorityShort:i.substring(0,1).toUpperCase(),statusShort:a.substring(0,1).toUpperCase(),titleLower:s.toLowerCase(),titleUpper:s.toUpperCase(),titleSnake:s.toLowerCase().replace(/\s+/g,"_"),titleKebab:s.toLowerCase().replace(/\s+/g,"-"),titleCamel:s.replace(/(?:^\w|[A-Z]|\b\w)/g,(c,d)=>d===0?c.toLowerCase():c.toUpperCase()).replace(/\s+/g,""),titlePascal:s.replace(/(?:^\w|[A-Z]|\b\w)/g,c=>c.toUpperCase()).replace(/\s+/g,""),zettel:Io(t),nano:Date.now().toString()+Math.random().toString(36).substring(2,7),...r||{}},l=e;if(e.length>500)throw new Error("Template too long");return Object.entries(o).forEach(([c,d])=>{try{let u=new RegExp(`\\{${c}\\}`,"g");l=l.replace(u,d)}catch(u){console.warn(`Error replacing template variable ${c}:`,u)}}),l=l.replace(/\{[^}]+\}/g,""),l.trim()||(l=s||Io(t)),_r(l)}catch(s){return console.error("Error generating custom filename:",s),_r(n.title)||Io(t)}}function _r(n){if(!n||typeof n!="string")return"untitled";try{let e=n.trim().replace(/\s+/g," ").replace(/[<>:"/\\|?*#\[\]]/g,"").replace(/./g,r=>{let s=r.charCodeAt(0);return s<=31||s>=127&&s<=159?"":r}).replace(/^\.+|\.+$/g,"").trim();return(!e||e.length===0)&&(e="untitled"),["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"].includes(e.toUpperCase())&&(e=`task-${e}`),e}catch(e){return console.error("Error sanitizing filename:",e),"untitled"}}async function Mu(n,e,t){if(!n||typeof n!="string")throw new Error("Base filename must be a non-empty string");if(typeof e!="string")throw new Error("Folder path must be a string");if(!t)throw new Error("Vault must be provided");let r=_r(n);if(!r)throw new Error("Base filename cannot be sanitized to a valid name");let s=e.replace(/\.\./g,"").trim();try{let i=(0,tk.normalizePath)(`${s}/${r}.md`);if(i.length>260)throw new Error("Generated path too long");if(!t.getAbstractFileByPath(i))return r;for(let l=2;l<=999;l++){let c=`${r}-${l}`,d=(0,tk.normalizePath)(`${s}/${c}.md`);if(d.length>260)break;if(!t.getAbstractFileByPath(d))return c}let a=Date.now().toString(36),o=`${r.substring(0,50)}-${a}`;return _r(o)}catch(i){return console.error("Error generating unique filename:",i),`task-${Date.now().toString(36)}`}}Lt();$f();$f();var jf=class{constructor(e,t,r,s="en"){this.nlpParser=new ei(e,t,r,s)}extractTaskDataFromInput(e){return this.nlpParser.parseInput(e)}getStatusSuggestions(e,t,r=10){let s=e.toLowerCase();return t.filter(i=>i&&typeof i.value=="string"&&typeof i.label=="string").filter(i=>i.value.trim()!==""&&i.label.trim()!=="").filter(i=>i.value.toLowerCase().includes(s)||i.label.toLowerCase().includes(s)).slice(0,r).map(i=>({value:i.value,label:i.label,display:i.label,type:"status",toString(){return this.value}}))}hasStatusTrigger(e,t,r){return t.trim()?e.slice(0,r).lastIndexOf(t)!==-1:!1}extractQueryAfterTrigger(e,t,r){if(!t.trim())return"";let s=e.slice(0,r),i=s.lastIndexOf(t);if(i===-1)return"";let a=i+t.length,l=s.slice(a).match(/^[^\s@#+]*/);return l?l[0]:""}applyStatusSelection(e,t,r,s){if(!t.trim())return{newText:e,newCursorPos:r};let i=e.slice(0,r),a=e.slice(r),o=i.lastIndexOf(t);if(o===-1)return{newText:e,newCursorPos:r};let l=e.slice(0,o),c=s.label,d=l+c+a,u=o+c.length;return{newText:d,newCursorPos:u}}isValidStatusContext(e,t){return!((e.slice(0,t).match(/"/g)||[]).length%2===1)}};Fe();Sl();Pp();var aS=class extends Ms.AbstractInputSuggest{constructor(t,r,s){super(t,r);this.currentTrigger=null;this.plugin=s,this.textarea=r,this.obsidianApp=t}async getSuggestions(t){var g,y,T,w,b,S;let r=this.textarea.selectionStart,s=this.textarea.value.slice(0,r),i=s.lastIndexOf("@"),a=s.lastIndexOf("#"),o=s.lastIndexOf("+"),l=(this.plugin.settings.statusSuggestionTrigger||"").trim(),c=l?s.lastIndexOf(l):-1,d=-1,u=null,h=k=>{if(k===-1)return!1;if(k===0)return!0;let D=s[k-1];return!/\w/.test(D)},f=[{type:"@",index:i},{type:"#",index:a},{type:"+",index:o},{type:"status",index:c}].filter(k=>h(k.index));if(f.length===0)return this.currentTrigger=null,[];f.sort((k,D)=>D.index-k.index),d=f[0].index,u=f[0].type;let p=u==="status"?(l==null?void 0:l.length)||0:1,m=s.slice(d+p);if(u==="+"&&/^\[\[[^\]]*\]\]/.test(m))return this.currentTrigger=null,[];if((u==="@"||u==="#"||u==="status")&&(m.includes(" ")||m.includes(`
`)))return this.currentTrigger=null,[];if(this.currentTrigger=u,u==="@")return this.plugin.cacheManager.getAllContexts().filter(D=>D&&typeof D=="string").filter(D=>D.toLowerCase().includes(m.toLowerCase())).slice(0,10).map(D=>({value:D,display:D,type:"context",toString(){return this.value}}));if(u==="status")return new jf(this.plugin.settings.customStatuses,this.plugin.settings.customPriorities,this.plugin.settings.nlpDefaultToScheduled,this.plugin.settings.nlpLanguage).getStatusSuggestions(m,this.plugin.settings.customStatuses||[],10);if(u==="#")return this.plugin.cacheManager.getAllTags().filter(D=>D&&typeof D=="string").filter(D=>D.toLowerCase().includes(m.toLowerCase())).slice(0,10).map(D=>({value:D,display:D,type:"tag",toString(){return this.value}}));if(u==="+"){let{FileSuggestHelper:k}=await Promise.resolve().then(()=>(Jb(),Zb)),D=(this.plugin.settings.excludedFolders||"").split(",").map(j=>j.trim()).filter(Boolean),_=(await k.suggest(this.plugin,m)).filter(j=>{var C,P,U;let R=(U=(C=this.obsidianApp)!=null?C:this.app)!=null?U:(P=this.plugin)==null?void 0:P.app,O=R==null?void 0:R.vault.getMarkdownFiles().find(H=>H.basename===j.insertText);return O?!D.some(H=>O.path.startsWith(H)):!0}),W=(T=(g=this.obsidianApp)!=null?g:this.app)!=null?T:(y=this.plugin)==null?void 0:y.app;try{let j=new eo({getFrontmatter:O=>{let C=W==null?void 0:W.vault.getAbstractFileByPath(O.path),P=C?W==null?void 0:W.metadataCache.getFileCache(C):void 0;return(P==null?void 0:P.frontmatter)||{}}}),R=((S=(b=(w=this.plugin.settings)==null?void 0:w.projectAutosuggest)==null?void 0:b.rows)!=null?S:[]).slice(0,3);return _.map(O=>{var ct;let C=W==null?void 0:W.vault.getMarkdownFiles().find(Ne=>Ne.basename===O.insertText);if(!C)return{basename:O.insertText,displayName:O.displayText,type:"project",toString(){return this.basename}};let P=W==null?void 0:W.metadataCache.getFileCache(C),U=(P==null?void 0:P.frontmatter)||{},H=this.plugin.fieldMapper.mapFromFrontmatter(U,C.path,this.plugin.settings.storeTitleInFilename),Y=typeof H.title=="string"?H.title:"",z=(0,Ms.parseFrontMatterAliases)(U)||[],ne=Array.isArray(z)?z.filter(Ne=>typeof Ne=="string"):[],le={basename:C.basename,name:C.name,path:C.path,parent:((ct=C.parent)==null?void 0:ct.path)||"",title:Y,aliases:ne,frontmatter:U},we=((Ne,Mn,X)=>{var pt;let ae=[];for(let Ut of Ne)try{let _n=Xi(Ut),on=[];for(let Ki of _n){if(Ki.property.startsWith("literal:")){on.push(Ki.property.slice(8));continue}let Va=X.resolve(Ki.property,Mn)||"";if(Va)if(Ki.showName){let up=(pt=Ki.displayName)!=null?pt:Ki.property;on.push(`${up}: ${Va}`)}else on.push(Va)}let ed=on.join(" ");ed.trim()&&ae.push(ed)}catch(_n){}return ae.join(" | ")||C.basename})(R,le,j);return{basename:O.insertText,displayName:we,type:"project",entry:{basename:le.basename,name:le.name,path:le.path,parent:le.parent,title:le.title,aliases:le.aliases,frontmatter:le.frontmatter},toString(){return this.basename}}})}catch(j){return console.error("Enhanced project autosuggest failed, falling back to basic suggestions",j),_.map(R=>({basename:R.insertText,displayName:R.displayText,type:"project",toString(){return this.basename}}))}}return[]}renderSuggestion(t,r){var l,c,d,u,h;let s=r.createSpan("nlp-suggest-icon");s.textContent=this.currentTrigger==="status"?this.plugin.settings.statusSuggestionTrigger||"":this.currentTrigger||"";let i=r.createSpan("nlp-suggest-text"),a=(f,p)=>{if(!p)return;let m=p.toLowerCase().split(/\s+/).filter(Boolean);if(!m.length)return;let g=y=>{var T;if(y.nodeType===Node.TEXT_NODE){let w=y.nodeValue||"",b=w.toLowerCase(),S=[];for(let _ of m){let W=b.indexOf(_);for(;W!==-1;)S.push({start:W,end:W+_.length}),W=b.indexOf(_,W+1)}S.sort((_,W)=>_.start-W.start);let k=[];for(let _ of S)(!k.length||_.start>=k[k.length-1].end)&&k.push(_);if(!k.length)return;let D=document.createDocumentFragment(),M=0;for(let _ of k){_.start>M&&D.appendChild(document.createTextNode(w.slice(M,_.start)));let W=document.createElement("mark");W.textContent=w.slice(_.start,_.end),D.appendChild(W),M=_.end}M<w.length&&D.appendChild(document.createTextNode(w.slice(M))),(T=y.parentNode)==null||T.replaceChild(D,y)}else if(y.nodeType===Node.ELEMENT_NODE&&y.tagName!=="MARK"){let w=Array.from(y.childNodes);for(let b of w)g(b)}};g(f)},o="";if(this.currentTrigger==="+"){let f=this.textarea.selectionStart,p=this.textarea.value.slice(0,f),m=p.lastIndexOf("+");if(m!==-1){let g=p.slice(m+1);g&&!g.includes(`
`)&&(o=g.trim())}}if(t.type==="project"){let f=i.createDiv({cls:"nlp-suggest-project__filename",text:t.basename});o&&a(f,o);let p=((d=(c=(l=this.plugin.settings)==null?void 0:l.projectAutosuggest)==null?void 0:c.rows)!=null?d:[]).slice(0,3);if(Array.isArray(p)&&p.length>0&&t.entry){let m=new eo({getFrontmatter:g=>g.frontmatter});for(let g=0;g<Math.min(p.length,3);g++){let y=p[g];if(y)try{let T=Xi(y),w=i.createDiv({cls:"nlp-suggest-project__meta"}),b=new Set(["title","aliases","file.basename"]),S=!1;for(let k of T){if(k.property.startsWith("literal:")){let W=k.property.slice(8);W&&(w.childNodes.length&&w.appendChild(document.createTextNode(" ")),w.appendChild(document.createTextNode(W)),S=!0);continue}let D=m.resolve(k.property,t.entry);if(!D)continue;if(w.childNodes.length&&w.appendChild(document.createTextNode(" ")),k.showName){let W=document.createElement("span");W.className="nlp-suggest-project__meta-label",W.textContent=`${(u=k.displayName)!=null?u:k.property}:`,w.appendChild(W),w.appendChild(document.createTextNode(" "))}let M=document.createElement("span");M.className="nlp-suggest-project__meta-value",M.textContent=D,w.appendChild(M),S=!0;let _=k.searchable===!0||b.has(k.property);o&&_&&a(M,o)}(!S||((h=w.textContent)==null?void 0:h.trim().length)===0)&&w.remove()}catch(T){}}}}else t.type,i.textContent=t.display}selectSuggestion(t){if(!this.currentTrigger)return;let r=this.textarea.selectionStart,s=this.textarea.value.slice(0,r),i=this.textarea.value.slice(r),a=-1,o=(this.plugin.settings.statusSuggestionTrigger||"").trim();if(this.currentTrigger==="@"?a=s.lastIndexOf("@"):this.currentTrigger==="#"?a=s.lastIndexOf("#"):this.currentTrigger==="+"?a=s.lastIndexOf("+"):this.currentTrigger==="status"&&o&&(a=s.lastIndexOf(o)),a===-1)return;let l=t.type==="project"?t.basename:t.value,c=s.slice(0,a),d="";this.currentTrigger==="+"?d="+[["+l+"]]":this.currentTrigger==="status"?d=t.type==="status"?t.label:l:d=this.currentTrigger+l;let u=c+d+(d?" ":"")+i;this.textarea.value=u;let h=c.length+d.length+(d?1:0);this.textarea.setSelectionRange(h,h),this.textarea.dispatchEvent(new Event("input",{bubbles:!0})),this.textarea.focus()}},el=class extends uc{constructor(e,t,r={},s){super(e,t),this.options=r,this.nlParser=new ei(t.settings.customStatuses,t.settings.customPriorities,t.settings.nlpDefaultToScheduled,t.settings.nlpLanguage),this.statusSuggestionService=s||new jf(t.settings.customStatuses,t.settings.customPriorities,t.settings.nlpDefaultToScheduled,t.settings.nlpLanguage)}getModalTitle(){return"Create task"}createModalContent(){let{contentEl:e}=this;e.empty();let t=e.createDiv("minimalist-modal-container");this.plugin.settings.enableNaturalLanguageInput?this.createNaturalLanguageInput(t):(this.createTitleInput(t),this.isExpanded=!0,this.containerEl.addClass("expanded")),this.createActionBar(t),this.createDetailsSection(t),(this.options.prePopulatedValues&&this.options.prePopulatedValues.projects||this.selectedProjectFiles.length>0)&&this.renderProjectsList(),this.createActionButtons(t)}createNaturalLanguageInput(e){let t=e.createDiv("nl-input-container");this.nlInput=t.createEl("textarea",{cls:"nl-input",attr:{placeholder:`Buy groceries tomorrow at 3pm @home #errands

Add details here...`,rows:"3"}}),this.nlPreviewContainer=t.createDiv("nl-preview-container"),this.nlInput.addEventListener("input",()=>{let r=this.nlInput.value.trim();r?this.updateNaturalLanguagePreview(r):this.clearNaturalLanguagePreview()}),this.nlInput.addEventListener("keydown",r=>{let s=this.nlInput.value.trim();s&&(r.key==="Enter"&&(r.ctrlKey||r.metaKey)?(r.preventDefault(),this.handleSave()):r.key==="Tab"&&r.shiftKey&&(r.preventDefault(),this.parseAndFillForm(s)))}),this.nlpSuggest=new aS(this.app,this.nlInput,this.plugin),setTimeout(()=>{this.nlInput.focus()},100)}updateNaturalLanguagePreview(e){if(!this.nlPreviewContainer)return;let t=this.nlParser.parseInput(e),r=this.nlParser.getPreviewData(t);r.length>0&&t.title?(this.nlPreviewContainer.empty(),this.nlPreviewContainer.style.display="block",r.forEach(s=>{let i=this.nlPreviewContainer.createDiv("nl-preview-item");i.textContent=s.text})):this.clearNaturalLanguagePreview()}clearNaturalLanguagePreview(){this.nlPreviewContainer&&(this.nlPreviewContainer.empty(),this.nlPreviewContainer.style.display="none")}createActionBar(e){if(this.actionBar=e.createDiv("action-bar"),this.plugin.settings.enableNaturalLanguageInput){this.createActionIcon(this.actionBar,"wand","Fill form from natural language",(r,s)=>{var a;let i=(a=this.nlInput)==null?void 0:a.value.trim();i&&this.parseAndFillForm(i)}),this.createActionIcon(this.actionBar,this.isExpanded?"chevron-up":"chevron-down",this.isExpanded?"Hide detailed options":"Show detailed options",(r,s)=>{this.toggleDetailedForm();let i=r.querySelector(".icon");i&&(0,Ms.setIcon)(i,this.isExpanded?"chevron-up":"chevron-down"),(0,Ms.setTooltip)(r,this.isExpanded?"Hide detailed options":"Show detailed options",{placement:"top"})});let t=this.actionBar.createDiv("action-separator");t.style.width="1px",t.style.height="24px",t.style.backgroundColor="var(--background-modifier-border)",t.style.margin="0 var(--size-4-2)"}this.createActionIcon(this.actionBar,"calendar","Set due date",(t,r)=>{this.showDateContextMenu(r,"due")},"due-date"),this.createActionIcon(this.actionBar,"calendar-clock","Set scheduled date",(t,r)=>{this.showDateContextMenu(r,"scheduled")},"scheduled-date"),this.createActionIcon(this.actionBar,"dot-square","Set status",(t,r)=>{this.showStatusContextMenu(r)},"status"),this.createActionIcon(this.actionBar,"star","Set priority",(t,r)=>{this.showPriorityContextMenu(r)},"priority"),this.createActionIcon(this.actionBar,"refresh-ccw","Set recurrence",(t,r)=>{this.showRecurrenceContextMenu(r)},"recurrence"),this.createActionIcon(this.actionBar,"bell","Set reminders",(t,r)=>{this.showReminderContextMenu(r)},"reminders"),this.updateIconStates()}parseAndFillForm(e){let t=this.statusSuggestionService.extractTaskDataFromInput(e);this.applyParsedData(t),this.isExpanded||this.expandModal()}applyParsedData(e){e.title&&(this.title=e.title),e.status&&(this.status=e.status),e.priority&&(this.priority=e.priority),e.dueDate&&(this.dueDate=e.dueTime?Fr(e.dueDate,e.dueTime):e.dueDate),e.scheduledDate&&(this.scheduledDate=e.scheduledTime?Fr(e.scheduledDate,e.scheduledTime):e.scheduledDate),e.contexts&&e.contexts.length>0&&(this.contexts=e.contexts.join(", ")),e.tags&&e.tags.length>0&&(this.tags=oa(e.tags.join(", "))),e.details&&(this.details=e.details),e.recurrence&&(this.recurrenceRule=e.recurrence),this.titleInput&&(this.titleInput.value=this.title),this.detailsInput&&(this.detailsInput.value=this.details),this.contextsInput&&(this.contextsInput.value=this.contexts),this.tagsInput&&(this.tagsInput.value=this.tags),e.projects&&e.projects.length>0&&(this.initializeProjectsFromStrings(e.projects),this.renderProjectsList()),this.updateIconStates()}toggleDetailedForm(){this.isExpanded?(this.isExpanded=!1,this.detailsContainer.style.display="none",this.containerEl.removeClass("expanded")):this.expandModal()}async initializeFormData(){this.priority=this.plugin.settings.defaultTaskPriority,this.status=this.plugin.settings.defaultTaskStatus;let e=this.plugin.settings.taskCreationDefaults;if(this.dueDate=Bs(e.defaultDueDate),this.scheduledDate=Bs(e.defaultScheduledDate),this.contexts=e.defaultContexts||"",this.tags=e.defaultTags||"",e.defaultProjects){let t=un(e.defaultProjects);t.length>0&&this.initializeProjectsFromStrings(t)}if(e.defaultTimeEstimate&&e.defaultTimeEstimate>0&&(this.timeEstimate=e.defaultTimeEstimate),e.defaultReminders&&e.defaultReminders.length>0){let{convertDefaultRemindersToReminders:t}=await Promise.resolve().then(()=>(Yf(),Vf));this.reminders=t(e.defaultReminders)}this.options.prePopulatedValues&&this.applyPrePopulatedValues(this.options.prePopulatedValues)}applyPrePopulatedValues(e){e.title!==void 0&&(this.title=e.title),e.due!==void 0&&(this.dueDate=e.due),e.scheduled!==void 0&&(this.scheduledDate=e.scheduled),e.priority!==void 0&&(this.priority=e.priority),e.status!==void 0&&(this.status=e.status),e.contexts!==void 0&&(this.contexts=e.contexts.join(", ")),e.projects!==void 0&&(e.projects.filter(r=>r&&typeof r=="string"&&r.trim()!=="").length>0&&this.initializeProjectsFromStrings(e.projects),this.renderProjectsList()),e.tags!==void 0&&(this.tags=oa(e.tags.filter(t=>t!==this.plugin.settings.taskTag).join(", "))),e.timeEstimate!==void 0&&(this.timeEstimate=e.timeEstimate),e.recurrence!==void 0&&typeof e.recurrence=="string"&&(this.recurrenceRule=e.recurrence)}async handleSave(){if(this.plugin.settings.enableNaturalLanguageInput&&this.nlInput){let e=this.nlInput.value.trim();if(e&&!this.title.trim()){let t=this.statusSuggestionService.extractTaskDataFromInput(e);this.applyParsedData(t)}}if(!this.validateForm()){new Ms.Notice("Please enter a task title");return}try{let e=this.buildTaskData(),t=await this.plugin.taskService.createTask(e),r=t.taskInfo.title.replace(/[<>:"/\\|?*]/g,"").trim(),s=t.file.basename;s.startsWith("task-")&&s!==r?new Ms.Notice(`Task "${t.taskInfo.title}" created successfully (filename shortened due to length)`):new Ms.Notice(`Task "${t.taskInfo.title}" created successfully`),this.options.onTaskCreated&&this.options.onTaskCreated(t.taskInfo),this.close()}catch(e){console.error("Failed to create task:",e),new Ms.Notice("Failed to create task: "+e.message)}}buildTaskData(){let e=Le(),t=this.contexts.split(",").map(a=>a.trim()).filter(a=>a.length>0),r=un(this.projects),s=oa(this.tags).split(",").map(a=>a.trim()).filter(a=>a.length>0);this.plugin.settings.taskTag&&!s.includes(this.plugin.settings.taskTag)&&s.push(this.plugin.settings.taskTag);let i={title:this.title.trim(),due:this.dueDate||void 0,scheduled:this.scheduledDate||void 0,priority:this.priority,status:this.status,contexts:t.length>0?t:void 0,projects:r.length>0?r:void 0,tags:s.length>0?s:void 0,timeEstimate:this.timeEstimate>0?this.timeEstimate:void 0,recurrence:this.recurrenceRule||void 0,reminders:this.reminders.length>0?this.reminders:void 0,creationContext:"manual-creation",dateCreated:e,dateModified:e,customFrontmatter:this.buildCustomFrontmatter()};return this.details.trim()&&(i.details=this.details.trim()),i}buildCustomFrontmatter(){let e={};for(let[t,r]of Object.entries(this.userFields))r!=null&&r!==""&&(e[t]=r);return e}generateFilename(e){let t={title:e.title||"",status:e.status||"open",priority:e.priority||"normal",dueDate:e.due,scheduledDate:e.scheduled};return kg(t,this.plugin.settings)}createTitleInput(e){this.plugin.settings.enableNaturalLanguageInput||super.createTitleInput(e)}};var Tr=require("obsidian");Fe();Fe();At();Lt();Sl();lS();var Pa=class extends uc{constructor(t,r,s){super(t,r);this.completedInstancesChanges=new Set;this.calendarWrapper=null;this.isExpanded=!0;this.task=s.task,this.options=s}getModalTitle(){return"Edit task"}async initializeFormData(){this.title=this.task.title,this.dueDate=this.task.due||"",this.scheduledDate=this.task.scheduled||"",this.priority=this.task.priority,this.status=this.task.status,this.contexts=this.task.contexts?this.task.contexts.join(", "):"",this.task.projects&&this.task.projects.length>0?this.task.projects.filter(r=>r&&typeof r=="string"&&r.trim()!=="").length>0?this.initializeProjectsFromStrings(this.task.projects):(this.projects="",this.selectedProjectFiles=[]):(this.projects="",this.selectedProjectFiles=[]),this.tags=this.task.tags?oa(this.task.tags.filter(t=>t!==this.plugin.settings.taskTag).join(", ")):"",this.timeEstimate=this.task.timeEstimate||0,this.task.recurrence?typeof this.task.recurrence=="string"?this.recurrenceRule=this.task.recurrence:typeof this.task.recurrence=="object"&&this.task.recurrence.frequency&&(this.recurrenceRule=this.convertLegacyRecurrenceToString(this.task.recurrence)):this.recurrenceRule="",this.reminders=this.task.reminders?[...this.task.reminders]:[],await this.initializeUserFields()}async initializeUserFields(){var t;try{let r=this.app.vault.getAbstractFileByPath(this.task.path);if(!r||!(r instanceof Tr.TFile))return;let s=this.app.metadataCache.getFileCache(r),i=s==null?void 0:s.frontmatter;if(!i)return;let a=((t=this.plugin.settings)==null?void 0:t.userFields)||[];for(let o of a){if(!o||!o.key)continue;let l=i[o.key];l!==void 0&&(this.userFields[o.key]=l)}}catch(r){console.error("Error initializing user fields:",r)}}convertLegacyRecurrenceToString(t){if(!t.frequency)return"";let r=t.frequency;return t.frequency==="weekly"&&t.days_of_week&&(r+=` on ${t.days_of_week.join(", ")}`),t.frequency==="monthly"&&t.day_of_month&&(r+=` on day ${t.day_of_month}`),r}showReminderContextMenu(t){let r={...this.task,title:this.title,due:this.dueDate,scheduled:this.scheduledDate,reminders:this.reminders};new dc(this.plugin,r,t.target,i=>{this.reminders=i.reminders||[],this.updateReminderIconState()}).show(t)}async onOpen(){this.completedInstancesChanges.clear(),await this.refreshTaskData(),this.containerEl.addClass("tasknotes-plugin","minimalist-task-modal"),this.titleEl.setText(this.getModalTitle());let t=this.titleEl.createSpan("modal-header-icon");(0,Tr.setIcon)(t,"tasknotes-simple"),this.titleEl.insertBefore(t,this.titleEl.firstChild),this.initializeFormData().then(()=>{this.createModalContent(),this.renderProjectsList(),this.updateIconStates(),this.focusTitleInput()})}async refreshTaskData(){try{let t=this.app.vault.getAbstractFileByPath(this.task.path);if(!t||!(t instanceof Tr.TFile)){console.warn("Could not find file for task:",this.task.path);return}let r=await this.app.vault.read(t),s=lP(this.app,r,this.task.path,t,this.plugin.fieldMapper,this.plugin.settings.storeTitleInFilename);s&&(this.task=s,this.options.task=s)}catch(t){console.warn("Could not refresh task data:",t)}}createModalContent(){let{contentEl:t}=this;t.empty();let r=t.createDiv("minimalist-modal-container");this.createActionBar(r),this.createDetailsSection(r),this.createCompletionsCalendarSection(r),this.createMetadataSection(r),this.createActionButtons(r)}createCompletionsCalendarSection(t){if(this.task.recurrence){let r=t.createDiv("completions-calendar-container"),s=r.createDiv("detail-label");s.textContent="Completions";let i=r.createDiv("completions-calendar-content");this.createRecurringCalendar(i)}}createMetadataSection(t){this.metadataContainer=t.createDiv("metadata-container");let r=this.metadataContainer.createDiv("detail-label");r.textContent="Task Information";let s=this.metadataContainer.createDiv("metadata-content"),i=mn(this.task.timeEntries||[]);if(i>0){let a=s.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Total tracked time: ",a.createSpan("metadata-value").textContent=nm(i)}if(this.task.dateCreated){let a=s.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Created: ",a.createSpan("metadata-value").textContent=oT(this.task.dateCreated)}if(this.task.dateModified){let a=s.createDiv("metadata-item");a.createSpan("metadata-key").textContent="Modified: ",a.createSpan("metadata-value").textContent=oT(this.task.dateModified)}if(this.task.path){let a=s.createDiv("metadata-item");a.createSpan("metadata-key").textContent="File: ",a.createSpan("metadata-value").textContent=this.task.path}}createRecurringCalendar(t){this.calendarWrapper=t.createDiv("recurring-calendar");let s=Ge();if(this.task.complete_instances&&this.task.complete_instances.length>0){let i=this.task.complete_instances.filter(a=>a&&typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a.trim())).map(a=>Ml(a).getTime()).filter(a=>!isNaN(a));i.length>0&&(s=new Date(Math.max(...i)))}this.renderCalendarMonth(this.calendarWrapper,s)}renderCalendarMonth(t,r){t.empty();let s=t.createDiv("recurring-calendar__header"),i=s.createEl("button",{cls:"recurring-calendar__nav",text:"\u2039"}),a=s.createSpan("recurring-calendar__month");a.textContent=x(r,"MMM yyyy");let o=s.createEl("button",{cls:"recurring-calendar__nav",text:"\u203A"}),l=t.createDiv("recurring-calendar__grid"),c=dT(r),d=uT(r),u=this.plugin.settings.calendarViewSettings.firstDay||0,h=cT(c,u),f=dA(d,u),p=cA(h,f),m=dT(r);m.setUTCMonth(m.getUTCMonth()-1);let g=uT(r);g.setUTCMonth(g.getUTCMonth()+1);let y=Rd(this.task,m,g),T=new Set(y.map(b=>me(b))),w=new Set(this.task.complete_instances||[]);this.completedInstancesChanges.forEach(b=>{w.has(b)?w.delete(b):w.add(b)}),p.forEach(b=>{let S=me(b),k=b.getUTCMonth()===r.getUTCMonth(),D=T.has(S),M=w.has(S),_=l.createDiv("recurring-calendar__day");_.textContent=String(b.getUTCDate()),k||_.addClass("recurring-calendar__day--faded"),_.addClass("recurring-calendar__day--clickable"),D&&_.addClass("recurring-calendar__day--recurring"),M&&_.addClass("recurring-calendar__day--completed"),_.addEventListener("click",()=>{this.toggleCompletedInstance(S),this.renderCalendarMonth(t,r)})}),i.addEventListener("click",()=>{let b=new Date(r);b.setUTCMonth(b.getUTCMonth()-1),this.renderCalendarMonth(t,b)}),o.addEventListener("click",()=>{let b=new Date(r);b.setUTCMonth(b.getUTCMonth()+1),this.renderCalendarMonth(t,b)})}toggleCompletedInstance(t){this.completedInstancesChanges.has(t)?this.completedInstancesChanges.delete(t):this.completedInstancesChanges.add(t)}async handleSave(){if(!this.validateForm()){new Tr.Notice("Please enter a task title");return}try{let t=this.getChanges();if(Object.keys(t).length===0){new Tr.Notice("No changes to save"),this.close();return}let r=await this.plugin.taskService.updateTask(this.task,t);new Tr.Notice(`Task "${r.title}" updated successfully`),this.options.onTaskUpdated&&this.options.onTaskUpdated(r)}catch(t){console.error("Failed to update task:",t),new Tr.Notice("Failed to update task: "+t.message)}}getChanges(){let t={};this.title.trim()!==this.task.title&&(t.title=this.title.trim()),this.dueDate!==(this.task.due||"")&&(t.due=this.dueDate||void 0),this.scheduledDate!==(this.task.scheduled||"")&&(t.scheduled=this.scheduledDate||void 0),this.priority!==this.task.priority&&(t.priority=this.priority),this.status!==this.task.status&&(t.status=this.status);let r=this.contexts.split(",").map(m=>m.trim()).filter(m=>m.length>0),s=this.task.contexts||[];JSON.stringify(r.sort())!==JSON.stringify(s.sort())&&(t.contexts=r.length>0?r:void 0);let i=un(this.projects),a=this.task.projects||[];JSON.stringify(i.sort())!==JSON.stringify(a.sort())&&(t.projects=i);let o=this.tags.split(",").map(m=>m.trim()).filter(m=>m.length>0);this.plugin.settings.taskTag&&!o.includes(this.plugin.settings.taskTag)&&o.push(this.plugin.settings.taskTag);let l=this.task.tags||[];JSON.stringify(o.sort())!==JSON.stringify(l.sort())&&(t.tags=o.length>0?o:void 0);let c=this.timeEstimate>0?this.timeEstimate:void 0,d=this.task.timeEstimate;c!==d&&(t.timeEstimate=c);let u=typeof this.task.recurrence=="string"?this.task.recurrence:"";this.recurrenceRule!==u&&(t.recurrence=this.recurrenceRule||void 0);let h=this.task.reminders||[],f=this.reminders||[];if(JSON.stringify(f)!==JSON.stringify(h)&&(t.reminders=f.length>0?f:void 0),this.completedInstancesChanges.size>0){let m=new Set(this.task.complete_instances||[]);if(this.completedInstancesChanges.forEach(g=>{m.has(g)?m.delete(g):m.add(g)}),t.complete_instances=Array.from(m),this.task.recurrence){let g={...this.task,...t},y=Nd(g,this.plugin.settings.maintainDueDateOffsetInRecurring);y.scheduled&&(t.scheduled=y.scheduled),y.due&&(t.due=y.due)}}let p=this.getUserFieldChanges();return Object.keys(p).length>0&&(t.customFrontmatter=p),Object.keys(t).length>0&&(t.dateModified=Le()),t}getUserFieldChanges(){var r;let t={};try{let s=this.app.vault.getAbstractFileByPath(this.task.path);if(!s||!(s instanceof Tr.TFile))return t;let i=this.app.metadataCache.getFileCache(s),a=(i==null?void 0:i.frontmatter)||{},o=((r=this.plugin.settings)==null?void 0:r.userFields)||[];for(let l of o){if(!l||!l.key)continue;let c=this.userFields[l.key],d=a[l.key];this.isDifferent(c,d)&&(t[l.key]=c==null||c===""?null:c)}}catch(s){console.error("Error comparing user fields:",s)}return t}isDifferent(t,r){let s=o=>o==null||o===""?null:o,i=s(t),a=s(r);return Array.isArray(i)||Array.isArray(a)?JSON.stringify(i)!==JSON.stringify(a):i!==a}async openTaskNote(){try{let t=this.app.vault.getAbstractFileByPath(this.task.path);if(!t){new Tr.Notice(`Could not find task file: ${this.task.path}`);return}await this.app.workspace.getLeaf(!0).openFile(t),this.close()}catch(t){console.error("Failed to open task note:",t),new Tr.Notice("Failed to open task note")}}async archiveTask(){try{let t=await this.plugin.taskService.toggleArchive(this.task);this.task=t,this.options.onTaskUpdated&&this.options.onTaskUpdated(t);let r=t.archived?"archived":"unarchived";new Tr.Notice(`Task ${r} successfully`),this.close()}catch(t){console.error("Failed to archive task:",t),new Tr.Notice("Failed to archive task")}}createActionButtons(t){let r=t.createDiv("button-container");r.createEl("button",{cls:"open-note-button",text:"Open note"}).addEventListener("click",async()=>{await this.openTaskNote()}),r.createEl("button",{cls:"archive-button",text:this.task.archived?"Unarchive":"Archive"}).addEventListener("click",async()=>{await this.archiveTask()}),r.createDiv("button-spacer"),r.createEl("button",{cls:"save-button",text:"Save"}).addEventListener("click",async()=>{await this.handleSave(),this.close()}),r.createEl("button",{cls:"cancel-button",text:"Cancel"}).addEventListener("click",()=>{this.close()})}renderProjectsList(){if(!this.projectsList||(this.projectsList.empty(),this.selectedProjectFiles.length===0))return;let t={metadataCache:this.app.metadataCache,workspace:this.app.workspace};this.selectedProjectFiles.forEach(r=>{let s=this.projectsList.createDiv({cls:"task-project-item"}),i=s.createDiv({cls:"task-project-info"}),a=i.createDiv({cls:"task-project-name clickable-project"}),o=`[[${r.path}|${r.name}]]`;if(dy(a,[o],t),r.path!==r.name){let c=i.createDiv({cls:"task-project-path"});c.textContent=r.path}let l=s.createEl("button",{cls:"task-project-remove",text:"\xD7"});(0,Tr.setTooltip)(l,"Remove project",{placement:"top"}),l.addEventListener("click",()=>{this.removeProject(r)})})}};var ti=require("obsidian");At();Fe();Lt();var uy=class extends ti.FuzzySuggestModal{constructor(e,t,r,s){super(e),this.plugin=t,this.onScheduleTask=r,this.defaultScheduleOptions=s,this.setPlaceholder("Type to search for an unscheduled task..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to schedule task"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText("Schedule Task"),this.titleEl.setAttribute("id","unscheduled-tasks-selector-title"),this.containerEl.setAttribute("aria-labelledby","unscheduled-tasks-selector-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true"),this.containerEl.addClass("unscheduled-tasks-selector-modal"),this.loadUnscheduledTasks()}async loadUnscheduledTasks(){try{let e=this.plugin.cacheManager.getAllTaskPaths(),t=Array.from(e).map(s=>this.plugin.cacheManager.getTaskInfo(s)),r=(await Promise.all(t)).filter(s=>s!==null);this.tasks=r.filter(s=>!s.archived&&!this.plugin.statusManager.isCompletedStatus(s.status)&&!s.scheduled)}catch(e){console.error("Error loading unscheduled tasks:",e),this.tasks=[]}}getItems(){return this.tasks.sort((e,t)=>{var a,o;if(e.due&&!t.due)return-1;if(!e.due&&t.due)return 1;if(e.due&&t.due){let l=e.due.localeCompare(t.due);if(l!==0)return l}let r={high:0,normal:1,low:2},s=(a=r[e.priority])!=null?a:1,i=(o=r[t.priority])!=null?o:1;return s!==i?s-i:e.title.localeCompare(t.title)})}getItemText(e){return e.title}renderSuggestion(e,t){let r=e.item;t.empty(),t.addClass("unscheduled-tasks-selector__suggestion");let s=t.createDiv({cls:"unscheduled-tasks-selector__content"}),i=s.createDiv({cls:"unscheduled-tasks-selector__title"});this.renderHighlightedText(i,e,r.title);let a=s.createDiv({cls:"unscheduled-tasks-selector__meta"});if(r.priority&&a.createSpan({text:r.priority.toUpperCase(),cls:`unscheduled-tasks-selector__priority priority-${(r.priority||"normal").toLowerCase()}`}),r.due){let c=a.createSpan({cls:"unscheduled-tasks-selector__due"}),d=Wt(r.due)?x($t(r.due),"MMM d, h:mm a"):x($t(r.due),"MMM d");if(_l(ve(r.due))){c.addClass("overdue");let u=c.createSpan();(0,ti.setIcon)(u,"alert-triangle"),c.createSpan({text:` Overdue: ${d}`})}else if(sa(ve(r.due))){c.addClass("due-today");let u=c.createSpan();(0,ti.setIcon)(u,"calendar"),c.createSpan({text:` Due today: ${d}`})}else c.setText(`Due: ${d}`)}if(r.timeEstimate&&a.createSpan({text:`~${r.timeEstimate}min`,cls:"unscheduled-tasks-selector__time-estimate"}),r.contexts&&r.contexts.length>0){let c=a.createSpan({cls:"unscheduled-tasks-selector__contexts"});c.textContent=`@${r.contexts.join(", @")}`}let o=qr(r.projects||[]);if(o.length>0){let c=a.createSpan({cls:"unscheduled-tasks-selector__projects"});s6(c,o,this.plugin)}let l=s.createDiv({cls:"unscheduled-tasks-selector__schedule-icon"});(0,ti.setIcon)(l,"calendar-plus")}renderHighlightedText(e,t,r){e.empty();let s=t.match.matches;if(!s||s.length===0){e.textContent=r;return}let i=0;for(let a of s)a[0]>i&&e.appendText(r.slice(i,a[0])),e.createEl("mark",{text:r.slice(a[0],a[1]+1)}),i=a[1]+1;i<r.length&&e.appendText(r.slice(i))}onChooseItem(e,t){this.onScheduleTask(e,this.defaultScheduleOptions)}onNoSuggestion(){this.resultContainerEl.createDiv({cls:"unscheduled-tasks-selector__no-results"}).setText("No unscheduled tasks found. All tasks are either scheduled, completed, or archived.")}};function r6(n){return!!(n&&typeof n=="string"&&n.startsWith("[[")&&n.endsWith("]]"))}function s6(n,e,t){n.innerHTML="",e.forEach((r,s)=>{if(s>0){let a=document.createTextNode(", ");n.appendChild(a)}let i=document.createTextNode("+");if(n.appendChild(i),r6(r)){let a=r.slice(2,-2);n.createEl("a",{cls:"unscheduled-tasks-selector__project-link internal-link",text:a,attr:{"data-href":a}}).addEventListener("click",async l=>{l.preventDefault(),l.stopPropagation();let c=t.app.metadataCache.getFirstLinkpathDest(a,"");c instanceof ti.TFile?await t.app.workspace.getLeaf(!1).openFile(c):new ti.Notice(`Note "${a}" not found`)})}else{let a=document.createTextNode(r);n.appendChild(a)}})}var Ct=require("obsidian");Lt();Fe();var Ia=ke(dn()),hy=class extends Ct.Modal{constructor(t,r,s){super(t);this.selectedAttachments=[];this.plugin=r,this.options=s}onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("timeblock-creation-modal"),new Ct.Setting(t).setName("Create timeblock").setHeading();let r=t.createDiv({cls:"timeblock-date-display"});r.createEl("strong",{text:"Date: "});let s=Ml(this.options.date);r.createSpan({text:s.toLocaleDateString()}),new Ct.Setting(t).setName("Title").setDesc("Title for your timeblock").addText(c=>{this.titleInput=c.inputEl,c.setPlaceholder("e.g., Deep work session").setValue(this.options.prefilledTitle||"").onChange(()=>this.validateForm()),window.setTimeout(()=>this.titleInput.focus(),100)});let i=t.createDiv({cls:"timeblock-time-container"});new Ct.Setting(i).setName("Start time").setDesc("When the timeblock starts").addText(c=>{this.startTimeInput=c.inputEl,c.setPlaceholder("09:00").setValue(this.options.startTime||"").onChange(()=>this.validateForm()),this.startTimeInput.type="time"}),new Ct.Setting(i).setName("End time").setDesc("When the timeblock ends").addText(c=>{this.endTimeInput=c.inputEl,c.setPlaceholder("11:00").setValue(this.options.endTime||"").onChange(()=>this.validateForm()),this.endTimeInput.type="time"}),new Ct.Setting(t).setName("Description").setDesc("Optional description for the timeblock").addTextArea(c=>{this.descriptionInput=c.inputEl,c.setPlaceholder("Focus on new features, no interruptions").setValue(""),this.descriptionInput.rows=3}),new Ct.Setting(t).setName("Color").setDesc("Optional color for the timeblock").addText(c=>{this.colorInput=c.inputEl,c.setPlaceholder("#3b82f6").setValue("#6366f1"),this.colorInput.type="color"}),new Ct.Setting(t).setName("Attachments").setDesc("Files or notes to link to this timeblock").addButton(c=>{c.setButtonText("Add Attachment").setTooltip("Select a file or note using fuzzy search").onClick(()=>{new zl(this.app,this.plugin,u=>{this.addAttachment(u)}).open()})}),this.attachmentsList=t.createDiv({cls:"timeblock-attachments-list"}),this.renderAttachmentsList();let a=t.createDiv({cls:"timeblock-modal-buttons"});a.createEl("button",{text:"Cancel"}).addEventListener("click",()=>this.close()),a.createEl("button",{text:"Create timeblock",cls:"mod-cta timeblock-create-button"}).addEventListener("click",()=>this.handleSubmit()),this.validateForm()}validateForm(){var o,l,c;let t=this.contentEl.querySelector(".timeblock-create-button");if(!t)return;let r=(o=this.titleInput)==null?void 0:o.value.trim(),s=(l=this.startTimeInput)==null?void 0:l.value,i=(c=this.endTimeInput)==null?void 0:c.value,a=!!(r&&s&&i);if(a&&s&&i){let[d,u]=s.split(":").map(Number),[h,f]=i.split(":").map(Number),p=d*60+u;h*60+f<=p&&(a=!1)}t.disabled=!a,t.style.opacity=a?"1":"0.5"}async handleSubmit(){try{let t=this.titleInput.value.trim(),r=this.startTimeInput.value,s=this.endTimeInput.value,i=this.descriptionInput.value.trim(),a=this.colorInput.value;if(!t||!r||!s){new Ct.Notice("Please fill in all required fields");return}let o=this.selectedAttachments.map(c=>`[[${c.path}]]`),l={id:dP(),title:t,startTime:r,endTime:s};i&&(l.description=i),a&&(l.color=a),o.length>0&&(l.attachments=o),await this.saveTimeblockToDailyNote(l),this.plugin.emitter.trigger("data-changed"),new Ct.Notice(`Timeblock "${t}" created successfully`),this.close()}catch(t){console.error("Error creating timeblock:",t),new Ct.Notice("Failed to create timeblock. Check console for details.")}}async saveTimeblockToDailyNote(t){if(!(0,Ia.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes plugin is not enabled");let r=window.moment(this.options.date),s=(0,Ia.getAllDailyNotes)(),i=(0,Ia.getDailyNote)(r,s);if(!i&&(i=await(0,Ia.createDailyNote)(r),!i))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let a=await this.app.vault.read(i),o={},l=a;if(a.startsWith("---")){let u=a.indexOf("---",3);if(u!==-1){let h=a.substring(3,u);l=a.substring(u+3);try{o=(0,Ct.parseYaml)(h)||{}}catch(f){console.error("Error parsing existing frontmatter:",f),o={}}}}o.timeblocks||(o.timeblocks=[]),o.timeblocks.push(t);let d=`---
${(0,Ct.stringifyYaml)(o)}---${l}`;await this.app.vault.modify(i,d)}addAttachment(t){if(this.selectedAttachments.some(r=>r.path===t.path)){new Ct.Notice(`"${t.name}" is already attached`);return}this.selectedAttachments.push(t),this.renderAttachmentsList(),new Ct.Notice(`Added "${t.name}" as attachment`)}removeAttachment(t){this.selectedAttachments=this.selectedAttachments.filter(r=>r.path!==t.path),this.renderAttachmentsList(),new Ct.Notice(`Removed "${t.name}" from attachments`)}renderAttachmentsList(){if(this.attachmentsList.empty(),this.selectedAttachments.length===0){let t=this.attachmentsList.createDiv({cls:"timeblock-attachments-empty"});t.textContent="No attachments added yet";return}this.selectedAttachments.forEach(t=>{let r=this.attachmentsList.createDiv({cls:"timeblock-attachment-item"}),s=r.createDiv({cls:"timeblock-attachment-info"}),i=s.createSpan({cls:"timeblock-attachment-name"});if(i.textContent=t.name,t.path!==t.name){let o=s.createDiv({cls:"timeblock-attachment-path"});o.textContent=t.path}let a=r.createEl("button",{cls:"timeblock-attachment-remove",text:"\xD7"});(0,Ct.setTooltip)(a,"Remove attachment",{placement:"top"}),a.addEventListener("click",()=>{this.removeAttachment(t)})})}onClose(){let{contentEl:t}=this;t.empty()}};var se=require("obsidian");var fy=class{constructor(e){this.dragState=null;this.onReorder=e}setupDragAndDrop(e,t){this.initializeDragState(),e.addEventListener("dragstart",r=>this.handleDragStart(r,e,t)),e.addEventListener("dragend",()=>this.handleDragEnd(e)),e.addEventListener("dragover",r=>this.handleDragOver(r,e)),e.addEventListener("drop",r=>this.handleDrop(r,t))}setupGlobalHandlers(e){e.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation()}),e.addEventListener("drop",t=>{var i;if(t.preventDefault(),t.stopPropagation(),!((i=this.dragState)!=null&&i.draggedElement)||this.dragState.dropHandled)return;this.dragState.dropHandled=!0;let r=this.dragState.draggedIndex,s=this.calculateDropPosition();r!==s&&this.onReorder(r,s)})}initializeDragState(){this.dragState||(this.dragState={draggedElement:null,placeholder:null,draggedIndex:-1,dropHandled:!1})}handleDragStart(e,t,r){this.dragState&&(this.dragState.draggedElement=t,this.dragState.draggedIndex=r,this.dragState.dropHandled=!1,t.classList.add("filter-bar__view-item-container--dragging"),this.dragState.placeholder=t.cloneNode(!0),this.dragState.placeholder.classList.add("filter-bar__view-item-container--placeholder"),this.dragState.placeholder.classList.remove("filter-bar__view-item-container--dragging"),e.dataTransfer&&(e.dataTransfer.setData("text/plain",r.toString()),e.dataTransfer.effectAllowed="move"))}handleDragEnd(e){var t;this.dragState&&(e.classList.remove("filter-bar__view-item-container--dragging"),(t=this.dragState.placeholder)!=null&&t.parentNode&&this.dragState.placeholder.parentNode.removeChild(this.dragState.placeholder),this.resetDragState())}handleDragOver(e,t){var a;if(e.preventDefault(),!((a=this.dragState)!=null&&a.draggedElement)||this.dragState.draggedElement===t)return;let r=t.getBoundingClientRect(),i=e.clientY-r.top<r.height/2;t.parentNode&&this.dragState.placeholder&&(i?t.parentNode.insertBefore(this.dragState.placeholder,t):t.parentNode.insertBefore(this.dragState.placeholder,t.nextSibling))}handleDrop(e,t){var i,a;if(e.preventDefault(),!((i=this.dragState)!=null&&i.draggedElement)||this.dragState.dropHandled)return;this.dragState.dropHandled=!0;let r=this.dragState.draggedIndex,s=(a=this.calculateDropPosition())!=null?a:t;r!==s&&this.onReorder(r,s)}calculateDropPosition(){var r,s;if(!((s=(r=this.dragState)==null?void 0:r.placeholder)!=null&&s.parentNode))return-1;let e=this.dragState.placeholder.parentNode,t=0;for(let i of e.children){if(i===this.dragState.placeholder)break;i.classList.contains("filter-bar__view-item-container")&&!i.classList.contains("filter-bar__view-item-container--placeholder")&&t++}return t>this.dragState.draggedIndex&&t--,t}resetDragState(){this.dragState&&(this.dragState.draggedElement=null,this.dragState.placeholder=null,this.dragState.draggedIndex=-1,this.dragState.dropHandled=!1)}};var ri=class{constructor(){this.events={}}on(e,t){return this.events[e]||(this.events[e]=[]),this.events[e].push(t),()=>{this.events[e]=this.events[e].filter(r=>r!==t)}}emit(e,...t){this.events[e]&&this.events[e].forEach(r=>{r(...t)})}removeAllListeners(e){e?delete this.events[e]:this.events={}}};Fe();var Rr=class extends Error{constructor(t,r,s){super(t);this.field=r;this.nodeId=s;this.name="FilterValidationError"}},Ra=class extends Error{constructor(t,r){super(t);this.nodeId=r;this.name="FilterEvaluationError"}},Pe=class{static generateId(){return`filter_${Date.now()}_${++this.idCounter}`}static deepCloneFilterQuery(e){return JSON.parse(JSON.stringify(e))}static validateFilterNode(e,t=!0){if(!e||typeof e!="object")throw new Rr("Filter node must be an object");if(!("id"in e)||!e.id||typeof e.id!="string")throw new Rr("Filter node must have a valid string ID",void 0,"id"in e?String(e.id):"unknown");if(e.type==="condition")this.validateCondition(e,t);else if(e.type==="group")this.validateGroup(e,t);else throw new Rr(`Unknown filter node type: ${e.type}`,void 0,e.id)}static validateCondition(e,t=!0){if(typeof e.property!="string")throw new Rr("Condition must have a valid property","property",e.id);if(t&&e.property==="")throw new Rr("Property must be selected","property",e.id);if(e.property==="")return;if(!e.operator||typeof e.operator!="string")throw new Rr("Condition must have a valid operator","operator",e.id);if(!this.getValidOperatorsForProperty(e.property).includes(e.operator))throw new Rr(`Operator '${e.operator}' is not valid for property '${e.property}'`,"operator",e.id);if(t&&this.operatorRequiresValue(e.operator)&&(e.value===null||e.value===void 0||e.value===""))throw new Rr(`Operator '${e.operator}' requires a value`,"value",e.id)}static validateGroup(e,t=!0){if(!e.conjunction||!["and","or"].includes(e.conjunction))throw new Rr("Group must have a valid conjunction (and/or)","conjunction",e.id);if(!Array.isArray(e.children))throw new Rr("Group must have a children array","children",e.id);e.children.forEach((r,s)=>{try{this.validateFilterNode(r,t)}catch(i){throw i instanceof Rr?new Rr(`Child ${s}: ${i.message}`,i.field,e.id):i}})}static getValidOperatorsForProperty(e){return typeof e=="string"&&e.startsWith("user:")?["is","is-not","contains","does-not-contain","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty","is-checked","is-not-checked","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal"]:{"":[],title:["is","is-not","contains","does-not-contain","is-empty","is-not-empty"],path:["contains","does-not-contain","is-empty","is-not-empty"],status:["is","is-not","is-empty","is-not-empty"],priority:["is","is-not","is-empty","is-not-empty"],tags:["contains","does-not-contain","is-empty","is-not-empty"],contexts:["contains","does-not-contain","is-empty","is-not-empty"],projects:["contains","does-not-contain","is-empty","is-not-empty"],due:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],scheduled:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],completedDate:["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],"file.ctime":["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],"file.mtime":["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],archived:["is-checked","is-not-checked"],timeEstimate:["is","is-not","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal"],recurrence:["is-empty","is-not-empty"],"status.isCompleted":["is-checked","is-not-checked"]}[e]||[]}static isFilterNodeComplete(e){try{return this.validateFilterNode(e,!0),!0}catch(t){return!1}}static operatorRequiresValue(e){return!["is-empty","is-not-empty","is-checked","is-not-checked"].includes(e)}static getTaskPropertyValue(e,t){switch(t){case"title":return e.title;case"path":return e.path;case"status":return e.status;case"priority":return e.priority;case"tags":return e.tags||[];case"contexts":return e.contexts||[];case"projects":return e.projects||[];case"due":return e.due;case"scheduled":return e.scheduled;case"completedDate":return e.completedDate;case"file.ctime":return e.dateCreated;case"file.mtime":return e.dateModified;case"archived":return e.archived;case"timeEstimate":return e.timeEstimate;case"recurrence":return e.recurrence;case"status.isCompleted":return;default:throw new Ra(`Unknown property: ${t}`)}}static applyOperator(e,t,r,s,i){try{switch(t){case"is":return this.isEqual(e,r,i);case"is-not":return!this.isEqual(e,r,i);case"contains":return this.contains(e,r);case"does-not-contain":return!this.contains(e,r);case"is-before":return this.isBefore(e,r);case"is-after":return this.isAfter(e,r);case"is-on-or-before":return this.isOnOrBefore(e,r);case"is-on-or-after":return this.isOnOrAfter(e,r);case"is-empty":return this.isEmpty(e);case"is-not-empty":return!this.isEmpty(e);case"is-checked":return e===!0;case"is-not-checked":return e!==!0;case"is-greater-than":return this.isGreaterThan(e,r);case"is-less-than":return this.isLessThan(e,r);case"is-greater-than-or-equal":return this.isGreaterThanOrEqual(e,r);case"is-less-than-or-equal":return this.isLessThanOrEqual(e,r);default:throw new Ra(`Unknown operator: ${t}`,s)}}catch(a){throw a instanceof Ra?a:new Ra(`Error applying operator '${t}': ${a.message}`,s)}}static isEqual(e,t,r){return r&&this.isDateProperty(r)&&typeof e=="string"&&typeof t=="string"&&(e||hT(t))?this.isEqualDate(e,t):Array.isArray(e)?Array.isArray(t)?e.some(s=>t.includes(s)):e.includes(t):Array.isArray(t)?t.includes(e):e===t}static contains(e,t){if(Array.isArray(e)){if(Array.isArray(t))return t.some(r=>e.some(s=>typeof s=="string"&&typeof r=="string"&&s.toLowerCase().includes(r.toLowerCase())));{let r=typeof t=="string"?t.toLowerCase():String(t!=null?t:"").toLowerCase();return e.some(s=>typeof s=="string"&&s.toLowerCase().includes(r))}}else if(typeof e=="string")return Array.isArray(t)?t.some(r=>typeof r=="string"&&e.toLowerCase().includes(r.toLowerCase())):typeof t=="string"&&e.toLowerCase().includes(t.toLowerCase());return!1}static isBefore(e,t){if(!e||!t)return!1;try{let r=Al(t);return na(e,r)}catch(r){return!1}}static isAfter(e,t){if(!e||!t)return!1;try{let r=Al(t);return na(r,e)}catch(r){return!1}}static isOnOrBefore(e,t){if(!e||!t)return!1;try{let r=Al(t);return na(e,r)||rr(ve(e),ve(r))}catch(r){return!1}}static isOnOrAfter(e,t){if(!e||!t)return!1;try{let r=Al(t);return na(r,e)||rr(ve(e),ve(r))}catch(r){return!1}}static isDateProperty(e){return["due","scheduled","completedDate","file.ctime","file.mtime"].includes(e)}static isEqualDate(e,t){try{let r=Al(t);return rr(ve(e),ve(r))}catch(r){return!1}}static isEmpty(e){return e==null?!0:typeof e=="string"?e.trim()==="":Array.isArray(e)?e.length===0?!0:e.every(t=>{if(typeof t!="string")return!1;let r=t.trim();return r.length===0||r==='""'||r==="''"}):!1}static isGreaterThan(e,t){let r=typeof e=="number"?e:parseFloat(e),s=typeof t=="number"?t:parseFloat(t);return isNaN(r)||isNaN(s)?!1:r>s}static isLessThan(e,t){let r=typeof e=="number"?e:parseFloat(e),s=typeof t=="number"?t:parseFloat(t);return isNaN(r)||isNaN(s)?!1:r<s}static isGreaterThanOrEqual(e,t){let r=typeof e=="number"?e:parseFloat(e),s=typeof t=="number"?t:parseFloat(t);return isNaN(r)||isNaN(s)?!1:r>=s}static isLessThanOrEqual(e,t){let r=typeof e=="number"?e:parseFloat(e),s=typeof t=="number"?t:parseFloat(t);return isNaN(r)||isNaN(s)?!1:r<=s}};Pe.idCounter=0;Fe();Op();Vl();var GF=require("obsidian"),py=null,qF=null,my=class{constructor(e,t,r){this.currentProperties=e;this.plugin=t;this.onUpdate=r}show(e){try{let t=new GF.Menu,r=this.getCachedProperties(),s=this.groupProperties(r);this.addPropertyGroup(t,"CORE PROPERTIES",s.core),this.addPropertyGroup(t,"ORGANIZATION",s.organization),s.user.length>0&&this.addPropertyGroup(t,"CUSTOM PROPERTIES",s.user),this.showMenu(t,e)}catch(t){console.error("PropertyVisibilityDropdown: Error showing menu:",t),this.plugin.app.workspace.trigger("notice","Failed to show properties menu")}}showMenu(e,t){e.showAtMouseEvent?e.showAtMouseEvent(t):e.showAtPosition?e.showAtPosition({x:t.clientX,y:t.clientY}):console.error("PropertyVisibilityDropdown: No menu show method available")}getCachedProperties(){return py&&qF===this.plugin||(py=this.computeAvailableProperties(),qF=this.plugin),py}groupProperties(e){let t={core:[],organization:[],user:[]};for(let r of e)t[r.category].push(r);return t}computeAvailableProperties(){let e=[];return e.push({id:"status",name:"Status Dot",category:"core"},{id:"priority",name:"Priority Dot",category:"core"},{id:"due",name:"Due Date",category:"core"},{id:"scheduled",name:"Scheduled Date",category:"core"},{id:"timeEstimate",name:"Time Estimate",category:"core"},{id:"totalTrackedTime",name:"Total Tracked Time",category:"core"},{id:"recurrence",name:"Recurrence",category:"core"},{id:"completedDate",name:"Completed Date",category:"core"},{id:"file.ctime",name:"Created Date",category:"core"},{id:"file.mtime",name:"Modified Date",category:"core"}),e.push({id:"projects",name:"Projects",category:"organization"},{id:"contexts",name:"Contexts",category:"organization"},{id:"tags",name:"Tags",category:"organization"}),this.addUserProperties(e),e}addUserProperties(e){try{let t=this.plugin.settings.userFields||[];for(let r of t)r.id&&r.displayName&&e.push({id:`user:${r.id}`,name:r.displayName,category:"user"})}catch(t){console.warn("PropertyVisibilityDropdown: Error loading user properties:",t)}}addPropertyGroup(e,t,r){if(r.length===0)return;e.addSeparator(),e.addItem(i=>{i.setTitle(t),i.setDisabled(!0)});let s=new Set(this.currentProperties);for(let i of r){let a=s.has(i.id);e.addItem(o=>{o.setTitle(i.name),o.setIcon(a?"check-square":"square"),o.onClick(()=>{this.toggleProperty(i.id)})})}}toggleProperty(e){try{let t=new Set(this.currentProperties);t.has(e)?t.delete(e):t.add(e);let r=Array.from(t);this.onUpdate(r)}catch(t){console.error("PropertyVisibilityDropdown: Error toggling property:",t)}}};var cS=class extends se.Modal{constructor(e,t){super(e),this.onSubmit=t}onOpen(){let{contentEl:e}=this;e.createEl("h2",{text:"Save view"});let t=new se.TextComponent(e).setPlaceholder("Enter view name...").onChange(s=>{this.name=s});t.inputEl.style.width="100%";let r=e.createDiv({cls:"modal-button-container"});new se.ButtonComponent(r).setButtonText("Save").setCta().onClick(()=>{this.name&&(this.onSubmit(this.name),this.close())})}onClose(){this.contentEl.empty()}},Xs=class extends ri{constructor(t,r,s,i,a,o="right",l){var c,d;super();this.savedViews=[];this.activeSavedView=null;this.isLoadingSavedView=!1;this.isSettingSavedView=!1;this.temporaryVisibleProperties=null;this.viewsButtonAlignment="right";this.isUserTyping=!1;this.viewOptionsConfig=null;this.ignoreNextClick=!1;this.sectionStates={filterBox:!1,filters:!0,display:!0,viewOptions:!1};this.enableGroupExpandCollapse=!0;this.forceShowExpandCollapse=!1;this.app=t,this.plugin=r,this.container=s,this.currentQuery=Pe.deepCloneFilterQuery(i),this.filterOptions=a,this.viewsButtonAlignment=o,this.enableGroupExpandCollapse=(c=l==null?void 0:l.enableGroupExpandCollapse)!=null?c:!0,this.forceShowExpandCollapse=(d=l==null?void 0:l.forceShowExpandCollapse)!=null?d:!1,this.viewType=l==null?void 0:l.viewType,this.dragDropHandler=new fy((u,h)=>{this.emit("reorderViews",u,h)}),this.ensureValidFilterQuery(),this.debouncedEmitQueryChange=(0,se.debounce)(()=>{!this.isLoadingSavedView&&this.activeSavedView&&(this.clearActiveSavedView(),this.updateFilterBuilder()),this.emit("queryChange",Pe.deepCloneFilterQuery(this.currentQuery)),this.updateFilterToggleBadge()},300),this.debouncedHandleSearchInput=(0,se.debounce)(()=>{this.handleSearchInput()},800),this.render(),this.updateUI(),this.setupClickOutsideHandlers()}ensureValidFilterQuery(){var t,r,s;if(!this.currentQuery||typeof this.currentQuery!="object"||this.currentQuery.type!=="group"||!Array.isArray(this.currentQuery.children)||typeof this.currentQuery.conjunction!="string"){let i=(t=this.currentQuery)!=null&&t.sortKey&&typeof this.currentQuery.sortKey=="string"?this.currentQuery.sortKey:"due",a=(r=this.currentQuery)!=null&&r.sortDirection&&typeof this.currentQuery.sortDirection=="string"?this.currentQuery.sortDirection:"asc",o=(s=this.currentQuery)!=null&&s.groupKey&&typeof this.currentQuery.groupKey=="string"?this.currentQuery.groupKey:"none";this.currentQuery={type:"group",id:Pe.generateId(),conjunction:"and",children:[],sortKey:i,sortDirection:a,groupKey:o}}}updateQuery(t){this.currentQuery=Pe.deepCloneFilterQuery(t),this.ensureValidFilterQuery(),this.detectActiveSavedView(),this.updateUI()}handleSearchInput(){var t;try{let r=((t=this.searchInput)==null?void 0:t.getValue().trim())||"";this.removeSearchConditions(),r&&this.addSearchConditionWithGrouping(r),this.updateFilterBuilder(),this.emitQueryChange(),setTimeout(()=>{this.isUserTyping=!1},1e3)}catch(r){console.error("Error handling search input:",r)}}removeSearchConditions(){if(!Array.isArray(this.currentQuery.children)){this.currentQuery.children=[];return}let t=this.currentQuery.children.findIndex(r=>r.type==="condition"&&r.property==="title"&&r.operator==="contains"&&r.id.startsWith("search_"));if(t!==-1&&(this.currentQuery.children.splice(t,1),this.currentQuery.children.length===1&&this.currentQuery.children[0].type==="group")){let r=this.currentQuery.children[0];this.currentQuery.children=r.children,this.currentQuery.conjunction=r.conjunction}}addSearchConditionWithGrouping(t){Array.isArray(this.currentQuery.children)||(this.currentQuery.children=[]);let r={type:"condition",id:`search_${Pe.generateId()}`,property:"title",operator:"contains",value:t},s=this.currentQuery.children.filter(i=>!(i.type==="condition"&&i.property==="title"&&i.operator==="contains"&&i.id.startsWith("search_")));if(s.length===0)this.currentQuery.children=[r];else{let i={type:"group",id:Pe.generateId(),conjunction:this.currentQuery.conjunction,children:s};this.currentQuery.children=[r,i],this.currentQuery.conjunction="and"}}updateSavedViews(t){this.savedViews=t,this.renderViewSelectorDropdown(),this.detectActiveSavedView()}detectActiveSavedView(){var r;if(this.isLoadingSavedView||this.isSettingSavedView)return;let t=null;for(let s=this.savedViews.length-1;s>=0;s--){let i=this.savedViews[s];if(this.queriesMatch(this.currentQuery,i.query)){t=i;break}}if(t&&((r=this.activeSavedView)==null?void 0:r.id)!==t.id){if(this.activeSavedView=t,this.temporaryVisibleProperties&&t.visibleProperties){let s=new Set(this.temporaryVisibleProperties),i=new Set(t.visibleProperties);s.size===i.size&&[...s].every(a=>i.has(a))&&(this.temporaryVisibleProperties=null)}this.updateViewSelectorButtonState(),this.emit("activeSavedViewChanged",t)}else!t&&this.activeSavedView&&(this.activeSavedView=null,this.updateViewSelectorButtonState(),this.emit("activeSavedViewChanged",null))}queriesMatch(t,r){let s=i=>{let a=Pe.deepCloneFilterQuery(i);return delete a.sortKey,delete a.sortDirection,delete a.groupKey,a};try{let i=s(t),a=s(r);return JSON.stringify(i)===JSON.stringify(a)}catch(i){return console.warn("Error comparing queries:",i),!1}}getCurrentQuery(){return Pe.deepCloneFilterQuery(this.currentQuery)}clearActiveSavedView(){this.activeSavedView=null,this.updateViewSelectorButtonState()}render(){try{typeof this.container.empty=="function"?this.container.empty():this.container.innerHTML="",typeof this.container.addClass=="function"?this.container.addClass("advanced-filter-bar"):this.container.classList&&this.container.classList.add("advanced-filter-bar"),this.renderTopControls()}catch(t){console.error("Error rendering FilterBar:",t),this.renderFallbackUI()}}renderFallbackUI(){try{if(this.container.children.length===0){typeof this.container.addClass=="function"?this.container.addClass("advanced-filter-bar"):this.container.classList&&this.container.classList.add("advanced-filter-bar");let t;typeof this.container.createDiv=="function"?t=this.container.createDiv({cls:"filter-bar-error"}):(t=document.createElement("div"),t.className="filter-bar-error",this.container.appendChild(t)),t.textContent="Filter bar temporarily unavailable"}}catch(t){console.error("Error rendering fallback FilterBar UI:",t)}}renderTopControls(){let t=this.container.createDiv("filter-bar__top-controls"),r=()=>{this.viewSelectorButton=new se.ButtonComponent(t).setButtonText("Views").setClass("filter-bar__templates-button").setTooltip("Saved filter views").onClick(()=>{this.toggleViewSelectorDropdown()}),this.viewSelectorButton.buttonEl.addClass("clickable-icon");let u=this.viewSelectorButton.buttonEl.createDiv("filter-bar__chevron-container");(0,se.setIcon)(u,"chevrons-up-down"),this.updateViewSelectorButtonState()},s=()=>{let u=new se.ButtonComponent(t).setTooltip("Toggle filter").setClass("filter-bar__filter-toggle").onClick(()=>{this.toggleMainFilterBox()});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let h=u.buttonEl.createSpan({cls:"button-icon"});(0,se.setIcon)(h,"list-filter");let f=u.buttonEl.createSpan({cls:"button-text",text:"Filters"});u.buttonEl.addEventListener("contextmenu",p=>{p.preventDefault(),p.stopPropagation(),this.hasActiveFilters()&&this.clearAllFilters()})},i=()=>{let u=new se.ButtonComponent(t).setTooltip("Configure visible properties").setClass("filter-bar__properties-button").onClick(p=>{let m=p instanceof MouseEvent?p:new MouseEvent("click",{bubbles:!0,cancelable:!0});this.showPropertiesDropdown(m)});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let h=u.buttonEl.createSpan({cls:"button-icon"});(0,se.setIcon)(h,"list");let f=u.buttonEl.createSpan({cls:"button-text",text:"Properties"})},a=()=>{this.searchInput=new se.TextComponent(t).setPlaceholder("Search tasks..."),this.searchInput.inputEl.addClass("filter-bar__search-input"),(0,se.setTooltip)(this.searchInput.inputEl,"Search task titles",{placement:"top"}),this.searchInput.onChange(()=>{this.isUserTyping=!0,this.debouncedHandleSearchInput()})},o=()=>{if(this.viewType==="advanced-calendar")return;let u=new se.ButtonComponent(t).setTooltip("Sort and group options").setClass("filter-bar__sort-group-button").onClick(p=>{this.showSortGroupContextMenu(p)});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let h=u.buttonEl.createSpan({cls:"button-icon"});(0,se.setIcon)(h,"arrow-up-down");let f=u.buttonEl.createSpan({cls:"button-text",text:"Sort"})},l=()=>{if(this.viewType==="subtask-widget")return;let u=new se.ButtonComponent(t).setTooltip("Create new task").setClass("filter-bar__new-task-button").onClick(()=>{this.createNewTask()});u.buttonEl.addClass("clickable-icon"),u.buttonEl.addClass("has-text-icon"),u.buttonEl.empty();let h=u.buttonEl.createSpan({cls:"button-icon"});(0,se.setIcon)(h,"plus");let f=u.buttonEl.createSpan({cls:"button-text",text:"New"})},c=()=>{let u=(this.currentQuery.groupKey||"none")!=="none";this.enableGroupExpandCollapse&&(u||this.forceShowExpandCollapse)&&(new se.ButtonComponent(t).setIcon("list-tree").setTooltip("Expand All Groups").setClass("filter-bar__expand-groups").onClick(()=>this.emit("expandAllGroups")).buttonEl.addClass("clickable-icon"),new se.ButtonComponent(t).setIcon("list-collapse").setTooltip("Collapse All Groups").setClass("filter-bar__collapse-groups").onClick(()=>this.emit("collapseAllGroups")).buttonEl.addClass("clickable-icon"))};this.viewsButtonAlignment==="left"?(r(),a(),o(),s(),i(),l()):(a(),o(),s(),i(),l(),r()),this.updateViewSelectorButtonState(),this.renderMainFilterBox(t);let d=this.viewsButtonAlignment==="left"?"filter-bar__view-selector-dropdown filter-bar__view-selector-dropdown--hidden filter-bar__view-selector-dropdown--left":"filter-bar__view-selector-dropdown filter-bar__view-selector-dropdown--hidden";this.viewSelectorDropdown=t.createDiv({cls:d}),this.renderViewSelectorDropdown()}renderMainFilterBox(t){this.mainFilterBox=t.createDiv("filter-bar__main-box"),this.sectionStates.filterBox||this.mainFilterBox.addClass("filter-bar__main-box--collapsed"),this.positionFilterBox(),this.renderFilterBuilder(this.mainFilterBox),this.renderViewOptions(this.mainFilterBox)}positionFilterBox(){if(!this.mainFilterBox)return;let t=this.container.querySelector(".filter-bar__filter-toggle");if(t){let r=this.container.getBoundingClientRect(),s=t.getBoundingClientRect(),i=this.mainFilterBox.getBoundingClientRect(),a=s.left-r.left,o=this.container.closest(".workspace-leaf");if(o){let l=o.getBoundingClientRect(),c=30,d=r.left+a+i.width,u=l.right-c;if(d>u){let h=d-u;a=a-h,a<0&&(a=0)}}this.mainFilterBox.style.left=`${a}px`}}setupClickOutsideHandlers(){this.abortController=new AbortController;let{signal:t}=this.abortController;document.addEventListener("click",r=>{this.handleDocumentClick(r)},{signal:t,passive:!0}),document.addEventListener("keydown",r=>{this.handleKeyDown(r)},{signal:t})}ignoreNextClickOutside(){this.ignoreNextClick=!0,this.ignoreClickTimeout&&window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=window.setTimeout(()=>{this.ignoreNextClick=!1,this.ignoreClickTimeout=void 0},100)}handleKeyDown(t){var r;if(t.key==="Escape"){if(this.sectionStates.filterBox){this.sectionStates.filterBox=!1,this.updateFilterBoxState(),t.preventDefault();return}this.viewSelectorDropdown&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),(r=this.viewSelectorButton)!=null&&r.buttonEl&&this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"),t.preventDefault())}}handleDocumentClick(t){var s;if(this.ignoreNextClick){this.ignoreNextClick=!1;return}let r=t.target;if(r){if(this.sectionStates.filterBox&&this.mainFilterBox&&this.container){let i=this.container.querySelector(".filter-bar__filter-toggle"),a=this.container.contains(r),o=i&&i.contains(r);!a&&!o&&(this.sectionStates.filterBox=!1,this.updateFilterBoxState())}this.viewSelectorDropdown&&((s=this.viewSelectorButton)!=null&&s.buttonEl)&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&!this.viewSelectorButton.buttonEl.contains(r)&&!this.viewSelectorDropdown.contains(r)&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"))}}toggleMainFilterBox(){this.sectionStates.filterBox=!this.sectionStates.filterBox,this.positionFilterBox(),this.updateFilterBoxState()}updateFilterBoxState(){let t=this.container.querySelector(".filter-bar__main-box"),r=this.container.querySelector(".filter-bar__filter-toggle");t&&t.classList.toggle("filter-bar__main-box--collapsed",!this.sectionStates.filterBox),r&&r.classList.toggle("filter-bar__filter-toggle--active",this.sectionStates.filterBox)}async deleteView(t){await ta(this.app,{title:"Delete View",message:`Are you sure you want to delete the view "${t.name}"?`,isDestructive:!0})&&this.emit("deleteView",t.id)}renderViewSelectorDropdown(){if(this.viewSelectorDropdown)if(this.viewSelectorDropdown.empty(),this.savedViews.length===0)this.viewSelectorDropdown.createDiv({text:"No saved views",cls:"filter-bar__view-empty-message"});else{let t=this.viewSelectorDropdown.createDiv("filter-bar__view-section"),r=t.createDiv({text:"Saved views",cls:"filter-bar__view-section-header"});(0,se.setTooltip)(r,"Your saved filter configurations",{placement:"top"}),this.savedViews.forEach((s,i)=>{let a=t.createDiv({cls:"filter-bar__view-item-container"});a.draggable=!0,a.setAttribute("data-view-index",i.toString());let o=a.createDiv({cls:"filter-bar__view-drag-handle"});(0,se.setTooltip)(o,"Drag to reorder views",{placement:"top"});let l=new se.ButtonComponent(a).setButtonText(s.name).setClass("filter-bar__view-item").setTooltip(`Load saved view: ${s.name}`).onClick(()=>{this.activeSavedView&&this.activeSavedView.id===s.id?this.clearAllFilters():this.loadSavedView(s)});this.activeSavedView&&this.activeSavedView.id===s.id&&(l.buttonEl.classList.add("filter-bar__view-item--active"),a.classList.add("filter-bar__view-item-container--active")),new se.ButtonComponent(a).setIcon("trash-2").setClass("filter-bar__view-delete").setTooltip("Delete view").onClick(async()=>{await ta(this.app,{title:"Delete View",message:`Are you sure you want to delete the view "${s.name}"?`,isDestructive:!0})&&this.emit("deleteView",s.id)}),this.dragDropHandler.setupDragAndDrop(a,i)}),this.dragDropHandler.setupGlobalHandlers(t)}}renderFilterBuilder(t){let r=t.createDiv("filter-bar__section"),s=r.createDiv("filter-bar__section-header"),i=s.createDiv("filter-bar__section-header-main");i.createSpan({text:"Filter",cls:"filter-bar__section-title"}),(0,se.setTooltip)(i,"Click to expand/collapse filter conditions",{placement:"top"}),this.activeSavedView&&i.createSpan({text:`(${this.activeSavedView.name})`,cls:"filter-bar__active-view-name"});let a=s.createDiv("filter-bar__section-header-actions");new se.ButtonComponent(a).setIcon("eraser").setTooltip("Clear all filters and groups").setClass("filter-bar__clear-all-button").onClick(()=>{this.clearAllFiltersKeepModalOpen()}).buttonEl.addClass("clickable-icon"),new se.ButtonComponent(a).setIcon("save").setTooltip("Save current filter as view").setClass("filter-bar__save-button").onClick(()=>{this.showSaveViewDialog()}).buttonEl.addClass("clickable-icon"),new se.ButtonComponent(a).setIcon("x").setTooltip("Close filter modal").setClass("filter-bar__close-modal-button").onClick(()=>{this.closeFilterModal()}).buttonEl.addClass("clickable-icon");let d=r.createDiv("filter-bar__section-content");this.sectionStates.filters||d.addClass("filter-bar__section-content--collapsed"),this.filterBuilder=d.createDiv("filter-bar__filter-builder"),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0),i.addEventListener("click",()=>{this.toggleSection("filters",s,d)})}renderFilterGroup(t,r,s,i,a){if(!r||typeof r!="object"){console.error("FilterBar: Invalid group object provided to renderFilterGroup");return}Array.isArray(r.children)||(r.children=[]);let o=t.createDiv("filter-bar__group"),l=o.createDiv("filter-bar__group-header"),c=l.createDiv("filter-bar__conjunction");(0,se.setTooltip)(c,"Choose whether ALL or ANY of the conditions must match",{placement:"top"}),new se.DropdownComponent(c).addOption("and","All").addOption("or","Any").setValue(r.conjunction||"and").onChange(h=>{r.conjunction=h,this.updateUI(),this.emitQueryChange()}),c.createSpan({text:"of the following are true:",cls:"filter-bar__conjunction-text"}),s>0&&i&&a!==void 0&&new se.ButtonComponent(l).setIcon("trash-2").setClass("filter-bar__delete-button").setTooltip("Delete filter group").onClick(()=>{this.removeFilterGroup(i,a)});let d=o.createDiv("filter-bar__children");r.children.forEach((h,f)=>{this.renderFilterNode(d,h,r,f,s+1)});let u=o.createDiv("filter-bar__group-actions");new se.ButtonComponent(u).setIcon("plus").setButtonText("Add filter").setClass("filter-bar__action-button").setClass("filter-bar__add-filter").setTooltip("Add a new filter condition").onClick(()=>{this.addFilterCondition(r)}),new se.ButtonComponent(u).setIcon("plus-circle").setButtonText("Add filter group").setClass("filter-bar__action-button").setClass("filter-bar__add-group").setTooltip("Add a nested filter group").onClick(()=>{this.addFilterGroup(r)})}renderFilterNode(t,r,s,i,a){r.type==="condition"?this.renderFilterCondition(t,r,s,i,a):r.type==="group"&&this.renderFilterGroup(t,r,a,s,i)}renderFilterCondition(t,r,s,i,a){var h;let o=t.createDiv("filter-bar__condition");o.createSpan({text:i===0?"where":s.conjunction,cls:"filter-bar__condition-prefix"});let l=Object.fromEntries([["","Select..."],...Td.map(f=>[f.id,f.label]),...((h=this.filterOptions.userProperties)==null?void 0:h.map(f=>[f.id,f.label]))||[]]),c=new se.DropdownComponent(o).addOptions(l).setValue(r.property);(0,se.setTooltip)(c.selectEl,"Choose which task property to filter by",{placement:"top"}),c.onChange(f=>{if(r.property=f,f!==""){let p=Td.find(m=>m.id===f);if(p&&p.supportedOperators.length>0){let m=p.supportedOperators[0];r.operator=m;let g=$p.find(y=>y.id===m);r.value=g!=null&&g.requiresValue?"":null}}this.updateUI(),this.emitQueryChange()});let d=new se.DropdownComponent(o);this.updateOperatorOptions(d,r.property),d.setValue(r.operator),(0,se.setTooltip)(d.selectEl,"Choose how to compare the property value",{placement:"top"}),d.onChange(f=>{r.operator=f,this.updateUI(),this.emitQueryChange()});let u=o.createDiv("filter-bar__value-container");this.renderValueInput(u,r),new se.ButtonComponent(o).setIcon("trash-2").setClass("filter-bar__delete-button").setTooltip("Delete condition").onClick(()=>{this.removeFilterCondition(s,i)})}updateOperatorOptions(t,r){var i;t.selectEl.empty();let s=Td.find(a=>a.id===r)||((i=this.filterOptions.userProperties)==null?void 0:i.find(a=>a.id===r));s&&s.supportedOperators.forEach(a=>{let o=$p.find(l=>l.id===a);o&&t.addOption(o.id,o.label)})}renderValueInput(t,r){var a;t.empty();let s=Td.find(o=>o.id===r.property)||((a=this.filterOptions.userProperties)==null?void 0:a.find(o=>o.id===r.property)),i=$p.find(o=>o.id===r.operator);if(!(!s||!i||!i.requiresValue))switch(s.valueInputType){case"text":this.renderTextInput(t,r);break;case"select":this.renderSelectInput(t,r,s);break;case"date":this.renderDateInput(t,r);break;case"number":this.renderNumberInput(t,r);break}}renderTextInput(t,r){let s=new se.TextComponent(t).setValue(String(r.value||"")).onChange(i=>{r.value=i||null,this.debouncedEmitQueryChange()});(0,se.setTooltip)(s.inputEl,"Enter the value to filter by",{placement:"top"})}renderSelectInput(t,r,s){let i=new se.DropdownComponent(t).addOption("","Select...");switch(s.id){case"status":this.filterOptions.statuses.forEach(a=>{i.addOption(a.value,a.label)});break;case"priority":this.filterOptions.priorities.forEach(a=>{i.addOption(a.value,a.label)});break;case"tags":this.filterOptions.tags.forEach(a=>{i.addOption(a,a)});break;case"contexts":this.filterOptions.contexts.forEach(a=>{i.addOption(a,a)});break;case"projects":this.filterOptions.projects.forEach(a=>{i.addOption(a,a)});break;case"path":this.filterOptions.folders.forEach(a=>{i.addOption(a,a)});break}if((0,se.setTooltip)(i.selectEl,`Select a ${s.label.toLowerCase()} to filter by`,{placement:"top"}),s.id==="projects"){let a=String(r.value||"");if(a.startsWith("[[")&&a.endsWith("]]")){let o=a.substring(2,a.length-2);i.setValue(o)}else i.setValue(a)}else if(s.id==="path"){let a=String(r.value||"");i.setValue(a===""?"(Root)":a)}else i.setValue(String(r.value||""));i.onChange(a=>{s.id==="projects"&&a?r.value=`[[${a}]]`:s.id==="path"&&a==="(Root)"?r.value="":r.value=a||null,this.emitQueryChange()})}renderDateInput(t,r){let s=t.createDiv("filter-date-input-container"),i=new se.TextComponent(s).setValue(String(r.value||"")).onChange(l=>{r.value=l||null,this.updateDateInputValidation(i,l);let c=(l||"").trim();(c===""||fT(c))&&this.debouncedEmitQueryChange()});i.setPlaceholder("today, 2024-12-25, next week..."),i.inputEl.addClass("filter-date-text-input"),(0,se.setTooltip)(i.inputEl,"Enter a date using natural language or ISO format",{placement:"top"}),this.updateDateInputValidation(i,String(r.value||""));let a=s.createEl("button",{cls:"filter-date-picker-button"});(0,se.setTooltip)(a,"Pick date & time",{placement:"top"}),(0,se.setIcon)(a,"calendar"),a.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),new Kr({currentValue:String(r.value||void 0),onSelect:d=>{i.setValue(d||""),r.value=d||null,this.updateDateInputValidation(i,i.getValue()),this.debouncedEmitQueryChange()}}).showAtElement(a)});let o=s.createEl("button",{cls:"filter-date-help-button",text:"?"});(0,se.setTooltip)(o,"Show natural language date examples",{placement:"top"}),o.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation(),this.showNaturalLanguageDateHelp(o)})}updateDateInputValidation(t,r){let s=t.inputEl;s.removeClass("is-valid","is-invalid","is-empty");let i=r.trim();i===""?s.addClass("is-empty"):fT(i)?s.addClass("is-valid"):s.addClass("is-invalid")}showNaturalLanguageDateHelp(t){document.querySelectorAll(".filter-date-help-tooltip").forEach(l=>l.remove());let r=document.body.createDiv("filter-date-help-tooltip");r.createEl("h4",{text:"Natural Language Dates"});let s=r.createEl("ul");["today","tomorrow","yesterday","next week","last week","in 3 days","2 days ago","in 1 week","2 weeks ago","2024-12-25","2024-12-25T14:30:00"].forEach(l=>{s.createEl("li",{text:l})});let a=t.getBoundingClientRect();r.style.position="absolute",r.style.top=`${a.bottom+5}px`,r.style.left=`${a.left}px`,r.style.zIndex="1000";let o=()=>{r.remove(),document.removeEventListener("click",o)};setTimeout(()=>{document.addEventListener("click",o)},100)}renderNumberInput(t,r){let s=new se.TextComponent(t).setValue(String(r.value||"")).onChange(i=>{r.value=i?parseFloat(i):null,this.debouncedEmitQueryChange()});s.inputEl.type="number",(0,se.setTooltip)(s.inputEl,"Enter a numeric value to filter by",{placement:"top"})}renderDisplaySection(t){let r=t.createDiv("filter-bar__section"),s=r.createDiv("filter-bar__section-header"),i=s.createDiv("filter-bar__section-header-main");i.createSpan({text:"Display & Organization",cls:"filter-bar__section-title"}),(0,se.setTooltip)(i,"Click to expand/collapse sorting and grouping options",{placement:"top"});let a=r.createDiv("filter-bar__section-content");this.sectionStates.display||a.addClass("filter-bar__section-content--collapsed"),this.displaySection=a;let o=this.displaySection.createDiv("filter-bar__display-controls"),l=o.createDiv("filter-bar__sort-container");l.createSpan({text:"Sort by:",cls:"filter-bar__label"}),new se.ButtonComponent(l).setClass("filter-bar__sort-direction").setTooltip("Toggle sort direction").onClick(()=>{this.currentQuery.sortDirection=this.currentQuery.sortDirection==="asc"?"desc":"asc",this.emitImmediateQueryChange()});let d={...{due:"Due Date",scheduled:"Scheduled Date",priority:"Priority",title:"Title",dateCreated:"Created Date",tags:"Tags"}},u=this.filterOptions.userProperties||[];for(let T of u)!(T!=null&&T.id)||!(T!=null&&T.label)||typeof T.id=="string"&&T.id.startsWith("user:")&&(d[T.id]=`${T.label}`);let h=new se.DropdownComponent(l).addOptions(d).setValue(this.currentQuery.sortKey||"due").onChange(T=>{this.currentQuery.sortKey=T,this.emitImmediateQueryChange()});(0,se.setTooltip)(h.selectEl,"Choose how to sort tasks",{placement:"top"});let f=o.createDiv("filter-bar__group-container");f.createSpan({text:"Group by:",cls:"filter-bar__label"});let m={...{none:"None",status:"Status",priority:"Priority",context:"Context",project:"Project",due:"Due Date",scheduled:"Scheduled Date",tags:"Tags"}},g=this.filterOptions.userProperties||[];for(let T of g)!(T!=null&&T.id)||!(T!=null&&T.label)||typeof T.id=="string"&&T.id.startsWith("user:")&&(m[T.id]=T.label);let y=new se.DropdownComponent(f).addOptions(m).setValue(this.currentQuery.groupKey||"none").onChange(T=>{this.currentQuery.groupKey=T,this.updateExpandCollapseButtons(),this.updateDisplaySection(),this.updateFilterToggleBadge(),this.emitQueryChange()});(0,se.setTooltip)(y.selectEl,"Group tasks by a common property",{placement:"top"}),i.addEventListener("click",()=>{this.toggleSection("display",s,a)})}removeFilterGroup(t,r){t.children.splice(r,1),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete(),this.emitQueryChange()}renderViewOptions(t){let r=t.createDiv("filter-bar__section");this.viewOptionsContainer=r.createDiv("filter-bar__view-options-container"),this.populateViewOptions()}setViewOptions(t){this.viewOptionsConfig=t,this.populateViewOptions()}populateViewOptions(){if(!this.viewOptionsContainer)return;this.viewOptionsContainer.empty();let t=this.viewOptionsConfig;if(!t||t.length===0){this.viewOptionsContainer.addClass("filter-bar__section--hidden");return}this.viewOptionsContainer.removeClass("filter-bar__section--hidden");let r=this.viewOptionsContainer.createDiv("filter-bar__section-header"),s=r.createDiv("filter-bar__section-header-main");s.createSpan({text:"View Options",cls:"filter-bar__section-title"}),(0,se.setTooltip)(s,"Click to expand/collapse view-specific options",{placement:"top"});let i=this.viewOptionsContainer.createDiv("filter-bar__section-content");this.sectionStates.viewOptions||i.addClass("filter-bar__section-content--collapsed"),t.forEach(a=>{let l=i.createDiv("filter-bar__view-option").createEl("label",{cls:"filter-bar__view-option-label"}),c=l.createEl("input",{type:"checkbox",cls:"filter-bar__view-option-checkbox"});c.checked=a.value,(0,se.setTooltip)(c,`Toggle ${a.label.toLowerCase()}`,{placement:"top"}),l.createSpan({text:a.label,cls:"filter-bar__view-option-text"}),c.addEventListener("change",()=>{a.onChange(c.checked)})}),s.addEventListener("click",()=>{this.toggleSection("viewOptions",r,i)})}addFilterCondition(t){let r={type:"condition",id:Pe.generateId(),property:"",operator:"contains",value:""};t.children.push(r),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete()}addFilterGroup(t){let r={type:"group",id:Pe.generateId(),conjunction:"and",children:[]};t.children.push(r),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete()}removeFilterCondition(t,r){t.children.splice(r,1),this.ignoreNextClickOutside(),this.updateFilterBuilderComplete(),this.emitQueryChange()}updateViewSelectorButtonState(){var t;(t=this.viewSelectorButton)!=null&&t.buttonEl&&(this.activeSavedView?this.viewSelectorButton.buttonEl.classList.add("filter-bar__templates-button--saved-view-active"):this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--saved-view-active"))}toggleViewSelectorDropdown(){if(!this.viewSelectorDropdown||!this.viewSelectorButton)return;let t=this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden");this.viewSelectorDropdown.classList.toggle("filter-bar__view-selector-dropdown--hidden",!t),t?this.viewSelectorButton.buttonEl.classList.add("filter-bar__templates-button--active"):this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active")}showSortGroupContextMenu(t){try{let r=new se.Menu,i={...{due:"Due Date",scheduled:"Scheduled Date",priority:"Priority",title:"Title",dateCreated:"Created Date",tags:"Tags"}},a=this.filterOptions.userProperties||[];for(let o of a)!(o!=null&&o.id)||!(o!=null&&o.label)||typeof o.id=="string"&&o.id.startsWith("user:")&&(i[o.id]=`${o.label}`);if(r.addItem(o=>{o.setTitle("SORT"),o.setDisabled(!0)}),Object.entries(i).forEach(([o,l])=>{r.addItem(c=>{c.setTitle(l),this.currentQuery.sortKey===o&&c.setIcon("check"),c.onClick(()=>{this.currentQuery.sortKey=o,this.emitImmediateQueryChange(),this.updateDisplaySection()})})}),r.addSeparator(),r.addItem(o=>{o.setTitle("ORDER"),o.setDisabled(!0)}),r.addItem(o=>{o.setTitle("Ascending"),this.currentQuery.sortDirection==="asc"&&o.setIcon("check"),o.onClick(()=>{this.currentQuery.sortDirection="asc",this.emitImmediateQueryChange(),this.updateDisplaySection()})}),r.addItem(o=>{o.setTitle("Descending"),this.currentQuery.sortDirection==="desc"&&o.setIcon("check"),o.onClick(()=>{this.currentQuery.sortDirection="desc",this.emitImmediateQueryChange(),this.updateDisplaySection()})}),this.viewType!=="agenda"){let l={...{none:"None",status:"Status",priority:"Priority",context:"Context",project:"Project",due:"Due Date",scheduled:"Scheduled Date",tags:"Tags"}},c=this.filterOptions.userProperties||[];for(let d of c)!(d!=null&&d.id)||!(d!=null&&d.label)||typeof d.id=="string"&&d.id.startsWith("user:")&&(l[d.id]=d.label);r.addSeparator(),r.addItem(d=>{d.setTitle("GROUP"),d.setDisabled(!0)}),Object.entries(l).forEach(([d,u])=>{r.addItem(h=>{h.setTitle(u),this.currentQuery.groupKey===d&&h.setIcon("check"),h.onClick(()=>{this.currentQuery.groupKey=d,this.updateExpandCollapseButtons(),this.updateDisplaySection(),this.updateFilterToggleBadge(),this.emitQueryChange()})})})}r.showAtMouseEvent(t)}catch(r){console.error("FilterBar: Error showing sort/group context menu:",r)}}createNewTask(){try{this.plugin&&typeof this.plugin.openTaskCreationModal=="function"?this.plugin.openTaskCreationModal():this.plugin&&typeof this.plugin.createTask=="function"?this.plugin.createTask():this.emit("createNewTask")}catch(t){console.error("FilterBar: Error creating new task:",t)}}showPropertiesDropdown(t){try{new my(this.getCurrentVisibleProperties(),this.plugin,this.handlePropertiesUpdate.bind(this)).show(t)}catch(r){console.error("FilterBar: Error showing properties dropdown:",r),this.plugin.app.workspace.trigger("notice","Failed to show properties menu")}}handlePropertiesUpdate(t){if(!Array.isArray(t)){console.warn("FilterBar: Invalid properties array received:",t);return}this.temporaryVisibleProperties=t,this.emit("propertiesChanged",t)}getCurrentVisibleProperties(){var t;return this.temporaryVisibleProperties||((t=this.activeSavedView)==null?void 0:t.visibleProperties)||this.plugin.settings.defaultVisibleProperties||this.getDefaultFallbackProperties()}getDefaultFallbackProperties(){return["status","priority","due","scheduled","projects","contexts","tags"]}getCurrentSavedView(){return this.activeSavedView}setActiveSavedView(t){if(this.isSettingSavedView=!0,this.activeSavedView=t,t&&this.temporaryVisibleProperties&&t.visibleProperties){let r=new Set(this.temporaryVisibleProperties),s=new Set(t.visibleProperties);r.size===s.size&&[...r].every(i=>s.has(i))&&(this.temporaryVisibleProperties=null)}this.updateViewSelectorButtonState(),this.emit("activeSavedViewChanged",t),this.isSettingSavedView=!1}toggleSection(t,r,s){this.sectionStates[t]=!this.sectionStates[t];let i=this.sectionStates[t];r.classList.toggle("filter-bar__section-header--collapsed",!i),s.classList.toggle("filter-bar__section-content--collapsed",!i)}showSaveViewDialog(){new cS(this.app,t=>{let r=this.getCurrentViewOptions(),s=this.getCurrentVisibleProperties();this.emit("saveView",{name:t,query:this.currentQuery,viewOptions:r,visibleProperties:s}),this.toggleViewSelectorDropdown()}).open()}getCurrentViewOptions(){if(!this.viewOptionsConfig||this.viewOptionsConfig.length===0)return;let t={};return this.viewOptionsConfig.forEach(r=>{t[r.id]=r.value}),t}clearAllFilters(){var t;this.currentQuery={type:"group",id:Pe.generateId(),conjunction:"and",children:[],sortKey:this.currentQuery.sortKey||"due",sortDirection:this.currentQuery.sortDirection||"asc",groupKey:"none"},this.activeSavedView=null,this.temporaryVisibleProperties=null,this.searchInput&&this.searchInput.setValue(""),this.updateFilterBuilder(),this.updateDisplaySection(),this.updateViewSelectorButtonState(),this.emitQueryChange(),this.viewSelectorDropdown&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),(t=this.viewSelectorButton)!=null&&t.buttonEl&&this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"))}clearAllFiltersKeepModalOpen(){var t;this.currentQuery={type:"group",id:Pe.generateId(),conjunction:"and",children:[],sortKey:this.currentQuery.sortKey||"due",sortDirection:this.currentQuery.sortDirection||"asc",groupKey:"none"},this.activeSavedView=null,this.temporaryVisibleProperties=null,this.searchInput&&this.searchInput.setValue(""),this.updateFilterBuilder(),this.updateDisplaySection(),this.updateViewSelectorButtonState(),this.updateFilterToggleBadge(),setTimeout(()=>{this.emitQueryChangeIfComplete()},100),this.viewSelectorDropdown&&!this.viewSelectorDropdown.classList.contains("filter-bar__view-selector-dropdown--hidden")&&(this.viewSelectorDropdown.classList.add("filter-bar__view-selector-dropdown--hidden"),(t=this.viewSelectorButton)!=null&&t.buttonEl&&this.viewSelectorButton.buttonEl.classList.remove("filter-bar__templates-button--active"))}closeFilterModal(){this.sectionStates.filterBox=!1,this.updateFilterBoxState()}loadSavedView(t){this.isLoadingSavedView=!0,this.currentQuery=Pe.deepCloneFilterQuery(t.query),this.activeSavedView=t,this.temporaryVisibleProperties=null,this.render(),this.emitQueryChange(),t.viewOptions&&this.emit("loadViewOptions",t.viewOptions),t.visibleProperties&&this.emit("propertiesChanged",t.visibleProperties),this.emit("activeSavedViewChanged",t),this.toggleViewSelectorDropdown(),this.updateViewSelectorButtonState(),this.isLoadingSavedView=!1}updateUI(){this.syncSearchInput(),this.render(),this.updateViewSelectorButtonState(),this.updateFilterToggleBadge()}updateDisplaySection(){try{this.updateExpandCollapseButtons()}catch(t){console.error("Error updating display section:",t)}}updateExpandCollapseButtons(){try{let t=(this.currentQuery.groupKey||"none")!=="none",r=this.enableGroupExpandCollapse&&(t||this.forceShowExpandCollapse),s=this.container.querySelector(".filter-bar__expand-groups"),i=this.container.querySelector(".filter-bar__collapse-groups");s&&(s.style.display=r?"":"none"),i&&(i.style.display=r?"":"none")}catch(t){console.error("Error updating expand/collapse buttons:",t)}}updateFilterBuilder(){var t,r;try{if(this.filterBuilder&&this.filterBuilder.isConnected){let s=(t=this.searchInput)==null?void 0:t.getValue(),i=((r=this.searchInput)==null?void 0:r.inputEl)===document.activeElement;this.filterBuilder.empty(),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0),this.searchInput&&s!==void 0&&(this.searchInput.setValue(s),i&&this.searchInput.inputEl.focus()),this.updateFilterBoxState()}}catch(s){console.error("Error updating filter builder:",s)}}updateFilterBuilderComplete(){var t,r;try{if(this.filterBuilder&&this.filterBuilder.isConnected){let s=(t=this.searchInput)==null?void 0:t.getValue(),i=((r=this.searchInput)==null?void 0:r.inputEl)===document.activeElement;this.filterBuilder.empty(),this.renderFilterGroup(this.filterBuilder,this.currentQuery,0),this.searchInput&&s!==void 0&&(this.searchInput.setValue(s),i&&this.searchInput.inputEl.focus()),this.updateFilterBoxState()}}catch(s){console.error("Error updating filter builder completely:",s),this.render()}}syncSearchInput(){if(!this.searchInput||this.isUserTyping)return;if(!this.currentQuery||!Array.isArray(this.currentQuery.children)){this.searchInput.setValue("");return}let t=this.currentQuery.children.find(r=>r.type==="condition"&&r.property==="title"&&r.operator==="contains"&&r.id.startsWith("search_"));this.searchInput.setValue(String((t==null?void 0:t.value)||""))}emitQueryChange(){!this.isLoadingSavedView&&this.activeSavedView&&(this.clearActiveSavedView(),this.updateFilterBuilder()),this.updateFilterToggleBadge(),this.emitQueryChangeIfComplete()}emitImmediateQueryChange(){!this.isLoadingSavedView&&this.activeSavedView&&(this.clearActiveSavedView(),this.updateFilterBuilder()),this.updateFilterToggleBadge(),this.emit("queryChange",Pe.deepCloneFilterQuery(this.currentQuery))}emitQueryChangeIfComplete(){this.isQueryMeaningful(this.currentQuery)&&this.emit("queryChange",Pe.deepCloneFilterQuery(this.currentQuery))}isQueryMeaningful(t){return t.children.length===0?!0:this.hasCompleteConditions(t)}hasCompleteConditions(t){for(let r of t.children)if(r.type==="condition"){if(Pe.isFilterNodeComplete(r))return!0}else if(r.type==="group"&&this.hasCompleteConditions(r))return!0;return!1}updateFilterOptions(t){this.filterOptions=t,this.updateUI()}hasActiveFilters(){var t;try{if(this.activeSavedView)return!0;let r=this.isQueryMeaningful(this.currentQuery)&&this.currentQuery.children.length>0,s=((t=this.currentQuery.groupKey)!=null?t:"none")!=="none";return r||!!s}catch(r){return!1}}updateFilterToggleBadge(){let t=null;if(typeof this.container.querySelector=="function"&&(t=this.container.querySelector(".filter-bar__filter-toggle")),!t)return;let r=this.hasActiveFilters();t.classList.toggle("has-active-filters",r),(0,se.setTooltip)(t,r?"Active filters \u2013 Click to modify, right-click to clear":"Toggle filter",{placement:"top"})}getCurrentFilterOptions(){return this.filterOptions}async forceRefreshOptions(t){let r=await t.getFilterOptions();this.updateFilterOptions(r)}destroy(){try{this.container&&this.container.isConnected&&this.container.empty(),this.removeAllListeners(),this.abortController&&(this.abortController.abort(),this.abortController=void 0),this.ignoreClickTimeout&&(window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=void 0)}catch(t){console.error("Error destroying FilterBar:",t);try{this.removeAllListeners(),this.abortController&&(this.abortController.abort(),this.abortController=void 0),this.ignoreClickTimeout&&(window.clearTimeout(this.ignoreClickTimeout),this.ignoreClickTimeout=void 0)}catch(r){console.error("Error during FilterBar cleanup fallback:",r)}}}};Fe();Lt();var gy=class extends je.ItemView{constructor(t,r){super(t);this.calendar=null;this.listeners=[];this.functionListeners=[];this.resizeObserver=null;this.resizeTimeout=null;this.filterBar=null;this.pendingRecurringUpdate=!1;this.headerCollapsed=!0;this.plugin=r,this.showScheduled=this.plugin.settings.calendarViewSettings.defaultShowScheduled,this.showDue=this.plugin.settings.calendarViewSettings.defaultShowDue,this.showTimeEntries=this.plugin.settings.calendarViewSettings.defaultShowTimeEntries,this.showRecurring=this.plugin.settings.calendarViewSettings.defaultShowRecurring,this.showICSEvents=this.plugin.settings.calendarViewSettings.defaultShowICSEvents,this.showTimeblocks=this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.showAllDaySlot=!0,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"}}getViewType(){return ui}getDisplayText(){return"Advanced Calendar"}getIcon(){return"calendar-range"}async onOpen(){var i,a,o,l;await this.plugin.onReady(),await this.plugin.waitForMigration();let t=this.plugin.viewStateManager.getFilterState(ui);t?this.currentQuery=t:this.plugin.filterService&&(this.currentQuery=this.plugin.filterService.createDefaultQuery());let r=this.plugin.viewStateManager.getViewPreferences(ui);r&&(this.showScheduled=r.showScheduled,this.showDue=r.showDue,this.showTimeEntries=r.showTimeEntries,this.showRecurring=r.showRecurring,this.showICSEvents=(i=r.showICSEvents)!=null?i:this.plugin.settings.calendarViewSettings.defaultShowICSEvents,this.showTimeblocks=(a=r.showTimeblocks)!=null?a:this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.headerCollapsed=(o=r.headerCollapsed)!=null?o:!0,this.showAllDaySlot=(l=r.showAllDaySlot)!=null?l:!0);let s=async()=>{let c=this.contentEl;c.empty(),c.addClass("tasknotes-plugin"),c.addClass("advanced-calendar-view"),await this.renderView(),this.registerEvents(),await this.initializeCalendar()};await s(),this.contentEl.onWindowMigrated(s)}async renderView(){let{contentEl:t}=this;t.empty();let r=t.createDiv({cls:"advanced-calendar-view__container"});await this.createHeader(r),r.createDiv({cls:"advanced-calendar-view__calendar-container",attr:{id:"advanced-calendar"}})}async createHeader(t){let r=t.createDiv({cls:"advanced-calendar-view__header"}),i=r.createDiv({cls:"advanced-calendar-view__mobile-toggle"}).createEl("button",{text:this.headerCollapsed?"Show filters":"Hide filters",cls:"advanced-calendar-view__collapse-btn"});i.addEventListener("click",()=>{this.headerCollapsed=!this.headerCollapsed,i.textContent=this.headerCollapsed?"Show filters":"Hide filters",this.saveViewPreferences(),this.updateHeaderVisibility()});let o=r.createDiv({cls:`advanced-calendar-view__main-row ${this.headerCollapsed?"collapsed":"expanded"}`}).createDiv({cls:"filter-bar-container"});await this.waitForCacheReady();let l=await this.plugin.filterService.getFilterOptions();this.filterBar=new Xs(this.app,this.plugin,o,this.currentQuery,l,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"advanced-calendar"});let c=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(c),this.filterBar.on("saveView",({name:d,query:u,viewOptions:h,visibleProperties:f})=>{let p=this.plugin.viewStateManager.saveView(d,u,h,f);this.filterBar.setActiveSavedView(p)}),this.filterBar.on("deleteView",d=>{this.plugin.viewStateManager.deleteView(d)}),this.filterBar.on("loadViewOptions",d=>{this.applyViewOptions(d)}),this.plugin.viewStateManager.on("saved-views-changed",d=>{var u;(u=this.filterBar)==null||u.updateSavedViews(d)}),this.filterBar.on("reorderViews",(d,u)=>{this.plugin.viewStateManager.reorderSavedViews(d,u)}),this.filterBar.on("manageViews",()=>{console.log("Manage views requested")}),this.filterBar.on("queryChange",async d=>{this.currentQuery=d,await this.plugin.viewStateManager.setFilterState(ui,d),this.refreshEvents()}),this.setupViewOptions()}updateHeaderVisibility(){let t=this.contentEl.querySelector(".advanced-calendar-view__main-row");t&&(t.className=`advanced-calendar-view__main-row ${this.headerCollapsed?"collapsed":"expanded"}`),this.calendar&&this.calendar.setOption("headerToolbar",this.getHeaderToolbarConfig())}setupViewOptions(){if(!this.filterBar)return;let t=[{id:"icsEvents",label:"Calendar subscriptions",value:this.showICSEvents,onChange:r=>{this.showICSEvents=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"timeEntries",label:"Time entries",value:this.showTimeEntries,onChange:r=>{this.showTimeEntries=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"timeblocks",label:"Timeblocks",value:this.showTimeblocks,onChange:r=>{this.showTimeblocks=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"scheduled",label:"Scheduled dates",value:this.showScheduled,onChange:r=>{this.showScheduled=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"due",label:"Due dates",value:this.showDue,onChange:r=>{this.showDue=r,this.saveViewPreferences(),this.refreshEvents()}},{id:"allDaySlot",label:"All-day slot",value:this.showAllDaySlot,onChange:r=>{this.showAllDaySlot=r,this.saveViewPreferences(),this.calendar&&this.calendar.setOption("allDaySlot",r)}}];if(!this.plugin.settings.calendarViewSettings.enableTimeblocking){let r=t.findIndex(s=>s.id==="timeblocks");r!==-1&&t.splice(r,1)}this.filterBar.setViewOptions(t)}getViewOptionsConfig(){let t=[{id:"scheduled",label:"Scheduled tasks",value:this.showScheduled},{id:"due",label:"Due dates",value:this.showDue},{id:"timeEntries",label:"Time entries",value:this.showTimeEntries},{id:"recurring",label:"Recurring tasks",value:this.showRecurring},{id:"icsEvents",label:"Calendar subscriptions",value:this.showICSEvents}];return this.plugin.settings.calendarViewSettings.enableTimeblocking&&t.push({id:"timeblocks",label:"Timeblocks",value:this.showTimeblocks}),t}onViewOptionChange(t,r){switch(t){case"scheduled":this.showScheduled=r;break;case"due":this.showDue=r;break;case"timeEntries":this.showTimeEntries=r;break;case"recurring":this.showRecurring=r;break;case"icsEvents":this.showICSEvents=r;break;case"timeblocks":this.showTimeblocks=r;break;case"allDaySlot":this.showAllDaySlot=r,this.calendar&&this.calendar.setOption("allDaySlot",r);break}this.saveViewPreferences(),this.refreshEvents(),this.setupViewOptions()}getHeaderToolbarConfig(){let t=this.contentEl.ownerDocument.defaultView||window;if(this.headerCollapsed&&t.innerWidth<=768)return!1;let r=this.contentEl.querySelector(".advanced-calendar-view__calendar-container"),a={left:"prev,next today",center:(r?r.getBoundingClientRect().width:t.innerWidth)<=600?"":"title",right:"refreshICS multiMonthYear,dayGridMonth,timeGridWeek,timeGridCustom,timeGridDay"};return console.log("Header toolbar config:",a),a}getCustomButtons(){let t={refreshICS:{text:"Refresh",hint:"Refresh Calendar Subscriptions",click:()=>{console.log("Refresh ICS button clicked!"),this.handleRefreshClick()}}};return console.log("Custom buttons:",t),t}async handleRefreshClick(){if(!this.plugin.icsSubscriptionService){new je.Notice("ICS subscription service not available");return}try{await this.plugin.icsSubscriptionService.refreshAllSubscriptions(),new je.Notice("All calendar subscriptions refreshed successfully"),this.refreshEvents()}catch(t){console.error("Error refreshing subscriptions:",t),new je.Notice("Failed to refresh some calendar subscriptions")}}openScheduleTasksModal(){new uy(this.app,this.plugin,(r,s)=>{r&&this.scheduleTask(r,s)}).open()}async scheduleTask(t,r){try{let s;if(r!=null&&r.date)r.allDay?s=x(r.date,"yyyy-MM-dd"):r.time?s=x(r.date,"yyyy-MM-dd")+"T"+r.time:s=x(r.date,"yyyy-MM-dd")+"T09:00";else{let i=Ge();s=x(i,"yyyy-MM-dd")+"T09:00"}await this.plugin.taskService.updateProperty(t,"scheduled",s)}catch(s){console.error("Error scheduling task:",s)}}async initializeCalendar(){let t=this.contentEl.querySelector("#advanced-calendar");if(!t){console.error("Calendar element not found");return}let r=this.plugin.settings.calendarViewSettings;this.updateTodayHighlight();let s=this.getCustomButtons(),i=this.getHeaderToolbarConfig();console.log("Initializing calendar with customButtons:",s),console.log("Initializing calendar with headerToolbar:",i),this.calendar=new ng(t,{plugins:[_R,LR,FR,UR],initialView:r.defaultView,headerToolbar:i,customButtons:s,views:{timeGridCustom:{type:"timeGrid",duration:{days:r.customDayCount||3},buttonText:`${r.customDayCount||3} days`}},height:"100%",editable:!0,droppable:!0,selectable:!0,selectMirror:r.selectMirror,locale:this.getUserLocale(),firstDay:r.firstDay,weekNumbers:r.weekNumbers,weekends:r.showWeekends,nowIndicator:r.nowIndicator,navLinks:!0,navLinkDayClick:this.handleDateTitleClick.bind(this),slotMinTime:r.slotMinTime,slotMaxTime:r.slotMaxTime,scrollTime:r.scrollTime,slotDuration:r.slotDuration,slotLabelInterval:this.getSlotLabelInterval(r.slotDuration),allDaySlot:this.showAllDaySlot,eventTimeFormat:this.getTimeFormat(r.timeFormat),slotLabelFormat:this.getTimeFormat(r.timeFormat),select:this.handleDateSelect.bind(this),eventClick:this.handleEventClick.bind(this),eventDrop:this.handleEventDrop.bind(this),eventAllow:a=>!0,eventResize:this.handleEventResize.bind(this),drop:this.handleExternalDrop.bind(this),eventReceive:this.handleEventReceive.bind(this),eventDidMount:this.handleEventDidMount.bind(this),events:this.getCalendarEvents.bind(this)}),requestAnimationFrame(()=>{this.calendar&&(this.calendar.render(),this.setupResizeHandling(),this.refreshEvents())})}saveViewPreferences(){let t={showScheduled:this.showScheduled,showDue:this.showDue,showTimeEntries:this.showTimeEntries,showRecurring:this.showRecurring,showICSEvents:this.showICSEvents,showTimeblocks:this.showTimeblocks,headerCollapsed:this.headerCollapsed,showAllDaySlot:this.showAllDaySlot};this.plugin.viewStateManager.setViewPreferences(ui,t)}applyViewOptions(t){t.hasOwnProperty("showScheduled")&&(this.showScheduled=t.showScheduled),t.hasOwnProperty("showDue")&&(this.showDue=t.showDue),t.hasOwnProperty("showTimeEntries")&&(this.showTimeEntries=t.showTimeEntries),t.hasOwnProperty("showRecurring")&&(this.showRecurring=t.showRecurring),t.hasOwnProperty("showICSEvents")&&(this.showICSEvents=t.showICSEvents),t.hasOwnProperty("showTimeblocks")&&(this.showTimeblocks=t.showTimeblocks),t.hasOwnProperty("showAllDaySlot")&&(this.showAllDaySlot=t.showAllDaySlot,this.calendar&&this.calendar.setOption("allDaySlot",this.showAllDaySlot)),this.setupViewOptions(),this.refreshEvents()}setupResizeHandling(){if(!this.calendar)return;this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.functionListeners.forEach(a=>a()),this.functionListeners=[];let t=this.contentEl.ownerDocument.defaultView||window,r=()=>{this.resizeTimeout&&t.clearTimeout(this.resizeTimeout),this.resizeTimeout=t.setTimeout(()=>{this.calendar&&(this.calendar.updateSize(),this.updateHeaderVisibility())},150)};if(t.ResizeObserver){this.resizeObserver=new t.ResizeObserver(r);let a=this.contentEl.querySelector(".advanced-calendar-view__calendar-container");a&&this.resizeObserver.observe(a)}let s=this.plugin.app.workspace.on("layout-change",r);this.listeners.push(s),t.addEventListener("resize",r),this.functionListeners.push(()=>t.removeEventListener("resize",r));let i=this.plugin.app.workspace.on("active-leaf-change",a=>{a===this.leaf&&setTimeout(r,100)});this.listeners.push(i)}getSlotLabelInterval(t){switch(t){case"00:15:00":return"01:00:00";case"00:30:00":return"01:00:00";case"01:00:00":return"01:00:00";default:return"01:00:00"}}getUserLocale(){let t=this.plugin.settings.calendarViewSettings.locale;if(t&&t.trim()!=="")return t.trim();if(navigator.language)return navigator.language;if(navigator.languages&&navigator.languages.length>0)return navigator.languages[0];let r=navigator.userLanguage||navigator.browserLanguage;return r||"en"}getTimeFormat(t){return t==="12"?{hour:"numeric",minute:"2-digit",omitZeroMinute:!0,hour12:!0}:{hour:"2-digit",minute:"2-digit",hour12:!1}}async getCalendarEvents(){var r;let t=[];try{let s=await this.plugin.filterService.getGroupedTasks(this.currentQuery),i=[];for(let h of s.values())i.push(...h);let a=(r=this.calendar)==null?void 0:r.view,o=Ge(),l=(a==null?void 0:a.activeStart)||hr(o),c=(a==null?void 0:a.activeEnd)||zD(o),{utcStart:d,utcEnd:u}=oA(l,c);for(let h of i){if(h.recurrence){if(!h.scheduled)continue;if(this.showRecurring){let f=this.generateRecurringTaskInstances(h,d,u);t.push(...f)}}else{let f=!!h.scheduled,p=!!h.due;if(!f&&!p)continue;if(this.showScheduled&&f){let m=this.createScheduledEvent(h);m&&t.push(m)}if(this.showDue&&p){let m=this.createDueEvent(h);m&&t.push(m)}}if(this.showTimeEntries&&h.timeEntries){let f=this.createTimeEntryEvents(h);t.push(...f)}}if(this.showICSEvents&&this.plugin.icsSubscriptionService){let h=this.plugin.icsSubscriptionService.getAllEvents();for(let f of h){let p=this.createICSEvent(f);p&&t.push(p)}}}catch(s){console.error("Error getting calendar events:",s)}if(this.showTimeblocks&&this.plugin.settings.calendarViewSettings.enableTimeblocking)try{let s=await this.getTimeblockEvents();t.push(...s)}catch(s){console.error("Error getting timeblock events:",s)}return t}createScheduledEvent(t){if(!t.scheduled)return null;let r=Wt(t.scheduled),s=t.scheduled,i;if(r&&t.timeEstimate){let c=$t(s),d=new Date(c.getTime()+t.timeEstimate*60*1e3);i=x(d,"yyyy-MM-dd'T'HH:mm")}let a=this.plugin.priorityManager.getPriorityConfig(t.priority),o=(a==null?void 0:a.color)||"var(--color-accent)",l=this.plugin.statusManager.isCompletedStatus(t.status);return{id:`scheduled-${t.path}`,title:t.title,start:s,end:i,allDay:!r,backgroundColor:"transparent",borderColor:o,textColor:o,editable:!0,extendedProps:{taskInfo:t,eventType:"scheduled",isCompleted:l}}}createDueEvent(t){if(!t.due)return null;let r=Wt(t.due),s=t.due,i;if(r){let d=$t(s),u=new Date(d.getTime()+1800*1e3);i=x(u,"yyyy-MM-dd'T'HH:mm")}let a=this.plugin.priorityManager.getPriorityConfig(t.priority),o=(a==null?void 0:a.color)||"var(--color-orange)",l=this.hexToRgba(o,.15),c=this.plugin.statusManager.isCompletedStatus(t.status);return{id:`due-${t.path}`,title:`DUE: ${t.title}`,start:s,end:i,allDay:!r,backgroundColor:l,borderColor:o,textColor:o,editable:!1,extendedProps:{taskInfo:t,eventType:"due",isCompleted:c}}}hexToRgba(t,r){t=t.replace("#","");let s=parseInt(t.substring(0,2),16),i=parseInt(t.substring(2,4),16),a=parseInt(t.substring(4,6),16);return`rgba(${s}, ${i}, ${a}, ${r})`}createTimeEntryEvents(t){if(!t.timeEntries)return[];let r=this.plugin.statusManager.isCompletedStatus(t.status);return t.timeEntries.filter(s=>s.endTime).map((s,i)=>({id:`timeentry-${t.path}-${i}`,title:t.title,start:s.startTime,end:s.endTime,allDay:!1,backgroundColor:"var(--color-base-50)",borderColor:"var(--color-base-40)",textColor:"var(--text-on-accent)",editable:!1,extendedProps:{taskInfo:t,eventType:"timeEntry",isCompleted:r,timeEntryIndex:i}}))}createICSEvent(t){try{let r=this.plugin.icsSubscriptionService.getSubscriptions().find(a=>a.id===t.subscriptionId);if(!r||!r.enabled)return null;let s=this.hexToRgba(r.color,.2),i=r.color;return{id:t.id,title:t.title,start:t.start,end:t.end,allDay:t.allDay,backgroundColor:s,borderColor:i,textColor:i,editable:!1,extendedProps:{icsEvent:t,eventType:"ics",subscriptionName:r.name}}}catch(r){return console.error("Error creating ICS event:",r),null}}generateRecurringTaskInstances(t,r,s){if(!t.recurrence||!t.scheduled)return[];let i=[],a=Wt(t.scheduled),o=this.getRecurringTime(t),l=ve(t.scheduled),c=a?Er(t.scheduled):null,d=c?`${l}T${c}`:l,u=this.createNextScheduledEvent(t,d,l,c||"09:00");u&&i.push(u);let h=Rd(t,r,s);for(let f of h){let p=me(f);if(p===l)continue;let m=a?`${p}T${o}`:p,g=this.createRecurringEvent(t,m,p,o);g&&i.push(g)}return i}getRecurringTime(t){if(t.recurrence&&typeof t.recurrence=="string"){let r=t.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/);if(r&&r[1].includes("T")){let s=r[1].split("T")[1];if(s.length>=4){let i=s.slice(0,2),a=s.slice(2,4);return`${i}:${a}`}}}if(t.scheduled){let r=Er(t.scheduled);if(r)return r}return"09:00"}createNextScheduledEvent(t,r,s,i){var h;let a=Wt(r),o;if(a&&t.timeEstimate){let f=$t(r),p=new Date(f.getTime()+t.timeEstimate*60*1e3);o=x(p,"yyyy-MM-dd'T'HH:mm")}let l=this.plugin.priorityManager.getPriorityConfig(t.priority),c=(l==null?void 0:l.color)||"var(--color-accent)",d=((h=t.complete_instances)==null?void 0:h.includes(s))||!1,u=d?"rgba(0,0,0,0.3)":"transparent";return{id:`next-scheduled-${t.path}-${s}`,title:t.title,start:r,end:o,allDay:!a,backgroundColor:u,borderColor:c,textColor:c,editable:!0,extendedProps:{taskInfo:t,eventType:"scheduled",isCompleted:d,isNextScheduledOccurrence:!0,instanceDate:s,recurringTemplateTime:i}}}createRecurringEvent(t,r,s,i){var h;let a=Wt(r),o;if(a&&t.timeEstimate){let f=$t(r),p=new Date(f.getTime()+t.timeEstimate*60*1e3);o=x(p,"yyyy-MM-dd'T'HH:mm")}let l=this.plugin.priorityManager.getPriorityConfig(t.priority),c=(l==null?void 0:l.color)||"var(--color-accent)",d=((h=t.complete_instances)==null?void 0:h.includes(s))||!1,u=d?"rgba(0,0,0,0.3)":"transparent";return{id:`recurring-${t.path}-${s}`,title:t.title,start:r,end:o,allDay:!a,backgroundColor:u,borderColor:c,textColor:c,editable:!0,extendedProps:{taskInfo:t,eventType:"recurring",isCompleted:d,isRecurringInstance:!0,isPatternInstance:!0,instanceDate:s,recurringTemplateTime:i}}}handleDateSelect(t){var l;let{start:r,end:s,allDay:i,jsEvent:a}=t;this.plugin.settings.calendarViewSettings.enableTimeblocking&&this.showTimeblocks&&a&&a.shiftKey?this.handleTimeblockCreation(r,s,i):this.handleTaskCreation(r,s,i),(l=this.calendar)==null||l.unselect()}parseSlotDurationToMinutes(t){let r=t.split(":"),s=parseInt(r[0],10),i=parseInt(r[1],10);return s*60+i}handleTaskCreation(t,r,s){let i=s?x(t,"yyyy-MM-dd"):x(t,"yyyy-MM-dd'T'HH:mm"),a=Math.round((r.getTime()-t.getTime())/(1e3*60)),o=this.plugin.settings.calendarViewSettings.slotDuration,l=this.parseSlotDurationToMinutes(o),c=!s&&a>l,d={scheduled:i};s||c&&(d.timeEstimate=a),new el(this.app,this.plugin,{prePopulatedValues:d}).open()}handleTimeblockCreation(t,r,s){if(s){new je.Notice("Timeblocks must have specific times. Please select a time range in week or day view.");return}let i=x(t,"yyyy-MM-dd"),a=x(t,"HH:mm"),o=x(r,"HH:mm");new hy(this.app,this.plugin,{date:i,startTime:a,endTime:o}).open()}async handleDateTitleClick(t){try{if(!(0,En.appHasDailyNotesPluginLoaded)()){new je.Notice("Daily Notes core plugin is not enabled. Please enable it in Settings > Core plugins.");return}let r=window.moment(t),s=(0,En.getAllDailyNotes)(),i=(0,En.getDailyNote)(r,s);if(!i)try{i=await(0,En.createDailyNote)(r)}catch(a){let o=a instanceof Error?a.message:String(a);console.error("Failed to create daily note:",a),new je.Notice(`Failed to create daily note: ${o}`);return}i&&await this.app.workspace.getLeaf(!1).openFile(i)}catch(r){let s=r instanceof Error?r.message:String(r);console.error("Failed to navigate to daily note:",r),new je.Notice(`Failed to navigate to daily note: ${s}`)}}async getTimeblockEvents(){var r;let t=[];try{if(!(0,En.appHasDailyNotesPluginLoaded)())return t;let s=(r=this.calendar)==null?void 0:r.view;if(!s)return t;let i=s.activeStart,a=s.activeEnd,o=(0,En.getAllDailyNotes)(),l=me(i),c=me(a),d=new Date(`${l}T00:00:00.000Z`),u=new Date(`${c}T00:00:00.000Z`);for(let h=new Date(d);h<=u;h.setUTCDate(h.getUTCDate()+1)){let f=me(h),p=new Date(`${f}T12:00:00`),m=window.moment(p),g=(0,En.getDailyNote)(m,o);if(g)try{let y=await this.app.vault.read(g),T=RT(y,g.path);for(let w of T){let b=cP(w,f);t.push(b)}}catch(y){console.error(`Error reading daily note ${g.path}:`,y)}}}catch(s){console.error("Error getting timeblock events:",s)}return t}handleEventClick(t){let{taskInfo:r,icsEvent:s,timeblock:i,eventType:a,subscriptionName:o}=t.event.extendedProps,l=t.jsEvent;if(a==="timeEntry"){r&&l.button===0&&!l.ctrlKey&&!l.metaKey&&new Pa(this.app,this.plugin,{task:r}).open();return}if(a==="timeblock"){this.showTimeblockInfo(i,t.event.start);return}if(a==="ics"){this.showICSEventInfo(s,o);return}l.ctrlKey||l.metaKey?this.app.vault.getAbstractFileByPath(r.path)instanceof je.TFile&&this.app.workspace.openLinkText(r.path,"",!0):l.button===0&&new Pa(this.app,this.plugin,{task:r}).open()}async handleEventDrop(t){let{taskInfo:r,timeblock:s,eventType:i,isRecurringInstance:a,isNextScheduledOccurrence:o,isPatternInstance:l,originalDate:c}=t.event.extendedProps;if(i==="timeEntry"||i==="ics"){t.revert();return}if(i==="timeblock"){await this.handleTimeblockDrop(t,s,c);return}let d=a||o||l;try{let u=t.event.start,h=t.event.allDay;if(o){let f;h?f=x(u,"yyyy-MM-dd"):f=x(u,"yyyy-MM-dd'T'HH:mm"),await this.plugin.taskService.updateProperty(r,"scheduled",f),new je.Notice("Rescheduled next occurrence. This does not change the recurrence pattern.")}else if(l)await this.handlePatternInstanceDrop(r,u,h);else if(a){let f=ve(r.scheduled),p;if(h)p=f,new je.Notice("Updated recurring task to all-day. This affects all future instances.");else{let m=x(u,"HH:mm");p=`${f}T${m}`,new je.Notice(`Updated recurring task time to ${m}. This affects all future instances.`)}await this.plugin.taskService.updateProperty(r,"scheduled",p)}else{let f;h?f=x(u,"yyyy-MM-dd"):f=x(u,"yyyy-MM-dd'T'HH:mm");let p=i==="scheduled"?"scheduled":"due";await this.plugin.taskService.updateProperty(r,p,f)}if(d){console.log("Recurring task drop completed",{taskPath:r.path,newStart:u==null?void 0:u.toISOString(),isPatternInstance:l,isNextScheduledOccurrence:o});let f=r.recurrence;setTimeout(async()=>{console.log("Checking if task data has been updated...");let p=await this.plugin.cacheManager.getTaskInfo(r.path);p&&p.recurrence!==f?(console.log("Task data confirmed updated, refreshing calendar"),this.calendar&&(this.calendar.getEvents().filter(y=>{var T;return((T=y.extendedProps.taskInfo)==null?void 0:T.path)===r.path}).forEach(y=>y.remove()),await this.refreshEvents())):(console.log("Task data not yet updated, waiting longer..."),setTimeout(async()=>{await this.refreshEvents()},1e3))},1500)}}catch(u){console.error("Error updating task date:",u),t.revert()}}async handlePatternInstanceDrop(t,r,s){try{if(!t.recurrence||typeof t.recurrence!="string")throw new Error("Task does not have a valid RRULE string");let i=t.recurrence.match(/DTSTART:(\d{8}(?:T\d{6}Z?)?)/),a;if(i){let o=i[1],l;if(s)l=o.slice(0,8);else{let c=o.slice(0,8),d=String(r.getHours()).padStart(2,"0"),u=String(r.getMinutes()).padStart(2,"0");l=`${c}T${d}${u}00Z`}a=t.recurrence.replace(/DTSTART:[^;]+/,`DTSTART:${l}`),new je.Notice("Updated recurring pattern time. All future instances now appear at this time.")}else{let o=uP(t,r,s);if(!o)throw new Error("Failed to add DTSTART to recurrence rule");a=o,new je.Notice("Added time information to recurring pattern. All future instances now appear at this time.")}await this.plugin.taskService.updateProperty(t,"recurrence",a)}catch(i){throw console.error("Error updating pattern instance time:",i),i}}async handleTimeblockDrop(t,r,s){try{let i=t.event.start,a=t.event.end,o=x(i,"yyyy-MM-dd"),l=x(i,"HH:mm"),c=x(a,"HH:mm");await NT(this.app,r.id,s,o,l,c),this.refreshEvents(),s!==o?new je.Notice(`Moved timeblock "${r.title}" to ${o}`):new je.Notice(`Updated timeblock "${r.title}" time`)}catch(i){console.error("Error moving timeblock:",i),new je.Notice(`Failed to move timeblock: ${i.message}`),t.revert()}}async handleEventResize(t){let{taskInfo:r,timeblock:s,eventType:i,originalDate:a}=t.event.extendedProps;if(i==="timeblock"){await this.handleTimeblockResize(t,s,a);return}if(i!=="scheduled"&&i!=="recurring"){t.revert();return}try{let o=t.event.start,l=t.event.end;if(o&&l){let c=Math.round((l.getTime()-o.getTime())/6e4);await this.plugin.taskService.updateProperty(r,"timeEstimate",c)}}catch(o){console.error("Error updating task duration:",o),t.revert()}}async handleTimeblockResize(t,r,s){try{let i=t.event.start,a=t.event.end;if(!i||!a){t.revert();return}let o=x(i,"HH:mm"),l=x(a,"HH:mm"),[c,d]=o.split(":").map(Number),[u,h]=l.split(":").map(Number),f=c*60+d;if(u*60+h<=f){new je.Notice("End time must be after start time"),t.revert();return}await NT(this.app,r.id,s,s,o,l),this.refreshEvents(),new je.Notice(`Updated timeblock "${r.title}" duration`)}catch(i){console.error("Error resizing timeblock:",i),new je.Notice(`Failed to resize timeblock: ${i.message}`),t.revert()}}async handleExternalDrop(t){try{let r;if(t.dataTransfer&&(r=t.dataTransfer.getData("text/plain")||t.dataTransfer.getData("application/x-task-path")),!r&&t.draggedEl&&(r=t.draggedEl.dataset.taskPath),!r){console.warn("No task path found in drop data",t);return}let s=await this.plugin.cacheManager.getTaskInfo(r);if(!s){console.warn("Task not found:",r);return}let i=t.date;if(!i){console.warn("No drop date provided");return}let a;t.allDay?a=x(i,"yyyy-MM-dd"):a=x(i,"yyyy-MM-dd'T'HH:mm"),await this.plugin.taskService.updateProperty(s,"scheduled",a),new je.Notice(`Task "${s.title}" scheduled for ${x(i,t.allDay?"MMM d, yyyy":"MMM d, yyyy h:mm a")}`),t.draggedEl&&t.draggedEl.remove(),this.refreshEvents()}catch(r){console.error("Error handling external drop:",r),new je.Notice("Failed to schedule task"),t.draggedEl&&t.draggedEl.remove()}}handleEventReceive(t){t.event.remove()}handleEventDidMount(t){var f;if(!t.event.extendedProps)return;let{taskInfo:r,icsEvent:s,timeblock:i,eventType:a,isCompleted:o,isRecurringInstance:l,instanceDate:c,subscriptionName:d}=t.event.extendedProps;if(t.el.setAttribute("data-event-type",a||"unknown"),a==="ics"){t.el.style.borderStyle="solid",t.el.style.borderWidth="2px",t.el.setAttribute("data-ics-event","true"),t.el.setAttribute("data-subscription",d||"Unknown"),t.el.classList.add("fc-ics-event"),(0,je.setTooltip)(t.el,`${(s==null?void 0:s.title)||"Event"} (from ${d||"Calendar subscription"})`,{placement:"top"}),t.el.addEventListener("contextmenu",p=>{p.preventDefault(),p.stopPropagation(),this.showICSEventContextMenu(p,s,d)});return}if(a==="timeblock"){t.el.setAttribute("data-timeblock-id",(i==null?void 0:i.id)||""),t.el.style.borderStyle="solid",t.el.style.borderWidth="2px",t.el.classList.add("fc-timeblock-event"),t.event.setProp&&t.event.setProp("editable",!0);let p=((f=i==null?void 0:i.attachments)==null?void 0:f.length)||0,m=`${(i==null?void 0:i.title)||"Timeblock"}${i!=null&&i.description?` - ${i.description}`:""}${p>0?` (${p} attachment${p>1?"s":""})`:""}`;(0,je.setTooltip)(t.el,m,{placement:"top"});return}if(!r||!r.path)return;if(t.el.setAttribute("data-task-path",r.path),t.el.classList.add("fc-task-event"),r.tags&&r.tags.length>0&&r.tags.forEach(p=>{let m=p.replace(/[^a-zA-Z0-9-_]/g,"");m&&t.el.classList.add(`fc-tag-${m}`)}),t.event.setProp)switch(a){case"scheduled":case"recurring":t.event.setProp("editable",!0);break;case"due":case"timeEntry":t.event.setProp("editable",!1);break;default:t.event.setProp("editable",!0)}let{isNextScheduledOccurrence:u,isPatternInstance:h}=t.event.extendedProps;if(u?(t.el.style.borderStyle="solid",t.el.style.borderWidth="2px",t.el.setAttribute("data-next-scheduled","true"),t.el.classList.add("fc-next-scheduled-event"),o&&(t.el.style.opacity="0.6")):h?(t.el.style.borderStyle="dashed",t.el.style.borderWidth="2px",t.el.style.opacity=o?"0.4":"0.7",t.el.setAttribute("data-pattern-instance","true"),t.el.classList.add("fc-pattern-instance-event")):l&&(t.el.style.borderStyle="dashed",t.el.style.borderWidth="2px",t.el.setAttribute("data-recurring","true"),t.el.classList.add("fc-recurring-event"),o&&(t.el.style.opacity="0.6")),o){let p=t.el.querySelector(".fc-event-title, .fc-event-title-container");p?p.style.textDecoration="line-through":t.el.style.textDecoration="line-through",t.el.classList.add("fc-completed-event")}r&&(a!=="ics"&&t.el.addEventListener("mouseover",p=>{this.plugin.app.vault.getAbstractFileByPath(r.path)&&this.plugin.app.workspace.trigger("hover-link",{event:p,source:"tasknotes-advanced-calendar",hoverParent:t.el,targetEl:t.el,linktext:r.path,sourcePath:r.path})}),t.el.addEventListener("contextmenu",p=>{if(p.preventDefault(),p.stopPropagation(),a==="timeEntry"){let{timeEntryIndex:m}=t.event.extendedProps;this.showTimeEntryContextMenu(p,r,m)}else{let{isNextScheduledOccurrence:m,isPatternInstance:g}=t.event.extendedProps,y;if((l||m||g)&&c)y=qe(c);else{let T=t.event.start;if(T){let w=x(T,"yyyy-MM-dd");y=qe(w)}else y=Ge()}this.showTaskContextMenuForEvent(p,r,y)}}))}registerEvents(){this.functionListeners.forEach(l=>l()),this.functionListeners=[];let t=this.plugin.emitter.on(fr,async()=>{if(this.refreshEvents(),this.filterBar){let l=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(l)}});this.listeners.push(t);let r=this.plugin.emitter.on(pn,async()=>{this.refreshEvents()});this.listeners.push(r);let s=this.plugin.emitter.on(tt,async l=>{if(this.refreshEvents(),this.filterBar){let c=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(c)}});this.listeners.push(s);let i=this.plugin.filterService.on("data-changed",()=>{this.refreshEvents()});if(this.functionListeners.push(i),this.plugin.icsSubscriptionService){let l=this.plugin.icsSubscriptionService.on("data-changed",()=>{this.refreshEvents()});this.functionListeners.push(l)}let a=this.plugin.emitter.on(sA,l=>{this.showTimeblocks=l&&this.plugin.settings.calendarViewSettings.defaultShowTimeblocks,this.refreshEvents(),this.setupViewOptions()});this.listeners.push(a);let o=this.plugin.emitter.on("settings-changed",()=>{this.updateTodayHighlight(),this.updateCustomViewConfiguration()});this.listeners.push(o)}updateCustomViewConfiguration(){if(!this.calendar)return;let t=this.plugin.settings.calendarViewSettings;this.calendar.setOption("views",{timeGridCustom:{type:"timeGrid",duration:{days:t.customDayCount||3},buttonText:`${t.customDayCount||3} days`}}),this.calendar.setOption("headerToolbar",this.getHeaderToolbarConfig())}async refreshEvents(){this.calendar&&(this.calendar.removeAllEventSources(),this.calendar.addEventSource({events:this.getCalendarEvents.bind(this)}))}async onClose(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.functionListeners.forEach(t=>t()),this.functionListeners=[],this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.listeners=[],this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.calendar&&(this.calendar.destroy(),this.calendar=null),this.contentEl.empty()}showICSEventInfo(t,r){new co(this.app,this.plugin,t,r).open()}showTimeblockInfo(t,r){new hm(this.app,this.plugin,t,r).open()}showICSEventContextMenu(t,r,s){new jl({icsEvent:r,plugin:this.plugin,subscriptionName:s,onUpdate:()=>{this.refreshEvents()}}).show(t)}async showTaskContextMenuForEvent(t,r,s){new Yl({task:r,plugin:this.plugin,targetDate:s,onUpdate:()=>{this.refreshEvents()}}).show(t)}showTimeEntryContextMenu(t,r,s){let i=new je.Menu;i.addItem(a=>a.setTitle("Open task").setIcon("edit").onClick(()=>{new Pa(this.app,this.plugin,{task:r}).open()})),i.addSeparator(),i.addItem(a=>a.setTitle("Delete time entry").setIcon("trash").onClick(async()=>{var o;try{let l=(o=r.timeEntries)==null?void 0:o[s];if(!l){new je.Notice("Time entry not found");return}let c="";if(l.startTime&&l.endTime){let u=$t(l.startTime),f=$t(l.endTime).getTime()-u.getTime(),p=Math.round(f/(1e3*60)),m=Math.floor(p/60),g=p%60;m>0?c=` (${m}h ${g}m)`:c=` (${g}m)`}await new Promise(u=>{let h=new je.Modal(this.app);h.setTitle("Delete Time Entry"),h.setContent(`Are you sure you want to delete this time entry${c}? This action cannot be undone.`);let f=h.contentEl.createDiv({cls:"modal-button-container"});f.style.display="flex",f.style.justifyContent="flex-end",f.style.gap="8px",f.style.marginTop="20px";let p=f.createEl("button",{text:"Cancel"}),m=f.createEl("button",{text:"Delete",cls:"mod-warning"});p.onclick=()=>{h.close(),u(!1)},m.onclick=()=>{h.close(),u(!0)},h.open()})&&(await this.plugin.taskService.deleteTimeEntry(r,s),new je.Notice("Time entry deleted"),this.refreshEvents())}catch(l){console.error("Error deleting time entry:",l),new je.Notice("Failed to delete time entry")}})),i.showAtMouseEvent(t)}updateTodayHighlight(){let t=this.contentEl.querySelector(".advanced-calendar-view__calendar-container");if(!t)return;this.plugin.settings.calendarViewSettings.showTodayHighlight?t.removeClass("hide-today-highlight"):t.addClass("hide-today-highlight")}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(t=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),t()})})}};var is=require("obsidian");Sn();var wr=class n{static formatGroupName(e,t){let r=t.priorityManager.getPriorityConfig(e);if(r)return`${r.label} priority`;let s=t.statusManager.getStatusConfig(e);if(s)return s.label;switch(e){case"all":return"All tasks";case"no-status":return"No status assigned";case"No Status":return"No Status";case"No Priority":return"No Priority";case"No Context":return"No Context";case"No Project":return"No Project";case"No Due Date":return"No Due Date";case"No Scheduled Date":return"No Scheduled Date";default:return e}}static getGroupDisplayName(e,t,r){return`${n.formatGroupName(e,r)} (${t})`}static isGroupCollapsed(e,t,r,s){var i;try{let o=(s.viewStateManager.getViewPreferences(e)||{}).collapsedGroups||{};return!!((i=o==null?void 0:o[t])!=null&&i[r])}catch(a){return!1}}static setGroupCollapsed(e,t,r,s,i){let o={...i.viewStateManager.getViewPreferences(e)||{}};o.collapsedGroups||(o.collapsedGroups={}),o.collapsedGroups[t]||(o.collapsedGroups[t]={}),o.collapsedGroups[t][r]=s,i.viewStateManager.setViewPreferences(e,o)}static expandAllGroups(e,t,r){let s=r.viewStateManager.getViewPreferences(e)||{},i={...s.collapsedGroups||{}};i[t]={},r.viewStateManager.setViewPreferences(e,{...s,collapsedGroups:i})}static collapseAllGroups(e,t,r,s){let i=s.viewStateManager.getViewPreferences(e)||{},a={...i.collapsedGroups||{}},o={};r.forEach(l=>{o[l]=!0}),a[t]=o,s.viewStateManager.setViewPreferences(e,{...i,collapsedGroups:a})}};var xt=class n{static formatGroupCount(e,t,r={}){let s=t>0?Math.round(e/t*100):0,i=["agenda-view__item-count"];r.additionalClasses&&i.push(...r.additionalClasses);let a;return r.showPercentage?a=`${s}%`:r.hideCompleted?a=`${t}`:a=`${e} / ${t}`,{text:a,classes:i,completed:e,total:t,percentage:s}}static calculateGroupStats(e,t){let r=e.length;return{completed:e.filter(i=>t.statusManager.isCompletedStatus(i.status)).length,total:r}}static createCountElement(e,t,r,s={}){let i=n.formatGroupCount(t,r,s),a=e.createEl("div",{text:i.text,cls:i.classes.join(" ")});return a.setAttribute("data-completed",t.toString()),a.setAttribute("data-total",r.toString()),a.setAttribute("data-percentage",i.percentage.toString()),a}static updateCountElement(e,t,r,s={}){let i=n.formatGroupCount(t,r,s);e.textContent=i.text,e.className=i.classes.join(" "),e.setAttribute("data-completed",t.toString()),e.setAttribute("data-total",r.toString()),e.setAttribute("data-percentage",i.percentage.toString())}};var Na=class{constructor(e){this.headingElement=null;this.countElement=null;this.dividerElement=null;this.container=e,this.instanceId="fh-"+Math.random().toString(36).substr(2,9),this.render()}render(){let e=this.container.createDiv("filter-heading"),t=e.createDiv("filter-heading__content");this.headingElement=t.createEl("h2",{cls:"filter-heading__title",text:"All"}),this.countElement=t.createDiv("filter-heading__count agenda-view__item-count"),this.dividerElement=e.createDiv("filter-heading__divider")}update(e,t,r){if(!this.headingElement||!this.countElement)return;let s=(e==null?void 0:e.name)||"All";this.headingElement.textContent=s;let i=xt.formatGroupCount(t,r).text;this.countElement.textContent=i}destroy(){let e=this.container.querySelector(".filter-heading");e&&e.remove()}};var qf=class extends is.ItemView{constructor(t,r){super(t);this.taskListContainer=null;this.loadingIndicator=null;this.isTasksLoading=!1;this.filterBar=null;this.filterHeading=null;this.taskElements=new Map;this.listeners=[];this.functionListeners=[];this.plugin=r,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"},this.registerEvents()}getViewType(){return Rs}getDisplayText(){return"Tasks"}getIcon(){return"check-square"}registerEvents(){this.listeners.forEach(a=>this.plugin.emitter.offref(a)),this.listeners=[],this.functionListeners.forEach(a=>a()),this.functionListeners=[];let t=this.plugin.emitter.on(fr,async()=>{if(this.refresh(),this.filterBar){let a=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(a)}});this.listeners.push(t);let r=this.plugin.emitter.on(pn,async()=>{this.refresh()});this.listeners.push(r);let s=this.plugin.emitter.on(tt,async({path:a,originalTask:o,updatedTask:l})=>{if(!a||!l){console.error("EVENT_TASK_UPDATED received invalid data:",{path:a,originalTask:o,updatedTask:l});return}await tl(l,this.plugin,this.contentEl);let c=this.taskElements.get(a);if(c)try{let d=this.getCurrentVisibleProperties();en(c,l,this.plugin,d,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1}),c.classList.add("task-updated"),setTimeout(()=>{c.classList.remove("task-updated")},1e3)}catch(d){console.error("Error updating task card:",d),this.refreshTasks()}else this.refreshTasks();if(this.filterBar){let d=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(d)}});this.listeners.push(s);let i=this.plugin.filterService.on("data-changed",()=>{this.refreshTasks()});this.functionListeners.push(i)}async onOpen(){try{await this.plugin.onReady(),await this.plugin.waitForMigration(),this.currentQuery=this.plugin.filterService.createDefaultQuery();let t=this.plugin.viewStateManager.getFilterState(Rs);t&&(this.currentQuery=t),await this.refresh()}catch(t){console.error("TaskListView: Error during onOpen:",t),this.fallbackToPolling()}}async fallbackToPolling(){this.contentEl.empty(),this.contentEl.createDiv({cls:"task-list-view__loading"}).createSpan({text:"Initializing..."});let r=0,s=50,i=async()=>{r++,this.plugin.cacheManager&&this.plugin.cacheManager.isInitialized()?await this.refresh():r<s?setTimeout(i,100):await this.refresh()};i()}async onClose(){this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.functionListeners.forEach(t=>t()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.filterHeading&&(this.filterHeading.destroy(),this.filterHeading=null),this.contentEl.empty()}async refresh(t=!1){return vi.measure("task-list-refresh",async()=>{t&&this.taskElements.clear(),this.contentEl.empty(),this.taskElements.clear(),await this.render()})}async render(){let t=this.contentEl.createDiv({cls:"tasknotes-plugin tasknotes-container task-list-view-container"});this.createHeader(t),await this.createTasksContent(t)}createHeader(t){t.createDiv({cls:"detail-view-header task-list-header"})}async createTasksContent(t){let r=t.createDiv({cls:"filter-bar-container"});await this.waitForCacheReady(),this.currentQuery=this.plugin.filterService.createDefaultQuery();let s=this.plugin.viewStateManager.getFilterState(Rs);s&&(this.currentQuery=s);let i=await this.plugin.filterService.getFilterOptions();this.filterBar=new Xs(this.app,this.plugin,r,this.currentQuery,i,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"task-list"});let a=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(a),this.filterBar.on("saveView",({name:d,query:u,viewOptions:h,visibleProperties:f})=>{let p=this.plugin.viewStateManager.saveView(d,u,h,f);this.filterBar.setActiveSavedView(p)}),this.filterBar.on("deleteView",d=>{this.plugin.viewStateManager.deleteView(d)}),this.plugin.viewStateManager.on("saved-views-changed",d=>{var u;(u=this.filterBar)==null||u.updateSavedViews(d)}),this.filterBar.on("reorderViews",(d,u)=>{this.plugin.viewStateManager.reorderSavedViews(d,u)}),this.filterBar.on("queryChange",async d=>{this.currentQuery=d,this.plugin.viewStateManager.setFilterState(Rs,d);let u=this.contentEl.querySelector(".filter-heading__controls");u&&this.createExpandCollapseButtons(u),await this.refreshTasks()}),this.filterBar.on("propertiesChanged",d=>{this.refreshTaskDisplay()}),this.filterHeading=new Na(t);let o=t.querySelector(".filter-heading");if(o){let d=o.querySelector(".filter-heading__content");if(d){let u=d.createDiv({cls:"filter-heading__controls"});this.createExpandCollapseButtons(u)}}let l=t.createDiv({cls:"task-list"});this.loadingIndicator=l.createDiv({cls:"loading-indicator"}),this.loadingIndicator.createDiv({cls:"loading-spinner"}),this.loadingIndicator.createDiv({cls:"loading-text",text:"Loading tasks..."}),this.loadingIndicator.addClass("is-hidden"),this.taskListContainer=l,this.isTasksLoading=!0,this.updateLoadingState(),await this.refreshTasks(),this.isTasksLoading=!1,this.updateLoadingState();let c=this.contentEl.querySelector(".filter-heading__controls");c&&this.createExpandCollapseButtons(c)}createExpandCollapseButtons(t){if(!((this.currentQuery.groupKey||"none")!=="none")){t.style.display="none";return}t.style.display="flex",t.empty(),new is.ButtonComponent(t).setIcon("list-tree").setTooltip("Expand All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none";this.contentEl.querySelectorAll(".task-group").forEach(o=>{o.classList.remove("is-collapsed");let l=o.querySelector(".task-cards");l&&(l.style.display="")}),wr.expandAllGroups(Rs,a,this.plugin)}).buttonEl.addClass("clickable-icon"),new is.ButtonComponent(t).setIcon("list-collapse").setTooltip("Collapse All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none",o=[];this.contentEl.querySelectorAll(".task-group").forEach(l=>{let c=l.dataset.group;if(c){o.push(c),l.classList.add("is-collapsed");let d=l.querySelector(".task-cards");d&&(d.style.display="none")}}),wr.collapseAllGroups(Rs,a,o,this.plugin)}).buttonEl.addClass("clickable-icon")}async updateFilterHeading(){if(!(!this.filterHeading||!this.filterBar))try{let t=await this.plugin.filterService.getGroupedTasks(this.currentQuery),r=Array.from(t.values()).flat(),s=xt.calculateGroupStats(r,this.plugin),i=this.filterBar.activeSavedView||null;this.filterHeading.update(i,s.completed,s.total)}catch(t){console.error("Error updating filter heading in TaskListView:",t)}}async refreshTasks(){var t;if(this.taskListContainer)try{this.isTasksLoading=!0,this.updateLoadingState();let r=await this.plugin.filterService.getGroupedTasks(this.currentQuery);this.renderTaskItems(this.taskListContainer,r)}catch(r){let s=r instanceof Error?r.message:String(r);console.error("TaskListView: Error refreshing tasks:",{error:s,stack:r instanceof Error?r.stack:void 0,query:this.currentQuery,cacheInitialized:((t=this.plugin.cacheManager)==null?void 0:t.isInitialized())||!1,visibleProperties:this.getCurrentVisibleProperties(),filterServiceQuery:JSON.stringify(this.currentQuery,null,2)}),this.taskListContainer.empty();let i=this.taskListContainer.createDiv({cls:"error-container"});i.createEl("p",{text:"Error loading tasks. Please try refreshing.",cls:"error-message"}),i.createEl("button",{text:"Retry",cls:"mod-cta"}).addEventListener("click",()=>{this.refreshTasks()})}finally{this.isTasksLoading=!1,this.updateLoadingState(),await this.updateFilterHeading()}}renderTaskItems(t,r){if(Array.from(r.values()).reduce((i,a)=>i+a.length,0)===0){t.empty(),this.taskElements.clear(),t.createEl("p",{text:"No tasks found for the selected filters."});return}if(this.currentQuery.groupKey==="none"&&r.has("all")){let i=r.get("all")||[];this.renderTaskListWithReconciler(t,i)}else this.renderGroupedTasksWithReconciler(t,r)}renderTaskListWithReconciler(t,r){Array.from(t.children).forEach(s=>{let i=s;i.dataset.key||i.remove()});try{this.plugin.domReconciler.updateList(t,r,s=>s.path,s=>this.createTaskCardForReconciler(s),(s,i)=>this.updateTaskCardForReconciler(s,i))}catch(s){throw console.error("TaskListView: Error in renderTaskListWithReconciler:",s),s}this.taskElements.clear(),Array.from(t.children).forEach(s=>{let i=s.dataset.key;i&&this.taskElements.set(i,s)})}renderGroupedTasksWithReconciler(t,r){let s=t.scrollTop,i=new Map;Array.from(t.children).forEach(a=>{let o=a.dataset.group;o&&i.set(o,a)}),t.empty(),this.taskElements.clear(),r.forEach((a,o)=>{if(a.length===0)return;let l=t.createDiv({cls:"task-section task-group"});l.setAttribute("data-group",o);let c=this.currentQuery.groupKey||"none",d=c==="none"&&o==="all",u=this.isGroupCollapsed(c,o);if(!d){let f=l.createEl("h3",{cls:"task-group-header task-list-view__group-header"}),p=f.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle group"}});try{(0,is.setIcon)(p,"chevron-right")}catch(y){}let m=p.querySelector("svg");m?(m.classList.add("chevron"),m.setAttr("width","16"),m.setAttr("height","16")):(p.textContent="\u25B8",p.addClass("chevron-text"));let g=xt.calculateGroupStats(a,this.plugin);c==="project"&&this.isClickableProject(o)?this.createClickableProjectHeader(f,o,g):(f.createSpan({text:this.formatGroupName(o)}),f.createSpan({text:` ${xt.formatGroupCount(g.completed,g.total).text}`,cls:"agenda-view__item-count"})),this.registerDomEvent(f,"click",y=>{if(y.target.closest("a"))return;let w=!l.hasClass("is-collapsed");this.setGroupCollapsed(c,o,w),l.toggleClass("is-collapsed",w);let b=l.querySelector(".task-cards");b&&(b.style.display=w?"none":""),p.setAttr("aria-expanded",String(!w))}),this.registerDomEvent(p,"click",y=>{y.preventDefault(),y.stopPropagation();let T=!l.hasClass("is-collapsed");this.setGroupCollapsed(c,o,T),l.toggleClass("is-collapsed",T);let w=l.querySelector(".task-cards");w&&(w.style.display=T?"none":""),p.setAttr("aria-expanded",String(!T))}),p.setAttr("aria-expanded",String(!u))}let h=l.createDiv({cls:"tasks-container task-cards"});u&&!d&&(l.addClass("is-collapsed"),h.style.display="none"),this.plugin.domReconciler.updateList(h,a,f=>f.path,f=>this.createTaskCardForReconciler(f),(f,p)=>this.updateTaskCardForReconciler(f,p)),Array.from(h.children).forEach(f=>{let p=f.dataset.key;p&&this.taskElements.set(p,f)})}),t.scrollTop=s}isGroupCollapsed(t,r){return wr.isGroupCollapsed(Rs,t,r,this.plugin)}setGroupCollapsed(t,r,s){wr.setGroupCollapsed(Rs,t,r,s,this.plugin)}getCurrentVisibleProperties(){var t;return(t=this.filterBar)==null?void 0:t.getCurrentVisibleProperties()}refreshTaskDisplay(){if(!this.taskListContainer)return;let t=this.taskListContainer.querySelectorAll(".task-card"),r=this.getCurrentVisibleProperties();t.forEach(s=>{let i=s.dataset.taskPath;i&&this.plugin.cacheManager.getTaskInfo(i).then(a=>{a&&en(s,a,this.plugin,r)})})}createTaskCardForReconciler(t){try{let r=this.getCurrentVisibleProperties(),s=cr(t,this.plugin,r,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1});return s.dataset.key=t.path,this.addDragHandlers(s,t),s}catch(r){throw console.error("TaskListView: Error creating task card for",t.path,":",r),r}}updateTaskCardForReconciler(t,r){let s=this.getCurrentVisibleProperties();en(t,r,this.plugin,s,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!0,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1})}addDragHandlers(t,r){this.plugin.dragDropManager.makeTaskCardDraggable(t,r.path)}formatGroupName(t){return wr.formatGroupName(t,this.plugin)}updateLoadingState(){this.loadingIndicator&&(this.isTasksLoading?this.loadingIndicator.removeClass("is-hidden"):this.loadingIndicator.addClass("is-hidden"))}openTask(t){let r=this.app.vault.getAbstractFileByPath(t);r instanceof is.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(t=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),t()})})}isClickableProject(t){var r;return!t||typeof t!="string"?!1:t.startsWith("[[")&&t.endsWith("]]")||t.includes("/")?!0:(r=this.plugin)!=null&&r.app?this.plugin.app.vault.getAbstractFileByPath(t+".md")instanceof is.TFile?!0:!!this.plugin.app.metadataCache.getFirstLinkpathDest(t,""):!1}createClickableProjectHeader(t,r,s){if(!r||typeof r!="string")return;let i=r,a=r;if(r.startsWith("[[")&&r.endsWith("]]")){let l=r.slice(2,-2);i=l,a=l}let o=t.createEl("a",{cls:"internal-link task-list-view__project-link",text:a});this.registerDomEvent(o,"click",async l=>{l.preventDefault(),l.stopPropagation();try{let c=this.plugin.app.vault.getAbstractFileByPath(i);if(c instanceof is.TFile){await this.plugin.app.workspace.getLeaf(!1).openFile(c);return}let d=this.plugin.app.metadataCache.getFirstLinkpathDest(i,"");d?await this.plugin.app.workspace.getLeaf(!1).openFile(d):new is.Notice(`Project file not found: ${a}`)}catch(c){console.error("Error opening project file:",c),new is.Notice(`Error opening project: ${a}`)}}),this.addHoverPreview(o,i),s&&t.createSpan({text:` ${xt.formatGroupCount(s.completed,s.total).text}`,cls:"agenda-view__item-count"})}addHoverPreview(t,r){t.addEventListener("mouseover",s=>{this.app.vault.getAbstractFileByPath(r)&&this.app.workspace.trigger("hover-link",{event:s,source:"tasknotes-tasklistview",hoverParent:this,targetEl:t,linktext:r,sourcePath:r})})}};var si=require("obsidian");Fe();var dB=require("obsidian");Fe();var fS=ke(dn()),uB={showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:3,showDailyNoteBadge:!0};function by(n,e,t={}){let r={...uB,...t},s=document.createElement("div"),i=!1;try{let l=(0,fS.getAllDailyNotes)();i=Object.values(l).some(c=>c.path===n.path)}catch(l){i=!1}let a=["note-card"];i&&a.push("note-card--daily-note"),a.push("note-card--compact","note-card--shadow-light"),s.className=a.join(" "),s.dataset.notePath=n.path,r.showDailyNoteBadge&&i&&s.createSpan({cls:"note-card__badge",text:"Daily",attr:{title:"Daily note"}});let o=s.createDiv({cls:"note-card__content"});if(o.createDiv({cls:"note-card__title",text:n.title}),r.showTags&&n.tags&&n.tags.length>0){o.createEl("div",{cls:"note-card__divider"});let c=n.tags.slice(0,r.maxTags).map(d=>`#${d}`).join(" ");n.tags.length>r.maxTags&&(c+=` +${n.tags.length-r.maxTags}`),o.createEl("div",{cls:"note-card__tags-text",text:c})}if(r.showCreatedDate&&n.createdDate){let l=n.createdDate.indexOf("T")>0?hs(n.createdDate,"MMM d, yyyy h:mm a"):n.createdDate;o.createDiv({cls:"note-card__metadata",text:`Created: ${l}`,attr:{title:`Created: ${l}`}})}return r.showPath&&o.createDiv({cls:"note-card__metadata",text:n.path,attr:{title:`Path: ${n.path}`}}),s.addEventListener("click",()=>{let l=e.app.vault.getAbstractFileByPath(n.path);l instanceof dB.TFile&&e.app.workspace.getLeaf(!1).openFile(l)}),s.addEventListener("mouseover",l=>{e.app.vault.getAbstractFileByPath(n.path)&&e.app.workspace.trigger("hover-link",{event:l,source:"tasknotes-note-card",hoverParent:s,targetEl:s,linktext:n.path,sourcePath:n.path})}),s}function hB(n,e,t,r={}){let s={...uB,...r},i=!1;try{let u=(0,fS.getAllDailyNotes)();i=Object.values(u).some(h=>h.path===e.path)}catch(u){i=!1}let a=["note-card"];i&&a.push("note-card--daily-note"),a.push("note-card--compact","note-card--shadow-light"),n.className=a.join(" ");let o=n.querySelector(".note-card__title");o&&(o.textContent=e.title);let l=n.querySelector(".note-card__metadata");if(l&&s.showCreatedDate&&e.createdDate){let u=e.createdDate.indexOf("T")>0?hs(e.createdDate,"MMM d, yyyy h:mm a"):e.createdDate;l.textContent=`Created: ${u}`}let c=n.querySelector(".note-card__metadata");c&&s.showPath&&(c.textContent=e.path);let d=n.querySelector(".note-card__tags-text");if(d&&s.showTags&&e.tags&&e.tags.length>0){let h=e.tags.slice(0,s.maxTags).map(f=>`#${f}`).join(" ");e.tags.length>s.maxTags&&(h+=` +${e.tags.length-s.maxTags}`),d.textContent=h}n.classList.add("note-card--updated"),window.setTimeout(()=>{n.classList.remove("note-card--updated")},1e3)}var ky=class extends si.ItemView{constructor(t,r){super(t);this.loadingIndicator=null;this.isNotesLoading=!1;this.listeners=[];this.plugin=r,this.registerEvents()}getViewType(){return md}getDisplayText(){return"Notes"}getIcon(){return"file-text"}registerEvents(){this.listeners.forEach(s=>this.plugin.emitter.offref(s)),this.listeners=[];let t=this.plugin.emitter.on(ra,()=>{this.refresh(!0)});this.listeners.push(t);let r=this.plugin.emitter.on(fr,()=>{this.refresh()});this.listeners.push(r)}async onOpen(){await this.plugin.onReady(),await this.refresh()}async onClose(){this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.contentEl.empty()}async refresh(t=!1){let r=this.contentEl.querySelector(".notes-view"),s=0;if(r&&!t){let i=r.querySelector(".notes-view__list");i&&(s=i.scrollTop)}if(this.contentEl.empty(),await this.render(t),s>0){let i=this.contentEl.querySelector(".notes-view__list");i&&(i.scrollTop=s)}}async render(t=!1){let r=this.contentEl.createDiv({cls:"tasknotes-plugin notes-view"});this.createHeader(r),await this.createNotesContent(r,t)}createHeader(t){let r=t.createDiv({cls:"notes-view__header"}),s=hs(this.plugin.selectedDate.toISOString(),"EEEE, MMMM d, yyyy"),i=r.createDiv();new si.Setting(i).setName("Notes").setHeading(),i.createEl("div",{text:s,cls:"notes-view__date"});let o=r.createDiv({cls:"notes-view__actions"}).createEl("button",{text:"Refresh",cls:"notes-view__refresh-button",attr:{"aria-label":"Refresh notes list",title:"Refresh notes list"}});o.addEventListener("click",async()=>{if(o.classList.contains("is-loading"))return;o.classList.add("is-loading"),o.disabled=!0;let l=o.textContent;o.textContent="Refreshing...";try{await this.refresh(!0)}finally{o.classList.remove("is-loading"),o.disabled=!1,o.textContent=l}})}async createNotesContent(t,r=!1){let s=t.createDiv({cls:"notes-view__list"});this.loadingIndicator=s.createDiv({cls:"notes-view__loading is-hidden"}),this.loadingIndicator.createSpan({text:"Loading notes..."}),this.isNotesLoading=!0,this.updateLoadingState();let i=await this.getNotesForView(r);if(this.isNotesLoading=!1,this.updateLoadingState(),i.length===0){let a=s.createDiv({cls:"notes-view__empty"}),o=a.createDiv({cls:"notes-view__empty-icon"});(0,si.setIcon)(o,"file-text"),this.plugin.settings.disableNoteIndexing?(new si.Setting(a).setName("Note indexing disabled").setHeading(),a.createEl("p",{text:"Note indexing has been disabled in settings for better performance. To view notes, enable note indexing in Settings > TaskNotes > General > Performance settings and restart the plugin.",cls:"notes-view__empty-description"})):(new si.Setting(a).setName("No notes found").setHeading(),a.createEl("p",{text:"No notes found for the selected date. Try selecting a different date in the Mini Calendar view or create some notes.",cls:"notes-view__empty-description"}))}else{let a=s.createDiv({cls:"notes-view__container"});this.renderNotesWithReconciler(a,i)}}renderNotesWithReconciler(t,r){this.plugin.domReconciler.updateList(t,r,s=>s.path,s=>this.createNoteCardForReconciler(s),(s,i)=>this.updateNoteCardForReconciler(s,i))}createNoteCardForReconciler(t){let r=by(t,this.plugin,{showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:5,showDailyNoteBadge:!0});return r.dataset.key=t.path,r}updateNoteCardForReconciler(t,r){hB(t,r,this.plugin,{showCreatedDate:!0,showTags:!0,showPath:!1,maxTags:5,showDailyNoteBadge:!0})}updateLoadingState(){var t,r;this.loadingIndicator&&(this.isNotesLoading?(t=this.loadingIndicator)==null||t.classList.remove("is-hidden"):(r=this.loadingIndicator)==null||r.classList.add("is-hidden"))}async getNotesForView(t=!1){try{return this.isNotesLoading=!0,this.updateLoadingState(),this.plugin.settings.disableNoteIndexing?[]:(await this.plugin.cacheManager.getNotesForDate(this.plugin.selectedDate)).sort((a,o)=>a.title.localeCompare(o.title))}finally{this.isNotesLoading=!1,this.updateLoadingState()}}openNote(t){let r=this.app.vault.getAbstractFileByPath(t);r instanceof si.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}};var br=require("obsidian");At();Fe();var fB=require("obsidian");At();function pB(n){try{if(!n.start)return"";let e=new Date(n.start);if(n.allDay)return"All day";let t=x(e,"h:mm a");if(n.end){let r=new Date(n.end),s=x(r,"h:mm a");return`${t} \u2013 ${s}`}return t}catch(e){return""}}function mB(n,e,t={}){var m;let r=document.createElement("div");r.className="task-card task-card--ics",r.dataset.key=n.id;let s=(m=e.icsSubscriptionService)==null?void 0:m.getSubscriptions().find(g=>g.id===n.subscriptionId),i=(s==null?void 0:s.color)||"var(--color-accent)",a=(s==null?void 0:s.name)||"Calendar",o=r.createEl("div",{cls:"task-card__main-row"}),l=o.createEl("span",{cls:"ics-card__icon"}),c=l.createDiv({attr:{"aria-label":"Calendar event"}});(0,fB.setIcon)(c,"calendar");let d=l;d.style.display="inline-flex",d.style.width="16px",d.style.height="16px",d.style.marginRight="8px",d.style.alignItems="center",d.style.justifyContent="center",d.style.flexShrink="0",c.style.width="100%",c.style.height="100%",c.style.color=i;let u=o.createEl("div",{cls:"task-card__content"});u.createEl("div",{cls:"task-card__title",text:n.title||"Untitled event"});let h=u.createEl("div",{cls:"task-card__metadata"}),f=[],p=pB(n);return p&&f.push(p),n.location&&f.push(n.location),f.push(a),h.textContent=f.join(" \u2022 "),r.addEventListener("click",()=>{let{ICSEventInfoModal:g}=(cm(),fp(hP));new g(e.app,e,n,a).open()}),r.addEventListener("contextmenu",g=>{g.preventDefault(),g.stopPropagation(),new jl({icsEvent:n,plugin:e,subscriptionName:a,onUpdate:()=>{e.app.workspace.trigger("tasknotes:refresh-views")}}).show(g)}),r.style.setProperty("--current-status-color",i),r}function Ey(n,e,t,r={}){var d;let s=(d=t.icsSubscriptionService)==null?void 0:d.getSubscriptions().find(u=>u.id===e.subscriptionId),i=(s==null?void 0:s.color)||"var(--color-accent)",a=(s==null?void 0:s.name)||"Calendar";n.style.setProperty("--current-status-color",i);let o=n.querySelector(".ics-card__icon");o&&(o.style.color=i);let l=n.querySelector(".task-card__title");l&&(l.textContent=e.title||"Untitled event");let c=n.querySelector(".task-card__metadata");if(c){let u=[],h=pB(e);h&&u.push(h),e.location&&u.push(e.location),u.push(a),c.textContent=u.join(" \u2022 ")}}Sn();var gB=require("obsidian");Lt();At();Sl();Fe();var Oa=class extends ri{constructor(t,r,s,i){super();this.plugin=i;this.indexQueryCache=new Map;this.cacheTimeout=3e4;this.cacheTimers=new Map;this.filterOptionsCache=null;this.filterOptionsCacheTimestamp=0;this.filterOptionsCacheTTL=3e5;this.filterOptionsComputeCount=0;this.filterOptionsCacheHits=0;this.cacheManager=t,this.statusManager=r,this.priorityManager=s}async getGroupedTasks(t,r){try{Pe.validateFilterNode(t,!1);let s=this.getIndexOptimizedTaskPaths(t),a=(await this.pathsToTaskInfos(Array.from(s))).filter(l=>this.evaluateFilterNode(t,l,r)),o=this.sortTasks(a,t.sortKey||"due",t.sortDirection||"asc");return this.currentSortKey=t.sortKey||"due",this.currentSortDirection=t.sortDirection||"asc",this.groupTasks(o,t.groupKey||"none",r)}catch(s){if(s instanceof Rr||s instanceof Ra)return console.error("Filter error:",s.message,{nodeId:s.nodeId,field:s.field}),new Map;throw s}}getIndexOptimizedTaskPaths(t){let r=this.analyzeQueryOptimizationSafety(t);if(!r.canOptimize)return this.cacheManager.getAllTaskPaths();if(r.strategy==="intersect"){let s=this.getPathsForIndexableCondition(r.conditions[0]);for(let i=1;i<r.conditions.length;i++){let a=this.getPathsForIndexableCondition(r.conditions[i]);s=this.intersectPathSets(s,a)}return s}else if(r.strategy==="single")return this.getPathsForIndexableCondition(r.conditions[0]);return this.cacheManager.getAllTaskPaths()}analyzeQueryOptimizationSafety(t){let r=this.findIndexableConditions(t);return r.length===0?{canOptimize:!1,conditions:[],reason:"No indexable conditions found"}:this.isSimpleQuery(t,r)?{canOptimize:!0,strategy:r.length===1?"single":"intersect",conditions:r}:{canOptimize:!1,conditions:r,reason:"Complex query structure with OR conditions - optimization not safe"}}isSimpleQuery(t,r){return r.length===0||this.hasIndexableConditionInOrGroup(t,r)?!1:r.length===1||t.type==="group"&&t.conjunction==="and"&&t.children.filter(i=>i.type==="condition"&&this.isIndexableCondition(i)).length===r.length}hasIndexableConditionInOrGroup(t,r){return this.checkNodeForOrWithIndexable(t,r)}checkNodeForOrWithIndexable(t,r){if(t.type==="condition")return!1;if(t.type==="group"){if(t.conjunction==="or"&&t.children.some(i=>i.type==="condition"&&r.includes(i)))return!0;for(let s of t.children)if(this.checkNodeForOrWithIndexable(s,r))return!0}return!1}findIndexableConditions(t){let r=[];if(t.type==="condition")this.isIndexableCondition(t)&&r.push(t);else if(t.type==="group")for(let s of t.children)r.push(...this.findIndexableConditions(s));return r}isIndexableCondition(t){let{property:r,operator:s,value:i}=t;return!!(r==="status"&&s==="is"&&i||r==="due"&&(s==="is"||s==="is-before"||s==="is-after")&&i||r==="scheduled"&&(s==="is"||s==="is-before"||s==="is-after")&&i)}getCachedIndexResult(t,r){let s=this.indexQueryCache.get(t);if(s)return new Set(s);let i=r();this.indexQueryCache.set(t,new Set(i));let a=this.cacheTimers.get(t);a&&clearTimeout(a);let o=setTimeout(()=>{this.indexQueryCache.delete(t),this.cacheTimers.delete(t)},this.cacheTimeout);return this.cacheTimers.set(t,o),i}clearIndexQueryCache(){for(let t of this.cacheTimers.values())clearTimeout(t);this.indexQueryCache.clear(),this.cacheTimers.clear()}getCacheStats(){return{entryCount:this.indexQueryCache.size,cacheKeys:Array.from(this.indexQueryCache.keys()),timeoutMs:this.cacheTimeout}}getPathsForIndexableCondition(t){let{property:r,operator:s,value:i}=t,a=`${r}:${s}:${i}`;return this.getCachedIndexResult(a,()=>r==="status"&&s==="is"&&i&&typeof i=="string"?new Set(this.cacheManager.getTaskPathsByStatus(i)):(r==="due"||r==="scheduled")&&s==="is"&&i&&typeof i=="string"?new Set(this.cacheManager.getTasksForDate(i)):(r==="due"||r==="scheduled")&&(s==="is-before"||s==="is-after")&&i&&typeof i=="string"?this.getTaskPathsForDateRange(r,s,i):this.cacheManager.getAllTaskPaths())}getTaskPathsForDateRange(t,r,s){return this.cacheManager.getAllTaskPaths()}intersectPathSets(t,r){let s=new Set;for(let i of t)r.has(i)&&s.add(i);return s}async pathsToTaskInfos(t){let r=[];for(let i=0;i<t.length;i+=50){let a=t.slice(i,i+50),o=await Promise.all(a.map(l=>this.cacheManager.getCachedTaskInfo(l)));for(let l of o)l&&r.push(l)}return r}evaluateFilterNode(t,r,s){return t.type==="condition"?this.evaluateCondition(t,r,s):t.type==="group"?this.evaluateGroup(t,r,s):!0}evaluateGroup(t,r,s){if(t.children.length===0)return!0;let i=t.children.filter(a=>a.type==="condition"?Pe.isFilterNodeComplete(a):!0);return i.length===0?!0:t.conjunction==="and"?i.every(a=>this.evaluateFilterNode(a,r,s)):t.conjunction==="or"?i.some(a=>this.evaluateFilterNode(a,r,s)):!0}normalizeUserListValue(t){let r=[],s=o=>{if(!o)return;let l=String(o).trim();if(!l)return;let c=l.match(/^\[\[([^|\]]+)(?:\|([^\]]+))?\]\]$/);if(c){let d=c[1]||"",h=c[2]||d.split("#")[0].split("/").pop()||d;h&&r.push(h),r.push(l);return}r.push(l)};if(Array.isArray(t))for(let o of t)s(String(o));else if(typeof t=="string"){let o=un(t);for(let l of o)s(l)}else t!=null&&s(String(t));let i=new Set,a=[];for(let o of r)i.has(o)||(i.add(o),a.push(o));return a}evaluateCondition(t,r,s){var c,d,u;let{property:i,operator:a,value:o}=t;if(typeof i=="string"&&i.startsWith("user:")){let h=i.slice(5),p=(((d=(c=this.plugin)==null?void 0:c.settings)==null?void 0:d.userFields)||[]).find(y=>(y.id||y.key)===h),m;if(p)try{let y=this.cacheManager.getApp(),T=y.vault.getAbstractFileByPath(r.path);if(T){let w=(u=y.metadataCache.getFileCache(T))==null?void 0:u.frontmatter,b=w?w[p.key]:void 0;switch(p.type){case"boolean":m=typeof b=="boolean"?b:String(b).toLowerCase()==="true";break;case"number":m=typeof b=="number"?b:b!=null?parseFloat(String(b)):void 0;break;case"list":m=this.normalizeUserListValue(b);break;default:m=b!=null?String(b):void 0}}}catch(y){}if((p==null?void 0:p.type)==="list"&&(a==="contains"||a==="does-not-contain")){let y=Array.isArray(m)?m:m!=null?[String(m)]:[],w=(Array.isArray(o)?o:[String(o!=null?o:"")]).some(b=>typeof b=="string"&&y.some(S=>typeof S=="string"&&S.toLowerCase().includes(b.toLowerCase())));return a==="contains"?w:!w}let g=(p==null?void 0:p.type)==="date"?"due":i;return Pe.applyOperator(m,a,o,t.id,g)}let l=Pe.getTaskPropertyValue(r,i);if(i==="status.isCompleted"){let h=Hn(r,s||new Date);l=this.statusManager.isCompletedStatus(h)}return i==="projects"&&(a==="contains"||a==="does-not-contain")?this.evaluateProjectsCondition(l,a,o):Pe.applyOperator(l,a,o,t.id,i)}evaluateProjectsCondition(t,r,s){if(!Array.isArray(t)||typeof s!="string")return!1;let i=this.extractProjectName(s);if(!i)return!1;let a=t.some(o=>{if(!o||typeof o!="string")return!1;let l=this.extractProjectName(o);return l?l===i?!0:this.compareProjectWikilinks(o,s):!1});return r==="contains"?a:!a}extractProjectName(t){if(!t||typeof t!="string")return null;if(t.startsWith("[[")&&t.endsWith("]]")){let s=t.slice(2,-2).split("/");return s[s.length-1]||null}return t.trim()||null}compareProjectWikilinks(t,r){var l;if(!((l=this.plugin)!=null&&l.app))return!1;let s=this.extractWikilinkPath(t),i=this.extractWikilinkPath(r);if(!s||!i)return!1;let a=this.plugin.app.metadataCache.getFirstLinkpathDest(s,""),o=this.plugin.app.metadataCache.getFirstLinkpathDest(i,"");return a&&o?a.path===o.path:!1}extractWikilinkPath(t){return!t||typeof t!="string"?null:t.startsWith("[[")&&t.endsWith("]]")?t.slice(2,-2):t}resolveProjectToAbsolutePath(t){var s;if(!t||typeof t!="string")return t||"";if(!((s=this.plugin)!=null&&s.app))return t;if(t.startsWith("[[")&&t.endsWith("]]")){let i=t.slice(2,-2),a=i,o=i.indexOf("|");o!==-1&&(a=i.substring(0,o).trim());let l=this.plugin.app.metadataCache.getFirstLinkpathDest(a,"");return l?l.path.replace(/\.md$/,""):a.replace(/\.md$/,"")}if(t.includes("|")){let a=t.split("|")[0].trim(),o=this.plugin.app.metadataCache.getFirstLinkpathDest(a,"");return o?o.path.replace(/\.md$/,""):a.replace(/\.md$/,"")}if(t.includes("/")){let i=this.plugin.app.metadataCache.getFirstLinkpathDest(t,"");return i?i.path.replace(/\.md$/,""):t.replace(/\.md$/,"")}let r=this.plugin.app.metadataCache.getFirstLinkpathDest(t,"");return r?r.path.replace(/\.md$/,""):t}getPreferredProjectFormat(t){return!t||t==="No Project"?t:t.includes("/")||t.endsWith(".md")?`[[${t}]]`:`[[${t}]]`}async getTaskPathsInDateRange(t,r){let s=new Set,i=qe(t),a=qe(r);for(let d=new Date(i);d<=a;d.setDate(d.getDate()+1)){let u=x(d,"yyyy-MM-dd");this.cacheManager.getTaskPathsByDate(u).forEach(f=>s.add(f))}let o=this.cacheManager.getAllTaskPaths(),l=50,c=Array.from(o);for(let d=0;d<c.length;d+=l){let u=c.slice(d,d+l),h=await Promise.all(u.map(f=>this.cacheManager.getCachedTaskInfo(f)));for(let f of h)if(f&&f.recurrence&&!f.due){for(let p=new Date(i);p<=a;p.setDate(p.getDate()+1))if(Id(f,p)){s.add(f.path);break}}}return s}getOverdueTaskPaths(){return this.cacheManager.getOverdueTaskPaths()}combineTaskPathSets(t){let r=new Set;return t.forEach(s=>{s.forEach(i=>r.add(i))}),r}isDateInRange(t,r,s){try{let i=ve(t),a=ve(r),o=ve(s),l=jp(i),c=jp(a),d=jp(o);return l>=c&&l<=d}catch(i){return console.error("Error checking date range:",{dateString:t,startDateString:r,endDateString:s,error:i}),!1}}isSameDayAs(t,r){try{let s=x(t,"yyyy-MM-dd");return rr(s,r)}catch(s){return console.error("Error comparing date object with date string:",{dateObj:t,dateString:r,error:s}),!1}}sortTasks(t,r,s){return t.sort((i,a)=>{let o=0;if(typeof r=="string"&&r.startsWith("user:"))o=this.compareByUserField(i,a,r);else switch(r){case"due":o=this.compareDates(i.due,a.due);break;case"scheduled":o=this.compareDates(i.scheduled,a.scheduled);break;case"priority":o=this.comparePriorities(i.priority,a.priority);break;case"title":o=i.title.localeCompare(a.title);break;case"dateCreated":o=this.compareDates(i.dateCreated,a.dateCreated);break;case"tags":o=this.compareTags(i.tags,a.tags);break}return o===0&&(o=this.applyFallbackSorting(i,a,r)),s==="desc"?-o:o})}compareDates(t,r){if(!t&&!r)return 0;if(!t)return 1;if(!r)return-1;try{return na(t,r)?-1:na(r,t)?1:0}catch(s){return console.error("Error comparing dates time-aware:",{dateA:t,dateB:r,error:s}),t.localeCompare(r)}}comparePriorities(t,r){let s=this.priorityManager.getPriorityWeight(t);return this.priorityManager.getPriorityWeight(r)-s}compareTags(t,r){let s=t&&t.length>0?t:[],i=r&&r.length>0?r:[];if(s.length===0&&i.length===0)return 0;if(s.length===0)return 1;if(i.length===0)return-1;let a=s[0].toLowerCase(),o=i[0].toLowerCase();return a.localeCompare(o)}applyFallbackSorting(t,r,s){let a=["scheduled","due","priority","title"].filter(o=>o!==s);for(let o of a){let l=0;switch(o){case"scheduled":l=this.compareDates(t.scheduled,r.scheduled);break;case"due":l=this.compareDates(t.due,r.due);break;case"priority":l=this.comparePriorities(t.priority,r.priority);break;case"title":l=t.title.localeCompare(r.title);break}if(l!==0)return l}return 0}compareByUserField(t,r,s){var u,h;let i=s.slice(5),o=(((h=(u=this.plugin)==null?void 0:u.settings)==null?void 0:h.userFields)||[]).find(f=>(f.id||f.key)===i);if(!o)return 0;let l=f=>{var p;try{let m=this.cacheManager.getApp(),g=m.vault.getAbstractFileByPath(f.path),y=g?(p=m.metadataCache.getFileCache(g))==null?void 0:p.frontmatter:void 0;return y?y[o.key]:void 0}catch(m){return}},c=l(t),d=l(r);switch(o.type){case"number":{let f=typeof c=="number"?c:c!=null?parseFloat(String(c)):NaN,p=typeof d=="number"?d:d!=null?parseFloat(String(d)):NaN,m=!isNaN(f),g=!isNaN(p);return m&&g?f-p:m&&!g?-1:!m&&g?1:0}case"boolean":{let f=g=>{if(typeof g=="boolean")return g;if(g==null)return;let y=String(g).trim().toLowerCase();if(y==="true")return!0;if(y==="false")return!1},p=f(c),m=f(d);return p===m?0:p===!0?-1:m===!0?1:p===!1?-1:m===!1?1:0}case"date":{let f=c?Date.parse(String(c)):NaN,p=d?Date.parse(String(d)):NaN,m=!isNaN(f),g=!isNaN(p);return m&&g?f-p:m&&!g?-1:!m&&g?1:0}case"list":{let f=g=>{if(Array.isArray(g))return this.normalizeUserListValue(g)[0];if(typeof g=="string")return g.trim().length===0?"":this.normalizeUserListValue(g)[0]},p=f(c),m=f(d);return(p==null||p==="")&&(m==null||m==="")?0:p==null||p===""?1:m==null||m===""?-1:p.localeCompare(m)}case"text":default:{let f=c!=null?String(c):"",p=d!=null?String(d):"";return f.localeCompare(p)}}}groupTasks(t,r,s){if(r==="none")return new Map([["all",t]]);let i=new Map;for(let a of t)if(r==="project"){let o=qr(a.projects||[]);if(o.length>0)for(let l of o){let c=this.resolveProjectToAbsolutePath(l);i.has(c)||i.set(c,[]),i.get(c).push(a)}else{let l="No Project";i.has(l)||i.set(l,[]),i.get(l).push(a)}}else if(r==="tags"){let o=a.tags||[];if(o.length>0)for(let l of o)i.has(l)||i.set(l,[]),i.get(l).push(a);else{let l="No Tags";i.has(l)||i.set(l,[]),i.get(l).push(a)}}else{let o;if(typeof r=="string"&&r.startsWith("user:"))o=this.getUserFieldGroupValue(a,r);else switch(r){case"status":o=a.status||"no-status";break;case"priority":o=a.priority||"unknown";break;case"context":o=a.contexts&&a.contexts.length>0?a.contexts[0]:"none";break;case"due":o=this.getDueDateGroup(a,s);break;case"scheduled":o=this.getScheduledDateGroup(a,s);break;default:o="unknown"}i.has(o)||i.set(o,[]),i.get(o).push(a)}return this.sortGroups(i,r)}getUserFieldGroupValue(t,r){var o,l,c;let s=r.slice(5),a=(((l=(o=this.plugin)==null?void 0:o.settings)==null?void 0:l.userFields)||[]).find(d=>(d.id||d.key)===s);if(!a)return"unknown-field";try{let d=this.cacheManager.getApp(),u=d.vault.getAbstractFileByPath(t.path);if(!u)return"no-value";let h=(c=d.metadataCache.getFileCache(u))==null?void 0:c.frontmatter,f=h?h[a.key]:void 0;switch(a.type){case"boolean":{if(typeof f=="boolean")return f?"true":"false";if(f==null)return"no-value";let p=String(f).trim().toLowerCase();return p==="true"?"true":p==="false"?"false":"no-value"}case"number":{if(typeof f=="number")return String(f);if(typeof f=="string"){let p=f.match(/^(\d+(?:\.\d+)?)/);return p?p[1]:"non-numeric"}return"no-value"}case"date":return f?String(f):"no-date";case"list":{if(Array.isArray(f)){let p=this.normalizeUserListValue(f);return p.length>0?p[0]:"empty"}if(typeof f=="string"){if(f.trim().length===0)return"empty";let p=this.normalizeUserListValue(f);return p.length>0?p[0]:"empty"}return"no-value"}case"text":default:return f?String(f).trim()||"empty":"no-value"}}catch(d){return console.error("Error extracting user field value for grouping",d),"error"}}getDueDateGroup(t,r){var o,l,c;let s=r||new Date;s.setHours(0,0,0,0);let i=this.statusManager.isCompletedStatus(t.status),a=(c=(l=(o=this.plugin)==null?void 0:o.settings)==null?void 0:l.hideCompletedFromOverdue)!=null?c:!0;if(t.recurrence)if(Id(t,s)){let d=x(s,"yyyy-MM-dd");return this.getDateGroupFromDateStringWithTask(d,i,a)}else return t.due?this.getDateGroupFromDateStringWithTask(t.due,i,a):"No due date";return t.due?this.getDateGroupFromDateStringWithTask(t.due,i,a):"No due date"}getDateGroupFromDateString(t){let r=Kt();if(Ln(t))return"Overdue";let s=ve(t);if(rr(s,r))return"Today";try{let i=new Date;i.setDate(i.getDate()+1);let a=x(i,"yyyy-MM-dd");if(rr(s,a))return"Tomorrow";let o=new Date;o.setDate(o.getDate()+7);let l=x(o,"yyyy-MM-dd");return On(s,l)||rr(s,l)?"Next seven days":"Later"}catch(i){return console.error(`Error categorizing date ${t}:`,i),"Invalid Date"}}getDueDateGroupFromDate(t){return this.getDateGroupFromDateString(t)}getDueDateGroupForTask(t){var i,a,o;if(!t.due)return"No due date";let r=this.statusManager.isCompletedStatus(t.status),s=(o=(a=(i=this.plugin)==null?void 0:i.settings)==null?void 0:a.hideCompletedFromOverdue)!=null?o:!0;return this.getDateGroupFromDateStringWithTask(t.due,r,s)}getDateGroupFromDateStringWithTask(t,r,s){let i=Kt();if(Ln(t,r,s))return"Overdue";let a=ve(t);if(rr(a,i))return"Today";try{let o=new Date;o.setDate(o.getDate()+1);let l=x(o,"yyyy-MM-dd");if(rr(a,l))return"Tomorrow";let c=new Date;c.setDate(c.getDate()+7);let d=x(c,"yyyy-MM-dd");return On(a,d)||rr(a,d)?"Next seven days":"Later"}catch(o){return console.error(`Error categorizing date ${t}:`,o),"Invalid Date"}}getScheduledDateGroup(t,r){var a,o,l;if(!t.scheduled)return"No scheduled date";let s=this.statusManager.isCompletedStatus(t.status),i=(l=(o=(a=this.plugin)==null?void 0:a.settings)==null?void 0:o.hideCompletedFromOverdue)!=null?l:!0;return this.getScheduledDateGroupForTask(t.scheduled,s,i)}getScheduledDateGroupForTask(t,r,s){let i=Kt();if(Ln(t,r,s))return"Past scheduled";let a=ve(t);if(rr(a,i))return"Today";try{let o=new Date;o.setDate(o.getDate()+1);let l=x(o,"yyyy-MM-dd");if(rr(a,l))return"Tomorrow";let c=new Date;c.setDate(c.getDate()+7);let d=x(c,"yyyy-MM-dd");return On(a,d)||rr(a,d)?"Next seven days":"Later"}catch(o){return console.error(`Error categorizing scheduled date ${t}:`,o),"Invalid Date"}}getScheduledDateGroupFromDate(t){let r=Kt();if(Ln(t))return"Past scheduled";let s=ve(t);if(rr(s,r))return"Today";try{let i=new Date;i.setDate(i.getDate()+1);let a=x(i,"yyyy-MM-dd");if(rr(s,a))return"Tomorrow";let o=new Date;o.setDate(o.getDate()+7);let l=x(o,"yyyy-MM-dd");return On(s,l)||rr(s,l)?"Next seven days":"Later"}catch(i){return console.error(`Error categorizing scheduled date ${t}:`,i),"Invalid Date"}}sortGroups(t,r){let s=new Map,i;if(typeof r=="string"&&r.startsWith("user:"))i=this.sortUserFieldGroups(Array.from(t.keys()),r),this.currentSortKey===r&&this.currentSortDirection==="desc"&&i.reverse();else switch(r){case"priority":i=Array.from(t.keys()).sort((a,o)=>{let l=this.priorityManager.getPriorityWeight(a);return this.priorityManager.getPriorityWeight(o)-l});break;case"status":i=Array.from(t.keys()).sort((a,o)=>{let l=this.statusManager.getStatusOrder(a),c=this.statusManager.getStatusOrder(o);return l-c});break;case"due":{let a=["Overdue","Today","Tomorrow","Next seven days","Later","No due date"];i=Array.from(t.keys()).sort((o,l)=>{let c=a.indexOf(o),d=a.indexOf(l);return c-d});break}case"scheduled":{let a=["Past scheduled","Today","Tomorrow","Next seven days","Later","No scheduled date"];i=Array.from(t.keys()).sort((o,l)=>{let c=a.indexOf(o),d=a.indexOf(l);return c-d});break}case"project":i=Array.from(t.keys()).sort((a,o)=>a==="No Project"?1:o==="No Project"?-1:a.localeCompare(o));break;case"tags":i=Array.from(t.keys()).sort((a,o)=>a==="No Tags"?1:o==="No Tags"?-1:a.localeCompare(o));break;default:i=Array.from(t.keys()).sort()}for(let a of i)s.set(a,t.get(a));return s}sortUserFieldGroups(t,r){var o,l;let s=r.slice(5),a=(((l=(o=this.plugin)==null?void 0:o.settings)==null?void 0:l.userFields)||[]).find(c=>(c.id||c.key)===s);if(!a)return t.sort();switch(a.type){case"number":return t.sort((c,d)=>{let u=parseFloat(c),h=parseFloat(d),f=!isNaN(u),p=!isNaN(h);return f&&p?h-u:f&&!p?-1:!f&&p?1:c.localeCompare(d)});case"boolean":return t.sort((c,d)=>c==="true"&&d==="false"?-1:c==="false"&&d==="true"?1:c.localeCompare(d));case"date":return t.sort((c,d)=>{let u=Date.parse(c),h=Date.parse(d),f=!isNaN(u),p=!isNaN(h);return f&&p?u-h:f&&!p?-1:!f&&p?1:c.localeCompare(d)});case"text":case"list":default:return t.sort((c,d)=>c.localeCompare(d))}}async getFilterOptions(){let t=Date.now();if(this.filterOptionsCache&&t-this.filterOptionsCacheTimestamp<this.filterOptionsCacheTTL)return this.filterOptionsCacheHits++,this.filterOptionsCache;let r={statuses:this.statusManager.getAllStatuses(),priorities:this.priorityManager.getAllPriorities(),contexts:this.cacheManager.getAllContexts(),projects:this.cacheManager.getAllProjects(),tags:this.cacheManager.getAllTags(),folders:this.extractUniqueFolders(),userProperties:this.buildUserPropertyDefinitions()};return this.filterOptionsComputeCount++,this.filterOptionsCache=r,this.filterOptionsCacheTimestamp=t,r}buildUserPropertyDefinitions(){var s,i;let t=((i=(s=this.plugin)==null?void 0:s.settings)==null?void 0:i.userFields)||[],r=[];for(let a of t){if(!a||!a.key||!a.displayName)continue;let o=`user:${a.id||a.key}`,l,c;switch(a.type){case"number":l=["is","is-not","is-greater-than","is-less-than","is-greater-than-or-equal","is-less-than-or-equal","is-empty","is-not-empty"],c="number";break;case"date":l=["is","is-not","is-before","is-after","is-on-or-before","is-on-or-after","is-empty","is-not-empty"],c="date";break;case"boolean":l=["is-checked","is-not-checked"],c="none";break;case"list":l=["contains","does-not-contain","is-empty","is-not-empty"],c="text";break;case"text":default:l=["is","is-not","contains","does-not-contain","is-empty","is-not-empty"],c="text";break}r.push({id:o,label:a.displayName,category:a.type==="boolean"?"boolean":a.type==="number"?"numeric":a.type==="date"?"date":"text",supportedOperators:l,valueInputType:c})}return r}checkAndInvalidateFilterOptionsCache(){if(!this.filterOptionsCache)return;Date.now()-this.filterOptionsCacheTimestamp>3e4&&this.invalidateFilterOptionsCache()}invalidateFilterOptionsCache(){this.filterOptionsCache&&(this.filterOptionsCache=null)}refreshFilterOptions(){this.invalidateFilterOptionsCache()}getFilterOptionsCacheStats(){let t=Date.now(),r=this.filterOptionsCache?t-this.filterOptionsCacheTimestamp:0,s=this.filterOptionsCache?Math.max(0,this.filterOptionsCacheTTL-r):0,i=this.filterOptionsCacheHits+this.filterOptionsComputeCount,a=i>0?(this.filterOptionsCacheHits/i*100).toFixed(1)+"%":"0%";return{cacheHits:this.filterOptionsCacheHits,computeCount:this.filterOptionsComputeCount,hitRate:a,isCurrentlyCached:!!this.filterOptionsCache,cacheAge:r,ttlRemaining:s}}createDefaultQuery(){return{type:"group",id:Pe.generateId(),conjunction:"and",children:[],sortKey:"due",sortDirection:"asc",groupKey:"none"}}addQuickToggleCondition(t,r,s){let i=JSON.parse(JSON.stringify(t));if(this.removeQuickToggleCondition(i,r),!s){let a;switch(r){case"showCompleted":a={type:"condition",id:Pe.generateId(),property:"status.isCompleted",operator:"is-not-checked",value:null};break;case"showArchived":a={type:"condition",id:Pe.generateId(),property:"archived",operator:"is-not-checked",value:null};break;case"showRecurrent":a={type:"condition",id:Pe.generateId(),property:"recurrence",operator:"is-empty",value:null};break}i.children.push(a)}return i}removeQuickToggleCondition(t,r){let s;switch(r){case"showCompleted":s="status.isCompleted";break;case"showArchived":s="archived";break;case"showRecurrent":s="recurrence";break}t.children=t.children.filter(i=>i.type==="condition"?i.property!==s:!0)}normalizeQuery(t){let r=this.createDefaultQuery();return{...r,...t,type:"group",id:t.id||r.id,conjunction:t.conjunction||r.conjunction,children:t.children||r.children,sortKey:t.sortKey||r.sortKey,sortDirection:t.sortDirection||r.sortDirection,groupKey:t.groupKey||r.groupKey}}initialize(){this.cacheManager.on("file-updated",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-added",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-deleted",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("file-renamed",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")}),this.cacheManager.on("indexes-built",()=>{this.clearIndexQueryCache(),this.checkAndInvalidateFilterOptionsCache(),this.emit("data-changed")})}cleanup(){this.clearIndexQueryCache(),this.invalidateFilterOptionsCache(),this.removeAllListeners()}static createDateRangeFromDates(t){if(t.length===0)throw new Error("No dates provided");let r=t[0],s=t[t.length-1];return{start:x(r,"yyyy-MM-dd"),end:x(s,"yyyy-MM-dd")}}static shouldIncludeOverdueForRange(t,r){if(!r)return!1;let i=x(new Date,"yyyy-MM-dd");return t.some(a=>x(a,"yyyy-MM-dd")===i)}async getTasksForDate(t,r,s=!1){let i=me(t),a=sa(i),o=this.cacheManager.getAllTaskPaths(),d=(await this.pathsToTaskInfos(Array.from(o))).filter(u=>this.evaluateFilterNode(r,u)).filter(u=>{var h,f,p;if(u.recurrence){let m=qe(i);return Id(u,m)}if(u.due&&ve(u.due)===i||u.scheduled&&ve(u.scheduled)===i)return!0;if(s&&a){let m=this.statusManager.isCompletedStatus(u.status),g=(p=(f=(h=this.plugin)==null?void 0:h.settings)==null?void 0:f.hideCompletedFromOverdue)!=null?p:!0;if(u.due&&ve(u.due)!==i&&Ln(u.due,m,g)||u.scheduled&&ve(u.scheduled)!==i&&Ln(u.scheduled,m,g))return!0}return!1});return this.sortTasks(d,r.sortKey||"due",r.sortDirection||"asc")}async getAgendaData(t,r,s=!1){let i=[];for(let a of t){let o=await this.getTasksForDate(a,r,s&&bd(a));i.push({date:new Date(a),tasks:o})}return i}async getFlatAgendaData(t,r,s=!1){let i=await this.getAgendaData(t,r,s),a=[];for(let o of i)for(let l of o.tasks)a.push({...l,agendaDate:o.date});return a}extractUniqueFolders(){let t=this.cacheManager.getAllTaskPaths(),r=new Set;for(let i of t){let a=i.lastIndexOf("/");if(a>0){let o=i.substring(0,a);r.add(o)}else a===-1&&r.add("")}return Array.from(r).sort().map(i=>i===""?"(Root)":i)}extractProjectNamesFromTaskValue(t,r){if(!t||t.trim()===""||t==='""')return[];let s=t.replace(/^"(.*)"$/,"$1");if(s.startsWith("[[")&&s.endsWith("]]")){let i=s.slice(2,-2),a=(0,gB.parseLinktext)(i),o=this.cacheManager.getApp().metadataCache.getFirstLinkpathDest(a.path,r);if(o)return[o.basename];{let l=a.subpath||(a.path.includes("/")?a.path.split("/").pop():a.path);return l?[l]:[]}}else return[s]}};var Gf=class extends br.ItemView{constructor(t,r){super(t);this.daysToShow=7;this.groupByDate=!0;this.showOverdueOnToday=!0;this.showNotes=!0;this.showICSEvents=!0;this.filterBar=null;this.filterHeading=null;this.listeners=[];this.functionListeners=[];this.plugin=r,this.startDate=new Date(r.selectedDate),this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"scheduled",sortDirection:"asc",groupKey:"none"},this.registerEvents()}registerEvents(){this.listeners.forEach(o=>this.plugin.emitter.offref(o)),this.listeners=[],this.functionListeners.forEach(o=>o()),this.functionListeners=[];let t=this.plugin.emitter.on(fr,async()=>{if(this.refresh(),this.filterBar){let o=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(o)}});this.listeners.push(t);let r=this.plugin.emitter.on(pn,async()=>{this.refresh()});this.listeners.push(r);let s=this.plugin.emitter.on(ra,o=>{this.startDate=new Date(o),this.updatePeriodDisplay(),this.refresh()});this.listeners.push(s);let i=this.plugin.emitter.on(tt,async({path:o,originalTask:l,updatedTask:c})=>{if(c&&await tl(c,this.plugin,this.contentEl),this.refresh(),this.filterBar){let d=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(d)}});this.listeners.push(i);let a=this.plugin.filterService.on("data-changed",()=>{this.refresh()});if(this.functionListeners.push(a),this.plugin.icsSubscriptionService){let o=this.plugin.icsSubscriptionService.on("data-changed",()=>{this.refresh()});this.functionListeners.push(o)}}getViewType(){return Qt}getDisplayText(){return"Agenda"}getIcon(){return"calendar-clock"}async onOpen(){await this.plugin.onReady(),await this.plugin.waitForMigration();let t=this.plugin.viewStateManager.getFilterState(Qt);t&&(this.currentQuery=t);let r=this.contentEl;r.empty();let s=r.createDiv({cls:"tasknotes-plugin agenda-view"});this.showLoadingIndicator(),await this.renderView(s),this.hideLoadingIndicator()}async onClose(){this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.functionListeners.forEach(t=>t()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.filterHeading&&(this.filterHeading.destroy(),this.filterHeading=null),this.contentEl.empty()}async renderView(t){t.empty(),await this.createAgendaControls(t),await this.renderAgendaContent(t)}async createAgendaControls(t){let r=t.createDiv({cls:"agenda-view__controls"}),i=r.createDiv({cls:"agenda-view__header"}).createDiv({cls:"agenda-view__header-content"}),a=i.createDiv({cls:"agenda-view__nav-section"}),o=a.createEl("button",{cls:"agenda-view__nav-button agenda-view__nav-button--prev",text:"\u2039",attr:{"aria-label":"Previous period",title:"Previous period"}});o.addClass("clickable-icon");let l=a.createEl("button",{cls:"agenda-view__nav-button agenda-view__nav-button--next",text:"\u203A",attr:{"aria-label":"Next period",title:"Next period"}});l.addClass("clickable-icon"),i.createDiv({cls:"agenda-view__title-section"}).createDiv({cls:"agenda-view__period-title",text:this.getCurrentPeriodText()});let d=i.createDiv({cls:"agenda-view__actions-section"});o.addEventListener("click",()=>{this.navigateToPreviousPeriod()}),l.addEventListener("click",()=>{this.navigateToNextPeriod()});let u=d.createEl("button",{text:"Today",cls:"agenda-view__today-button",attr:{"aria-label":"Go to today",title:"Go to today"}});u.addClass("clickable-icon"),u.addEventListener("click",()=>{let T=Ge();this.startDate=T,this.plugin.setSelectedDate(T),this.updatePeriodDisplay(),this.refresh()});let h=d.createEl("button",{text:"Refresh calendars",cls:"agenda-view__today-button",attr:{"aria-label":"Refresh calendar subscriptions",title:"Refresh calendar subscriptions"}});h.addClass("clickable-icon"),h.addEventListener("click",async()=>{if(!this.plugin.icsSubscriptionService){new br.Notice("Calendar service not ready yet");return}try{await this.plugin.icsSubscriptionService.refreshAllSubscriptions(),new br.Notice("Calendar subscriptions refreshed"),this.refresh()}catch(T){console.error("Failed to refresh ICS subscriptions",T),new br.Notice("Failed to refresh calendar subscriptions")}});let f=r.createDiv({cls:"agenda-view__filter-container"});await this.waitForCacheReady(),this.currentQuery=this.plugin.filterService.createDefaultQuery(),this.currentQuery.sortKey="scheduled",this.currentQuery.sortDirection="asc",this.currentQuery.groupKey="none";let p=this.plugin.viewStateManager.getFilterState(Qt);p&&(this.currentQuery=p);let m=await this.plugin.filterService.getFilterOptions();this.filterBar=new Xs(this.app,this.plugin,f,this.currentQuery,m,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"agenda"});let g=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(g),this.filterBar.on("saveView",({name:T,query:w,viewOptions:b,visibleProperties:S})=>{let k=this.plugin.viewStateManager.saveView(T,w,b,S);this.filterBar.setActiveSavedView(k)}),this.filterBar.on("deleteView",T=>{this.plugin.viewStateManager.deleteView(T)}),this.filterBar.on("loadViewOptions",T=>{this.applyViewOptions(T)}),this.plugin.viewStateManager.on("saved-views-changed",T=>{var w;(w=this.filterBar)==null||w.updateSavedViews(T)}),this.filterBar.on("reorderViews",(T,w)=>{this.plugin.viewStateManager.reorderSavedViews(T,w)}),this.filterBar.on("manageViews",()=>{console.log("Manage views requested")}),this.filterBar.on("queryChange",async T=>{this.currentQuery=T;let w=T;await this.plugin.viewStateManager.setFilterState(Qt,w),this.refresh()}),this.filterBar.on("activeSavedViewChanged",()=>{this.updateFilterHeading()}),this.filterBar.on("propertiesChanged",T=>{this.refresh()}),this.filterBar.on("expandAllGroups",()=>{this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(S=>{let k=S;k.classList.remove("is-collapsed");let D=k.querySelector(".agenda-view__day-items");D&&(D.style.display="");let M=k.querySelector(".task-group-toggle");M&&M.setAttr("aria-expanded","true")});let b={...this.plugin.viewStateManager.getViewPreferences(Qt)||{},collapsedDays:{}};this.plugin.viewStateManager.setViewPreferences(Qt,b)}),this.filterBar.on("collapseAllGroups",()=>{let T={};this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(k=>{let D=k,M=D.dataset.day;M&&(T[M]=!0),D.classList.add("is-collapsed");let _=D.querySelector(".agenda-view__day-items");_&&(_.style.display="none");let W=D.querySelector(".task-group-toggle");W&&W.setAttr("aria-expanded","false")});let S={...this.plugin.viewStateManager.getViewPreferences(Qt)||{},collapsedDays:T};this.plugin.viewStateManager.setViewPreferences(Qt,S)}),this.filterHeading=new Na(t);let y=t.querySelector(".filter-heading");if(y){let T=y.querySelector(".filter-heading__content");if(T){let w=T.createDiv({cls:"filter-heading__controls"});this.createExpandCollapseButtons(w)}}this.updateFilterHeading(),this.setupViewOptions()}createExpandCollapseButtons(t){t.style.display="flex",t.empty(),new br.ButtonComponent(t).setIcon("list-tree").setTooltip("Expand All Days").setClass("agenda-view-control-button").onClick(()=>{this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(l=>{let c=l;c.classList.remove("is-collapsed");let d=c.querySelector(".agenda-view__day-items");d&&(d.style.display="");let u=c.querySelector(".task-group-toggle");u&&u.setAttr("aria-expanded","true")});let o={...this.plugin.viewStateManager.getViewPreferences(Qt)||{},collapsedDays:{}};this.plugin.viewStateManager.setViewPreferences(Qt,o)}).buttonEl.addClass("clickable-icon"),new br.ButtonComponent(t).setIcon("list-collapse").setTooltip("Collapse All Days").setClass("agenda-view-control-button").onClick(()=>{let i={};this.contentEl.querySelectorAll(".agenda-view__day-section.task-group").forEach(c=>{let d=c,u=d.dataset.day;u&&(i[u]=!0),d.classList.add("is-collapsed");let h=d.querySelector(".agenda-view__day-items");h&&(h.style.display="none");let f=d.querySelector(".task-group-toggle");f&&f.setAttr("aria-expanded","false")});let l={...this.plugin.viewStateManager.getViewPreferences(Qt)||{},collapsedDays:i};this.plugin.viewStateManager.setViewPreferences(Qt,l)}).buttonEl.addClass("clickable-icon")}setupViewOptions(){if(!this.filterBar)return;let t=[{id:"showOverdueOnToday",label:"Show overdue on today",value:this.showOverdueOnToday,onChange:r=>{this.showOverdueOnToday=r,this.refresh()}},{id:"showNotes",label:"Show notes",value:this.showNotes,onChange:r=>{this.showNotes=r,this.refresh()}},{id:"icsEvents",label:"Calendar subscriptions",value:this.showICSEvents,onChange:r=>{this.showICSEvents=r,this.refresh()}}];this.filterBar.setViewOptions(t)}applyViewOptions(t){t.hasOwnProperty("showOverdueOnToday")&&(this.showOverdueOnToday=t.showOverdueOnToday),t.hasOwnProperty("showNotes")&&(this.showNotes=t.showNotes),t.hasOwnProperty("icsEvents")&&(this.showICSEvents=t.icsEvents),t.hasOwnProperty("showICSEvents")&&(this.showICSEvents=t.showICSEvents),this.setupViewOptions(),this.refresh()}renderPeriodSelector(t){let r=t.createEl("select",{cls:"agenda-view__period-select"});[{value:"7",text:"7 days"},{value:"14",text:"14 days"},{value:"30",text:"30 days"},{value:"week",text:"This week"}].forEach(i=>{let a=r.createEl("option",{value:i.value,text:i.text});(i.value==="7"&&this.daysToShow===7||i.value==="week"&&this.daysToShow===-1)&&(a.selected=!0)}),r.addEventListener("change",()=>{let i=r.value;i==="week"?this.daysToShow=-1:this.daysToShow=parseInt(i),this.refresh()})}getDateRange(){let t=this.getAgendaDates();return Oa.createDateRangeFromDates(t)}async addNotesToAgendaData(t){if(this.plugin.settings.disableNoteIndexing||!this.showNotes)return t.map(s=>({...s,notes:[]}));let r=t.map(async s=>{let i=await this.plugin.cacheManager.getNotesForDate(s.date);return{...s,notes:i}});return Promise.all(r)}async renderAgendaContent(t){let r=t.querySelector(".agenda-view__content");r||(r=t.createDiv({cls:"agenda-view__content"}));try{let s=this.getAgendaDates(),i=[];for(let l of s){let c=await this.plugin.filterService.getTasksForDate(l,this.currentQuery,this.showOverdueOnToday),d=[];if(this.showICSEvents&&this.plugin.icsSubscriptionService){let u=this.plugin.icsSubscriptionService.getAllEvents();d=this.filterICSEventsForDate(u,l)}i.push({date:l,tasks:c,ics:d})}let o=(await this.addNotesToAgendaData(i.map(l=>({date:l.date,tasks:l.tasks})))).map((l,c)=>({...l,ics:i[c].ics}));this.groupByDate?this.renderGroupedAgendaWithReconciler(r,o):this.renderFlatAgendaWithReconciler(r,o)}catch(s){console.error("Error rendering agenda content:",s),r.empty(),r.createDiv({cls:"agenda-view__error"}).createSpan({text:"Error loading agenda. Please try refreshing."})}}filterICSEventsForDate(t,r){try{let s=ro(r),i=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0),a=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999);return t.filter(o=>{let l=new Date(o.start),c=o.end?new Date(o.end):null;return c?l<=a&&c>=i:l>=i&&l<=a})}catch(s){return[]}}renderGroupedAgendaWithReconciler(t,r){t.empty();let s=!1;if(r.forEach(i=>{let a=me(i.date);if(i.tasks.length>0||i.notes.length>0||this.showICSEvents&&i.ics.length>0){s=!0;let l=a,c=this.isDayCollapsed(l),d=t.createDiv({cls:"agenda-view__day-section task-group"});d.setAttribute("data-day",l);let u=this.createDayHeader(i,l);d.appendChild(u);let h=d.createDiv({cls:"agenda-view__day-items"});c&&(d.addClass("is-collapsed"),h.style.display="none"),this.addDayHeaderClickHandlers(u,d,h,l);let f=[];i.tasks.forEach(p=>{f.push({type:"task",item:p,date:i.date})}),i.notes.forEach(p=>{f.push({type:"note",item:p,date:i.date})}),this.showICSEvents&&[...i.ics].sort((m,g)=>{try{let y=new Date(m.start).getTime(),T=new Date(g.start).getTime();return y-T}catch(y){return 0}}).forEach(m=>{f.push({type:"ics",item:m,date:i.date})}),this.plugin.domReconciler.updateList(h,f,p=>`${p.type}-${p.item.path||p.item.id||"unknown"}`,p=>this.createDayItemElement(p),(p,m)=>this.updateDayItemElement(p,m))}}),!s){t.empty();let i=t.createDiv({cls:"agenda-view__empty"});new br.Setting(i).setName("No items scheduled").setHeading(),i.createEl("p",{text:"No items scheduled for this period.",cls:"agenda-view__empty-description"});let a=i.createEl("p",{cls:"agenda-view__empty-tip"});a.createEl("span",{text:"Tip: "}),a.appendChild(document.createTextNode("Create tasks with due or scheduled dates, or add notes to see them here."));return}}renderFlatAgendaWithReconciler(t,r){let s=[];if(r.forEach(i=>{i.tasks.forEach(a=>{s.push({type:"task",item:a,date:i.date})}),i.notes.forEach(a=>{s.push({type:"note",item:a,date:i.date})}),this.showICSEvents&&[...i.ics].sort((o,l)=>{try{let c=new Date(o.start).getTime(),d=new Date(l.start).getTime();return c-d}catch(c){return 0}}).forEach(o=>{s.push({type:"ics",item:o,date:i.date})})}),s.length===0){t.empty();let i=t.createDiv({cls:"agenda-view__empty"});new br.Setting(i).setName("No items found").setHeading(),i.createEl("p",{text:"No items found for the selected period.",cls:"agenda-view__empty-description"});return}s.sort((i,a)=>i.date.getTime()-a.date.getTime()),this.plugin.domReconciler.updateList(t,s,i=>`${i.type}-${i.item.path||i.item.id||"unknown"}`,i=>this.createFlatAgendaItemElement(i),(i,a)=>this.updateFlatAgendaItemElement(i,a))}createAgendaItemElement(t){var r,s;if(t.type==="day-header"){let i=document.createElement("div");i.className="agenda-view__day-header task-group-header",i.setAttribute("data-day",t.dayKey);let a=i.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle day"}});try{(0,br.setIcon)(a,"chevron-right")}catch(p){}let o=a.querySelector("svg");o?(o.classList.add("chevron"),o.setAttr("width","16"),o.setAttr("height","16")):(a.textContent="\u25B8",a.addClass("chevron-text"));let l=i.createDiv({cls:"agenda-view__day-header-text"}),c=ro(t.date),d=x(c,"EEEE"),u=x(c,"MMMM d");bd(t.date)?(l.createSpan({cls:"agenda-view__day-name agenda-view__day-name--today",text:"Today"}),l.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${u}`})):(l.createSpan({cls:"agenda-view__day-name",text:d}),l.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${u}`}));let h=t.item.tasks||[],f;if(h.length>0){let p=xt.calculateGroupStats(h,this.plugin);f=xt.formatGroupCount(p.completed,p.total).text}else f=`${(((r=t.item.notes)==null?void 0:r.length)||0)+(((s=t.item.ics)==null?void 0:s.length)||0)}`;return i.createDiv({cls:"agenda-view__item-count",text:f}),i}else return t.type==="task"?this.createTaskItemElement(t.item,t.date):t.type==="note"?this.createNoteItemElement(t.item,t.date):this.createICSEventItemElement(t.item)}updateAgendaItemElement(t,r){var s,i;if(r.type==="day-header"){let a=t.querySelector(".agenda-view__item-count");if(a){let o=r.item.tasks||[],l;if(o.length>0){let c=xt.calculateGroupStats(o,this.plugin);l=xt.formatGroupCount(c.completed,c.total).text}else l=`${(((s=r.item.notes)==null?void 0:s.length)||0)+(((i=r.item.ics)==null?void 0:i.length)||0)}`;a.textContent=l}}else if(r.type==="task"){let a=this.getCurrentVisibleProperties();en(t,r.item,this.plugin,a,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r.date})}else r.type==="ics"&&Ey(t,r.item,this.plugin)}createFlatAgendaItemElement(t){return t.type==="task"?this.createTaskItemElement(t.item,t.date):t.type==="note"?this.createNoteItemElement(t.item,t.date):this.createICSEventItemElement(t.item)}updateFlatAgendaItemElement(t,r){if(r.type==="task"){let s=this.getCurrentVisibleProperties();en(t,r.item,this.plugin,s,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r.date})}else r.type==="ics"&&Ey(t,r.item,this.plugin)}getCurrentVisibleProperties(){var t;return(t=this.filterBar)==null?void 0:t.getCurrentVisibleProperties()}createTaskItemElement(t,r){let s=this.getCurrentVisibleProperties(),i=cr(t,this.plugin,s,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r});return this.plugin.statusManager.isCompletedStatus(t.status)&&i.classList.add("done"),this.addDragHandlers(i,t),i}createNoteItemElement(t,r){let s=by(t,this.plugin,{showCreatedDate:!1,showTags:!0,showPath:!1,maxTags:3,showDailyNoteBadge:!1});if(!this.groupByDate&&r){let i=ro(r);s.createSpan({cls:"agenda-view__note-date",text:x(i,"MMM d")})}return s}createICSEventItemElement(t){return mB(t,this.plugin,{})}addDragHandlers(t,r){this.plugin.dragDropManager.makeTaskCardDraggable(t,r.path)}addHoverPreview(t,r){t.addEventListener("mouseover",s=>{this.app.vault.getAbstractFileByPath(r)&&this.app.workspace.trigger("hover-link",{event:s,source:"tasknotes-agenda",hoverParent:this,targetEl:t,linktext:r,sourcePath:r})})}openFile(t){let r=this.app.vault.getAbstractFileByPath(t);r instanceof br.TFile&&this.app.workspace.getLeaf(!1).openFile(r)}getAgendaDates(){let t=[];if(this.daysToShow===-1){let s={weekStartsOn:this.plugin.settings.calendarViewSettings.firstDay||0},i=kr(this.startDate,s),a=qa(this.startDate,s),o=i;for(;o<=a;){let l=wt(o);t.push(l),o=Or(o,1)}}else for(let r=0;r<this.daysToShow;r++){let s=Or(this.startDate,r),i=wt(s);t.push(i)}return t}navigateToPreviousPeriod(){this.daysToShow===-1?this.startDate=Or(this.startDate,-7):this.startDate=Or(this.startDate,-this.daysToShow),this.updatePeriodDisplay(),this.refresh()}navigateToNextPeriod(){this.daysToShow===-1?this.startDate=Or(this.startDate,7):this.startDate=Or(this.startDate,this.daysToShow),this.updatePeriodDisplay(),this.refresh()}updatePeriodDisplay(){let t=this.contentEl.querySelector(".agenda-view__period-title");t&&(t.textContent=this.getCurrentPeriodText())}getCurrentPeriodText(){let t=this.getAgendaDates();if(t.length===0)return"";let r=ro(t[0]),s=ro(t[t.length-1]);return nd(t[0],t[t.length-1])?x(r,"EEEE, MMMM d, yyyy"):`${x(r,"MMM d")} - ${x(s,"MMM d, yyyy")}`}showLoadingIndicator(){let t=this.contentEl.querySelector(".agenda-view");if(!t||t.querySelector(".agenda-view__loading"))return;let r=document.createElement("div");r.className="agenda-view__loading",r.textContent="Loading agenda...",t.prepend(r)}hideLoadingIndicator(){let t=this.contentEl.querySelector(".agenda-view__loading");t&&t.remove()}async updateFilterHeading(){if(!(!this.filterHeading||!this.filterBar))try{let t=this.getAgendaDates(),r=[];for(let a of t){let o=await this.plugin.filterService.getTasksForDate(a,this.currentQuery,this.showOverdueOnToday);r.push(...o)}let s=xt.calculateGroupStats(r,this.plugin),i=this.filterBar.activeSavedView||null;this.filterHeading.update(i,s.completed,s.total)}catch(t){console.error("Error updating filter heading in AgendaView:",t)}}async refresh(){let t=this.contentEl.querySelector(".agenda-view");t&&(this.setupViewOptions(),await this.renderAgendaContent(t),this.updateFilterHeading())}createDayHeader(t,r){var p,m;let s=document.createElement("div");s.className="agenda-view__day-header task-group-header",s.setAttribute("data-day",r);let i=s.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle day"}});try{(0,br.setIcon)(i,"chevron-right")}catch(g){}let a=i.querySelector("svg");a?(a.classList.add("chevron"),a.setAttr("width","16"),a.setAttr("height","16")):(i.textContent="\u25B8",i.addClass("chevron-text"));let o=s.createDiv({cls:"agenda-view__day-header-text"}),l=ro(t.date),c=x(l,"EEEE"),d=x(l,"MMMM d");bd(t.date)?(o.createSpan({cls:"agenda-view__day-name agenda-view__day-name--today",text:"Today"}),o.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${d}`})):(o.createSpan({cls:"agenda-view__day-name",text:c}),o.createSpan({cls:"agenda-view__day-date",text:` \u2022 ${d}`}));let u=t.tasks||[],h;if(u.length>0){let g=xt.calculateGroupStats(u,this.plugin);h=xt.formatGroupCount(g.completed,g.total).text}else h=`${(((p=t.notes)==null?void 0:p.length)||0)+(((m=t.ics)==null?void 0:m.length)||0)}`;s.createDiv({cls:"agenda-view__item-count",text:h});let f=this.isDayCollapsed(r);return i.setAttr("aria-expanded",String(!f)),s}addDayHeaderClickHandlers(t,r,s,i){let a=t.querySelector(".task-group-toggle");this.registerDomEvent(t,"click",o=>{if(o.target.closest("a"))return;let c=!r.hasClass("is-collapsed");this.setDayCollapsed(i,c),r.toggleClass("is-collapsed",c),s.style.display=c?"none":"",a&&a.setAttr("aria-expanded",String(!c))}),a&&this.registerDomEvent(a,"click",o=>{o.preventDefault(),o.stopPropagation();let l=!r.hasClass("is-collapsed");this.setDayCollapsed(i,l),r.toggleClass("is-collapsed",l),s.style.display=l?"none":"",a.setAttr("aria-expanded",String(!l))})}createDayItemElement(t){return t.type==="task"?this.createTaskItemElement(t.item,t.date):t.type==="note"?this.createNoteItemElement(t.item,t.date):this.createICSEventItemElement(t.item)}updateDayItemElement(t,r){if(r.type==="task"){let s=this.getCurrentVisibleProperties();en(t,r.item,this.plugin,s,{showDueDate:!this.groupByDate,showCheckbox:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:this.groupByDate,targetDate:r.date})}else r.type==="ics"&&Ey(t,r.item,this.plugin)}isDayCollapsed(t){try{return!!((this.plugin.viewStateManager.getViewPreferences(Qt)||{}).collapsedDays||{})[t]}catch(r){return!1}}setDayCollapsed(t,r){let i={...this.plugin.viewStateManager.getViewPreferences(Qt)||{}};i.collapsedDays||(i.collapsedDays={}),i.collapsedDays[t]=r,this.plugin.viewStateManager.setViewPreferences(Qt,i)}async waitForCacheReady(){if(!this.plugin.cacheManager.isInitialized())return new Promise(t=>{let r=this.plugin.cacheManager.subscribe("cache-initialized",()=>{r(),t()})})}};var La=require("obsidian");var Uc=require("obsidian");Fe();Lt();var Hc=class extends Uc.FuzzySuggestModal{constructor(e,t,r,s){super(e),this.plugin=t,this.tasks=r,this.onChooseTask=s,this.setPlaceholder("Type to search for a task..."),this.setInstructions([{command:"\u2191\u2193",purpose:"to navigate"},{command:"\u21B5",purpose:"to select"},{command:"esc",purpose:"to dismiss"}]),this.titleEl.setText("Select Task"),this.titleEl.setAttribute("id","task-selector-title"),this.containerEl.setAttribute("aria-labelledby","task-selector-title"),this.containerEl.setAttribute("role","dialog"),this.containerEl.setAttribute("aria-modal","true")}getItems(){return this.tasks.filter(e=>!e.archived).sort((e,t)=>{var l,c;let r=this.plugin.statusManager.isCompletedStatus(e.status),s=this.plugin.statusManager.isCompletedStatus(t.status);if(r!==s)return r?1:-1;if(e.due&&!t.due)return-1;if(!e.due&&t.due)return 1;if(e.due&&t.due){let d=e.due.localeCompare(t.due);if(d!==0)return d}let i={high:0,normal:1,low:2},a=(l=i[e.priority])!=null?l:1,o=(c=i[t.priority])!=null?c:1;return a!==o?a-o:e.title.localeCompare(t.title)})}getItemText(e){let t=e.title;e.due&&(t+=` ${e.due}`),e.priority!=="normal"&&(t+=` ${e.priority}`),e.contexts&&e.contexts.length>0&&(t+=` ${e.contexts.join(" ")}`);let r=qr(e.projects||[]);return r.length>0&&(t+=` ${r.join(" ")}`),t}renderSuggestion(e,t){let r=e.item,s=t.createDiv({cls:"task-selector-modal__suggestion"}),i=s.createDiv({cls:"task-selector-modal__title"}),a=r.priority!=="normal"?`task-selector-modal__task-title--${r.priority}-priority`:"";i.createSpan({cls:`task-selector-modal__task-title ${a}`,text:r.title});let o=s.createDiv({cls:"task-selector-modal__meta"});if(r.due){let c=_l(r.due),d=sa(r.due),u=r.due,h="task-selector-modal__due-date";c?(u=`Overdue (${r.due})`,h+=" task-selector-modal__due-date--overdue"):d&&(u="Due today",h+=" task-selector-modal__due-date--today"),o.createSpan({cls:h,text:u})}if(r.contexts&&r.contexts.length>0){let c=o.createSpan({cls:"task-selector-modal__contexts"});r.contexts.forEach((d,u)=>{u>0&&c.createSpan({text:", "}),c.createSpan({cls:"task-selector-modal__context-tag",text:`${d}`})})}let l=qr(r.projects||[]);if(l.length>0){let c=o.createSpan({cls:"task-selector-modal__projects"});l.forEach((d,u)=>{u>0&&c.createSpan({text:", "});let h=document.createTextNode("+");if(c.appendChild(h),p6(d)){let f=d.slice(2,-2);c.createEl("a",{cls:"task-selector-modal__project-link internal-link",text:f,attr:{"data-href":f}}).addEventListener("click",async m=>{m.preventDefault(),m.stopPropagation();let g=this.plugin.app.metadataCache.getFirstLinkpathDest(f,"");g instanceof Uc.TFile?(await this.plugin.app.workspace.getLeaf(!1).openFile(g),this.close()):new Uc.Notice(`Note "${f}" not found`)})}else c.createSpan({cls:"task-selector-modal__project-tag",text:d})})}if(r.status!=="open"){let c=this.plugin.statusManager.getStatusConfig(r.status);o.createSpan({cls:"task-selector-modal__status",text:c?c.label:r.status})}}onChooseItem(e,t){this.onChooseTask(e)}onClose(){super.onClose()}};function p6(n){return!!(n&&typeof n=="string"&&n.startsWith("[[")&&n.endsWith("]]"))}Sn();var Sy=class extends La.ItemView{constructor(t,r){super(t);this.timerDisplay=null;this.statusDisplay=null;this.progressCircle=null;this.progressContainer=null;this.startButton=null;this.pauseButton=null;this.stopButton=null;this.taskDisplay=null;this.statsDisplay=null;this.taskSelectButton=null;this.taskClearButton=null;this.currentSelectedTask=null;this.taskCardContainer=null;this.addTimeButton=null;this.subtractTimeButton=null;this.skipBreakButton=null;this.statElements={pomodoros:null};this.resizeObserver=null;this.resizeTimeout=null;this.functionListeners=[];this.currentCircleSize=300;this.currentCircumference=0;this.listeners=[];this.plugin=r,this.registerEvents()}getViewType(){return gd}getDisplayText(){return"Pomodoro"}getIcon(){return"clock"}registerEvents(){this.listeners.forEach(o=>this.plugin.emitter.offref(o)),this.listeners=[];let t=this.plugin.emitter.on(Hp,({session:o,task:l})=>{this.updateDisplay(o,l)});this.listeners.push(t);let r=this.plugin.emitter.on(Up,({session:o,nextType:l})=>{this.onPomodoroComplete(o,l)});this.listeners.push(r);let s=this.plugin.emitter.on(Wp,({session:o})=>{this.updateDisplay()});this.listeners.push(s);let i=this.plugin.emitter.on(fn,({timeRemaining:o,session:l})=>{this.updateTimer(o),this.updateDisplay(l)});this.listeners.push(i);let a=this.plugin.emitter.on(tt,async({path:o,originalTask:l,updatedTask:c})=>{if(!o||!c)return;if(this.currentSelectedTask&&(this.currentSelectedTask.path===o||l&&this.currentSelectedTask.path===l.path)){this.currentSelectedTask=c,this.updateTaskCardDisplay(c);let u=this.plugin.pomodoroService.getState();u.currentSession&&l&&l.path!==c.path&&u.currentSession.taskPath===l.path&&await this.plugin.pomodoroService.assignTaskToCurrentSession(c)}});this.listeners.push(a)}async onOpen(){await this.plugin.onReady(),await this.render(),this.ensureResizeHandlingSetup(),this.plugin.app.workspace.layoutReady?setTimeout(()=>this.ensureResizeHandlingSetup(),50):this.plugin.app.workspace.onLayoutReady(()=>{this.ensureResizeHandlingSetup()})}async onClose(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.functionListeners.forEach(t=>t()),this.timerDisplay=null,this.statusDisplay=null,this.progressCircle=null,this.progressContainer=null,this.startButton=null,this.pauseButton=null,this.stopButton=null,this.taskDisplay=null,this.statsDisplay=null,this.taskSelectButton=null,this.taskClearButton=null,this.currentSelectedTask=null,this.taskCardContainer=null,this.statElements={pomodoros:null},this.contentEl.empty()}async render(){let t=this.contentEl.createDiv({cls:"tasknotes-plugin pomodoro-view"});this.statusDisplay=t.createDiv({cls:"pomodoro-view__status",text:"Focus"});let r=t.createDiv({cls:"pomodoro-view__timer-section"});this.progressContainer=r.createDiv({cls:"pomodoro-view__progress-container"});let s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("class","pomodoro-view__progress-svg"),s.setAttribute("width","300"),s.setAttribute("height","300"),s.setAttribute("viewBox","0 0 300 300"),this.progressContainer.appendChild(s);let i=document.createElementNS("http://www.w3.org/2000/svg","circle");i.setAttributeNS(null,"cx","150"),i.setAttributeNS(null,"cy","150"),i.setAttributeNS(null,"r","140"),i.setAttributeNS(null,"fill","none"),i.setAttributeNS(null,"stroke","var(--tn-border-color)"),i.setAttributeNS(null,"stroke-width","2"),s.appendChild(i),this.progressCircle=document.createElementNS("http://www.w3.org/2000/svg","circle"),this.progressCircle.setAttributeNS(null,"cx","150"),this.progressCircle.setAttributeNS(null,"cy","150"),this.progressCircle.setAttributeNS(null,"r","140"),this.progressCircle.setAttributeNS(null,"fill","none"),this.progressCircle.setAttributeNS(null,"stroke","var(--tn-interactive-accent)"),this.progressCircle.setAttributeNS(null,"stroke-width","4"),this.progressCircle.setAttributeNS(null,"stroke-linecap","round");let o=2*Math.PI*140;this.progressCircle.setAttributeNS(null,"stroke-dasharray",o.toString()),this.progressCircle.setAttributeNS(null,"stroke-dashoffset",o.toString()),this.progressCircle.addClass("pomodoro-view__progress-circle"),s.appendChild(this.progressCircle);let l=this.progressContainer.createDiv({cls:"pomodoro-view__timer-overlay"}),d=`${this.plugin.settings.pomodoroWorkDuration.toString().padStart(2,"0")}:00`;this.timerDisplay=l.createDiv({cls:"pomodoro-view__timer-display",text:d});let u=l.createDiv({cls:"pomodoro-view__time-controls"});this.subtractTimeButton=u.createEl("button",{cls:"pomodoro-view__time-adjust-button pomodoro-view__subtract-time",text:"-"}),this.addTimeButton=u.createEl("button",{cls:"pomodoro-view__time-adjust-button pomodoro-view__add-time",text:"+"}),this.taskDisplay=t.createDiv({cls:"pomodoro-view__task-display"});let h=t.createDiv({cls:"pomodoro-view__task-selector"}),f=h.createDiv({cls:"pomodoro-view__task-buttons"});this.taskSelectButton=f.createEl("button",{cls:"pomodoro-view__task-select-button",text:"Choose task..."}),this.taskClearButton=f.createEl("button",{cls:"pomodoro-view__task-clear-button pomodoro-view__task-clear-button--hidden",text:"Clear task"}),this.taskCardContainer=h.createDiv({cls:"pomodoro-view__task-card-container"});let p=t.createDiv({cls:"pomodoro-view__control-section"}),m=p.createDiv({cls:"pomodoro-view__primary-controls"});this.startButton=m.createEl("button",{text:"Start",cls:"pomodoro-view__start-button"}),this.pauseButton=m.createEl("button",{text:"Pause",cls:"pomodoro-view__pause-button"}),this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton=m.createEl("button",{text:"Stop",cls:"pomodoro-view__stop-button"}),this.stopButton.addClass("pomodoro-view__stop-button--hidden"),this.skipBreakButton=p.createEl("button",{cls:"pomodoro-view__skip-break-button",text:"Skip break"}),this.skipBreakButton.addClass("pomodoro-view__skip-break-button--hidden");let g=t.createDiv({cls:"pomodoro-view__stats-section"});this.statsDisplay=g.createDiv({cls:"pomodoro-view__stats"});let y=this.statsDisplay.createDiv({cls:"pomodoro-view__stat pomodoro-view__stat--clickable"});if(this.statElements.pomodoros=y.createSpan({cls:"pomodoro-view__stat-value",text:"0"}),y.createSpan({cls:"pomodoro-view__stat-label",text:"completed today"}),this.registerDomEvent(y,"click",()=>{this.plugin.activatePomodoroStatsView()}),this.registerDomEvent(this.startButton,"click",async()=>{var T,w,b;if(!((T=this.startButton)!=null&&T.hasClass("is-loading"))){(w=this.startButton)==null||w.addClass("pomodoro-view__start-button--loading");try{let S=this.plugin.pomodoroService.getState();S.currentSession&&!S.isRunning?await this.plugin.pomodoroService.resumePomodoro():S.nextSessionType==="short-break"?await this.plugin.pomodoroService.startBreak(!1):S.nextSessionType==="long-break"?await this.plugin.pomodoroService.startBreak(!0):await this.plugin.pomodoroService.startPomodoro(this.currentSelectedTask||void 0)}finally{(b=this.startButton)==null||b.removeClass("pomodoro-view__start-button--loading")}}}),this.registerDomEvent(this.pauseButton,"click",()=>{this.plugin.pomodoroService.pausePomodoro()}),this.registerDomEvent(this.stopButton,"click",()=>{this.plugin.pomodoroService.stopPomodoro()}),this.registerDomEvent(this.skipBreakButton,"click",()=>{let T=this.plugin.pomodoroService.getState();T.currentSession?this.plugin.pomodoroService.stopPomodoro():(T.nextSessionType==="short-break"||T.nextSessionType==="long-break")&&this.plugin.pomodoroService.startPomodoro(this.currentSelectedTask||void 0)}),this.registerDomEvent(this.addTimeButton,"click",()=>{this.adjustSessionTime(60)}),this.registerDomEvent(this.subtractTimeButton,"click",()=>{this.adjustSessionTime(-60)}),this.registerDomEvent(this.taskSelectButton,"click",async()=>{await this.openTaskSelector()}),this.registerDomEvent(this.taskClearButton,"click",async()=>{await this.selectTask(null)}),this.restoreLastSelectedTask(),this.updateDisplay(),this.updateStats().catch(T=>{console.error("Failed to update initial stats:",T)}),this.plugin.pomodoroService){let T=this.plugin.pomodoroService.getState();this.updateTimer(T.timeRemaining)}}setupResizeHandling(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.resizeTimeout&&(window.clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.functionListeners.forEach(a=>a()),this.functionListeners=[];let t=this.contentEl.ownerDocument.defaultView||window,r=()=>{this.resizeTimeout&&t.clearTimeout(this.resizeTimeout),this.resizeTimeout=t.setTimeout(()=>{this.updateResponsiveLayout()},150)};if(t.ResizeObserver){this.resizeObserver=new t.ResizeObserver(r);let a=this.contentEl.querySelector(".pomodoro-view");a&&this.resizeObserver.observe(a)}let s=this.plugin.app.workspace.on("layout-change",r);this.listeners.push(s),t.addEventListener("resize",r),this.functionListeners.push(()=>t.removeEventListener("resize",r));let i=this.plugin.app.workspace.on("active-leaf-change",a=>{a===this.leaf&&t.setTimeout(()=>{this.updateResponsiveLayout()},100)});this.listeners.push(i),this.updateResponsiveLayout()}ensureResizeHandlingSetup(t=0){let s=Math.min(100*Math.pow(1.5,t),1e3);setTimeout(()=>{if(!this.resizeObserver){let i=this.contentEl.querySelector(".pomodoro-view");i?i.getBoundingClientRect().width>0?this.setupResizeHandling():t<10&&this.ensureResizeHandlingSetup(t+1):t<10&&this.ensureResizeHandlingSetup(t+1)}},s)}updateResponsiveLayout(){let t=this.contentEl.querySelector(".pomodoro-view");if(!t)return;let r=t.getBoundingClientRect(),s=r.width,i=r.height,a=Math.min(s/600,1),o=Math.min(i/800,1),l=Math.min(a*.7+o*.3,1);t.classList.remove("pomodoro-view--tiny","pomodoro-view--extra-narrow","pomodoro-view--very-narrow","pomodoro-view--narrow","pomodoro-view--small","pomodoro-view--medium-small","pomodoro-view--medium","pomodoro-view--wide"),s<=200?t.classList.add("pomodoro-view--tiny"):s<=250?t.classList.add("pomodoro-view--extra-narrow"):s<=300?t.classList.add("pomodoro-view--very-narrow"):s<=350?t.classList.add("pomodoro-view--narrow"):s<=400?t.classList.add("pomodoro-view--small"):s<=500?t.classList.add("pomodoro-view--medium-small"):s<=600?t.classList.add("pomodoro-view--medium"):t.classList.add("pomodoro-view--wide");let c=t.querySelector(".pomodoro-view__timer-display");if(c){let d,u;s<=200?(d=2,u="700"):s<=250?(d=2.2,u="650"):s<=300?(d=2.5,u="600"):s<=350?(d=3,u="600"):s<=400?(d=3.2,u="550"):s<=500?(d=3.6,u="500"):s<=600?(d=4,u="500"):(d=4.5,u="400");let f=`${Math.max(d*l,1.5).toFixed(1)}rem`;c.style.fontSize=f,c.style.fontWeight=u}this.updateProgressCircleSize(s,i)}updateProgressCircleSize(t,r){if(!this.progressContainer)return;let s=this.progressContainer.querySelector(".pomodoro-view__progress-svg");if(!s)return;let i=Math.min(t*.8,r*.4),a;if(t<=200?a=Math.max(120,Math.min(i,t-40)):t<=250?a=Math.max(150,Math.min(i,t-50)):t<=300?a=Math.max(180,Math.min(i,t-60)):t<=350?a=Math.max(200,Math.min(i,t-70)):t<=400?a=Math.max(230,Math.min(i,t-80)):t<=500?a=Math.max(250,Math.min(i,t-100)):t<=600?a=Math.max(280,Math.min(i,300)):a=Math.max(300,Math.min(i,t*.5,400)),a===this.currentCircleSize)return;this.currentCircleSize=a,s.setAttribute("width",a.toString()),s.setAttribute("height",a.toString()),s.setAttribute("viewBox",`0 0 ${a} ${a}`),this.progressContainer.style.width=`${a}px`,this.progressContainer.style.height=`${a}px`;let o=a/2,l=o-20;if(s.querySelectorAll("circle").forEach(d=>{d.setAttribute("cx",o.toString()),d.setAttribute("cy",o.toString()),d.setAttribute("r",l.toString())}),this.progressCircle){let d=2*Math.PI*l;if(this.currentCircumference=d,this.progressCircle.setAttribute("stroke-dasharray",d.toString()),this.progressCircle.setAttribute("stroke-dashoffset",d.toString()),this.plugin.pomodoroService){let u=this.plugin.pomodoroService.getState();this.updateProgress(u)}}}async openTaskSelector(){try{let r=(await this.plugin.cacheManager.getAllTasks()).filter(i=>!i.archived);if(r.length===0){new La.Notice("No unarchived tasks found. Create some tasks first.");return}new Hc(this.app,this.plugin,r,i=>{this.selectTask(i)}).open()}catch(t){console.error("Error opening task selector:",t),new La.Notice("Failed to load tasks")}}async selectTask(t){this.currentSelectedTask=t,this.taskSelectButton&&(t?(this.taskSelectButton.textContent="Change task...",(0,La.setTooltip)(this.taskSelectButton,"Select a different task",{placement:"top"}),this.taskSelectButton.removeClass("pomodoro-view__task-select-button--no-task")):(this.taskSelectButton.textContent="Choose task...",this.taskSelectButton.removeAttribute("title"),this.taskSelectButton.addClass("pomodoro-view__task-select-button--no-task"))),this.taskClearButton&&(t?this.taskClearButton.removeClass("pomodoro-view__task-clear-button--hidden"):this.taskClearButton.addClass("pomodoro-view__task-clear-button--hidden")),this.updateTaskCardDisplay(t),await this.plugin.pomodoroService.saveLastSelectedTask(t==null?void 0:t.path);let r=this.plugin.pomodoroService.getState();r.currentSession&&r.currentSession.type==="work"&&await this.plugin.pomodoroService.assignTaskToCurrentSession(t||void 0)}updateTaskCardDisplay(t){if(this.taskCardContainer)if(this.taskCardContainer.empty(),t){let r=cr(t,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!0,showRecurringControls:!1,groupByDate:!1});this.taskCardContainer.appendChild(r),this.taskCardContainer.removeClass("pomodoro-view__task-card-container--empty")}else this.taskCardContainer.addClass("pomodoro-view__task-card-container--empty")}async restoreLastSelectedTask(){try{if(!this.plugin.pomodoroService){console.log("PomodoroView: pomodoroService not available, skipping restore");return}let t=await this.plugin.pomodoroService.getLastSelectedTaskPath();if(t){let r=await this.plugin.cacheManager.getTaskByPath(t);r&&!this.plugin.statusManager.isCompletedStatus(r.status)&&!r.archived&&await this.selectTask(r)}}catch(t){console.error("Error restoring last selected task:",t)}}async updateTaskButtonFromPath(t){try{let r=await this.plugin.cacheManager.getTaskInfo(t);if(r){this.currentSelectedTask=r,this.taskSelectButton&&(this.taskSelectButton.textContent="Change task...",(0,La.setTooltip)(this.taskSelectButton,"Select a different task",{placement:"top"}),this.taskSelectButton.removeClass("pomodoro-no-task"),this.taskSelectButton.removeClass("pomodoro-view__task-select-button--no-task")),this.taskClearButton&&this.taskClearButton.removeClass("pomodoro-view__task-clear-button--hidden"),this.updateTaskCardDisplay(r);return}this.currentSelectedTask=null,this.taskSelectButton&&(this.taskSelectButton.textContent="Choose task...",this.taskSelectButton.removeAttribute("title"),this.taskSelectButton.addClass("pomodoro-view__task-select-button--no-task")),this.taskClearButton&&this.taskClearButton.addClass("pomodoro-view__task-clear-button--hidden"),this.updateTaskCardDisplay(null)}catch(r){console.error("Error updating task button from path:",r)}}updateDisplay(t,r){var i,a;if(!this.plugin.pomodoroService){this.statusDisplay&&(this.statusDisplay.textContent="Ready to start",this.statusDisplay.className="pomodoro-status pomodoro-view__status");return}let s=this.plugin.pomodoroService.getState();if(this.updateTimer(s.timeRemaining),this.updateProgress(s),this.statusDisplay)if(s.isRunning&&s.currentSession){let o=s.currentSession.type==="work"?"Working":s.currentSession.type==="short-break"?"Short break":"Long break";this.statusDisplay.textContent=o,this.statusDisplay.className=`pomodoro-status pomodoro-view__status pomodoro-status-${s.currentSession.type} pomodoro-view__status--${s.currentSession.type}`}else s.currentSession&&!s.isRunning?(this.statusDisplay.textContent="Paused",this.statusDisplay.className="pomodoro-status pomodoro-view__status pomodoro-status-paused pomodoro-view__status--paused"):(this.statusDisplay.textContent="Ready to start",this.statusDisplay.className="pomodoro-status pomodoro-view__status");if(this.taskDisplay){let o=(i=s.currentSession)==null?void 0:i.taskPath,l=this.taskDisplay.dataset.currentTaskPath;o!==l&&(this.taskDisplay.empty(),this.taskDisplay.dataset.currentTaskPath=o||"")}if(this.taskSelectButton&&(a=s.currentSession)!=null&&a.taskPath&&!this.currentSelectedTask&&this.updateTaskButtonFromPath(s.currentSession.taskPath),this.startButton&&this.pauseButton&&this.stopButton&&(s.isRunning?(this.startButton.addClass("pomodoro-view__start-button--hidden"),this.pauseButton.removeClass("pomodoro-view__pause-button--hidden"),this.stopButton.removeClass("pomodoro-view__stop-button--hidden")):s.currentSession?(this.startButton.removeClass("pomodoro-view__start-button--hidden"),this.startButton.textContent="Resume",this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton.removeClass("pomodoro-view__stop-button--hidden")):(this.startButton.removeClass("pomodoro-view__start-button--hidden"),s.nextSessionType==="short-break"?this.startButton.textContent="Start Short Break":s.nextSessionType==="long-break"?this.startButton.textContent="Start Long Break":this.startButton.textContent="Start",this.pauseButton.addClass("pomodoro-view__pause-button--hidden"),this.stopButton.addClass("pomodoro-view__stop-button--hidden"))),this.skipBreakButton){let o=s.currentSession&&(s.currentSession.type==="short-break"||s.currentSession.type==="long-break"),l=!s.currentSession&&(s.nextSessionType==="short-break"||s.nextSessionType==="long-break");o||l?(this.skipBreakButton.removeClass("pomodoro-view__skip-break-button--hidden"),this.skipBreakButton.textContent="Skip break"):this.skipBreakButton.addClass("pomodoro-view__skip-break-button--hidden")}this.addTimeButton&&this.subtractTimeButton&&(this.addTimeButton.removeClass("pomodoro-view__time-adjust-button--hidden"),this.subtractTimeButton.removeClass("pomodoro-view__time-adjust-button--hidden")),this.updateStats().catch(o=>{console.error("Failed to update stats:",o)})}updateTimer(t){if(this.timerDisplay){let r=Math.max(0,Math.floor(t)),s=Math.floor(r/60),i=r%60;this.timerDisplay.textContent=`${s.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`,r<=60&&r>0?this.timerDisplay.addClass("pomodoro-view__timer-display--warning"):this.timerDisplay.removeClass("pomodoro-view__timer-display--warning")}}updateProgress(t){if(!this.progressCircle)return;let r=this.currentCircumference;if(r===0){let c=this.progressCircle.getAttribute("r"),d=c?parseInt(c):140;r=2*Math.PI*d,this.currentCircumference=r}if(!t.currentSession){this.progressCircle.setAttributeNS(null,"stroke-dashoffset",r.toString()),this.progressCircle.removeClass("pomodoro-view__progress-circle--work"),this.progressCircle.removeClass("pomodoro-view__progress-circle--short-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--long-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--warning");return}let s=t.currentSession.activePeriods||[],i=0;for(let c of s)if(c.endTime){let d=new Date(c.startTime).getTime(),u=new Date(c.endTime).getTime();i+=Math.floor((u-d)/1e3)}else if(t.isRunning){let d=new Date(c.startTime).getTime(),u=Date.now();i+=Math.floor((u-d)/1e3)}let a=t.currentSession.plannedDuration*60,o=a>0?Math.max(0,Math.min(1,i/a)):0,l=r-o*r;this.progressCircle.setAttributeNS(null,"stroke-dashoffset",l.toString()),this.progressCircle.removeClass("pomodoro-view__progress-circle--work"),this.progressCircle.removeClass("pomodoro-view__progress-circle--short-break"),this.progressCircle.removeClass("pomodoro-view__progress-circle--long-break"),this.progressCircle.addClass(`pomodoro-view__progress-circle--${t.currentSession.type}`),t.timeRemaining<=60&&t.timeRemaining>0?this.progressCircle.addClass("pomodoro-view__progress-circle--warning"):this.progressCircle.removeClass("pomodoro-view__progress-circle--warning")}async updateStats(){try{if(!this.plugin.pomodoroService){this.statElements.pomodoros&&(this.statElements.pomodoros.textContent="0");return}let t=await this.plugin.pomodoroService.getTodayStats();this.statElements.pomodoros&&this.statElements.pomodoros.textContent!==t.pomodorosCompleted.toString()&&(this.statElements.pomodoros.textContent=t.pomodorosCompleted.toString())}catch(t){console.error("Failed to update stats:",t),this.statElements.pomodoros&&(this.statElements.pomodoros.textContent="0")}}adjustSessionTime(t){if(!this.plugin.pomodoroService)return;let r=this.plugin.pomodoroService.getState();if(r.currentSession)this.plugin.pomodoroService.adjustSessionTime(t);else{let s=Math.max(60,r.timeRemaining+t);this.plugin.pomodoroService.adjustPreparedTimer(s)}if(this.plugin.pomodoroService){let s=this.plugin.pomodoroService.getState();this.updateTimer(s.timeRemaining),this.updateProgress(s)}}onPomodoroComplete(t,r){if(this.updateDisplay(),this.statusDisplay)if(t.type==="work"){let s=r==="long-break";this.statusDisplay.textContent=`Great work! Time for a ${s?"long":"short"} break`}else this.statusDisplay.textContent="Break complete! Ready for the next pomodoro?"}};var Ui=require("obsidian");At();Fe();function Qf(n){if(n.activePeriods&&Array.isArray(n.activePeriods))return n.activePeriods.filter(e=>e.endTime).reduce((e,t)=>{let r=new Date(t.startTime),i=new Date(t.endTime).getTime()-r.getTime();return e+Math.round(i/(1e3*60))},0);if(n.duration!==void 0)return n.duration;if(n.startTime&&n.endTime){let e=new Date(n.startTime),r=new Date(n.endTime).getTime()-e.getTime();return Math.round(r/(1e3*60))}return 0}var yB=`
  let timerInterval;

  self.onmessage = function(e) {
    const { command, duration } = e.data;

    if (command === 'start') {
      if (timerInterval) {
        clearInterval(timerInterval);
      }

      let timeRemaining = duration;
      timerInterval = setInterval(() => {
        timeRemaining--;
        // Notificar al hilo principal cada segundo para actualizar la UI
        self.postMessage({ type: 'tick', timeRemaining: timeRemaining });

        if (timeRemaining <= 0) {
          self.postMessage({ type: 'done' });
          clearInterval(timerInterval);
          timerInterval = null;
        }
      }, 1000);

    } else if (command === 'stop') {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }
  };
`;var Dy=class extends Ui.ItemView{constructor(t,r){super(t);this.overviewStatsEl=null;this.todayStatsEl=null;this.weekStatsEl=null;this.recentSessionsEl=null;this.overallStatsEl=null;this.plugin=r}getViewType(){return yd}getDisplayText(){return"Pomodoro stats"}getIcon(){return"bar-chart"}calculateActualDuration(t){return t.filter(r=>r.endTime).reduce((r,s)=>{let i=new Date(s.startTime),o=(s.endTime?new Date(s.endTime):new Date).getTime()-i.getTime();return r+Math.round(o/(1e3*60))},0)}async onOpen(){await this.plugin.onReady(),await this.render()}async onClose(){this.contentEl.empty()}async render(){let t=this.contentEl.createDiv({cls:"tasknotes-plugin tasknotes-container pomodoro-stats-container pomodoro-stats-view"}),r=t.createDiv({cls:"pomodoro-stats-header pomodoro-stats-view__header"});new Ui.Setting(r).setName("Pomodoro statistics").setHeading();let s=r.createEl("button",{cls:"pomodoro-stats-refresh-button pomodoro-stats-view__refresh-button",text:"Refresh"});this.registerDomEvent(s,"click",()=>{this.refreshStats()});let i=t.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new Ui.Setting(i).setName("Overview").setHeading(),this.overviewStatsEl=i.createDiv({cls:"pomodoro-overview-grid pomodoro-stats-view__overview-grid"});let a=t.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new Ui.Setting(a).setName("Today").setHeading(),this.todayStatsEl=a.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let o=t.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new Ui.Setting(o).setName("This week").setHeading(),this.weekStatsEl=o.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let l=t.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new Ui.Setting(l).setName("All time").setHeading(),this.overallStatsEl=l.createDiv({cls:"pomodoro-stats-grid pomodoro-stats-view__stats-grid"});let c=t.createDiv({cls:"pomodoro-stats-section pomodoro-stats-view__section"});new Ui.Setting(c).setName("Recent sessions").setHeading(),this.recentSessionsEl=c.createDiv({cls:"pomodoro-recent-sessions pomodoro-stats-view__recent-sessions"}),await this.refreshStats()}async refreshStats(){try{await Promise.all([this.updateOverviewStats(),this.updateTodayStats(),this.updateWeekStats(),this.updateOverallStats(),this.updateRecentSessions()])}catch(t){console.error("Failed to refresh stats:",t)}}async updateOverviewStats(){if(!this.overviewStatsEl)return;let t=await this.plugin.pomodoroService.getTodayStats(),r=await this.calculateOverallStatsFromHistory(),s=Ge(),i=new Date(s);i.setDate(i.getDate()-1);let a=wt(i),o=await this.calculateStatsForRange(a,a);this.renderOverviewStats(this.overviewStatsEl,t,r,o)}async updateTodayStats(){if(!this.todayStatsEl)return;let t=await this.plugin.pomodoroService.getTodayStats();this.renderStatsGrid(this.todayStatsEl,t)}async updateWeekStats(){if(!this.weekStatsEl)return;let t=Ge(),r=wt(t),i={weekStartsOn:this.plugin.settings.calendarViewSettings.firstDay||0},a=kr(r,i),o=qa(r,i),l=await this.calculateStatsForRange(a,o);this.renderStatsGrid(this.weekStatsEl,l)}async updateOverallStats(){if(!this.overallStatsEl)return;let t=await this.plugin.pomodoroService.getSessionHistory(),r=this.calculateOverallStats(t);this.renderStatsGrid(this.overallStatsEl,r)}async calculateOverallStatsFromHistory(){let t=await this.plugin.pomodoroService.getSessionHistory();return this.calculateOverallStats(t)}async updateRecentSessions(){var s;if(!this.recentSessionsEl)return;let r=(await this.plugin.pomodoroService.getSessionHistory()).filter(i=>i.type==="work").slice(-10).reverse();if(this.recentSessionsEl.empty(),r.length===0){this.recentSessionsEl.createDiv({cls:"pomodoro-no-sessions pomodoro-stats-view__no-sessions",text:"No sessions recorded yet"});return}for(let i of r){let a=this.recentSessionsEl.createDiv({cls:"pomodoro-session-item pomodoro-stats-view__session-item"}),o=a.createSpan({cls:"session-date pomodoro-stats-view__session-date"});o.textContent=x(new Date(i.startTime),"MMM d, HH:mm");let l=a.createSpan({cls:"session-duration pomodoro-stats-view__session-duration"}),c=Qf(i);l.textContent=`${c}min`;let d=a.createSpan({cls:"session-status pomodoro-stats-view__session-status"});if(d.textContent=i.completed?"Completed":"Interrupted",d.addClass(i.completed?"status-completed":"status-interrupted"),d.addClass(i.completed?"pomodoro-stats-view__session-status--completed":"pomodoro-stats-view__session-status--interrupted"),i.taskPath){let u=a.createSpan({cls:"session-task pomodoro-stats-view__session-task"}),h=((s=i.taskPath.split("/").pop())==null?void 0:s.replace(".md",""))||"";u.textContent=h}}}renderOverviewStats(t,r,s,i){t.empty();let a=y=>{if(y<60)return`${y}m`;let T=Math.floor(y/60),w=y%60;return w>0?`${T}h${w}m`:`${T}h`},o=r.pomodorosCompleted-i.pomodorosCompleted,l=r.totalMinutes-i.totalMinutes,c=t.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),d=c.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});if(d.textContent=r.pomodorosCompleted.toString(),c.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Today's Pomos"}),o!==0){let y=c.createDiv({cls:"overview-change pomodoro-stats-view__overview-change"});y.textContent=`${o>0?"+":""}${o} from yesterday`,y.addClass(o>0?"positive":"negative")}let u=t.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),h=u.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});h.textContent=s.pomodorosCompleted.toString(),u.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Total Pomos"});let f=t.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),p=f.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});if(p.textContent=a(r.totalMinutes),f.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Today's Focus"}),l!==0){let y=f.createDiv({cls:"overview-change pomodoro-stats-view__overview-change"});y.textContent=`${a(Math.abs(l))} ${l>0?"more":"less"} than yesterday`,y.addClass(l>0?"positive":"negative")}let m=t.createDiv({cls:"pomodoro-overview-card pomodoro-stats-view__overview-card"}),g=m.createDiv({cls:"overview-value pomodoro-stats-view__overview-value"});g.textContent=a(s.totalMinutes),m.createDiv({cls:"overview-label pomodoro-stats-view__overview-label",text:"Total Focus Duration"})}renderStatsGrid(t,r){t.empty();let s=t.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});s.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.pomodorosCompleted.toString()}),s.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Pomodoros"});let i=t.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});i.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.currentStreak.toString()}),i.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Streak"});let a=t.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});a.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.totalMinutes.toString()}),a.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Minutes"});let o=t.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});o.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:r.averageSessionLength.toString()}),o.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Avg Length"});let l=t.createDiv({cls:"pomodoro-stat-card pomodoro-stats-view__stat-card"});l.createDiv({cls:"stat-value pomodoro-stats-view__stat-value",text:`${r.completionRate}%`}),l.createDiv({cls:"stat-label pomodoro-stats-view__stat-label",text:"Completion"})}async calculateStatsForRange(t,r){let s=await this.plugin.pomodoroService.getSessionHistory(),i=hr(t),a=hr(r),o=s.filter(l=>{try{let c=aT(l.startTime),d=hr(c);return d>=i&&d<=a}catch(c){return console.error("Error parsing session timestamp for filtering:",{sessionStartTime:l.startTime,error:c}),!1}});return this.calculateStatsFromSessions(o)}calculateOverallStats(t){return this.calculateStatsFromSessions(t)}calculateStatsFromSessions(t){let r=t.filter(c=>c.type==="work"),s=r.filter(c=>c.completed),i=0;for(let c=r.length-1;c>=0&&r[c].completed;c--)i++;let a=s.reduce((c,d)=>c+Qf(d),0),o=s.length>0?a/s.length:0,l=r.length>0?s.length/r.length*100:0;return{pomodorosCompleted:s.length,currentStreak:i,totalMinutes:a,averageSessionLength:Math.round(o),completionRate:Math.round(l)}}};var ni=require("obsidian");At();Lt();Fe();Sn();var Cy=class extends ni.ItemView{constructor(t,r){super(t);this.overviewStatsEl=null;this.todayStatsEl=null;this.weekStatsEl=null;this.monthStatsEl=null;this.projectsStatsEl=null;this.filtersEl=null;this.currentFilters={dateRange:"all",selectedProjects:[],minTimeSpent:0};this.drilldownModal=null;this.currentDrilldownData=null;this.listeners=[];this.statsCache=new Map;this.lastCacheTime=0;this.CACHE_DURATION=6e4;this.debounceTimeout=null;this.plugin=r}getViewType(){return vd}getDisplayText(){return"Statistics"}getIcon(){return"bar-chart-4"}async onOpen(){await this.plugin.onReady();let t=this.plugin.emitter.on(tt,async({path:r,originalTask:s,updatedTask:i})=>{if(!r||!i||!this.drilldownModal||!this.currentDrilldownData)return;this.currentDrilldownData.tasks.some(o=>o.path===r||s&&o.path===s.path)&&await this.refreshDrilldownModal()});this.listeners.push(t),await this.render()}async onClose(){this.contentEl.empty(),this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.listeners=[]}async render(){let t=this.contentEl.createDiv({cls:"tasknotes-plugin tasknotes-container stats-container stats-view"}),r=t.createDiv({cls:"stats-header stats-view__header"});new ni.Setting(r).setName("Task & Project Statistics").setHeading();let s=r.createEl("button",{cls:"stats-refresh-button stats-view__refresh-button",text:"Refresh"});this.registerDomEvent(s,"click",()=>{this.refreshStats()});let i=t.createDiv({cls:"stats-section stats-view__section"});new ni.Setting(i).setName("Filters").setHeading(),this.filtersEl=i.createDiv({cls:"stats-filters stats-view__filters"}),this.renderFilters();let a=t.createDiv({cls:"stats-section stats-view__section"});new ni.Setting(a).setName("Overview").setHeading(),this.overviewStatsEl=a.createDiv({cls:"stats-overview-grid stats-view__overview-grid"});let o=t.createDiv({cls:"stats-section stats-view__section"});new ni.Setting(o).setName("Today").setHeading(),this.todayStatsEl=o.createDiv({cls:"stats-grid stats-view__stats-grid"});let l=t.createDiv({cls:"stats-section stats-view__section"});new ni.Setting(l).setName("This Week").setHeading(),this.weekStatsEl=l.createDiv({cls:"stats-grid stats-view__stats-grid"});let c=t.createDiv({cls:"stats-section stats-view__section"});new ni.Setting(c).setName("This Month").setHeading(),this.monthStatsEl=c.createDiv({cls:"stats-grid stats-view__stats-grid"});let d=t.createDiv({cls:"stats-section stats-view__section"});new ni.Setting(d).setName("Project Breakdown").setHeading(),this.projectsStatsEl=d.createDiv({cls:"stats-projects stats-view__projects"}),await this.refreshStats()}async refreshStats(){try{this.clearCache();let t=await Promise.allSettled([this.updateOverviewStats(),this.updateTodayStats(),this.updateWeekStats(),this.updateMonthStats(),this.updateProjectStats()])}catch(t){}}async getAllTasks(){let t=`all-tasks-${JSON.stringify(this.currentFilters)}`;if(this.isCacheValid()&&this.statsCache.has(t)){let i=this.statsCache.get(t);if(i)return i}let r=await this.plugin.cacheManager.getAllTaskPaths(),s=[];for(let i of r)try{let a=await this.plugin.cacheManager.getTaskInfo(i);a&&s.push(a)}catch(a){}return s=this.applyTaskFilters(s),this.statsCache.set(t,s),this.lastCacheTime=Date.now(),s}applyTaskFilters(t){let r=t,s=this.getFilterDateRange();return(s.start||s.end)&&(r=r.filter(i=>{if(i.timeEntries&&i.timeEntries.length>0)return i.timeEntries.some(a=>{if(!a.startTime)return!1;let o=new Date(a.startTime);return!(s.start&&o<s.start||s.end&&o>s.end)});if(i.completedDate){let a=new Date(i.completedDate);return!(s.start&&a<s.start||s.end&&a>s.end)}if(i.dateCreated){let a=new Date(i.dateCreated);return!(s.start&&a<s.start||s.end&&a>s.end)}return!(s.start||s.end)})),this.currentFilters.minTimeSpent>0&&(r=r.filter(i=>mn(i.timeEntries||[])>=this.currentFilters.minTimeSpent)),r}async updateOverviewStats(){if(!this.overviewStatsEl)return;let t=await this.getAllTasks(),r=this.calculateOverallStats(t);this.renderOverviewStats(this.overviewStatsEl,r)}async updateTodayStats(){if(!this.todayStatsEl)return;let t=Ge(),r=wt(t),s=hr(r),i=await this.calculateStatsForRange(s,r);this.renderTimeRangeStats(this.todayStatsEl,i)}async updateWeekStats(){if(!this.weekStatsEl)return;let t=Ge(),r=wt(t),i={weekStartsOn:this.plugin.settings.calendarViewSettings.firstDay||0},a=kr(r,i),o=qa(r,i),l=await this.calculateStatsForRange(a,o);this.renderTimeRangeStats(this.weekStatsEl,l)}async updateMonthStats(){if(!this.monthStatsEl)return;let t=Ge(),r=wt(t),s=xv(r),i=Cv(r),a=await this.calculateStatsForRange(s,i);this.renderTimeRangeStats(this.monthStatsEl,a)}async updateProjectStats(){if(!this.projectsStatsEl)return;let t=await this.getAllTasks(),r=this.calculateProjectStats(t);await this.renderProjectStats(this.projectsStatsEl,r)}consolidateProjectName(t){var r;if(!t||typeof t!="string")return t;if(t.startsWith("[[")&&t.endsWith("]]")){let s=this.extractWikilinkPath(t);if(s&&((r=this.plugin)!=null&&r.app)){let i=this.plugin.app.metadataCache.getFirstLinkpathDest(s,"");if(i)return i.basename;let a=this.extractProjectName(t);if(a)return a}}if(t.includes("|")){let s=t.split("|");return s[s.length-1]||t}if(t.includes("/")){let s=t.split("/");return s[s.length-1]||t}return t}extractWikilinkPath(t){if(!t||typeof t!="string"||!t.startsWith("[[")||!t.endsWith("]]"))return null;let r=t.slice(2,-2),s=r.indexOf("|");return s!==-1?r.substring(0,s).trim():r}extractProjectName(t){if(!t)return null;if(t.startsWith("[[")&&t.endsWith("]]")){let r=this.extractWikilinkPath(t);if(!r)return null;let s=r.split("/");return s[s.length-1]||r}if(t.includes("|")){let r=t.split("|");return r[r.length-1]||t}if(t.includes("/")){let r=t.split("/");return r[r.length-1]||t}return t}calculateOverallStats(t){let r=0,s=0,i=new Set;for(let a of t){r+=mn(a.timeEntries||[]),this.plugin.statusManager.isCompletedStatus(a.status)&&s++;let o=this.getTaskProjects(a);for(let l of o)i.add(l)}return{totalTimeSpent:r,totalTasks:t.length,completedTasks:s,activeProjects:i.size,completionRate:t.length>0?s/t.length*100:0,avgTimePerTask:t.length>0?r/t.length:0}}async calculateStatsForRange(t,r){let i=(await this.getAllTasks()).filter(l=>{if(l.timeEntries&&l.timeEntries.length>0)return l.timeEntries.some(c=>{if(!c.startTime)return!1;let d=new Date(c.startTime);return d>=t&&d<=r});if(l.completedDate){let c=new Date(l.completedDate);return c>=t&&c<=r}if(l.dateCreated){let c=new Date(l.dateCreated);return c>=t&&c<=r}return!1}),a=this.calculateOverallStats(i),o=this.calculateProjectStats(i);return{overall:a,projects:o}}calculateProjectStats(t){let r=new Map;for(let i of t){let a=mn(i.timeEntries||[]),o=this.plugin.statusManager.isCompletedStatus(i.status),l;i.timeEntries&&i.timeEntries.length>0?l=[...i.timeEntries].sort((u,h)=>new Date(h.startTime).getTime()-new Date(u.startTime).getTime())[0].startTime:i.completedDate?l=i.completedDate:i.dateModified&&(l=i.dateModified);let c=this.getTaskProjects(i);for(let d of c){r.has(d)||r.set(d,{tasks:[],totalTime:0,completedCount:0,lastActivity:void 0});let u=r.get(d);u&&(u.tasks.push(i),u.totalTime+=a,o&&u.completedCount++,l&&(!u.lastActivity||new Date(l)>new Date(u.lastActivity))&&(u.lastActivity=l))}}let s=[];for(let[i,a]of r.entries())s.push({projectName:i,totalTimeSpent:a.totalTime,taskCount:a.tasks.length,completedTaskCount:a.completedCount,avgTimePerTask:a.tasks.length>0?a.totalTime/a.tasks.length:0,lastActivity:a.lastActivity});return s.sort((i,a)=>i.projectName==="No Project"?1:a.projectName==="No Project"?-1:a.totalTimeSpent-i.totalTimeSpent),s}renderFilters(){if(!this.filtersEl)return;this.filtersEl.empty();let t=this.filtersEl.createDiv({cls:"stats-view__filter-grid"}),r=t.createDiv({cls:"stats-view__filter-item"}),s=r.createDiv({cls:"stats-view__filter-label"});s.textContent="Date Range";let i=r.createEl("select",{cls:"stats-view__filter-select"}),a=[{value:"all",text:"All Time"},{value:"7days",text:"Last 7 Days"},{value:"30days",text:"Last 30 Days"},{value:"90days",text:"Last 90 Days"},{value:"custom",text:"Custom Range"}];for(let f of a){let p=i.createEl("option",{value:f.value,text:f.text});f.value===this.currentFilters.dateRange&&(p.selected=!0)}this.registerDomEvent(i,"change",()=>{this.currentFilters.dateRange=i.value,this.renderCustomDateInputs(),this.applyFilters()});let o=t.createDiv({cls:"stats-view__custom-dates"});this.currentFilters.dateRange==="custom"&&this.renderCustomDateInputs(o);let l=t.createDiv({cls:"stats-view__filter-item"}),c=l.createDiv({cls:"stats-view__filter-label"});c.textContent="Min Time (minutes)";let d=l.createEl("input",{cls:"stats-view__filter-input",type:"number",value:this.currentFilters.minTimeSpent.toString(),placeholder:"0"});this.registerDomEvent(d,"input",()=>{this.currentFilters.minTimeSpent=parseInt(d.value)||0,this.applyFilters()});let h=t.createDiv({cls:"stats-view__filter-buttons"}).createEl("button",{cls:"stats-view__filter-button stats-view__filter-button--reset",text:"Reset Filters"});this.registerDomEvent(h,"click",()=>{this.currentFilters={dateRange:"all",selectedProjects:[],minTimeSpent:0},this.renderFilters(),this.applyFilters()})}renderCustomDateInputs(t){var s;let r=t||((s=this.filtersEl)==null?void 0:s.querySelector(".stats-view__custom-dates"));if(r&&(r.empty(),this.currentFilters.dateRange==="custom")){let i=r.createDiv({cls:"stats-view__date-input-container"});i.createDiv({cls:"stats-view__date-label",text:"From"});let a=i.createEl("input",{cls:"stats-view__date-input",type:"date",value:this.currentFilters.customStartDate||""}),o=r.createDiv({cls:"stats-view__date-input-container"});o.createDiv({cls:"stats-view__date-label",text:"To"});let l=o.createEl("input",{cls:"stats-view__date-input",type:"date",value:this.currentFilters.customEndDate||""});this.registerDomEvent(a,"change",()=>{this.currentFilters.customStartDate=a.value,this.applyFilters()}),this.registerDomEvent(l,"change",()=>{this.currentFilters.customEndDate=l.value,this.applyFilters()})}}async applyFilters(){this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(async()=>{await this.refreshStats(),this.debounceTimeout=null},300)}isCacheValid(){return Date.now()-this.lastCacheTime<this.CACHE_DURATION}clearCache(){this.statsCache.clear(),this.lastCacheTime=0}getTaskProjects(t){try{if(!t||!Array.isArray(t.projects))return["No Project"];let r=qr(t.projects);return r.length>0?r.map(s=>this.consolidateProjectName(s)).filter(s=>typeof s=="string"&&s.length>0):["No Project"]}catch(r){return["No Project"]}}getFilterDateRange(){let t=Ge(),r=wt(t);switch(this.currentFilters.dateRange){case"7days":return{start:vl(r,7),end:r};case"30days":return{start:vl(r,30),end:r};case"90days":return{start:vl(r,90),end:r};case"custom":return{start:this.currentFilters.customStartDate?new Date(this.currentFilters.customStartDate):void 0,end:this.currentFilters.customEndDate?new Date(this.currentFilters.customEndDate):void 0};case"all":default:return{}}}renderOverviewStats(t,r){t.empty();let s=m=>{if(m<60)return`${Math.round(m)}m`;let g=Math.floor(m/60),y=Math.round(m%60);return y>0?`${g}h ${y}m`:`${g}h`},i=t.createDiv({cls:"stats-overview-card stats-view__overview-card"}),a=i.createDiv({cls:"overview-value stats-view__overview-value"});a.textContent=s(r.totalTimeSpent),i.createDiv({cls:"overview-label stats-view__overview-label",text:"Total Time Tracked"});let o=t.createDiv({cls:"stats-overview-card stats-view__overview-card"}),l=o.createDiv({cls:"overview-value stats-view__overview-value"});l.textContent=r.totalTasks.toString(),o.createDiv({cls:"overview-label stats-view__overview-label",text:"Total Tasks"});let c=t.createDiv({cls:"stats-overview-card stats-view__overview-card"}),d=c.createDiv({cls:"overview-value stats-view__overview-value"});d.textContent=`${Math.round(r.completionRate)}%`,c.createDiv({cls:"overview-label stats-view__overview-label",text:"Completion Rate"});let u=t.createDiv({cls:"stats-overview-card stats-view__overview-card"}),h=u.createDiv({cls:"overview-value stats-view__overview-value"});h.textContent=r.activeProjects.toString(),u.createDiv({cls:"overview-label stats-view__overview-label",text:"Active Projects"});let f=t.createDiv({cls:"stats-overview-card stats-view__overview-card"}),p=f.createDiv({cls:"overview-value stats-view__overview-value"});p.textContent=s(r.avgTimePerTask),f.createDiv({cls:"overview-label stats-view__overview-label",text:"Avg Time per Task"})}renderTimeRangeStats(t,r){t.empty();let s=c=>{if(c<60)return`${Math.round(c)}m`;let d=Math.floor(c/60),u=Math.round(c%60);return u>0?`${d}h ${u}m`:`${d}h`},i=t.createDiv({cls:"stats-stat-card stats-view__stat-card"});i.createDiv({cls:"stat-value stats-view__stat-value",text:s(r.overall.totalTimeSpent)}),i.createDiv({cls:"stat-label stats-view__stat-label",text:"Time Tracked"});let a=t.createDiv({cls:"stats-stat-card stats-view__stat-card"});a.createDiv({cls:"stat-value stats-view__stat-value",text:r.overall.totalTasks.toString()}),a.createDiv({cls:"stat-label stats-view__stat-label",text:"Tasks"});let o=t.createDiv({cls:"stats-stat-card stats-view__stat-card"});o.createDiv({cls:"stat-value stats-view__stat-value",text:r.overall.completedTasks.toString()}),o.createDiv({cls:"stat-label stats-view__stat-label",text:"Completed"});let l=t.createDiv({cls:"stats-stat-card stats-view__stat-card"});l.createDiv({cls:"stat-value stats-view__stat-value",text:r.overall.activeProjects.toString()}),l.createDiv({cls:"stat-label stats-view__stat-label",text:"Projects"})}async renderProjectStats(t,r){if(t.empty(),r.length===0){t.createDiv({cls:"stats-no-data stats-view__no-data",text:"No project data available"});return}let s=o=>{if(o<60)return`${Math.round(o)}m`;let l=Math.floor(o/60),c=Math.round(o%60);return c>0?`${l}h ${c}m`:`${l}h`},i=o=>{if(!o)return"N/A";try{let l=new Date(o);return x(l,"MMM d, yyyy")}catch(l){return"N/A"}},a=Math.max(...r.map(o=>o.totalTimeSpent));for(let o of r){let l=["stats-project-item","stats-view__project-item","stats-view__project-item--clickable"];o.projectName==="No Project"&&l.push("stats-view__project-item--no-project");let c=t.createDiv({cls:l.join(" ")});this.registerDomEvent(c,"click",()=>{this.openProjectDrilldown(o.projectName)});let d=c.createDiv({cls:"stats-view__project-header"}),u=d.createDiv({cls:"project-name stats-view__project-name"});u.textContent=o.projectName,d.createDiv({cls:"stats-view__click-indicator",text:"\u2192"});let h=o.taskCount>0?o.completedTaskCount/o.taskCount*100:0,f=c.createDiv({cls:"stats-view__project-content-grid"}),p=f.createDiv({cls:"stats-view__progress-container"});this.renderProgressCircle(p,h,o.completedTaskCount,o.taskCount);let m=f.createDiv({cls:"stats-view__stats-container"});if(o.totalTimeSpent>0){let w=m.createDiv({cls:"stats-view__time-bar"}),S=w.createDiv({cls:"stats-view__time-bar-visual"}).createDiv({cls:"stats-view__time-bar-fill"}),k=a>0?o.totalTimeSpent/a*100:0;S.style.width=`${k}%`;let D=w.createDiv({cls:"stats-view__time-bar-label"});D.textContent=s(o.totalTimeSpent)}let g=m.createDiv({cls:"project-stats stats-view__project-stats"});if(o.lastActivity){let w=g.createDiv({cls:"project-stat stats-view__project-stat"});w.textContent=`Last activity: ${i(o.lastActivity)}`}if(o.avgTimePerTask>0){let w=g.createDiv({cls:"project-stat stats-view__project-stat"});w.textContent=`Avg: ${s(o.avgTimePerTask)}/task`}let y=m.createDiv({cls:"stats-view__trend-container"}),T=y.createDiv({cls:"stats-view__sparkline"});try{let w=await this.calculateProjectTrend(o.projectName);w.length>0&&w.some(b=>b.value>0)?this.renderSparkline(T,w):y.remove()}catch(w){y.remove()}}}renderProgressCircle(t,r,s,i){let c=2*Math.PI*27.5,d=c-r/100*c,u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("width","60"),u.setAttribute("height","60"),u.setAttribute("viewBox","0 0 60 60"),u.classList.add("stats-view__progress-circle-svg");let h=document.createElementNS("http://www.w3.org/2000/svg","circle");h.setAttribute("cx",(60/2).toString()),h.setAttribute("cy",(60/2).toString()),h.setAttribute("r",27.5.toString()),h.classList.add("stats-view__progress-circle-bg");let f=document.createElementNS("http://www.w3.org/2000/svg","circle");f.setAttribute("cx",(60/2).toString()),f.setAttribute("cy",(60/2).toString()),f.setAttribute("r",27.5.toString()),f.setAttribute("stroke-dasharray",`${c} ${c}`),f.setAttribute("stroke-dashoffset",d.toString()),f.classList.add("stats-view__progress-circle-fg");let p=document.createElementNS("http://www.w3.org/2000/svg","text");p.setAttribute("x","50%"),p.setAttribute("y","50%"),p.setAttribute("dy","0.3em"),p.setAttribute("text-anchor","middle"),p.classList.add("stats-view__progress-circle-text"),p.textContent=`${Math.round(r)}%`,u.appendChild(h),u.appendChild(f),u.appendChild(p),t.appendChild(u);let m=t.createDiv({cls:"stats-view__progress-label"});m.textContent=`${s}/${i} tasks`}async calculateProjectTrend(t){try{let r=await this.plugin.cacheManager.getAllTaskPaths(),s=[];for(let l of r)try{let c=await this.plugin.cacheManager.getTaskInfo(l);c&&this.getTaskProjects(c).includes(t)&&s.push(c)}catch(c){}let i=[],a=Ge(),o=wt(a);for(let l=29;l>=0;l--){let c=vl(o,l),d=x(c,"yyyy-MM-dd"),u=0;for(let h of s)if(h.timeEntries)for(let f of h.timeEntries)f.startTime&&x(new Date(f.startTime),"yyyy-MM-dd")===d&&(u+=mn([f]));i.push({date:d,value:u})}return i}catch(r){return[]}}renderSparkline(t,r){if(t.empty(),r.length===0)return;let s=100,i=20,a=Math.max(...r.map(d=>d.value));if(a===0)return;let o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width",s.toString()),o.setAttribute("height",i.toString()),o.setAttribute("viewBox",`0 0 ${s} ${i}`),o.classList.add("stats-view__sparkline-svg");let l=document.createElementNS("http://www.w3.org/2000/svg","path"),c="";r.forEach((d,u)=>{let h=u/(r.length-1)*s,f=i-d.value/a*i;u===0?c+=`M ${h} ${f}`:c+=` L ${h} ${f}`}),l.setAttribute("d",c),l.setAttribute("fill","none"),l.setAttribute("stroke","currentColor"),l.setAttribute("stroke-width","1.5"),l.setAttribute("opacity","0.7"),o.appendChild(l),t.appendChild(o)}async openProjectDrilldown(t){this.closeDrilldownModal();let r=document.body.createDiv({cls:"stats-view__modal-backdrop"});this.drilldownModal=r;let s=r.createDiv({cls:"stats-view__modal tasknotes-plugin"}),i=s.createDiv({cls:"stats-view__modal-header"}),a=i.createDiv({cls:"stats-view__modal-title"});a.textContent=`${t} - Detailed View`;let o=i.createEl("button",{cls:"stats-view__modal-close",text:"\xD7"}),l=s.createDiv({cls:"stats-view__modal-content"});l.textContent="Loading...",this.registerDomEvent(o,"click",()=>this.closeDrilldownModal()),this.registerDomEvent(r,"click",d=>{d.target===r&&this.closeDrilldownModal()});let c=d=>{d.key==="Escape"&&(this.closeDrilldownModal(),document.removeEventListener("keydown",c))};document.addEventListener("keydown",c);try{let d=await this.getProjectDrilldownData(t);this.currentDrilldownData=d,this.renderDrilldownContent(l,d)}catch(d){console.error("Error loading drill-down data:",d),l.textContent="Error loading project details."}}closeDrilldownModal(){this.drilldownModal&&(this.drilldownModal.remove(),this.drilldownModal=null,this.currentDrilldownData=null)}async refreshDrilldownModal(){if(!this.drilldownModal||!this.currentDrilldownData)return;let t=this.drilldownModal.querySelector(".stats-view__modal-content");if(t)try{let r=await this.getProjectDrilldownData(this.currentDrilldownData.projectName);this.currentDrilldownData=r,this.renderDrilldownContent(t,r)}catch(r){console.error("Error refreshing drill-down modal:",r)}}async getProjectDrilldownData(t){var h;let r=await this.plugin.cacheManager.getAllTaskPaths(),s=[];for(let f of r)try{let p=await this.plugin.cacheManager.getTaskInfo(f);p&&this.getTaskProjects(p).includes(t)&&s.push(p)}catch(p){console.error(`Failed to get task for drill-down: ${f}`,p)}let i=s.reduce((f,p)=>f+mn(p.timeEntries||[]),0),a=s.filter(f=>this.plugin.statusManager.isCompletedStatus(f.status)).length,o=s.length>0?a/s.length*100:0,l=s.filter(f=>{var p;return((p=f.timeEntries)==null?void 0:p.length)||f.completedDate}).sort((f,p)=>{var y,T;let m=(y=f.timeEntries)!=null&&y.length?Math.max(...f.timeEntries.map(w=>new Date(w.startTime).getTime())):f.completedDate?new Date(f.completedDate).getTime():0;return((T=p.timeEntries)!=null&&T.length?Math.max(...p.timeEntries.map(w=>new Date(w.startTime).getTime())):p.completedDate?new Date(p.completedDate).getTime():0)-m}).slice(0,10),c=[],d=Ge(),u=wt(d);for(let f=29;f>=0;f--){let p=vl(u,f),m=x(p,"yyyy-MM-dd"),g=0,y=0,T=0;for(let w of s){if(w.timeEntries){let b=w.timeEntries.filter(S=>x(new Date(S.startTime),"yyyy-MM-dd")===m);b.length>0&&(g+=mn(b),y++)}w.completedDate&&x(new Date(w.completedDate),"yyyy-MM-dd")===m&&(T++,(h=w.timeEntries)!=null&&h.some(b=>x(new Date(b.startTime),"yyyy-MM-dd")===m)||y++)}c.push({date:m,timeSpent:g,taskCount:y,completedTasks:T})}return{projectName:t,tasks:s,totalTimeSpent:i,completionRate:o,timeByDay:c,recentActivity:l}}renderDrilldownContent(t,r){t.empty();let s=b=>{if(b<60)return`${Math.round(b)}m`;let S=Math.floor(b/60),k=Math.round(b%60);return k>0?`${S}h ${k}m`:`${S}h`},a=t.createDiv({cls:"stats-view__drilldown-overview"}).createDiv({cls:"stats-view__drilldown-stats"}),o=a.createDiv({cls:"stats-view__drilldown-card"});o.createDiv({cls:"stats-view__drilldown-value",text:s(r.totalTimeSpent)}),o.createDiv({cls:"stats-view__drilldown-label",text:"Total Time"});let l=a.createDiv({cls:"stats-view__drilldown-card"});l.createDiv({cls:"stats-view__drilldown-value",text:r.tasks.length.toString()}),l.createDiv({cls:"stats-view__drilldown-label",text:"Total Tasks"});let c=a.createDiv({cls:"stats-view__drilldown-card"});c.createDiv({cls:"stats-view__drilldown-value",text:`${Math.round(r.completionRate)}%`}),c.createDiv({cls:"stats-view__drilldown-label",text:"Completed"});let d=a.createDiv({cls:"stats-view__drilldown-card"}),u=r.tasks.length>0?r.totalTimeSpent/r.tasks.length:0;d.createDiv({cls:"stats-view__drilldown-value",text:s(u)}),d.createDiv({cls:"stats-view__drilldown-label",text:"Avg per Task"});let h=t.createDiv({cls:"stats-view__drilldown-section"});h.createDiv({cls:"stats-view__drilldown-heading",text:"Activity Over Time (Last 30 Days)"});let f=h.createDiv({cls:"stats-view__activity-chart"});this.renderActivityChart(f,r.timeByDay);let p=t.createDiv({cls:"stats-view__drilldown-section"}),m=p.createDiv({cls:"stats-view__section-header"});m.createDiv({cls:"stats-view__drilldown-heading",text:"All Project Tasks"});let y=m.createDiv({cls:"stats-view__task-filters"}).createEl("select",{cls:"stats-view__filter-select"});y.createEl("option",{value:"all",text:"All Tasks"}),y.createEl("option",{value:"active",text:"Active Only"}),y.createEl("option",{value:"completed",text:"Completed Only"});let T=p.createDiv({cls:"stats-view__task-list"}),w=(b="all")=>{T.empty();let S=r.tasks;if(b==="active"?S=r.tasks.filter(D=>!this.plugin.statusManager.isCompletedStatus(D.status)):b==="completed"&&(S=r.tasks.filter(D=>this.plugin.statusManager.isCompletedStatus(D.status))),S.sort((D,M)=>{let _=this.plugin.statusManager.isCompletedStatus(D.status),W=this.plugin.statusManager.isCompletedStatus(M.status);if(_!==W)return _?1:-1;let j=R=>{var O;return(O=R.timeEntries)!=null&&O.length?Math.max(...R.timeEntries.map(C=>new Date(C.startTime).getTime())):R.dateModified?new Date(R.dateModified).getTime():0};return j(M)-j(D)}),S.length===0){T.createDiv({cls:"stats-view__no-data",text:"No tasks found"});return}let k=T.createDiv({cls:"stats-view__task-count"});k.textContent=`Showing ${S.length} task${S.length!==1?"s":""}`;for(let D of S){let M=cr(D,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!0,showRecurringControls:!0,groupByDate:!1});T.appendChild(M)}};w("all"),this.registerDomEvent(y,"change",()=>{w(y.value)})}renderActivityChart(t,r){if(t.empty(),r.length===0)return;let s=Math.max(...r.map(a=>a.timeSpent));if(s===0){t.createDiv({cls:"stats-view__no-data",text:"No time tracking data"});return}let i=t.createDiv({cls:"stats-view__bar-chart"});for(let a of r){let l=i.createDiv({cls:"stats-view__bar-container"}).createDiv({cls:"stats-view__bar"}),c=a.timeSpent/s*40;l.style.height=`${c}px`;let d=`${x(new Date(a.date),"MMM d")}: ${Math.round(a.timeSpent)}m`;l.setAttribute("title",d)}}};var _s=require("obsidian");Sn();var Kf=class extends _s.ItemView{constructor(t,r){super(t);this.boardContainer=null;this.filterBar=null;this.taskElements=new Map;this.previousGroupKey=null;this.listeners=[];this.functionListeners=[];this.columnOrder=[];this.debouncedRefresh=(0,_s.debounce)(()=>{this.refresh()},150);this.plugin=r,this.currentQuery={type:"group",id:"temp",conjunction:"and",children:[],sortKey:"priority",sortDirection:"desc",groupKey:"status"},this.previousGroupKey=this.currentQuery.groupKey||null,this.registerEvents()}getViewType(){return hn}getDisplayText(){return"Kanban"}getIcon(){return"layout-grid"}registerEvents(){this.listeners.forEach(i=>this.plugin.emitter.offref(i)),this.listeners=[],this.functionListeners.forEach(i=>i()),this.functionListeners=[];let t=this.plugin.emitter.on(fr,async()=>{if(this.refresh(),this.filterBar){let i=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(i)}});this.listeners.push(t);let r=this.plugin.emitter.on(tt,async({path:i,originalTask:a,updatedTask:o})=>{if(!i||!o)return;await tl(o,this.plugin,this.contentEl);let l=this.taskElements.get(i);if(l)try{let c=this.getCurrentVisibleProperties();en(l,o,this.plugin,c,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0}),l.classList.add("task-card--updated"),window.setTimeout(()=>{l.classList.remove("task-card--updated")},1e3)}catch(c){console.error("Error updating task card in kanban:",c),this.refresh()}else this.refresh();if(this.filterBar){let c=await this.plugin.filterService.getFilterOptions();this.filterBar.updateFilterOptions(c)}});this.listeners.push(r);let s=this.plugin.filterService.on("data-changed",()=>{this.refresh()});this.functionListeners.push(s)}async onOpen(){await this.plugin.onReady(),await this.plugin.waitForMigration();let t=this.plugin.viewStateManager.getFilterState(hn);t&&(this.currentQuery=t,this.previousGroupKey=this.currentQuery.groupKey||null),this.loadColumnOrder(),this.contentEl.empty(),await this.render()}async onClose(){this.listeners.forEach(t=>this.plugin.emitter.offref(t)),this.functionListeners.forEach(t=>t()),this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.contentEl.empty()}async refresh(){this.boardContainer?await this.loadAndRenderBoard():await this.render()}async render(){let t=this.contentEl;t.empty(),t.addClass("tasknotes-plugin","kanban-view"),await this.renderHeader(t),this.boardContainer=t.createDiv({cls:"kanban-view__board-container"}),await this.loadAndRenderBoard()}async renderHeader(t){let r=t.createDiv({cls:"kanban-view__header"}),s=r.createDiv({cls:"kanban-view__filter-container"});this.currentQuery=this.plugin.filterService.createDefaultQuery(),this.currentQuery.sortKey="priority",this.currentQuery.sortDirection="desc",this.currentQuery.groupKey="status";let i=this.plugin.viewStateManager.getFilterState(hn);i&&(this.currentQuery=i);let a=await this.plugin.filterService.getFilterOptions();this.filterBar=new Xs(this.app,this.plugin,s,this.currentQuery,a,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1});let o=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(o),this.filterBar.on("saveView",({name:f,query:p,viewOptions:m,visibleProperties:g})=>{let y=this.plugin.viewStateManager.saveView(f,p,m,g);this.filterBar.setActiveSavedView(y)}),this.filterBar.on("deleteView",f=>{this.plugin.viewStateManager.deleteView(f)}),this.plugin.viewStateManager.on("saved-views-changed",f=>{var p;(p=this.filterBar)==null||p.updateSavedViews(f)}),this.filterBar.on("reorderViews",(f,p)=>{this.plugin.viewStateManager.reorderSavedViews(f,p)}),this.filterBar.on("manageViews",()=>{console.log("Manage views requested")}),this.filterBar.on("queryChange",async f=>{this.currentQuery=f,await this.plugin.viewStateManager.setFilterState(hn,f),this.loadAndRenderBoard()}),this.filterBar.on("propertiesChanged",f=>{this.loadAndRenderBoard()});let l=r.createDiv({cls:"kanban-view__actions"});l.createDiv({cls:"kanban-view__actions-left"}).createEl("button",{cls:"kanban-view__new-task-button",text:"New task"}).addEventListener("click",()=>{this.plugin.openTaskCreationModal()});let h=l.createDiv({cls:"kanban-view__actions-right"}).createDiv({cls:"kanban-view__stats"});this.updateBoardStats(h)}updateBoardStats(t,r){if(t.empty(),!r||r.length===0)return;let s=r.length,i=r.filter(a=>this.plugin.statusManager.isCompletedStatus(a.status)).length;if(s>0){let a=Math.round(i/s*100);t.createSpan({text:`${s} tasks \u2022 ${a}% complete`,cls:"kanban-view__stats-simple"})}}async loadAndRenderBoard(){var s,i;if(!this.boardContainer)return;let t=this.currentQuery.groupKey||null;this.previousGroupKey!==null&&this.previousGroupKey!==t&&(this.boardContainer.empty(),this.columnOrder=[]),this.previousGroupKey=t;let r=null;this.boardContainer.children.length===0&&(r=this.boardContainer.createDiv({cls:"kanban-view__loading",text:"Loading board..."}));try{let a=await this.plugin.filterService.getGroupedTasks(this.currentQuery,this.plugin.selectedDate);r&&r.remove(),this.renderBoardFromGroupedTasksWithReconciler(a);let o=Array.from(a.values()).flat(),l=this.contentEl.querySelector(".kanban-view__stats");l&&this.updateBoardStats(l,o)}catch(a){let o=a instanceof Error?a.message:String(a);console.error("KanbanView: Error loading Kanban board:",{error:o,stack:a instanceof Error?a.stack:void 0,query:this.currentQuery,cacheInitialized:((s=this.plugin.cacheManager)==null?void 0:s.isInitialized())||!1,visibleProperties:this.getCurrentVisibleProperties(),filterServiceQuery:JSON.stringify(this.currentQuery,null,2)}),console.error("KanbanView: Detailed error context:",{pluginInitialized:!!this.plugin,filterServiceInitialized:!!((i=this.plugin)!=null&&i.filterService),containerExists:!!this.boardContainer}),new _s.Notice("Failed to load Kanban board. See console for details."),r&&r.remove(),this.boardContainer.empty(),this.boardContainer.createDiv({cls:"kanban-view__error",text:"Error loading board."})}}renderBoardFromGroupedTasks(t){if(!this.boardContainer)return;this.boardContainer.empty(),this.taskElements.clear();let r=Array.from(t.keys()).sort();this.columnOrder.length===0&&(this.columnOrder=[...r],this.columnOrder.length>0&&this.saveColumnOrder()),this.renderBoardFromGroupedTasksWithOrder(t)}renderColumn(t,r,s){let i=t.createDiv({cls:"kanban-view__column"});i.dataset.columnId=r,r==="uncategorized"&&i.addClass("kanban-view__column--uncategorized");let a=i.createDiv({cls:"kanban-view__column-header"});a.draggable=!0,a.dataset.columnId=r,this.addColumnDragHandlers(a);let o=this.formatColumnTitle(r,this.currentQuery.groupKey||"none");a.createEl("div",{text:o,cls:"kanban-view__column-title"}),a.createEl("div",{text:`${s.length} tasks`,cls:"kanban-view__column-count"});let l=i.createDiv({cls:"kanban-view__column-body"});if(s.length===0){let d=l.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(d)}else s.forEach(d=>{let u=this.getCurrentVisibleProperties(),h=cr(d,this.plugin,u,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0});h.draggable=!0,this.addDragHandlers(h,d),l.appendChild(h),this.taskElements.set(d.path,h)});l.createEl("button",{cls:"kanban-view__add-card-button",text:"+ Add a card"}).addEventListener("click",()=>{this.openTaskCreationModalForColumn(r)}),this.addColumnDropHandlers(i)}addColumnDragHandlers(t){t.addEventListener("dragstart",r=>{if(r.dataTransfer){let s=t.dataset.columnId;s&&(r.dataTransfer.setData("text/plain",`column:${s}`),r.dataTransfer.effectAllowed="move")}t.classList.add("kanban-view__column-header--dragging")}),t.addEventListener("dragend",()=>{t.classList.remove("kanban-view__column-header--dragging")})}loadColumnOrder(){let t=this.plugin.viewStateManager.getViewPreferences(hn);t!=null&&t.columnOrder&&(this.columnOrder=[...t.columnOrder])}saveColumnOrder(){let t=this.plugin.viewStateManager.getViewPreferences(hn)||{};t.columnOrder=[...this.columnOrder],this.plugin.viewStateManager.setViewPreferences(hn,t)}async reorderColumns(t,r){var o;if(this.columnOrder.length===0){let l=(o=this.boardContainer)==null?void 0:o.querySelectorAll(".kanban-view__column");this.columnOrder=Array.from(l||[]).map(c=>c.dataset.columnId||"").filter(c=>c)}let s=this.columnOrder.indexOf(t),i=this.columnOrder.indexOf(r);if(s===-1||i===-1)return;let[a]=this.columnOrder.splice(s,1);this.columnOrder.splice(i,0,a),this.saveColumnOrder(),this.renderBoardWithOrder()}async renderBoardWithOrder(){if(this.boardContainer)try{let t=await this.plugin.filterService.getGroupedTasks(this.currentQuery,this.plugin.selectedDate);this.renderBoardFromGroupedTasksWithReconciler(t);let r=Array.from(t.values()).flat(),s=this.contentEl.querySelector(".kanban-view__stats");s&&this.updateBoardStats(s,r)}catch(t){console.error("Error reordering Kanban board:",t),this.refresh()}}renderBoardFromGroupedTasksWithOrder(t){if(!this.boardContainer)return;let r=this.boardContainer.querySelector(".kanban-view__board");r?r.empty():r=this.boardContainer.createDiv({cls:"kanban-view__board"}),this.taskElements.clear(),this.columnOrder.forEach(l=>{if(t.has(l)){let c=t.get(l)||[];this.renderColumn(r,l,c)}});let s=Array.from(t.keys()),i=s;if(this.currentQuery.groupKey==="status"){let l=this.plugin.statusManager.getAllStatuses().map(c=>c.value);i=[...new Set([...s,...l])]}let a=!1,o=this.columnOrder.length;this.columnOrder=this.columnOrder.filter(l=>i.includes(l)),this.columnOrder.length!==o&&(a=!0),i.forEach(l=>{if(!this.columnOrder.includes(l)){this.columnOrder.push(l),a=!0;let c=t.get(l)||[];this.renderColumn(r,l,c)}}),a&&this.saveColumnOrder()}addDragHandlers(t,r){t.addEventListener("dragstart",s=>{s.dataTransfer&&(s.dataTransfer.setData("text/plain",r.path),s.dataTransfer.effectAllowed="move"),window.setTimeout(()=>t.classList.add("task-card--dragging"),0)}),t.addEventListener("dragend",()=>{t.classList.remove("task-card--dragging")})}addColumnDropHandlers(t){t.addEventListener("dragover",r=>{var s;r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="move",((s=this.boardContainer)==null?void 0:s.querySelector(".kanban-view__column-header--dragging"))?t.classList.add("kanban-view__column--column-drop-target"):t.classList.add("kanban-view__column--dragover"))}),t.addEventListener("dragleave",r=>{t.contains(r.relatedTarget)||(t.classList.remove("kanban-view__column--dragover"),t.classList.remove("kanban-view__column--column-drop-target"))}),t.addEventListener("drop",async r=>{var o,l;r.preventDefault(),r.stopPropagation(),(o=this.boardContainer)==null||o.querySelectorAll(".kanban-view__column--dragover, .kanban-view__column--column-drop-target").forEach(c=>{c.classList.remove("kanban-view__column--dragover","kanban-view__column--column-drop-target")});let s=(l=r.dataTransfer)==null?void 0:l.getData("text/plain");if(s!=null&&s.startsWith("column:")){let c=s.replace("column:",""),d=t.dataset.columnId;c&&d&&c!==d&&await this.reorderColumns(c,d);return}let i=s,a=t.dataset.columnId;if(!a){let c=r.target.closest(".kanban-view__column");a=(c==null?void 0:c.getAttribute("data-column-id"))||void 0}if(i&&a&&a!=="uncategorized"){let c=await this.plugin.cacheManager.getCachedTaskInfo(i);if(c)try{let d,u;switch(this.currentQuery.groupKey){case"status":d="status",u=a;break;case"priority":d="priority",u=a;break;case"context":d="contexts",u=[a];break;case"project":if(d="projects",a==="No Project")u=[];else{let h=this.findExistingProjectFormat(c,a);h?u=[h]:u=[`[[${a.includes("/")?`${a}.md`:a}]]`]}break;default:throw new Error(`Unsupported groupBy: ${this.currentQuery.groupKey}`)}await this.plugin.updateTaskProperty(c,d,u,{silent:!0}),new _s.Notice(`Task moved to "${this.formatColumnTitle(a,this.currentQuery.groupKey)}"`)}catch(d){console.error("Failed to move task:",d),new _s.Notice("Failed to move task"),this.refresh()}}})}renderBoardFromGroupedTasksWithReconciler(t){if(!this.boardContainer)return;let r=this.boardContainer.querySelector(".kanban-view__board");r||(r=this.boardContainer.createDiv({cls:"kanban-view__board"}));let s=Array.from(t.keys()),i=s;if(this.currentQuery.groupKey==="status"){let d=this.plugin.statusManager.getAllStatuses().map(u=>u.value);i=[...new Set([...s,...d])]}i=i.sort(),this.columnOrder.length===0&&(this.columnOrder=[...i],this.columnOrder.length>0&&this.saveColumnOrder());let a=!1,o=this.columnOrder.length;this.columnOrder=this.columnOrder.filter(d=>i.includes(d)),this.columnOrder.length!==o&&(a=!0),i.forEach(d=>{this.columnOrder.includes(d)||(this.columnOrder.push(d),a=!0)}),a&&this.saveColumnOrder();let l=this.columnOrder.map(d=>({id:d,tasks:t.get(d)||[]}));this.plugin.domReconciler.updateList(r,l,d=>d.id,d=>this.createColumnElement(d.id,d.tasks),(d,u)=>this.updateColumnElement(d,u.id,u.tasks)),this.taskElements.clear(),r.querySelectorAll(".task-card[data-task-path]").forEach(d=>{let u=d.dataset.taskPath;u&&this.taskElements.set(u,d)})}createColumnElement(t,r){let s=document.createElement("div");s.className="kanban-view__column",s.dataset.columnId=t,t==="uncategorized"&&s.classList.add("kanban-view__column--uncategorized");let i=s.createDiv({cls:"kanban-view__column-header"});i.draggable=!0,i.dataset.columnId=t,this.addColumnDragHandlers(i);let a=this.formatColumnTitle(t,this.currentQuery.groupKey||"none"),o=i.createEl("div",{cls:"kanban-view__column-title"});this.currentQuery.groupKey==="project"&&t!=="No Project"?this.createClickableProjectTitle(o,t,a):o.textContent=a,i.createEl("div",{text:`${r.length} tasks`,cls:"kanban-view__column-count"});let l=s.createDiv({cls:"kanban-view__column-body"}),c=l.createDiv({cls:"kanban-view__tasks-container"});if(r.length===0){let u=c.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(u)}else this.plugin.domReconciler.updateList(c,r,u=>u.path,u=>this.createTaskCardElement(u),(u,h)=>this.updateTaskCardElement(u,h));return l.createEl("button",{cls:"kanban-view__add-card-button",text:"+ Add a card"}).addEventListener("click",()=>{this.openTaskCreationModalForColumn(t)}),this.addColumnDropHandlers(s),s}updateColumnElement(t,r,s){let i=t.querySelector(".kanban-view__column-count");i&&(i.textContent=`${s.length} tasks`);let a=t.querySelector(".kanban-view__column-body");if(a){let o=a.querySelector(".kanban-view__add-card-button"),l=a.querySelector(".kanban-view__tasks-container");if(l||(l=a.createDiv({cls:"kanban-view__tasks-container"}),o?a.insertBefore(l,o):a.appendChild(l)),s.length===0){l.empty();let c=l.createDiv({cls:"kanban-view__column-empty",text:"No tasks"});this.addColumnDropHandlers(c)}else{let c=l.querySelector(".kanban-view__column-empty");c&&c.remove(),this.plugin.domReconciler.updateList(l,s,d=>d.path,d=>this.createTaskCardElement(d),(d,u)=>this.updateTaskCardElement(d,u))}}}createTaskCardElement(t){let r=this.getCurrentVisibleProperties(),s=cr(t,this.plugin,r,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0});return s.draggable=!0,this.addDragHandlers(s,t),this.taskElements.set(t.path,s),s}updateTaskCardElement(t,r){let s=this.getCurrentVisibleProperties();en(t,r,this.plugin,s,{showDueDate:!0,showCheckbox:!1,showTimeTracking:!0}),this.taskElements.set(r.path,t)}getCurrentVisibleProperties(){var t;return(t=this.filterBar)==null?void 0:t.getCurrentVisibleProperties()}formatColumnTitle(t,r){var s,i;switch(r){case"status":return((s=this.plugin.statusManager.getStatusConfig(t))==null?void 0:s.label)||t;case"priority":return((i=this.plugin.priorityManager.getPriorityConfig(t))==null?void 0:i.label)||t;case"context":return t==="uncategorized"?"Uncategorized":`@${t}`;case"project":return t==="No Project"?"No Project":t;case"due":return t;case"none":default:return t}}isResolvedProjectPath(t){var r;return(r=this.plugin)!=null&&r.app?this.plugin.app.vault.getAbstractFileByPath(t+".md")instanceof _s.TFile?!0:!!this.plugin.app.metadataCache.getFirstLinkpathDest(t,""):!1}findExistingProjectFormat(t,r){var i;let s=((i=t.projects)==null?void 0:i.filter(a=>a&&typeof a=="string"&&a.trim()!==""))||[];for(let a of s)if(this.plugin.filterService.resolveProjectToAbsolutePath(a)===r)return a;return null}createClickableProjectTitle(t,r,s){if(r.includes("/")||this.isResolvedProjectPath(r)){let a=t.createEl("a",{cls:"internal-link kanban-view__project-link",text:s});a.addEventListener("click",async o=>{o.preventDefault(),o.stopPropagation();try{let l=this.plugin.app.vault.getAbstractFileByPath(r);if(l instanceof _s.TFile)await this.plugin.app.workspace.getLeaf(!1).openFile(l);else{let c=this.plugin.app.metadataCache.getFirstLinkpathDest(r,"");c?await this.plugin.app.workspace.getLeaf(!1).openFile(c):new _s.Notice(`Project file not found: ${r}`)}}catch(l){console.error("Error opening project file:",l),new _s.Notice(`Error opening project: ${r}`)}}),a.addEventListener("mouseover",o=>{this.plugin.app.workspace.trigger("hover-link",{event:o,source:"tasknotes-kanban",hoverParent:this,targetEl:a,linktext:r,sourcePath:r})})}else t.textContent=s}openTaskCreationModalForColumn(t){let r={};switch(this.currentQuery.groupKey){case"status":t!=="uncategorized"&&(r.status=t);break;case"priority":t!=="uncategorized"&&(r.priority=t);break;case"context":t!=="uncategorized"&&(r.contexts=[t]);break;case"project":t!=="No Project"&&(r.projects=[t]);break}this.plugin.openTaskCreationModal(r)}};var Dn=require("obsidian"),as=ke(dn());Fe();var xy=class{constructor(e){this.timerWorker=null;this.activeAudioContexts=new Set;this.cleanupTimeouts=new Set;this.plugin=e,this.state={isRunning:!1,timeRemaining:e.settings.pomodoroWorkDuration*60}}async initialize(){await this.loadState(),this.setupWorker(),this.state.isRunning&&this.state.currentSession&&this.resumeTimer()}setWebhookNotifier(e){this.webhookNotifier=e}setupWorker(){let e=new Blob([yB],{type:"application/javascript"}),t=URL.createObjectURL(e);this.timerWorker=new Worker(t),this.timerWorker.onmessage=r=>{r.data.type==="done"&&this.completePomodoro(),r.data.type==="tick"&&(this.state.timeRemaining=r.data.timeRemaining,this.plugin.emitter.trigger(fn,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}}async loadState(){try{let e=await this.plugin.loadData();if(e!=null&&e.pomodoroState){this.state=e.pomodoroState,this.state.timeRemaining=Math.max(0,this.state.timeRemaining||0);let t=me(Ge());if(e.lastPomodoroDate!==t&&this.state.currentSession&&(this.state.currentSession=void 0,this.state.isRunning=!1),this.state.currentSession){let s=new Date(this.state.currentSession.startTime).getTime();(Date.now()-s)/(1e3*60*60)>24&&(this.state.currentSession=void 0,this.state.isRunning=!1,this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60)}this.state.currentSession||(this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60)}}catch(e){console.error("Failed to load pomodoro state:",e),this.state={isRunning:!1,timeRemaining:this.plugin.settings.pomodoroWorkDuration*60}}}async saveState(){try{let e=await this.plugin.loadData()||{};e.pomodoroState=this.state,e.lastPomodoroDate=me(Ge()),await this.plugin.saveData(e)}catch(e){console.error("Failed to save pomodoro state:",e)}}async saveLastSelectedTask(e){try{let t=await this.plugin.loadData()||{};t.lastSelectedTaskPath=e,await this.plugin.saveData(t)}catch(t){console.error("Failed to save last selected task:",t)}}async getLastSelectedTaskPath(){try{let e=await this.plugin.loadData();return e==null?void 0:e.lastSelectedTaskPath}catch(e){console.error("Failed to load last selected task:",e);return}}async startPomodoro(e,t){var l;if(this.state.isRunning){new Dn.Notice("A pomodoro is already running");return}if(this.state.currentSession&&!this.state.isRunning){new Dn.Notice("Resume the current session instead of starting a new one");return}let s=(t?Math.max(1,Math.min(120,t))*60:null)||Math.max(1,Math.min(7200,this.state.timeRemaining)),i=s/60;console.log("Starting pomodoro with planned duration:",i,"minutes");let a=Le(),o={id:Date.now().toString(),taskPath:e==null?void 0:e.path,startTime:a,plannedDuration:i,type:"work",completed:!1,activePeriods:[{startTime:a}]};if(this.state.currentSession=o,this.state.isRunning=!0,this.state.timeRemaining=s,this.state.nextSessionType=void 0,await this.saveState(),this.startTimer(),e)try{await this.plugin.taskService.startTimeTracking(e)}catch(c){(l=c.message)!=null&&l.includes("Time tracking is already active")||console.error("Failed to start time tracking for Pomodoro:",c)}if(this.plugin.emitter.trigger(Hp,{session:o,task:e}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("pomodoro.started",{session:o,task:e})}catch(c){console.warn("Failed to trigger webhook for pomodoro start:",c)}new Notification(`Pomodoro started${e?` for: ${e.title}`:""}`)}async startBreak(e=!1){if(this.state.isRunning){new Dn.Notice("A timer is already running");return}if(this.state.currentSession&&!this.state.isRunning){new Dn.Notice("Resume the current session instead of starting a new one");return}let t=e?Math.max(1,Math.min(60,this.plugin.settings.pomodoroLongBreakDuration)):Math.max(1,Math.min(30,this.plugin.settings.pomodoroShortBreakDuration)),r=Le(),s={id:Date.now().toString(),startTime:r,plannedDuration:t,type:e?"long-break":"short-break",completed:!1,activePeriods:[{startTime:r}]};this.state.currentSession=s,this.state.isRunning=!0,this.state.timeRemaining=s.plannedDuration*60,this.state.nextSessionType=void 0,await this.saveState(),this.startTimer(),new Dn.Notice(`${e?"Long":"Short"} break started`)}async pausePomodoro(){if(this.state.isRunning){if(this.stopTimer(),this.state.isRunning=!1,this.state.currentSession&&this.state.currentSession.activePeriods.length>0){let e=this.state.currentSession.activePeriods[this.state.currentSession.activePeriods.length-1];e.endTime||(e.endTime=Le())}if(this.state.currentSession&&this.state.currentSession.taskPath)try{let e=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);e&&await this.plugin.taskService.stopTimeTracking(e)}catch(e){console.error("Failed to stop time tracking for Pomodoro pause:",e)}await this.saveState(),this.plugin.emitter.trigger(fn,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),new Dn.Notice("Pomodoro paused")}}async resumePomodoro(){var e;if(!(this.state.isRunning||!this.state.currentSession)){if(this.state.isRunning=!0,this.state.currentSession&&this.state.currentSession.activePeriods.push({startTime:Le()}),await this.saveState(),this.startTimer(),this.state.currentSession&&this.state.currentSession.taskPath)try{let t=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);t&&await this.plugin.taskService.startTimeTracking(t)}catch(t){(e=t.message)!=null&&e.includes("Time tracking is already active")||console.error("Failed to start time tracking for Pomodoro resume:",t)}this.plugin.emitter.trigger(fn,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),new Dn.Notice("Pomodoro resumed")}}async stopPomodoro(){if(!this.state.currentSession)return;let e=this.state.isRunning;if(this.stopTimer(),this.state.currentSession){if(this.state.currentSession.interrupted=!0,this.state.currentSession.endTime=Le(),this.state.currentSession.activePeriods.length>0){let t=this.state.currentSession.activePeriods[this.state.currentSession.activePeriods.length-1];t.endTime||(t.endTime=Le())}await this.addSessionToHistory(this.state.currentSession)}if(this.plugin.emitter.trigger(Wp,{session:this.state.currentSession}),this.webhookNotifier&&this.state.currentSession)try{let t=this.state.currentSession.taskPath?await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath):void 0;await this.webhookNotifier.triggerWebhook("pomodoro.interrupted",{session:this.state.currentSession,task:t})}catch(t){console.warn("Failed to trigger webhook for pomodoro interruption:",t)}if(this.state.currentSession&&this.state.currentSession.taskPath&&e)try{let t=await this.plugin.cacheManager.getTaskInfo(this.state.currentSession.taskPath);t&&await this.plugin.taskService.stopTimeTracking(t)}catch(t){console.error("Failed to stop time tracking for Pomodoro interrupt:",t)}this.state.currentSession=void 0,this.state.isRunning=!1,this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60,await this.saveState(),this.plugin.emitter.trigger(fn,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}),e&&new Dn.Notice("Pomodoro stopped and reset")}startTimer(){this.timerWorker&&this.timerWorker.postMessage({command:"start",duration:this.state.timeRemaining})}stopTimer(){this.timerWorker&&this.timerWorker.postMessage({command:"stop"})}resumeTimer(){if(this.state.currentSession&&this.state.currentSession.startTime){let e=new Date(this.state.currentSession.startTime).getTime(),t=Date.now();if(e>t){this.stopPomodoro();return}let r=this.state.currentSession.plannedDuration*60;if(!this.state.isRunning&&this.state.timeRemaining>0)this.state.timeRemaining=Math.min(this.state.timeRemaining,r);else if(this.state.isRunning){let s=this.state.currentSession.activePeriods||[],i=0;for(let a of s){let o=new Date(a.startTime).getTime(),l=a.endTime?new Date(a.endTime).getTime():t;i+=Math.floor((l-o)/1e3)}this.state.timeRemaining=Math.max(0,r-i)}this.state.timeRemaining>0&&this.state.isRunning?this.startTimer():this.state.timeRemaining<=0&&this.completePomodoro()}}async completePomodoro(){if(this.stopTimer(),!this.state.currentSession)return;let e=this.state.currentSession;if(e.completed=!0,e.endTime=Le(),e.activePeriods.length>0){let r=e.activePeriods[e.activePeriods.length-1];r.endTime||(r.endTime=Le())}if(e.type==="work"&&this.state.isRunning&&e.taskPath)try{let r=await this.plugin.cacheManager.getTaskInfo(e.taskPath);r&&await this.plugin.taskService.stopTimeTracking(r)}catch(r){console.error("Failed to stop time tracking for Pomodoro completion:",r)}let t=!1;if(e.type==="work")try{t=((await this.getTodayStats()).pomodorosCompleted+1)%this.plugin.settings.pomodoroLongBreakInterval===0}catch(r){console.error("Failed to calculate break type:",r),t=!1}if(await this.addSessionToHistory(e),this.plugin.emitter.trigger(Up,{session:e,nextType:e.type==="work"?t?"long-break":"short-break":"work"}),this.webhookNotifier)try{let r=e.taskPath?await this.plugin.cacheManager.getTaskInfo(e.taskPath):void 0;await this.webhookNotifier.triggerWebhook("pomodoro.completed",{session:e,task:r})}catch(r){console.warn("Failed to trigger webhook for pomodoro completion:",r)}if(this.plugin.settings.pomodoroNotifications){let r=e.type==="work"?"\u{1F345} Pomodoro completed!":"\u2615 Break completed!",s=e.type==="work"?`Time for a ${t?"long break \u{1F4A4}":"short break \u2615"}`:"Ready for the next pomodoro?";new Notification(r,{body:s})}if(this.plugin.settings.pomodoroSoundEnabled&&this.playCompletionSound(),this.state.currentSession=void 0,this.state.isRunning=!1,e.type==="work"){let r=t?this.plugin.settings.pomodoroLongBreakDuration:this.plugin.settings.pomodoroShortBreakDuration;if(this.state.timeRemaining=r*60,this.state.nextSessionType=t?"long-break":"short-break",this.plugin.settings.pomodoroAutoStartBreaks){let s=setTimeout(()=>this.startBreak(t),1e3);this.cleanupTimeouts.add(s)}}else if(this.state.timeRemaining=this.plugin.settings.pomodoroWorkDuration*60,this.state.nextSessionType="work",this.plugin.settings.pomodoroAutoStartWork){let r=setTimeout(()=>this.startPomodoro(),1e3);this.cleanupTimeouts.add(r)}await this.saveState(),this.plugin.emitter.trigger(fn,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession})}playCompletionSound(){try{let e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),r=e.createGain();t.connect(r),r.connect(e.destination);let s=Math.max(0,Math.min(1,this.plugin.settings.pomodoroSoundVolume/100));r.gain.value=s*.3,t.frequency.value=800,t.type="sine",t.start(),t.stop(e.currentTime+.1),this.activeAudioContexts.add(e);let i=setTimeout(()=>{try{let o=e.createOscillator();o.connect(r),o.frequency.value=1e3,o.type="sine",o.start(),o.stop(e.currentTime+.1)}catch(o){console.error("Failed to play second beep:",o)}},150);this.cleanupTimeouts.add(i);let a=setTimeout(()=>{this.activeAudioContexts.delete(e),e.close().catch(()=>{})},300);this.cleanupTimeouts.add(a)}catch(e){console.error("Failed to play completion sound:",e)}}getState(){return{...this.state}}adjustSessionTime(e){if(this.state.currentSession){this.stopTimer(),this.state.timeRemaining=Math.max(1,this.state.timeRemaining+e);let t=this.state.currentSession.activePeriods||[],r=0;for(let i of t)if(i.endTime){let a=new Date(i.startTime).getTime(),o=new Date(i.endTime).getTime();r+=Math.floor((o-a)/1e3)}else if(this.state.isRunning){let a=new Date(i.startTime).getTime(),o=Date.now();r+=Math.floor((o-a)/1e3)}let s=r+this.state.timeRemaining;this.state.currentSession.plannedDuration=Math.ceil(s/60),this.saveState(),this.startTimer(),this.plugin.emitter.trigger(fn,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession})}}adjustPreparedTimer(e){this.state.currentSession||(this.stopTimer(),this.state.timeRemaining=Math.max(1,e),this.saveState(),console.log("Adjusted prepared timer to:",this.state.timeRemaining,"seconds"),this.plugin.emitter.trigger(fn,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}isRunning(){return this.state.isRunning}getCurrentSession(){return this.state.currentSession}getTimeRemaining(){return this.state.timeRemaining}async getPomodorosCompleted(){return(await this.getTodayStats()).pomodorosCompleted}async getCurrentStreak(){return(await this.getTodayStats()).currentStreak}async getTotalMinutesToday(){return(await this.getTodayStats()).totalMinutes}async assignTaskToCurrentSession(e){this.state.currentSession&&(this.state.currentSession.taskPath=e==null?void 0:e.path,await this.saveState(),this.plugin.emitter.trigger(fn,{timeRemaining:this.state.timeRemaining,session:this.state.currentSession}))}async getSessionHistory(){try{let e=[],t=await this.plugin.loadData(),r=(t==null?void 0:t.pomodoroHistory)||[];if(this.plugin.settings.pomodoroStorageLocation==="daily-notes"){let s=await this.loadHistoryFromDailyNotes();e=s,r.length>0&&(e=this.mergeHistories(r,s))}else e=r;return e.sort((s,i)=>new Date(s.startTime).getTime()-new Date(i.startTime).getTime())}catch(e){return console.error("Failed to load session history:",e),[]}}async saveSessionHistory(e){try{if(this.plugin.settings.pomodoroStorageLocation==="daily-notes")await this.saveHistoryToDailyNotes(e);else{let t=await this.plugin.loadData()||{};t.pomodoroHistory=e,await this.plugin.saveData(t)}}catch(t){console.error("Failed to save session history:",t)}}async addSessionToHistory(e){if(!e.endTime){console.warn("Cannot add session to history without end time");return}let t={id:e.id,startTime:e.startTime,endTime:e.endTime,plannedDuration:e.plannedDuration,type:e.type,taskPath:e.taskPath,completed:e.completed&&!e.interrupted,activePeriods:e.activePeriods.slice()};try{if(this.plugin.settings.pomodoroStorageLocation==="daily-notes")await this.addSingleSessionToDailyNote(t);else{let r=await this.getSessionHistory();r.push(t),await this.saveSessionHistory(r)}}catch(r){console.error("Failed to add session to history:",r)}}async getStatsForDate(e){let t=me(e),i=(await this.getSessionHistory()).filter(u=>me(new Date(u.startTime))===t).filter(u=>u.type==="work"),a=i.filter(u=>u.completed),o=0;for(let u=i.length-1;u>=0&&i[u].completed;u--)o++;let l=a.reduce((u,h)=>u+Qf(h),0),c=a.length>0?l/a.length:0,d=i.length>0?a.length/i.length*100:0;return{pomodorosCompleted:a.length,currentStreak:o,totalMinutes:l,averageSessionLength:Math.round(c),completionRate:Math.round(d)}}async getTodayStats(){let e=Ge(),t=wt(e);return this.getStatsForDate(t)}cleanup(){this.stopTimer(),this.timerWorker&&(this.timerWorker.terminate(),this.timerWorker=null);for(let e of this.cleanupTimeouts)clearTimeout(e);this.cleanupTimeouts.clear();for(let e of this.activeAudioContexts)e.state!=="closed"&&e.close().catch(()=>{});this.activeAudioContexts.clear(),this.saveState()}async saveHistoryToDailyNotes(e){try{if(!(0,as.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes core plugin is not enabled");let t=this.groupSessionsByDate(e);for(let[r,s]of t)await this.updateDailyNotePomodoros(r,s)}catch(t){throw console.error("Failed to save history to daily notes:",t),t}}async loadHistoryFromDailyNotes(){try{if(!(0,as.appHasDailyNotesPluginLoaded)())return[];let e=[],t=(0,as.getAllDailyNotes)(),r=this.plugin.fieldMapper.toUserField("pomodoros");for(let[,s]of Object.entries(t))try{let i=this.plugin.app.metadataCache.getFileCache(s),a=i==null?void 0:i.frontmatter;if(a&&a[r]){let o=a[r];Array.isArray(o)&&e.push(...o)}}catch(i){console.warn(`Failed to read pomodoro data from daily note ${s.path}:`,i)}return e}catch(e){return console.error("Failed to load history from daily notes:",e),[]}}groupSessionsByDate(e){let t=new Map;for(let r of e){let s=new Date(r.startTime),i=me(s);t.has(i)||t.set(i,[]),t.get(i).push(r)}return t}async addSingleSessionToDailyNote(e){try{let t=new Date(e.startTime),r=window.moment(t),s=(0,as.getAllDailyNotes)(),i=(0,as.getDailyNote)(r,s);if(!i&&(i=await(0,as.createDailyNote)(r),!i))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let a=this.plugin.fieldMapper.toUserField("pomodoros");await this.plugin.app.fileManager.processFrontMatter(i,o=>{let l=o[a]||[];new Set(l.map(d=>d.id)).has(e.id)||(o[a]=[...l,e])})}catch(t){console.error("Failed to add session to daily note:",t)}}async updateDailyNotePomodoros(e,t){try{let r=$t(e),s=window.moment(r),i=(0,as.getAllDailyNotes)(),a=(0,as.getDailyNote)(s,i);if(!a&&(a=await(0,as.createDailyNote)(s),!a))throw new Error("Failed to create daily note. Please check your Daily Notes plugin configuration and ensure the daily notes folder exists.");let o=this.plugin.fieldMapper.toUserField("pomodoros");await this.plugin.app.fileManager.processFrontMatter(a,l=>{let c=l[o]||[],d=new Set(c.map(h=>h.id)),u=t.filter(h=>!d.has(h.id));u.length>0&&(l[o]=[...c,...u])})}catch(r){console.error(`Failed to update daily note for ${e}:`,r)}}mergeHistories(e,t){let r=[...t],s=new Set(t.map(i=>i.id));for(let i of e)s.has(i.id)||r.push(i);return r}async migrateTodailyNotes(){try{if(!(0,as.appHasDailyNotesPluginLoaded)())throw new Error("Daily Notes core plugin must be enabled for migration");let e=await this.plugin.loadData(),t=(e==null?void 0:e.pomodoroHistory)||[];if(t.length===0)return;await this.saveHistoryToDailyNotes(t),e.pomodoroHistory=[],await this.plugin.saveData(e),new Dn.Notice(`Successfully migrated ${t.length} pomodoro sessions to daily notes.`)}catch(e){throw console.error("Failed to migrate pomodoro data to daily notes:",e),new Dn.Notice("Failed to migrate pomodoro data. Please try again or check the console for details."),e}}};Lt();var tn=require("obsidian");Fe();Lt();var My=class extends tn.Events{constructor(t,r,s){super();this.tasksByDate=new Map;this.tasksByStatus=new Map;this.overdueTasks=new Set;this.initialized=!1;this.indexesBuilt=!1;this.eventListeners=[];this.debouncedHandlers=new Map;this.DEBOUNCE_DELAY=300;this.lastKnownTaskInfo=new Map;this.lastKnownFrontmatter=new Map;this.app=t,this.settings=r,this.taskTag=r.taskTag,this.excludedFolders=r.excludedFolders?r.excludedFolders.split(",").map(i=>i.trim()):[],this.fieldMapper=s,this.disableNoteIndexing=r.disableNoteIndexing,this.storeTitleInFilename=r.storeTitleInFilename}initialize(){this.initialized||(this.setupNativeEventListeners(),this.initialized=!0,this.trigger("cache-initialized",{message:"Minimal native cache ready"}))}getApp(){return this.app}isTaskFile(t){if(!t)return!1;if(this.settings.taskIdentificationMethod==="property"){let r=this.settings.taskPropertyName,s=this.settings.taskPropertyValue;if(!r||!s)return!1;let i=t[r];return i===void 0?!1:Array.isArray(i)?i.some(a=>this.comparePropertyValues(a,s)):this.comparePropertyValues(i,s)}else return Array.isArray(t.tags)&&t.tags.includes(this.taskTag)}comparePropertyValues(t,r){if(typeof t=="boolean"&&typeof r=="string"){let s=r.toLowerCase();if(s==="true"||s==="false")return t===(s==="true")}return t===r}setupNativeEventListeners(){this.eventListeners.push(this.app.metadataCache.on("changed",(t,r,s)=>{t instanceof tn.TFile&&t.extension==="md"&&this.isValidFile(t.path)&&this.handleFileChangedDebounced(t,s)})),this.eventListeners.push(this.app.metadataCache.on("deleted",(t,r)=>{t instanceof tn.TFile&&t.extension==="md"&&this.handleFileDeleted(t.path)})),this.eventListeners.push(this.app.vault.on("rename",(t,r)=>{t instanceof tn.TFile&&t.extension==="md"&&this.handleFileRenamed(t,r)}))}ensureIndexesBuilt(){this.indexesBuilt||(this.indexesBuilt=!0,window.setTimeout(()=>this.buildEssentialIndexes(),1))}async buildEssentialIndexes(){try{let t=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path)),r=50;for(let s=0;s<t.length;s+=r){let i=t.slice(s,s+r);for(let a of i)try{let o=this.app.metadataCache.getFileCache(a);o!=null&&o.frontmatter&&this.isTaskFile(o.frontmatter)&&await this.indexTaskFile(a,o.frontmatter)}catch(o){console.error(`Error indexing file ${a.path}:`,o)}await new Promise(a=>window.setTimeout(a,1))}this.trigger("indexes-built",{tasksByDate:this.tasksByDate.size,tasksByStatus:this.tasksByStatus.size,overdueTasks:this.overdueTasks.size})}catch(t){console.error("Error building essential indexes:",t)}}async indexTaskFile(t,r){if(this.fieldMapper)try{let s=this.extractTaskInfoFromNative(t.path,r);if(!s)return;this.updateDateIndex(t.path,s),this.updateStatusIndex(t.path,s.status),this.updateOverdueIndex(t.path,s)}catch(s){console.error(`Error indexing task ${t.path}:`,s)}}async getTaskInfo(t){let r=this.app.vault.getAbstractFileByPath(t);if(!(r instanceof tn.TFile))return null;let s=this.app.metadataCache.getFileCache(r);return s!=null&&s.frontmatter?this.extractTaskInfoFromNative(t,s.frontmatter):null}async getAllTasks(){let t=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path)),r=[];for(let s of t){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter);a&&r.push(a)}}return r}getTasksForDate(t){this.ensureIndexesBuilt();let r=this.tasksByDate.get(t)||new Set;return Array.from(r)}getTaskPathsByStatus(t){this.ensureIndexesBuilt();let r=this.tasksByStatus.get(t)||new Set;return Array.from(r)}getOverdueTaskPaths(){return this.ensureIndexesBuilt(),new Set(this.overdueTasks)}async getCalendarData(t,r){let s=new Map,i=new Map,a=new Set,o=this.app.vault.getMarkdownFiles().filter(c=>this.isValidFile(c.path));try{let{getAllDailyNotes:c}=dn(),d=c();for(let[u]of Object.entries(d))a.add(u)}catch(c){}for(let c of o){let d=this.app.metadataCache.getFileCache(c);if(!(d!=null&&d.frontmatter))continue;let u=d.frontmatter;if(!this.isTaskFile(u)&&!this.disableNoteIndexing){let f=null;if(this.fieldMapper){let p=this.fieldMapper.toUserField("dateCreated");if(u[p]){let m=u[p];try{let g=new Date(m);isNaN(g.getTime())||(f=g.toISOString().split("T")[0])}catch(g){}}}if(!f){let m=c.basename.match(/(\d{4}-\d{2}-\d{2})/);m&&(f=m[1],a.add(f))}if(f){let p=i.get(f)||0;i.set(f,p+1)}}}let l=new Date(t,r+1,0).getDate();for(let c=1;c<=l;c++){let d=`${t}-${String(r+1).padStart(2,"0")}-${String(c).padStart(2,"0")}`,u=this.getTasksForDate(d);if(u.length>0){let f=(await Promise.all(u.map(p=>this.getTaskInfo(p)))).filter(p=>p!==null);if(f.length>0){let p={count:f.length,hasDue:f.some(m=>m.due&&!m.scheduled),hasScheduled:f.some(m=>m.scheduled),hasCompleted:f.some(m=>m.status==="completed"||m.status==="done"),hasArchived:f.some(m=>m.archived),tasks:f};s.set(d,p)}}}return{tasks:s,notes:i,dailyNotes:a}}getAllTaskPaths(){let t=new Set,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)&&t.add(s.path)}return t}getAllStatuses(){if(this.ensureIndexesBuilt(),this.tasksByStatus.size===0&&this.indexesBuilt){console.debug("MinimalNativeCache: Indexes marked as built but tasksByStatus is empty, computing statuses synchronously");let t=new Set,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter);a!=null&&a.status&&t.add(a.status)}}return Array.from(t).sort()}return Array.from(this.tasksByStatus.keys()).sort()}getAllPriorities(){let t=new Set,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter);a!=null&&a.priority&&t.add(a.priority)}}return Array.from(t).sort()}getAllTags(){let t=new Set,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter);a!=null&&a.tags&&Array.isArray(a.tags)&&a.tags.forEach(o=>t.add(o))}}return Array.from(t).sort()}getAllContexts(){let t=new Set,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter);a!=null&&a.contexts&&Array.isArray(a.contexts)&&a.contexts.forEach(o=>t.add(o))}}return Array.from(t).sort()}getAllProjects(){let t=new Set,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter);if(a&&a.projects){let o=qr(a.projects);o.length>0&&o.forEach(l=>{this.extractProjectNamesFromValue(l,s.path).forEach(d=>{let u=d.trim();u.length>0&&t.add(u)})})}}}return Array.from(t).sort()}getAllProjectsWithDetails(){let t=new Map,r=this.app.vault.getMarkdownFiles().filter(s=>this.isValidFile(s.path));for(let s of r){let i=this.app.metadataCache.getFileCache(s);if(i!=null&&i.frontmatter&&this.isTaskFile(i.frontmatter)){let a=this.extractTaskInfoFromNative(s.path,i.frontmatter),o=qr((a==null?void 0:a.projects)||[]);o.length>0&&o.forEach(l=>{this.extractProjectDetailsFromValue(l,s.path).forEach(d=>{let u=t.get(d.name);u?u.usageCount++:t.set(d.name,{...d,usageCount:1})})})}}return Array.from(t.values()).sort((s,i)=>s.name.localeCompare(i.name))}getAllProjectFiles(){return this.getAllProjectsWithDetails().filter(r=>r.isLinkedNote&&r.exists&&r.filePath).map(r=>({name:r.name,path:r.filePath,usageCount:r.usageCount}))}extractProjectNamesFromValue(t,r){var i;if(!t)return[];let s=[];if(t.startsWith("[[")&&t.endsWith("]]")){let a=t.slice(2,-2),l=(0,tn.parseLinktext)(a).path,c;if(c=this.app.metadataCache.getFirstLinkpathDest(l,""),!c){let d=r.substring(0,r.lastIndexOf("/"));c=this.app.metadataCache.getFirstLinkpathDest(l,d)}if(c)s.push(c.basename);else{let d=((i=l.split("/").pop())==null?void 0:i.replace(/\.md$/,""))||l;s.push(d)}}else{let a=t.trim();a&&s.push(a)}return s}extractProjectDetailsFromValue(t,r){var i;if(!t)return[];let s=[];if(t.startsWith("[[")&&t.endsWith("]]")){let a=t.slice(2,-2),l=(0,tn.parseLinktext)(a).path,c;if(c=this.app.metadataCache.getFirstLinkpathDest(l,""),!c){let d=r.substring(0,r.lastIndexOf("/"));c=this.app.metadataCache.getFirstLinkpathDest(l,d)}if(c)s.push({name:c.basename,isLinkedNote:!0,filePath:c.path,exists:!0});else{let d=((i=l.split("/").pop())==null?void 0:i.replace(/\.md$/,""))||l;s.push({name:d,isLinkedNote:!0,filePath:void 0,exists:!1})}}else{let a=t.trim();a&&s.push({name:a,isLinkedNote:!1,filePath:void 0,exists:!1})}return s}getCachedTaskInfoSync(t){let r=this.app.vault.getAbstractFileByPath(t);if(!(r instanceof tn.TFile))return null;let s=this.app.metadataCache.getFileCache(r);return!(s!=null&&s.frontmatter)||!this.isTaskFile(s.frontmatter)?null:this.extractTaskInfoFromNative(t,s.frontmatter)}async getCachedTaskInfo(t){return this.getTaskInfo(t)}async getTaskByPath(t){return this.getTaskInfo(t)}async getNotesForDate(t){if(this.disableNoteIndexing)return[];let r=ve(t.toISOString()),s=[],i=this.app.vault.getMarkdownFiles().filter(a=>this.isValidFile(a.path));for(let a of i){let o=this.app.metadataCache.getFileCache(a);if(!(o!=null&&o.frontmatter))continue;let l=o.frontmatter;if(this.isTaskFile(l))continue;let d=null;if(this.fieldMapper){let u=this.fieldMapper.toUserField("dateCreated");if(l[u]){let h=l[u];if(typeof h=="string"&&h.trim()){let f=h.trim();if(f.startsWith("T")&&/^T\d{2}:\d{2}(:\d{2})?/.test(f))console.debug("Skipping invalid time-only date in note frontmatter:",{path:a.path,dateValue:f});else try{let p=qe(h);d=me(p)}catch(p){console.debug("Failed to parse date from note frontmatter:",{path:a.path,dateValue:h,error:p instanceof Error?p.message:String(p)})}}}}if(!d){let h=a.basename.match(/(\d{4}-\d{2}-\d{2})/);if(h)try{let f=qe(h[1]);d=me(f)}catch(f){}}if(d===r){let u=[];if(l.tags&&(Array.isArray(l.tags)?u=l.tags.filter(f=>typeof f=="string"):typeof l.tags=="string"&&(u=[l.tags])),o.tags){let f=o.tags.map(p=>p.tag.replace("#",""));u=[...new Set([...u,...f])]}let h={title:a.basename,tags:u,path:a.path,createdDate:d,lastModified:a.stat.mtime};s.push(h)}}return s}async getTaskInfoForDate(t){let r=t.toISOString().split("T")[0],s=this.getTasksForDate(r);return(await Promise.all(s.map(a=>this.getTaskInfo(a)))).filter(a=>a!==null)}getTaskPathsByDate(t){return new Set(this.getTasksForDate(t))}getTaskPathsByPriority(t){let r=[],s=this.app.vault.getMarkdownFiles().filter(i=>this.isValidFile(i.path));for(let i of s){let a=this.app.metadataCache.getFileCache(i);if(a!=null&&a.frontmatter&&this.isTaskFile(a.frontmatter)){let o=this.extractTaskInfoFromNative(i.path,a.frontmatter);(o==null?void 0:o.priority)===t&&r.push(i.path)}}return r}async rebuildDailyNotesCache(t,r){}updateDateIndex(t,r){for(let s of this.tasksByDate.values())s.delete(t);if(r.due){let s=ve(r.due);this.tasksByDate.has(s)||this.tasksByDate.set(s,new Set),this.tasksByDate.get(s).add(t)}if(r.scheduled){let s=ve(r.scheduled);this.tasksByDate.has(s)||this.tasksByDate.set(s,new Set),this.tasksByDate.get(s).add(t)}}updateStatusIndex(t,r){for(let s of this.tasksByStatus.values())s.delete(t);this.tasksByStatus.has(r)||this.tasksByStatus.set(r,new Set),this.tasksByStatus.get(r).add(t)}updateOverdueIndex(t,r){if(this.overdueTasks.delete(t),!r.recurrence){let s=Kt();r.due&&On(r.due,s)?this.overdueTasks.add(t):!r.due&&r.scheduled&&On(r.scheduled,s)&&this.overdueTasks.add(t)}}handleFileChangedDebounced(t,r){let s=this.app.metadataCache.getFileCache(t);if(!(s!=null&&s.frontmatter)||!this.isTaskFile(s.frontmatter))return;let i=s.frontmatter,a=this.lastKnownFrontmatter.get(t.path);if(this.frontmatterEquals(i,a))return;this.lastKnownFrontmatter.set(t.path,this.deepClone(i));let o=this.extractTaskInfoFromNative(t.path,i),l=this.getLastKnownTaskInfo(t.path);if(this.taskInfoEquals(o,l)){this.setLastKnownTaskInfo(t.path,o);return}this.setLastKnownTaskInfo(t.path,o);let c=this.debouncedHandlers.get(t.path);c&&clearTimeout(c);let d=setTimeout(()=>{this.handleFileChanged(t,r),this.debouncedHandlers.delete(t.path)},this.DEBOUNCE_DELAY);this.debouncedHandlers.set(t.path,d)}async handleFileChanged(t,r){if(!this.initialized)return;this.clearFileFromIndexes(t.path),await this.waitForFreshData(t);let s=this.app.metadataCache.getFileCache(t);s!=null&&s.frontmatter&&this.isTaskFile(s.frontmatter)&&await this.indexTaskFile(t,s.frontmatter),this.trigger("file-updated",{path:t.path,file:t})}handleFileDeleted(t){this.initialized&&(this.clearFileFromIndexes(t),this.lastKnownTaskInfo.delete(t),this.lastKnownFrontmatter.delete(t),this.trigger("file-deleted",{path:t}))}async handleFileRenamed(t,r){if(!this.initialized)return;this.clearFileFromIndexes(r),this.lastKnownTaskInfo.delete(r),this.lastKnownFrontmatter.delete(r),await this.waitForFreshData(t);let s=this.app.metadataCache.getFileCache(t);if(s!=null&&s.frontmatter&&this.isTaskFile(s.frontmatter)){await this.indexTaskFile(t,s.frontmatter);let i=this.extractTaskInfoFromNative(t.path,s.frontmatter);this.setLastKnownTaskInfo(t.path,i),this.lastKnownFrontmatter.set(t.path,this.deepClone(s.frontmatter))}this.trigger("file-renamed",{oldPath:r,newPath:t.path,file:t})}async waitForFreshData(t,r=10){let s=Date.now();for(let a=0;a<r;a++)try{if(!await this.app.vault.adapter.stat(t.path))break;let l=this.app.metadataCache.getFileCache(t);if(l!=null&&l.frontmatter&&(this.extractTaskInfoFromNative(t.path,l.frontmatter)||!this.isTaskFile(l.frontmatter)))return;let c=Math.min(50*Math.pow(1.5,a),200);await new Promise(d=>setTimeout(d,c))}catch(o){await new Promise(l=>setTimeout(l,50))}let i=Date.now()-s;i>500&&console.debug(`MinimalNativeCache: Waited ${i}ms for fresh data on ${t.path}`)}async waitForFreshTaskData(t,r,s=10){let i=Date.now();for(let o=0;o<s;o++)try{let l=this.app.metadataCache.getFileCache(t);if(!(l!=null&&l.frontmatter)){let u=Math.min(50*Math.pow(1.5,o),200);await new Promise(h=>setTimeout(h,u));continue}let c=this.extractTaskInfoFromNative(t.path,l.frontmatter);if(c)if(r){let u=!0;for(let[h,f]of Object.entries(r))if(c[h]!==f){u=!1;break}if(u)return}else return;let d=Math.min(50*Math.pow(1.5,o),200);await new Promise(u=>setTimeout(u,d))}catch(l){await new Promise(c=>setTimeout(c,50))}let a=Date.now()-i;a>500&&console.debug(`MinimalNativeCache: Waited ${a}ms for fresh task data on ${t.path}`,r)}getLastKnownTaskInfo(t){return this.lastKnownTaskInfo.get(t)||null}setLastKnownTaskInfo(t,r){this.lastKnownTaskInfo.set(t,r)}taskInfoEquals(t,r){return t===null&&r===null?!0:t===null||r===null||!(t.title===r.title&&t.status===r.status&&t.priority===r.priority&&t.due===r.due&&t.scheduled===r.scheduled&&t.archived===r.archived&&t.completedDate===r.completedDate&&t.recurrence===r.recurrence&&t.timeEstimate===r.timeEstimate)?!1:this.arraysEqual(t.tags,r.tags)&&this.arraysEqual(t.contexts,r.contexts)&&this.arraysEqual(t.projects,r.projects)&&this.objectsEqual(t.timeEntries,r.timeEntries)&&this.objectsEqual(t.reminders,r.reminders)&&this.objectsEqual(t.complete_instances,r.complete_instances)}arraysEqual(t,r){if(t===r)return!0;if(!t||!r)return t===r;if(t.length!==r.length)return!1;if(t.length===0)return!0;if(typeof t[0]=="string"){let s=[...t].sort(),i=[...r].sort();return s.every((a,o)=>a===i[o])}return JSON.stringify(t)===JSON.stringify(r)}objectsEqual(t,r){return t===r?!0:!t||!r?t===r:JSON.stringify(t)===JSON.stringify(r)}frontmatterEquals(t,r){return t===r?!0:!t||!r?t===r:JSON.stringify(t)===JSON.stringify(r)}deepClone(t){return t===null||typeof t!="object"?t:JSON.parse(JSON.stringify(t))}extractTaskInfoFromNative(t,r){if(!this.fieldMapper)return null;try{let s=this.fieldMapper.mapFromFrontmatter(r,t,this.storeTitleInFilename),i=s.timeEntries?mn(s.timeEntries):0;return{id:t,title:s.title||"Untitled task",status:s.status||"open",priority:s.priority||"normal",due:s.due,scheduled:s.scheduled,path:t,archived:s.archived||!1,tags:Array.isArray(s.tags)?s.tags:[],contexts:Array.isArray(s.contexts)?s.contexts:[],projects:Array.isArray(s.projects)?s.projects:[],recurrence:s.recurrence,complete_instances:s.complete_instances,completedDate:s.completedDate,timeEstimate:s.timeEstimate,timeEntries:s.timeEntries,totalTrackedTime:i,dateCreated:s.dateCreated,dateModified:s.dateModified,reminders:s.reminders}}catch(s){return console.error(`Error extracting task info from native metadata for ${t}:`,s),null}}isValidFile(t){return!this.excludedFolders.some(r=>t.startsWith(r))}clearFileFromIndexes(t){for(let r of this.tasksByDate.values())r.delete(t);for(let r of this.tasksByStatus.values())r.delete(t);this.overdueTasks.delete(t)}clearAllIndexes(){this.tasksByDate.clear(),this.tasksByStatus.clear(),this.overdueTasks.clear()}updateConfig(t,r,s,i=!1,a=!1){this.taskTag=t,this.excludedFolders=r?r.split(",").map(o=>o.trim()):[],this.fieldMapper=s,this.disableNoteIndexing=i,this.storeTitleInFilename=a,this.initialized&&(this.clearAllIndexes(),this.indexesBuilt=!1)}clearCacheEntry(t){let r=this.app.vault.getAbstractFileByPath(t);if(r instanceof tn.TFile){let s=this.app.metadataCache.getFileCache(r);s!=null&&s.frontmatter&&this.isTaskFile(s.frontmatter)&&this.indexTaskFile(r,s.frontmatter)}}async clearAllCaches(){this.clearAllIndexes(),this.indexesBuilt=!1}updateTaskInfoInCache(t,r){this.indexesBuilt&&(this.clearFileFromIndexes(t),this.updateDateIndex(t,r),this.updateStatusIndex(t,r.status),this.updateOverdueIndex(t,r))}subscribe(t,r){return this.on(t,r),()=>this.off(t,r)}isInitialized(){return this.initialized}getStats(){return{indexSizes:{tasksByDate:this.tasksByDate.size,tasksByStatus:this.tasksByStatus.size,overdueTasks:this.overdueTasks.size},memoryFootprint:"Minimal - only essential indexes"}}destroy(){this.eventListeners.forEach(t=>{this.app.metadataCache.offref(t)}),this.eventListeners=[],this.debouncedHandlers.forEach(t=>clearTimeout(t)),this.debouncedHandlers.clear(),this.lastKnownTaskInfo.clear(),this.lastKnownFrontmatter.clear(),this.clearAllIndexes(),this.initialized=!1,this.indexesBuilt=!1}};var Wc=class{constructor(){this.inFlightRequests=new Map;this.prefetchQueue=new Set;this.prefetchPromises=new Map;this.activeTimeouts=new Set}async execute(e,t,r=5e3){if(this.inFlightRequests.has(e))return this.inFlightRequests.get(e);let s=this.createRequest(e,t,r);return this.inFlightRequests.set(e,s),s}async createRequest(e,t,r){try{let s=await t(),i=setTimeout(()=>{this.inFlightRequests.delete(e),this.activeTimeouts.delete(i)},r);return this.activeTimeouts.add(i),s}catch(s){throw this.inFlightRequests.delete(e),s}}prefetch(e,t,r="low"){if(!(this.inFlightRequests.has(e)||this.prefetchPromises.has(e)))if(r==="high")this.executePrefetch(e,t);else if(this.prefetchQueue.add(e),"requestIdleCallback"in window)requestIdleCallback(()=>{this.processPrefetchQueue(e,t)});else{let s=setTimeout(()=>{this.processPrefetchQueue(e,t),this.activeTimeouts.delete(s)},50);this.activeTimeouts.add(s)}}async executePrefetch(e,t){try{let r=t();this.prefetchPromises.set(e,r),await r;let s=setTimeout(()=>{this.prefetchPromises.delete(e),this.activeTimeouts.delete(s)},3e4);this.activeTimeouts.add(s)}catch(r){this.prefetchPromises.delete(e)}}processPrefetchQueue(e,t){this.prefetchQueue.has(e)&&(this.prefetchQueue.delete(e),this.executePrefetch(e,t))}getPrefetchedData(e){return this.prefetchPromises.get(e)||null}cancel(e){this.inFlightRequests.delete(e),this.prefetchPromises.delete(e),this.prefetchQueue.delete(e)}cancelAll(){this.inFlightRequests.clear(),this.prefetchPromises.clear(),this.prefetchQueue.clear();for(let e of this.activeTimeouts)clearTimeout(e);this.activeTimeouts.clear()}getStats(){return{inFlightCount:this.inFlightRequests.size,prefetchCount:this.prefetchPromises.size,queuedCount:this.prefetchQueue.size}}},_y=class{constructor(e){this.lastAccessTime=new Map;this.deduplicator=e}recordAccess(e,t,r){let s=this.getDateKey(e);this.lastAccessTime.set(s,Date.now()),this.prefetchAdjacentDates(e,t,r)}prefetchAdjacentDates(e,t,r){this.getAdjacentDates(e).forEach(({date:i,priority:a})=>{let o=`${t}-${this.getDateKey(i)}`;this.deduplicator.prefetch(o,()=>r(i),a)})}getAdjacentDates(e){let t=[],r=new Date(e);r.setDate(e.getDate()-1),t.push({date:r,priority:"high"});let s=new Date(e);s.setDate(e.getDate()+1),t.push({date:s,priority:"high"});for(let i=2;i<=7;i++){let a=new Date(e);a.setDate(e.getDate()-i),t.push({date:a,priority:"low"});let o=new Date(e);o.setDate(e.getDate()+i),t.push({date:o,priority:"low"})}return t}getDateKey(e){return e.toISOString().split("T")[0]}cleanup(){let e=Date.now(),t=1440*60*1e3;for(let[r,s]of this.lastAccessTime)e-s>t&&this.lastAccessTime.delete(r)}};var $c=class{constructor(){this.updateQueue=[];this.isProcessing=!1;this.activeTimeouts=new Set}scheduleUpdate(e){this.updateQueue.push(e),this.isProcessing||(this.isProcessing=!0,requestAnimationFrame(()=>{this.processUpdates()}))}processUpdates(){let e=[...this.updateQueue];this.updateQueue=[];try{e.forEach(t=>{try{t()}catch(r){console.error("Error processing DOM update:",r)}})}finally{this.isProcessing=!1,this.updateQueue.length>0&&requestAnimationFrame(()=>{this.processUpdates()})}}updateAttributes(e,t){for(let[r,s]of Object.entries(t))s===null?e.removeAttribute(r):e.getAttribute(r)!==s&&e.setAttribute(r,s)}updateClasses(e,t){for(let[r,s]of Object.entries(t))s?e.classList.add(r):e.classList.remove(r)}updateTextContent(e,t){e.textContent!==t&&(e.textContent=t)}updateStyles(e,t){for(let[r,s]of Object.entries(t))s===null?e.style.removeProperty(r):e.style.setProperty(r,s)}preserveState(e){let t={scrollTop:e.scrollTop,scrollLeft:e.scrollLeft,focused:document.activeElement===e,selection:null};return(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&(t.selection={start:e.selectionStart||0,end:e.selectionEnd||0}),t}restoreState(e,t){e.scrollTop=t.scrollTop,e.scrollLeft=t.scrollLeft,t.focused&&e.focus(),t.selection&&(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)&&e.setSelectionRange(t.selection.start,t.selection.end)}animateUpdate(e,t,r=1500){e.classList.add(`task-${t}`);let s=setTimeout(()=>{e.classList.remove(`task-${t}`),this.activeTimeouts.delete(s)},r);this.activeTimeouts.add(s)}updateList(e,t,r,s,i){let a=new Map,o=new Set;Array.from(e.children).forEach(d=>{let u=d.dataset.key;u&&(a.set(u,d),o.add(u))});let l=new Set(t.map(r)),c=document.createDocumentFragment();t.forEach(d=>{let u=r(d),h=a.get(u);if(h)i&&i(h,d),c.appendChild(h);else{let f=s(d);f.dataset.key=u,c.appendChild(f)}}),o.forEach(d=>{if(!l.has(d)){let u=a.get(d);u&&u.parentNode&&u.remove()}}),e.replaceChildren(c)}createOptimisticUpdate(e,t,r){return t(e),{commit:()=>{},revert:()=>{r(e)}}}destroy(){this.updateQueue=[],this.isProcessing=!1;for(let e of this.activeTimeouts)clearTimeout(e);this.activeTimeouts.clear()}},Ay=class{constructor(){this.stateMap=new Map}saveState(e,t){let r=new $c;this.stateMap.set(e,r.preserveState(t))}restoreState(e,t){let r=this.stateMap.get(e);r&&new $c().restoreState(t,r)}clearState(e){e?this.stateMap.delete(e):this.stateMap.clear()}destroy(){this.stateMap.clear()}};PT();pS();var Py=class n{constructor(e){this.priorities=e}getPriorityConfig(e){return this.priorities.find(t=>t.value===e)}getPrioritiesByWeight(){return[...this.priorities].sort((e,t)=>t.weight-e.weight)}getPrioritiesByWeightAsc(){return[...this.priorities].sort((e,t)=>e.weight-t.weight)}getNextPriority(e){var i;let t=this.getPrioritiesByWeightAsc(),r=t.findIndex(a=>a.value===e);if(r===-1)return((i=t[0])==null?void 0:i.value)||"normal";let s=(r+1)%t.length;return t[s].value}comparePriorities(e,t){let r=this.getPriorityConfig(e),s=this.getPriorityConfig(t),i=(r==null?void 0:r.weight)||0;return((s==null?void 0:s.weight)||0)-i}getPriorityStyles(){let e=[];for(let t of this.priorities){let r=`--priority-${t.value.replace(/[^a-zA-Z0-9-]/g,"-")}-color`;e.push(`${r}: ${t.color};`)}return`:root { ${e.join(" ")} }`}getAllPriorities(){return[...this.priorities]}updatePriorities(e){this.priorities=e}getHighestPriority(){var t;return(t=this.getPrioritiesByWeight()[0])==null?void 0:t.value}getLowestPriority(){var t;return(t=this.getPrioritiesByWeightAsc()[0])==null?void 0:t.value}getPriorityWeight(e){let t=this.getPriorityConfig(e);return(t==null?void 0:t.weight)||0}isHigherPriority(e,t){return this.comparePriorities(e,t)>0}static validatePriorities(e){let t=[];e.length<1&&t.push("At least 1 priority is required");let r=e.map(c=>c.value),s=new Set(r);r.length!==s.size&&t.push("Priority values must be unique");let i=e.map(c=>c.id),a=new Set(i);i.length!==a.size&&t.push("Priority IDs must be unique");let o=e.map(c=>c.weight),l=new Set(o);o.length!==l.size&&t.push("Priority weights must be unique");for(let c of e){if(!c.value||c.value.trim()===""){t.push("Priority values cannot be empty");break}if(!c.label||c.label.trim()===""){t.push("Priority labels cannot be empty");break}if(!c.color||!c.color.match(/^#[0-9a-fA-F]{6}$/)){t.push("Priority colors must be valid hex colors (#rrggbb)");break}if(typeof c.weight!="number"||c.weight<0){t.push("Priority weights must be non-negative numbers");break}}return{valid:t.length===0,errors:t}}static generatePriorityId(e){let t=new Set(e.map(i=>i.id)),r=1,s=`priority-${r}`;for(;t.has(s);)r++,s=`priority-${r}`;return s}static generatePriorityWeight(e){let t=e.map(r=>r.weight);return t.length===0?1:Math.max(...t)+1}static createDefaultPriority(e){let t=n.generatePriorityId(e),r=n.generatePriorityWeight(e);return{id:t,value:"new-priority",label:"New priority",color:"#808080",weight:r}}};var zt=require("obsidian");At();var vB=require("obsidian");function Iy(n,e){let t=m6(n),r=t.frontmatter?g6(t.frontmatter,e):{},s=y6(t.body,e);return{frontmatter:r,body:s}}function m6(n){var t,r;let e=n.split(`
`);if(((t=e[0])==null?void 0:t.trim())==="---"){let s=-1;for(let i=1;i<e.length;i++)if(((r=e[i])==null?void 0:r.trim())==="---"){s=i;break}if(s>0){let a=e.slice(1,s).join(`
`),l=e.slice(s+1).join(`
`);return{frontmatter:a.trim()||null,body:l}}}return{frontmatter:null,body:n}}function g6(n,e){try{let t=v6(n,e),r=(0,vB.parseYaml)(t);return typeof r!="object"||r===null?(console.warn("Template frontmatter did not parse to a valid object"),{}):r}catch(t){return console.error("Error processing template frontmatter:",t),{}}}function y6(n,e){return T6(n,e)}function v6(n,e){var d;let t=n,r=new Date,s=e.title||"",i=Zf(s)?`"${rl(s)}"`:s;t=t.replace(/\{\{title\}\}/g,i),t=t.replace(/\{\{priority\}\}/g,e.priority||""),t=t.replace(/\{\{status\}\}/g,e.status||"");let a=Array.isArray(e.contexts)?e.contexts.join(", "):"";t=t.replace(/\{\{contexts\}\}/g,a);let o=Array.isArray(e.tags)?e.tags.join(", "):"";t=t.replace(/\{\{tags\}\}/g,o),t=t.replace(/\{\{timeEstimate\}\}/g,((d=e.timeEstimate)==null?void 0:d.toString())||""),t=t.replace(/\{\{dueDate\}\}/g,e.dueDate||""),t=t.replace(/\{\{scheduledDate\}\}/g,e.scheduledDate||""),t=t.replace(/\{\{details\}\}/g,e.details||"");let l=e.parentNote||"",c=l?`"${rl(l)}"`:"";if(t=t.replace(/\{\{parentNote\}\}/g,c),t=t.replace(/\{\{date\}\}/g,x(r,"yyyy-MM-dd")),t=t.replace(/\{\{time\}\}/g,x(r,"HH:mm")),"icsEventTitle"in e){let u=e,h=u.icsEventTitle||"",f=Zf(h)?`"${rl(h)}"`:h;t=t.replace(/\{\{icsEventTitle\}\}/g,f),t=t.replace(/\{\{icsEventStart\}\}/g,u.icsEventStart||""),t=t.replace(/\{\{icsEventEnd\}\}/g,u.icsEventEnd||"");let p=u.icsEventLocation||"",m=p&&Zf(p)?`"${rl(p)}"`:p;t=t.replace(/\{\{icsEventLocation\}\}/g,m);let g=u.icsEventDescription||"",y=g&&Zf(g)?`"${rl(g)}"`:g;t=t.replace(/\{\{icsEventDescription\}\}/g,y),t=t.replace(/\{\{icsEventUrl\}\}/g,u.icsEventUrl||"");let T=u.icsEventSubscription||"",w=T&&Zf(T)?`"${rl(T)}"`:T;t=t.replace(/\{\{icsEventSubscription\}\}/g,w);let b=u.icsEventId||"",S=b?`"${rl(b)}"`:"";t=t.replace(/\{\{icsEventId\}\}/g,S)}return t}function Zf(n){if(!n)return!1;let e=/[[\]{}:>|*&!%#`@,]/,t=/^[-?]/,r=/^\d+\.?\d*$/,s=/^(true|false|yes|no|on|off)$/i;return e.test(n)||t.test(n)||r.test(n)||s.test(n)}function rl(n){return n?n.replace(/\\/g,"\\\\").replace(/"/g,'\\"'):""}function T6(n,e){var a;let t=n,r=new Date;t=t.replace(/\{\{title\}\}/g,e.title||""),t=t.replace(/\{\{priority\}\}/g,e.priority||""),t=t.replace(/\{\{status\}\}/g,e.status||"");let s=Array.isArray(e.contexts)?e.contexts.join(", "):"";t=t.replace(/\{\{contexts\}\}/g,s);let i=Array.isArray(e.tags)?e.tags.join(", "):"";if(t=t.replace(/\{\{tags\}\}/g,i),t=t.replace(/\{\{timeEstimate\}\}/g,((a=e.timeEstimate)==null?void 0:a.toString())||""),t=t.replace(/\{\{dueDate\}\}/g,e.dueDate||""),t=t.replace(/\{\{scheduledDate\}\}/g,e.scheduledDate||""),t=t.replace(/\{\{details\}\}/g,e.details||""),t=t.replace(/\{\{parentNote\}\}/g,e.parentNote||""),t=t.replace(/\{\{date\}\}/g,x(r,"yyyy-MM-dd")),t=t.replace(/\{\{time\}\}/g,x(r,"HH:mm")),"icsEventTitle"in e){let o=e;t=t.replace(/\{\{icsEventTitle\}\}/g,o.icsEventTitle||""),t=t.replace(/\{\{icsEventStart\}\}/g,o.icsEventStart||""),t=t.replace(/\{\{icsEventEnd\}\}/g,o.icsEventEnd||""),t=t.replace(/\{\{icsEventLocation\}\}/g,o.icsEventLocation||""),t=t.replace(/\{\{icsEventDescription\}\}/g,o.icsEventDescription||""),t=t.replace(/\{\{icsEventUrl\}\}/g,o.icsEventUrl||""),t=t.replace(/\{\{icsEventSubscription\}\}/g,o.icsEventSubscription||""),t=t.replace(/\{\{icsEventId\}\}/g,o.icsEventId||"")}return t}function TB(n,e){return{...e,...n}}Lt();Fe();At();var Ry=class{constructor(e){this.plugin=e}setWebhookNotifier(e){this.webhookNotifier=e}setAutoArchiveService(e){this.autoArchiveService=e}processFolderTemplate(e,t,r=new Date){if(!e)return e;let s=e;if(t){let o=Array.isArray(t.contexts)&&t.contexts.length>0?t.contexts[0]:"";s=s.replace(/\{\{context\}\}/g,o);let l=Array.isArray(t.projects)&&t.projects.length>0?t.projects[0]:"";s=s.replace(/\{\{project\}\}/g,l);let c=t.priority||"";s=s.replace(/\{\{priority\}\}/g,c);let d=t.status||"";s=s.replace(/\{\{status\}\}/g,d);let u=t.title?t.title.replace(/[<>:"/\\|?*]/g,"_"):"";s=s.replace(/\{\{title\}\}/g,u);let h=t.due||"";s=s.replace(/\{\{dueDate\}\}/g,h);let f=t.scheduled||"";s=s.replace(/\{\{scheduledDate\}\}/g,f);let p=c?c.substring(0,1).toUpperCase():"";s=s.replace(/\{\{priorityShort\}\}/g,p);let m=d?d.substring(0,1).toUpperCase():"";s=s.replace(/\{\{statusShort\}\}/g,m);let g=u?u.toLowerCase():"";s=s.replace(/\{\{titleLower\}\}/g,g);let y=u?u.toUpperCase():"";s=s.replace(/\{\{titleUpper\}\}/g,y);let T=u?u.toLowerCase().replace(/\s+/g,"_"):"";s=s.replace(/\{\{titleSnake\}\}/g,T);let w=u?u.toLowerCase().replace(/\s+/g,"-"):"";s=s.replace(/\{\{titleKebab\}\}/g,w);let b=u?u.replace(/(?:^\w|[A-Z]|\b\w)/g,(k,D)=>D===0?k.toLowerCase():k.toUpperCase()).replace(/\s+/g,""):"";s=s.replace(/\{\{titleCamel\}\}/g,b);let S=u?u.replace(/(?:^\w|[A-Z]|\b\w)/g,k=>k.toUpperCase()).replace(/\s+/g,""):"";s=s.replace(/\{\{titlePascal\}\}/g,S)}s=s.replace(/\{\{year\}\}/g,x(r,"yyyy")),s=s.replace(/\{\{month\}\}/g,x(r,"MM")),s=s.replace(/\{\{day\}\}/g,x(r,"dd")),s=s.replace(/\{\{date\}\}/g,x(r,"yyyy-MM-dd")),s=s.replace(/\{\{time\}\}/g,x(r,"HHmmss")),s=s.replace(/\{\{timestamp\}\}/g,x(r,"yyyy-MM-dd-HHmmss")),s=s.replace(/\{\{dateTime\}\}/g,x(r,"yyyy-MM-dd-HHmm")),s=s.replace(/\{\{hour\}\}/g,x(r,"HH")),s=s.replace(/\{\{minute\}\}/g,x(r,"mm")),s=s.replace(/\{\{second\}\}/g,x(r,"ss")),s=s.replace(/\{\{shortDate\}\}/g,x(r,"yyMMdd")),s=s.replace(/\{\{monthName\}\}/g,x(r,"MMMM")),s=s.replace(/\{\{monthNameShort\}\}/g,x(r,"MMM")),s=s.replace(/\{\{dayName\}\}/g,x(r,"EEEE")),s=s.replace(/\{\{dayNameShort\}\}/g,x(r,"EEE")),s=s.replace(/\{\{week\}\}/g,x(r,"ww")),s=s.replace(/\{\{quarter\}\}/g,x(r,"q")),s=s.replace(/\{\{time12\}\}/g,x(r,"hh:mm a")),s=s.replace(/\{\{time24\}\}/g,x(r,"HH:mm")),s=s.replace(/\{\{hourPadded\}\}/g,x(r,"HH")),s=s.replace(/\{\{hour12\}\}/g,x(r,"hh")),s=s.replace(/\{\{ampm\}\}/g,x(r,"a")),s=s.replace(/\{\{unix\}\}/g,Math.floor(r.getTime()/1e3).toString()),s=s.replace(/\{\{unixMs\}\}/g,r.getTime().toString()),s=s.replace(/\{\{milliseconds\}\}/g,x(r,"SSS")),s=s.replace(/\{\{ms\}\}/g,x(r,"SSS")),s=s.replace(/\{\{timezone\}\}/g,x(r,"xxx")),s=s.replace(/\{\{timezoneShort\}\}/g,x(r,"xx")),s=s.replace(/\{\{utcOffset\}\}/g,x(r,"xxx")),s=s.replace(/\{\{utcOffsetShort\}\}/g,x(r,"xx")),s=s.replace(/\{\{utcZ\}\}/g,"Z");let i=(()=>{let o=x(r,"yyMMdd"),l=new Date(r);l.setHours(0,0,0,0);let d=Math.floor((r.getTime()-l.getTime())/1e3).toString(36);return`${o}${d}`})();s=s.replace(/\{\{zettel\}\}/g,i);let a=Date.now().toString()+Math.random().toString(36).substring(2,7);return s=s.replace(/\{\{nano\}\}/g,a),s}async createTask(e){var t;try{if(!e.title||!e.title.trim())throw new Error("Title is required");let r=e.title.trim(),s=e.priority||this.plugin.settings.defaultTaskPriority,i=e.status||this.plugin.settings.defaultTaskStatus,a=e.dateCreated||Le(),o=e.dateModified||Le(),l=e.contexts||[],c=e.projects||[],d=e.tags||[];this.plugin.settings.taskIdentificationMethod==="tag"&&(d.includes(this.plugin.settings.taskTag)||(d=[this.plugin.settings.taskTag,...d]));let u={title:r,priority:s,status:i,date:new Date,dueDate:e.due,scheduledDate:e.scheduled},h=kg(u,this.plugin.settings),f="";if(e.creationContext==="inline-conversion"){let M=this.plugin.settings.inlineTaskConvertFolder||"";if(M.trim()){if(M.includes("{{currentNotePath}}")){let _=this.plugin.app.workspace.getActiveFile(),W=((t=_==null?void 0:_.parent)==null?void 0:t.path)||"";f=M.replace(/\{\{currentNotePath\}\}/g,W)}else f=M;f=this.processFolderTemplate(f,e)}else{let _=this.plugin.settings.tasksFolder||"";f=this.processFolderTemplate(_,e)}}else{let M=this.plugin.settings.tasksFolder||"";f=this.processFolderTemplate(M,e)}f&&await Fl(this.plugin.app.vault,f);let p=await Mu(h,f,this.plugin.app.vault),m=f?`${f}/${p}.md`:`${p}.md`,g={title:r,status:i,priority:s,due:e.due||void 0,scheduled:e.scheduled||void 0,contexts:l.length>0?l:void 0,projects:c.length>0?c:void 0,timeEstimate:e.timeEstimate&&e.timeEstimate>0?e.timeEstimate:void 0,dateCreated:a,dateModified:o,recurrence:e.recurrence||void 0,reminders:e.reminders&&e.reminders.length>0?e.reminders:void 0,icsEventId:e.icsEventId||void 0},y=this.plugin.fieldMapper.mapToFrontmatter(g,this.plugin.settings.taskTag,this.plugin.settings.storeTitleInFilename);if(this.plugin.settings.taskIdentificationMethod==="property"){let M=this.plugin.settings.taskPropertyName,_=this.plugin.settings.taskPropertyValue;if(M&&_){let j=_.toLowerCase(),R=j==="true"||j==="false"?j==="true":_;y[M]=R}let W=d.filter(j=>j!==this.plugin.settings.taskTag);W.length>0&&(y.tags=W)}else y.tags=d;let T=await this.applyTemplate(e),w=TB(y,T.frontmatter);e.customFrontmatter&&(w={...w,...e.customFrontmatter});let S=`---
${(0,zt.stringifyYaml)(w)}---

`;T.body&&T.body.trim()&&(S+=`${T.body.trim()}

`);let k=await this.plugin.app.vault.create(m,S),D={...g,...w,title:w.title||g.title||r,status:w.status||g.status||i,priority:w.priority||g.priority||s,path:k.path,tags:d,archived:!1};try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(k,{title:D.title}),this.plugin.cacheManager.updateTaskInfoInCache(k.path,D)}catch(M){console.error("Error updating cache for new task:",M)}if(this.plugin.emitter.trigger(tt,{path:k.path,updatedTask:D}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("task.created",{task:D})}catch(M){console.warn("Failed to trigger webhook for task creation:",M)}return{file:k,taskInfo:D}}catch(r){let s=r instanceof Error?r.message:String(r);throw console.error("Error creating task:",{error:s,stack:r instanceof Error?r.stack:void 0,taskData:e}),new Error(`Failed to create task: ${s}`)}}async applyTemplate(e){var r,s,i,a;let t=this.plugin.settings.taskCreationDefaults;if(!t.useBodyTemplate||!((r=t.bodyTemplate)!=null&&r.trim()))return{frontmatter:{},body:((s=e.details)==null?void 0:s.trim())||""};try{let o=(0,zt.normalizePath)(t.bodyTemplate.trim());o.endsWith(".md")||(o+=".md");let l=this.plugin.app.vault.getAbstractFileByPath(o);if(l instanceof zt.TFile){let c=await this.plugin.app.vault.read(l),d={title:e.title||"",priority:e.priority||"",status:e.status||"",contexts:Array.isArray(e.contexts)?e.contexts:[],tags:Array.isArray(e.tags)?e.tags:[],timeEstimate:e.timeEstimate||0,dueDate:e.due||"",scheduledDate:e.scheduled||"",details:e.details||"",parentNote:e.parentNote||""};return Iy(c,d)}else return console.warn(`Task body template not found: ${o}`),new zt.Notice(`Task body template not found: ${o}`),{frontmatter:{},body:((i=e.details)==null?void 0:i.trim())||""}}catch(o){return console.error("Error reading task body template:",o),new zt.Notice(`Error reading task body template: ${t.bodyTemplate}`),{frontmatter:{},body:((a=e.details)==null?void 0:a.trim())||""}}}async toggleStatus(e){try{let r=this.plugin.statusManager.isCompletedStatus(e.status)?this.plugin.settings.defaultTaskStatus:this.plugin.statusManager.getCompletedStatuses()[0]||"done";return await this.updateProperty(e,"status",r)}catch(t){let r=t instanceof Error?t.message:String(t);throw console.error("Error toggling task status:",{error:r,stack:t instanceof Error?t.stack:void 0,taskPath:e.path,currentStatus:e.status}),new Error(`Failed to toggle task status: ${r}`)}}async updateProperty(e,t,r,s={}){try{let i=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(i instanceof zt.TFile))throw new Error(`Cannot find task file: ${e.path}`);let a=await this.plugin.cacheManager.getTaskInfo(e.path)||e,o={...a};o[t]=r,o.dateModified=Le(),t==="status"&&!a.recurrence&&(this.plugin.statusManager.isCompletedStatus(r)?o.completedDate=Vp():o.completedDate=void 0),await this.plugin.app.fileManager.processFrontMatter(i,l=>{let c=this.plugin.fieldMapper.toUserField(t);if(t==="status"){let u=String(r).toLowerCase(),h=u==="true"||u==="false"?u==="true":r;if(l[c]=h,!a.recurrence){let f=this.plugin.fieldMapper.toUserField("completedDate");this.plugin.statusManager.isCompletedStatus(r)?l[f]=Vp():l[f]&&delete l[f]}}else(t==="due"||t==="scheduled")&&!r?delete l[c]:l[c]=r;let d=this.plugin.fieldMapper.toUserField("dateModified");l[d]=o.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(i,{[t]:r}),await this.plugin.cacheManager.updateTaskInfoInCache(e.path,o)}catch(l){console.error("Error updating task cache:",{error:l instanceof Error?l.message:String(l),taskPath:e.path})}try{this.plugin.emitter.trigger(tt,{path:e.path,originalTask:e,updatedTask:o})}catch(l){console.error("Error emitting task update event:",{error:l instanceof Error?l.message:String(l),taskPath:e.path})}if(this.webhookNotifier)try{let l=this.plugin.statusManager.isCompletedStatus(e.status),c=t==="status"&&this.plugin.statusManager.isCompletedStatus(r);t==="status"&&!l&&c?await this.webhookNotifier.triggerWebhook("task.completed",{task:o}):await this.webhookNotifier.triggerWebhook("task.updated",{task:o,previous:e})}catch(l){console.warn("Failed to trigger webhook for property update:",l)}if(this.autoArchiveService&&t==="status"&&r!==e.status)try{let l=this.plugin.statusManager.getStatusConfig(r);l&&(l.autoArchive?await this.autoArchiveService.scheduleAutoArchive(o,l):await this.autoArchiveService.cancelAutoArchive(o.path))}catch(l){console.warn("Failed to handle auto-archive for status property change:",l)}return o}catch(i){let a=i instanceof Error?i.message:String(i);throw console.error("Error updating task property:",{error:a,stack:i instanceof Error?i.stack:void 0,taskPath:e.path,property:String(t),value:r}),new Error(`Failed to update task property: ${a}`)}}async toggleArchive(e){var o,l;let t=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(t instanceof zt.TFile))throw new Error(`Cannot find task file: ${e.path}`);let r=this.plugin.fieldMapper.getMapping().archiveTag,s=e.archived,i={...e};i.archived=!s,i.dateModified=Le(),i.tags||(i.tags=[]),s?i.tags=i.tags.filter(c=>c!==r):i.tags.includes(r)||(i.tags=[...i.tags,r]),await this.plugin.app.fileManager.processFrontMatter(t,c=>{let d=this.plugin.fieldMapper.toUserField("dateModified");s?c.tags&&Array.isArray(c.tags)&&(c.tags=c.tags.filter(u=>u!==r),c.tags.length===0&&delete c.tags):(c.tags?Array.isArray(c.tags)||(c.tags=[c.tags]):c.tags=[],c.tags.includes(r)||c.tags.push(r)),c[d]=i.dateModified});let a=t;if(this.plugin.settings.moveArchivedTasks)try{if(!s&&((o=this.plugin.settings.archiveFolder)!=null&&o.trim())){let c=this.plugin.settings.archiveFolder.trim();await Fl(this.plugin.app.vault,c);let d=`${c}/${t.name}`;if(this.plugin.app.vault.getAbstractFileByPath(d))throw new Error(`A file named "${t.name}" already exists in the archive folder "${c}". Cannot move task to avoid overwriting existing file.`);await this.plugin.app.fileManager.renameFile(t,d),a=this.plugin.app.vault.getAbstractFileByPath(d),i.path=d,this.plugin.cacheManager.clearCacheEntry(e.path)}else if(s&&((l=this.plugin.settings.tasksFolder)!=null&&l.trim())){let c=this.plugin.settings.tasksFolder.trim();await Fl(this.plugin.app.vault,c);let d=`${c}/${t.name}`;if(this.plugin.app.vault.getAbstractFileByPath(d))throw new Error(`A file named "${t.name}" already exists in the tasks folder "${c}". Cannot move task to avoid overwriting existing file.`);await this.plugin.app.fileManager.renameFile(t,d),a=this.plugin.app.vault.getAbstractFileByPath(d),i.path=d,this.plugin.cacheManager.clearCacheEntry(e.path)}}catch(c){let d=c instanceof Error?c.message:String(c),u=s?"unarchiving":"archiving";console.error(`Error moving ${u} task:`,d),new zt.Notice(`Failed to move ${u} task: ${d}`)}try{a instanceof zt.TFile&&this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(a,{archived:i.archived}),await this.plugin.cacheManager.updateTaskInfoInCache(i.path,i)}catch(c){console.error("Error updating cache for archived task:",c)}if(this.plugin.emitter.trigger(tt,{path:i.path,originalTask:e,updatedTask:i}),this.webhookNotifier)try{i.archived?await this.webhookNotifier.triggerWebhook("task.archived",{task:i}):await this.webhookNotifier.triggerWebhook("task.unarchived",{task:i})}catch(c){console.warn("Failed to trigger webhook for task archive/unarchive:",c)}return i}async startTimeTracking(e){var a;let t=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(t instanceof zt.TFile))throw new Error(`Cannot find task file: ${e.path}`);if(this.plugin.getActiveTimeSession(e))throw new Error("Time tracking is already active for this task");let s={...e};s.dateModified=Le(),s.timeEntries||(s.timeEntries=[]);let i={startTime:Le(),description:"Work session"};s.timeEntries=[...s.timeEntries,i],await this.plugin.app.fileManager.processFrontMatter(t,o=>{let l=this.plugin.fieldMapper.toUserField("timeEntries"),c=this.plugin.fieldMapper.toUserField("dateModified");o[l]||(o[l]=[]),o[l].push(i),o[c]=s.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(t,{timeEntries:s.timeEntries}),await this.plugin.cacheManager.updateTaskInfoInCache(e.path,s)}catch(o){console.error("Error updating cache for time tracking start:",o)}if(this.plugin.emitter.trigger(tt,{path:e.path,originalTask:e,updatedTask:s}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("time.started",{task:s,session:(a=s.timeEntries)==null?void 0:a[s.timeEntries.length-1]})}catch(o){console.warn("Failed to trigger webhook for time tracking start:",o)}return s}async stopTimeTracking(e){var i;let t=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(t instanceof zt.TFile))throw new Error(`Cannot find task file: ${e.path}`);let r=this.plugin.getActiveTimeSession(e);if(!r)throw new Error("No active time tracking session for this task");let s={...e};if(s.dateModified=Le(),s.timeEntries&&Array.isArray(s.timeEntries)){let a=s.timeEntries.findIndex(o=>o.startTime===r.startTime&&!o.endTime);a!==-1&&(s.timeEntries=[...s.timeEntries],s.timeEntries[a]={...s.timeEntries[a],endTime:Le()})}await this.plugin.app.fileManager.processFrontMatter(t,a=>{let o=this.plugin.fieldMapper.toUserField("timeEntries"),l=this.plugin.fieldMapper.toUserField("dateModified");if(a[o]&&Array.isArray(a[o])){let c=a[o].findIndex(d=>d.startTime===r.startTime&&!d.endTime);c!==-1&&(a[o][c].endTime=Le())}a[l]=s.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(t,{timeEntries:s.timeEntries}),await this.plugin.cacheManager.updateTaskInfoInCache(e.path,s)}catch(a){console.error("Error updating cache for time tracking stop:",a)}if(this.plugin.emitter.trigger(tt,{path:e.path,originalTask:e,updatedTask:s}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("time.stopped",{task:s,session:(i=s.timeEntries)==null?void 0:i[s.timeEntries.length-1]})}catch(a){console.warn("Failed to trigger webhook for time tracking stop:",a)}return s}async updateTask(e,t){try{let r=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(r instanceof zt.TFile))throw new Error(`Cannot find task file: ${e.path}`);let s=this.plugin.settings.storeTitleInFilename&&t.title&&t.title!==e.title,i=e.path;if(s){let l=r.parent?r.parent.path:"",c=await Mu(t.title,l,this.plugin.app.vault);i=l?`${l}/${c}.md`:`${c}.md`}let a={};if(t.recurrence!==void 0&&t.recurrence!==e.recurrence){let l={...e,...t},c=Nd(l,this.plugin.settings.maintainDueDateOffsetInRecurring);if(c.scheduled&&(a.scheduled=c.scheduled),c.due&&(a.due=c.due),typeof t.recurrence=="string"&&t.recurrence&&!t.recurrence.includes("DTSTART:")){let d={...e,...t,...a},u=Od(d);u&&(a.recurrence=u)}}else if(t.recurrence!==void 0&&!e.recurrence&&t.recurrence&&typeof t.recurrence=="string"&&!t.recurrence.includes("DTSTART:")){let l={...e,...t},c=Od(l);c&&(a.recurrence=c)}if(t.scheduled!==void 0&&t.scheduled!==e.scheduled&&e.recurrence&&typeof e.recurrence=="string"&&!e.recurrence.includes("DTSTART:")){let l={...e,...t},c=Od(l);c&&(a.recurrence=c)}await this.plugin.app.fileManager.processFrontMatter(r,l=>{let c={...e,...t,...a,dateModified:Le()},d=this.plugin.fieldMapper.mapToFrontmatter(c,this.plugin.settings.taskTag,this.plugin.settings.storeTitleInFilename);Object.keys(d).forEach(u=>{d[u]!==void 0&&(l[u]=d[u])}),t.customFrontmatter&&Object.keys(t.customFrontmatter).forEach(u=>{let h=t.customFrontmatter[u];h===null?delete l[u]:l[u]=h}),t.hasOwnProperty("due")&&t.due===void 0&&delete l[this.plugin.fieldMapper.toUserField("due")],t.hasOwnProperty("scheduled")&&t.scheduled===void 0&&delete l[this.plugin.fieldMapper.toUserField("scheduled")],t.hasOwnProperty("contexts")&&t.contexts===void 0&&delete l[this.plugin.fieldMapper.toUserField("contexts")],t.hasOwnProperty("timeEstimate")&&t.timeEstimate===void 0&&delete l[this.plugin.fieldMapper.toUserField("timeEstimate")],t.hasOwnProperty("completedDate")&&t.completedDate===void 0&&delete l[this.plugin.fieldMapper.toUserField("completedDate")],t.hasOwnProperty("recurrence")&&t.recurrence===void 0&&delete l[this.plugin.fieldMapper.toUserField("recurrence")],s&&delete l[this.plugin.fieldMapper.toUserField("title")],t.hasOwnProperty("tags")?l.tags=t.tags:e.tags&&(l.tags=e.tags)}),s&&await this.plugin.app.fileManager.renameFile(r,i);let o={...e,...t,...a,path:i,dateModified:Le()};t.status!==void 0&&!e.recurrence&&(this.plugin.statusManager.isCompletedStatus(t.status)?e.completedDate||(o.completedDate=Vp()):o.completedDate=void 0),s&&this.plugin.cacheManager.clearCacheEntry(e.path);try{let l=this.plugin.app.vault.getAbstractFileByPath(i);if(l instanceof zt.TFile&&this.plugin.cacheManager.waitForFreshTaskData){let c={};t.title!==void 0&&(c.title=t.title),t.status!==void 0&&(c.status=t.status),t.priority!==void 0&&(c.priority=t.priority),Object.keys(c).length>0&&await this.plugin.cacheManager.waitForFreshTaskData(l,c)}await this.plugin.cacheManager.updateTaskInfoInCache(i,o)}catch(l){console.error("Error updating task cache:",{error:l instanceof Error?l.message:String(l),taskPath:i})}try{this.plugin.emitter.trigger(tt,{path:i,originalTask:e,updatedTask:o})}catch(l){console.error("Error emitting task update event:",{error:l instanceof Error?l.message:String(l),taskPath:i})}if(this.webhookNotifier)try{let l=this.plugin.statusManager.isCompletedStatus(e.status),c=this.plugin.statusManager.isCompletedStatus(o.status);!l&&c?await this.webhookNotifier.triggerWebhook("task.completed",{task:o}):await this.webhookNotifier.triggerWebhook("task.updated",{task:o,previous:e})}catch(l){console.warn("Failed to trigger webhook for task update:",l)}if(this.autoArchiveService&&t.status!==void 0&&t.status!==e.status)try{let l=this.plugin.statusManager.getStatusConfig(o.status);l&&(l.autoArchive?await this.autoArchiveService.scheduleAutoArchive(o,l):await this.autoArchiveService.cancelAutoArchive(o.path))}catch(l){console.warn("Failed to handle auto-archive for status change:",l)}return o}catch(r){let s=r instanceof Error?r.message:String(r);throw console.error("Error updating task:",{error:s,stack:r instanceof Error?r.stack:void 0,taskPath:e.path,updates:t}),new Error(`Failed to update task: ${s}`)}}async deleteTask(e){try{let t=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(t instanceof zt.TFile))throw new Error(`Cannot find task file: ${e.path}`);if(await this.plugin.app.vault.delete(t),this.plugin.cacheManager.clearCacheEntry(e.path),this.plugin.emitter.trigger(Bp,{path:e.path,deletedTask:e}),this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("task.deleted",{task:e})}catch(r){console.warn("Failed to trigger webhook for task deletion:",r)}}catch(t){let r=t instanceof Error?t.message:String(t);throw console.error("Error deleting task:",{error:r,stack:t instanceof Error?t.stack:void 0,taskPath:e.path}),new Error(`Failed to delete task: ${r}`)}}async toggleRecurringTaskComplete(e,t){let r=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(r instanceof zt.TFile))throw new Error(`Cannot find task file: ${e.path}`);let s=await this.plugin.cacheManager.getTaskInfo(e.path)||e;if(!s.recurrence)throw new Error("Task is not recurring");let i=t||(()=>{let h=Ge();return wt(h)})(),a=me(i),o=Array.isArray(s.complete_instances)?s.complete_instances:[],c=!o.includes(a),d={...s};if(d.dateModified=Le(),c?o.includes(a)||(d.complete_instances=[...o,a]):d.complete_instances=o.filter(h=>h!==a),c&&typeof d.recurrence=="string"&&!d.recurrence.includes("DTSTART:")){let h=Od(d);h&&(d.recurrence=h)}let u=Nd(d,this.plugin.settings.maintainDueDateOffsetInRecurring);u.scheduled&&(d.scheduled=u.scheduled),u.due&&(d.due=u.due),await this.plugin.app.fileManager.processFrontMatter(r,h=>{let f=this.plugin.fieldMapper.toUserField("completeInstances"),p=this.plugin.fieldMapper.toUserField("dateModified"),m=this.plugin.fieldMapper.toUserField("scheduled"),g=this.plugin.fieldMapper.toUserField("due"),y=this.plugin.fieldMapper.toUserField("recurrence");h[f]||(h[f]=[]);let T=h[f];c?T.includes(a)||(h[f]=[...T,a]):h[f]=T.filter(w=>w!==a),d.recurrence!==s.recurrence&&(h[y]=d.recurrence),d.scheduled&&(h[m]=d.scheduled),d.due&&(h[g]=d.due),h[p]=d.dateModified});try{if(this.plugin.cacheManager.waitForFreshTaskData){let h={complete_instances:d.complete_instances};d.scheduled!==s.scheduled&&(h.scheduled=d.scheduled),d.due!==s.due&&(h.due=d.due),await this.plugin.cacheManager.waitForFreshTaskData(r,h)}await this.plugin.cacheManager.updateTaskInfoInCache(s.path,d)}catch(h){console.error("Error updating cache for recurring task:",h)}if(this.plugin.emitter.trigger(tt,{path:s.path,originalTask:s,updatedTask:d}),c&&this.webhookNotifier)try{await this.webhookNotifier.triggerWebhook("recurring.instance.completed",{task:d,date:a,targetDate:i})}catch(h){console.error("Error triggering recurring task completion webhook:",h)}return d}async deleteTimeEntry(e,t){let r=this.plugin.app.vault.getAbstractFileByPath(e.path);if(!(r instanceof zt.TFile))throw new Error(`Cannot find task file: ${e.path}`);if(!e.timeEntries||!Array.isArray(e.timeEntries))throw new Error("Task has no time entries");if(t<0||t>=e.timeEntries.length)throw new Error("Invalid time entry index");let s={...e};s.dateModified=Le(),s.timeEntries=e.timeEntries.filter((i,a)=>a!==t),await this.plugin.app.fileManager.processFrontMatter(r,i=>{let a=this.plugin.fieldMapper.toUserField("timeEntries"),o=this.plugin.fieldMapper.toUserField("dateModified");i[a]&&Array.isArray(i[a])&&(i[a]=i[a].filter((l,c)=>c!==t)),i[o]=s.dateModified});try{this.plugin.cacheManager.waitForFreshTaskData&&await this.plugin.cacheManager.waitForFreshTaskData(r,{timeEntries:s.timeEntries}),await this.plugin.cacheManager.updateTaskInfoInCache(e.path,s)}catch(i){console.error("Error updating cache for time entry deletion:",i)}return this.plugin.emitter.trigger(tt,{path:e.path,originalTask:e,updatedTask:s}),s}};var Ny=class{constructor(e){this.processorInterval=null;this.PROCESSOR_INTERVAL_MS=6e4;this.plugin=e}async start(){await this.processQueue(),this.processorInterval=setInterval(()=>{this.processQueue().catch(e=>{console.error("Error processing auto-archive queue:",e)})},this.PROCESSOR_INTERVAL_MS)}stop(){this.processorInterval&&(clearInterval(this.processorInterval),this.processorInterval=null)}async scheduleAutoArchive(e,t){if(!t.autoArchive)return;let r=Date.now(),s=r+t.autoArchiveDelay*60*1e3,i={taskPath:e.path,statusChangeTimestamp:r,archiveAfterTimestamp:s,statusValue:t.value};await this.cancelAutoArchive(e.path);let a=await this.getQueue();a.push(i),await this.saveQueue(a)}async cancelAutoArchive(e){let t=await this.getQueue(),r=t.filter(s=>s.taskPath!==e);r.length!==t.length&&await this.saveQueue(r)}async processQueue(){let e=await this.getQueue();if(e.length===0)return;let t=Date.now(),r=[],s=[];for(let o of e)t>=o.archiveAfterTimestamp?r.push(o):s.push(o);if(r.length===0)return;let i=[];for(let o of r)try{await this.processItem(o)||i.push(o)}catch(l){console.error(`Error processing auto-archive for ${o.taskPath}:`,l),i.push(o)}let a=[...i,...s];await this.saveQueue(a)}async processItem(e){let t=await this.plugin.cacheManager.getTaskByPath(e.taskPath);if(!t||t.status!==e.statusValue||t.archived)return!0;try{return await this.plugin.taskService.toggleArchive(t),!0}catch(r){return console.error(`Failed to archive task ${e.taskPath}:`,r),!1}}async getQueue(){let e=await this.plugin.loadData();return(e==null?void 0:e.autoArchiveQueue)||[]}async saveQueue(e){let t=await this.plugin.loadData()||{};t.autoArchiveQueue=e,await this.plugin.saveData(t)}async clearQueue(){await this.saveQueue([])}async getQueueStatus(){let e=await this.getQueue();return{count:e.length,items:e}}};var Oy=class extends ri{constructor(t,r){super();this.filterState={};this.viewPreferences={};this.savedViews=[];this.storageKey="tasknotes-view-filter-state";this.preferencesStorageKey="tasknotes-view-preferences";this.savedViewsStorageKey="tasknotes-saved-views";this.app=t,this.plugin=r,this.loadFromStorage(),this.loadPreferencesFromStorage(),this.savedViews=[...this.plugin.settings.savedViews]}async initializeSavedViews(){await this.migrateAndLoadSavedViews()}getFilterState(t){let r=this.filterState[t];if(r){if(typeof r!="object"||r.type!=="group"||!Array.isArray(r.children)||typeof r.conjunction!="string"){console.warn(`ViewStateManager: Ignoring old format filter state for ${t}, will use default`),delete this.filterState[t],this.saveToStorage();return}return Pe.deepCloneFilterQuery(r)}}setFilterState(t,r){this.filterState[t]=Pe.deepCloneFilterQuery(r),this.saveToStorage(),this.emit("filter-state-changed",{viewType:t,query:Pe.deepCloneFilterQuery(r)})}clearFilterState(t){delete this.filterState[t],this.saveToStorage(),this.emit("filter-state-cleared",{viewType:t})}clearAllFilterStates(){this.filterState={},this.saveToStorage(),this.emit("all-filter-states-cleared")}getViewPreferences(t){return this.viewPreferences[t]}setViewPreferences(t,r){this.viewPreferences[t]={...r},this.savePreferencesToStorage(),this.emit("view-preferences-changed",{viewType:t,preferences:r})}clearViewPreferences(t){delete this.viewPreferences[t],this.savePreferencesToStorage(),this.emit("view-preferences-cleared",{viewType:t})}clearAllViewPreferences(){this.viewPreferences={},this.savePreferencesToStorage(),this.emit("all-view-preferences-cleared")}loadFromStorage(){try{let t=this.app.loadLocalStorage(this.storageKey);t&&typeof t=="string"&&(this.filterState=JSON.parse(t))}catch(t){console.warn("Failed to load view filter state from storage:",t),this.filterState={}}}saveToStorage(){try{this.app.saveLocalStorage(this.storageKey,JSON.stringify(this.filterState))}catch(t){console.warn("Failed to save view filter state to storage:",t)}}loadPreferencesFromStorage(){try{let t=this.app.loadLocalStorage(this.preferencesStorageKey);t&&typeof t=="string"&&(this.viewPreferences=JSON.parse(t))}catch(t){console.warn("Failed to load view preferences from storage:",t),this.viewPreferences={}}}savePreferencesToStorage(){try{this.app.saveLocalStorage(this.preferencesStorageKey,JSON.stringify(this.viewPreferences))}catch(t){console.warn("Failed to save view preferences to storage:",t)}}getAllFilterStates(){return{...this.filterState}}getSavedViews(){return this.savedViews.map(t=>({...t,query:Pe.deepCloneFilterQuery(t.query),viewOptions:t.viewOptions?{...t.viewOptions}:void 0}))}saveView(t,r,s,i){let a={id:this.generateId(),name:t,query:Pe.deepCloneFilterQuery(r),viewOptions:s?{...s}:void 0,visibleProperties:i?[...i]:void 0};return this.savedViews.push(a),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews()),a}updateView(t,r){let s=this.savedViews.findIndex(a=>a.id===t);if(s===-1)throw new Error(`Saved view with ID ${t} not found`);let i={...r};i.query&&(i.query=Pe.deepCloneFilterQuery(i.query)),i.viewOptions&&(i.viewOptions={...i.viewOptions}),this.savedViews[s]={...this.savedViews[s],...i},this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}deleteView(t){let r=this.savedViews.findIndex(s=>s.id===t);if(r===-1)throw new Error(`Saved view with ID ${t} not found`);this.savedViews.splice(r,1),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}getSavedView(t){let r=this.savedViews.find(s=>s.id===t);if(r)return{...r,query:Pe.deepCloneFilterQuery(r.query),viewOptions:r.viewOptions?{...r.viewOptions}:void 0,visibleProperties:r.visibleProperties?[...r.visibleProperties]:void 0}}clearAllSavedViews(){this.savedViews=[],this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}updateSavedViewProperties(t,r){let s=this.savedViews.find(i=>i.id===t);s&&(s.visibleProperties=r,this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews()))}getSavedViewProperties(t){let r=this.savedViews.find(s=>s.id===t);return r==null?void 0:r.visibleProperties}reorderSavedViews(t,r){if(t<0||t>=this.savedViews.length||r<0||r>this.savedViews.length||t===r)return;r=Math.min(r,this.savedViews.length-1);let[s]=this.savedViews.splice(t,1);this.savedViews.splice(r,0,s),this.saveSavedViewsToPluginData(),this.emit("saved-views-changed",this.getSavedViews())}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2,9)}async migrateAndLoadSavedViews(){try{this.savedViews=[...this.plugin.settings.savedViews];let t=this.app.loadLocalStorage(this.savedViewsStorageKey);if(t&&typeof t=="string"&&this.savedViews.length===0){console.log("TaskNotes: Migrating saved views from localStorage to plugin data...");let r=JSON.parse(t);this.savedViews=[...r],await this.saveSavedViewsToPluginData(),this.app.saveLocalStorage(this.savedViewsStorageKey,null),console.log(`TaskNotes: Successfully migrated ${r.length} saved views to plugin data.`)}}catch(t){console.warn("Failed to load/migrate saved views:",t),this.savedViews=[]}}async saveSavedViewsToPluginData(){try{this.plugin.settings.savedViews=[...this.savedViews],await this.plugin.saveSettings()}catch(t){console.warn("Failed to save saved views to plugin data:",t)}}needsMigration(){let r=!!this.app.loadLocalStorage(this.savedViewsStorageKey),s=this.plugin.settings.savedViews&&this.plugin.settings.savedViews.length>0;return r&&!s}async performMigration(){try{this.clearAllFilterStates(),await this.migrateAndLoadSavedViews(),this.emit("migration-complete")}catch(t){console.error("Error during ViewStateManager migration:",t),this.savedViews=[],await this.saveSavedViewsToPluginData()}}cleanup(){this.removeAllListeners()}};Ly();gS();var vS=class{constructor(e){this.plugin=e}createPostProcessor(){return(e,t)=>{if(!this.plugin.settings.enableTaskLinkOverlay)return;let r=e.querySelectorAll("a");for(let s of Array.from(r)){let i=s,a=i.getAttribute("href");i.classList.contains("internal-link")?this.processLink(i,t.sourcePath,"internal"):a&&!a.startsWith("http://")&&!a.startsWith("https://")&&!a.includes("://")&&this.processLink(i,t.sourcePath,"external")}}}async processLink(e,t,r){try{let s=e.getAttribute("href");if(!s)return;let i=s;if(r==="internal"){if(s.startsWith("app://")){let l=new URL(s);i=decodeURIComponent(l.pathname),i.startsWith("/")&&(i=i.substring(1))}}else{if(s.startsWith("http://")||s.startsWith("https://")||s.includes("://"))return;i=s}let a=this.resolveLinkPath(i,t);if(!a)return;let o=this.getTaskInfo(a);if(!o)return;await this.replaceWithTaskWidget(e,o,i)}catch(s){console.debug("Error processing link in reading mode:",s)}}resolveLinkPath(e,t){try{let r=e.replace(/\.\./g,"").trim();if(!r)return null;let s=this.plugin.app.metadataCache.getFirstLinkpathDest(r,t);return(s==null?void 0:s.path)||null}catch(r){return console.debug("Error resolving link path:",e,r),null}}getTaskInfo(e){try{if(!e||typeof e!="string"||e.trim().length===0)return null;let t=this.plugin.cacheManager;if(!t||!t.getCachedTaskInfoSync)return null;let r=t.getCachedTaskInfoSync(e);return r&&typeof r=="object"&&r.title?r:null}catch(t){return console.debug("Error getting task info for:",e,t),null}}async replaceWithTaskWidget(e,t,r){var s;try{let i=e.textContent||`[[${r}]]`,a,o=e.textContent||"";o!==r&&o!==t.title&&(a=o);let l=new Vc(t,this.plugin,i,a),c=this.createReadingModeWidget(l,t,i,a);(s=e.parentNode)==null||s.replaceChild(c,e)}catch(i){console.error("Error replacing wikilink with task widget:",i)}}createReadingModeWidget(e,t,r,s){let i={},a=e.toDOM(i);return a.classList.add("task-inline-preview--reading-mode"),a}};function EB(n){return new vS(n).createPostProcessor()}var zc=require("@codemirror/view");var rn=require("obsidian"),By=require("@codemirror/state");var SB=require("obsidian"),Yc=class{constructor(e){this.plugin=e}async getTasksLinkedToProject(e){try{let t=await this.plugin.cacheManager.getAllTasks(),r=e.basename,s=e.path;return t.filter(i=>!i.projects||i.projects.length===0?!1:i.projects.some(a=>{if(!a||typeof a!="string"||a.trim()==="")return!1;if(a.startsWith("[[")&&a.endsWith("]]")){let l=a.slice(2,-2).trim();if(!l)return!1;let c=this.plugin.app.metadataCache.getFirstLinkpathDest(l,"");return c&&c.path===e.path?!0:l===r||l===s}let o=String(a).trim();return o===r||o===s}))}catch(t){return console.error("Error getting tasks linked to project:",t),[]}}async isTaskUsedAsProject(e){try{let t=this.plugin.app.vault.getAbstractFileByPath(e);return t instanceof SB.TFile?(await this.getTasksLinkedToProject(t)).length>0:!1}catch(t){return console.error("Error checking if task is used as project:",t),!1}}sortTasks(e){return e.sort((t,r)=>{let s=this.plugin.statusManager.isCompletedStatus(t.status),i=this.plugin.statusManager.isCompletedStatus(r.status);if(s!==i)return s?1:-1;let a=this.plugin.priorityManager.getPriorityWeight(t.priority),o=this.plugin.priorityManager.getPriorityWeight(r.priority);return a!==o?o-a:t.due&&r.due?new Date(t.due).getTime()-new Date(r.due).getTime():t.due?-1:r.due?1:t.title.localeCompare(r.title)})}};Sn();var TS=By.StateEffect.define(),wS=class extends zc.WidgetType{constructor(t,r,s,i=0){super();this.plugin=t;this.tasks=r;this.notePath=s;this.version=i;this.groupedTasks=new Map;this.filterBar=null;this.filterHeading=null;this.savedViewsUnsubscribe=null;this.taskListContainer=null;this.editorView=null;this.viewType=`${rA}:${s}`,this.groupedTasks.set("all",[...r]),this.filterService=new Oa(t.cacheManager,t.statusManager,t.priorityManager,t);let a=this.plugin.viewStateManager.getFilterState(this.viewType);this.currentQuery=a||{type:"group",id:"root",conjunction:"and",children:[],sortKey:"priority",sortDirection:"desc",groupKey:"none"}}eq(t){let r=this.tasks.length===t.tasks.length&&this.tasks.every((s,i)=>{let a=t.tasks[i];return s.title===a.title&&s.status===a.status&&s.priority===a.priority&&s.due===a.due&&s.scheduled===a.scheduled&&s.path===a.path&&JSON.stringify(s.contexts||[])===JSON.stringify(a.contexts||[])&&JSON.stringify(s.projects||[])===JSON.stringify(a.projects||[])&&JSON.stringify(s.tags||[])===JSON.stringify(a.tags||[])&&s.timeEstimate===a.timeEstimate&&s.recurrence===a.recurrence&&JSON.stringify(s.complete_instances||[])===JSON.stringify(a.complete_instances||[])});return r&&this!==t&&this.notePath===t.notePath&&(t.currentQuery=this.currentQuery),this.version===t.version&&r}destroy(){this.filterBar&&(this.filterBar.destroy(),this.filterBar=null),this.filterHeading&&(this.filterHeading.destroy(),this.filterHeading=null),this.savedViewsUnsubscribe&&(this.savedViewsUnsubscribe(),this.savedViewsUnsubscribe=null)}toDOM(t){this.editorView=t;let r=document.createElement("div");r.className="tasknotes-plugin project-note-subtasks project-subtasks-widget",r.setAttribute("contenteditable","false"),r.setAttribute("spellcheck","false"),r.setAttribute("data-widget-type","project-subtasks");let s=r.createEl("div",{cls:"project-note-subtasks__header"}),i=s.createEl("h3",{cls:"project-note-subtasks__title"});i.createSpan({text:"Subtasks"}),s.createEl("button",{text:"New",cls:"project-note-subtasks__new-btn"}).addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),this.createNewSubtask()});let o=r.createEl("div",{cls:"project-note-subtasks__content"});this.getCollapsedState()&&(i.classList.add("collapsed"),o.classList.add("collapsed")),i.addEventListener("click",d=>{d.preventDefault(),d.stopPropagation(),i.classList.contains("collapsed")?(i.classList.remove("collapsed"),o.classList.remove("collapsed"),this.setCollapsedState(!1)):(i.classList.add("collapsed"),o.classList.add("collapsed"),this.setCollapsedState(!0))});let c=o.createEl("div",{cls:"project-note-subtasks__filter"});return this.taskListContainer=o.createEl("div",{cls:"project-note-subtasks__list"}),this.initializeFilterBar(c).then(()=>{this.taskListContainer&&this.applyFiltersAndRender(this.taskListContainer)}),this.renderTaskGroups(this.taskListContainer),r}async initializeFilterBar(t){try{let r=await this.filterService.getFilterOptions();this.filterBar=new Xs(this.plugin.app,this.plugin,t,this.currentQuery,r,this.plugin.settings.viewsButtonAlignment||"right",{enableGroupExpandCollapse:!1,forceShowExpandCollapse:!1,viewType:"subtask-widget"});let s=this.plugin.viewStateManager.getSavedViews();this.filterBar.updateSavedViews(s),this.filterBar.on("queryChange",a=>{this.currentQuery=a,this.plugin.viewStateManager.setFilterState(this.viewType,a);let o=t.querySelector(".filter-heading__controls");o&&this.createExpandCollapseButtons(o),this.taskListContainer&&this.applyFiltersAndRender(this.taskListContainer)}),this.filterBar.on("activeSavedViewChanged",()=>{this.editorView&&Xf(this.editorView)}),this.filterBar.on("saveView",a=>{let o=this.plugin.viewStateManager.saveView(a.name,a.query,a.viewOptions,a.visibleProperties);this.filterBar.setActiveSavedView(o)}),this.filterBar.on("deleteView",a=>{this.plugin.viewStateManager.deleteView(a)}),this.filterBar.on("reorderViews",(a,o)=>{this.plugin.viewStateManager.reorderSavedViews(a,o)}),this.savedViewsUnsubscribe=this.plugin.viewStateManager.on("saved-views-changed",a=>{this.filterBar&&this.filterBar.updateSavedViews(a)}),this.filterBar.on("expandAllGroups",()=>{let a=this.currentQuery.groupKey||"none";wr.expandAllGroups(this.viewType,a,this.plugin),this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(o=>{o.classList.remove("is-collapsed");let l=o.querySelector(".task-cards");l&&(l.style.display="")})}),this.filterBar.on("collapseAllGroups",()=>{let a=this.currentQuery.groupKey||"none",o=[];this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(l=>{let c=l.dataset.group;if(c){o.push(c),l.classList.add("is-collapsed");let d=l.querySelector(".task-cards");d&&(d.style.display="none")}}),wr.collapseAllGroups(this.viewType,a,o,this.plugin)}),this.filterHeading=new Na(t);let i=t.querySelector(".filter-heading");if(i){let a=i.querySelector(".filter-heading__content");if(a){let o=a.createDiv({cls:"filter-heading__controls"});this.createExpandCollapseButtons(o)}}this.updateFilterHeading()}catch(r){console.error("Error initializing filter bar for subtasks:",r)}}createExpandCollapseButtons(t){if(!((this.currentQuery.groupKey||"none")!=="none")){t.style.display="none";return}t.style.display="flex",t.empty(),new rn.ButtonComponent(t).setIcon("list-tree").setTooltip("Expand All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none";this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(o=>{o.classList.remove("is-collapsed");let l=o.querySelector(".task-cards");l&&(l.style.display="")}),wr.expandAllGroups(this.viewType,a,this.plugin)}).buttonEl.addClass("clickable-icon"),new rn.ButtonComponent(t).setIcon("list-collapse").setTooltip("Collapse All Groups").setClass("task-view-control-button").onClick(()=>{let a=this.currentQuery.groupKey||"none",o=[];this.taskListContainer&&this.taskListContainer.querySelectorAll(".task-group").forEach(l=>{let c=l.dataset.group;if(c){o.push(c),l.classList.add("is-collapsed");let d=l.querySelector(".task-cards");d&&(d.style.display="none")}}),wr.collapseAllGroups(this.viewType,a,o,this.plugin)}).buttonEl.addClass("clickable-icon")}updateFilterHeading(){if(!(!this.filterHeading||!this.filterBar))try{let t=Array.from(this.groupedTasks.values()).flat(),r=xt.calculateGroupStats(t,this.plugin),s=this.filterBar.activeSavedView||null;this.filterHeading.update(s,r.completed,r.total)}catch(t){console.error("Error updating filter heading in ProjectSubtasksWidget:",t)}}async applyFiltersAndRender(t){try{let r=await this.filterService.getGroupedTasks(this.currentQuery),s=new Set(this.tasks.map(i=>i.path));this.groupedTasks.clear();for(let[i,a]of r){let o=a.filter(l=>s.has(l.path));o.length>0&&this.groupedTasks.set(i,o)}t&&this.renderTaskGroups(t),this.updateFilterHeading()}catch(r){console.error("Error applying filters to subtasks:",r),this.groupedTasks.clear(),this.groupedTasks.set("all",[...this.tasks]),this.updateFilterHeading()}}renderTaskGroups(t){var s,i;if(t.empty(),this.currentQuery.groupKey==="none"||this.groupedTasks.size<=1)(this.groupedTasks.size===1?Array.from(this.groupedTasks.values())[0]:this.groupedTasks.get("all")||[]).forEach(o=>{let l=cr(o,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1});l.classList.add("project-note-subtasks__task"),t.appendChild(l)});else for(let[a,o]of this.groupedTasks.entries()){if(o.length===0)continue;let l=t.createEl("div",{cls:"project-note-subtasks__group-section task-group"});l.setAttribute("data-group",a);let c=this.currentQuery.groupKey||"none",d=wr.isGroupCollapsed(this.viewType,c,a,this.plugin),u=l.createEl("div",{cls:"project-note-subtasks__group-header task-group-header"}),h=u.createEl("button",{cls:"task-group-toggle",attr:{"aria-label":"Toggle group"}});try{(0,rn.setIcon)(h,"chevron-right")}catch(y){}let f=h.querySelector("svg");f?(f.classList.add("chevron"),f.setAttr("width","16"),f.setAttr("height","16")):(h.textContent="\u25B8",h.addClass("chevron-text"));let p=u.createEl("h4",{cls:"project-note-subtasks__group-title"});p.createSpan({text:this.getGroupDisplayName(a)});let m=xt.calculateGroupStats(o,this.plugin);p.createSpan({text:` ${xt.formatGroupCount(m.completed,m.total).text}`,cls:"agenda-view__item-count"});let g=l.createEl("div",{cls:"project-note-subtasks__group task-cards"});d&&(l.classList.add("is-collapsed"),g.style.display="none"),u.addEventListener("click",y=>{if(y.target.closest("a"))return;let w=!l.classList.contains("is-collapsed");wr.setGroupCollapsed(this.viewType,c,a,w,this.plugin),l.classList.toggle("is-collapsed",w),g.style.display=w?"none":"",h.setAttribute("aria-expanded",String(!w))}),h.addEventListener("click",y=>{y.preventDefault(),y.stopPropagation();let T=!l.classList.contains("is-collapsed");wr.setGroupCollapsed(this.viewType,c,a,T,this.plugin),l.classList.toggle("is-collapsed",T),g.style.display=T?"none":"",h.setAttribute("aria-expanded",String(!T))}),h.setAttribute("aria-expanded",String(!d)),o.forEach(y=>{let T=cr(y,this.plugin,this.plugin.settings.defaultVisibleProperties,{showDueDate:!0,showCheckbox:!1,showArchiveButton:!1,showTimeTracking:!1,showRecurringControls:!0,groupByDate:!1});T.classList.add("project-note-subtasks__task"),g.appendChild(T)})}let r=(i=(s=t.parentElement)==null?void 0:s.parentElement)==null?void 0:i.querySelector(".project-note-subtasks__title");if(r){r.empty(),r.createSpan({text:"Subtasks "});let a=Array.from(this.groupedTasks.values()).flat(),o=xt.calculateGroupStats(a,this.plugin);r.createSpan({text:xt.formatGroupCount(o.completed,o.total).text,cls:"agenda-view__item-count"})}}getGroupDisplayName(t){return wr.formatGroupName(t,this.plugin)}createNewSubtask(){let t=this.plugin.app.workspace.getActiveFile();if(!t)return;let r=`[[${t.basename}]]`;this.plugin.openTaskCreationModal({projects:[r]})}getCollapsedState(){try{return localStorage.getItem("tasknotes-project-subtasks-collapsed")==="true"}catch(t){return!1}}setCollapsedState(t){try{t?localStorage.setItem("tasknotes-project-subtasks-collapsed","true"):localStorage.removeItem("tasknotes-project-subtasks-collapsed")}catch(r){}}},bS=class{constructor(e,t){this.plugin=t;this.cachedTasks=[];this.currentFile=null;this.eventListeners=[];this.version=0;this.view=e,this.projectService=new Yc(t),this.decorations=this.buildDecorations(e),this.setupEventListeners(),this.loadTasksForCurrentFile(e)}update(e){this.view=e.view;let t=e.transactions.some(s=>s.effects.some(i=>i.is(TS)));(e.docChanged||e.viewportChanged||t)&&(t&&this.version++,this.decorations=this.buildDecorations(e.view));let r=this.getFileFromView(e.view);r!==this.currentFile&&(this.currentFile=r,this.loadTasksForCurrentFile(e.view))}destroy(){this.eventListeners.forEach(e=>{this.plugin.emitter.offref(e)}),this.eventListeners=[]}setupEventListeners(){let e=this.plugin.emitter.on(fr,()=>{this.loadTasksForCurrentFile(this.view)}),t=this.plugin.emitter.on(tt,()=>{this.loadTasksForCurrentFile(this.view)}),r=this.plugin.emitter.on(Bp,()=>{this.loadTasksForCurrentFile(this.view)}),s=this.plugin.emitter.on(pn,()=>{this.loadTasksForCurrentFile(this.view)}),i=this.plugin.emitter.on("settings-changed",()=>{this.loadTasksForCurrentFile(this.view)}),a=this.plugin.emitter.on("file-updated",c=>{this.loadTasksForCurrentFile(this.view)}),o=this.plugin.emitter.on("file-deleted",c=>{this.loadTasksForCurrentFile(this.view)}),l=this.plugin.emitter.on("file-renamed",c=>{this.loadTasksForCurrentFile(this.view)});this.eventListeners.push(e,t,r,s,i,a,o,l)}dispatchUpdate(){if(this.version++,this.view&&typeof this.view.dispatch=="function")try{this.view.dispatch({effects:[TS.of({forceUpdate:!0})]})}catch(e){console.error("Error dispatching project subtasks update:",e)}}async loadTasksForCurrentFile(e){let t=this.getFileFromView(e);if(t instanceof rn.TFile)try{let r=await this.projectService.getTasksLinkedToProject(t);(r.length!==this.cachedTasks.length||r.some((i,a)=>{let o=this.cachedTasks[a];return!o||i.title!==o.title||i.status!==o.status||i.priority!==o.priority||i.due!==o.due||i.path!==o.path}))&&(this.cachedTasks=r,this.dispatchUpdate())}catch(r){console.error("Error loading tasks for project note:",r)}else this.cachedTasks.length>0&&(this.cachedTasks=[],this.dispatchUpdate())}getFileFromView(e){let t=e.state.field(rn.editorInfoField,!1);return(t==null?void 0:t.file)||null}isTableCellEditor(e){try{let t=e.dom;if(t.closest("td, th")||t.closest(".cm-table-widget"))return!0;let i=e.state.field(rn.editorInfoField,!1);if(!(i!=null&&i.file)){let a=t.parentElement;for(;a&&a!==document.body;){if(a.tagName==="TABLE"||a.tagName==="TD"||a.tagName==="TH"||a.classList.contains("markdown-rendered"))return!0;a=a.parentElement}}return!1}catch(t){return console.debug("Error detecting table cell editor:",t),!1}}buildDecorations(e){var r;let t=new By.RangeSetBuilder;try{if(this.isTableCellEditor(e)||!this.plugin.settings.showProjectSubtasks||!e.state.field(rn.editorLivePreviewField)||this.cachedTasks.length===0)return t.finish();let s=e.state.doc;if(s.length===0)return t.finish();let i=this.findInsertionPosition(e,s);(i<0||i>s.length)&&(i=0);let a=(r=this.currentFile)==null?void 0:r.path;if(!a){let l=this.getFileFromView(e);a=l==null?void 0:l.path}if(!a)return console.warn("ProjectNoteDecorations: Cannot create widget without file context"),t.finish();let o=zc.Decoration.widget({widget:new wS(this.plugin,this.cachedTasks,a,this.version),side:1});t.add(i,i,o)}catch(s){console.error("Error building project note decorations:",s)}return t.finish()}findInsertionPosition(e,t){if(t.lines===0)return 0;if((this.plugin.settings.projectSubtasksPosition||"bottom")==="top"){let s=t.toString(),a=/^---\n[\s\S]*?\n---\n/.exec(s);return a?a[0].length:0}else return t.length}},C6={decorations:n=>n.decorations};function DB(n){return zc.ViewPlugin.fromClass(class extends bS{constructor(e){super(e,n)}destroy(){super.destroy()}},C6)}function Xf(n){if(!n||typeof n.dispatch!="function"){console.warn("Invalid EditorView passed to dispatchProjectSubtasksUpdate:",n);return}try{n.dispatch({effects:[TS.of({forceUpdate:!0})]})}catch(e){console.error("Error dispatching project subtasks update:",e)}}var Hy=class{constructor(e){this.draggableInstances=new Map;this.plugin=e}makeTaskCardDraggable(e,t){if(this.draggableInstances.has(e))return;e.dataset.taskPath=t;let r=new yg(e);this.draggableInstances.set(e,r),e.style.cursor="grab",e.addEventListener("dragstart",s=>{e.classList.add("task-card--dragging"),s.dataTransfer&&(s.dataTransfer.setData("text/plain",t),s.dataTransfer.setData("application/x-task-path",t),s.dataTransfer.effectAllowed="copy")}),e.addEventListener("dragend",()=>{e.classList.remove("task-card--dragging")})}removeDraggable(e){let t=this.draggableInstances.get(e);t&&(t.destroy(),this.draggableInstances.delete(e))}destroy(){this.draggableInstances.forEach(e=>{e.destroy()}),this.draggableInstances.clear()}};Fe();var zi=require("obsidian");var zy=class n{constructor(e){I(this,"icaltype","binary");this.value=e}static fromString(e){return new n(e)}decodeValue(){return this._b64_decode(this.value)}setEncodedValue(e){this.value=this._b64_encode(e)}_b64_encode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,s,i,a,o,l,c,d,u=0,h=0,f="",p=[];if(!e)return e;do r=e.charCodeAt(u++),s=e.charCodeAt(u++),i=e.charCodeAt(u++),d=r<<16|s<<8|i,a=d>>18&63,o=d>>12&63,l=d>>6&63,c=d&63,p[h++]=t.charAt(a)+t.charAt(o)+t.charAt(l)+t.charAt(c);while(u<e.length);f=p.join("");let m=e.length%3;return(m?f.slice(0,m-3):f)+"===".slice(m||3)}_b64_decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,s,i,a,o,l,c,d,u=0,h=0,f="",p=[];if(!e)return e;e+="";do a=t.indexOf(e.charAt(u++)),o=t.indexOf(e.charAt(u++)),l=t.indexOf(e.charAt(u++)),c=t.indexOf(e.charAt(u++)),d=a<<18|o<<12|l<<6|c,r=d>>16&255,s=d>>8&255,i=d&255,l==64?p[h++]=String.fromCharCode(r):c==64?p[h++]=String.fromCharCode(r,s):p[h++]=String.fromCharCode(r,s,i);while(u<e.length);return f=p.join(""),f}toString(){return this.value}},x6=/([PDWHMTS]{1,1})/,M6=["weeks","days","hours","minutes","seconds","isNegative"],Ps=class n{constructor(e){I(this,"weeks",0);I(this,"days",0);I(this,"hours",0);I(this,"minutes",0);I(this,"seconds",0);I(this,"isNegative",!1);I(this,"icalclass","icalduration");I(this,"icaltype","duration");this.wrappedJSObject=this,this.fromData(e)}static fromSeconds(e){return new n().fromSeconds(e)}static isValueString(e){return e[0]==="P"||e[1]==="P"}static fromString(e){let t=0,r=Object.create(null),s=0;for(;(t=e.search(x6))!==-1;){let i=e[t],a=e.slice(0,Math.max(0,t));e=e.slice(t+1),s+=_6(i,a,r)}if(s<2)throw new Error('invalid duration value: Not enough duration components in "'+e+'"');return new n(r)}static fromData(e){return new n(e)}clone(){return n.fromData(this)}toSeconds(){let e=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-e:e}fromSeconds(e){let t=Math.abs(e);return this.isNegative=e<0,this.days=ur(t/86400),this.days%7==0?(this.weeks=this.days/7,this.days=0):this.weeks=0,t-=(this.days+7*this.weeks)*86400,this.hours=ur(t/3600),t-=this.hours*3600,this.minutes=ur(t/60),t-=this.minutes*60,this.seconds=t,this}fromData(e){for(let t of M6)e&&t in e?this[t]=e[t]:this[t]=0}reset(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0}compare(e){let t=this.toSeconds(),r=e.toSeconds();return(t>r)-(t<r)}normalize(){this.fromSeconds(this.toSeconds())}toString(){if(this.toSeconds()==0)return"PT0S";{let e="";this.isNegative&&(e+="-"),e+="P";let t=!1;return this.weeks?this.days||this.hours||this.minutes||this.seconds?e+=this.weeks*7+this.days+"D":(e+=this.weeks+"W",t=!0):this.days&&(e+=this.days+"D"),t||(this.hours||this.minutes||this.seconds)&&(e+="T",this.hours&&(e+=this.hours+"H"),this.minutes&&(e+=this.minutes+"M"),this.seconds&&(e+=this.seconds+"S")),e}}toICALString(){return this.toString()}};function _6(n,e,t){let r;switch(n){case"P":e&&e==="-"?t.isNegative=!0:t.isNegative=!1;break;case"D":r="days";break;case"W":r="weeks";break;case"H":r="hours";break;case"M":r="minutes";break;case"S":r="seconds";break;default:return 0}if(r){if(!e&&e!==0)throw new Error('invalid duration value: Missing number before "'+n+'"');let s=parseInt(e,10);if(rp(s))throw new Error('invalid duration value: Invalid number "'+e+'" before "'+n+'"');t[r]=s}return 1}var tp=class n{constructor(e){I(this,"start",null);I(this,"end",null);I(this,"duration",null);I(this,"icalclass","icalperiod");I(this,"icaltype","period");if(this.wrappedJSObject=this,e&&"start"in e){if(e.start&&!(e.start instanceof oe))throw new TypeError(".start must be an instance of ICAL.Time");this.start=e.start}if(e&&e.end&&e.duration)throw new Error("cannot accept both end and duration");if(e&&"end"in e){if(e.end&&!(e.end instanceof oe))throw new TypeError(".end must be an instance of ICAL.Time");this.end=e.end}if(e&&"duration"in e){if(e.duration&&!(e.duration instanceof Ps))throw new TypeError(".duration must be an instance of ICAL.Duration");this.duration=e.duration}}static fromString(e,t){let r=e.split("/");if(r.length!==2)throw new Error('Invalid string value: "'+e+'" must contain a "/" char.');let s={start:oe.fromDateTimeString(r[0],t)},i=r[1];return Ps.isValueString(i)?s.duration=Ps.fromString(i):s.end=oe.fromDateTimeString(i,t),new n(s)}static fromData(e){return new n(e)}static fromJSON(e,t,r){function s(i,a){return r?oe.fromString(i,a):oe.fromDateTimeString(i,a)}return Ps.isValueString(e[1])?n.fromData({start:s(e[0],t),duration:Ps.fromString(e[1])}):n.fromData({start:s(e[0],t),end:s(e[1],t)})}clone(){return n.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})}getDuration(){return this.duration?this.duration:this.end.subtractDate(this.start)}getEnd(){if(this.end)return this.end;{let e=this.start.clone();return e.addDuration(this.duration),e}}compare(e){return e.compare(this.start)<0?1:e.compare(this.getEnd())>0?-1:0}toString(){return this.start+"/"+(this.end||this.duration)}toJSON(){return[this.start.toString(),(this.end||this.duration).toString()]}toICALString(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}},Gc,ee=class ee{constructor(e,t){I(this,"icalclass","icaltime");I(this,"_cachedUnixTime",null);I(this,"zone",null);I(this,"_pendingNormalization",!1);this.wrappedJSObject=this,this._time=Object.create(null),this._time.year=0,this._time.month=1,this._time.day=1,this._time.hour=0,this._time.minute=0,this._time.second=0,this._time.isDate=!1,this.fromData(e,t)}static daysInMonth(e,t){let r=[0,31,28,31,30,31,30,31,31,30,31,30,31],s=30;return e<1||e>12||(s=r[e],e==2&&(s+=ee.isLeapYear(t))),s}static isLeapYear(e){return e<=1752?e%4==0:e%4==0&&e%100!=0||e%400==0}static fromDayOfYear(e,t){let r=t,s=e,i=new ee;i.auto_normalize=!1;let a=ee.isLeapYear(r)?1:0;if(s<1)return r--,a=ee.isLeapYear(r)?1:0,s+=ee.daysInYearPassedMonth[a][12],ee.fromDayOfYear(s,r);if(s>ee.daysInYearPassedMonth[a][12])return a=ee.isLeapYear(r)?1:0,s-=ee.daysInYearPassedMonth[a][12],r++,ee.fromDayOfYear(s,r);i.year=r,i.isDate=!0;for(let o=11;o>=0;o--)if(s>ee.daysInYearPassedMonth[a][o]){i.month=o+1,i.day=s-ee.daysInYearPassedMonth[a][o];break}return i.auto_normalize=!0,i}static fromStringv2(e){return new ee({year:parseInt(e.slice(0,4),10),month:parseInt(e.slice(5,7),10),day:parseInt(e.slice(8,10),10),isDate:!0})}static fromDateString(e){return new ee({year:Nr(e.slice(0,4)),month:Nr(e.slice(5,7)),day:Nr(e.slice(8,10)),isDate:!0})}static fromDateTimeString(e,t){if(e.length<19)throw new Error('invalid date-time value: "'+e+'"');let r,s;e.slice(-1)==="Z"?r=ot.utcTimezone:t&&(s=t.getParameter("tzid"),t.parent&&(t.parent.name==="standard"||t.parent.name==="daylight"?r=ot.localTimezone:s&&(r=t.parent.getTimeZoneByID(s))));let i={year:Nr(e.slice(0,4)),month:Nr(e.slice(5,7)),day:Nr(e.slice(8,10)),hour:Nr(e.slice(11,13)),minute:Nr(e.slice(14,16)),second:Nr(e.slice(17,19))};return s&&!r&&(i.timezone=s),new ee(i,r)}static fromString(e,t){return e.length>10?ee.fromDateTimeString(e,t):ee.fromDateString(e)}static fromJSDate(e,t){return new ee().fromJSDate(e,t)}static now(){return ee.fromJSDate(new Date,!1)}static weekOneStarts(e,t){let r=ee.fromData({year:e,month:1,day:1,isDate:!0}),s=r.dayOfWeek(),i=t||ee.DEFAULT_WEEK_START;return s>ee.THURSDAY&&(r.day+=7),i>ee.THURSDAY&&(r.day-=7),r.day-=s-i,r}static getDominicalLetter(e){let t="GFEDCBA",r=(e+(e/4|0)+(e/400|0)-(e/100|0)-1)%7;return ee.isLeapYear(e)?t[(r+6)%7]+t[r]:t[r]}static get epochTime(){return Ya(this,Gc)||mp(this,Gc,ee.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"})),Ya(this,Gc)}static _cmp_attr(e,t,r){return e[r]>t[r]?1:e[r]<t[r]?-1:0}get icaltype(){return this.isDate?"date":"date-time"}get year(){return this._getTimeAttr("year")}set year(e){this._setTimeAttr("year",e)}get month(){return this._getTimeAttr("month")}set month(e){this._setTimeAttr("month",e)}get day(){return this._getTimeAttr("day")}set day(e){this._setTimeAttr("day",e)}get hour(){return this._getTimeAttr("hour")}set hour(e){this._setTimeAttr("hour",e)}get minute(){return this._getTimeAttr("minute")}set minute(e){this._setTimeAttr("minute",e)}get second(){return this._getTimeAttr("second")}set second(e){this._setTimeAttr("second",e)}get isDate(){return this._getTimeAttr("isDate")}set isDate(e){this._setTimeAttr("isDate",e)}_getTimeAttr(e){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[e]}_setTimeAttr(e,t){e==="isDate"&&t&&!this._time.isDate&&this.adjust(0,0,0,0),this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[e]=t}clone(){return new ee(this._time,this.zone)}reset(){this.fromData(ee.epochTime),this.zone=ot.utcTimezone}resetTo(e,t,r,s,i,a,o){this.fromData({year:e,month:t,day:r,hour:s,minute:i,second:a,zone:o})}fromJSDate(e,t){return e?t?(this.zone=ot.utcTimezone,this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()):(this.zone=ot.localTimezone,this.year=e.getFullYear(),this.month=e.getMonth()+1,this.day=e.getDate(),this.hour=e.getHours(),this.minute=e.getMinutes(),this.second=e.getSeconds()):this.reset(),this._cachedUnixTime=null,this}fromData(e,t){if(e)for(let[r,s]of Object.entries(e))r!=="icaltype"&&(this[r]=s);if(t&&(this.zone=t),e&&!("isDate"in e)?this.isDate=!("hour"in e):e&&"isDate"in e&&(this.isDate=e.isDate),e&&"timezone"in e){let r=Gy.get(e.timezone);this.zone=r||ot.localTimezone}return e&&"zone"in e&&(this.zone=e.zone),this.zone||(this.zone=ot.localTimezone),this._cachedUnixTime=null,this}dayOfWeek(e){let t=e||ee.SUNDAY,r=(this.year<<12)+(this.month<<8)+(this.day<<3)+t;if(r in ee._dowCache)return ee._dowCache[r];let s=this.day,i=this.month+(this.month<3?12:0),a=this.year-(this.month<3?1:0),o=s+a+ur((i+1)*26/10)+ur(a/4);return o+=ur(a/100)*6+ur(a/400),o=(o+7-t)%7+1,ee._dowCache[r]=o,o}dayOfYear(){let e=ee.isLeapYear(this.year)?1:0;return ee.daysInYearPassedMonth[e][this.month-1]+this.day}startOfWeek(e){let t=e||ee.SUNDAY,r=this.clone();return r.day-=(this.dayOfWeek()+7-t)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r}endOfWeek(e){let t=e||ee.SUNDAY,r=this.clone();return r.day+=(7-this.dayOfWeek()+t-ee.SUNDAY)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r}startOfMonth(){let e=this.clone();return e.day=1,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}endOfMonth(){let e=this.clone();return e.day=ee.daysInMonth(e.month,e.year),e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}startOfYear(){let e=this.clone();return e.day=1,e.month=1,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}endOfYear(){let e=this.clone();return e.day=31,e.month=12,e.isDate=!0,e.hour=0,e.minute=0,e.second=0,e}startDoyWeek(e){let t=e||ee.SUNDAY,r=this.dayOfWeek()-t;return r<0&&(r+=7),this.dayOfYear()-r}getDominicalLetter(){return ee.getDominicalLetter(this.year)}nthWeekDay(e,t){let r=ee.daysInMonth(this.month,this.year),s,i=t,a=0,o=this.clone();if(i>=0){o.day=1,i!=0&&i--,a=o.day;let l=o.dayOfWeek(),c=e-l;c<0&&(c+=7),a+=c,a-=e,s=e}else{o.day=r;let l=o.dayOfWeek();i++,s=l-e,s<0&&(s+=7),s=r-s}return s+=i*7,a+s}isNthWeekDay(e,t){let r=this.dayOfWeek();return t===0&&r===e||this.nthWeekDay(e,t)===this.day}weekNumber(e){let t=(this.year<<12)+(this.month<<8)+(this.day<<3)+e;if(t in ee._wnCache)return ee._wnCache[t];let r,s=this.clone();s.isDate=!0;let i=this.year;s.month==12&&s.day>25?(r=ee.weekOneStarts(i+1,e),s.compare(r)<0?r=ee.weekOneStarts(i,e):i++):(r=ee.weekOneStarts(i,e),s.compare(r)<0&&(r=ee.weekOneStarts(--i,e)));let a=s.subtractDate(r).toSeconds()/86400,o=ur(a/7)+1;return ee._wnCache[t]=o,o}addDuration(e){let t=e.isNegative?-1:1,r=this.second,s=this.minute,i=this.hour,a=this.day;r+=t*e.seconds,s+=t*e.minutes,i+=t*e.hours,a+=t*e.days,a+=t*7*e.weeks,this.second=r,this.minute=s,this.hour=i,this.day=a,this._cachedUnixTime=null}subtractDate(e){let t=this.toUnixTime()+this.utcOffset(),r=e.toUnixTime()+e.utcOffset();return Ps.fromSeconds(t-r)}subtractDateTz(e){let t=this.toUnixTime(),r=e.toUnixTime();return Ps.fromSeconds(t-r)}compare(e){if(e instanceof tp)return-1*e.compare(this);{let t=this.toUnixTime(),r=e.toUnixTime();return t>r?1:r>t?-1:0}}compareDateOnlyTz(e,t){let r=this.convertToZone(t),s=e.convertToZone(t),i=0;return(i=ee._cmp_attr(r,s,"year"))!=0||(i=ee._cmp_attr(r,s,"month"))!=0||(i=ee._cmp_attr(r,s,"day"))!=0,i}convertToZone(e){let t=this.clone(),r=this.zone.tzid==e.tzid;return!this.isDate&&!r&&ot.convert_time(t,this.zone,e),t.zone=e,t}utcOffset(){return this.zone==ot.localTimezone||this.zone==ot.utcTimezone?0:this.zone.utcOffset(this)}toICALString(){let e=this.toString();return e.length>10?lt.icalendar.value["date-time"].toICAL(e):lt.icalendar.value.date.toICAL(e)}toString(){let e=this.year+"-"+cs(this.month)+"-"+cs(this.day);return this.isDate||(e+="T"+cs(this.hour)+":"+cs(this.minute)+":"+cs(this.second),this.zone===ot.utcTimezone&&(e+="Z")),e}toJSDate(){return this.zone==ot.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(this.toUnixTime()*1e3)}_normalize(){return this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this}adjust(e,t,r,s,i){let a,o,l=0,c=0,d,u,h,f,p,m=i||this._time;if(m.isDate||(d=m.second+s,m.second=d%60,a=ur(d/60),m.second<0&&(m.second+=60,a--),u=m.minute+r+a,m.minute=u%60,o=ur(u/60),m.minute<0&&(m.minute+=60,o--),h=m.hour+t+o,m.hour=h%24,l=ur(h/24),m.hour<0&&(m.hour+=24,l--)),m.month>12?c=ur((m.month-1)/12):m.month<1&&(c=ur(m.month/12)-1),m.year+=c,m.month-=12*c,f=m.day+e+l,f>0)for(;p=ee.daysInMonth(m.month,m.year),!(f<=p);)m.month++,m.month>12&&(m.year++,m.month=1),f-=p;else for(;f<=0;)m.month==1?(m.year--,m.month=12):m.month--,f+=ee.daysInMonth(m.month,m.year);return m.day=f,this._cachedUnixTime=null,this}fromUnixTime(e){this.zone=ot.utcTimezone;let t=new Date(e*1e3);this.year=t.getUTCFullYear(),this.month=t.getUTCMonth()+1,this.day=t.getUTCDate(),this._time.isDate?(this.hour=0,this.minute=0,this.second=0):(this.hour=t.getUTCHours(),this.minute=t.getUTCMinutes(),this.second=t.getUTCSeconds()),this._cachedUnixTime=null}toUnixTime(){if(this._cachedUnixTime!==null)return this._cachedUnixTime;let e=this.utcOffset(),t=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-e);return this._cachedUnixTime=t/1e3,this._cachedUnixTime}toJSON(){let e=["year","month","day","hour","minute","second","isDate"],t=Object.create(null),r=0,s=e.length,i;for(;r<s;r++)i=e[r],t[i]=this[i];return this.zone&&(t.timezone=this.zone.tzid),t}};Gc=new WeakMap,I(ee,"_dowCache",{}),I(ee,"_wnCache",{}),I(ee,"fromData",function(t,r){return new ee().fromData(t,r)}),pp(ee,Gc,null),I(ee,"daysInYearPassedMonth",[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]]),I(ee,"SUNDAY",1),I(ee,"MONDAY",2),I(ee,"TUESDAY",3),I(ee,"WEDNESDAY",4),I(ee,"THURSDAY",5),I(ee,"FRIDAY",6),I(ee,"SATURDAY",7),I(ee,"DEFAULT_WEEK_START",2);var oe=ee,A6=/[^ \t]/,qy=":",SS=";",P6="=",I6="unknown",R6="text",N6={"^'":'"',"^n":`
`,"^^":"^"};function st(n){let e={},t=e.component=[];if(e.stack=[t],st._eachLine(n,function(r,s){st._handleContentLine(s,e)}),e.stack.length>1)throw new Yi("invalid ical body. component began but did not end");return e=null,t.length==1?t[0]:t}st.property=function(n,e){let t={component:[[],[]],designSet:e||lt.defaultSet};return st._handleContentLine(n,t),t.component[1][0]};st.component=function(n){return st(n)};var Yi=class extends Error{constructor(){super(...arguments);I(this,"name",this.constructor.name)}};st.ParserError=Yi;st._handleContentLine=function(n,e){let t=n.indexOf(qy),r=n.indexOf(SS),s,i,a,o,l={};r!==-1&&t!==-1&&r>t&&(r=-1);let c;if(r!==-1){if(a=n.slice(0,Math.max(0,r)).toLowerCase(),c=st._parseParameters(n.slice(Math.max(0,r)),0,e.designSet),c[2]==-1)throw new Yi("Invalid parameters in '"+n+"'");l=c[0];let y;if(typeof c[1]=="string"?y=c[1].length:y=c[1].reduce((T,w)=>T+w.length,0),s=y+c[2]+r,(i=n.slice(Math.max(0,s)).indexOf(qy))!==-1)o=n.slice(Math.max(0,s+i+1));else throw new Yi("Missing parameter value in '"+n+"'")}else if(t!==-1){if(a=n.slice(0,Math.max(0,t)).toLowerCase(),o=n.slice(Math.max(0,t+1)),a==="begin"){let y=[o.toLowerCase(),[],[]];e.stack.length===1?e.component.push(y):e.component[2].push(y),e.stack.push(e.component),e.component=y,e.designSet||(e.designSet=lt.getDesignSet(e.component[0]));return}else if(a==="end"){e.component=e.stack.pop();return}}else throw new Yi('invalid line (no token ";" or ":") "'+n+'"');let d,u=!1,h=!1,f,p,m;e.designSet.propertyGroups&&a.indexOf(".")!==-1?(p=a.split("."),l.group=p[0],m=p[1]):m=a,m in e.designSet.property&&(f=e.designSet.property[m],"multiValue"in f&&(u=f.multiValue),"structuredValue"in f&&(h=f.structuredValue),o&&"detectType"in f&&(d=f.detectType(o))),d||("value"in l?d=l.value.toLowerCase():f?d=f.defaultType:d=I6),delete l.value;let g;u&&h?(o=st._parseMultiValue(o,h,d,[],u,e.designSet,h),g=[m,l,d,o]):u?(g=[m,l,d],st._parseMultiValue(o,u,d,g,null,e.designSet,!1)):h?(o=st._parseMultiValue(o,h,d,[],null,e.designSet,h),g=[m,l,d,o]):(o=st._parseValue(o,d,e.designSet,!1),g=[m,l,d,o]),e.component[0]==="vcard"&&e.component[1].length===0&&!(a==="version"&&o==="4.0")&&(e.designSet=lt.getDesignSet("vcard3")),e.component[1].push(g)};st._parseValue=function(n,e,t,r){return e in t.value&&"fromICAL"in t.value[e]?t.value[e].fromICAL(n,r):n};st._parseParameters=function(n,e,t){let r=e,s=0,i=P6,a={},o,l,c,d=-1,u,h,f;for(;s!==!1&&(s=n.indexOf(i,s+1))!==-1;){if(o=n.slice(r+1,s),o.length==0)throw new Yi("Empty parameter name in '"+n+"'");if(l=o.toLowerCase(),f=!1,h=!1,l in t.param&&t.param[l].valueType?u=t.param[l].valueType:u=R6,l in t.param&&(h=t.param[l].multiValue,t.param[l].multiValueSeparateDQuote&&(f=st._rfc6868Escape('"'+h+'"'))),n[s+1]==='"'){if(d=s+2,s=n.indexOf('"',d),h&&s!=-1){let y=!0;for(;y;)n[s+1]==h&&n[s+2]=='"'?s=n.indexOf('"',s+3):y=!1}if(s===-1)throw new Yi('invalid line (no matching double quote) "'+n+'"');c=n.slice(d,s),r=n.indexOf(SS,s);let g=n.indexOf(qy,s);(r===-1||g!==-1&&r>g)&&(s=!1)}else{d=s+1;let g=n.indexOf(SS,d),y=n.indexOf(qy,d);y!==-1&&g>y?(g=y,s=!1):g===-1?(y===-1?g=n.length:g=y,s=!1):(r=g,s=g),c=n.slice(d,g)}let m=c.length;if(c=st._rfc6868Escape(c),d+=m-c.length,h){let g=f||h;c=st._parseMultiValue(c,g,u,[],null,t)}else c=st._parseValue(c,u,t);h&&l in a?Array.isArray(a[l])?a[l].push(c):a[l]=[a[l],c]:a[l]=c}return[a,c,d]};st._rfc6868Escape=function(n){return n.replace(/\^['n^]/g,function(e){return N6[e]})};st._parseMultiValue=function(n,e,t,r,s,i,a){let o=0,l=0,c;if(e.length===0)return n;for(;(o=FB(n,e,l))!==-1;)c=n.slice(l,o),s?c=st._parseMultiValue(c,s,t,[],null,i,a):c=st._parseValue(c,t,i,a),r.push(c),l=o+e.length;return c=n.slice(l),s?c=st._parseMultiValue(c,s,t,[],null,i,a):c=st._parseValue(c,t,i,a),r.push(c),r.length==1?r[0]:r};st._eachLine=function(n,e){let t=n.length,r=n.search(A6),s=r,i,a,o;do s=n.indexOf(`
`,r)+1,s>1&&n[s-2]==="\r"?o=2:o=1,s===0&&(s=t,o=0),a=n[r],a===" "||a==="	"?i+=n.slice(r+1,s-o):(i&&e(null,i),i=n.slice(r,s-o)),r=s;while(s!==t);i=i.trim(),i.length&&e(null,i)};var O6=["tzid","location","tznames","latitude","longitude"],Qc,Kc,Qe=class Qe{constructor(e){I(this,"tzid","");I(this,"location","");I(this,"tznames","");I(this,"latitude",0);I(this,"longitude",0);I(this,"component",null);I(this,"expandedUntilYear",0);I(this,"icalclass","icaltimezone");this.wrappedJSObject=this,this.fromData(e)}static _compare_change_fn(e,t){return e.year<t.year?-1:e.year>t.year?1:e.month<t.month?-1:e.month>t.month?1:e.day<t.day?-1:e.day>t.day?1:e.hour<t.hour?-1:e.hour>t.hour?1:e.minute<t.minute?-1:e.minute>t.minute?1:e.second<t.second?-1:e.second>t.second?1:0}static convert_time(e,t,r){if(e.isDate||t.tzid==r.tzid||t==Qe.localTimezone||r==Qe.localTimezone)return e.zone=r,e;let s=t.utcOffset(e);return e.adjust(0,0,0,-s),s=r.utcOffset(e),e.adjust(0,0,0,s),null}static fromData(e){return new Qe().fromData(e)}static get utcTimezone(){return Ya(this,Qc)||mp(this,Qc,Qe.fromData({tzid:"UTC"})),Ya(this,Qc)}static get localTimezone(){return Ya(this,Kc)||mp(this,Kc,Qe.fromData({tzid:"floating"})),Ya(this,Kc)}static adjust_change(e,t,r,s,i){return oe.prototype.adjust.call(e,t,r,s,i,e)}fromData(e){if(this.expandedUntilYear=0,this.changes=[],e instanceof sn)this.component=e;else{if(e&&"component"in e)if(typeof e.component=="string"){let t=st(e.component);this.component=new sn(t)}else e.component instanceof sn?this.component=e.component:this.component=null;for(let t of O6)e&&t in e&&(this[t]=e[t])}return this.component instanceof sn&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue("tzid")),this}utcOffset(e){if(this==Qe.utcTimezone||this==Qe.localTimezone||(this._ensureCoverage(e.year),!this.changes.length))return 0;let t={year:e.year,month:e.month,day:e.day,hour:e.hour,minute:e.minute,second:e.second},r=this._findNearbyChange(t),s=-1,i=1;for(;;){let l=ol(this.changes[r],!0);if(l.utcOffset<l.prevUtcOffset?Qe.adjust_change(l,0,0,0,l.utcOffset):Qe.adjust_change(l,0,0,0,l.prevUtcOffset),Qe._compare_change_fn(t,l)>=0?s=r:i=-1,i==-1&&s!=-1)break;if(r+=i,r<0)return 0;if(r>=this.changes.length)break}let a=this.changes[s];if(a.utcOffset-a.prevUtcOffset<0&&s>0){let l=ol(a,!0);if(Qe.adjust_change(l,0,0,0,l.prevUtcOffset),Qe._compare_change_fn(t,l)<0){let c=this.changes[s-1],d=!1;a.is_daylight!=d&&c.is_daylight==d&&(a=c)}}return a.utcOffset}_findNearbyChange(e){let t=il(this.changes,e,Qe._compare_change_fn);return t>=this.changes.length?this.changes.length-1:t}_ensureCoverage(e){if(Qe._minimumExpansionYear==-1){let r=oe.now();Qe._minimumExpansionYear=r.year}let t=e;if(t<Qe._minimumExpansionYear&&(t=Qe._minimumExpansionYear),t+=Qe.EXTRA_COVERAGE,!this.changes.length||this.expandedUntilYear<e){let r=this.component.getAllSubcomponents(),s=r.length,i=0;for(;i<s;i++)this._expandComponent(r[i],t,this.changes);this.changes.sort(Qe._compare_change_fn),this.expandedUntilYear=t}}_expandComponent(e,t,r){if(!e.hasProperty("dtstart")||!e.hasProperty("tzoffsetto")||!e.hasProperty("tzoffsetfrom"))return null;let s=e.getFirstProperty("dtstart").getFirstValue(),i;function a(l){return l.factor*(l.hours*3600+l.minutes*60)}function o(){let l={};return l.is_daylight=e.name=="daylight",l.utcOffset=a(e.getFirstProperty("tzoffsetto").getFirstValue()),l.prevUtcOffset=a(e.getFirstProperty("tzoffsetfrom").getFirstValue()),l}if(!e.hasProperty("rrule")&&!e.hasProperty("rdate"))i=o(),i.year=s.year,i.month=s.month,i.day=s.day,i.hour=s.hour,i.minute=s.minute,i.second=s.second,Qe.adjust_change(i,0,0,0,-i.prevUtcOffset),r.push(i);else{let l=e.getAllProperties("rdate");for(let d of l){let u=d.getFirstValue();i=o(),i.year=u.year,i.month=u.month,i.day=u.day,u.isDate?(i.hour=s.hour,i.minute=s.minute,i.second=s.second,s.zone!=Qe.utcTimezone&&Qe.adjust_change(i,0,0,0,-i.prevUtcOffset)):(i.hour=u.hour,i.minute=u.minute,i.second=u.second,u.zone!=Qe.utcTimezone&&Qe.adjust_change(i,0,0,0,-i.prevUtcOffset)),r.push(i)}let c=e.getFirstProperty("rrule");if(c){c=c.getFirstValue(),i=o(),c.until&&c.until.zone==Qe.utcTimezone&&(c.until.adjust(0,0,0,i.prevUtcOffset),c.until.zone=Qe.localTimezone);let d=c.iterator(s),u;for(;(u=d.next())&&(i=o(),!(u.year>t||!u));)i.year=u.year,i.month=u.month,i.day=u.day,i.hour=u.hour,i.minute=u.minute,i.second=u.second,i.isDate=u.isDate,Qe.adjust_change(i,0,0,0,-i.prevUtcOffset),r.push(i)}}return r}toString(){return this.tznames?this.tznames:this.tzid}};Qc=new WeakMap,Kc=new WeakMap,pp(Qe,Qc,null),pp(Qe,Kc,null),I(Qe,"_minimumExpansionYear",-1),I(Qe,"EXTRA_COVERAGE",5);var ot=Qe,Wr=null,Gy={get count(){return Wr===null?0:Object.keys(Wr).length},reset:function(){Wr=Object.create(null);let n=ot.utcTimezone;Wr.Z=n,Wr.UTC=n,Wr.GMT=n},_hard_reset:function(){Wr=null},has:function(n){return Wr===null?!1:!!Wr[n]},get:function(n){return Wr===null&&this.reset(),Wr[n]},register:function(n,e){if(Wr===null&&this.reset(),typeof n=="string"&&e instanceof ot&&([n,e]=[e,n]),e||(n instanceof ot?e=n.tzid:n.name==="vtimezone"&&(n=new ot(n),e=n.tzid)),!e)throw new TypeError("Neither a timezone nor a name was passed");if(n instanceof ot)Wr[e]=n;else throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component")},remove:function(n){return Wr===null?null:delete Wr[n]}};function L6(n){let e,t,r,s,i;if(!n||n.name!=="vcalendar")return n;for(e=n.getAllSubcomponents(),t=[],r={},i=0;i<e.length;i++)if(e[i].name==="vtimezone"){let a=e[i].getFirstProperty("tzid").getFirstValue();r[a]=e[i]}else t=t.concat(e[i].getAllProperties());for(s={},i=0;i<t.length;i++){let a=t[i].getParameter("tzid");a&&(s[a]=!0)}for(let[a,o]of Object.entries(r))s[a]||n.removeSubcomponent(o);for(let a of Object.keys(s))!r[a]&&Gy.has(a)&&n.addSubcomponent(Gy.get(a).component);return n}function rp(n){return typeof n=="number"&&isNaN(n)}function Nr(n){let e=parseInt(n,10);if(rp(e))throw new Error('Could not extract integer from "'+n+'"');return e}function ji(n,e){if(typeof n!="undefined")return n instanceof e?n:new e(n)}function FB(n,e,t){for(;(t=n.indexOf(e,t))!==-1;)if(t>0&&n[t-1]==="\\")t+=1;else return t;return-1}function il(n,e,t){if(!n.length)return 0;let r=0,s=n.length-1,i,a;for(;r<=s;)if(i=r+Math.floor((s-r)/2),a=t(e,n[i]),a<0)s=i-1;else if(a>0)r=i+1;else break;return a<0?i:a>0?i+1:i}function ol(n,e){if(!n||typeof n!="object")return n;if(n instanceof Date)return new Date(n.getTime());if("clone"in n)return n.clone();if(Array.isArray(n)){let t=[];for(let r=0;r<n.length;r++)t.push(e?ol(n[r],!0):n[r]);return t}else{let t={};for(let[r,s]of Object.entries(n))e?t[r]=ol(s,!0):t[r]=s;return t}}function BB(n){let e="",t=n||"",r=0,s=0;for(;t.length;){let i=t.codePointAt(r);i<128?++s:i<2048?s+=2:i<65536?s+=3:s+=4,s<oi.foldLength+1?r+=i>65535?2:1:(e+=oi.newLineChar+" "+t.slice(0,Math.max(0,r)),t=t.slice(Math.max(0,r)),r=s=0)}return e.slice(oi.newLineChar.length+1)}function cs(n){switch(typeof n!="string"&&(typeof n=="number"&&(n=parseInt(n)),n=String(n)),n.length){case 0:return"00";case 1:return"0"+n;default:return n}}function ur(n){return n<0?Math.ceil(n):Math.floor(n)}function ll(n,e){for(let t in n){let r=Object.getOwnPropertyDescriptor(n,t);r&&!Object.getOwnPropertyDescriptor(e,t)&&Object.defineProperty(e,t,r)}return e}var F6=Object.freeze({__proto__:null,binsearchInsert:il,clone:ol,extend:ll,foldline:BB,formatClassType:ji,isStrictlyNaN:rp,pad2:cs,strictParseInt:Nr,trunc:ur,unescapedIndexOf:FB,updateTimezones:L6}),Vi=class n{constructor(e){I(this,"hours",0);I(this,"minutes",0);I(this,"factor",1);I(this,"icaltype","utc-offset");this.fromData(e)}static fromString(e){let t={};return t.factor=e[0]==="+"?1:-1,t.hours=Nr(e.slice(1,3)),t.minutes=Nr(e.slice(4,6)),new n(t)}static fromSeconds(e){let t=new n;return t.fromSeconds(e),t}clone(){return n.fromSeconds(this.toSeconds())}fromData(e){if(e)for(let[t,r]of Object.entries(e))this[t]=r;this._normalize()}fromSeconds(e){let t=Math.abs(e);return this.factor=e<0?-1:1,this.hours=ur(t/3600),t-=this.hours*3600,this.minutes=ur(t/60),this}toSeconds(){return this.factor*(60*this.minutes+3600*this.hours)}compare(e){let t=this.toSeconds(),r=e.toSeconds();return(t>r)-(r>t)}_normalize(){let e=this.toSeconds(),t=this.factor;for(;e<-43200;)e+=97200;for(;e>50400;)e-=97200;this.fromSeconds(e),e==0&&(this.factor=t)}toICALString(){return lt.icalendar.value["utc-offset"].toICAL(this.toString())}toString(){return(this.factor==1?"+":"-")+cs(this.hours)+":"+cs(this.minutes)}},nl=class n extends oe{constructor(t,r,s){super(t,r);I(this,"icalclass","vcardtime");I(this,"icaltype","date-and-or-time");this.icaltype=s||"date-and-or-time"}static fromDateAndOrTimeString(t,r){function s(g,y,T){return g?Nr(g.slice(y,y+T)):null}let i=t.split("T"),a=i[0],o=i[1],l=o?lt.vcard.value.time._splitZone(o):[],c=l[0],d=l[1],u=a?a.length:0,h=d?d.length:0,f=a&&a[0]=="-"&&a[1]=="-",p=d&&d[0]=="-",m={year:f?null:s(a,0,4),month:f&&(u==4||u==7)?s(a,2,2):u==7||u==10?s(a,5,2):null,day:u==5?s(a,3,2):u==7&&f?s(a,5,2):u==10?s(a,8,2):null,hour:p?null:s(d,0,2),minute:p&&h==3?s(d,1,2):h>4?p?s(d,1,2):s(d,3,2):null,second:h==4?s(d,2,2):h==6?s(d,4,2):h==8?s(d,6,2):null};return c=="Z"?c=ot.utcTimezone:c&&c[3]==":"?c=Vi.fromString(c):c=null,new n(m,c,r)}clone(){return new n(this._time,this.zone,this.icaltype)}_normalize(){return this}utcOffset(){return this.zone instanceof Vi?this.zone.toSeconds():oe.prototype.utcOffset.apply(this,arguments)}toICALString(){return lt.vcard.value[this.icaltype].toICAL(this.toString())}toString(){let t=this.year,r=this.month,s=this.day,i=this.hour,a=this.minute,o=this.second,l=t!==null,c=r!==null,d=s!==null,u=i!==null,h=a!==null,f=o!==null,p=(l?cs(t)+(c||d?"-":""):c||d?"--":"")+(c?cs(r):"")+(d?"-"+cs(s):""),m=(u?cs(i):"-")+(u&&h?":":"")+(h?cs(a):"")+(!u&&!h?"-":"")+(h&&f?":":"")+(f?cs(o):""),g;switch(this.zone===ot.utcTimezone?g="Z":this.zone instanceof Vi?g=this.zone.toString():this.zone===ot.localTimezone?g="":this.zone instanceof ot?g=Vi.fromSeconds(this.zone.utcOffset(this)).toString():g="",this.icaltype){case"time":return m+g;case"date-and-or-time":case"date-time":return p+(m=="--"?"":"T"+m+g);case"date":return p}return null}},ls=class ls{constructor(e){I(this,"completed",!1);I(this,"rule",null);I(this,"dtstart",null);I(this,"last",null);I(this,"occurrence_number",0);I(this,"by_indices",null);I(this,"initialized",!1);I(this,"by_data",null);I(this,"days",null);I(this,"days_index",0);this.fromData(e)}fromData(e){if(this.rule=ji(e.rule,Cn),!this.rule)throw new Error("iterator requires a (ICAL.Recur) rule");if(this.dtstart=ji(e.dtstart,oe),!this.dtstart)throw new Error("iterator requires a (ICAL.Time) dtstart");if(e.by_data?this.by_data=e.by_data:this.by_data=ol(this.rule.parts,!0),e.occurrence_number&&(this.occurrence_number=e.occurrence_number),this.days=e.days||[],e.last&&(this.last=ji(e.last,oe)),this.by_indices=e.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=e.initialized||!1,!this.initialized)try{this.init()}catch(t){if(t instanceof qc)this.completed=!0;else throw t}}init(){this.initialized=!0,this.last=this.dtstart.clone();let e=this.by_data;if("BYDAY"in e&&this.sort_byday_rules(e.BYDAY),"BYYEARDAY"in e&&("BYMONTH"in e||"BYWEEKNO"in e||"BYMONTHDAY"in e))throw new Error("Invalid BYYEARDAY rule");if("BYWEEKNO"in e&&"BYMONTHDAY"in e)throw new Error("BYWEEKNO does not fit to BYMONTHDAY");if(this.rule.freq=="MONTHLY"&&("BYYEARDAY"in e||"BYWEEKNO"in e))throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear");if(this.rule.freq=="WEEKLY"&&("BYYEARDAY"in e||"BYMONTHDAY"in e))throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear");if(this.rule.freq!="YEARLY"&&"BYYEARDAY"in e)throw new Error("BYYEARDAY may only appear in YEARLY rules");if(this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second),this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute),this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour),this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day),this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month),this.rule.freq=="WEEKLY")if("BYDAY"in e){let[,t]=this.ruleDayOfWeek(e.BYDAY[0],this.rule.wkst),r=t-this.last.dayOfWeek(this.rule.wkst);(this.last.dayOfWeek(this.rule.wkst)<t&&r>=0||r<0)&&(this.last.day+=r)}else{let t=Cn.numericDayToIcalDay(this.dtstart.dayOfWeek());e.BYDAY=[t]}if(this.rule.freq=="YEARLY"){let t=this.rule.until?this.rule.until.year:2e4;for(;this.last.year<=t&&(this.expand_year_days(this.last.year),!(this.days.length>0));)this.increment_year(this.rule.interval);if(this.days.length==0)throw new qc;if(!this._nextByYearDay()&&!this.next_year()&&!this.next_year()&&!this.next_year())throw new qc}if(this.rule.freq=="MONTHLY"){if(this.has_by_data("BYDAY")){let t=null,r=this.last.clone(),s=oe.daysInMonth(this.last.month,this.last.year);for(let i of this.by_data.BYDAY){this.last=r.clone();let[a,o]=this.ruleDayOfWeek(i),l=this.last.nthWeekDay(o,a);if(a>=6||a<=-6)throw new Error("Malformed values in BYDAY part");if(l>s||l<=0){if(t&&t.month==r.month)continue;for(;l>s||l<=0;)this.increment_month(),s=oe.daysInMonth(this.last.month,this.last.year),l=this.last.nthWeekDay(o,a)}this.last.day=l,(!t||this.last.compare(t)<0)&&(t=this.last.clone())}if(this.last=t.clone(),this.has_by_data("BYMONTHDAY")&&this._byDayAndMonthDay(!0),this.last.day>s||this.last.day==0)throw new Error("Malformed values in BYDAY part")}else if(this.has_by_data("BYMONTHDAY")){this.last.day=1;let t=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY).filter(r=>r>=this.last.day);if(t.length)this.last.day=t[0],this.by_data.BYMONTHDAY=t;else if(!this.next_month()&&!this.next_month()&&!this.next_month())throw new qc}}}next(e=!1){let t=this.last?this.last.clone():null;if((this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0)&&(this.completed=!0),this.completed)return null;if(this.occurrence_number==0&&this.last.compare(this.dtstart)>=0)return this.occurrence_number++,this.last;let r,s=0;do switch(r=1,this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":if(r=this.next_month(),r)s=0;else if(++s==336)return this.completed=!0,null;break;case"YEARLY":if(r=this.next_year(),r)s=0;else if(++s==28)return this.completed=!0,null;break;default:return null}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!r);if(this.last.compare(t)==0){if(e)throw new Error("Same occurrence found twice, protecting you from death by recursion");this.next(!0)}return this.rule.until&&this.last.compare(this.rule.until)>0?(this.completed=!0,null):(this.occurrence_number++,this.last)}next_second(){return this.next_generic("BYSECOND","SECONDLY","second","minute")}increment_second(e){return this.increment_generic(e,"second",60,"minute")}next_minute(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")}increment_minute(e){return this.increment_generic(e,"minute",60,"hour")}next_hour(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")}increment_hour(e){this.increment_generic(e,"hour",24,"monthday")}next_day(){let e=this.rule.freq=="DAILY";return this.next_hour()==0||(e?this.increment_monthday(this.rule.interval):this.increment_monthday(1)),0}next_week(){let e=0;if(this.next_weekday_by_week()==0)return e;if(this.has_by_data("BYWEEKNO")){this.by_indices.BYWEEKNO++,this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,e=1),this.last.month=1,this.last.day=1;let t=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*t,e&&this.increment_year(1)}else this.increment_monthday(7*this.rule.interval);return e}normalizeByMonthDayRules(e,t,r){let s=oe.daysInMonth(t,e),i=[],a=0,o=r.length,l;for(;a<o;a++){if(l=parseInt(r[a],10),isNaN(l))throw new Error("Invalid BYMONTHDAY value");if(!(Math.abs(l)>s)){if(l<0)l=s+(l+1);else if(l===0)continue;i.indexOf(l)===-1&&i.push(l)}}return i.sort(function(c,d){return c-d})}_byDayAndMonthDay(e){let t,r=this.by_data.BYDAY,s,i=0,a,o=r.length,l=0,c,d=this,u=this.last.day;function h(){for(c=oe.daysInMonth(d.last.month,d.last.year),t=d.normalizeByMonthDayRules(d.last.year,d.last.month,d.by_data.BYMONTHDAY),a=t.length;t[i]<=u&&!(e&&t[i]==u)&&i<a-1;)i++}function f(){u=0,d.increment_month(),i=0,h()}h(),e&&(u-=1);let p=48;for(;!l&&p;){if(p--,s=u+1,s>c){f();continue}let m=t[i++];if(m>=s)u=m;else{f();continue}for(let g=0;g<o;g++){let y=this.ruleDayOfWeek(r[g]),T=y[0],w=y[1];if(this.last.day=u,this.last.isNthWeekDay(w,T)){l=1;break}}if(!l&&i===a){f();continue}}if(p<=0)throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts");return l}next_month(){let e=1;if(this.next_hour()==0)return e;if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY"))e=this._byDayAndMonthDay();else if(this.has_by_data("BYDAY")){let t=oe.daysInMonth(this.last.month,this.last.year),r=0,s=0;if(this.has_by_data("BYSETPOS")){let a=this.last.day;for(let o=1;o<=t;o++)this.last.day=o,this.is_day_in_byday(this.last)&&(s++,o<=a&&r++);this.last.day=a}e=0;let i;for(i=this.last.day+1;i<=t;i++)if(this.last.day=i,this.is_day_in_byday(this.last)&&(!this.has_by_data("BYSETPOS")||this.check_set_position(++r)||this.check_set_position(r-s-1))){e=1;break}i>t&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?(!this.has_by_data("BYSETPOS")||this.check_set_position(1))&&(e=1):e=0)}else if(this.has_by_data("BYMONTHDAY")){if(this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month(),this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length))return 0;let t=oe.daysInMonth(this.last.month,this.last.year),r=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];r<0&&(r=t+r+1),r>t?(this.last.day=1,e=this.is_day_in_byday(this.last)):this.last.day=r}else{this.increment_month();let t=oe.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>t?e=0:this.last.day=this.by_data.BYMONTHDAY[0]}return e}next_weekday_by_week(){let e=0;if(this.next_hour()==0)return e;if(!this.has_by_data("BYDAY"))return 1;for(;;){let t=new oe;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,e=1);let r=this.by_data.BYDAY[this.by_indices.BYDAY],i=this.ruleDayOfWeek(r)[1];i-=this.rule.wkst,i<0&&(i+=7),t.year=this.last.year,t.month=this.last.month,t.day=this.last.day;let a=t.startDoyWeek(this.rule.wkst);if(i+a<1&&!e)continue;let o=oe.fromDayOfYear(a+i,this.last.year);return this.last.year=o.year,this.last.month=o.month,this.last.day=o.day,e}}next_year(){return this.next_hour()==0||(this.days.length==0||++this.days_index==this.days.length)&&(this.days_index=0,this.increment_year(this.rule.interval),this.has_by_data("BYMONTHDAY")&&(this.by_data.BYMONTHDAY=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY)),this.expand_year_days(this.last.year),this.days.length==0)?0:this._nextByYearDay()}_nextByYearDay(){let e=this.days[this.days_index],t=this.last.year;if(Math.abs(e)==366&&!oe.isLeapYear(this.last.year))return 0;e<1&&(e+=1,t+=1);let r=oe.fromDayOfYear(e,t);return this.last.day=r.day,this.last.month=r.month,1}ruleDayOfWeek(e,t){let r=e.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(r){let s=parseInt(r[1]||0,10);return e=Cn.icalDayToNumericDay(r[2],t),[s,e]}else return[0,0]}next_generic(e,t,r,s,i){let a=e in this.by_data,o=this.rule.freq==t,l=0;if(i&&this[i]()==0)return l;if(a){this.by_indices[e]++;let c=this.by_data[e];this.by_indices[e]==c.length&&(this.by_indices[e]=0,l=1),this.last[r]=c[this.by_indices[e]]}else o&&this["increment_"+r](this.rule.interval);return a&&l&&o&&this["increment_"+s](1),l}increment_monthday(e){for(let t=0;t<e;t++){let r=oe.daysInMonth(this.last.month,this.last.year);this.last.day++,this.last.day>r&&(this.last.day-=r,this.increment_month())}}increment_month(){if(this.last.day=1,this.has_by_data("BYMONTH"))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{this.rule.freq=="MONTHLY"?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;let e=ur(this.last.month/12);this.last.month%=12,this.last.month++,e!=0&&this.increment_year(e)}this.has_by_data("BYMONTHDAY")&&(this.by_data.BYMONTHDAY=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY))}increment_year(e){this.last.day=1,this.last.year+=e}increment_generic(e,t,r,s){this.last[t]+=e;let i=ur(this.last[t]/r);this.last[t]%=r,i!=0&&this["increment_"+s](i)}has_by_data(e){return e in this.rule.parts}expand_year_days(e){let t=new oe;this.days=[];let r={},s=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(let o of s)o in this.rule.parts&&(r[o]=this.rule.parts[o]);if("BYMONTH"in r&&"BYWEEKNO"in r){let o=1,l={};t.year=e,t.isDate=!0;for(let c=0;c<this.by_data.BYMONTH.length;c++){let d=this.by_data.BYMONTH[c];t.month=d,t.day=1;let u=t.weekNumber(this.rule.wkst);t.day=oe.daysInMonth(d,e);let h=t.weekNumber(this.rule.wkst);for(c=u;c<h;c++)l[c]=1}for(let c=0;c<this.by_data.BYWEEKNO.length&&o;c++)this.by_data.BYWEEKNO[c]<52?o&=l[c]:o=0;o?delete r.BYMONTH:delete r.BYWEEKNO}let i=Object.keys(r).length;if(i==0){let o=this.dtstart.clone();o.year=this.last.year,this.days.push(o.dayOfYear())}else if(i==1&&"BYMONTH"in r)for(let o of this.by_data.BYMONTH){let l=this.dtstart.clone();l.year=e,l.month=o,l.isDate=!0,this.days.push(l.dayOfYear())}else if(i==1&&"BYMONTHDAY"in r)for(let o of this.by_data.BYMONTHDAY){let l=this.dtstart.clone();if(o<0){let c=oe.daysInMonth(l.month,e);o=o+c+1}l.day=o,l.year=e,l.isDate=!0,this.days.push(l.dayOfYear())}else if(i==2&&"BYMONTHDAY"in r&&"BYMONTH"in r)for(let o of this.by_data.BYMONTH){let l=oe.daysInMonth(o,e);for(let c of this.by_data.BYMONTHDAY)c<0&&(c=c+l+1),t.day=c,t.month=o,t.year=e,t.isDate=!0,this.days.push(t.dayOfYear())}else if(!(i==1&&"BYWEEKNO"in r)){if(!(i==2&&"BYWEEKNO"in r&&"BYMONTHDAY"in r)){if(i==1&&"BYDAY"in r)this.days=this.days.concat(this.expand_by_day(e));else if(i==2&&"BYDAY"in r&&"BYMONTH"in r){for(let o of this.by_data.BYMONTH){let l=oe.daysInMonth(o,e);t.year=e,t.month=o,t.day=1,t.isDate=!0;let c=t.dayOfWeek(),d=t.dayOfYear()-1;t.day=l;let u=t.dayOfWeek();if(this.has_by_data("BYSETPOS")){let h=[];for(let f=1;f<=l;f++)t.day=f,this.is_day_in_byday(t)&&h.push(f);for(let f=0;f<h.length;f++)(this.check_set_position(f+1)||this.check_set_position(f-h.length))&&this.days.push(d+h[f])}else for(let h of this.by_data.BYDAY){let f=this.ruleDayOfWeek(h),p=f[0],m=f[1],g,y=(m+7-c)%7+1,T=l-(u+7-m)%7;if(p==0)for(let w=y;w<=l;w+=7)this.days.push(d+w);else p>0?(g=y+(p-1)*7,g<=l&&this.days.push(d+g)):(g=T+(p+1)*7,g>0&&this.days.push(d+g))}}this.days.sort(function(o,l){return o-l})}else if(i==2&&"BYDAY"in r&&"BYMONTHDAY"in r){let o=this.expand_by_day(e);for(let l of o){let c=oe.fromDayOfYear(l,e);this.by_data.BYMONTHDAY.indexOf(c.day)>=0&&this.days.push(l)}}else if(i==3&&"BYDAY"in r&&"BYMONTHDAY"in r&&"BYMONTH"in r){let o=this.expand_by_day(e);for(let l of o){let c=oe.fromDayOfYear(l,e);this.by_data.BYMONTH.indexOf(c.month)>=0&&this.by_data.BYMONTHDAY.indexOf(c.day)>=0&&this.days.push(l)}}else if(i==2&&"BYDAY"in r&&"BYWEEKNO"in r){let o=this.expand_by_day(e);for(let l of o){let d=oe.fromDayOfYear(l,e).weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(d)&&this.days.push(l)}}else if(!(i==3&&"BYDAY"in r&&"BYWEEKNO"in r&&"BYMONTHDAY"in r))if(i==1&&"BYYEARDAY"in r)this.days=this.days.concat(this.by_data.BYYEARDAY);else if(i==2&&"BYYEARDAY"in r&&"BYDAY"in r){let o=oe.isLeapYear(e)?366:365,l=new Set(this.expand_by_day(e));for(let c of this.by_data.BYYEARDAY)c<0&&(c+=o+1),l.has(c)&&this.days.push(c)}else this.days=[]}}let a=oe.isLeapYear(e)?366:365;return this.days.sort((o,l)=>(o<0&&(o+=a+1),l<0&&(l+=a+1),o-l)),0}expand_by_day(e){let t=[],r=this.last.clone();r.year=e,r.month=1,r.day=1,r.isDate=!0;let s=r.dayOfWeek();r.month=12,r.day=31,r.isDate=!0;let i=r.dayOfWeek(),a=r.dayOfYear();for(let o of this.by_data.BYDAY){let l=this.ruleDayOfWeek(o),c=l[0],d=l[1];if(c==0){let u=(d+7-s)%7+1;for(let h=u;h<=a;h+=7)t.push(h)}else if(c>0){let u;d>=s?u=d-s+1:u=d-s+8,t.push(u+(c-1)*7)}else{let u;c=-c,d<=i?u=a-i+d:u=a-i+d-7,t.push(u-(c-1)*7)}}return t}is_day_in_byday(e){if(this.by_data.BYDAY)for(let t of this.by_data.BYDAY){let r=this.ruleDayOfWeek(t),s=r[0],i=r[1],a=e.dayOfWeek();if(s==0&&i==a||e.nthWeekDay(i,s)==e.day)return 1}return 0}check_set_position(e){return this.has_by_data("BYSETPOS")?this.by_data.BYSETPOS.indexOf(e)!==-1:!1}sort_byday_rules(e){for(let t=0;t<e.length;t++)for(let r=0;r<t;r++){let s=this.ruleDayOfWeek(e[r],this.rule.wkst)[1],i=this.ruleDayOfWeek(e[t],this.rule.wkst)[1];if(s>i){let a=e[t];e[t]=e[r],e[r]=a}}}check_contract_restriction(e,t){let r=ls._indexMap[e],s=ls._expandMap[this.rule.freq][r],i=!1;if(e in this.by_data&&s==ls.CONTRACT){let a=this.by_data[e];for(let o of a)if(o==t){i=!0;break}}else i=!0;return i}check_contracting_rules(){let e=this.last.dayOfWeek(),t=this.last.weekNumber(this.rule.wkst),r=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",Cn.numericDayToIcalDay(e))&&this.check_contract_restriction("BYWEEKNO",t)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",r)}setup_defaults(e,t,r){let s=ls._indexMap[e];return ls._expandMap[this.rule.freq][s]!=ls.CONTRACT&&(e in this.by_data||(this.by_data[e]=[r]),this.rule.freq!=t)?this.by_data[e][0]:r}toJSON(){let e=Object.create(null);return e.initialized=this.initialized,e.rule=this.rule.toJSON(),e.dtstart=this.dtstart.toJSON(),e.by_data=this.by_data,e.days=this.days,e.last=this.last.toJSON(),e.by_indices=this.by_indices,e.occurrence_number=this.occurrence_number,e}};I(ls,"_indexMap",{BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8}),I(ls,"_expandMap",{SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]}),I(ls,"UNKNOWN",0),I(ls,"CONTRACT",1),I(ls,"EXPAND",2),I(ls,"ILLEGAL",3);var sp=ls,qc=class extends Error{constructor(){super("Recurrence rule has no valid occurrences")}},B6=/^(SU|MO|TU|WE|TH|FR|SA)$/,H6=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,HB={SU:oe.SUNDAY,MO:oe.MONDAY,TU:oe.TUESDAY,WE:oe.WEDNESDAY,TH:oe.THURSDAY,FR:oe.FRIDAY,SA:oe.SATURDAY},U6=Object.fromEntries(Object.entries(HB).map(n=>n.reverse())),CB=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"],Cn=class n{constructor(e){I(this,"parts",null);I(this,"interval",1);I(this,"wkst",oe.MONDAY);I(this,"until",null);I(this,"count",null);I(this,"freq",null);I(this,"icalclass","icalrecur");I(this,"icaltype","recur");this.wrappedJSObject=this,this.parts={},e&&typeof e=="object"&&this.fromData(e)}static fromString(e){let t=this._stringToData(e,!1);return new n(t)}static fromData(e){return new n(e)}static _stringToData(e,t){let r=Object.create(null),s=e.split(";"),i=s.length;for(let a=0;a<i;a++){let o=s[a].split("="),l=o[0].toUpperCase(),c=o[0].toLowerCase(),d=t?c:l,u=o[1];if(l in ES){let h=u.split(","),f=new Set;for(let p of h)f.add(ES[l](p));h=[...f],r[d]=h.length==1?h[0]:h}else l in kS?kS[l](u,r,t):r[c]=u}return r}static icalDayToNumericDay(e,t){let r=t||oe.SUNDAY;return(HB[e]-r+7)%7+1}static numericDayToIcalDay(e,t){let r=t||oe.SUNDAY,s=e+r-oe.SUNDAY;return s>7&&(s-=7),U6[s]}iterator(e){return new sp({rule:this,dtstart:e})}clone(){return new n(this.toJSON())}isFinite(){return!!(this.count||this.until)}isByCount(){return!!(this.count&&!this.until)}addComponent(e,t){let r=e.toUpperCase();r in this.parts?this.parts[r].push(t):this.parts[r]=[t]}setComponent(e,t){this.parts[e.toUpperCase()]=t.slice()}getComponent(e){let t=e.toUpperCase();return t in this.parts?this.parts[t].slice():[]}getNextOccurrence(e,t){let r=this.iterator(e),s;do s=r.next();while(s&&s.compare(t)<=0);return s&&t.zone&&(s.zone=t.zone),s}fromData(e){for(let t in e){let r=t.toUpperCase();r in ES?Array.isArray(e[t])?this.parts[r]=e[t]:this.parts[r]=[e[t]]:this[t]=e[t]}this.interval&&typeof this.interval!="number"&&kS.INTERVAL(this.interval,this),this.wkst&&typeof this.wkst!="number"&&(this.wkst=n.icalDayToNumericDay(this.wkst)),this.until&&!(this.until instanceof oe)&&(this.until=oe.fromString(this.until))}toJSON(){let e=Object.create(null);e.freq=this.freq,this.count&&(e.count=this.count),this.interval>1&&(e.interval=this.interval);for(let[t,r]of Object.entries(this.parts))Array.isArray(r)&&r.length==1?e[t.toLowerCase()]=r[0]:e[t.toLowerCase()]=ol(r);return this.until&&(e.until=this.until.toString()),"wkst"in this&&this.wkst!==oe.DEFAULT_WEEK_START&&(e.wkst=n.numericDayToIcalDay(this.wkst)),e}toString(){let e="FREQ="+this.freq;this.count&&(e+=";COUNT="+this.count),this.interval>1&&(e+=";INTERVAL="+this.interval);for(let[t,r]of Object.entries(this.parts))e+=";"+t+"="+r;return this.until&&(e+=";UNTIL="+this.until.toICALString()),"wkst"in this&&this.wkst!==oe.DEFAULT_WEEK_START&&(e+=";WKST="+n.numericDayToIcalDay(this.wkst)),e}};function Ba(n,e,t,r){let s=r;if(r[0]==="+"&&(s=r.slice(1)),s=Nr(s),e!==void 0&&r<e)throw new Error(n+': invalid value "'+r+'" must be > '+e);if(t!==void 0&&r>t)throw new Error(n+': invalid value "'+r+'" must be < '+e);return s}var kS={FREQ:function(n,e,t){if(CB.indexOf(n)!==-1)e.freq=n;else throw new Error('invalid frequency "'+n+'" expected: "'+CB.join(", ")+'"')},COUNT:function(n,e,t){e.count=Nr(n)},INTERVAL:function(n,e,t){e.interval=Nr(n),e.interval<1&&(e.interval=1)},UNTIL:function(n,e,t){n.length>10?e.until=lt.icalendar.value["date-time"].fromICAL(n):e.until=lt.icalendar.value.date.fromICAL(n),t||(e.until=oe.fromString(e.until))},WKST:function(n,e,t){if(B6.test(n))e.wkst=Cn.icalDayToNumericDay(n);else throw new Error('invalid WKST value "'+n+'"')}},ES={BYSECOND:Ba.bind(void 0,"BYSECOND",0,60),BYMINUTE:Ba.bind(void 0,"BYMINUTE",0,59),BYHOUR:Ba.bind(void 0,"BYHOUR",0,23),BYDAY:function(n){if(H6.test(n))return n;throw new Error('invalid BYDAY value "'+n+'"')},BYMONTHDAY:Ba.bind(void 0,"BYMONTHDAY",-31,31),BYYEARDAY:Ba.bind(void 0,"BYYEARDAY",-366,366),BYWEEKNO:Ba.bind(void 0,"BYWEEKNO",-53,53),BYMONTH:Ba.bind(void 0,"BYMONTH",1,12),BYSETPOS:Ba.bind(void 0,"BYSETPOS",-366,366)},W6=/\\\\|\\;|\\,|\\[Nn]/g,$6=/\\|;|,|\n/g,xB=/\\\\|\\,|\\[Nn]/g,MB=/\\|,|\n/g;function DS(n,e){return{matches:/.*/,fromICAL:function(r,s){return V6(r,n,s)},toICAL:function(r,s){let i=e;return s&&(i=new RegExp(i.source+"|"+s,i.flags)),r.replace(i,function(a){switch(a){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case`
`:return"\\n";default:return a}})}}}var Ke={defaultType:"text"},np={defaultType:"text",multiValue:","},Qy={defaultType:"text",structuredValue:";"},Uy={defaultType:"integer"},Wy={defaultType:"date-time",allowedTypes:["date-time","date"]},$y={defaultType:"date-time"},os={defaultType:"uri"},_B={defaultType:"utc-offset"},AB={defaultType:"recur"},PB={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]};function j6(n){switch(n){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return`
`;default:return n}}function V6(n,e,t){return n.indexOf("\\")===-1?n:(t&&(e=new RegExp(e.source+"|\\\\"+t,e.flags)),n.replace(e,j6))}var xS={categories:np,url:os,version:Ke,uid:Ke},MS={boolean:{values:["TRUE","FALSE"],fromICAL:function(n){switch(n){case"TRUE":return!0;case"FALSE":return!1;default:return!1}},toICAL:function(n){return n?"TRUE":"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(n){let e=parseFloat(n);return rp(e)?0:e},toICAL:function(n){return String(n)}},integer:{fromICAL:function(n){let e=parseInt(n);return rp(e)?0:e},toICAL:function(n){return String(n)}},"utc-offset":{toICAL:function(n){return n.length<7?n.slice(0,3)+n.slice(4,6):n.slice(0,3)+n.slice(4,6)+n.slice(7,9)},fromICAL:function(n){return n.length<6?n.slice(0,3)+":"+n.slice(3,5):n.slice(0,3)+":"+n.slice(3,5)+":"+n.slice(5,7)},decorate:function(n){return Vi.fromString(n)},undecorate:function(n){return n.toString()}}},Y6={cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}},qt=ll(MS,{text:DS(W6,$6),uri:{},binary:{decorate:function(n){return zy.fromString(n)},undecorate:function(n){return n.toString()}},"cal-address":{},date:{decorate:function(n,e){return lt.strict?oe.fromDateString(n,e):oe.fromString(n,e)},undecorate:function(n){return n.toString()},fromICAL:function(n){return!lt.strict&&n.length>=15?qt["date-time"].fromICAL(n):n.slice(0,4)+"-"+n.slice(4,6)+"-"+n.slice(6,8)},toICAL:function(n){let e=n.length;return e==10?n.slice(0,4)+n.slice(5,7)+n.slice(8,10):e>=19?qt["date-time"].toICAL(n):n}},"date-time":{fromICAL:function(n){if(!lt.strict&&n.length==8)return qt.date.fromICAL(n);{let e=n.slice(0,4)+"-"+n.slice(4,6)+"-"+n.slice(6,8)+"T"+n.slice(9,11)+":"+n.slice(11,13)+":"+n.slice(13,15);return n[15]&&n[15]==="Z"&&(e+="Z"),e}},toICAL:function(n){let e=n.length;if(e==10&&!lt.strict)return qt.date.toICAL(n);if(e>=19){let t=n.slice(0,4)+n.slice(5,7)+n.slice(8,13)+n.slice(14,16)+n.slice(17,19);return n[19]&&n[19]==="Z"&&(t+="Z"),t}else return n},decorate:function(n,e){return lt.strict?oe.fromDateTimeString(n,e):oe.fromString(n,e)},undecorate:function(n){return n.toString()}},duration:{decorate:function(n){return Ps.fromString(n)},undecorate:function(n){return n.toString()}},period:{fromICAL:function(n){let e=n.split("/");return e[0]=qt["date-time"].fromICAL(e[0]),Ps.isValueString(e[1])||(e[1]=qt["date-time"].fromICAL(e[1])),e},toICAL:function(n){return n=n.slice(),!lt.strict&&n[0].length==10?n[0]=qt.date.toICAL(n[0]):n[0]=qt["date-time"].toICAL(n[0]),Ps.isValueString(n[1])||(!lt.strict&&n[1].length==10?n[1]=qt.date.toICAL(n[1]):n[1]=qt["date-time"].toICAL(n[1])),n.join("/")},decorate:function(n,e){return tp.fromJSON(n,e,!lt.strict)},undecorate:function(n){return n.toJSON()}},recur:{fromICAL:function(n){return Cn._stringToData(n,!0)},toICAL:function(n){let e="";for(let[t,r]of Object.entries(n))t=="until"?r.length>10?r=qt["date-time"].toICAL(r):r=qt.date.toICAL(r):t=="wkst"?typeof r=="number"&&(r=Cn.numericDayToIcalDay(r)):Array.isArray(r)&&(r=r.join(",")),e+=t.toUpperCase()+"="+r+";";return e.slice(0,Math.max(0,e.length-1))},decorate:function(e){return Cn.fromData(e)},undecorate:function(n){return n.toJSON()}},time:{fromICAL:function(n){if(n.length<6)return n;let e=n.slice(0,2)+":"+n.slice(2,4)+":"+n.slice(4,6);return n[6]==="Z"&&(e+="Z"),e},toICAL:function(n){if(n.length<8)return n;let e=n.slice(0,2)+n.slice(3,5)+n.slice(6,8);return n[8]==="Z"&&(e+="Z"),e}}}),z6=ll(xS,{action:Ke,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:Ke,class:Ke,comment:Ke,completed:$y,contact:Ke,created:$y,description:Ke,dtend:Wy,dtstamp:$y,dtstart:Wy,due:Wy,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:AB,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":$y,location:Ke,method:Ke,organizer:{defaultType:"cal-address"},"percent-complete":Uy,priority:Uy,prodid:Ke,"related-to":Ke,repeat:Uy,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function(n){return n.indexOf("/")!==-1?"period":n.indexOf("T")===-1?"date":"date-time"}},"recurrence-id":Wy,resources:np,"request-status":Qy,rrule:AB,sequence:Uy,status:Ke,summary:Ke,transp:Ke,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:_B,tzoffsetto:_B,tzurl:os,tzid:Ke,tzname:Ke}),As=ll(MS,{text:DS(xB,MB),uri:DS(xB,MB),date:{decorate:function(n){return nl.fromDateAndOrTimeString(n,"date")},undecorate:function(n){return n.toString()},fromICAL:function(n){return n.length==8?qt.date.fromICAL(n):n[0]=="-"&&n.length==6?n.slice(0,4)+"-"+n.slice(4):n},toICAL:function(n){return n.length==10?qt.date.toICAL(n):n[0]=="-"&&n.length==7?n.slice(0,4)+n.slice(5):n}},time:{decorate:function(n){return nl.fromDateAndOrTimeString("T"+n,"time")},undecorate:function(n){return n.toString()},fromICAL:function(n){let e=As.time._splitZone(n,!0),t=e[0],r=e[1];return r.length==6?r=r.slice(0,2)+":"+r.slice(2,4)+":"+r.slice(4,6):r.length==4&&r[0]!="-"?r=r.slice(0,2)+":"+r.slice(2,4):r.length==5&&(r=r.slice(0,3)+":"+r.slice(3,5)),t.length==5&&(t[0]=="-"||t[0]=="+")&&(t=t.slice(0,3)+":"+t.slice(3)),r+t},toICAL:function(n){let e=As.time._splitZone(n),t=e[0],r=e[1];return r.length==8?r=r.slice(0,2)+r.slice(3,5)+r.slice(6,8):r.length==5&&r[0]!="-"?r=r.slice(0,2)+r.slice(3,5):r.length==6&&(r=r.slice(0,3)+r.slice(4,6)),t.length==6&&(t[0]=="-"||t[0]=="+")&&(t=t.slice(0,3)+t.slice(4)),r+t},_splitZone:function(n,e){let t=n.length-1,r=n.length-(e?5:6),s=n[r],i,a;return n[t]=="Z"?(i=n[t],a=n.slice(0,Math.max(0,t))):n.length>6&&(s=="-"||s=="+")?(i=n.slice(r),a=n.slice(0,Math.max(0,r))):(i="",a=n),[i,a]}},"date-time":{decorate:function(n){return nl.fromDateAndOrTimeString(n,"date-time")},undecorate:function(n){return n.toString()},fromICAL:function(n){return As["date-and-or-time"].fromICAL(n)},toICAL:function(n){return As["date-and-or-time"].toICAL(n)}},"date-and-or-time":{decorate:function(n){return nl.fromDateAndOrTimeString(n,"date-and-or-time")},undecorate:function(n){return n.toString()},fromICAL:function(n){let e=n.split("T");return(e[0]?As.date.fromICAL(e[0]):"")+(e[1]?"T"+As.time.fromICAL(e[1]):"")},toICAL:function(n){let e=n.split("T");return As.date.toICAL(e[0])+(e[1]?"T"+As.time.toICAL(e[1]):"")}},timestamp:qt["date-time"],"language-tag":{matches:/^[a-zA-Z0-9-]+$/},"phone-number":{fromICAL:function(n){return Array.from(n).filter(function(e){return e==="\\"?void 0:e}).join("")},toICAL:function(n){return Array.from(n).map(function(e){return e===","||e===";"?"\\"+e:e}).join("")}}}),q6={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},G6=ll(xS,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:PB,bday:PB,caladruri:os,caluri:os,clientpidmap:Qy,email:Ke,fburl:os,fn:Ke,gender:Qy,geo:os,impp:os,key:os,kind:Ke,lang:{defaultType:"language-tag"},logo:os,member:os,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:np,note:Ke,org:{defaultType:"text",structuredValue:";"},photo:os,related:os,rev:{defaultType:"timestamp"},role:Ke,sound:os,source:os,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:Ke,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:Ke}),Q6=ll(MS,{binary:qt.binary,date:As.date,"date-time":As["date-time"],"phone-number":As["phone-number"],uri:qt.uri,text:As.text,time:qt.time,vcard:qt.text,"utc-offset":{toICAL:function(n){return n.slice(0,7)},fromICAL:function(n){return n.slice(0,7)},decorate:function(n){return Vi.fromString(n)},undecorate:function(n){return n.toString()}}}),K6={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},Z6=ll(xS,{fn:Ke,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:np,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(n){return n.indexOf("T")===-1?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:Ke,tel:{defaultType:"phone-number"},email:Ke,mailer:Ke,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:Ke,role:Ke,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:Qy,note:np,prodid:Ke,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(n){return n.indexOf("T")===-1?"date":"date-time"}},"sort-string":Ke,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:Ke,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),$i={name:"ical",value:qt,param:Y6,property:z6,propertyGroups:!1},IB={name:"vcard4",value:As,param:q6,property:G6,propertyGroups:!0},RB={name:"vcard3",value:Q6,param:K6,property:Z6,propertyGroups:!0},lt={strict:!0,defaultSet:$i,defaultType:"unknown",components:{vcard:IB,vcard3:RB,vevent:$i,vtodo:$i,vjournal:$i,valarm:$i,vtimezone:$i,daylight:$i,standard:$i},icalendar:$i,vcard:IB,vcard3:RB,getDesignSet:function(n){return n&&n in lt.components?lt.components[n]:lt.defaultSet}},Yy=`\r
`,NB="unknown",J6={'"':"^'","\n":"^n","^":"^^"};function Mt(n){typeof n[0]=="string"&&(n=[n]);let e=0,t=n.length,r="";for(;e<t;e++)r+=Mt.component(n[e])+Yy;return r}Mt.component=function(n,e){let t=n[0].toUpperCase(),r="BEGIN:"+t+Yy,s=n[1],i=0,a=s.length,o=n[0];for(o==="vcard"&&n[1].length>0&&!(n[1][0][0]==="version"&&n[1][0][3]==="4.0")&&(o="vcard3"),e=e||lt.getDesignSet(o);i<a;i++)r+=Mt.property(s[i],e)+Yy;let l=n[2]||[],c=0,d=l.length;for(;c<d;c++)r+=Mt.component(l[c],e)+Yy;return r+="END:"+t,r};Mt.property=function(n,e,t){let r=n[0].toUpperCase(),s=n[0],i=n[1];e||(e=lt.defaultSet);let a=i.group,o;e.propertyGroups&&a?o=a.toUpperCase()+"."+r:o=r;for(let[f,p]of Object.entries(i)){if(e.propertyGroups&&f=="group")continue;let m=e.param[f],g=m&&m.multiValue;g&&Array.isArray(p)?(p=p.map(function(y){return y=Mt._rfc6868Unescape(y),y=Mt.paramPropertyValue(y,m.multiValueSeparateDQuote),y}),p=Mt.multiValue(p,g,"unknown",null,e)):(p=Mt._rfc6868Unescape(p),p=Mt.paramPropertyValue(p)),o+=";"+f.toUpperCase()+"="+p}if(n.length===3)return o+":";let l=n[2],c,d=!1,u=!1,h=!1;return s in e.property?(c=e.property[s],"multiValue"in c&&(d=c.multiValue),"structuredValue"in c&&Array.isArray(n[3])&&(u=c.structuredValue),"defaultType"in c?l===c.defaultType&&(h=!0):l===NB&&(h=!0)):l===NB&&(h=!0),h||(o+=";VALUE="+l.toUpperCase()),o+=":",d&&u?o+=Mt.multiValue(n[3],u,l,d,e,u):d?o+=Mt.multiValue(n.slice(3),d,l,null,e,!1):u?o+=Mt.multiValue(n[3],u,l,null,e,u):o+=Mt.value(n[3],l,e,!1),t?o:BB(o)};Mt.paramPropertyValue=function(n,e){return!e&&n.indexOf(",")===-1&&n.indexOf(":")===-1&&n.indexOf(";")===-1?n:'"'+n+'"'};Mt.multiValue=function(n,e,t,r,s,i){let a="",o=n.length,l=0;for(;l<o;l++)r&&Array.isArray(n[l])?a+=Mt.multiValue(n[l],r,t,null,s,i):a+=Mt.value(n[l],t,s,i),l!==o-1&&(a+=e);return a};Mt.value=function(n,e,t,r){return e in t.value&&"toICAL"in t.value[e]?t.value[e].toICAL(n,r):n};Mt._rfc6868Unescape=function(n){return n.replace(/[\n^"]/g,function(e){return J6[e]})};var OB=0,jy=1,Vy=2,Ha=3,al=class n{static fromString(e,t){return new n(st.property(e,t))}constructor(e,t){this._parent=t||null,typeof e=="string"?(this.jCal=[e,{},lt.defaultType],this.jCal[Vy]=this.getDefaultType()):this.jCal=e,this._updateType()}get type(){return this.jCal[Vy]}get name(){return this.jCal[OB]}get parent(){return this._parent}set parent(e){let t=!this._parent||e&&e._designSet!=this._parent._designSet;this._parent=e,this.type==lt.defaultType&&t&&(this.jCal[Vy]=this.getDefaultType(),this._updateType())}get _designSet(){return this.parent?this.parent._designSet:lt.defaultSet}_updateType(){let e=this._designSet;this.type in e.value&&("decorate"in e.value[this.type]?this.isDecorated=!0:this.isDecorated=!1,this.name in e.property&&(this.isMultiValue="multiValue"in e.property[this.name],this.isStructuredValue="structuredValue"in e.property[this.name]))}_hydrateValue(e){return this._values&&this._values[e]?this._values[e]:this.jCal.length<=Ha+e?null:this.isDecorated?(this._values||(this._values=[]),this._values[e]=this._decorate(this.jCal[Ha+e])):this.jCal[Ha+e]}_decorate(e){return this._designSet.value[this.type].decorate(e,this)}_undecorate(e){return this._designSet.value[this.type].undecorate(e,this)}_setDecoratedValue(e,t){this._values||(this._values=[]),typeof e=="object"&&"icaltype"in e?(this.jCal[Ha+t]=this._undecorate(e),this._values[t]=e):(this.jCal[Ha+t]=e,this._values[t]=this._decorate(e))}getParameter(e){if(e in this.jCal[jy])return this.jCal[jy][e]}getFirstParameter(e){let t=this.getParameter(e);return Array.isArray(t)?t[0]:t}setParameter(e,t){let r=e.toLowerCase();typeof t=="string"&&r in this._designSet.param&&"multiValue"in this._designSet.param[r]&&(t=[t]),this.jCal[jy][e]=t}removeParameter(e){delete this.jCal[jy][e]}getDefaultType(){let e=this.jCal[OB],t=this._designSet;if(e in t.property){let r=t.property[e];if("defaultType"in r)return r.defaultType}return lt.defaultType}resetType(e){this.removeAllValues(),this.jCal[Vy]=e,this._updateType()}getFirstValue(){return this._hydrateValue(0)}getValues(){let e=this.jCal.length-Ha;if(e<1)return[];let t=0,r=[];for(;t<e;t++)r[t]=this._hydrateValue(t);return r}removeAllValues(){this._values&&(this._values.length=0),this.jCal.length=3}setValues(e){if(!this.isMultiValue)throw new Error(this.name+`: does not not support mulitValue.
override isMultiValue`);let t=e.length,r=0;if(this.removeAllValues(),t>0&&typeof e[0]=="object"&&"icaltype"in e[0]&&this.resetType(e[0].icaltype),this.isDecorated)for(;r<t;r++)this._setDecoratedValue(e[r],r);else for(;r<t;r++)this.jCal[Ha+r]=e[r]}setValue(e){this.removeAllValues(),typeof e=="object"&&"icaltype"in e&&this.resetType(e.icaltype),this.isDecorated?this._setDecoratedValue(e,0):this.jCal[Ha]=e}toJSON(){return this.jCal}toICALString(){return Mt.property(this.jCal,this._designSet,!0)}},Ua=0,ai=1,Wa=2,X6=0,e4=3,sn=class n{constructor(e,t){I(this,"_hydratedPropertyCount",0);I(this,"_hydratedComponentCount",0);I(this,"_timezoneCache",null);I(this,"_components",null);I(this,"_properties",null);typeof e=="string"&&(e=[e,[],[]]),this.jCal=e,this.parent=t||null,!this.parent&&this.name==="vcalendar"&&(this._timezoneCache=new Map)}static fromString(e){return new n(st.component(e))}get name(){return this.jCal[Ua]}get _designSet(){var t;let e=this.parent&&this.parent._designSet;if(!e&&this.name=="vcard"){let r=(t=this.jCal[ai])==null?void 0:t[0];if(r&&r[X6]=="version"&&r[e4]=="3.0")return lt.getDesignSet("vcard3")}return e||lt.getDesignSet(this.name)}_hydrateComponent(e){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[e])return this._components[e];let t=new n(this.jCal[Wa][e],this);return this._hydratedComponentCount++,this._components[e]=t}_hydrateProperty(e){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[e])return this._properties[e];let t=new al(this.jCal[ai][e],this);return this._hydratedPropertyCount++,this._properties[e]=t}getFirstSubcomponent(e){if(e){let t=0,r=this.jCal[Wa],s=r.length;for(;t<s;t++)if(r[t][Ua]===e)return this._hydrateComponent(t)}else if(this.jCal[Wa].length)return this._hydrateComponent(0);return null}getAllSubcomponents(e){let t=this.jCal[Wa].length,r=0;if(e){let s=this.jCal[Wa],i=[];for(;r<t;r++)e===s[r][Ua]&&i.push(this._hydrateComponent(r));return i}else{if(!this._components||this._hydratedComponentCount!==t)for(;r<t;r++)this._hydrateComponent(r);return this._components||[]}}hasProperty(e){let t=this.jCal[ai],r=t.length,s=0;for(;s<r;s++)if(t[s][Ua]===e)return!0;return!1}getFirstProperty(e){if(e){let t=0,r=this.jCal[ai],s=r.length;for(;t<s;t++)if(r[t][Ua]===e)return this._hydrateProperty(t)}else if(this.jCal[ai].length)return this._hydrateProperty(0);return null}getFirstPropertyValue(e){let t=this.getFirstProperty(e);return t?t.getFirstValue():null}getAllProperties(e){let t=this.jCal[ai].length,r=0;if(e){let s=this.jCal[ai],i=[];for(;r<t;r++)e===s[r][Ua]&&i.push(this._hydrateProperty(r));return i}else{if(!this._properties||this._hydratedPropertyCount!==t)for(;r<t;r++)this._hydrateProperty(r);return this._properties||[]}}_removeObjectByIndex(e,t,r){if(t=t||[],t[r]){let s=t[r];"parent"in s&&(s.parent=null)}t.splice(r,1),this.jCal[e].splice(r,1)}_removeObject(e,t,r){let s=0,i=this.jCal[e],a=i.length,o=this[t];if(typeof r=="string"){for(;s<a;s++)if(i[s][Ua]===r)return this._removeObjectByIndex(e,o,s),!0}else if(o){for(;s<a;s++)if(o[s]&&o[s]===r)return this._removeObjectByIndex(e,o,s),!0}return!1}_removeAllObjects(e,t,r){let s=this[t],i=this.jCal[e],a=i.length-1;for(;a>=0;a--)(!r||i[a][Ua]===r)&&this._removeObjectByIndex(e,s,a)}addSubcomponent(e){this._components||(this._components=[],this._hydratedComponentCount=0),e.parent&&e.parent.removeSubcomponent(e);let t=this.jCal[Wa].push(e.jCal);return this._components[t-1]=e,this._hydratedComponentCount++,e.parent=this,e}removeSubcomponent(e){let t=this._removeObject(Wa,"_components",e);return t&&this._hydratedComponentCount--,t}removeAllSubcomponents(e){let t=this._removeAllObjects(Wa,"_components",e);return this._hydratedComponentCount=0,t}addProperty(e){if(!(e instanceof al))throw new TypeError("must be instance of ICAL.Property");this._properties||(this._properties=[],this._hydratedPropertyCount=0),e.parent&&e.parent.removeProperty(e);let t=this.jCal[ai].push(e.jCal);return this._properties[t-1]=e,this._hydratedPropertyCount++,e.parent=this,e}addPropertyWithValue(e,t){let r=new al(e);return r.setValue(t),this.addProperty(r),r}updatePropertyWithValue(e,t){let r=this.getFirstProperty(e);return r?r.setValue(t):r=this.addPropertyWithValue(e,t),r}removeProperty(e){let t=this._removeObject(ai,"_properties",e);return t&&this._hydratedPropertyCount--,t}removeAllProperties(e){let t=this._removeAllObjects(ai,"_properties",e);return this._hydratedPropertyCount=0,t}toJSON(){return this.jCal}toString(){return Mt.component(this.jCal,this._designSet)}getTimeZoneByID(e){if(this.parent)return this.parent.getTimeZoneByID(e);if(!this._timezoneCache)return null;if(this._timezoneCache.has(e))return this._timezoneCache.get(e);let t=this.getAllSubcomponents("vtimezone");for(let r of t)if(r.getFirstProperty("tzid").getFirstValue()===e){let s=new ot({component:r,tzid:e});return this._timezoneCache.set(e,s),s}return null}},Ky=class{constructor(e){I(this,"complete",!1);I(this,"ruleIterators",null);I(this,"ruleDates",null);I(this,"exDates",null);I(this,"ruleDateInc",0);I(this,"exDateInc",0);I(this,"exDate",null);I(this,"ruleDate",null);I(this,"dtstart",null);I(this,"last",null);this.ruleDates=[],this.exDates=[],this.fromData(e)}fromData(e){let t=ji(e.dtstart,oe);if(t)this.dtstart=t;else throw new Error(".dtstart (ICAL.Time) must be given");if(e.component)this._init(e.component);else{if(this.last=ji(e.last,oe)||t.clone(),!e.ruleIterators)throw new Error(".ruleIterators or .component must be given");this.ruleIterators=e.ruleIterators.map(function(r){return ji(r,sp)}),this.ruleDateInc=e.ruleDateInc,this.exDateInc=e.exDateInc,e.ruleDates&&(this.ruleDates=e.ruleDates.map(r=>ji(r,oe)),this.ruleDate=this.ruleDates[this.ruleDateInc]),e.exDates&&(this.exDates=e.exDates.map(r=>ji(r,oe)),this.exDate=this.exDates[this.exDateInc]),typeof e.complete!="undefined"&&(this.complete=e.complete)}}_compare_special(e,t){return!e.isDate&&t.isDate?new oe({year:e.year,month:e.month,day:e.day}).compare(t):e.compare(t)}next(){let e,t,r,s=500,i=0;for(;;){if(i++>s)throw new Error("max tries have occurred, rule may be impossible to fulfill.");if(t=this.ruleDate,e=this._nextRecurrenceIter(this.last),!t&&!e){this.complete=!0;break}if((!t||e&&t.compare(e.last)>0)&&(t=e.last.clone(),e.next()),this.ruleDate===t&&this._nextRuleDay(),this.last=t,this.exDate&&(r=this._compare_special(this.last,this.exDate),r>0&&this._nextExDay(),r===0)){this._nextExDay();continue}return this.last}}toJSON(){function e(r){return r.toJSON()}let t=Object.create(null);return t.ruleIterators=this.ruleIterators.map(e),this.ruleDates&&(t.ruleDates=this.ruleDates.map(e)),this.exDates&&(t.exDates=this.exDates.map(e)),t.ruleDateInc=this.ruleDateInc,t.exDateInc=this.exDateInc,t.last=this.last.toJSON(),t.dtstart=this.dtstart.toJSON(),t.complete=this.complete,t}_extractDates(e,t){let r=[],s=e.getAllProperties(t);for(let i=0,a=s.length;i<a;i++)for(let o of s[i].getValues()){let l=il(r,o,(c,d)=>c.compare(d));r.splice(l,0,o)}return r}_init(e){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!e.hasProperty("rdate")&&!e.hasProperty("rrule")&&!e.hasProperty("recurrence-id")){this.ruleDate=this.last.clone(),this.complete=!0;return}if(e.hasProperty("rdate")&&(this.ruleDates=this._extractDates(e,"rdate"),this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=il(this.ruleDates,this.last,(t,r)=>t.compare(r)),this.ruleDate=this.ruleDates[this.ruleDateInc]),e.hasProperty("rrule")){let t=e.getAllProperties("rrule"),r=0,s=t.length,i,a;for(;r<s;r++)i=t[r].getFirstValue(),a=i.iterator(this.dtstart),this.ruleIterators.push(a),a.next()}e.hasProperty("exdate")&&(this.exDates=this._extractDates(e,"exdate"),this.exDateInc=il(this.exDates,this.last,this._compare_special),this.exDate=this.exDates[this.exDateInc])}_nextExDay(){this.exDate=this.exDates[++this.exDateInc]}_nextRuleDay(){this.ruleDate=this.ruleDates[++this.ruleDateInc]}_nextRecurrenceIter(){let e=this.ruleIterators;if(e.length===0)return null;let t=e.length,r,s,i=0,a;for(;i<t;i++){if(r=e[i],s=r.last,r.completed){t--,i!==0&&i--,e.splice(i,1);continue}(!a||a.last.compare(s)>0)&&(a=r)}return a}},ep=class ep{constructor(e,t){I(this,"exceptions",null);I(this,"strictExceptions",!1);e instanceof sn||(t=e,e=null),e?this.component=e:this.component=new sn("vevent"),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],t&&t.strictExceptions&&(this.strictExceptions=t.strictExceptions),t&&t.exceptions?t.exceptions.forEach(this.relateException,this):this.component.parent&&!this.isRecurrenceException()&&this.component.parent.getAllSubcomponents("vevent").forEach(function(r){r.hasProperty("recurrence-id")&&this.relateException(r)},this)}relateException(e){if(this.isRecurrenceException())throw new Error("cannot relate exception to exceptions");if(e instanceof sn&&(e=new ep(e)),this.strictExceptions&&e.uid!==this.uid)throw new Error("attempted to relate unrelated exception");let t=e.recurrenceId.toString();if(this.exceptions[t]=e,e.modifiesFuture()){let r=[e.recurrenceId.toUnixTime(),t],s=il(this.rangeExceptions,r,LB);this.rangeExceptions.splice(s,0,r)}}modifiesFuture(){return this.component.hasProperty("recurrence-id")?this.component.getFirstProperty("recurrence-id").getParameter("range")===ep.THISANDFUTURE:!1}findRangeException(e){if(!this.rangeExceptions.length)return null;let t=e.toUnixTime(),r=il(this.rangeExceptions,[t],LB);if(r-=1,r<0)return null;let s=this.rangeExceptions[r];return t<s[0]?null:s[1]}getOccurrenceDetails(e){let t=e.toString(),r=e.convertToZone(ot.utcTimezone).toString(),s,i={recurrenceId:e};if(t in this.exceptions)s=i.item=this.exceptions[t],i.startDate=s.startDate,i.endDate=s.endDate,i.item=s;else if(r in this.exceptions)s=this.exceptions[r],i.startDate=s.startDate,i.endDate=s.endDate,i.item=s;else{let a=this.findRangeException(e),o;if(a){let l=this.exceptions[a];i.item=l;let c=this._rangeExceptionCache[a];if(!c){let u=l.recurrenceId.clone(),h=l.startDate.clone();u.zone=h.zone,c=h.subtractDate(u),this._rangeExceptionCache[a]=c}let d=e.clone();d.zone=l.startDate.zone,d.addDuration(c),o=d.clone(),o.addDuration(l.duration),i.startDate=d,i.endDate=o}else o=e.clone(),o.addDuration(this.duration),i.endDate=o,i.startDate=e,i.item=this}return i}iterator(e){return new Ky({component:this.component,dtstart:e||this.startDate})}isRecurring(){let e=this.component;return e.hasProperty("rrule")||e.hasProperty("rdate")}isRecurrenceException(){return this.component.hasProperty("recurrence-id")}getRecurrenceTypes(){let e=this.component.getAllProperties("rrule"),t=0,r=e.length,s=Object.create(null);for(;t<r;t++){let i=e[t].getFirstValue();s[i.freq]=!0}return s}get uid(){return this._firstProp("uid")}set uid(e){this._setProp("uid",e)}get startDate(){return this._firstProp("dtstart")}set startDate(e){this._setTime("dtstart",e)}get endDate(){let e=this._firstProp("dtend");if(!e){let t=this._firstProp("duration");e=this.startDate.clone(),t?e.addDuration(t):e.isDate&&(e.day+=1)}return e}set endDate(e){this.component.hasProperty("duration")&&this.component.removeProperty("duration"),this._setTime("dtend",e)}get duration(){let e=this._firstProp("duration");return e||this.endDate.subtractDateTz(this.startDate)}set duration(e){this.component.hasProperty("dtend")&&this.component.removeProperty("dtend"),this._setProp("duration",e)}get location(){return this._firstProp("location")}set location(e){this._setProp("location",e)}get attendees(){return this.component.getAllProperties("attendee")}get summary(){return this._firstProp("summary")}set summary(e){this._setProp("summary",e)}get description(){return this._firstProp("description")}set description(e){this._setProp("description",e)}get color(){return this._firstProp("color")}set color(e){this._setProp("color",e)}get organizer(){return this._firstProp("organizer")}set organizer(e){this._setProp("organizer",e)}get sequence(){return this._firstProp("sequence")}set sequence(e){this._setProp("sequence",e)}get recurrenceId(){return this._firstProp("recurrence-id")}set recurrenceId(e){this._setTime("recurrence-id",e)}_setTime(e,t){let r=this.component.getFirstProperty(e);r||(r=new al(e),this.component.addProperty(r)),t.zone===ot.localTimezone||t.zone===ot.utcTimezone?r.removeParameter("tzid"):r.setParameter("tzid",t.zone.tzid),r.setValue(t)}_setProp(e,t){this.component.updatePropertyWithValue(e,t)}_firstProp(e){return this.component.getFirstPropertyValue(e)}toString(){return this.component.toString()}};I(ep,"THISANDFUTURE","THISANDFUTURE");var Zy=ep;function LB(n,e){return n[0]>e[0]?1:e[0]>n[0]?-1:0}var CS=class{constructor(e){I(this,"parseEvent",!0);I(this,"parseTimezone",!0);I(this,"oncomplete",function(){});I(this,"onerror",function(e){});I(this,"ontimezone",function(e){});I(this,"onevent",function(e){});typeof e=="undefined"&&(e={});for(let[t,r]of Object.entries(e))this[t]=r}process(e){typeof e=="string"&&(e=st(e)),e instanceof sn||(e=new sn(e));let t=e.getAllSubcomponents(),r=0,s=t.length,i;for(;r<s;r++)switch(i=t[r],i.name){case"vtimezone":if(this.parseTimezone){let a=i.getFirstPropertyValue("tzid");a&&this.ontimezone(new ot({tzid:a,component:i}))}break;case"vevent":this.parseEvent&&this.onevent(new Zy(i));break;default:continue}this.oncomplete()}},oi={foldLength:75,debug:!1,newLineChar:`\r
`,Binary:zy,Component:sn,ComponentParser:CS,Duration:Ps,Event:Zy,Period:tp,Property:al,Recur:Cn,RecurExpansion:Ky,RecurIterator:sp,Time:oe,Timezone:ot,TimezoneService:Gy,UtcOffset:Vi,VCardTime:nl,parse:st,stringify:Mt,design:lt,helpers:F6};var Jy=class extends ri{constructor(t){super();this.subscriptions=[];this.cache=new Map;this.refreshTimers=new Map;this.fileWatchers=new Map;this.plugin=t}async initialize(){await this.loadSubscriptions(),this.subscriptions.forEach(t=>{t.enabled&&(t.type==="remote"?this.startRefreshTimer(t):t.type==="local"&&this.startFileWatcher(t))}),this.emit("data-changed")}async loadSubscriptions(){try{let t=await this.plugin.loadData();this.subscriptions=(t==null?void 0:t.icsSubscriptions)||[]}catch(t){console.error("Failed to load ICS subscriptions:",t),this.subscriptions=[]}}async saveSubscriptions(){try{let t=await this.plugin.loadData()||{};t.icsSubscriptions=this.subscriptions,await this.plugin.saveData(t)}catch(t){throw console.error("Failed to save ICS subscriptions:",t),t}}getSubscriptions(){return[...this.subscriptions]}async addSubscription(t){let r={...t,id:this.generateId()};return this.subscriptions.push(r),await this.saveSubscriptions(),r.enabled&&(r.type==="remote"?(this.startRefreshTimer(r),await this.fetchSubscription(r.id)):r.type==="local"&&(this.startFileWatcher(r),await this.fetchSubscription(r.id))),this.emit("data-changed"),r}async updateSubscription(t,r){let s=this.subscriptions.findIndex(o=>o.id===t);if(s===-1)throw new Error("Subscription not found");let i=this.subscriptions[s],a={...i,...r};this.subscriptions[s]=a,await this.saveSubscriptions(),this.stopRefreshTimer(t),this.stopFileWatcher(t),a.enabled&&(a.type==="remote"?this.startRefreshTimer(a):a.type==="local"&&this.startFileWatcher(a)),(r.url&&r.url!==i.url||r.filePath&&r.filePath!==i.filePath)&&this.cache.delete(t),this.emit("data-changed")}async removeSubscription(t){let r=this.subscriptions.findIndex(s=>s.id===t);if(r===-1)throw new Error("Subscription not found");this.subscriptions.splice(r,1),await this.saveSubscriptions(),this.stopRefreshTimer(t),this.stopFileWatcher(t),this.cache.delete(t),this.emit("data-changed")}async fetchSubscription(t){let r=this.subscriptions.find(s=>s.id===t);if(!(!r||!r.enabled))try{let s;if(r.type==="remote"){if(!r.url)throw new Error("Remote subscription missing URL");s=(await(0,zi.requestUrl)({url:r.url,method:"GET",headers:{Accept:"text/calendar,*/*;q=0.1","Accept-Language":"en-US,en;q=0.9","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}})).text}else if(r.type==="local"){if(!r.filePath)throw new Error("Local subscription missing file path");s=await this.readLocalICSFile(r.filePath)}else throw new Error("Unknown subscription type");let i=this.parseICS(s,r.id),a={subscriptionId:t,events:i,lastUpdated:new Date().toISOString(),expires:new Date(Date.now()+r.refreshInterval*60*1e3).toISOString()};this.cache.set(t,a),await this.updateSubscription(t,{lastFetched:new Date().toISOString(),lastError:void 0}),this.emit("data-changed")}catch(s){let i=s instanceof Error?s.message:String(s);await this.updateSubscription(t,{lastError:i}),r.type==="remote"?i.includes("404")?new zi.Notice(`Calendar "${r.name}" not found (404). Please check the ICS URL is correct and the calendar is publicly accessible.`):i.includes("500")||i.includes("OwaBasicUnsupportedException")?new zi.Notice(`Calendar "${r.name}" access denied (500). This may be due to Microsoft Outlook server restrictions. Try regenerating the ICS URL from your calendar settings.`):new zi.Notice(`Failed to fetch remote calendar "${r.name}": ${i}`):new zi.Notice(`Failed to read local calendar "${r.name}": ${i}`)}}parseICS(t,r){try{let s=oi.parse(t),i=new oi.Component(s);i.getAllSubcomponents("vtimezone").forEach(d=>{oi.TimezoneService.register(d)});let o=i.getAllSubcomponents("vevent"),l=[],c=new Map;return o.forEach(d=>{let u=new oi.Event(d),h=u.uid;if(!h)return;let f=d.getFirstPropertyValue("recurrence-id");if(f){c.has(h)||c.set(h,new Map);let p=f.toString();c.get(h).set(p,u)}}),o.forEach(d=>{try{let u=new oi.Event(d);if(d.getFirstPropertyValue("recurrence-id"))return;let f=u.summary||"Untitled Event",p=u.description||void 0,m=u.location||void 0,g=u.startDate,y=u.endDate;if(!g)return;let T=g.isDate,w=g.toJSDate().toISOString(),b=y?y.toJSDate().toISOString():void 0,S=u.uid||`${r}-${l.length}`,k=`${r}-${S}`,D={id:k,subscriptionId:r,title:f,description:p,start:w,end:b,allDay:T,location:m,url:u.url||void 0};if(u.isRecurring()){let M=new Set;d.getAllProperties("exdate").forEach(U=>{let H=U.getFirstValue();H&&(Array.isArray(H)?H:[H]).forEach(z=>{z&&typeof z.toString=="function"&&M.add(z.toString())})});let W=c.get(S)||new Map,j=u.iterator(g),R=new oi.Time;R.fromJSDate(new Date(Date.now()+365*24*60*60*1e3));let O,C=0,P=100;for(;(O=j.next())&&C<P&&!(O.compare(R)>0);){let U=O.toString();if(M.has(U)){C++;continue}let H=W.get(U);if(H){let Y=H.startDate,z=H.endDate;Y&&l.push({id:`${k}-${C}`,subscriptionId:r,title:H.summary||f,description:H.description||p,start:Y.toJSDate().toISOString(),end:z?z.toJSDate().toISOString():void 0,allDay:Y.isDate,location:H.location||m,url:H.url||D.url})}else{let Y=O.toJSDate().toISOString(),z=b;if(y&&g){let ne=y.toJSDate().getTime()-g.toJSDate().getTime();z=new Date(O.toJSDate().getTime()+ne).toISOString()}l.push({...D,id:`${k}-${C}`,start:Y,end:z})}C++}}else l.push(D)}catch(u){console.warn("Failed to parse individual event:",u)}}),l}catch(s){throw console.error("Failed to parse ICS data:",s),new Error("Invalid ICS format")}}getAllEvents(){let t=[];return this.cache.forEach(r=>{new Date(r.expires)>new Date&&t.push(...r.events)}),t}getEventsForSubscription(t){let r=this.cache.get(t);return!r||new Date(r.expires)<=new Date?[]:[...r.events]}async refreshAllSubscriptions(){let t=this.subscriptions.filter(r=>r.enabled);for(let r of t)await this.fetchSubscription(r.id)}async readLocalICSFile(t){try{let r=this.plugin.app.vault.getAbstractFileByPath(t);if(!r||!(r instanceof zi.TFile))throw new Error(`File not found: ${t}`);if(r.extension!=="ics")throw new Error(`File is not an ICS file: ${t}`);return await this.plugin.app.vault.cachedRead(r)}catch(r){throw new Error(`Failed to read local ICS file "${t}": ${r instanceof Error?r.message:String(r)}`)}}startFileWatcher(t){if(!t.filePath)return;this.stopFileWatcher(t.id);let r=(c,d)=>{(c.path===t.filePath||d===t.filePath)&&setTimeout(()=>{this.fetchSubscription(t.id)},1e3)},s=this.plugin.app.vault.on("modify",r),i=this.plugin.app.vault.on("rename",r),a=this.plugin.app.vault.on("delete",c=>{c.path===t.filePath&&this.updateSubscription(t.id,{lastError:"Local ICS file was deleted"})});this.fileWatchers.set(t.id,()=>{this.plugin.app.vault.offref(s),this.plugin.app.vault.offref(i),this.plugin.app.vault.offref(a)});let o=t.refreshInterval*60*1e3,l=setInterval(()=>{this.fetchSubscription(t.id)},o);this.refreshTimers.set(t.id,l)}stopFileWatcher(t){let r=this.fileWatchers.get(t);r&&(r(),this.fileWatchers.delete(t))}async refreshSubscription(t){await this.fetchSubscription(t)}startRefreshTimer(t){this.stopRefreshTimer(t.id);let r=t.refreshInterval*60*1e3,s=setInterval(()=>{this.fetchSubscription(t.id)},r);this.refreshTimers.set(t.id,s)}stopRefreshTimer(t){let r=this.refreshTimers.get(t);r&&(clearInterval(r),this.refreshTimers.delete(t))}generateId(){return"ics_"+Math.random().toString(36).substring(2,11)+Date.now().toString(36)}destroy(){this.refreshTimers.forEach(t=>clearInterval(t)),this.refreshTimers.clear(),this.fileWatchers.forEach(t=>t()),this.fileWatchers.clear(),this.cache.clear(),this.removeAllListeners()}getLocalICSFiles(){return this.plugin.app.vault.getFiles().filter(t=>t.extension==="ics").sort((t,r)=>t.path.localeCompare(r.path))}};var qi=require("obsidian");At();Fe();Lt();var Xy=class{constructor(e){this.plugin=e}async createTaskFromICS(e,t){try{let r=this.plugin.icsSubscriptionService.getSubscriptions().find(o=>o.id===e.subscriptionId),s=(r==null?void 0:r.name)||"Unknown Calendar",i=(t==null?void 0:t.scheduled)!==void 0?t.scheduled:this.computeScheduledFromICSEvent(e),a={title:(t==null?void 0:t.title)||e.title,status:(t==null?void 0:t.status)||this.plugin.settings.defaultTaskStatus,priority:(t==null?void 0:t.priority)||this.plugin.settings.defaultTaskPriority,due:(t==null?void 0:t.due)||void 0,scheduled:i,contexts:(t==null?void 0:t.contexts)||(e.location?[e.location]:void 0),projects:t==null?void 0:t.projects,tags:(t==null?void 0:t.tags)||[this.plugin.fieldMapper.toUserField("icsEventTag")],timeEstimate:(t==null?void 0:t.timeEstimate)||this.calculateEventDuration(e),details:(t==null?void 0:t.details)||this.buildICSEventDetails(e,s),icsEventId:[e.id],creationContext:"ics-event",dateCreated:Le(),dateModified:Le(),...t};return await this.plugin.taskService.createTask(a)}catch(r){let s=r instanceof Error?r.message:String(r);throw console.error("Error creating task from ICS event:",{error:s,icsEventId:e.id,icsEventTitle:e.title}),new Error(`Failed to create task from ICS event: ${s}`)}}computeScheduledFromICSEvent(e){try{if(!e.start)return;let t=new Date(e.start);return e.allDay?me(t):x(t,"yyyy-MM-dd'T'HH:mm")}catch(t){return console.warn("Failed to compute scheduled from ICS event start:",{start:e.start,error:t}),e.start}}async createNoteFromICS(e,t){var r;try{let s=this.plugin.icsSubscriptionService.getSubscriptions().find(w=>w.id===e.subscriptionId),i=(s==null?void 0:s.name)||"Unknown Calendar",a=(t==null?void 0:t.title)||`${e.title} - ${x(new Date(e.start),"PPP")}`,o=(t==null?void 0:t.folder)||((r=this.plugin.settings.icsIntegration)==null?void 0:r.defaultNoteFolder)||"",l={title:e.title,priority:"",status:"",date:new Date(e.start),dueDate:e.end,scheduledDate:e.start,icsEventTitle:e.title,icsEventLocation:e.location,icsEventDescription:e.description},c=YR(l,this.plugin.settings),d=await Mu(c,o,this.plugin.app.vault),u=o?`${o}/${d}.md`:`${d}.md`;o&&await Fl(this.plugin.app.vault,o);let h={title:a,priority:"",status:"",contexts:e.location?[e.location]:[],tags:[this.plugin.fieldMapper.toUserField("icsEventTag")],timeEstimate:0,dueDate:e.end||"",scheduledDate:e.start||"",details:e.description||"",parentNote:"",icsEventTitle:e.title,icsEventStart:e.start,icsEventEnd:e.end||"",icsEventLocation:e.location||"",icsEventDescription:e.description||"",icsEventUrl:e.url||"",icsEventSubscription:i,icsEventId:e.id},f={title:a,dateCreated:Le(),dateModified:Le(),tags:[this.plugin.fieldMapper.toUserField("icsEventTag")],[this.plugin.fieldMapper.toUserField("icsEventId")]:[e.id]},p=this.buildICSEventDetails(e,i);if(t!=null&&t.template)try{let w=(0,qi.normalizePath)(t.template.trim()),b=this.plugin.app.vault.getAbstractFileByPath(w.endsWith(".md")?w:`${w}.md`);if(b instanceof qi.TFile){let S=await this.plugin.app.vault.read(b),k=Iy(S,h);f={...f,...k.frontmatter},p=k.body||p}else console.warn(`ICS note template not found: ${w}`),new qi.Notice(`Template not found: ${w}`)}catch(w){console.error("Error processing ICS note template:",w),new qi.Notice(`Error processing template: ${t.template}`)}let g=`${Object.keys(f).length>0?`---
${Object.entries(f).map(([w,b])=>`${w}: ${this.formatYamlValue(b)}`).join(`
`)}
---

`:""}${p}`,y=await this.plugin.app.vault.create(u,g),T={title:a,path:y.path,tags:f.tags||[],createdDate:f.dateCreated,lastModified:Date.now()};return{file:y,noteInfo:T}}catch(s){let i=s instanceof Error?s.message:String(s);throw console.error("Error creating note from ICS event:",{error:i,icsEventId:e.id,icsEventTitle:e.title}),new Error(`Failed to create note from ICS event: ${i}`)}}async findRelatedNotes(e){try{let t=[],r=this.plugin.fieldMapper.toUserField("icsEventId"),s=await this.plugin.cacheManager.getAllTasks();for(let a of s)a.icsEventId&&a.icsEventId.includes(e.id)&&t.push(a);let i=this.plugin.app.vault.getMarkdownFiles();for(let a of i)try{let o=this.plugin.app.metadataCache.getFileCache(a),l=o==null?void 0:o.frontmatter,c=l==null?void 0:l[r],d=Array.isArray(c)?c.includes(e.id):c===e.id;if(l&&d){let u={title:l.title||a.basename,path:a.path,tags:l.tags||[],createdDate:l.dateCreated,lastModified:a.stat.mtime};t.push(u)}}catch(o){continue}return t}catch(t){return console.error("Error finding related notes for ICS event:",t),[]}}async linkNoteToICS(e,t){try{let r=this.plugin.app.vault.getAbstractFileByPath(e);if(!(r instanceof qi.TFile))throw new Error(`Cannot find note file: ${e}`);await this.plugin.app.fileManager.processFrontMatter(r,s=>{let i=this.plugin.fieldMapper.toUserField("icsEventId"),a=s[i];a?Array.isArray(a)||(a=[a]):a=[],a.includes(t.id)||a.push(t.id),s[i]=a,s.dateModified=Le()}),new qi.Notice(`Linked note to ICS event: ${t.title}`)}catch(r){let s=r instanceof Error?r.message:String(r);throw console.error("Error linking note to ICS event:",{error:s,notePath:e,icsEventId:t.id}),new Error(`Failed to link note to ICS event: ${s}`)}}buildICSEventDetails(e,t){let r=[];if(r.push(`# ${e.title}`),r.push(""),e.start){let s=new Date(e.start);r.push(`**Start:** ${x(s,"PPPp")}`)}if(e.end&&!e.allDay){let s=new Date(e.end);r.push(`**End:** ${x(s,"PPPp")}`)}return e.location&&r.push(`**Location:** ${e.location}`),r.push(`**Calendar:** ${t}`),e.description&&(r.push(""),r.push("## Description"),r.push(e.description)),e.url&&(r.push(""),r.push(`**Event URL:** ${e.url}`)),r.join(`
`)}formatYamlValue(e){return typeof e=="string"?e.includes(":")||e.includes("#")||e.includes("[")||e.includes("{")?`"${e.replace(/"/g,'\\"')}"`:e:Array.isArray(e)?`[${e.map(t=>typeof t=="string"?`"${t}"`:t).join(", ")}]`:String(e)}calculateEventDuration(e){if(!(!e.start||!e.end))try{let t=new Date(e.start).getTime(),r=new Date(e.end).getTime();if(isNaN(t)||isNaN(r))return;let s=r-t,i=Math.round(s/(1e3*60));return i>0&&i<1440?i:void 0}catch(t){console.warn("Error calculating event duration:",t);return}}};Lt();var ev=class{constructor(e){this.migrationInProgress=!1;this.app=e}async needsMigration(){var t;let e=this.app.vault.getMarkdownFiles().filter(r=>{var s,i;return r.path.includes("task")||((i=(s=this.app.metadataCache.getFileCache(r))==null?void 0:s.frontmatter)==null?void 0:i.status)});for(let r of e){let s=(t=this.app.metadataCache.getFileCache(r))==null?void 0:t.frontmatter;if(s!=null&&s.recurrence&&typeof s.recurrence=="object")return!0}return!1}async getMigrationCount(){var r;let e=this.app.vault.getMarkdownFiles().filter(s=>{var i,a;return s.path.includes("task")||((a=(i=this.app.metadataCache.getFileCache(s))==null?void 0:i.frontmatter)==null?void 0:a.status)}),t=0;for(let s of e){let i=(r=this.app.metadataCache.getFileCache(s))==null?void 0:r.frontmatter;i!=null&&i.recurrence&&typeof i.recurrence=="object"&&t++}return t}async performMigration(e){if(this.migrationInProgress)throw new Error("Migration already in progress");this.migrationInProgress=!0;let t=[],r=0;try{let s=this.app.vault.getMarkdownFiles().filter(a=>{var l;let o=(l=this.app.metadataCache.getFileCache(a))==null?void 0:l.frontmatter;return(o==null?void 0:o.recurrence)&&typeof o.recurrence=="object"}),i=s.length;for(let a=0;a<s.length;a++){let o=s[a];e&&e(a+1,i,o.name),await this.migrateFile(o).then(()=>{r++}).catch(l=>{let c=`Failed to migrate ${o.path}: ${l instanceof Error?l.message:String(l)}`;t.push(c),console.error(c,l)}),a%10===0&&await new Promise(l=>setTimeout(l,50))}return{success:r,errors:t}}finally{this.migrationInProgress=!1}}async migrateFile(e){await this.app.fileManager.processFrontMatter(e,t=>{if(!(!t.recurrence||typeof t.recurrence!="object"))try{let r=IT(t.recurrence);t.recurrence=r}catch(r){throw new Error(`Failed to convert recurrence to rrule: ${r instanceof Error?r.message:String(r)}`)}})}isMigrationInProgress(){return this.migrationInProgress}};var ds=require("obsidian"),_S=class extends ds.Modal{constructor(t,r){super(t);this.migrationCount=0;this.migrationService=r}async onOpen(){let{contentEl:t}=this;if(t.empty(),this.migrationCount=await this.migrationService.getMigrationCount(),new ds.Setting(t).setName("Recurrence system migration").setHeading(),t.createEl("p",{text:"TaskNotes has an updated, more powerful recurrence system based on the RFC 5545 standard. This migration will convert your existing recurring tasks to use the new format."}),t.createEl("p",{text:`Found ${this.migrationCount} task(s) that need migration.`}),this.migrationCount===0){t.createEl("p",{text:"No migration needed! All your tasks are already using the new recurrence format.",cls:"text-success"}),new ds.Setting(t).addButton(f=>{f.setButtonText("Close").setCta().onClick(()=>this.close())});return}let r=t.createDiv("migration-warning");new ds.Setting(r).setName("\u26A0\uFE0F Important notes").setHeading();let s=r.createEl("ul");s.createEl("li",{text:"We strongly recommend backing up your vault before proceeding."}),s.createEl("li",{text:"The migration will convert your recurrence objects to standardized rrule strings."}),s.createEl("li",{text:"You can continue using your tasks normally after migration."}),s.createEl("li",{text:"The migration is permanent - your legacy recurrence objects will be replaced."});let i=t.createDiv("migration-benefits");new ds.Setting(i).setName("\u2728 What You Get").setHeading();let a=i.createEl("ul");a.createEl("li",{text:'More powerful recurrence patterns (e.g., "every other Tuesday", "last Friday of the month")'}),a.createEl("li",{text:"Better performance for calendar views"}),a.createEl("li",{text:"Improved compatibility with calendar standards"}),a.createEl("li",{text:"Enhanced natural language processing for task creation"});let o=t.createDiv("migration-progress");o.style.display="none",new ds.Setting(o).setName("Migration progress").setHeading();let l=o.createEl("progress");l.max=this.migrationCount,l.value=0;let c=o.createEl("p",{text:"Preparing migration..."}),d=t.createDiv("migration-buttons");d.style.display="flex",d.style.gap="10px",d.style.marginTop="20px";let u=d.createEl("button",{text:"Cancel"});u.onclick=()=>this.close();let h=d.createEl("button",{text:`Migrate ${this.migrationCount} Task(s)`,cls:"mod-cta"});h.onclick=async()=>{h.disabled=!0,u.disabled=!0,o.style.display="block";try{let f=await this.migrationService.performMigration((p,m,g)=>{l.value=p,c.textContent=`Migrating ${p}/${m}: ${g}`});if(c.textContent=`Migration completed! ${f.success} files migrated successfully.`,f.errors.length>0){let p=o.createDiv("migration-errors");new ds.Setting(p).setName("\u26A0\uFE0F Errors Encountered").setHeading();let m=p.createEl("ul");f.errors.forEach(g=>{m.createEl("li",{text:g})}),new ds.Notice(`Migration completed with ${f.errors.length} errors. Check the migration modal for details.`,1e4)}else new ds.Notice(`Migration completed successfully! ${f.success} tasks migrated.`,5e3);h.textContent="Migration Complete",u.textContent="Close",u.disabled=!1}catch(f){c.textContent=`Migration failed: ${f instanceof Error?f.message:String(f)}`,new ds.Notice(`Migration failed: ${f instanceof Error?f.message:String(f)}`,1e4),h.disabled=!1,u.disabled=!1}}}onClose(){let{contentEl:t}=this;t.empty()}};function UB(n,e){let t=new ds.Notice("",0),r=t.messageEl.createDiv();r.style.display="flex",r.style.flexDirection="column",r.style.gap="12px",r.style.padding="8px";let s=r.createSpan();s.textContent="TaskNotes has an updated recurrence system. Migrate your existing recurring tasks to continue using them.",s.style.lineHeight="1.4",s.style.marginBottom="4px";let i=r.createDiv();i.style.display="flex",i.style.gap="8px",i.style.justifyContent="flex-end",i.style.alignItems="center";let a=i.createEl("button",{text:"Migrate Now",cls:"mod-cta"}),o=i.createEl("button",{text:"Remind Later"});a.onclick=()=>{t.hide(),new _S(n,e).open()},o.onclick=()=>{t.hide()}}var AS=require("obsidian"),tv=class{constructor(e){this.statusBarElement=null;this.updateTimeout=null;this.plugin=e,this.requestDeduplicator=new Wc}initialize(){this.plugin.settings.showTrackedTasksInStatusBar&&(this.statusBarElement=this.plugin.addStatusBarItem(),this.statusBarElement.addClass("tasknotes-status-bar"),this.statusBarElement.style.cursor="pointer",this.statusBarElement.addEventListener("click",()=>{this.handleStatusBarClick()}),this.updateStatusBar())}async updateStatusBar(){if(!(!this.statusBarElement||!this.plugin.settings.showTrackedTasksInStatusBar))try{let e=await this.requestDeduplicator.execute("update-status-bar",()=>this.getTrackedTasks());this.renderStatusBar(e)}catch(e){console.error("Error updating status bar:",e)}}async getTrackedTasks(){return(await this.plugin.cacheManager.getAllTasks()).filter(t=>t.archived?!1:this.plugin.getActiveTimeSession(t)!==null)}renderStatusBar(e){if(!this.statusBarElement)return;let t=e.length;if(t===0){this.statusBarElement.style.display="none";return}this.statusBarElement.style.display="",this.statusBarElement.empty(),this.statusBarElement.createEl("span",{cls:"tasknotes-status-icon",text:"\u23F1\uFE0F"});let r=this.statusBarElement.createEl("span",{cls:"tasknotes-status-text"});if(t===1){let s=e[0],i=s.title.length>30?s.title.substring(0,30)+"...":s.title;r.setText(`Tracking: ${i}`),(0,AS.setTooltip)(this.statusBarElement,`Currently tracking: ${s.title}`,{placement:"top"})}else{r.setText(`Tracking ${t} tasks`);let s=e.slice(0,5).map(a=>a.title).join(`
`),i=t>5?`${s}
... and ${t-5} more`:s;(0,AS.setTooltip)(this.statusBarElement,`Currently tracking:
${i}`,{placement:"top"})}}async handleStatusBarClick(){try{if((await this.getTrackedTasks()).length===0)return;await this.plugin.activateTasksView()}catch(e){console.error("Error handling status bar click:",e)}}requestUpdate(){this.updateTimeout&&window.clearTimeout(this.updateTimeout),this.updateTimeout=window.setTimeout(()=>{this.updateStatusBar()},100)}updateVisibility(){this.plugin.settings.showTrackedTasksInStatusBar?this.statusBarElement?this.updateStatusBar():this.initialize():this.hide()}hide(){this.statusBarElement&&(this.statusBarElement.style.display="none")}destroy(){this.updateTimeout&&(window.clearTimeout(this.updateTimeout),this.updateTimeout=null),this.requestDeduplicator&&this.requestDeduplicator.cancelAll(),this.statusBarElement=null}};var rv=class{constructor(e){this.expandedProjects=new Set;this.plugin=e}isExpanded(e){return this.expandedProjects.has(e)}toggle(e){return this.expandedProjects.has(e)?(this.expandedProjects.delete(e),!1):(this.expandedProjects.add(e),!0)}setExpanded(e,t){t?this.expandedProjects.add(e):this.expandedProjects.delete(e)}getExpandedProjects(){return Array.from(this.expandedProjects)}clearAll(){this.expandedProjects.clear()}collapseAll(){this.clearAll()}};var WB=require("obsidian");Fe();var sv=class{constructor(e){this.notificationQueue=[];this.processedReminders=new Set;this.lastBroadScanTime=Date.now();this.lastQuickCheckTime=Date.now();this.BROAD_SCAN_INTERVAL=300*1e3;this.QUICK_CHECK_INTERVAL=30*1e3;this.QUEUE_WINDOW=300*1e3;this.plugin=e}async initialize(){this.plugin.settings.enableNotifications&&(this.plugin.settings.notificationType==="system"&&"Notification"in window&&Notification.permission==="default"&&await Notification.requestPermission(),this.setupTaskUpdateListener(),this.startBroadScan(),this.startQuickCheck(),await this.scanTasksAndBuildQueue())}destroy(){this.broadScanInterval&&clearInterval(this.broadScanInterval),this.quickCheckInterval&&clearInterval(this.quickCheckInterval),this.taskUpdateListener&&this.plugin.emitter.offref(this.taskUpdateListener),this.notificationQueue=[],this.processedReminders.clear()}startBroadScan(){this.broadScanInterval=setInterval(async()=>{let e=Date.now();e-this.lastBroadScanTime>this.BROAD_SCAN_INTERVAL+6e4&&(console.log("NotificationService: Detected potential system sleep, performing catch-up scan"),await this.handleSystemWakeUp()),await this.scanTasksAndBuildQueue(),this.lastBroadScanTime=e},this.BROAD_SCAN_INTERVAL)}startQuickCheck(){this.quickCheckInterval=setInterval(()=>{let e=Date.now();e-this.lastQuickCheckTime>this.QUICK_CHECK_INTERVAL+6e4&&console.log("NotificationService: Detected potential system sleep during quick check"),this.checkNotificationQueue(),this.lastQuickCheckTime=e},this.QUICK_CHECK_INTERVAL)}async scanTasksAndBuildQueue(){this.notificationQueue=[];let e=await this.plugin.cacheManager.getAllTasks(),t=Date.now(),r=t+this.QUEUE_WINDOW;for(let s of e)if(!(!s.reminders||s.reminders.length===0))for(let i of s.reminders){let a=`${s.path}-${i.id}`;if(this.processedReminders.has(a))continue;let o=this.calculateNotificationTime(s,i);o!==null&&o>t&&o<=r&&this.notificationQueue.push({taskPath:s.path,reminder:i,notifyAt:o})}this.notificationQueue.sort((s,i)=>s.notifyAt-i.notifyAt)}calculateNotificationTime(e,t){try{if(t.type==="absolute")return t.absoluteTime?$t(t.absoluteTime).getTime():null;if(t.type==="relative"){if(!t.relatedTo||!t.offset)return null;let r=t.relatedTo==="due"?e.due:e.scheduled;if(!r)return null;let s=$t(r),i=this.parseISO8601Duration(t.offset);return i===null?null:s.getTime()+i}}catch(r){return console.error("Error calculating notification time:",r),null}return null}parseISO8601Duration(e){let t=e.match(/^(-?)P(?:(\d+)Y)?(?:(\d+)M)?(?:(\d+)W)?(?:(\d+)D)?(?:T(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?)?$/);if(!t)return null;let[,r,s,i,a,o,l,c,d]=t,u=0;return s&&(u+=parseInt(s)*365*24*60*60*1e3),i&&(u+=parseInt(i)*30*24*60*60*1e3),a&&(u+=parseInt(a)*7*24*60*60*1e3),o&&(u+=parseInt(o)*24*60*60*1e3),l&&(u+=parseInt(l)*60*60*1e3),c&&(u+=parseInt(c)*60*1e3),d&&(u+=parseInt(d)*1e3),r==="-"?-u:u}checkNotificationQueue(){let e=Date.now(),t=[];for(let r=0;r<this.notificationQueue.length;r++){let s=this.notificationQueue[r];if(s.notifyAt<=e){this.triggerNotification(s),t.push(r);let i=`${s.taskPath}-${s.reminder.id}`;this.processedReminders.add(i)}else break}for(let r=t.length-1;r>=0;r--)this.notificationQueue.splice(t[r],1)}async triggerNotification(e){let t=this.plugin.app.vault.getAbstractFileByPath(e.taskPath);if(!t)return;let r=this.plugin.app.metadataCache.getFileCache(t);if(!r||!r.frontmatter)return;let s=this.plugin.fieldMapper.mapFromFrontmatter(r.frontmatter,e.taskPath,this.plugin.settings.storeTitleInFilename),i=e.reminder.description||this.generateDefaultMessage(s,e.reminder);if(this.plugin.settings.notificationType==="system")if("Notification"in window&&Notification.permission==="granted"){let a=new Notification("TaskNotes Reminder",{body:i,tag:`tasknotes-${e.taskPath}-${e.reminder.id}`});a.onclick=()=>{this.plugin.app.workspace.openLinkText(e.taskPath,"",!1),a.close()}}else this.showInAppNotice(i,e.taskPath);else this.showInAppNotice(i,e.taskPath);this.plugin.apiService&&await this.plugin.apiService.triggerWebhook("reminder.triggered",{task:s,reminder:e.reminder,notificationTime:new Date(e.notifyAt).toISOString(),message:i,notificationType:this.plugin.settings.notificationType})}showInAppNotice(e,t){let r=new WB.Notice(e,0);r.noticeEl.addEventListener("click",()=>{this.plugin.app.workspace.openLinkText(t,"",!1),r.hide()}),r.noticeEl.style.cursor="pointer"}generateDefaultMessage(e,t){if(t.type==="absolute")return`Reminder: ${e.title}`;{let r=t.relatedTo==="due"?"due":"scheduled",s=this.formatDurationForDisplay(t.offset||"");return s.startsWith("-")?`${e.title} is ${r} in ${s.substring(1)}`:s==="PT0S"||s==="PT0M"?`${e.title} is ${r} now`:`${e.title} was ${r} ${s} ago`}}formatDurationForDisplay(e){let t=this.parseISO8601Duration(e);if(t===null)return e;let r=Math.abs(t),s=Math.floor(r/(60*1e3)),i=Math.floor(r/(3600*1e3)),a=Math.floor(r/(1440*60*1e3)),o="";return a>0?o=`${a} day${a>1?"s":""}`:i>0?o=`${i} hour${i>1?"s":""}`:s>0?o=`${s} minute${s>1?"s":""}`:o="now",t<0?`-${o}`:o}async refreshReminders(){await this.scanTasksAndBuildQueue()}clearProcessedRemindersForTask(e){let t=[];for(let r of this.processedReminders)r.startsWith(`${e}-`)&&t.push(r);t.forEach(r=>this.processedReminders.delete(r))}setupTaskUpdateListener(){this.taskUpdateListener=this.plugin.emitter.on(tt,async({path:e,originalTask:t,updatedTask:r})=>{if(!e||!r)return;this.removeNotificationsForTask(e),this.clearProcessedRemindersForTask(e);let s=Date.now(),i=s+this.QUEUE_WINDOW;if(r.reminders&&r.reminders.length>0){for(let a of r.reminders){let o=`${e}-${a.id}`;if(this.processedReminders.has(o))continue;let l=this.calculateNotificationTime(r,a);l!==null&&l>s&&l<=i&&this.notificationQueue.push({taskPath:e,reminder:a,notifyAt:l})}this.notificationQueue.sort((a,o)=>a.notifyAt-o.notifyAt)}})}removeNotificationsForTask(e){this.notificationQueue=this.notificationQueue.filter(t=>t.taskPath!==e)}async handleSystemWakeUp(){let e=Date.now(),t=[];for(let r of this.processedReminders){let[s,i]=r.split("-",2);if(!(!s||!i))try{let a=await this.plugin.cacheManager.getTaskInfo(s);if(a&&a.reminders){let o=a.reminders.find(l=>l.id===i);if(o){let l=this.calculateNotificationTime(a,o);l&&l<=e&&t.push(r)}}}catch(a){t.push(r)}}t.forEach(r=>this.processedReminders.delete(r)),await this.scanTasksAndBuildQueue()}};var $B=require("obsidian");um();var nv=class{constructor(e){this.intervalId=null;this.lastExportTime=null;this.nextExportTime=null;this.plugin=e}start(){if(!this.plugin.settings.icsIntegration.enableAutoExport)return;this.stop();let e=this.plugin.settings.icsIntegration.autoExportInterval,t=e*60*1e3;this.nextExportTime=new Date(Date.now()+t),this.intervalId=setInterval(async()=>{await this.performExport(),this.nextExportTime=new Date(Date.now()+t)},t),console.log(`TaskNotes: Auto export started (interval: ${e} minutes)`)}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null,this.nextExportTime=null)}updateInterval(e){this.plugin.settings.icsIntegration.enableAutoExport&&this.start()}async exportNow(){await this.performExport()}getLastExportTime(){return this.lastExportTime}getNextExportTime(){return this.nextExportTime}async performExport(){try{let e=this.plugin.settings.icsIntegration.autoExportPath||"tasknotes-calendar.ics",t=await this.plugin.cacheManager.getAllTasks();if(t.length===0){console.log("TaskNotes: Auto export skipped - no tasks found");return}let r=Un.generateMultipleTasksICSContent(t),s=e;await this.plugin.app.vault.adapter.exists(s)?await this.plugin.app.vault.adapter.write(s,r):await this.plugin.app.vault.create(s,r),this.lastExportTime=new Date,console.log(`TaskNotes: Auto export completed - ${t.length} tasks exported to ${e}`)}catch(e){console.error("TaskNotes: Auto export failed:",e),(!this.lastExportTime||Date.now()-this.lastExportTime.getTime()>360*60*1e3)&&new $B.Notice(`TaskNotes auto export failed: ${e instanceof Error?e.message:String(e)}`)}}destroy(){this.stop()}};var dp=class extends ge.Plugin{constructor(){super(...arguments);this.previousCacheSettings=null;this.previousTimeTrackingSettings=null;this.lastKnownDate=new Date().toDateString();this.selectedDate=wt(Ge());this.taskUpdateListenerForEditor=null;this.initializationComplete=!1;this.migrationComplete=!1;this.migrationPromise=null}async onload(){var t;if(this.readyPromise=new Promise(r=>{this.resolveReady=r}),await this.loadSettings(),(0,ge.addIcon)("tasknotes-simple",`<g>
			<defs>
				<mask id="tasknotes-mask">
					<rect width="100" height="100" fill="white"/>
					<path fill="black" d="m 5.9,52.4 -0.09,4.51 c 4.71,0.09 7.61,1.48 9.95,3.57 2.35,2.09 4.11,5.01 5.90,8.14 1.80,3.13 3.62,6.46 6.45,9.12 2.23,2.09 5.14,3.67 8.83,4.21 0.46,-1.51 1.05,-2.95 1.77,-4.33 -3.44,-0.21 -5.62,-1.39 -7.53,-3.17 -2.14,-2.01 -3.82,-4.92 -5.63,-8.08 -1.81,-3.16 -3.77,-6.56 -6.82,-9.27 -3.05,-2.71 -7.07,-4.59 -11.83,-4.70 z"/>
					<path fill="black" d="M 73.6,18.3 69.9,20.9 c 4.06,5.75 4.40,11.33 2.77,16.78 -1.63,5.45 -5.41,10.67 -9.65,14.78 -8.49,8.20 -16.59,14.11 -21.83,21.18 -5.24,7.07 -7.22,15.59 -3.13,27.21 l 4.25,-1.50 c -3.74,-10.62 -2.11,-16.80 2.50,-23.01 4.61,-6.21 12.63,-12.19 21.34,-20.64 4.65,-4.50 8.89,-10.23 10.84,-16.72 1.95,-6.49 1.42,-13.86 -3.40,-20.68 z"/>
				</mask>
			</defs>
			<path fill="currentColor" mask="url(#tasknotes-mask)" d="m 98.5,0.6 c -0.38,0 -0.83,0.09 -1.33,0.23 -2,0.59 -4.66,2.18 -5.78,3.22 -1.25,1.16 -4.16,4.93 -6.08,7.19 -2.67,3.12 -5.65,6.58 -9.32,11.13 2.58,5.61 2.61,11.38 1.05,16.60 -1.95,6.49 -6.19,12.22 -10.84,16.72 -8.71,8.43 -16.73,14.41 -21.34,20.64 -4.47,6.03 -6.13,12.03 -2.81,22.08 0.19,-0.23 0.37,-0.49 0.54,-0.80 10.57,-19.70 17.89,-27.30 41.9,-47.08 v 0 c 2.40,-1.97 3.71,-4.33 4.52,-7.14 0.81,-2.82 1.11,-6.10 1.52,-9.92 0.81,-7.64 2.02,-17.43 8.43,-29.95 0.37,-0.73 0.57,-1.30 0.62,-1.72 0.05,-0.43 -0.04,-0.71 -0.22,-0.90 -0.19,-0.18 -0.48,-0.27 -0.86,-0.26 z M 72.7,26.3 c -0.75,0.92 -1.51,1.84 -2.27,2.78 -9.09,11.05 -19.45,22.93 -28.54,29.97 -1.48,1.14 -2.98,1.54 -4.46,1.38 -1.49,-0.16 -2.97,-0.89 -4.43,-1.96 -2.91,-2.16 -5.74,-5.74 -8.35,-9.19 -2.62,-3.45 -5.04,-6.77 -7.12,-8.39 -1.04,-0.81 -1.99,-1.19 -2.83,-0.97 -0.84,0.22 -1.60,1.05 -2.26,2.70 -1.03,2.61 -1.60,6.22 -3.42,10.05 4.08,0.62 7.27,2.27 9.73,4.45 3.05,2.71 5.01,6.11 6.82,9.27 1.81,3.16 3.49,6.07 5.63,8.08 1.90,1.78 4.08,2.96 7.53,3.17 0.71,-1.37 1.55,-2.69 2.49,-3.95 5.24,-7.07 13.34,-12.98 21.83,-21.18 4.24,-4.11 8.02,-9.33 9.65,-14.78 1.12,-3.73 1.31,-7.53 0.01,-11.42 z M 10.3,49.1 c -0.09,0.29 -0.18,0.56 -0.28,0.85 0.10,-0.29 0.19,-0.56 0.28,-0.85 z m -4.02,7.84 c -0.01,0.01 -0.02,0.02 -0.03,0.03 0.01,-0.01 0.02,-0.02 0.03,-0.03 0,0 0,0 0,0 z m 0.12,0 c -1.08,1.40 -2.40,2.79 -4.05,4.12 -1.20,1.0 -1.85,1.86 -2.03,2.71 -0.18,0.85 0.10,1.67 0.76,2.53 1.32,1.71 4.16,3.54 7.81,5.91 7.28,4.73 17.75,11.63 25.63,24.16 0.64,1.02 1.74,2.04 2.95,2.65 -0.91,-5.36 -0.91,-8.78 -0.54,-11.88 -3.33,-0.55 -6.07,-2.12 -8.39,-4.72 -2.83,-3.17 -4.69,-6.59 -6.54,-9.85 -1.85,-3.26 -3.69,-6.37 -6.08,-8.47 -2.06,-1.81 -4.61,-3.0 -8.49,-3.17 z"/>
		</g>`),this.fieldMapper=new Ll(this.settings.fieldMapping),this.statusManager=new jc(this.settings.customStatuses),this.priorityManager=new Py(this.settings.customPriorities),this.requestDeduplicator=new Wc,this.predictivePrefetcher=new _y(this.requestDeduplicator),this.domReconciler=new $c,this.uiStateManager=new Ay,this.cacheManager=new My(this.app,this.settings,this.fieldMapper),this.emitter=this.cacheManager,this.taskService=new Ry(this),this.filterService=new Oa(this.cacheManager,this.statusManager,this.priorityManager,this),this.viewStateManager=new Oy(this.app,this),this.projectSubtasksService=new Yc(this),this.expandedProjectsService=new rv(this),this.autoArchiveService=new Ny(this),this.dragDropManager=new Hy(this),this.migrationService=new ev(this.app),this.statusBarService=new tv(this),this.notificationService=new sv(this),this.taskService.setAutoArchiveService(this.autoArchiveService),this.addRibbonIcon("calendar-days","Open mini calendar",async()=>{await this.activateCalendarView()}),this.addRibbonIcon("calendar","Open advanced calendar",async()=>{await this.activateAdvancedCalendarView()}),this.addRibbonIcon("check-square","Open task list",async()=>{await this.activateTasksView()}),this.addRibbonIcon("sticky-note","Open notes",async()=>{await this.activateNotesView()}),this.addRibbonIcon("list","Open agenda",async()=>{await this.activateAgendaView()}),this.addRibbonIcon("columns-3","Open kanban board",async()=>{await this.activateKanbanView()}),this.addRibbonIcon("timer","Open pomodoro",async()=>{await this.activatePomodoroView()}),this.addRibbonIcon("bar-chart-3","Open pomodoro stats",async()=>{await this.activatePomodoroStatsView()}),this.addRibbonIcon("tasknotes-simple","Create new task",()=>{this.openTaskCreationModal()}),this.addCommands(),this.addSettingTab(new Fp(this.app,this)),this.migrationPromise=this.performEarlyMigrationCheck(),(t=this.settings)!=null&&t.enableBases)try{let{registerBasesTaskList:r}=await Promise.resolve().then(()=>(lv(),ov));await r(this)}catch(r){console.debug("[TaskNotes][Bases] Early registration failed:",r)}this.app.workspace.onLayoutReady(()=>{this.initializeAfterLayoutReady()}),this.resolveReady()}async initializeHTTPAPI(){if(!(ge.Platform.isMobile||!this.settings.enableAPI))try{let{HTTPAPIService:t}=await Promise.resolve().then(()=>(wH(),TH));this.apiService=new t(this,this.taskService,this.filterService,this.cacheManager),this.taskService.setWebhookNotifier(this.apiService),this.pomodoroService.setWebhookNotifier(this.apiService),await this.apiService.start(),new ge.Notice(`TaskNotes API started on port ${this.apiService.getPort()}`)}catch(t){console.error("Failed to initialize HTTP API:",t),new ge.Notice("Failed to start TaskNotes API server. Check console for details.")}}async initializeAfterLayoutReady(){var t;if(!this.initializationComplete){this.initializationComplete=!0;try{if(this.injectCustomStyles(),this.registerView(Cl,r=>new im(r,this)),this.registerView(ui,r=>new gy(r,this)),this.registerView(Rs,r=>new qf(r,this)),this.registerView(md,r=>new ky(r,this)),this.registerView(Qt,r=>new Gf(r,this)),this.registerView(gd,r=>new Sy(r,this)),this.registerView(yd,r=>new Dy(r,this)),this.registerView(vd,r=>new Cy(r,this)),this.registerView(hn,r=>new Kf(r,this)),this.registerEditorExtension(kB(this)),this.registerEditorExtension(DB(this)),this.registerMarkdownPostProcessor(EB(this)),this.cacheManager.initialize(),this.filterService.initialize(),this.statusBarService.initialize(),await this.notificationService.initialize(),await this.autoArchiveService.start(),this.setupDateChangeDetection(),this.initializeServicesLazily(),(t=this.settings)!=null&&t.enableBases)try{let{registerBasesTaskList:r}=await Promise.resolve().then(()=>(lv(),ov));await r(this)}catch(r){console.debug("[TaskNotes][Bases] Registration failed:",r)}}catch(r){console.error("Error during post-layout initialization:",r)}}}initializeServicesLazily(){setTimeout(async()=>{try{this.pomodoroService=new xy(this),await this.pomodoroService.initialize(),this.icsSubscriptionService=new Jy(this),await this.icsSubscriptionService.initialize(),this.icsNoteService=new Xy(this),this.autoExportService=new nv(this),this.autoExportService.start(),await this.initializeHTTPAPI();let{TaskLinkDetectionService:t}=await Promise.resolve().then(()=>(mS(),wB));this.taskLinkDetectionService=new t(this);let{InstantTaskConvertService:r}=await Promise.resolve().then(()=>(kH(),bH));this.instantTaskConvertService=new r(this,this.statusManager,this.priorityManager);let{createInstantConvertButtons:s}=await Promise.resolve().then(()=>(DH(),SH));this.registerEditorExtension(s(this)),this.taskUpdateListenerForEditor=this.emitter.on(tt,i=>{this.app.workspace.iterateRootLeaves(a=>{var o;if(a.view&&a.view.getViewType()==="markdown"){let l=a.view.editor;if(l&&l.cm){let c=(i==null?void 0:i.path)||((o=i==null?void 0:i.updatedTask)==null?void 0:o.path);Fa(l.cm,c),Xf(l.cm)}}})}),this.registerEvent(this.app.workspace.on("active-leaf-change",i=>{setTimeout(()=>{if(i&&i.view&&i.view.getViewType()==="markdown"){let a=i.view.editor;a&&a.cm&&(Fa(a.cm),Xf(a.cm))}},50)})),this.registerEvent(this.app.workspace.on("layout-change",()=>{setTimeout(()=>{let i=this.app.workspace.getActiveViewOfType(ge.MarkdownView);if(i){let a=i.editor;a&&a.cm&&(Fa(a.cm),Xf(a.cm))}},100)})),this.setupStatusBarEventListeners(),this.setupTimeTrackingEventListeners(),await this.showMigrationPromptsIfNeeded()}catch(t){console.error("Error during lazy service initialization:",t)}},10)}async onReady(){if(!this.readyPromise)throw new Error("Plugin not yet initialized");await this.readyPromise}setupStatusBarEventListeners(){this.statusBarService&&(this.registerEvent(this.emitter.on(tt,()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on(fr,()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.pomodoroService&&(this.registerEvent(this.emitter.on("pomodoro-start",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on("pomodoro-stop",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)})),this.registerEvent(this.emitter.on("pomodoro-state-changed",()=>{setTimeout(()=>{this.statusBarService.requestUpdate()},100)}))))}setupTimeTrackingEventListeners(){if(this.settings.autoStopTimeTrackingOnComplete){let t=this.emitter.on(tt,async r=>{await this.handleAutoStopTimeTracking(r)});this.registerEvent(t)}this.updatePreviousTimeTrackingSettings()}async handleAutoStopTimeTracking(t){let{originalTask:r,updatedTask:s}=t;if(!r||!s)return;let i=this.statusManager.isCompletedStatus(r.status),a=this.statusManager.isCompletedStatus(s.status);if(!i&&a&&this.getActiveTimeSession(s))try{await this.stopTimeTracking(s),this.settings.autoStopTimeTrackingNotification&&new ge.Notice(`Auto-stopped time tracking for: ${s.title}`),console.log(`Auto-stopped time tracking for completed task: ${s.title}`)}catch(l){console.error("Error auto-stopping time tracking:",l)}}haveTimeTrackingSettingsChanged(){return this.previousTimeTrackingSettings?this.settings.autoStopTimeTrackingOnComplete!==this.previousTimeTrackingSettings.autoStopTimeTrackingOnComplete:!0}updatePreviousTimeTrackingSettings(){this.previousTimeTrackingSettings={autoStopTimeTrackingOnComplete:this.settings.autoStopTimeTrackingOnComplete}}async performEarlyMigrationCheck(){try{if(console.log("TaskNotes: Starting early migration check..."),await this.viewStateManager.initializeSavedViews(),this.viewStateManager.needsMigration()&&(console.log("TaskNotes: Performing view state migration..."),await this.viewStateManager.performMigration()),this.settings.recurrenceMigrated===!0){this.migrationComplete=!0;return}if(!await this.migrationService.needsMigration()){this.settings.recurrenceMigrated=!0,await this.saveSettings(),this.migrationComplete=!0;return}this.migrationComplete=!0,console.log("TaskNotes: Early migration check complete. Will show prompts after UI initialization.")}catch(t){console.error("Error during early migration check:",t),this.migrationComplete=!0}}async showMigrationPromptsIfNeeded(){try{if(this.settings.recurrenceMigrated===!0)return;await this.migrationService.needsMigration()&&setTimeout(()=>{UB(this.app,this.migrationService)},1e3)}catch(t){console.error("Error showing migration prompts:",t)}}async waitForMigration(){for(this.migrationPromise&&await this.migrationPromise;!this.migrationComplete;)await new Promise(t=>setTimeout(t,50))}setSelectedDate(t){this.selectedDate=t,this.emitter.trigger(ra,t)}notifyDataChanged(t,r=!1,s=!0){t?(this.cacheManager.clearCacheEntry(t),this.taskLinkDetectionService&&this.taskLinkDetectionService.clearCacheForFile(t)):r&&(this.cacheManager.clearAllCaches(),this.taskLinkDetectionService&&this.taskLinkDetectionService.clearCache()),s&&requestAnimationFrame(()=>{this.emitter.trigger(fr)})}setupDateChangeDetection(){let t=()=>{let r=new Date().toDateString();r!==this.lastKnownDate&&(this.lastKnownDate=r,this.emitter.trigger(pn))};this.dateCheckInterval=window.setInterval(t,6e4),this.registerInterval(this.dateCheckInterval),this.scheduleNextMidnightCheck()}scheduleNextMidnightCheck(){let t=new Date,r=new Date(t);r.setHours(24,0,0,0);let s=r.getTime()-t.getTime();this.midnightTimeout&&window.clearTimeout(this.midnightTimeout),this.midnightTimeout=window.setTimeout(()=>{let i=new Date().toDateString();i!==this.lastKnownDate&&(this.lastKnownDate=i,this.emitter.trigger(pn)),this.scheduleNextMidnightCheck()},s),this.registerInterval(this.midnightTimeout)}onunload(){var r;if((r=this.settings)!=null&&r.enableBases)try{let{unregisterBasesViews:s}=(lv(),fp(ov));s(this)}catch(s){console.debug("[TaskNotes][Bases] Unregistration failed:",s)}let t=vi.getStats("cache-initialization");t&&t.count>0&&vi.logSummary(),this.pomodoroService&&this.pomodoroService.cleanup(),this.filterService&&this.filterService.cleanup(),this.autoArchiveService&&this.autoArchiveService.stop(),this.icsSubscriptionService&&this.icsSubscriptionService.destroy(),this.autoExportService&&this.autoExportService.destroy(),this.taskLinkDetectionService&&this.taskLinkDetectionService.cleanup(),this.dragDropManager&&this.dragDropManager.destroy(),this.apiService&&this.apiService.stop(),this.viewStateManager&&this.viewStateManager.cleanup(),this.statusBarService&&this.statusBarService.destroy(),this.notificationService&&this.notificationService.destroy(),this.cacheManager&&this.cacheManager.destroy(),this.requestDeduplicator&&this.requestDeduplicator.cancelAll(),this.domReconciler&&this.domReconciler.destroy(),this.uiStateManager&&this.uiStateManager.destroy(),typeof vi!="undefined"&&vi.destroy(),this.taskUpdateListenerForEditor&&this.emitter.offref(this.taskUpdateListenerForEditor),this.emitter&&this.emitter.off,this.initializationComplete=!1}async loadSettings(){let t=await this.loadData();t&&"useNativeMetadataCache"in t&&delete t.useNativeMetadataCache,t&&typeof t.enableAPI=="undefined"&&(t.enableAPI=!1),t&&typeof t.apiPort=="undefined"&&(t.apiPort=8080),t&&typeof t.apiAuthToken=="undefined"&&(t.apiAuthToken=""),this.settings={...Yr,...t,fieldMapping:{...Yr.fieldMapping,...(t==null?void 0:t.fieldMapping)||{}},taskCreationDefaults:{...Yr.taskCreationDefaults,...(t==null?void 0:t.taskCreationDefaults)||{}},calendarViewSettings:{...Yr.calendarViewSettings,...(t==null?void 0:t.calendarViewSettings)||{}},icsIntegration:{...Yr.icsIntegration,...(t==null?void 0:t.icsIntegration)||{}},customStatuses:(t==null?void 0:t.customStatuses)||Yr.customStatuses,customPriorities:(t==null?void 0:t.customPriorities)||Yr.customPriorities,savedViews:(t==null?void 0:t.savedViews)||Yr.savedViews};let r=Object.keys(Yr.fieldMapping).some(i=>{var a;return!((a=t==null?void 0:t.fieldMapping)!=null&&a[i])}),s=Object.keys(Yr.calendarViewSettings).some(i=>{var a;return!((a=t==null?void 0:t.calendarViewSettings)!=null&&a[i])});(r||s)&&setTimeout(async()=>{try{let i=await this.loadData()||{},a=Object.keys(Yr);for(let o of a)i[o]=this.settings[o];await this.saveData(i)}catch(i){console.error("Failed to save migrated settings:",i)}},100),this.updatePreviousCacheSettings()}async saveSettings(){var a;let t=await this.loadData()||{},r=Object.keys(Yr);for(let o of r)t[o]=this.settings[o];await this.saveData(t);let s=this.haveCacheSettingsChanged(),i=this.haveTimeTrackingSettingsChanged();this.fieldMapper&&this.fieldMapper.updateMapping(this.settings.fieldMapping),this.statusManager&&this.statusManager.updateStatuses(this.settings.customStatuses),this.priorityManager&&this.priorityManager.updatePriorities(this.settings.customPriorities),s&&(console.debug("Cache-related settings changed, updating cache configuration"),this.cacheManager.updateConfig(this.settings.taskTag,this.settings.excludedFolders,this.fieldMapper,this.settings.disableNoteIndexing,this.settings.storeTitleInFilename),this.updatePreviousCacheSettings()),this.injectCustomStyles(),i&&this.setupTimeTrackingEventListeners(),this.statusBarService&&this.statusBarService.updateVisibility(),(a=this.filterService)==null||a.refreshFilterOptions(),this.notifyDataChanged(),this.emitter.trigger("settings-changed",this.settings)}addCommands(){this.addCommand({id:"open-calendar-view",name:"Open mini calendar view",callback:async()=>{await this.activateCalendarView()}}),this.addCommand({id:"open-advanced-calendar-view",name:"Open advanced calendar view",callback:async()=>{await this.activateAdvancedCalendarView()}}),this.addCommand({id:"open-tasks-view",name:"Open tasks view",callback:async()=>{await this.activateTasksView()}}),this.addCommand({id:"open-notes-view",name:"Open notes view",callback:async()=>{await this.activateNotesView()}}),this.addCommand({id:"open-agenda-view",name:"Open agenda view",callback:async()=>{await this.activateAgendaView()}}),this.addCommand({id:"open-pomodoro-view",name:"Open pomodoro timer",callback:async()=>{await this.activatePomodoroView()}}),this.addCommand({id:"open-kanban-view",name:"Open kanban board",callback:async()=>{await this.activateKanbanView()}}),this.addCommand({id:"open-pomodoro-stats",name:"Open pomodoro statistics",callback:async()=>{await this.activatePomodoroStatsView()}}),this.addCommand({id:"open-statistics",name:"Open task & project statistics",callback:async()=>{await this.activateStatsView()}}),this.addCommand({id:"create-new-task",name:"Create new task",callback:()=>{this.openTaskCreationModal()}}),this.addCommand({id:"convert-to-tasknote",name:"Convert task to TaskNote",editorCallback:async t=>{await this.convertTaskToTaskNote(t)}}),this.addCommand({id:"batch-convert-all-tasks",name:"Convert all tasks in note",editorCallback:async t=>{await this.batchConvertAllTasks(t)}}),this.addCommand({id:"insert-tasknote-link",name:"Insert tasknote link",editorCallback:t=>{this.insertTaskNoteLink(t)}}),this.addCommand({id:"create-inline-task",name:"Create new inline task",editorCallback:async t=>{await this.createInlineTask(t)}}),this.addCommand({id:"quick-actions-current-task",name:"Quick actions for current task",callback:async()=>{await this.openQuickActionsForCurrentTask()}}),this.addCommand({id:"go-to-today",name:"Go to today's note",callback:async()=>{await this.navigateToCurrentDailyNote()}}),this.addCommand({id:"start-pomodoro",name:"Start pomodoro timer",callback:async()=>{await this.pomodoroService.startPomodoro()}}),this.addCommand({id:"stop-pomodoro",name:"Stop pomodoro timer",callback:async()=>{await this.pomodoroService.stopPomodoro()}}),this.addCommand({id:"pause-pomodoro",name:"Pause/resume pomodoro timer",callback:async()=>{let t=this.pomodoroService.getState();t.isRunning?await this.pomodoroService.pausePomodoro():t.currentSession&&await this.pomodoroService.resumePomodoro()}}),this.addCommand({id:"refresh-cache",name:"Refresh cache",callback:async()=>{await this.refreshCache()}}),this.addCommand({id:"export-all-tasks-ics",name:"Export all tasks as ICS file",callback:async()=>{try{let t=await this.cacheManager.getAllTasks(),{CalendarExportService:r}=await Promise.resolve().then(()=>(um(),fP));r.downloadAllTasksICSFile(t)}catch(t){console.error("Error exporting all tasks as ICS:",t),new ge.Notice("Failed to export tasks as ICS file")}}})}async activateView(t){let{workspace:r}=this.app,s=this.getLeafOfType(t);return s||(s=r.getLeaf("tab"),await s.setViewState({type:t,active:!0})),r.setActiveLeaf(s,{focus:!0}),r.revealLeaf(s),s}async activateCalendarView(){return this.activateView(Cl)}async activateAdvancedCalendarView(){return this.activateView(ui)}async activateTasksView(){return this.activateView(Rs)}async activateNotesView(){return this.activateView(md)}async activateAgendaView(){return this.activateView(Qt)}async activatePomodoroView(){return this.activateView(gd)}async activatePomodoroStatsView(){return this.activateView(yd)}async activateStatsView(){return this.activateView(vd)}async activateKanbanView(){return this.activateView(hn)}async openTagsPane(t){var s;let{workspace:r}=this.app;try{let i=r.getLeavesOfType("search").first();if(!i){let l=r.getLeftLeaf(!1);if(!l)return console.warn("Could not get left leaf for search pane"),!1;try{await l.setViewState({type:"search",active:!0}),i=l}catch(c){return console.warn("Failed to create search view:",c),!1}}if(!i||!i.view)return console.warn("No search leaf available"),!1;let a=`tag:${t}`,o=i.view;if(typeof o.setQuery=="function")o.setQuery(a);else if(typeof((s=o.searchComponent)==null?void 0:s.setValue)=="function")o.searchComponent.setValue(a);else if(o.searchInputEl)o.searchInputEl.value=a,typeof o.startSearch=="function"&&o.startSearch();else return console.warn("[TaskNotes] Could not find method to set search query"),new ge.Notice("Search pane opened but could not set tag query"),!1;return r.revealLeaf(i),r.setActiveLeaf(i,{focus:!0}),!0}catch(i){return console.error("[TaskNotes] Error opening search pane with tag:",i),new ge.Notice(`Failed to open search pane for tag: ${t}`),!1}}getLeafOfType(t){let{workspace:r}=this.app,s=r.getLeavesOfType(t);for(let i of s)if(i.view&&i.view.getViewType()===t)return i;return s.length>0?s[0]:null}getCalendarLeaf(){return this.getLeafOfType(Cl)}async navigateToCurrentDailyNote(){let t=new Date;await this.navigateToDailyNote(t)}async navigateToDailyNote(t){try{if(!(0,ja.appHasDailyNotesPluginLoaded)()){new ge.Notice("Daily Notes core plugin is not enabled. Please enable it in Settings > Core plugins.");return}let r=window.moment(t),s=(0,ja.getAllDailyNotes)(),i=(0,ja.getDailyNote)(r,s),a=!1;if(!i)try{i=await(0,ja.createDailyNote)(r),a=!0}catch(o){let l=o instanceof Error?o.message:String(o);console.error("Failed to create daily note:",o),new ge.Notice(`Failed to create daily note: ${l}`);return}i&&(await this.app.workspace.getLeaf(!1).openFile(i),a&&this.notifyDataChanged(i.path,!1,!0))}catch(r){let s=r instanceof Error?r.message:String(r);console.error("Failed to navigate to daily note:",r),new ge.Notice(`Failed to navigate to daily note: ${s}`)}}injectCustomStyles(){let t=document.getElementById("tasknotes-custom-styles");t&&t.remove();let r=this.statusManager.getStatusStyles(),s=this.priorityManager.getPriorityStyles(),i=document.createElement("style");i.id="tasknotes-custom-styles",i.textContent=`
		${r}
		${s}
	`,document.head.appendChild(i)}async updateTaskProperty(t,r,s,i={}){try{let a=await this.taskService.updateProperty(t,r,s,i);if(!i.silent)if(r==="status"){let o=typeof s=="string"?s:String(s),l=this.statusManager.getStatusConfig(o);new ge.Notice(`Task marked as '${(l==null?void 0:l.label)||o}'`)}else new ge.Notice(`Task ${r} updated`);return a}catch(a){throw console.error(`Failed to update task ${r}:`,a),new ge.Notice(`Failed to update task ${r}`),a}}async toggleRecurringTaskComplete(t,r){var s;try{let i=await this.taskService.toggleRecurringTaskComplete(t,r),a=r||(()=>{let u=Ge();return wt(u)})(),o=me(a),c=((s=i.complete_instances)==null?void 0:s.includes(o))?"completed":"marked incomplete",d=$t(o);return new ge.Notice(`Recurring task ${c} for ${x(d,"MMM d")}`),i}catch(i){throw console.error("Failed to toggle recurring task completion:",i),new ge.Notice("Failed to update recurring task"),i}}async toggleTaskArchive(t){try{let r=await this.taskService.toggleArchive(t),s=r.archived?"archived":"unarchived";return new ge.Notice(`Task ${s}`),r}catch(r){throw console.error("Failed to toggle task archive:",r),new ge.Notice("Failed to update task archive status"),r}}async toggleTaskStatus(t){try{let r=await this.taskService.toggleStatus(t),s=this.statusManager.getStatusConfig(r.status);return new ge.Notice(`Task marked as '${(s==null?void 0:s.label)||r.status}'`),r}catch(r){throw console.error("Failed to toggle task status:",r),new ge.Notice("Failed to update task status"),r}}openTaskCreationModal(t){new el(this.app,this,{prePopulatedValues:t}).open()}async applyProjectSubtaskFilter(t){try{let r=this.app.vault.getAbstractFileByPath(t.path);if(!r){new ge.Notice("Project file not found");return}let s=this.app.workspace.getActiveViewOfType(qf)||this.app.workspace.getActiveViewOfType(Kf)||this.app.workspace.getActiveViewOfType(Gf);if(!s||!("filterBar"in s)){new ge.Notice("No compatible view active to apply filter");return}let i=s.filterBar;if(!i){new ge.Notice("Filter bar not available");return}this.addProjectCondition(i,r.basename),new ge.Notice(`Filtered to show subtasks of: ${t.title}`)}catch(r){console.error("Error applying project subtask filter:",r),new ge.Notice("Failed to apply project filter")}}addProjectCondition(t,r){this.removeProjectConditions(t),Array.isArray(t.currentQuery.children)||(t.currentQuery.children=[]);let s={type:"condition",id:`project_${this.generateFilterId()}`,property:"projects",operator:"contains",value:`[[${r}]]`},i=t.currentQuery.children.filter(a=>!(a.type==="condition"&&a.property==="projects"&&a.operator==="contains"&&a.id.startsWith("project_")));if(i.length===0)t.currentQuery.children=[s];else{let a={type:"group",id:this.generateFilterId(),conjunction:t.currentQuery.conjunction,children:i};t.currentQuery.children=[s,a],t.currentQuery.conjunction="and"}t.updateFilterBuilder(),t.emit("queryChange",t.currentQuery)}removeProjectConditions(t){if(!Array.isArray(t.currentQuery.children)){t.currentQuery.children=[];return}t.currentQuery.children=t.currentQuery.children.filter(r=>r.type==="condition"?!(r.property==="projects"&&r.operator==="contains"&&r.id.startsWith("project_")):!0)}generateFilterId(){return`filter-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}async startTimeTracking(t,r){try{let s=await this.taskService.startTimeTracking(t);return new ge.Notice("Time tracking started"),this.statusBarService&&setTimeout(()=>{this.statusBarService.requestUpdate()},50),s}catch(s){throw console.error("Failed to start time tracking:",s),s.message==="Time tracking is already active for this task"?new ge.Notice("Time tracking is already active for this task"):new ge.Notice("Failed to start time tracking"),s}}async stopTimeTracking(t){try{let r=await this.taskService.stopTimeTracking(t);return new ge.Notice("Time tracking stopped"),this.statusBarService&&setTimeout(()=>{this.statusBarService.requestUpdate()},50),r}catch(r){throw console.error("Failed to stop time tracking:",r),r.message==="No active time tracking session for this task"?new ge.Notice("No active time tracking session for this task"):new ge.Notice("Failed to stop time tracking"),r}}getActiveTimeSession(t){return oP(t.timeEntries||[])}isRecurringTaskCompleteForDate(t,r){if(!t.recurrence)return!1;let s=me(r);return(Array.isArray(t.complete_instances)?t.complete_instances:[]).includes(s)}formatTime(t){return nm(t)}async openTaskEditModal(t){new Pa(this.app,this,{task:t}).open()}async openDueDateModal(t){try{let{DueDateModal:r}=await Promise.resolve().then(()=>(xH(),CH));new r(this.app,t,this).open()}catch(r){console.error("Error loading DueDateModal:",r)}}async openScheduledDateModal(t){try{let{ScheduledDateModal:r}=await Promise.resolve().then(()=>(_H(),MH));new r(this.app,t,this).open()}catch(r){console.error("Error loading ScheduledDateModal:",r)}}async refreshCache(){try{let t=new ge.Notice("Refreshing TaskNotes cache...",0);await this.cacheManager.clearAllCaches(),this.notifyDataChanged(void 0,!0,!0),t.hide(),new ge.Notice("TaskNotes cache refreshed successfully")}catch(t){console.error("Error refreshing cache:",t),new ge.Notice("Failed to refresh cache. Please try again.")}}async convertTaskToTaskNote(t){try{let r=t.getCursor();if(!this.instantTaskConvertService){new ge.Notice("Task conversion service not available. Please try again.");return}await this.instantTaskConvertService.instantConvertTask(t,r.line)}catch(r){console.error("Error converting task:",r),new ge.Notice("Failed to convert task. Please try again.")}}async batchConvertAllTasks(t){try{if(!this.instantTaskConvertService){new ge.Notice("Task conversion service not available. Please try again.");return}await this.instantTaskConvertService.batchConvertAllTasks(t)}catch(r){console.error("Error batch converting tasks:",r),new ge.Notice("Failed to batch convert tasks. Please try again.")}}async insertTaskNoteLink(t){try{let s=(await this.cacheManager.getAllTasks()).filter(a=>!a.archived);new Hc(this.app,this,s,a=>{if(a){let o=this.app.vault.getAbstractFileByPath(a.path);if(o){let l=this.app.workspace.getActiveFile(),c=(l==null?void 0:l.path)||"",d=this.app.fileManager.generateMarkdownLink(o,c,"",a.title),u=t.getCursor();t.replaceRange(d,u);let h={line:u.line,ch:u.ch+d.length};t.setCursor(h)}else new ge.Notice("Failed to create link - file not found")}}).open()}catch(r){console.error("Error inserting tasknote link:",r),new ge.Notice("Failed to insert tasknote link")}}extractSelectionInfoForCommand(t,r){let s=t.getSelection();if(s&&s.trim()){let i=t.listSelections()[0],a=Math.min(i.anchor.line,i.head.line),o=Math.max(i.anchor.line,i.head.line),l=[];for(let h=a;h<=o;h++)l.push(t.getLine(h));let c=l[0],u=l.slice(1).join(`
`).trimEnd();return{taskLine:c,details:u,startLine:a,endLine:o,originalContent:l}}else{let i=t.getLine(r);return{taskLine:i,details:"",startLine:r,endLine:r,originalContent:[i]}}}async openQuickActionsForCurrentTask(){try{let t=this.app.workspace.getActiveFile();if(!t){new ge.Notice("No file is currently open");return}let r=await this.cacheManager.getTaskInfo(t.path);if(!r){new ge.Notice("Current file is not a TaskNote");return}let{TaskActionPaletteModal:s}=await Promise.resolve().then(()=>(PH(),AH));new s(this.app,r,this,this.selectedDate).open()}catch(t){console.error("Error opening quick actions:",t),new ge.Notice("Failed to open quick actions")}}async createInlineTask(t){try{let r=t.getCursor(),s=t.getLine(r.line),i=s.trim(),a;if(i==="")a={line:r.line,ch:r.ch};else{let c={line:r.line,ch:s.length};t.replaceRange(`
`,c),a={line:r.line+1,ch:0}}let o={editor:t,insertionPoint:a};new el(this.app,this,{onTaskCreated:c=>{this.handleInlineTaskCreated(c,o)}}).open()}catch(r){console.error("Error creating inline task:",r),new ge.Notice("Failed to create inline task")}}handleInlineTaskCreated(t,r){try{let{editor:s,insertionPoint:i}=r,a=this.app.vault.getAbstractFileByPath(t.path);if(!a){new ge.Notice("Failed to create link - file not found");return}let o=this.app.workspace.getActiveFile(),l=(o==null?void 0:o.path)||"",c=this.app.fileManager.generateMarkdownLink(a,l,"",t.title);s.replaceRange(c,i);let d={line:i.line,ch:i.ch+c.length};s.setCursor(d),new ge.Notice(`Inline task "${t.title}" created and linked successfully`)}catch(s){console.error("Error handling inline task creation:",s),new ge.Notice("Failed to insert task link")}}haveCacheSettingsChanged(){if(!this.previousCacheSettings)return!0;let t={taskTag:this.settings.taskTag,excludedFolders:this.settings.excludedFolders,disableNoteIndexing:this.settings.disableNoteIndexing,storeTitleInFilename:this.settings.storeTitleInFilename,fieldMapping:this.settings.fieldMapping};return t.taskTag!==this.previousCacheSettings.taskTag||t.excludedFolders!==this.previousCacheSettings.excludedFolders||t.disableNoteIndexing!==this.previousCacheSettings.disableNoteIndexing||t.storeTitleInFilename!==this.previousCacheSettings.storeTitleInFilename||JSON.stringify(t.fieldMapping)!==JSON.stringify(this.previousCacheSettings.fieldMapping)}updatePreviousCacheSettings(){this.previousCacheSettings={taskTag:this.settings.taskTag,excludedFolders:this.settings.excludedFolders,disableNoteIndexing:this.settings.disableNoteIndexing,storeTitleInFilename:this.settings.storeTitleInFilename,fieldMapping:JSON.parse(JSON.stringify(this.settings.fieldMapping))}}};var m4=dp;
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
*/

/* nosourcemap */